webpackJsonp([25],{XjFM:function(t,e,n){n("vvTU")},vvTU:function(t,e){!function(){!function(t){"use strict";function e(t){for(var e=[],n=1;n<arguments.length;n++)e[n-1]=arguments[n];return function(){for(var n=[],r=0;r<arguments.length;r++)n[r]=arguments[r];var o=e.concat(n);return t.apply(null,o)}}function n(e,n){return i(t.document.createElement("canvas"),e,n)}function r(t){var e=n(t.width,t.height);return o(e).drawImage(t,0,0),e}function o(t){return t.getContext("2d")}function i(t,e,n){return t.width=e,t.height=n,t}function a(t){return t.naturalWidth||t.width}function u(t){return t.naturalHeight||t.height}function c(t){var e=t.src;return 0===e.indexOf("data:")?d(e):f(e)}function l(e){return new bt(function(n,r){function o(){c(),n(u)}function i(){c(),r("Unable to load data of type "+e.type+": "+a)}var a=t.URL.createObjectURL(e),u=new t.Image,c=function(){u.removeEventListener("load",o),u.removeEventListener("error",i)};u.addEventListener("load",o),u.addEventListener("error",i),u.src=a,u.complete&&o()})}function f(e){return new bt(function(n,r){var o=new t.XMLHttpRequest;o.open("GET",e,!0),o.responseType="blob",o.onload=function(){200===this.status&&n(this.response)},o.onerror=function(){var t=this;r(0===this.status?function(){var t=new Error("No access to download image");return t.code=18,t.name="SecurityError",t}():function(){return new Error("Error "+t.status+" downloading image")}())},o.send()})}function s(e){var n=e.split(","),r=/data:([^;]+)/.exec(n[0]);if(!r)return wt.none();for(var o=r[1],i=n[1],a=t.atob(i),u=a.length,c=Math.ceil(u/1024),l=new Array(c),f=0;f<c;++f){for(var s=1024*f,d=Math.min(s+1024,u),h=new Array(d-s),p=s,m=0;p<d;++m,++p)h[m]=a[p].charCodeAt(0);l[f]=new Uint8Array(h)}return wt.some(new t.Blob(l,{type:o}))}function d(t){return new bt(function(e,n){s(t).fold(function(){n("uri is not base64: "+t)},e)})}function h(e,n,r){return n=n||"image/png",t.HTMLCanvasElement.prototype.toBlob?new bt(function(t,o){e.toBlob(function(e){e?t(e):o()},n,r)}):d(e.toDataURL(n,r))}function p(t,e,n){return e=e||"image/png",t.toDataURL(e,n)}function m(t){return l(t).then(function(t){v(t);var e=n(a(t),u(t));return o(e).drawImage(t,0,0),e})}function g(e){return new bt(function(n){var r=new t.FileReader;r.onloadend=function(){n(r.result)},r.readAsDataURL(e)})}function v(e){t.URL.revokeObjectURL(e.src)}function y(t,e,n){function o(){return bt.resolve(e)}function i(){return n}function a(){return n.split(",")[1]}function u(e,n){return t.then(function(t){return h(t,e,n)})}function c(e,n){return t.then(function(t){return p(t,e,n)})}function l(t,e){return c(t,e).then(function(t){return t.split(",")[1]})}function f(){return t.then(r)}var s=e.type;return{getType:dt(s),toBlob:o,toDataURL:i,toBase64:a,toAdjustedBlob:u,toAdjustedDataURL:c,toAdjustedBase64:l,toCanvas:f}}function w(t){return g(t).then(function(e){return y(m(t),t,e)})}function b(t,e){return h(t,e).then(function(e){return y(bt.resolve(t),e,t.toDataURL())})}function x(t,e,n){var r="string"==typeof t?parseFloat(t):t;return r>n?r=n:r<e&&(r=e),r}function k(){return[1,0,0,0,0,0,1,0,0,0,0,0,1,0,0,0,0,0,1,0,0,0,0,0,1]}function R(t,e){for(var n,r=[],o=new Array(25),i=0;i<5;i++){for(var a=0;a<5;a++)r[a]=e[a+5*i];for(var a=0;a<5;a++){n=0;for(var u=0;u<5;u++)n+=t[a+5*u]*r[u];o[a+5*i]=n}}return o}function I(t,e){return e=x(e,0,1),t.map(function(t,n){return n%6==0?t=1-(1-t)*e:t*=e,x(t,0,1)})}function T(t,e){var n;return e=x(e,-1,1),e*=100,e<0?n=127+e/100*127:(n=e%1,n=0===n?Rt[e]:Rt[Math.floor(e)]*(1-n)+Rt[Math.floor(e)+1]*n,n=127*n+127),R(t,[n/127,0,0,0,.5*(127-n),0,n/127,0,0,.5*(127-n),0,0,n/127,0,.5*(127-n),0,0,0,1,0,0,0,0,0,1])}function M(t,e){e=x(e,-1,1);var n=1+(e>0?3*e:e);return R(t,[.3086*(1-n)+n,.6094*(1-n),.082*(1-n),0,0,.3086*(1-n),.6094*(1-n)+n,.082*(1-n),0,0,.3086*(1-n),.6094*(1-n),.082*(1-n)+n,0,0,0,0,0,1,0,0,0,0,0,1])}function U(t,e){e=x(e,-180,180)/180*Math.PI;var n=Math.cos(e),r=Math.sin(e);return R(t,[.213+.787*n+-.213*r,.715+-.715*n+-.715*r,.072+-.072*n+.928*r,0,0,.213+-.213*n+.143*r,.715+n*(1-.715)+.14*r,.072+-.072*n+-.283*r,0,0,.213+-.213*n+-.787*r,.715+-.715*n+.715*r,.072+.928*n+.072*r,0,0,0,0,0,1,0,0,0,0,0,1])}function E(t,e){return e=x(255*e,-255,255),R(t,[1,0,0,0,e,0,1,0,0,e,0,0,1,0,e,0,0,0,1,0,0,0,0,0,1])}function C(t,e,n,r){return e=x(e,0,2),n=x(n,0,2),r=x(r,0,2),R(t,[e,0,0,0,0,0,n,0,0,0,0,0,r,0,0,0,0,0,1,0,0,0,0,0,1])}function A(t,e){return e=x(e,0,1),R(t,I([.393,.769,.189,0,0,.349,.686,.168,0,0,.272,.534,.131,0,0,0,0,0,1,0,0,0,0,0,1],e))}function O(t,e){return e=x(e,0,1),R(t,I([.33,.34,.33,0,0,.33,.34,.33,0,0,.33,.34,.33,0,0,0,0,0,1,0,0,0,0,0,1],e))}function B(t,e){return t.toCanvas().then(function(n){return S(n,t.getType(),e)})}function S(t,e,n){var r=o(t),i=function(t,e){for(var n,r,o,i,a=t.data,u=e[0],c=e[1],l=e[2],f=e[3],s=e[4],d=e[5],h=e[6],p=e[7],m=e[8],g=e[9],v=e[10],y=e[11],w=e[12],b=e[13],x=e[14],k=e[15],R=e[16],I=e[17],T=e[18],M=e[19],U=0;U<a.length;U+=4)n=a[U],r=a[U+1],o=a[U+2],i=a[U+3],a[U]=n*u+r*c+o*l+i*f+s,a[U+1]=n*d+r*h+o*p+i*m+g,a[U+2]=n*v+r*y+o*w+i*b+x,a[U+3]=n*k+r*R+o*I+i*T+M;return t}(r.getImageData(0,0,t.width,t.height),n);return r.putImageData(i,0,0),b(t,e)}function _(t,e){return t.toCanvas().then(function(n){return j(n,t.getType(),e)})}function j(t,e,n){var r=o(t),i=r.getImageData(0,0,t.width,t.height),a=r.getImageData(0,0,t.width,t.height);return a=function(t,e,n){function r(t,e,n){return t>n?t=n:t<e&&(t=e),t}for(var o=Math.round(Math.sqrt(n.length)),i=Math.floor(o/2),a=t.data,u=e.data,c=t.width,l=t.height,f=0;f<l;f++)for(var s=0;s<c;s++){for(var d=0,h=0,p=0,m=0;m<o;m++)for(var g=0;g<o;g++){var v=r(s+g-i,0,c-1),y=r(f+m-i,0,l-1),w=4*(y*c+v),b=n[m*o+g];d+=a[w]*b,h+=a[w+1]*b,p+=a[w+2]*b}var x=4*(f*c+s);u[x]=r(d,0,255),u[x+1]=r(h,0,255),u[x+2]=r(p,0,255)}return e}(i,a,n),r.putImageData(a,0,0),b(t,e)}function z(t){var e=function(e,n,r){for(var i=o(e),a=new Array(256),u=0;u<a.length;u++)a[u]=t(u,r);var c=function(t,e){for(var n=t.data,r=0;r<n.length;r+=4)n[r]=e[n[r]],n[r+1]=e[n[r+1]],n[r+2]=e[n[r+2]];return t}(i.getImageData(0,0,e.width,e.height),a);return i.putImageData(c,0,0),b(e,n)};return function(t,n){return t.toCanvas().then(function(r){return e(r,t.getType(),n)})}}function D(t){return function(e,n){return B(e,t(k(),n))}}function H(t){return function(e){return _(e,t)}}function L(t,e,n){var r=a(t),o=u(t),i=e/r,c=n/o,l=!1;(i<.5||i>2)&&(i=i<.5?.5:2,l=!0),(c<.5||c>2)&&(c=c<.5?.5:2,l=!0);var f=P(t,i,c);return l?f.then(function(t){return L(t,e,n)}):f}function P(t,e,r){return new bt(function(i){var c=a(t),l=u(t),f=Math.floor(c*e),s=Math.floor(l*r),d=n(f,s);o(d).drawImage(t,0,0,c,l,0,0,f,s),i(d)})}function F(t,e){return t.toCanvas().then(function(n){return V(n,t.getType(),e)})}function V(t,e,r){var a=n(t.width,t.height),u=o(a),c=0,l=0;return r=r<0?360+r:r,90!==r&&270!==r||i(a,a.height,a.width),90!==r&&180!==r||(c=a.width),270!==r&&180!==r||(l=a.height),u.translate(c,l),u.rotate(r*Math.PI/180),u.drawImage(t,0,0),b(a,e)}function W(t,e){return t.toCanvas().then(function(n){return N(n,t.getType(),e)})}function N(t,e,r){var i=n(t.width,t.height),a=o(i);return"v"===r?(a.scale(1,-1),a.drawImage(t,0,-i.height)):(a.scale(-1,1),a.drawImage(t,-i.width,0)),b(i,e)}function q(t,e,n,r,o){return t.toCanvas().then(function(i){return X(i,t.getType(),e,n,r,o)})}function X(t,e,r,i,a,u){var c=n(a,u);return o(c).drawImage(t,-r,-i),b(c,e)}function $(t,e,n){return t.toCanvas().then(function(r){return L(r,e,n).then(function(e){return b(e,t.getType())})})}function G(){function t(t){var e;return e=i.splice(++a),i.push(t),{state:t,removed:e}}function e(){if(r())return i[--a]}function n(){if(o())return i[++a]}function r(){return a>0}function o(){return-1!==a&&a<i.length-1}var i=[],a=-1;return{data:i,add:t,undo:e,redo:n,canUndo:r,canRedo:o}}function Y(t,e,n,r,o){function i(t,e){return{x:e.x+t.x,y:e.y+t.y,w:e.w,h:e.h}}function a(t,e){return{x:e.x-t.x,y:e.y-t.y,w:e.w,h:e.h}}function u(){return a(n,t)}function c(e,r,o,i){var u,c,l,f,s;u=r.x,c=r.y,l=r.w,f=r.h,u+=o*e.deltaX,c+=i*e.deltaY,l+=o*e.deltaW,f+=i*e.deltaH,l<20&&(l=20),f<20&&(f=20),s=t=xe.clamp({x:u,y:c,w:l,h:f},n,"move"===e.name),s=a(n,s),g.fire("updateRect",{rect:s}),h(s)}function l(t){var e;e=ft.map(v,function(t){return"#"+x+"-"+t.name}).concat(ft.map(w,function(t){return"#"+x+"-"+t})).join(","),t?Ie(e,r).show():Ie(e,r).hide()}function f(t){function n(t,e){e.h<0&&(e.h=0),e.w<0&&(e.w=0),Ie("#"+x+"-"+t,r).css({left:e.x,top:e.y,width:e.w,height:e.h})}ft.each(v,function(e){Ie("#"+x+"-"+e.name,r).css({left:t.w*e.xMul+t.x,top:t.h*e.yMul+t.y})}),n("top",{x:e.x,y:e.y,w:e.w,h:t.y-e.y}),n("right",{x:t.x+t.w,y:t.y,w:e.w-t.x-t.w+e.x,h:t.h}),n("bottom",{x:e.x,y:t.y+t.h,w:e.w,h:e.h-t.y-t.h+e.y}),n("left",{x:e.x,y:t.y,w:t.x-e.x,h:t.h}),n("move",t)}function s(e){t=e,f(t)}function d(n){e=n,f(t)}function h(t){s(i(n,t))}function p(e){n=e,f(t)}function m(){ft.each(y,function(t){t.destroy()}),y=[]}var g,v,y,w,b="mce-",x=b+"crid-"+Ue++;return v=[{name:"move",xMul:0,yMul:0,deltaX:1,deltaY:1,deltaW:0,deltaH:0,label:"Crop Mask"},{name:"nw",xMul:0,yMul:0,deltaX:1,deltaY:1,deltaW:-1,deltaH:-1,label:"Top Left Crop Handle"},{name:"ne",xMul:1,yMul:0,deltaX:0,deltaY:1,deltaW:1,deltaH:-1,label:"Top Right Crop Handle"},{name:"sw",xMul:0,yMul:1,deltaX:1,deltaY:0,deltaW:-1,deltaH:1,label:"Bottom Left Crop Handle"},{name:"se",xMul:1,yMul:1,deltaX:0,deltaY:0,deltaW:1,deltaH:1,label:"Bottom Right Crop Handle"}],w=["top","right","bottom","left"],function(){function e(e){var n;return new(be.get("DragHelper"))(x,{document:r.ownerDocument,handle:x+"-"+e.name,start:function(){n=t},drag:function(t){c(e,n,t.deltaX,t.deltaY)}})}Ie('<div id="'+x+'" class="'+b+'croprect-container" role="grid" aria-dropeffect="execute">').appendTo(r),ft.each(w,function(t){Ie("#"+x,r).append('<div id="'+x+"-"+t+'"class="'+b+'croprect-block" style="display: none" data-mce-bogus="all">')}),ft.each(v,function(t){Ie("#"+x,r).append('<div id="'+x+"-"+t.name+'" class="'+b+"croprect-handle "+b+"croprect-handle-"+t.name+'"style="display: none" data-mce-bogus="all" role="gridcell" tabindex="-1" aria-label="'+t.label+'" aria-grabbed="false">')}),y=ft.map(v,e),f(t),Ie(r).on("focusin focusout",function(t){Ie(t.target).attr("aria-grabbed","focus"===t.type)}),Ie(r).on("keydown",function(e){function n(t,e,n,o,i){t.stopPropagation(),t.preventDefault(),c(r,n,o,i)}var r;switch(ft.each(v,function(t){if(e.target.id===x+"-"+t.name)return r=t,!1}),e.keyCode){case Me.LEFT:n(e,r,t,-10,0);break;case Me.RIGHT:n(e,r,t,10,0);break;case Me.UP:n(e,r,t,0,-10);break;case Me.DOWN:n(e,r,t,0,10);break;case Me.ENTER:case Me.SPACEBAR:e.preventDefault(),o()}})}(),g=ft.extend({toggleVisibility:l,setClampRect:p,setRect:s,getInnerRect:u,setInnerRect:h,setViewPortRect:d,destroy:m},Te)}function J(t){return{blob:t,url:ce.createObjectURL(t)}}function K(t){t&&ce.revokeObjectURL(t.url)}function Z(t){ft.each(t,K)}function Q(t,e,n,r){function o(t){var e,n,r,o;e=M.find("#w")[0],n=M.find("#h")[0],r=parseInt(e.value(),10),o=parseInt(n.value(),10),M.find("#constrain")[0].checked()&&Q&&tt&&r&&o&&("w"===t.control.settings.name?(o=Math.round(r*et),n.value(o)):(r=Math.round(o*nt),e.value(r))),Q=r,tt=o}function i(t){return Math.round(100*t)+"%"}function a(){M.find("#undo").disabled(!rt.canUndo()),M.find("#redo").disabled(!rt.canRedo()),M.statusbar.find("#save").disabled(!rt.canUndo())}function u(){M.find("#undo").disabled(!0),M.find("#redo").disabled(!0)}function c(t){t&&S.imageSrc(t.url)}function l(t){return function(){var e=ft.grep(Y,function(e){return e.settings.name!==t});ft.each(e,function(t){t.hide()}),t.show(),t.focus()}}function f(t){C=J(t),c(C)}function s(t){e=J(t),c(e),Z(rt.add(e).removed),a()}function d(){var t=S.selection();Zt(e.blob).then(function(e){Yt(e,t.x,t.y,t.w,t.h).then(at).then(function(t){s(t),p()})})}function h(t){for(var n=[],r=1;r<arguments.length;r++)n[r-1]=arguments[r];var o=[].slice.call(arguments,1);return function(){Zt(e.blob).then(function(e){t.apply(this,[e].concat(o)).then(at).then(s)})}}function p(){c(e),K(C),l(U)(),a()}function m(e,n){C?n():setTimeout(function(){e-- >0?m(e,n):t.windowManager.alert("Error: failed to apply image operation.")},10)}function g(){C?(s(C.blob),p()):m(100,g)}function v(){var t=S.zoom();t<2&&(t+=.1),S.zoom(t)}function y(){var t=S.zoom();t>.1&&(t-=.1),S.zoom(t)}function w(){e=rt.undo(),c(e),a()}function b(){e=rt.redo(),c(e),a()}function x(){n(e.blob),M.close()}function k(t){return be.create("Form",{layout:"flex",direction:"row",labelGap:5,border:"0 0 1 0",align:"center",pack:"center",padding:"0 10 0 10",spacing:5,flex:0,minHeight:60,defaults:{classes:"imagetool",type:"button"},items:t})}function R(t,n){return k(ot([{text:"Back",onclick:p},{type:"spacer",flex:1},{text:"Apply",subtype:"primary",onclick:g}])).hide().on("show",function(){u(),Zt(e.blob).then(function(t){return n(t)}).then(at).then(function(t){var e=J(t);c(e),K(C),C=e})})}function I(n,r,o,a,l){function f(t){Zt(e.blob).then(function(e){return r(e,t)}).then(at).then(function(t){var e=J(t);c(e),K(C),C=e})}return k(ot([{text:"Back",onclick:p},{type:"spacer",flex:1},{type:"slider",flex:1,ondragend:function(t){f(t.value)},minValue:t.rtl?l:a,maxValue:t.rtl?a:l,value:o,previewFilter:i},{type:"spacer",flex:1},{text:"Apply",subtype:"primary",onclick:g}])).hide().on("show",function(){this.find("slider").value(o),u()})}function T(t){!0===t.control.value()&&(et=tt/Q,nt=Q/tt)}var M,U,E,C,A,O,B,S,_,j,z,D,H,L,P,F,V,W,N,q,X,$,Y,Q,tt,et,nt,rt=G(),ot=function(e){return t.rtl?e.reverse():e},it=function(t){var n=[].slice.call(arguments,1);return function(){Zt((C||e).blob).then(function(e){t.apply(this,[e].concat(n)).then(at).then(f)})}},at=function(t){return t.toBlob()};A=k(ot([{text:"Back",onclick:p},{type:"spacer",flex:1},{text:"Apply",subtype:"primary",onclick:d}])).hide().on("show hide",function(t){S.toggleCropRect("show"===t.type)}).on("show",u),O=k(ot([{text:"Back",onclick:p},{type:"spacer",flex:1},{type:"textbox",name:"w",label:"Width",size:4,onkeyup:o},{type:"textbox",name:"h",label:"Height",size:4,onkeyup:o},{type:"checkbox",name:"constrain",text:"Constrain proportions",checked:!0,onchange:T},{type:"spacer",flex:1},{text:"Apply",subtype:"primary",onclick:"submit"}])).hide().on("submit",function(t){var e=parseInt(M.find("#w").value(),10),n=parseInt(M.find("#h").value(),10);t.preventDefault(),h(Jt,e,n)(),p()}).on("show",u),B=k(ot([{text:"Back",onclick:p},{type:"spacer",flex:1},{icon:"fliph",tooltip:"Flip horizontally",onclick:it(Gt,"h")},{icon:"flipv",tooltip:"Flip vertically",onclick:it(Gt,"v")},{icon:"rotateleft",tooltip:"Rotate counterclockwise",onclick:it(Kt,-90)},{icon:"rotateright",tooltip:"Rotate clockwise",onclick:it(Kt,90)},{type:"spacer",flex:1},{text:"Apply",subtype:"primary",onclick:g}])).hide().on("show",u),z=R("Invert",zt),N=R("Sharpen",Dt),q=R("Emboss",Ht),D=I("Brightness",Vt,0,-1,1),H=I("Hue",Wt,180,0,360),L=I("Saturate",Nt,0,-1,1),P=I("Contrast",qt,0,-1,1),F=I("Grayscale",Xt,0,0,1),V=I("Sepia",$t,0,0,1),W=function(n,r){function o(){var t,n,o;t=M.find("#r")[0].value(),n=M.find("#g")[0].value(),o=M.find("#b")[0].value(),Zt(e.blob).then(function(e){return r(e,t,n,o)}).then(at).then(function(t){var e=J(t);c(e),K(C),C=e})}var a=t.rtl?2:0,l=t.rtl?0:2;return k(ot([{text:"Back",onclick:p},{type:"spacer",flex:1},{type:"slider",label:"R",name:"r",minValue:a,value:1,maxValue:l,ondragend:o,previewFilter:i},{type:"slider",label:"G",name:"g",minValue:a,value:1,maxValue:l,ondragend:o,previewFilter:i},{type:"slider",label:"B",name:"b",minValue:a,value:1,maxValue:l,ondragend:o,previewFilter:i},{type:"spacer",flex:1},{text:"Apply",subtype:"primary",onclick:g}])).hide().on("show",function(){M.find("#r,#g,#b").value(1),u()})}("Colorize",Ft),X=I("Gamma",Lt,0,-1,1),$=I("Exposure",Pt,1,0,2),E=k(ot([{text:"Back",onclick:p},{type:"spacer",flex:1},{text:"hue",icon:"hue",onclick:l(H)},{text:"saturate",icon:"saturate",onclick:l(L)},{text:"sepia",icon:"sepia",onclick:l(V)},{text:"emboss",icon:"emboss",onclick:l(q)},{text:"exposure",icon:"exposure",onclick:l($)},{type:"spacer",flex:1}])).hide(),U=k(ot([{tooltip:"Crop",icon:"crop",onclick:l(A)},{tooltip:"Resize",icon:"resize2",onclick:l(O)},{tooltip:"Orientation",icon:"orientation",onclick:l(B)},{tooltip:"Brightness",icon:"sun",onclick:l(D)},{tooltip:"Sharpen",icon:"sharpen",onclick:l(N)},{tooltip:"Contrast",icon:"contrast",onclick:l(P)},{tooltip:"Color levels",icon:"drop",onclick:l(W)},{tooltip:"Gamma",icon:"gamma",onclick:l(X)},{tooltip:"Invert",icon:"invert",onclick:l(z)}])),S=Ce.create({flex:1,imageSrc:e.url}),_=be.create("Container",{layout:"flex",direction:"column",pack:"start",border:"0 1 0 0",padding:5,spacing:5,items:[{type:"button",icon:"undo",tooltip:"Undo",name:"undo",onclick:w},{type:"button",icon:"redo",tooltip:"Redo",name:"redo",onclick:b},{type:"button",icon:"zoomin",tooltip:"Zoom in",onclick:v},{type:"button",icon:"zoomout",tooltip:"Zoom out",onclick:y}]}),j=be.create("Container",{type:"container",layout:"flex",direction:"row",align:"stretch",flex:1,items:ot([_,S])}),Y=[U,A,O,B,E,z,D,H,L,P,F,V,W,N,q,X,$],M=t.windowManager.open({layout:"flex",direction:"column",align:"stretch",minWidth:Math.min(we.DOM.getViewPort().w,800),minHeight:Math.min(we.DOM.getViewPort().h,650),title:"Edit image",items:Y.concat([j]),buttons:ot([{text:"Save",name:"save",subtype:"primary",onclick:x},{text:"Cancel",onclick:"close"}])}),M.on("close",function(){r(),Z(rt.data),rt=null,C=null}),rt.add(e),a(),S.on("load",function(){Q=S.imageSize().w,tt=S.imageSize().h,et=tt/Q,nt=Q/tt,M.find("#w").value(Q),M.find("#h").value(tt)}),S.on("crop",d)}function tt(t,e){return new fe(function(n,r){return e.toBlob().then(function(e){Q(t,J(e),n,r)})})}function et(t){function e(t){return/^[0-9\.]+px$/.test(t)}var n,r;return n=t.style.width,r=t.style.height,n||r?e(n)&&e(r)?{w:parseInt(n,10),h:parseInt(r,10)}:null:(n=t.width,r=t.height,n&&r?{w:parseInt(n,10),h:parseInt(r,10)}:null)}function nt(t,e){var n,r;e&&(n=t.style.width,r=t.style.height,(n||r)&&(t.style.width=e.w+"px",t.style.height=e.h+"px",t.removeAttribute("data-mce-style")),n=t.width,r=t.height,(n||r)&&(t.setAttribute("width",e.w),t.setAttribute("height",e.h)))}function rt(t){return{w:t.naturalWidth,h:t.naturalHeight}}function ot(){return new(oe.getOrDie("FileReader"))}function it(){return new(oe.getOrDie("XMLHttpRequest"))}function at(t,e){return Fe.requestUrlAsBlob(t,{},e).then(function(t){return t.status<200||t.status>=300?Ke.handleHttpError(t.status):fe.resolve(t.blob)})}function ut(){}var ct=function(t){var e=t,n=function(){return e};return{get:n,set:function(t){e=t},clone:function(){return ct(n())}}},lt=tinymce.util.Tools.resolve("tinymce.PluginManager"),ft=tinymce.util.Tools.resolve("tinymce.util.Tools"),st=function(){},dt=function(t){return function(){return t}},ht=dt(!1),pt=dt(!0),mt=function(){return gt},gt=function(){var t=function(t){return t.isNone()},e=function(t){return t()},n=function(t){return t},r={fold:function(t,e){return t()},is:ht,isSome:ht,isNone:pt,getOr:n,getOrThunk:e,getOrDie:function(t){throw new Error(t||"error: getOrDie called on none.")},getOrNull:dt(null),getOrUndefined:dt(void 0),or:n,orThunk:e,map:mt,each:st,bind:mt,exists:ht,forall:pt,filter:mt,equals:t,equals_:t,toArray:function(){return[]},toString:dt("none()")};return Object.freeze&&Object.freeze(r),r}(),vt=function(t){var e=dt(t),n=function(){return o},r=function(e){return e(t)},o={fold:function(e,n){return n(t)},is:function(e){return t===e},isSome:pt,isNone:ht,getOr:e,getOrThunk:e,getOrDie:e,getOrNull:e,getOrUndefined:e,or:n,orThunk:n,map:function(e){return vt(e(t))},each:function(e){e(t)},bind:r,exists:r,forall:r,filter:function(e){return e(t)?o:gt},toArray:function(){return[t]},toString:function(){return"some("+t+")"},equals:function(e){return e.is(t)},equals_:function(e,n){return e.fold(ht,function(e){return n(t,e)})}};return o},yt=function(t){return null===t||void 0===t?gt:vt(t)},wt={some:vt,none:mt,from:yt},bt=window.Promise?window.Promise:function(){function e(t,e){return function(){return t.apply(e,arguments)}}function n(t){var e=this;if(null===this._state)return void this._deferreds.push(t);l(function(){var n=e._state?t.onFulfilled:t.onRejected;if(null===n)return void(e._state?t.resolve:t.reject)(e._value);var r;try{r=n(e._value)}catch(e){return void t.reject(e)}t.resolve(r)})}function r(t){try{if(t===this)throw new TypeError("A promise cannot be resolved with itself.");if(t&&("object"==typeof t||"function"==typeof t)){var n=t.then;if("function"==typeof n)return void u(e(n,t),e(r,this),e(o,this))}this._state=!0,this._value=t,i.call(this)}catch(t){o.call(this,t)}}function o(t){this._state=!1,this._value=t,i.call(this)}function i(){for(var t=0,e=this._deferreds;t<e.length;t++){var r=e[t];n.call(this,r)}this._deferreds=[]}function a(t,e,n,r){this.onFulfilled="function"==typeof t?t:null,this.onRejected="function"==typeof e?e:null,this.resolve=n,this.reject=r}function u(t,e,n){var r=!1;try{t(function(t){r||(r=!0,e(t))},function(t){r||(r=!0,n(t))})}catch(t){if(r)return;r=!0,n(t)}}var c=function(t){if("object"!=typeof this)throw new TypeError("Promises must be constructed via new");if("function"!=typeof t)throw new TypeError("not a function");this._state=null,this._value=null,this._deferreds=[],u(t,e(r,this),e(o,this))},l=c.immediateFn||"function"==typeof window.setImmediate&&window.setImmediate||function(e){t.setTimeout(e,1)},f=Array.isArray||function(t){return"[object Array]"===Object.prototype.toString.call(t)};return c.prototype.catch=function(t){return this.then(null,t)},c.prototype.then=function(t,e){var r=this;return new c(function(o,i){n.call(r,new a(t,e,o,i))})},c.all=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];var n=Array.prototype.slice.call(1===t.length&&f(t[0])?t[0]:t);return new c(function(t,e){function r(i,a){try{if(a&&("object"==typeof a||"function"==typeof a)){var u=a.then;if("function"==typeof u)return void u.call(a,function(t){r(i,t)},e)}n[i]=a,0==--o&&t(n)}catch(t){e(t)}}if(0===n.length)return t([]);for(var o=n.length,i=0;i<n.length;i++)r(i,n[i])})},c.resolve=function(t){return t&&"object"==typeof t&&t.constructor===c?t:new c(function(e){e(t)})},c.reject=function(t){return new c(function(e,n){n(t)})},c.race=function(t){return new c(function(e,n){for(var r=0,o=t;r<o.length;r++){o[r].then(e,n)}})},c}(),xt=function(t){return l(t)},kt=function(t){return c(t)},Rt=[0,.01,.02,.04,.05,.06,.07,.08,.1,.11,.12,.14,.15,.16,.17,.18,.2,.21,.22,.24,.25,.27,.28,.3,.32,.34,.36,.38,.4,.42,.44,.46,.48,.5,.53,.56,.59,.62,.65,.68,.71,.74,.77,.8,.83,.86,.89,.92,.95,.98,1,1.06,1.12,1.18,1.24,1.3,1.36,1.42,1.48,1.54,1.6,1.66,1.72,1.78,1.84,1.9,1.96,2,2.12,2.25,2.37,2.5,2.62,2.75,2.87,3,3.2,3.4,3.6,3.8,4,4.3,4.7,4.9,5,5.5,6,6.5,6.8,7,7.3,7.5,7.8,8,8.4,8.7,9,9.4,9.6,9.8,10],It=function(t){return function(e){return B(e,t)}}([-1,0,0,0,255,0,-1,0,0,255,0,0,-1,0,255,0,0,0,1,0,0,0,0,0,1]),Tt=D(E),Mt=D(U),Ut=D(M),Et=D(T),Ct=D(O),At=D(A),Ot=function(t,e,n,r){return B(t,C(k(),e,n,r))},Bt=H([0,-1,0,-1,5,-1,0,-1,0]),St=H([-2,-1,0,-1,1,1,0,1,2]),_t=z(function(t,e){return 255*Math.pow(t/255,1-e)}),jt=z(function(t,e){return 255*(1-Math.exp(-t/255*e))}),zt=function(t){return It(t)},Dt=function(t){return Bt(t)},Ht=function(t){return St(t)},Lt=function(t,e){return _t(t,e)},Pt=function(t,e){return jt(t,e)},Ft=function(t,e,n,r){return Ot(t,e,n,r)},Vt=function(t,e){return Tt(t,e)},Wt=function(t,e){return Mt(t,e)},Nt=function(t,e){return Ut(t,e)},qt=function(t,e){return Et(t,e)},Xt=function(t,e){return Ct(t,e)},$t=function(t,e){return At(t,e)},Gt=function(t,e){return W(t,e)},Yt=function(t,e,n,r,o){return q(t,e,n,r,o)},Jt=function(t,e,n){return $(t,e,n)},Kt=function(t,e){return F(t,e)},Zt=function(t){return w(t)},Qt=void 0!==t.window?t.window:Function("return this;")(),te=function(t,e){for(var n=void 0!==e&&null!==e?e:Qt,r=0;r<t.length&&void 0!==n&&null!==n;++r)n=n[t[r]];return n},ee=function(t,e){var n=t.split(".");return te(n,e)},ne=function(t,e){return ee(t,e)},re=function(t,e){var n=ne(t,e);if(void 0===n||null===n)throw new Error(t+" not available on this browser");return n},oe={getOrDie:re},ie=function(){return oe.getOrDie("URL")},ae=function(t){return ie().createObjectURL(t)},ue=function(t){ie().revokeObjectURL(t)},ce={createObjectURL:ae,revokeObjectURL:ue},le=tinymce.util.Tools.resolve("tinymce.util.Delay"),fe=tinymce.util.Tools.resolve("tinymce.util.Promise"),se=tinymce.util.Tools.resolve("tinymce.util.URI"),de=function(t){return t.getParam("imagetools_toolbar","rotateleft rotateright | flipv fliph | crop editimage imageoptions")},he=function(t){return t.getParam("imagetools_proxy")},pe=function(t){return t.getParam("imagetools_cors_hosts",[],"string[]")},me=function(t){return t.getParam("imagetools_credentials_hosts",[],"string[]")},ge=function(t){return t.getParam("api_key",t.getParam("imagetools_api_key","","string"),"string")},ve=function(t){return t.getParam("images_upload_timeout",3e4,"number")},ye=function(t){return t.getParam("images_reuse_filename",!1,"boolean")},we=tinymce.util.Tools.resolve("tinymce.dom.DOMUtils"),be=tinymce.util.Tools.resolve("tinymce.ui.Factory"),xe=tinymce.util.Tools.resolve("tinymce.geom.Rect"),ke=function(t){return new fe(function(e){var n=function(){t.removeEventListener("load",n),e(t)};t.complete?e(t):t.addEventListener("load",n)})},Re={loadImage:ke},Ie=tinymce.util.Tools.resolve("tinymce.dom.DomQuery"),Te=tinymce.util.Tools.resolve("tinymce.util.Observable"),Me=tinymce.util.Tools.resolve("tinymce.util.VK"),Ue=0,Ee=function(e){return new(be.get("Control").extend({Defaults:{classes:"imagepanel"},selection:function(t){return arguments.length?(this.state.set("rect",t),this):this.state.get("rect")},imageSize:function(){var t=this.state.get("viewRect");return{w:t.w,h:t.h}},toggleCropRect:function(t){this.state.set("cropEnabled",t)},imageSrc:function(e){var n=this,r=new t.Image;r.src=e,Re.loadImage(r).then(function(){var e,o,i=n.state.get("viewRect");if(o=n.$el.find("img"),o[0])o.replaceWith(r);else{var a=t.document.createElement("div");a.className="mce-imagepanel-bg",n.getEl().appendChild(a),n.getEl().appendChild(r)}e={x:0,y:0,w:r.naturalWidth,h:r.naturalHeight},n.state.set("viewRect",e),n.state.set("rect",xe.inflate(e,-20,-20)),i&&i.w===e.w&&i.h===e.h||n.zoomFit(),n.repaintImage(),n.fire("load")})},zoom:function(t){return arguments.length?(this.state.set("zoom",t),this):this.state.get("zoom")},postRender:function(){return this.imageSrc(this.settings.imageSrc),this._super()},zoomFit:function(){var t,e,n,r,o,i,a,u=this;a=10,t=u.$el.find("img"),e=u.getEl().clientWidth,n=u.getEl().clientHeight,r=t[0].naturalWidth,o=t[0].naturalHeight,i=Math.min((e-a)/r,(n-a)/o),i>=1&&(i=1),u.zoom(i)},repaintImage:function(){var t,e,n,r,o,i,a,u,c,l,f;f=this.getEl(),c=this.zoom(),l=this.state.get("rect"),a=this.$el.find("img"),u=this.$el.find(".mce-imagepanel-bg"),o=f.offsetWidth,i=f.offsetHeight,n=a[0].naturalWidth*c,r=a[0].naturalHeight*c,t=Math.max(0,o/2-n/2),e=Math.max(0,i/2-r/2),a.css({left:t,top:e,width:n,height:r}),u.css({left:t,top:e,width:n,height:r}),this.cropRect&&(this.cropRect.setRect({x:l.x*c+t,y:l.y*c+e,w:l.w*c,h:l.h*c}),this.cropRect.setClampRect({x:t,y:e,w:n,h:r}),this.cropRect.setViewPortRect({x:0,y:0,w:o,h:i}))},bindStates:function(){function t(t){e.cropRect=Y(t,e.state.get("viewRect"),e.state.get("viewRect"),e.getEl(),function(){e.fire("crop")}),e.cropRect.on("updateRect",function(t){var n=t.rect,r=e.zoom();n={x:Math.round(n.x/r),y:Math.round(n.y/r),w:Math.round(n.w/r),h:Math.round(n.h/r)},e.state.set("rect",n)}),e.on("remove",e.cropRect.destroy)}var e=this;e.state.on("change:cropEnabled",function(t){e.cropRect.toggleVisibility(t.value),e.repaintImage()}),e.state.on("change:zoom",function(){e.repaintImage()}),e.state.on("change:rect",function(n){var r=n.value;e.cropRect||t(r),e.cropRect.setRect(r)})}}))(e)},Ce={create:Ee},Ae={edit:tt},Oe={getImageSize:et,setImageSize:nt,getNaturalImageSize:rt},Be=function(t){if(null===t)return"null";var e=typeof t;return"object"===e&&(Array.prototype.isPrototypeOf(t)||t.constructor&&"Array"===t.constructor.name)?"array":"object"===e&&(String.prototype.isPrototypeOf(t)||t.constructor&&"String"===t.constructor.name)?"string":e},Se=function(t){return function(e){return Be(e)===t}}("function"),_e=Array.prototype.slice,je=function(t,e){for(var n=0,r=t.length;n<r;n++){var o=t[n];if(e(o,n))return wt.some(o)}return wt.none()},ze=(Se(Array.from)&&Array.from,function(t){return null!==t&&void 0!==t}),De=function(t,e){var n;return n=e.reduce(function(t,e){return ze(t)?t[e]:void 0},t),ze(n)?n:null},He=function(t,e,n){return new fe(function(r){var o;o=it(),o.onreadystatechange=function(){4===o.readyState&&r({status:o.status,blob:this.response})},o.open("GET",t,!0),o.withCredentials=n,ft.each(e,function(t,e){o.setRequestHeader(e,t)}),o.responseType="blob",o.send()})},Le=function(t){return new fe(function(e){var n=ot();n.onload=function(t){var n=t.target;e(n.result)},n.readAsText(t)})},Pe=function(t){var e;try{e=JSON.parse(t)}catch(t){}return e},Fe={traverse:De,readBlob:Le,requestUrlAsBlob:He,parseJson:Pe},Ve=[{code:404,message:"Could not find Image Proxy"},{code:403,message:"Rejected request"},{code:0,message:"Incorrect Image Proxy URL"}],We=[{type:"key_missing",message:"The request did not include an api key."},{type:"key_not_found",message:"The provided api key could not be found."},{type:"domain_not_trusted",message:"The api key is not valid for the request origins."}],Ne=function(t){return 400===t||403===t||500===t},qe=function(t){return"ImageProxy HTTP error: "+je(Ve,function(e){return t===e.code}).fold(dt("Unknown ImageProxy error"),function(t){return t.message})},Xe=function(t){var e=qe(t);return fe.reject(e)},$e=function(t){return je(We,function(e){return e.type===t}).fold(dt("Unknown service error"),function(t){return t.message})},Ge=function(t){var e=Fe.parseJson(t),n=Fe.traverse(e,["error","type"]);return"ImageProxy Service error: "+(n?$e(n):"Invalid JSON in service error message")},Ye=function(t,e){return Fe.readBlob(e).then(function(t){var e=Ge(t);return fe.reject(e)})},Je=function(t,e){return Ne(t)?Ye(0,e):Xe(t)},Ke={handleServiceErrorResponse:Je,handleHttpError:Xe,getHttpErrorMsg:qe,getServiceErrorMsg:$e},Ze=function(t,e){var n=-1===t.indexOf("?")?"?":"&";return/[?&]apiKey=/.test(t)||!e?t:t+n+"apiKey="+encodeURIComponent(e)},Qe=function(t,e){var n={"Content-Type":"application/json;charset=UTF-8","tiny-api-key":e};return Fe.requestUrlAsBlob(Ze(t,e),n,!1).then(function(t){return t.status<200||t.status>=300?Ke.handleServiceErrorResponse(t.status,t.blob):fe.resolve(t.blob)})},tn=function(t,e,n){return e?Qe(t,e):at(t,n)},en={getUrl:tn},nn=0,rn=function(t,e){return t.dom.is(e,"img:not([data-mce-object],[data-mce-placeholder])")&&(ln(t,e)||fn(t,e)||t.settings.imagetools_proxy)},on=function(t,e){t.notificationManager.open({text:e,type:"error"})},an=function(t){return t.selection.getNode()},un=function(t,e){var n=e.match(/\/([^\/\?]+)?\.(?:jpeg|jpg|png|gif)(?:\?|$)/i);return n?t.dom.encode(n[1]):null},cn=function(){return"imagetools"+nn++},ln=function(t,e){var n=e.src;return 0===n.indexOf("data:")||0===n.indexOf("blob:")||new se(n).host===t.documentBaseURI.host},fn=function(t,e){return-1!==ft.inArray(pe(t),new se(e.src).host)},sn=function(t,e){return-1!==ft.inArray(me(t),new se(e.src).host)},dn=function(t,e){var n,r=e.src;return fn(t,e)?en.getUrl(e.src,null,sn(t,e)):ln(t,e)?kt(e):(r=he(t),r+=(-1===r.indexOf("?")?"?":"&")+"url="+encodeURIComponent(e.src),n=ge(t),en.getUrl(r,n,!1))},hn=function(t){var e;return e=t.editorUpload.blobCache.getByUri(an(t).src),e?fe.resolve(e.blob()):dn(t,an(t))},pn=function(t,e){var n=le.setEditorTimeout(t,function(){t.editorUpload.uploadImagesAuto()},ve(t));e.set(n)},mn=function(t){clearTimeout(t.get())},gn=function(t,e,n,r,o){return e.toBlob().then(function(i){var a,u,c,l,f;return c=t.editorUpload.blobCache,f=an(t),a=f.src,ye(t)&&(l=c.getByUri(a),l?(a=l.uri(),u=l.name()):u=un(t,a)),l=c.create({id:cn(),blob:i,base64:e.toBase64(),uri:a,name:u}),c.add(l),t.undoManager.transact(function(){function e(){t.$(f).off("load",e),t.nodeChanged(),n?t.editorUpload.uploadImagesAuto():(mn(r),pn(t,r))}t.$(f).on("load",e),o&&t.$(f).attr({width:o.w,height:o.h}),t.$(f).attr({src:l.blobUri()}).removeAttr("data-mce-src")}),l})},vn=function(t,n,r,o){return function(){return t._scanForImages().then(e(hn,t)).then(Zt).then(r).then(function(e){return gn(t,e,!1,n,o)},function(e){on(t,e)})}},yn=function(t,e,n){return function(){var r=Oe.getImageSize(an(t)),o=r?{w:r.h,h:r.w}:null;return vn(t,e,function(t){return Kt(t,n)},o)()}},wn=function(t,e,n){return function(){return vn(t,e,function(t){return Gt(t,n)})()}},bn=function(t,n){return function(){var r=an(t),o=Oe.getNaturalImageSize(r),i=function(t){return new fe(function(e){xt(t).then(function(n){var i=Oe.getNaturalImageSize(n);o.w===i.w&&o.h===i.h||Oe.getImageSize(r)&&Oe.setImageSize(r,i),ce.revokeObjectURL(n.src),e(t)})})},a=function(t,e){return Ae.edit(t,e).then(i).then(Zt).then(function(e){return gn(t,e,!0,n)},function(){})};hn(t).then(Zt).then(e(a,t),function(e){on(t,e)})}},xn={rotate:yn,flip:wn,editImageDialog:bn,isEditableImage:rn,cancelTimedUpload:mn},kn=function(t,e){ft.each({mceImageRotateLeft:xn.rotate(t,e,-90),mceImageRotateRight:xn.rotate(t,e,90),mceImageFlipVertical:xn.flip(t,e,"v"),mceImageFlipHorizontal:xn.flip(t,e,"h"),mceEditImage:xn.editImageDialog(t,e)},function(e,n){t.addCommand(n,e)})},Rn={register:kn},In=function(t,e,n){t.on("NodeChange",function(r){var o=n.get();o&&o.src!==r.element.src&&(xn.cancelTimedUpload(e),t.editorUpload.uploadImagesAuto(),n.set(null)),xn.isEditableImage(t,r.element)&&n.set(r.element)})},Tn={setup:In},Mn=function(t){t.addButton("rotateleft",{title:"Rotate counterclockwise",cmd:"mceImageRotateLeft"}),t.addButton("rotateright",{title:"Rotate clockwise",cmd:"mceImageRotateRight"}),t.addButton("flipv",{title:"Flip vertically",cmd:"mceImageFlipVertical"}),t.addButton("fliph",{title:"Flip horizontally",cmd:"mceImageFlipHorizontal"}),t.addButton("editimage",{title:"Edit image",cmd:"mceEditImage"}),t.addButton("imageoptions",{title:"Image options",icon:"options",cmd:"mceImage"})},Un={register:Mn},En=function(t){t.addContextToolbar(e(xn.isEditableImage,t),de(t))},Cn={register:En};lt.add("imagetools",function(t){var e=ct(0),n=ct(null);Rn.register(t,e),Un.register(t),Cn.register(t),Tn.setup(t,e,n)})}(window)}()}});
//# sourceMappingURL=25.69785591ee5e23492b5b.js.map