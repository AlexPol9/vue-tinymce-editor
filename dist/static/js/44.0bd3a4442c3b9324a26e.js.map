{"version":3,"sources":["webpack:///static/js/44.0bd3a4442c3b9324a26e.js","webpack:///./~/tinymce/tinymce.js"],"names":["webpackJsonp","5eDb","module","exports","__webpack_require__","domGlobals","curry","fn","initialArgs","_i","arguments","length","restArgs","all","concat","apply","createCache","cache","key","value","keys","push","Expr","cacheLength","shift","markFunction","expando","siblingCheck","a","b","cur","diff","nodeType","sourceIndex","MAX_NEGATIVE","nextSibling","createPositionalPseudo","argument","seed","matches","j","matchIndexes","i","testContext","context","getElementsByTagName","strundefined","setFilters","toSelector","tokens","len","selector","addCombinator","matcher","combinator","base","dir","checkNonElements","doneName","done","first","elem","xml","oldCache","outerCache","newCache","dirruns","elementMatcher","matchers","multipleContexts","contexts","results","Sizzle","condense","unmatched","map","filter","newUnmatched","mapped","setMatcher","preFilter","postFilter","postFinder","postSelector","temp","preMap","postMap","preexisting","elems","matcherIn","matcherOut","indexOf$1","call","splice","matcherFromTokens","checkContext","leadingRelative","relative","type","implicitRelative","matchContext","matchAnyContext","outermostContext","slice","replace","rtrim","matcherFromGroupMatchers","elementMatchers","setMatchers","bySet","byElement","superMatcher","outermost","matchedCount","setMatched","contextBackup","find","TAG","dirrunsUnique","Math","random","document","pop","uniqueSort","StyleSheetLoader","settings","maxLoadTime","idCount","loadedStates","appendToHead","node","appendChild","load","url","loadedCallback","errorCallback","link","style","startTime","state","passed","callbacks","status","failed","wait","testCallback","waitCallback","Date","getTime","Delay","setTimeout","waitForWebKitLinkLoaded","styleSheet","owner","styleSheets","ownerNode","owningElement","id","waitForGeckoLinkLoaded","cssRules","sheet","ex","Tools","_addCacheSuffix","createElement","rel","async","defer","contentCssCors","crossOrigin","webKitChunks","navigator","userAgent","match","parseInt","onload","onerror","indexOf","textContent","href","loadF","Future","nu","resolve","compose","constant","Result","error","unbox","result","fold","identity","loadAll","urls","success","failure","par$1","get","parts","partition","r","isValue","fail","pass","TreeWalker","startNode","rootNode","findSibling","startName","siblingName","shallow","sibling","parent","parentNode","findPreviousNode","child","this","current","next","prev","prev2","Schema","validStyles","invalidStyles","schemaItems","whiteSpaceElementsMap","selfClosingElementsMap","shortEndedElementsMap","boolAttrMap","validClasses","blockElementsMap","nonEmptyElementsMap","moveCaretBeforeOnEnterElementsMap","textBlockElementsMap","textInlineElementsMap","elements","children","patternElements","customElementsMap","specialElements","createLookupTable","option","defaultValue","extendWith","makeMap$2","toUpperCase","mapCache","extend$1","compileSchema","schema","verify_html","valid_elements","compileElementMap","valid_styles","invalid_styles","valid_classes","each$4","special","split","name","RegExp","patternToRegExp","str","addValidElements","validElements","ei","el","ai","al","element","attr","attrData","elementName","attrName","attrType","attributes","attributesOrder","prefix","outputName","globalAttributes","globalAttributesOrder","elementRuleRegExp","attrRuleRegExp","hasPatternsRegExp","exec","paddEmpty","removeEmpty","removeEmptyAttrs","attributesRequired","required","inArray$1","attributesDefault","attributesForced","forcedValue","validValues","test","attributePatterns","pattern","setValidElements","addCustomElements","customElements","customElementRegExp","text_block_elements","block_elements","rule","inline","cloneName","customRule","elmName","addValidChildren","validChildren","childRuleRegExp","getElementRule","item","custom_elements","valid_children","extended_valid_elements","dd","dt","li","td","th","tr","tbody","thead","tfoot","legend","area","param","parents","parentsRequired","invalid_elements","explode$1","getValidStyles","getInvalidStyles","getValidClasses","getBoolAttrs","getBlockElements","getTextBlockElements","getTextInlineElements","getShortEndedElements","getSelfClosingElements","getNonEmptyElements","getMoveCaretBeforeOnEnterElements","getWhiteSpaceElements","getSpecialElements","isValidChild","toLowerCase","isValid","attrPatterns","getCustomElements","Styles","encodingItems","rgbRegExp","urlOrStrRegExp","styleRegExp","trimRightRegExp","encodingLookup","toHex","color","parse","css","isEncoded","styles","urlConverter","url_converter","urlConverterScope","url_converter_scope","compress","suffix","noJoin","top","right","bottom","left","box","join","canCompress","encode","decode","keepSlashes","decodeSingleHexSequence","escSeq","String","fromCharCode","decodeHexSequences","processUrl","url2","url3","str2","allow_script_urls","scriptUrl","allow_svg_data_urls","lastIndex","index","target","c","border","serialize","serializeStyles","styleList","l","styleMap","DOMUtils","doc","_this","attrHooks","addedStyles","win","window","files","counter","styleSheetLoader","boundEvents","events","ownEvents","EventUtils","proxy","Event","$","DomQuery","overrideDefaults","self","getRoot","isBlock","nodeName","elm","getElementById","getElementsByName","$$","getAttrib","defaultVal","hook","$elm","getAttribs","setAttrib","originalValue","set","onSetAttrib","attrElm","attrValue","clone","deep","isIE","cloneNode","clone_1","each$5","root_element","body","getViewPort","argWin","actWin","rootElm","documentElement","x","pageXOffset","scrollLeft","y","pageYOffset","scrollTop","w","innerWidth","clientWidth","h","innerHeight","clientHeight","getPos","Position","setStyle","update_styles","updateInternalStyleAttr","setStyles","stylesArg","getStyle","computed","Env","ie","undefined","getSize","offsetWidth","offsetHeight","getRect","pos","size","is","Array","isArray","simpleSelectorRe","selectors","elms","ownerDocument","getParents","root","collect","selectorVal","getParent","_findSib","func","getNext","getPrev","select","scope","run","setAttribs","attrs","each","setHTML","html","canHaveHTML","firstChild","removeChild","innerHTML","contents","appendTo","add","parentElm","create","newElm","Entities","encodeAllRaw","createHTML","outHtml","hasOwnProperty","createFragment","container","frag","createDocumentFragment","remove","keepChildren","$node","data","insertBefore","toArray","removeAllAttribs","e","removeAttributeNode","parseStyle","cssText","serializeStyle","addStyle","head","styleElm","DOM","createTextNode","loadCSS","toggleClass","cls","className","addClass","removeClass","hasClass","show","hide","isHidden","uniqueId","getOuterHTML","NodeType","isElement","outerHTML","append","setOuterHTML","insertAfter","reference","referenceNode","oldElm","grep$1","childNodes","replaceChild","rename","attrNode","findCommonAncestor","pe","ps","rgbVal","trim","isEmpty","whitespace","walker","brCount","bogusVal","getAttribute","whiteSpaceRegExp$2","nodeValue","createRng","createRange","splitElm","replacementElm","bef","aft","pa","setStart","findNodeIndex","setEnd","extractContents","TrimNode","trimNode","bind","unbind","fire","evt","getContentEditable","contentEditable","getContentEditableParent","destroy","setDocument","isChildOf","dumpRng","startContainer","startOffset","endContainer","endOffset","stdMode","boxModel","nodeIndex","setupAttrHooks","AddOnManager","items","lookup","_listeners","instance","dependencies","requireLangPack","languages","language","languageLoad","substr","ScriptLoader","addOn","listener","each$7","callback","createUrl","baseUrl","dep","resource","addComponents","pluginName","scripts","pluginUrl","script","loadDependencies","addOnUrl","deps","newUrl","urlString","baseURL","substring","lastIndexOf","waitFor","ClosestOrAncestor","ancestor","isRoot","Option","some","isFunction","none","__rest","s","t","p","Object","prototype","getOwnPropertySymbols","propertyIsEnumerable","__spreadArrays","il","k","jl","CaretPosition","offset","clientRects","isAtStart","isText$4","isAtEnd","toRange","range","getClientRects","getCaretPositionClientRects","isVisible","isEqual","caretPosition","getNode","before","resolveIndex","Annotator","editor","registry","create$1","setup$1","changes","setup","register","annotate","annotateWithBookmark","annotationChanged","addListener","identify","_a","unwrap","getAll","directory","findAll","map$2","dom","Writer","indent","indentBefore","indentAfter","htmlOutput","makeMap$3","indent_before","indent_after","getEncodeFunc","entity_encoding","entities","element_format","start","empty","end","text","raw","cdata","comment","pi","doctype","reset","getContent","HtmlSerializer","writer","validate","handlers","3","8","7","10","4","11","walk","sortedAttrs","elementRule","handler","shortEnded","inner","EditorCommands","selection","formatter","bookmark","commands","on","execCommand","command","ui","args","customCommand","removed","skip_focus","SelectionBookmark","restore","focus","isDefaultPrevented","each$a","plugins","theme","getDoc","queryCommandState","quirks","queryCommandValue","addCommands","commandList","addCommand","queryCommandSupported","addQueryStateHandler","addQueryValueHandler","extend$2","hasCustomCommand","execNativeCommand","isFormatMatch","toggleFormat","toggle","nodeChanged","storeSelection","getBookmark","restoreSelection","moveToBookmark","undoManager","queryCommandEnabled","msg","translate","mac","notificationManager","open","isCollapsed","getStart","align","listElm","listParent","fontNameAction","fontSizeAction","setContent","getBody","InsertContent","insertAtCaret","content","handle","hasVisual","addVisual","format","anchor","editingHost","isContentEditableTrue","rng","selectNodeContents","setRng","DeleteCommands","deleteCommand","forwardDeleteCommand","InsertBr","insert","alignStates","nodes","getSelectedBlocks","map$3","matchNode","inArray$2","inline_styles","paddingLeft","getEnd","list","tagName","Undo","undo","Redo","redo","fontNameQuery","fontSizeQuery","Shortcuts","shortcuts","pendingPatterns","parseShortcut","shortcut","each$b","explode$2","modifierNames","keyCode","charCode","charCodeAt","keyCodeLookup","access","alt","ctrl","meta","createShortcut","desc","cmdFunc","extend","subpatterns","hasModifier","altKey","ctrlKey","metaKey","isFunctionKey","matchShortcut","shiftKey","preventDefault","executeShortcutAction","cmd","NotificationManagerImpl","unimplemented","Error","close","reposition","getArgs","NotificationManager","notifications","getImplementation","getNotificationManagerImpl","getTopNotification","from","progressBar","timeout","addNotification","notification","closeNotification","findIndex","otherNotification","EditorView","isEditorAttachedToDom","getOrThunk","editorManager","setActive","getNotifications","serviceMessage","service_message","icon","requestAnimationFrame","WindowManagerImpl","alert","confirm","getParams","setParams","WindowManager","windows","getWindowManagerImpl","funcBind","f","fireOpenEvent","fireCloseEvent","addWindow","closeWindow","otherWindow","getTopWindow","params","store","message","getOr","getWindows","XMLHttpRequest","Global$1","getOrDie","Uploader","uploadStatus","pendingPromises","pathJoin","path1","path2","defaultHandler","blobInfo","progress","xhr","formData","withCredentials","credentials","upload","onprogress","loaded","total","json","JSON","responseText","location","basePath","FormData","blob","filename","send","noUpload","promiseObj","handlerSuccess","handlerFailure","resolvePending","blobUri","uploadBlobInfo","openNotification","markPending","noop","closeNotification_1","markUploaded","removeFailed","percent","isDefaultHandler","pendingUploadBlobInfo","uploadBlobs","blobInfos","grep","isUploaded","isPending","FileReader","Uint8Array","arr","ImageScanner","blobCache","cachedPromises","predicate","images","getAllImages","img","src","fileApi","hasAttribute","transparentSrc","promises","then","imageInfo","image","newPromise","reject","imageToBlobInfo","catch","BlobCache","mimeToExt","mime","o","base64","isString","toBlobInfo","isObject","Uuid","uuid","URL","createObjectURL","uri","findFirst","cachedBlobInfo","getByUri","removeByUri","revokeObjectURL","UploadStatus","blobUriStatuses","createStatus","resultUri","hasBlobUri","getResultUri","EditorUpload","uploader","imageScanner","urlFilters","aliveGuard","cacheInvalidator","replaceString","search","replaceImageUrl","targetUrl","replacementUrl","replaceUrlInUndoStack","level","fragments","fragment","replaceImageUri","Settings","shouldReuseFileName","convertURL","uploadImages","getImageUploadUrl","getImageUploadBasePath","getImagesUploadCredentials","getImagesUploadHandler","scanForImages","imageInfos","filteredResult","uploadInfo","shouldReplaceBlobUris","ErrorReporter","uploadError","uploadImagesAuto","isAutomaticUploadsEnabled","isValidDataUriImage","imgElm","forall","getImagesDataImgFilter","addFilter","resultItem","displayError","removeAttribute","replaceBlobUris","foldl","editorUpload","source_view","parser","addNodeFilter","NodeChange","lastRng","lastPath","isSameElementPath","startElm","currentPath","parentsUntil","nativeRng","fakeRng","getRng","RangeCompare","isEq","hasAnyRanges","selectionChange","setEditorTimeout","initialized","disable_nodechange","readonly","SaxParser","fix_self_closing","endRegExp","attrList","textData","isInternalElement","removeInternalElements","shortEndedElements","fillAttrsMap","isShortEnded","isValidElement","attribsValue","validAttributesMap","validAttributePatterns","processHtml","anyAttributesRequired","selfClosing","tokenRegExp","attrRegExp","fixSelfClosing","stack","filteredUrlAttrs","makeMap","scriptUriRegExp","processEndTag","valid","parseAttribute","val2","val3","attrRule","trimRegExp","isValidPrefixAttrName","decodeURIComponent","unescape","isInvalidUri","self_closing_elements","remove_internals","charAt","bogusValue","checkBogusAttribute","findEndTagIndex","allow_conditional_comments","trimComments","UndoManager","beforeBookmark","isFirstTypedCharacter","locks","isUnlocked","setTyping","typing","setDirty","addNonTypingUndoLevel","endTyping","beforeChange","Levels","createFromEditor","isDirty","lastLevel","modKey","isInsertReplacementText","event","inputType","isInsertTextDataNull","addShortcut","GetBookmark","getUndoBookmark","currentLevel","originalEvent","custom_undo_redo_levels","applyToEditor","clear","hasUndo","hasRedo","transact","ignore","extra","callback1","callback2","FormatRegistry","formats","mixed","block_expand","classes","unregister","DefaultFormats","Formatter","formatChangeState","Cell","FormatShortcuts","setup$2","ApplyFormat","applyFormat","RemoveFormat","ToggleFormat","MatchFormat","matchAll","canApply","formatChanged","FormatChanged","getCssText","Preview","DomParser","nodeFilters","attributeFilters","matchedNodes","matchedAttributes","root_name","fixInvalidChildren","ni","newParent","currentNode","tempNode","childNode","nonEmptyElements","whitespaceElements","nonSplitableElements","textBlockElements","nextNode","makeMap$4","fixed","reverse","filterNode","isEmpty$2","hasOnlyChild","wrap","Node$1","each$i","explode$3","getNodeFilters","out","addAttributeFilter","getAttributeFilters","fi","fl","blockElements","isInWhiteSpacePreservedElement","invalidChildren","extend$3","rootBlockName","forced_root_block","whiteSpaceElements","startWhiteSpaceRegExp","endWhiteSpaceRegExp","allWhiteSpaceRegExp","isAllWhiteSpaceRegExp","createNode","removeWhitespaceBefore","textNode","textNodeNext","textVal","SaxParser$1","input","output","isLineBreakNode","lastChild","newNode","attrFiltersLen","isPaddedWithNbsp","paddEmptyNode","invalid","isRootContent","rootBlockNode","forced_root_block_attrs","register$2","LegacyFilter","DomSerializer","htmlParser","tempAttrs","DOMUtils$1","remove_trailing_brs","DomSerializerFilters","parserArgs","merge","targetNode","DomSerializerPreProcess","process","getHtmlFromNode","parseHtml","toHtml","addRules","rules","setRules","addTempAttr","getTempAttrs","DomSerializer$1","domSerializer","BookmarkManager","Bookmarks","Quirks","BACKSPACE","VK","DELETE","isGecko","gecko","isWebKit","webkit","mceInternalDataType","setEditorCommandState","setMceInternalContent","selectionHtml","internalContent","dataTransfer","escape","setData","getMceInternalContent","getData","insertClipboardContents","internal","selectAll","disableBackspaceIntoATable","previousSibling","bodyHeight","contentStyles","normalize","refreshContentEditable","sel","getSel","rangeCount","collapsed","serializeRng","cloneContents","serializer","allContentsSelected","allRng","selectNode","setCursorLocation","windowsPhone","modifierPressed","content_editable","isCaretContainer","placeCaretAt","clientX","clientY","iOS","activeElement","getWin","CaretRangeFromPoint","fromPoint","Range","body_1","blur","getAttributeApplyFunction","template","setAttributeNode","isSelectionAcrossElements","applyAttributes","setOpts","object_resizing","fixLinks","metaKeyPressed","modify","RangeUtils","RangeWalk","SplitRange","NormalizeRange","normalizedRng","opera","ie11","ie12","iDevice","android","phone","tablet","fa","fb","not","die","never","always","NONE","eq","isNone","thunk","n","me","isSome","getOrNull","getOrUndefined","or","orThunk","exists","equals","equals_","toString","freeze","constant_a","v","elementEq","typeOf","isPrototypeOf","constructor","isType","isNull","isBoolean","isNumber","nativeSlice","nativeIndexOf","nativePush","rawIndexOf","ts","xs","contains","pred","eachr","foldr","acc","flatten","difference","a1","a2","mapToObject","sort","comparator","copy","last","from$1","Global","Function","path","unsafe","actual","u","nav","matchMediaQuery","query","matchMedia","appName","requestAnimationFramePromise","caretAfter","getSelection","documentMode","ceFalse","cacheSuffix","overrideViewPort","experimentalShadowDom","canHaveCSP","desktop","Promise","thisArg","deferred","_state","_deferreds","asap","cb","onFulfilled","onRejected","_value","ret","newValue","TypeError","doResolve","finale","Handler","reason","immediateFn","setImmediate","res","val","remaining","race","values","requestAnimationFrameFunc","vendors","featurefill","wrappedSetTimeout","time","wrappedSetInterval","setInterval","wrappedClearTimeout","clearTimeout","wrappedClearInterval","clearInterval","debounce","timer","stop","setEditorInterval","throttle","mouseEventRe","deprecated","keyLocation","layerX","layerY","returnValue","webkitMovementX","webkitMovementY","keyIdentifier","hasIsDefaultPrevented","returnTrue","returnFalse","addEvent","capture","addEventListener","attachEvent","removeEvent","removeEventListener","detachEvent","getTargetFromShadowDom","defaultTarget","composedPath","fix","srcElement","pageX","eventDoc","clientLeft","pageY","clientTop","stopPropagation","isPropagationStopped","cancelBubble","stopImmediatePropagation","isImmediatePropagationStopped","bindOnReady","eventUtils","domLoaded","isDocReady","readyState","readyHandler","waitForDomLoaded","tryScroll","doScroll","count","hasFocusIn","hasMouseEnterLeave","mouseEnterLeave","mouseenter","mouseleave","executeHandlers","callbackList","names","fakeName","nativeHandler","defaultNativeHandler","related","currentTarget","relatedTarget","ci","eventMap","defaultView","parentWindow","clean","cancel","support","getText","isXML","tokenize","compile","sortInput","hasDuplicate","docElem","documentIsHTML","rbuggyQSA","rbuggyMatches","contains$1","preferredDoc","classCache","tokenCache","compilerCache","sortOrder","hasOwn","push_native","identifier","pseudos","rcomma","rcombinators","rattributeQuotes","rpseudo","ridentifier","matchExpr","ID","CLASS","ATTR","PSEUDO","CHILD","bool","needsContext","rinputs","rheader","rnative","rquickExpr","rsibling","rescape","runescape","funescape","_","escaped","escapedWhitespace","high","els","m","groups","old","nid","newContext","newSelector","getElementsByClassName","qsa","setAttribute","querySelectorAll","qsaError","hasCompare","getById","attrId","tag","tmp","disconnectedMatch","compareDocumentPosition","adown","bup","compare","sortDetached","aup","ap","bp","unshift","expr","matchesSelector","attrHandle","getAttributeNode","specified","duplicates","detectDuplicates","sortStable","createPseudo","excess","unquoted","nodeNameSelector","operator","check","what","simple","forward","ofType","useCache","pseudo","idx","matched","has","innerText","lang","elemLang","hash","hasFocus","tabIndex","enabled","disabled","checked","selected","selectedIndex","header","button","even","odd","lt","gt","nth","radio","checkbox","file","password","submit","filters","parseOnly","soFar","preFilters","cached","token","compiled","isArray$1","obj","array","each$1","map$1","filter$1","indexOf$2","reduce","collection","iteratee","accumulator","findIndex$1","find$1","last$1","ArrUtils","whiteSpaceRegExp","delim","prop","sp","ns","cn","scn","de","createNS","onCreate","static","ext","resolve$1","explode","d","inArray","push$1","slice$1","rquickExpr$1","skipUniques","isDefined","isString$1","isWindow","fragDoc","domManipulate","targetNodes","sourceItem","getElementDocument","makeArray","wrapper","lastParent","newWrapper","numericCssMap","booleanMap","propFix","for","class","cssFix","float","cssHooks","init","whiteSpaceRegExp$1","trim$1","each$2","unique","removeAttr","camel","dashed","removeProperty","currentStyle","getComputedStyle","getPropertyValue","host","prepend","after","prependTo","replaceWith","wrapAll","wrapInner","existingClassName","classState","off","trigger","closest","docElm","getBoundingClientRect","object","until","firstSibling","contentDocument","contentWindow","nextUntil","prevUntil","defaults","sub","appendHooks","targetHooks","hooks","maxlength","maxLength","opacity","zoom","firstMatch","regexes","find$2","agent","major","minor","group","Number","detect","versionRegexes","cleanedAgent","unknown","Version","isBrowser","unknown$1","nu$1","version","info","isEdge","isChrome","isOpera","isFirefox","isSafari","Browser","edge","chrome","firefox","safari","isOS","unknown$2","nu$2","isWindows","isiOS","isAndroid","isOSX","isLinux","isSolaris","isFreeBSD","OperatingSystem","ios","linux","osx","solaris","freebsd","DeviceType","os","browser","isiPad","isiPhone","isAndroid3","isAndroid4","isTablet","isTouch","isPhone","iOSwebview","isWebView","detect$1","candidates","candidate","detectBrowser","browsers","detectOs","oses","UaString","contains$2","trim$2","lTrim","rTrim","normalVersionRegex","checkContains","uastring","PlatformInfo","detect$2","deviceType","PlatformDetection","detect$3","called","PlatformDetection$1","fromHtml","div","hasChildNodes","console","fromDom","fromTag","fromText","elementFromPoint","Element","DOCUMENT","Node","ATTRIBUTE_NODE","CDATA_SECTION_NODE","COMMENT_NODE","DOCUMENT_NODE","ELEMENT","DOCUMENT_TYPE_NODE","DOCUMENT_FRAGMENT_NODE","ELEMENT_NODE","TEXT","TEXT_NODE","PROCESSING_INSTRUCTION_NODE","ENTITY_REFERENCE_NODE","ENTITY_NODE","NOTATION_NODE","isType$1","isText","hasOwnProperty$1","each$3","props","tupleMap","tuple","bifilter","isSupported","inBody","rawSet","setAll","has$1","internalSet","property","setProperty","setAll$1","get$1","getUnsafeProperty","getRaw","getAllRaw","ruleName","Immutable","fields","struct","toArray$1","recurse","Recurse","documentPositionPreceding","DOCUMENT_POSITION_PRECEDING","documentPositionContainedBy","DOCUMENT_POSITION_CONTAINED_BY","ELEMENT$1","DOCUMENT$1","is$1","msMatchesSelector","webkitMatchesSelector","mozMatchesSelector","bypassSelector","childElementCount","one","querySelector","e1","e2","regularContains","d1","d2","ieContains","contains$3","rawParent","prevSibling","prevSiblings","nextSiblings","cs","childNodesCount","browser$1","firstElement","getTableCaptionDeltaY","caption","bodyTop","offsetTop","captionTop","captionHeight","offsetParent","offsetLeft","exports$1","module$1","define","require","amd","g","global","EphoxContactWrapper","code","1","defaultSetTimout","defaultClearTimeout","runTimeout","fun","cachedSetTimeout","runClearTimeout","marker","cachedClearTimeout","cleanUpNextTick","draining","currentQueue","queue","queueIndex","drainQueue","Item","nextTick","title","env","argv","versions","once","removeListener","removeAllListeners","emit","prependListener","prependOnceListener","listeners","binding","cwd","chdir","umask","2","_handled","_immediateFn","promise","_unhandledRejectionFn","setTimeoutFunc","prom","err","warn","_setImmediateFn","_setUnhandledRejectionFn","clearImmediate","Timeout","clearFn","_id","_clearFn","immediateIds","nextImmediateId","unref","ref","enroll","msecs","_idleTimeoutId","_idleTimeout","unenroll","_unrefActive","active","_onTimeout","promisePolyfill","boltExport","namedEntities","baseEntities","reverseEntities","nu$3","baseFn","nCallback","isReady","cbs","pure","LazyValue","errorReporter","make","fab","aFutureB","toPromise","anonBind","futureB","toLazy","toCached","nu$4","pure$1","par","asyncValues","asyncValue","futures","opt","mapError","onValue","toOption","isError","onError","fromOption","blocks","voids","tableCells","tableSections","textBlocks","headings","listItems","lists","wsElements","lazyLookup","isHeading","isInline","isBr","isTextBlock","isList","isListItem","isVoid","isTableSection","isTableCell","isWsPreserveElement","isNodeType","isRestrictedNode","getPrototypeOf","isElement$1","matchNodeNames","matchStyleValues","hasPropValue","propName","propValue","hasAttributeValue","isBogus","isBogusAll","isTable","hasContentEditableState","isText$1","isComment","isDocument","isDocumentFragment","isBr$1","isContentEditableFalse","surroundedBySpans","previousIsSpan","nextIsSpan","isBookmarkNode","trimmedLength","makeMap$1","attrsCharsRegExp","textCharsRegExp","rawCharsRegExp","entityRegExp","asciiMap","128","130","131","132","133","134","135","136","137","138","139","140","142","145","146","147","148","149","150","151","152","153","154","155","156","158","159","'","nativeDecode","buildEntitiesLookup","radix","chr","entity","encodeRaw","encodeNumeric","encodeNamed","entitiesMap","encodeNamedAndNumeric","encodeCustomNamed","nameMap","named","numeric","dummyObj","blockContent","phrasingContent","flowContent","html4BlockContent","html4PhrasingContent","arrayToMap","addAttrs","schemaItem","table","mode","hex","getContext","keepValues","keep_values","keepUrlHook","rawValue","normalized","lastNodeType","each$6","grep$2","isFunction$1","states","scriptLoadedCallbacks","queueLoadedCallbacks","loading","loadScript","onreadystatechange","log","isDone","markDone","loadQueue","loadScripts","failures","execCallbacks","loadingScripts","notifyCallbacks","PluginManager","ThemeManager","wrap$1","before$1","append$1","rogue","remove$1","children$1","rate","last$2","initial","read","remove$2","supports","classList","get$2","add$1","clazz","remove$3","add$2","cleanClass","remove$4","has$2","descendants","descendants$1","ancestor$1","descendant","closest$1","annotation","dataAnnotation","dataAnnotationId","annotationName","an","newStart","getAttr","uid","findMarkers","isAnnotation","markers","nodesAlready","changeCallbacks","initData","previous","withCallbacks","updateCallbacks","callbackMap","outputData","fireCallbacks","fireNoAnnotation","onNodeChange","annotations","identifyParserNode","span","spans","persistent","__assign","assign","generate","date","floor","add$3","original","isDeep","fromHtml$1","get$3","set$1","owner$1","docDom","contentElements","isZwsp","trim$3","Zwsp","ZWSP","isElement$2","isText$2","isCaretContainerBlock","isCaretContainerInline","hasContent","insertInline","endsWithCaretContainer","splitText","startsWithCaretContainer","isBeforeInline","isAfterInline","createBogusBr","br","insertBlock","blockName","blockNode","trimBogusBr","brs","lastBr","showCaretContainerBlock","caretContainer","isRangeInCaretContainerBlock","isContentEditableTrue$1","isContentEditableFalse$1","isBr$2","isText$3","isInvalidTextElement","isAtomicInline","isTable$1","isCaretContainer$1","isCaretCandidate","isNonUiContentEditableFalse","isUnselectable","isInEditable","isAtomicContentEditableFalse","isAtomic","isEditableCaretCandidate","round","clone$1","rect","width","height","collapse","toStart","rect1","rect2","isValidOverflow","overflowY","min","isAbove","halfHeight","isBelow","containsXY","overflowX","outer","getOverflow","getSelectedNode","extendingChars","isExtendingChar","ch","lift2","oa","ob","lift3","oc","slice$2","and","Predicate","isElement$3","isCaretCandidate$1","isBlock$1","isFloated","isValidElementCaretCandidate","isNotPre","isBr$3","isWhiteSpace","isRange","isHiddenWhiteSpaceRange","getBrClientRect","brNode","clientRect","nbsp","getBoundingClientRectWebKitText","sc","ec","so","eo","newRng","cloneRange","setEndAfter","isZeroRect","collapseAndInflateWidth","newClientRect","beforeNode","addUniqueAndValidRect","addCharacterOffset","fromRangeStart","fromRangeEnd","pos1","pos2","isTextPosition","isElementPosition","HDirection","CaretPosition$1","isText$5","isBogus$1","nodeIndex$1","normalizedParent","getChildNodes","normalizedTextOffset","equal","normalizedNodeIndex","numTextFragments","createPathItem","create$2","outputOffset","resolvePathItem","findTextPosition","dataLen","targetOffset","resolve$2","trimEmptyTextNode","insertNode","insertFragment","rangeInsertNode","isContentEditableFalse$2","getNormalizedTextOffset","trimmedOffset","getPoint","point","max","getLocation","findIndex$2","moveEndPoint","normalizeTableCellSelection","findAdjacentContentEditableFalseElm","getOffsetBookmark","getCaretBookmark","getRangeBookmark","createBookmarkSpan","filled","getPersistentBookmark","rng2","endBookmarkNode","startBookmarkNode","keep","isCaretNode","getParentCaretContainer","isElement$4","isText$6","removeNode","getNodeValue","setNodeValue","trimCount","trimmedText","removeUnchanged","remove$5","removeTextAndReposition","removeElementAndReposition","newPosition","removeTextCaretContainer","removeElementCaretContainer","removeAndReposition","caretContainerNode","CaretContainerRemove","browser$2","isContentEditableFalse$3","isTableCell$1","getAbsoluteClientRect","scrollX","scrollY","margin","rootRect","trimInlineCaretContainers","contentEditableFalseNodes","deleteData","FakeCaret","cursorInterval","lastVisualCaret","caret","caretState","startBlink","getCss","isFakeCaretTableBrowser","isFakeCaretTarget","isContentEditableFalse$4","isBlockLike","isCaretContainer$2","isCaretContainerBlock$1","isElement$5","isCaretCandidate$2","isForwards","direction","isBackwards","skipCaretContainers","findNode","predicateFn","getParentBlock","isInSameBlock","caretPosition1","caretPosition2","getChildNodeAtRelativeOffset","relativeOffset","beforeAfter","setStartBefore","setEndBefore","setStartAfter","isNodesInSameBlock","node1","node2","lean","before$2","after$1","normalizeRange","leanLeft","leanRight","getRelativeCefElm","getNormalizedRangeEndPoint","normalizedRange","getElementFromPosition","getElementFromPrevPosition","getVisualCaretPosition","walkFn","isMoveInsideSameBlock","to","inSameBlock","isContentEditableFalse$5","isText$7","isElement$6","isBr$4","isCaretCandidate$3","isAtomic$1","isEditableCaretCandidate$1","nodeAtIndex","getCaretCandidatePosition","moveForwardFromBr","findCaretPosition","Forwards","startPos","innerNode","rootContentEditableFalseElm","CaretWalker","Backwards","walkToPositionIn","position","fromPosition","afterElement","isBeforeOrStart","isAfterOrEnd","isBeforeAfterSameElement","isAtBr","shouldSkipPosition","navigate","navigateIgnore","ignoreFilter","positionIn","nextPosition","prevPosition","CaretFinder","firstPositionIn","lastPositionIn","isStringPathBookmark","isRangeBookmark","isIdBookmark","isIndexBookmark","isPathBookmark","addBogus","resolveCaretPositionBookmark","insertZwsp","tryFindRangePosition","padEmptyCaretContainer","setEndPoint","isValidTextNode","restoreEndPoint","appendData","o1","o2","resolvePaths","resolveId","endPos","spos","epos","resolveIndex$1","resolve$3","ResolveBookmark","getBookmark$1","isBookmarkNode$1","isInlineBlock","moveStart","isWhiteSpaceNode","getNonWhiteSpaceSibling","inc","isTextBlock$1","ed","replaceVars","vars","str1","normalizeStyleValue","getTextDecoration","decoration","getParents$1","FormatUtils","isBookmarkNode$2","getParents$2","isWhiteSpaceNode$1","isTextBlock$2","findLeaf","excludeTrailingWhitespace","leaf","isBogusBr","findParentContentEditable","findSpace","findWordEndPoint","lastTextNode","findSelectorEndPoint","curFormat","findBlockEndPoint","block","scopeRoot","findParentContainer","expandRng","endPoint","expand","ExpandRange","each$8","getEndChild","walk$1","startPoint","siblings","exclude","collectSiblings","endNode","findEndPoint","walkBoundary","api","getOption","get$4","isZeroWidth","wrapName","shouldApplyToTrailingSpaces","applyWordGrab","makeAnnotation","eDoc","decorate","_b","master","_c","_d","_e","newWrappers","finishWrapper","getOrOpenWrapper","processElements","processElement","processNodes","initialRng","hasOnlyOneChild","isPaddingNode","isPaddedEmptyBlock","isEmptyFragmentElement","isListFragment","cleanupDomFragment","domFragment","toDomFragment","listItems$1","isPadding","isListItemPadded","isEmptyOrPadded","trimListItems","getParentLi","parentBlock","isParentBlockLi","getSplit","beforeRng","afterRng","findFirstIn","caretPos","caretWalker","newCaretPos","findLastOf","insertMiddle","liTarget","liElms","isAt","newPos","InsertList","each$9","ElementUtils","attribs","compareObjects","obj1","obj2","getLastChildren","rawNode","removeTrailingBr","allBrs","fillWithPaddingBr","isPaddingContents","isPaddedElement","trimBlockTrailingBr","lastChildPrevSibling","PaddingBr","createRange$1","normalizeBlockSelectionRange","commonAncestorContainer","newEndPos","RangeNormalizer","isAfterNbsp","trimOrPadLeftRight","hasSiblingText","trimNbspAfterDeleteAndPadValue","isTableCell$2","selectionSetContent","insertData","validInsertion","trimBrsFromTableCell","reduceInlineTextElements","textInlineElements","root_1","elementUtils_1","testNode","markFragmentElements","umarkFragmentElements","isPartOfFragment","canHaveChildren","moveSelectionToMarker","parentEditableFalseElm","nextRng","scrollIntoView","insertHtmlAtCaret","details","bookmarkHtml","paste","caretElement","parentElement","_selectionOverrides","showBlockCaretContainer","processValue","insertAtCaret$1","strongRtl","hasStrongRtl","getBodySetting","getParam","bodyObj","getIframeAttrs","getDocType","getDocumentBaseUrl","getBodyId","getBodyClass","getContentSecurityPolicy","shouldPutBrInPre","getForcedRootBlock","getForcedRootBlockAttrs","getBrNewLineSelector","getNoNewLineSelector","shouldKeepStyles","shouldEndContainerOnEmptyBlock","getFontStyleValues","getFontSizeClasses","shouldUseContentCssCors","getInlineBoundarySelector","isInlineTarget","isRtl","findInlineParents","findRootInline","hasSameParentBlock","block1","block2","isAtZwsp","normalizePosition","normalizeForwards","normalizeBackwards","InlineUtils","isBeforeRoot","getParentBlock$1","placeCaretInEmptyBody","paddEmptyBody","willDeleteLastPositionInElement","fromPos","firstPos","lastPos","normalizedFirstPos","normalizedLastPos","normalizedFromPos","nextPos","prevPos","DeleteUtils","ancestor$2","hasWhitespacePreserveParent","rootElement","isWhitespace","isNamedAnchor","isContent","isBookmark","isBogus$2","isBogusAll$1","isEmptyNode","isEmpty$1","Empty","BlockPosition","BlockBoundary","getBlockPosition","containerElm","isDifferentBlocks","blockBoundary","hasSameParent","parent1","parent2","isEditable","skipLastBr","blockPosition","lastPositionInBlock","readFromRange","fromBlockPos","toBlockPos","blockPos","read$1","BlockMergeBoundary","dropLast","parentsUntil$1","parents$1","parentsAndSelf","Parents","getChildrenUntilBlockBoundary","extractChildren","removeEmptyRoot","isEmptyBefore","nestedBlockMerge","fromBlock","toBlock","insertionPoint","sidelongBlockMerge","findInsertionPoint","getInsertionPoint","trimBr","mergeBlockInto","mergeBlocks","MergeBlocks","backspaceDelete","BlockBoundaryDelete","deleteRangeMergeBlocks","deleteContents","isRawNodeInTable","isSelectionInTable","isEverythingSelected","noPrevious","noNext","emptyEditor","deleteRange","backspaceDelete$1","BlockRangeDelete","generate$1","cases","constructors","adt","acase","keys$1","argLength","branches","branchKeys","reqKey","label","Adt","isBr$5","findBr","parentBlocks","isBeforeBr","isAfterBr","findPreviousBr","findNextBr","isNbsp","expected","isWhiteSpace$1","isContent$1","isChar","delta","isBeforeSpace","isAfterSpace","isEmptyText","isNextToContentEditableFalse","isBeforeContentEditableFalse","isAfterContentEditableFalse","isNextToTable","isBeforeTable","isAfterTable","isCompoundElement","DeleteAction","moveToElement","moveToPosition","isAtContentEditableBlockCaret","caretLocation","isDeleteFromCefDifferentBlocks","deleteEmptyBlockOrMoveToCef","toCefElm","blockElm","findCefPosition","getContentEditableBlockAction","skipMoveToActionFromInlineCefToContent","deleteAction","getContentEditableAction","read$2","isCollapsibleWhitespace","normalizeContent","isStartOfContent","isEndOfContent","previousCharIsSpace","normalize$1","replaceData","normalizeWhitespaceAfter","whitespaceCount","normalizeWhitespaceBefore","mergeTextNodes","prevNode","normalizeWhitespace","whitespaceOffset","needsReposition","beforeOrStartOf","afterOrEndOf","getPreviousSiblingCaretPosition","getNextSiblingCaretPosition","findCaretPositionBackwardsFromElm","startPosition","findCaretPositionForwardsFromElm","findCaretPositionBackwards","findCaretPositionForward","findCaretPosition$1","findCaretPosOutsideElmAfterDelete","setSelection","eqRawNode","isBlock$2","paddEmptyBlock","deleteNormalized","afterDeletePosOpt","prevTextOpt","nextTextOpt","isInlineElement","deleteElement","moveCaret","afterDeletePos","normalizedAfterDeletePos","paddPos","DeleteElement","deleteElement$1","hideFakeCaret","backspaceDeleteCaret","deleteOffscreenSelection","backspaceDeleteRange","selectedElement","getContentEditableRoot","paddEmptyElement","ceRoot","backspaceDelete$2","CefDelete","isText$8","startsWithCaretContainer$1","endsWithCaretContainer$1","createZwsp","insertBefore$1","insertAfter$1","insertInline$1","insertInlineBefore","insertInlineAfter","insertInlinePos","isPosCaretContainer","caretNode","renderCaret","BoundaryCaret","evaluateUntil","fns","LazyEvaluator","Location","rescope","before$3","nPos","isNotInsideFormatCaretContainer","findInsideRootInline","after$2","isValidLocation","getElement","readLocation","getName","outside","inside","isEq$1","location1","location2","betweenInlines","fromInline","toInline","skipNoMovement","fromLocation","toLocation","findLocationTraverse","findLocationSimple","findLocation","BoundaryLocation","prevLocation","nextLocation","hasSelectionModifyApi","moveRel","moveByWord","WordSelection","setCaretPosition","isFeatureEnabled","inline_boundaries","setSelected","renderCaretLocation","findLocation$1","toggleInlines","selectedInlines","targetInlines","safeRemoveCaretContainer","composing","renderInsideInlineCaret","inlines","move","moveWord","setupSelectedState","moveNextWord","movePrevWord","BoundarySelection","isFeatureEnabled$1","rangeFromPositions","hasOnlyTwoOrLessPositionsLeft","setCaretLocation","deleteFromTo","rescope$1","backspaceDeleteCollapsed","toPosition","backspaceDelete$3","InlineBoundaryDelete","tableCellRng","tableSelection","removeTable","emptyCells","isRootFromElement","getClosestCell","getClosestTable","cell","isExpandedCellRng","cellRng","getTableFromCellRng","startParentTable","endParentTable","getTableCells","getCellRangeFromStartTable","endCell","partialSelection","startCell","isWithinSameTable","getCellRng","getTableSelectionFromCellRng","getTableSelectionFromRng","getCellIndex","cells","getSelectedCells","startIndex","endIndex","getAction","getActionFromCells","getActionFromRange","TableDeleteAction","getRanges","ranges","getRangeAt","getSelectedNodes","hasMultipleRanges","MultiRange","getCellsFromRanges","getCellsFromElement","getCellsFromElementOrRanges","selectedCells","rangeCells","getCellsFromEditor","TableCellSelection","deleteTableElement","deleteCellRange","action","deleteCaptionRange","emptyElement","deleteTableRange","getParentCaption","deleteRange$1","getParentCell","deleteBetweenCells","fromCell","toCell","isDeleteOfLastCharPos","fromCaption","emptyCaretCaption","validateCaretCaption","toCaption","deleteCaretInsideCaption","deleteCaretCells","deleteCaretCaption","deleteCaret","backspaceDelete$4","TableDelete","isEq$2","matchesUnInheritedFormatSelector","formatList","inherit","matchParents","matchName","matchItems","itemName","similar","onmatch","exact","startElement","matchedFormatNames","checkedMap","defaultBlock","split$1","ZWSP$1","importNode","getEmptyCaretContainers","isCaretContainerEmpty","findFirstTextNode","createCaretContainer","fill","trimZwspFromCaretContainer","removeCaretContainerNode","removeCaretContainer","insertCaretContainerNode","formatNode","appendNode","insertFormatNodesIntoCaretContainer","formatNodes","innerMostFormatNode","applyCaretFormat","wordcharRegex","removeCaretFormat","hasContentAfter","expandedRng","newCaretContainer","disableCaretContainer","replaceWithCaretFormat","innerMost","isFormatElement","isEmptyCaretFormatElement","getParentInlines","hasOnlyOneChild$1","deleteLastPosition","parentInlines","isFormatElement$1","deleteCaret$1","backspaceDelete$5","InlineFormatDelete","getPos$1","fireScrollIntoViewEvent","alignToTop","scrollEvent","scrollElementIntoView","viewPort","viewPortY","viewPortH","offsetY","scrollContainer","getScrollContainer","scrollTo","getViewPortRect","scrollBy","dx","dy","scrollRangeIntoView","rngRect","bodyRect","overflow","ScrollIntoView","isContentEditableTrue$2","isContentEditableFalse$6","showCaret","getNodeRange","renderCaretAtRange","caretPositionNode","caretPositionBeforeNode","renderRangeCaret","caretRange","moveToRange","trimEmptyTextNode$1","deleteContentAndShowCaret","peekCaretPosition","deleteCefBoundaryText","getNextVisualCaretPosition","getPrevVisualCaretPosition","getNextPosFn","isBeforeContentEditableFalseFn","nextCaretPosition","backspaceDelete$6","CefBoundaryDelete","nativeCommand","getSpecifiedFontProp","getProperty","round$1","number","precision","factor","pow","toPt","fontSize","normalizeFontFamily","fontFamily","getComputedFontProp","getFontProp","FontInfo","getFontSize","getFontFamily","findFirstCaretElement","isRangeAtStartOfNode","getCaretElement","fromFontSizeNumber","fontSizeNumber","fontSizes","fontClasses","isEq$3","rng1","findParent","hasParent","hasParentWithName","isTable$2","isTableCell$3","isCeFalseCaretContainer","hasBrBeforeAfter","isPrevNode","hasContentEditableFalseParent","findTextNodeRelative","isAfterNode","lastInlineElement","parentBlockContainer","normalizeEndPoint","directionLeft","normalize$2","normRng","hasRightSideContent","scrollToBr","brElm","moveSelectionToBr","extraBr","insertBrAtCaret","isAfterLastNodeInContainer","containerBlock","containerBlockName","isControlKey","insertBrBefore","insertBrAfter","hasBrAfter","isBeforeBr$1","isAnchorLink","isInsideAnchor","readInlineAnchorLocation","insertBrOutsideAnchor","anchorLocation","create$3","SimRange","cata","subject","onBefore","onOn","onAfter","situ","before$4","after$3","Situ","adt$1","domRange","exactFromRange","simRange","soffset","finish","foffset","getStart$1","startSitu","finishSitu","Selection","browser$3","clamp","normalizeRng","isOrContains","isRngInRoot","shouldStore","nativeRangeToSelectionRange","readRange","getBookmark$2","bookmarkToNativeRng","newBookmark","storeNative","indentElement","useMargin","unit","indentStyleName","styleValue","isListComponent","parentIsListComponent","getBlocksToIndent","indentUnit","indentation","indentValue","nativeEvents","Dispatcher","toggleEvent","bindings","beforeFire","bindingName","hi","isNative","customEventRootDelegates","getEventDispatcher","_eventDispatcher","toggleNativeEvent","Observable","bubble","hasEventListeners","firePreProcess","firePostProcess","fireRemove","fireDetach","fireSwitchMode","fireObjectResizeStart","fireObjectResized","Events","toggleReadOnly","controlSelection","hideResizeRect","setMode","getMode","isReadOnly","DOM$1","getEventTarget","eventName","event_root","eventRoot","isListening","hidden","fireEvent","bindEventDelegate","eventRootElm","delegate","delegates","activeEditor","editors","EditorObservable","bindPendingEventDelegates","_pendingNativeEvents","unbindAllNativeEvents","getContainer","VDirection","EditorObservable$1","sectionResult","detection","mobilePlugins","defaultMobileSettings","normalizePlugins","pluginNames","trimmedPlugins","filterMobilePlugins","extractSections","getSection","sections","sectionSettings","hasSection","getDefaultSettings","documentBaseUrl","delta_width","delta_height","popup_css","document_base_url","add_form_submit_trigger","submit_patch","add_unload_trigger","convert_urls","relative_urls","remove_script_host","visual","font_size_style_values","font_size_legacy_values","hidden_input","render_ui","convert_fonts_to_spans","ie7_compat","getExternalPlugins","overrideSettings","userDefinedExternalPlugins","external_plugins","combinePlugins","forcedPlugins","processPlugins","isTouchDevice","defaultOverrideSettings","forced_plugins","platformPlugins","combinedPlugins","isOnMobile","combineSettings","defaultSettings","extendedSettings","getEditorSettings","getFiltered","getParamObject","isArrayOf","f1","f2","f3","f4","f5","f6","f7","f8","f9","f10","f11","f12","_doc","getContentEditableHost","getCollapsedNode","getFocusInElement","normalizeSelection","focusBody","hasElementFocus","hasIframeFocus","iframeElement","hasInlineFocus","rawBody","hasFocus$1","focusEditor","contentEditableHost","activateEditor","bookmarkRng","skipFocus","EditorFocus","getProp","getComputedSizeProp","getClientWidth","getClientHeight","getMarginTop","getMarginLeft","getBoundingClientRect$1","isInsideElementContentArea","bodyElm","transpose","isXYInContentArea","targetElm","transposedPoint","fromDomSafe","rawContainer","getContentAreaContainer","I18n","setCode","newCode","rtl","_dir","getCode","langData","getLangData","values_1","$1","$2","resolvePluginName","pluginUrlToMessage","plugin","displayNotification","_skinLoaded","pluginLoadError","pluginInitError","initError","PluginManager$1","requestAnimationFrame$1","atob","Window","blobUriToBlob","rejectWithError","responseType","response","parseDataUri","uriParts","dataUriToBlob","Blob","uriToBlob","blobToDataUri","reader","onloadend","readAsDataURL","Conversions","dataUri","count$1","rnd","isBlockElement","isValidTarget","hasBlockParent","shouldRemoveTextNode","addRootBlocks","wrapped","rootNodeName","forcedRootBlock","setup$3","ForceBlocks","getStartNode","getEndNode","getFirstChildren","getLastChildren$1","hasAllContentsSelected","moveEndPoint$1","DOWN","ENTER","LEFT","RIGHT","SPACEBAR","TAB","UP","END","HOME","getNodeClientRects","toArrayWithNode","findUntil","walkUntil","isAboveFn","isBeflowFn","targetClientRect","line","aboveLineNumber","lineNumber","isLineNumber","upUntil","Up","downUntil","Down","positionsUntil","isBelowFn","getClientRect","isAboveLine","isLine","isContentEditableFalse$7","findNode$1","distanceToRectLeft","abs","distanceToRectRight","isInside","findClosestClientRect","oldClientRect","oldDistance","newDistance","walkUntil$1","findLineNodeRects","targetNodeRect","checkPosFn","lineRects","getFakeCaretTargets","caretInfo","closestCaret","closestNodeRect","contentEditableFalseNodeRects","targetNodeRects","isXYWithinRange","RangePoint","getAbsolutePosition","getBodyPosition","getScrollPosition","getBodyScroll","inlineScroll","iframeScroll","getMousePosition","iframePosition","scrollPosition","calculatePosition","bodyPosition","mousePosition","calc","MousePosition","isContentEditableFalse$8","isContentEditableTrue$3","isDraggable","isValidDropTarget","targetElement","dragElement","cloneElement","cloneElm","createGhost","clonedElm","ghostElm","padding","boxSizing","appendGhostToBody","moveGhost","maxX","maxY","removeElement","isLeftMouseButtonPressed","hasDraggableElement","applyRelPos","relX","start$1","ceElm","elmPos","screenX","screenY","scrollWidth","scrollHeight","relY","ghost","move$1","throttledPlaceCaretAt","movement","dragging","targetPos","getRawTarget","drop","targetClone_1","targetClone","insertContent","removeDragState","bindFakeDragEvents","pageDom","dragStartHandler","dragHandler","dropHandler","dragEndHandler","rootDocument","blockIeDrop","realTarget","DragDropOverrides","setup$4","renderFocusCaret","CefFocus","isContentEditableTrue$4","isContentEditableFalse$9","getContentEditableRoot$1","SelectionOverrides","selectedContentEditableNode","fakeCaret","realSelectionId","isFakeSelectionElement","getRealSelectionElement","setRange","getRange","blockCaretContainer","isWithinCaretContainer","isRangeInCaretContainer","normalizeShortEndedElementSelection","setContentEditableSelection","$realSelectionContainer","origTargetClone","removeAllRanges","addRange","removeContentEditableSelection","contentEditableRoot","hasNormalCaretPosition","hasBetterMouseTarget","targetBlock","caretBlock","moved","isPasteBin","clipboardData","realSelectionElement","clearData","outerText","rootClass","sanitizedText","allow_html_data_urls","regExp","attrString","findEndTag","trimHtml","trimContentRegExp","trimInternal","endTagIndex","matchLength","bogusAllRegExp","trimExternal","TrimHtml","vDown","vUp","snake","diag","buildScript","start1","end1","start2","end2","middle","getMiddleSnake","i2","buildSnake","sum","Diff","KEEP","INSERT","getOuterHtml","createFragment$1","insertAt","removeAt","applyDiff","read$3","write","currentFragments","Fragments","undoLevelDocument","lazyTempDocument","implementation","createHTMLDocument","hasIframes","createFragmentedLevel","createCompleteLevel","trimmedFragments","trimmed","getLevelContent","getCleanLevelContent","hasEqualContent","level1","level2","hasEqualCleanedContent","isEq$4","postProcessHooks","filter$2","each$c","postProcess","isPre","hasPreSibling","pre","joinPre","pre1","pre2","Hooks","MCE_ATTR_RE","each$d","isEq$5","isTableCell$4","isChildOfInlineParent","lastIdx","wrap$2","wrapWithSiblings","matchName$1","isColorFormatAndAnchor","links","find$3","removeNode$1","rootBlockElm","list_block","removeFormat","compareNode","stylesModified","remove_similar","valueOut","findFormatRoot","formatRoot","wrapAndSplit","lastClone","firstClone","formatRootParent","remove$6","splitToFormatRoot","isRemoveBookmarkNode","lastContentEditable","removeRngStyle","textDecoration","ceFalseOverride","each$e","isElementNode","findElementSibling","mergeSiblingsNodes","tmpSibling","elementUtils","processChildElements","hasStyle","applyStyle","unwrapEmptySpan","processUnderlineAndColor","mergeUnderlineAndColor","mergeBackgroundColorAndFontSize","backgroundColor","mergeSubSup","mergeSiblings","merge_siblings","clearChildStyles","clear_child_styles","mergeWithChildren","mergeWithParents","merge_with_parents","MergeFormats","each$f","isElementNode$1","setElementFormat","fmt","onformat","styleVal","applyNodeStyle","found","applyRngStyle","nodeSpecific","wrapElm","currentWrapElm","parentName","childCount","getChildElementNode","curSelNode","each$g","setup$5","formatChangeData","currentFormats","matchedFormats","addListeners","formatChangeItems","get$5","valigntop","verticalAlign","valignmiddle","valignbottom","alignleft","preview","textAlign","aligncenter","display","marginLeft","marginRight","alignright","alignjustify","bold","fontWeight","italic","fontStyle","underline","strikethrough","forecolor","hilitecolor","fontname","fontsize","fontsize_class","blockquote","subscript","superscript","removeformat","each$h","parsedSelectorToHtml","ancestry","sItem","getRequiredParent","elmRule","wrapInHtml","parentCandidate","parentRequired","ancestorName","siblingElm","selectorToHtml","parseSelector","parseSelectorItem","$0","$3","$4","previewFrag","previewElm","parentFontSize","previewStyles","previewCss","preview_styles","removeVars","parseFloat","setup$6","hasOwnProperty$2","shallow$1","merger","objects","curObject","internalName","cleanup","hasChildren","trimTrailingBr","brNode1","brNode2","preProcess","impl","oldDoc","shouldFireEvent","no_events","removeAttrs","addFontToSpansFilter","domParser","face","addStrikeToSpanFilter","addFilters","register$1","whiteSpaceRegExp$3","typeLookup","walk$2","selfAttrs","selfAttr","cloneAttrs","refNode","padd_empty_with_br","isPadded","prevName","appendRel","allow_unsafe_link_target","newRel","allow_html_in_named_anchor","fix_list_elements","classValue","validClassesMap","postProcess$1","getInner","serializeNode","BreakType","BookmarkManager$1","isContentEditableFalse$a","isContentEditableTrue$5","getContentEditableRoot$2","ControlSelection","selectedElm","selectedElmGhost","resizeHelper","resizeHandles","selectedHandle","startX","startY","selectedElmX","selectedElmY","startW","startH","ratio","resizeStarted","startScrollWidth","startScrollHeight","editableDoc","nw","ne","se","sw","isImage","isEventOnImageOutsideRange","contextMenuSelectImage","getResizeTarget","isResizable","resizeGhostElement","deltaX","deltaY","proportional","resizeHelperX","resizeHelperY","resize_img_proportional","endGhostResize","setSizeProp","showResizeRect","targetWidth","targetHeight","unbindResizeHandleEvents","handleElm","startDrag","unSelectabe","updateResizeRect","controlElm","isChildOrEqual","disableGeckoResize","isWithinContentEditableFalse","delayedSelect","throttledUpdateResizeRect","hasCeProperty","findParent$1","findClosestIeRange","rects","createTextRange","moveToElementText","moveToPoint","moveOutOfContentEditableFalse","fromPoint$1","pointDoc","caretPositionFromPoint","offsetNode","caretRangeFromPoint","processRanges","EventProcessRanges","fromElements","tableModel","tableRow","cellPosition","getSpan","isNaN","fillout","rowspan","colspan","rows","y2","x2","cellExists","skipCellsX","getWidth","row","findElementPos","extractRows","sx","sy","ey","newRows","subTable","createDomTable","tableElement","tableBody","modelRowsToDomRows","fromDom$1","tableElm","toDom","subsection","endElement","SimpleTableModel","findParentListContainer","getFullySelectedListWrappers","listCont","wrap$3","innerElm","directListWrappers","commonAnchorContainer","getWrapElements","wrapElements","listWrappers","allWrappers","emptyFragment","getFragmentFromRange","getParentTable","getTableFragment","selectedTableCells","firstCell","lastCell","fullTableModel","sectionedTableModel","getSelectionFragment","read$4","FragmentReader","getTextContent","bin","getHtmlContent","tmpElm","contextual","GetSelectionContent","setupArgs","cleanContent","contentArgs","createContextualFragment","anyRng","pasteHTML","SetSelectionContent","getEndpointElement","real","getStart$2","skipEmptyTextNodes","forwards","orig","getNode$1","endElm","selectedBlocks","select$1","each$j","isNativeIeSelection","isAttachedToDom","isValidRange","Selection$1","bookmarkManager","selectedRange","explicitRange","selectorChangedData","getEnd$1","compareEndPoints","tryCompareBoundaryPoints","how","sourceRange","destinationRange","compareBoundaryPoints","anchorNode","START_TO_START","END_TO_END","ieRange","setBaseAndExtent","focusNode","setNode","getSelectedBlocks$1","isForward","anchorRange","focusRange","anchorOffset","focusOffset","selectorChanged","currentSelectors","matchedSelectors","flip","positions","walk$3","getBreakType","currentPos","Br","Block","Wrap","getPositionsUntil","breakType","breakAt","Eol","getAdjacentLinePositions","getPositionsUntilBreak","findClosestHorizontalPositionFromPoint","lastRect","newRect","lastDist","findClosestHorizontalPosition","targetRect","getPositionsUntilPreviousLine","getPositionsUntilNextLine","isAtFirstLine","isAtLastLine","getPositionsAbove","getPositionsBelow","getFirstLinePositions","getLastLinePositions","isContentEditableFalse$b","getSelectedNode$1","moveToCeFalseHorizontally","rangeIsInContainerBlock","moveToCeFalseVertically","walkerFn","linePositions","nextLinePositions","closestNextLineRect","caretClientRect","dist1","dist2","contentEditableFalseNode","caretPositions","createTextBlock","textBlock","exitPreBlock","newBlock","getHorizontalRange","newRange","getVerticalRange","down","moveH","moveV","isCefPosition","moveToLineEndPoint","deflate","getCorners","getYAxisValue","tds","findClosestCorner","corners","newCorner","oldCorner","oldDist","sqrt","newDist","getClosestCell$1","isTargetCorner","corner","getBottomValue","getTopValue","isAbove$1","isBelow$1","getClosestCellAbove","getClosestCellBelow","findClosestPositionInAboveCell","findClosestPositionInBelowCell","hasNextBreak","lineInfo","breakPos","startsWithWrapBreak","startsWithBrBreak","isAtTableCellLine","isAtFirstTableCellLine","isAtLastTableCellLine","isCaretAtStartOrEndOfTable","navigateHorizontally","getClosestAbovePosition","getClosestBelowPosition","getTable","renderBlock","navigateVertically","moveH$1","moveV$1","isTarget","rangeBefore","insertElement","insertBr","insertBlock$1","insertEmptyLine","getClosestTargetBlock","isAtFirstOrLastLine","moveCaretToNewEmptyLine","rootBlock","rootBlockAttrs","moveV$2","defaultPatterns","patterns","matchesEvent","match$1","execute","MatchKeys","executeKeydownOverride","setup$7","ArrowKeys","executeKeydownOverride$1","executeKeyupOverride","setup$8","DeleteBackspaceKeys","firstNonWhiteSpaceNodeSibling","moveToCaretPosition","lastNode","tempElm","getEditableRoot","editableRoot","getParentBlock$2","getParentBlockName","isListItemParentBlock","NewLineUtils","hasFirstChild","hasParent$1","isListBlock","isNestedList","getContainerBlock","containerBlockParent","isFirstOrLastLi","insert$1","createNewBlock","newBlockName","tmpRng","InsertLi","trimZwsp","isEmptyAnchor","isTableCell$5","emptyBlock","containerAndSiblingName","canSplitBlock","trimInlineElementsOnLeftSideOfBlock","firstChilds","normalizeZwspOffset","includeZwspInRange","trimLeadingLineBreaks","getEditableRoot$1","forcedRootBlockAttrs","attrStyles","currentStyles","newStyles","attrClassesOpt","attrClasses","currentClassesOpt","currentClasses","filteredClasses","newClasses","appliedAttrs","remainingAttrs","setForcedBlockAttrs","forcedRootBlockName","wrapSelfAndSiblingsInDefaultBlock","addBrToBlockIfNeeded","insert$2","parentBlockName","clonedNode","isCaretAtStartOrEndOfBlock","normalizedOffset","insertNewBlockAfter","InsertBlock","shouldInsertBr","shouldBlockNewLine","ContextSelectors","newLineAction","shouldBlockNewLine$1","isBrMode","requiredState","inListBlock","inBlock","inPreBlock","inSummaryBlock","shouldPutBrInPre$1","inBrContext","hasShiftKey","canInsertIntoEditableRoot","rootEditable","match$2","predicates","getAction$1","NewLineAction","insert$3","InsertNewLine","endTypingLevel","handleEnterKeyEvent","setup$9","EnterKey","insertTextAtPosition","insertNbspAtPosition","insertSpaceAtPosition","navigateIgnoreEmptyTextNodes","getClosestBlock","isAtBeforeAfterBlockBoundary","isAtBlockBoundary","isAtStartOfBlock","isAtEndOfBlock","isBeforeBlock","isAfterBlock","isInMiddleOfText","getClosestBlock$1","hasSpaceBefore","hasSpaceAfter","isPreValue","isInPre","isAtBeginningOfBody","isAtEndOfBody","isAtLineBoundary","needsToHaveNbsp","needsToBeNbspLeft","needsToBeNbspRight","afterPos","needsToBeNbsp","isNbspAt","hasNbsp","normalizeNbspMiddle","chars","normalizeNbspAtStart","normalizeNbspInMiddleOfTextNode","newText","normalizeNbspAtEnd","normalizeNbsps","normalizeNbspsInEditor","locationToCaretPosition","insertInlineBoundarySpaceOrNbsp","checkPos","setSelection$1","insertSpaceOrNbspAtSelection","executeKeydownOverride$2","setup$a","SpaceKey","findBlockCaretContainer","removeIeControlRect","handleBlockContainer","setup$b","CaretContainerInput","browser$4","setupIeInput","keypressThrotter","setup$c","isComposing","executeKeydownOverride$3","setup$d","HomeEndKeys","setup$e","KeyboardOverrides","isTextBlockNode","normalizeSelection$1","setup$f","detail","preventSummaryToggle","filterDetails","setup$g","DOM$2","appendStyle","createParser","autoFocus","auto_focus","destroyed","initEditor","execCallback","getStyleSheetLoader","initContentBody","skipWrite","contentCssText","visibility","orgVisibility","iframeHTML","bodyEl","content_document","content_window","bodyElement","hex_colors","force_hex_style_colors","class_filter","annotator","_nodeChangeDispatcher","browser_spellcheck","gecko_spellcheck","spellcheck","directionality","nowrap","whiteSpace","protect","startContent","contentCSS","content_style","InitContentBody","DOM$3","relaxDomain","ifr","domain","hostname","bodyUuid","domainRelaxUrl","normalizeHeight","normalizedHeight","createIframeElement","customAttrs","iframe","frameBorder","allowTransparency","getIframeHtml","bodyId","bodyClass","documentBaseURI","getURI","createIframe","isDomainRelaxed","contentAreaContainer","iframeContainer","init$1","boxInfo","editorContainer","orgDisplay","InitIframe","DOM$4","initPlugin","initializedPlugins","Plugin","pluginInstance","trimLegacyPrefix","initPlugins","initTheme","Theme","renderFromLoadedTheme","minHeight","re","min_height","renderUI","deltaWidth","deltaHeight","iframeHeight","renderFromThemeFunc","createThemeFalseResult","renderThemeFalseIframe","renderThemeFalse","renderThemeUi","init$2","rtl_ui","i18n","aria_label","getLang","content_css","toAbsolute","Init","DOM$5","hasSkipLoadPrefix","loadLanguage","scriptLoader","language_url","loadTheme","themeUrl","theme_url","loadPlugins","render","form","formElement","hasHiddenInput","formEventDelegate","_mceOldSubmit","triggerSave","windowManager","encoding","save","_beforeUnload","set_dirty","Render","add$4","sidebars","Sidebar","each$k","trim$4","queryParts","DEFAULT_PORTS","ftp","http","https","mailto","URI","baseUri","base_uri","source","isProtocolRelative","protocol","toAbsPath","part","userInfo","port","setPath","toRelative","tu","uu","toRelPath","noHost","isSameOrigin","defaultPort","breakPoint","outPath","nb","noProtoHost","loc","pathname","trimEmptyContents","emptyRegExp","getContentFromBody","getContent$1","traverse","findMatchingNodes","nodeMatches","attrMatches","filter$3","isTreeNode","moveSelection","setEditorHtml","setContentString","padd","setContentTree","setContent$1","DOM$6","restoreOriginalStyles","safeDestroy","clearDomReferences","restoreForm","remove$7","is_removing","automatic","DOM$7","extend$4","each$l","resolve$4","ie$2","Editor","documentBaseURL","baseURI","language_load","loadedCSS","editorCommands","buttons","menuItems","cache_suffix","override_viewport","callbackLookup","lang_1","i18n_1","addButton","onclick","stateSelector","tooltip","addSidebar","addMenuItem","addContextToolbar","contextToolbars","focusedEditor","setProgressState","isNotDirty","oldState","urlconverter_callback","visual_table_class","visual_anchor_class","_scanForImages","documentFocusInHandler","beforeUnloadDelegate","EditorManager","isEditorUIElement","FocusManager","isManualNodeChange","registerPageMouseUp","throttledStore","mouseUpPage","registerFocusOut","registerMouseUp","registerEditorEvents","register$3","SelectionRestore","DOM$8","isEditorUIElement$1","isUIElement","customSelector","custom_ui_selector","getActiveElement","registerEvents","blurredEditor","unregisterDocumentEvents","setup$h","FocusController","DOM$9","explode$4","each$m","extend$5","instanceCounter","boundGlobalEvents","legacyEditors","isValidLegacyKey","globalEventDelegate","toggleGlobalEvents","removeEditorFromList","targetEditor","oldEditors","purgeDestroyedEditor","majorVersion","minorVersion","releaseDate","preInit","tinymce","tinyMCEPreInit","srcScript","currentScript","base_url","pluginBaseUrls","plugin_base_urls","invalidInlineTargets","isInvalidInlineTarget","createId","findTargets","targets","types","forms","editor_deselector","editor_selector","provideResults","initEditors","initCount","createEditor","addI18n","EditorManager$1","compareRanges","getCaretRangeFromPoint","extendClass","initializing","RangeUtils$1","round$2","relativePosition","targetW","targetH","create$4","findBestRelativePosition","constrainRect","rels","inflate","intersect","cropRect","x1","y1","clamp$1","clampRect","fixedSize","underflowX1","underflowY1","overflowX2","overflowY2","cx2","cy2","fromClientRect","Rect","Factory","typeClass","lctype","controlType","ControlType","each$n","extend$6","Class","member","_super","mixins","mixin","Mixins","dummy","name_1","Methods","Properties","fieldName","Statics","Defaults","min$1","max$1","round$3","Color","rgb2hsv","minRGB","maxRGB","hsvToRgb","hue","saturation","brightness","side","chroma","toRgb","toHsv","quote","JSON$1","JSONP","XHR","ready","success_scope","error_scope","overrideMimeType","content_type","crossDomain","setRequestHeader","requestheaders","extend$7","JSONRequest","sendRPC","ecb","scb","ty","method","localStorage","storage","getItem","setItem","removeItem","defineProperty","configurable","enumerable","LocalStorage","publicApi","geom","util","EventDispatcher","Serializer","isMac","Tinymce","tinyMCE"],"mappings":"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C,IAYft0B,IAAKA,EACL24D,SAAUA,EACV79C,KAAMic,GACNtW,KAAMA,EACNyvB,OAAQb,GACRzS,OAAQ0S,GACRupB,SAAU50C,GAAOG,OAGjB40C,GAAa,SAAUN,EAAKhD,GAC9B,MAAOgD,GAAIvxD,KAAK,WACd,MAAOH,IAAM0uD,IACZl5D,KAEDuK,IACFvK,MAAOA,GACPwK,MAAOA,GACPgyD,WAAYA,IAuNVC,IACF,UACA,QACA,UACA,MACA,KACA,aACA,SACA,OACA,WACA,SACA,SACA,OACA,OACA,MACA,UACA,UACA,OACA,IACA,KACA,WACA,KACA,SACA,UACA,SACA,aACA,KACA,KACA,KACA,KACA,KACA,KACA,UACA,MACA,MACA,YACA,OACA,MACA,KACA,KACA,KACA,KACA,QACA,QACA,QACA,QACA,KACA,KACA,KACA,WAEEC,IACF,OACA,OACA,WACA,KACA,MACA,QACA,KACA,MACA,QACA,UACA,OACA,OACA,QACA,QACA,SACA,MACA,SAEEC,IACF,KACA,MAEEC,IACF,QACA,QACA,SAEEC,IACF,KACA,KACA,KACA,KACA,KACA,KACA,IACA,MACA,UACA,MACA,OACA,aACA,SACA,MACA,WACA,SACA,SACA,UACA,UACA,SACA,QACA,MACA,UAEEC,IACF,KACA,KACA,KACA,KACA,KACA,MAEEC,IACF,KACA,KACA,MAEEC,IACF,KACA,KACA,MAEEC,IACF,MACA,SACA,WACA,SAEEC,GAAa,SAAU73C,GACzB,GAAIC,EACJ,OAAO,UAAUve,GAEf,MADAue,GAASA,GAAkBkwB,GAAYnwB,EAAO/a,IAAS,IAChDgb,EAAO/F,eAAevQ,GAAKjI,MAGlCo2D,GAAYD,GAAWJ,IACvBzjD,GAAU6jD,GAAWT,IACrBW,GAAW,SAAUr2D,GACvB,MAAO2a,IAAU3a,KAAUsS,GAAQtS,IAEjCs2D,GAAO,SAAUt2D,GACnB,MAAO2a,IAAU3a,IAAwB,OAAfiI,GAAKjI,IAE7Bu2D,GAAcJ,GAAWL,IACzBU,GAASL,GAAWF,IACpBQ,GAAaN,GAAWH,IACxBU,GAASP,GAAW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","file":"static/js/44.0bd3a4442c3b9324a26e.js","sourcesContent":["webpackJsonp([44],{\n\n/***/ \"5eDb\":\n/***/ (function(module, exports, __webpack_require__) {\n\n/* WEBPACK VAR INJECTION */(function(setImmediate, global) {// 4.9.11 (2020-07-13)\n(function () {\n(function (domGlobals) {\n    'use strict';\n\n    var noop = function () {\n    };\n    var compose = function (fa, fb) {\n      return function () {\n        var args = [];\n        for (var _i = 0; _i < arguments.length; _i++) {\n          args[_i] = arguments[_i];\n        }\n        return fa(fb.apply(null, args));\n      };\n    };\n    var constant = function (value) {\n      return function () {\n        return value;\n      };\n    };\n    var identity = function (x) {\n      return x;\n    };\n    function curry(fn) {\n      var initialArgs = [];\n      for (var _i = 1; _i < arguments.length; _i++) {\n        initialArgs[_i - 1] = arguments[_i];\n      }\n      return function () {\n        var restArgs = [];\n        for (var _i = 0; _i < arguments.length; _i++) {\n          restArgs[_i] = arguments[_i];\n        }\n        var all = initialArgs.concat(restArgs);\n        return fn.apply(null, all);\n      };\n    }\n    var not = function (f) {\n      return function () {\n        var args = [];\n        for (var _i = 0; _i < arguments.length; _i++) {\n          args[_i] = arguments[_i];\n        }\n        return !f.apply(null, args);\n      };\n    };\n    var die = function (msg) {\n      return function () {\n        throw new Error(msg);\n      };\n    };\n    var never = constant(false);\n    var always = constant(true);\n\n    var none = function () {\n      return NONE;\n    };\n    var NONE = function () {\n      var eq = function (o) {\n        return o.isNone();\n      };\n      var call = function (thunk) {\n        return thunk();\n      };\n      var id = function (n) {\n        return n;\n      };\n      var me = {\n        fold: function (n, s) {\n          return n();\n        },\n        is: never,\n        isSome: never,\n        isNone: always,\n        getOr: id,\n        getOrThunk: call,\n        getOrDie: function (msg) {\n          throw new Error(msg || 'error: getOrDie called on none.');\n        },\n        getOrNull: constant(null),\n        getOrUndefined: constant(undefined),\n        or: id,\n        orThunk: call,\n        map: none,\n        each: noop,\n        bind: none,\n        exists: never,\n        forall: always,\n        filter: none,\n        equals: eq,\n        equals_: eq,\n        toArray: function () {\n          return [];\n        },\n        toString: constant('none()')\n      };\n      if (Object.freeze) {\n        Object.freeze(me);\n      }\n      return me;\n    }();\n    var some = function (a) {\n      var constant_a = constant(a);\n      var self = function () {\n        return me;\n      };\n      var bind = function (f) {\n        return f(a);\n      };\n      var me = {\n        fold: function (n, s) {\n          return s(a);\n        },\n        is: function (v) {\n          return a === v;\n        },\n        isSome: always,\n        isNone: never,\n        getOr: constant_a,\n        getOrThunk: constant_a,\n        getOrDie: constant_a,\n        getOrNull: constant_a,\n        getOrUndefined: constant_a,\n        or: self,\n        orThunk: self,\n        map: function (f) {\n          return some(f(a));\n        },\n        each: function (f) {\n          f(a);\n        },\n        bind: bind,\n        exists: bind,\n        forall: bind,\n        filter: function (f) {\n          return f(a) ? me : NONE;\n        },\n        toArray: function () {\n          return [a];\n        },\n        toString: function () {\n          return 'some(' + a + ')';\n        },\n        equals: function (o) {\n          return o.is(a);\n        },\n        equals_: function (o, elementEq) {\n          return o.fold(never, function (b) {\n            return elementEq(a, b);\n          });\n        }\n      };\n      return me;\n    };\n    var from = function (value) {\n      return value === null || value === undefined ? NONE : some(value);\n    };\n    var Option = {\n      some: some,\n      none: none,\n      from: from\n    };\n\n    var typeOf = function (x) {\n      if (x === null) {\n        return 'null';\n      }\n      var t = typeof x;\n      if (t === 'object' && (Array.prototype.isPrototypeOf(x) || x.constructor && x.constructor.name === 'Array')) {\n        return 'array';\n      }\n      if (t === 'object' && (String.prototype.isPrototypeOf(x) || x.constructor && x.constructor.name === 'String')) {\n        return 'string';\n      }\n      return t;\n    };\n    var isType = function (type) {\n      return function (value) {\n        return typeOf(value) === type;\n      };\n    };\n    var isString = isType('string');\n    var isObject = isType('object');\n    var isArray = isType('array');\n    var isNull = isType('null');\n    var isBoolean = isType('boolean');\n    var isFunction = isType('function');\n    var isNumber = isType('number');\n\n    var nativeSlice = Array.prototype.slice;\n    var nativeIndexOf = Array.prototype.indexOf;\n    var nativePush = Array.prototype.push;\n    var rawIndexOf = function (ts, t) {\n      return nativeIndexOf.call(ts, t);\n    };\n    var indexOf = function (xs, x) {\n      var r = rawIndexOf(xs, x);\n      return r === -1 ? Option.none() : Option.some(r);\n    };\n    var contains = function (xs, x) {\n      return rawIndexOf(xs, x) > -1;\n    };\n    var exists = function (xs, pred) {\n      for (var i = 0, len = xs.length; i < len; i++) {\n        var x = xs[i];\n        if (pred(x, i)) {\n          return true;\n        }\n      }\n      return false;\n    };\n    var map = function (xs, f) {\n      var len = xs.length;\n      var r = new Array(len);\n      for (var i = 0; i < len; i++) {\n        var x = xs[i];\n        r[i] = f(x, i);\n      }\n      return r;\n    };\n    var each = function (xs, f) {\n      for (var i = 0, len = xs.length; i < len; i++) {\n        var x = xs[i];\n        f(x, i);\n      }\n    };\n    var eachr = function (xs, f) {\n      for (var i = xs.length - 1; i >= 0; i--) {\n        var x = xs[i];\n        f(x, i);\n      }\n    };\n    var partition = function (xs, pred) {\n      var pass = [];\n      var fail = [];\n      for (var i = 0, len = xs.length; i < len; i++) {\n        var x = xs[i];\n        var arr = pred(x, i) ? pass : fail;\n        arr.push(x);\n      }\n      return {\n        pass: pass,\n        fail: fail\n      };\n    };\n    var filter = function (xs, pred) {\n      var r = [];\n      for (var i = 0, len = xs.length; i < len; i++) {\n        var x = xs[i];\n        if (pred(x, i)) {\n          r.push(x);\n        }\n      }\n      return r;\n    };\n    var foldr = function (xs, f, acc) {\n      eachr(xs, function (x) {\n        acc = f(acc, x);\n      });\n      return acc;\n    };\n    var foldl = function (xs, f, acc) {\n      each(xs, function (x) {\n        acc = f(acc, x);\n      });\n      return acc;\n    };\n    var find = function (xs, pred) {\n      for (var i = 0, len = xs.length; i < len; i++) {\n        var x = xs[i];\n        if (pred(x, i)) {\n          return Option.some(x);\n        }\n      }\n      return Option.none();\n    };\n    var findIndex = function (xs, pred) {\n      for (var i = 0, len = xs.length; i < len; i++) {\n        var x = xs[i];\n        if (pred(x, i)) {\n          return Option.some(i);\n        }\n      }\n      return Option.none();\n    };\n    var flatten = function (xs) {\n      var r = [];\n      for (var i = 0, len = xs.length; i < len; ++i) {\n        if (!isArray(xs[i])) {\n          throw new Error('Arr.flatten item ' + i + ' was not an array, input: ' + xs);\n        }\n        nativePush.apply(r, xs[i]);\n      }\n      return r;\n    };\n    var bind = function (xs, f) {\n      var output = map(xs, f);\n      return flatten(output);\n    };\n    var forall = function (xs, pred) {\n      for (var i = 0, len = xs.length; i < len; ++i) {\n        var x = xs[i];\n        if (pred(x, i) !== true) {\n          return false;\n        }\n      }\n      return true;\n    };\n    var reverse = function (xs) {\n      var r = nativeSlice.call(xs, 0);\n      r.reverse();\n      return r;\n    };\n    var difference = function (a1, a2) {\n      return filter(a1, function (x) {\n        return !contains(a2, x);\n      });\n    };\n    var mapToObject = function (xs, f) {\n      var r = {};\n      for (var i = 0, len = xs.length; i < len; i++) {\n        var x = xs[i];\n        r[String(x)] = f(x, i);\n      }\n      return r;\n    };\n    var sort = function (xs, comparator) {\n      var copy = nativeSlice.call(xs, 0);\n      copy.sort(comparator);\n      return copy;\n    };\n    var head = function (xs) {\n      return xs.length === 0 ? Option.none() : Option.some(xs[0]);\n    };\n    var last = function (xs) {\n      return xs.length === 0 ? Option.none() : Option.some(xs[xs.length - 1]);\n    };\n    var from$1 = isFunction(Array.from) ? Array.from : function (x) {\n      return nativeSlice.call(x);\n    };\n\n    var Global = typeof domGlobals.window !== 'undefined' ? domGlobals.window : Function('return this;')();\n\n    var path = function (parts, scope) {\n      var o = scope !== undefined && scope !== null ? scope : Global;\n      for (var i = 0; i < parts.length && o !== undefined && o !== null; ++i) {\n        o = o[parts[i]];\n      }\n      return o;\n    };\n    var resolve = function (p, scope) {\n      var parts = p.split('.');\n      return path(parts, scope);\n    };\n\n    var unsafe = function (name, scope) {\n      return resolve(name, scope);\n    };\n    var getOrDie = function (name, scope) {\n      var actual = unsafe(name, scope);\n      if (actual === undefined || actual === null) {\n        throw new Error(name + ' not available on this browser');\n      }\n      return actual;\n    };\n    var Global$1 = { getOrDie: getOrDie };\n\n    var url = function () {\n      return Global$1.getOrDie('URL');\n    };\n    var createObjectURL = function (blob) {\n      return url().createObjectURL(blob);\n    };\n    var revokeObjectURL = function (u) {\n      url().revokeObjectURL(u);\n    };\n    var URL = {\n      createObjectURL: createObjectURL,\n      revokeObjectURL: revokeObjectURL\n    };\n\n    var nav = domGlobals.navigator, userAgent = nav.userAgent;\n    var opera, webkit, ie, ie11, ie12, gecko, mac, iDevice, android, fileApi, phone, tablet, windowsPhone;\n    var matchMediaQuery = function (query) {\n      return 'matchMedia' in domGlobals.window ? domGlobals.matchMedia(query).matches : false;\n    };\n    opera = false;\n    android = /Android/.test(userAgent);\n    webkit = /WebKit/.test(userAgent);\n    ie = !webkit && !opera && /MSIE/gi.test(userAgent) && /Explorer/gi.test(nav.appName);\n    ie = ie && /MSIE (\\w+)\\./.exec(userAgent)[1];\n    ie11 = userAgent.indexOf('Trident/') !== -1 && (userAgent.indexOf('rv:') !== -1 || nav.appName.indexOf('Netscape') !== -1) ? 11 : false;\n    ie12 = userAgent.indexOf('Edge/') !== -1 && !ie && !ie11 ? 12 : false;\n    ie = ie || ie11 || ie12;\n    gecko = !webkit && !ie11 && /Gecko/.test(userAgent);\n    mac = userAgent.indexOf('Mac') !== -1;\n    iDevice = /(iPad|iPhone)/.test(userAgent);\n    fileApi = 'FormData' in domGlobals.window && 'FileReader' in domGlobals.window && 'URL' in domGlobals.window && !!URL.createObjectURL;\n    phone = matchMediaQuery('only screen and (max-device-width: 480px)') && (android || iDevice);\n    tablet = matchMediaQuery('only screen and (min-width: 800px)') && (android || iDevice);\n    windowsPhone = userAgent.indexOf('Windows Phone') !== -1;\n    if (ie12) {\n      webkit = false;\n    }\n    var contentEditable = !iDevice || fileApi || parseInt(userAgent.match(/AppleWebKit\\/(\\d*)/)[1], 10) >= 534;\n    var Env = {\n      opera: opera,\n      webkit: webkit,\n      ie: ie,\n      gecko: gecko,\n      mac: mac,\n      iOS: iDevice,\n      android: android,\n      contentEditable: contentEditable,\n      transparentSrc: 'data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7',\n      caretAfter: ie !== 8,\n      range: domGlobals.window.getSelection && 'Range' in domGlobals.window,\n      documentMode: ie && !ie12 ? domGlobals.document.documentMode || 7 : 10,\n      fileApi: fileApi,\n      ceFalse: ie === false || ie > 8,\n      cacheSuffix: null,\n      container: null,\n      overrideViewPort: null,\n      experimentalShadowDom: false,\n      canHaveCSP: ie === false || ie > 11,\n      desktop: !phone && !tablet,\n      windowsPhone: windowsPhone\n    };\n\n    var promise = function () {\n      function bind(fn, thisArg) {\n        return function () {\n          fn.apply(thisArg, arguments);\n        };\n      }\n      var isArray = Array.isArray || function (value) {\n        return Object.prototype.toString.call(value) === '[object Array]';\n      };\n      var Promise = function (fn) {\n        if (typeof this !== 'object') {\n          throw new TypeError('Promises must be constructed via new');\n        }\n        if (typeof fn !== 'function') {\n          throw new TypeError('not a function');\n        }\n        this._state = null;\n        this._value = null;\n        this._deferreds = [];\n        doResolve(fn, bind(resolve, this), bind(reject, this));\n      };\n      var asap = Promise.immediateFn || typeof setImmediate === 'function' && setImmediate || function (fn) {\n        setTimeout(fn, 1);\n      };\n      function handle(deferred) {\n        var me = this;\n        if (this._state === null) {\n          this._deferreds.push(deferred);\n          return;\n        }\n        asap(function () {\n          var cb = me._state ? deferred.onFulfilled : deferred.onRejected;\n          if (cb === null) {\n            (me._state ? deferred.resolve : deferred.reject)(me._value);\n            return;\n          }\n          var ret;\n          try {\n            ret = cb(me._value);\n          } catch (e) {\n            deferred.reject(e);\n            return;\n          }\n          deferred.resolve(ret);\n        });\n      }\n      function resolve(newValue) {\n        try {\n          if (newValue === this) {\n            throw new TypeError('A promise cannot be resolved with itself.');\n          }\n          if (newValue && (typeof newValue === 'object' || typeof newValue === 'function')) {\n            var then = newValue.then;\n            if (typeof then === 'function') {\n              doResolve(bind(then, newValue), bind(resolve, this), bind(reject, this));\n              return;\n            }\n          }\n          this._state = true;\n          this._value = newValue;\n          finale.call(this);\n        } catch (e) {\n          reject.call(this, e);\n        }\n      }\n      function reject(newValue) {\n        this._state = false;\n        this._value = newValue;\n        finale.call(this);\n      }\n      function finale() {\n        for (var i = 0, len = this._deferreds.length; i < len; i++) {\n          handle.call(this, this._deferreds[i]);\n        }\n        this._deferreds = null;\n      }\n      function Handler(onFulfilled, onRejected, resolve, reject) {\n        this.onFulfilled = typeof onFulfilled === 'function' ? onFulfilled : null;\n        this.onRejected = typeof onRejected === 'function' ? onRejected : null;\n        this.resolve = resolve;\n        this.reject = reject;\n      }\n      function doResolve(fn, onFulfilled, onRejected) {\n        var done = false;\n        try {\n          fn(function (value) {\n            if (done) {\n              return;\n            }\n            done = true;\n            onFulfilled(value);\n          }, function (reason) {\n            if (done) {\n              return;\n            }\n            done = true;\n            onRejected(reason);\n          });\n        } catch (ex) {\n          if (done) {\n            return;\n          }\n          done = true;\n          onRejected(ex);\n        }\n      }\n      Promise.prototype.catch = function (onRejected) {\n        return this.then(null, onRejected);\n      };\n      Promise.prototype.then = function (onFulfilled, onRejected) {\n        var me = this;\n        return new Promise(function (resolve, reject) {\n          handle.call(me, new Handler(onFulfilled, onRejected, resolve, reject));\n        });\n      };\n      Promise.all = function () {\n        var args = Array.prototype.slice.call(arguments.length === 1 && isArray(arguments[0]) ? arguments[0] : arguments);\n        return new Promise(function (resolve, reject) {\n          if (args.length === 0) {\n            return resolve([]);\n          }\n          var remaining = args.length;\n          function res(i, val) {\n            try {\n              if (val && (typeof val === 'object' || typeof val === 'function')) {\n                var then = val.then;\n                if (typeof then === 'function') {\n                  then.call(val, function (val) {\n                    res(i, val);\n                  }, reject);\n                  return;\n                }\n              }\n              args[i] = val;\n              if (--remaining === 0) {\n                resolve(args);\n              }\n            } catch (ex) {\n              reject(ex);\n            }\n          }\n          for (var i = 0; i < args.length; i++) {\n            res(i, args[i]);\n          }\n        });\n      };\n      Promise.resolve = function (value) {\n        if (value && typeof value === 'object' && value.constructor === Promise) {\n          return value;\n        }\n        return new Promise(function (resolve) {\n          resolve(value);\n        });\n      };\n      Promise.reject = function (value) {\n        return new Promise(function (resolve, reject) {\n          reject(value);\n        });\n      };\n      Promise.race = function (values) {\n        return new Promise(function (resolve, reject) {\n          for (var i = 0, len = values.length; i < len; i++) {\n            values[i].then(resolve, reject);\n          }\n        });\n      };\n      return Promise;\n    };\n    var promiseObj = window.Promise ? window.Promise : promise();\n\n    var requestAnimationFramePromise;\n    var requestAnimationFrame = function (callback, element) {\n      var i, requestAnimationFrameFunc = domGlobals.window.requestAnimationFrame;\n      var vendors = [\n        'ms',\n        'moz',\n        'webkit'\n      ];\n      var featurefill = function (callback) {\n        domGlobals.window.setTimeout(callback, 0);\n      };\n      for (i = 0; i < vendors.length && !requestAnimationFrameFunc; i++) {\n        requestAnimationFrameFunc = domGlobals.window[vendors[i] + 'RequestAnimationFrame'];\n      }\n      if (!requestAnimationFrameFunc) {\n        requestAnimationFrameFunc = featurefill;\n      }\n      requestAnimationFrameFunc(callback, element);\n    };\n    var wrappedSetTimeout = function (callback, time) {\n      if (typeof time !== 'number') {\n        time = 0;\n      }\n      return setTimeout(callback, time);\n    };\n    var wrappedSetInterval = function (callback, time) {\n      if (typeof time !== 'number') {\n        time = 1;\n      }\n      return setInterval(callback, time);\n    };\n    var wrappedClearTimeout = function (id) {\n      return clearTimeout(id);\n    };\n    var wrappedClearInterval = function (id) {\n      return clearInterval(id);\n    };\n    var debounce = function (callback, time) {\n      var timer, func;\n      func = function () {\n        var args = arguments;\n        clearTimeout(timer);\n        timer = wrappedSetTimeout(function () {\n          callback.apply(this, args);\n        }, time);\n      };\n      func.stop = function () {\n        clearTimeout(timer);\n      };\n      return func;\n    };\n    var Delay = {\n      requestAnimationFrame: function (callback, element) {\n        if (requestAnimationFramePromise) {\n          requestAnimationFramePromise.then(callback);\n          return;\n        }\n        requestAnimationFramePromise = new promiseObj(function (resolve) {\n          if (!element) {\n            element = domGlobals.document.body;\n          }\n          requestAnimationFrame(resolve, element);\n        }).then(callback);\n      },\n      setTimeout: wrappedSetTimeout,\n      setInterval: wrappedSetInterval,\n      setEditorTimeout: function (editor, callback, time) {\n        return wrappedSetTimeout(function () {\n          if (!editor.removed) {\n            callback();\n          }\n        }, time);\n      },\n      setEditorInterval: function (editor, callback, time) {\n        var timer;\n        timer = wrappedSetInterval(function () {\n          if (!editor.removed) {\n            callback();\n          } else {\n            clearInterval(timer);\n          }\n        }, time);\n        return timer;\n      },\n      debounce: debounce,\n      throttle: debounce,\n      clearInterval: wrappedClearInterval,\n      clearTimeout: wrappedClearTimeout\n    };\n\n    var eventExpandoPrefix = 'mce-data-';\n    var mouseEventRe = /^(?:mouse|contextmenu)|click/;\n    var deprecated = {\n      keyLocation: 1,\n      layerX: 1,\n      layerY: 1,\n      returnValue: 1,\n      webkitMovementX: 1,\n      webkitMovementY: 1,\n      keyIdentifier: 1\n    };\n    var hasIsDefaultPrevented = function (event) {\n      return event.isDefaultPrevented === returnTrue || event.isDefaultPrevented === returnFalse;\n    };\n    var returnFalse = function () {\n      return false;\n    };\n    var returnTrue = function () {\n      return true;\n    };\n    var addEvent = function (target, name, callback, capture) {\n      if (target.addEventListener) {\n        target.addEventListener(name, callback, capture || false);\n      } else if (target.attachEvent) {\n        target.attachEvent('on' + name, callback);\n      }\n    };\n    var removeEvent = function (target, name, callback, capture) {\n      if (target.removeEventListener) {\n        target.removeEventListener(name, callback, capture || false);\n      } else if (target.detachEvent) {\n        target.detachEvent('on' + name, callback);\n      }\n    };\n    var getTargetFromShadowDom = function (event, defaultTarget) {\n      if (event.composedPath) {\n        var composedPath = event.composedPath();\n        if (composedPath && composedPath.length > 0) {\n          return composedPath[0];\n        }\n      }\n      return defaultTarget;\n    };\n    var fix = function (originalEvent, data) {\n      var name;\n      var event = data || {};\n      for (name in originalEvent) {\n        if (!deprecated[name]) {\n          event[name] = originalEvent[name];\n        }\n      }\n      if (!event.target) {\n        event.target = event.srcElement || domGlobals.document;\n      }\n      if (Env.experimentalShadowDom) {\n        event.target = getTargetFromShadowDom(originalEvent, event.target);\n      }\n      if (originalEvent && mouseEventRe.test(originalEvent.type) && originalEvent.pageX === undefined && originalEvent.clientX !== undefined) {\n        var eventDoc = event.target.ownerDocument || domGlobals.document;\n        var doc = eventDoc.documentElement;\n        var body = eventDoc.body;\n        event.pageX = originalEvent.clientX + (doc && doc.scrollLeft || body && body.scrollLeft || 0) - (doc && doc.clientLeft || body && body.clientLeft || 0);\n        event.pageY = originalEvent.clientY + (doc && doc.scrollTop || body && body.scrollTop || 0) - (doc && doc.clientTop || body && body.clientTop || 0);\n      }\n      event.preventDefault = function () {\n        event.isDefaultPrevented = returnTrue;\n        if (originalEvent) {\n          if (originalEvent.preventDefault) {\n            originalEvent.preventDefault();\n          } else {\n            originalEvent.returnValue = false;\n          }\n        }\n      };\n      event.stopPropagation = function () {\n        event.isPropagationStopped = returnTrue;\n        if (originalEvent) {\n          if (originalEvent.stopPropagation) {\n            originalEvent.stopPropagation();\n          } else {\n            originalEvent.cancelBubble = true;\n          }\n        }\n      };\n      event.stopImmediatePropagation = function () {\n        event.isImmediatePropagationStopped = returnTrue;\n        event.stopPropagation();\n      };\n      if (hasIsDefaultPrevented(event) === false) {\n        event.isDefaultPrevented = returnFalse;\n        event.isPropagationStopped = returnFalse;\n        event.isImmediatePropagationStopped = returnFalse;\n      }\n      if (typeof event.metaKey === 'undefined') {\n        event.metaKey = false;\n      }\n      return event;\n    };\n    var bindOnReady = function (win, callback, eventUtils) {\n      var doc = win.document, event = { type: 'ready' };\n      if (eventUtils.domLoaded) {\n        callback(event);\n        return;\n      }\n      var isDocReady = function () {\n        return doc.readyState === 'complete' || doc.readyState === 'interactive' && doc.body;\n      };\n      var readyHandler = function () {\n        if (!eventUtils.domLoaded) {\n          eventUtils.domLoaded = true;\n          callback(event);\n        }\n      };\n      var waitForDomLoaded = function () {\n        if (isDocReady()) {\n          removeEvent(doc, 'readystatechange', waitForDomLoaded);\n          readyHandler();\n        }\n      };\n      var tryScroll = function () {\n        try {\n          doc.documentElement.doScroll('left');\n        } catch (ex) {\n          Delay.setTimeout(tryScroll);\n          return;\n        }\n        readyHandler();\n      };\n      if (doc.addEventListener && !(Env.ie && Env.ie < 11)) {\n        if (isDocReady()) {\n          readyHandler();\n        } else {\n          addEvent(win, 'DOMContentLoaded', readyHandler);\n        }\n      } else {\n        addEvent(doc, 'readystatechange', waitForDomLoaded);\n        if (doc.documentElement.doScroll && win.self === win.top) {\n          tryScroll();\n        }\n      }\n      addEvent(win, 'load', readyHandler);\n    };\n    var EventUtils = function () {\n      var self = this;\n      var events = {}, count, expando, hasFocusIn, hasMouseEnterLeave, mouseEnterLeave;\n      expando = eventExpandoPrefix + (+new Date()).toString(32);\n      hasMouseEnterLeave = 'onmouseenter' in domGlobals.document.documentElement;\n      hasFocusIn = 'onfocusin' in domGlobals.document.documentElement;\n      mouseEnterLeave = {\n        mouseenter: 'mouseover',\n        mouseleave: 'mouseout'\n      };\n      count = 1;\n      self.domLoaded = false;\n      self.events = events;\n      var executeHandlers = function (evt, id) {\n        var callbackList, i, l, callback;\n        var container = events[id];\n        callbackList = container && container[evt.type];\n        if (callbackList) {\n          for (i = 0, l = callbackList.length; i < l; i++) {\n            callback = callbackList[i];\n            if (callback && callback.func.call(callback.scope, evt) === false) {\n              evt.preventDefault();\n            }\n            if (evt.isImmediatePropagationStopped()) {\n              return;\n            }\n          }\n        }\n      };\n      self.bind = function (target, names, callback, scope) {\n        var id, callbackList, i, name, fakeName, nativeHandler, capture;\n        var win = domGlobals.window;\n        var defaultNativeHandler = function (evt) {\n          executeHandlers(fix(evt || win.event), id);\n        };\n        if (!target || target.nodeType === 3 || target.nodeType === 8) {\n          return;\n        }\n        if (!target[expando]) {\n          id = count++;\n          target[expando] = id;\n          events[id] = {};\n        } else {\n          id = target[expando];\n        }\n        scope = scope || target;\n        names = names.split(' ');\n        i = names.length;\n        while (i--) {\n          name = names[i];\n          nativeHandler = defaultNativeHandler;\n          fakeName = capture = false;\n          if (name === 'DOMContentLoaded') {\n            name = 'ready';\n          }\n          if (self.domLoaded && name === 'ready' && target.readyState === 'complete') {\n            callback.call(scope, fix({ type: name }));\n            continue;\n          }\n          if (!hasMouseEnterLeave) {\n            fakeName = mouseEnterLeave[name];\n            if (fakeName) {\n              nativeHandler = function (evt) {\n                var current, related;\n                current = evt.currentTarget;\n                related = evt.relatedTarget;\n                if (related && current.contains) {\n                  related = current.contains(related);\n                } else {\n                  while (related && related !== current) {\n                    related = related.parentNode;\n                  }\n                }\n                if (!related) {\n                  evt = fix(evt || win.event);\n                  evt.type = evt.type === 'mouseout' ? 'mouseleave' : 'mouseenter';\n                  evt.target = current;\n                  executeHandlers(evt, id);\n                }\n              };\n            }\n          }\n          if (!hasFocusIn && (name === 'focusin' || name === 'focusout')) {\n            capture = true;\n            fakeName = name === 'focusin' ? 'focus' : 'blur';\n            nativeHandler = function (evt) {\n              evt = fix(evt || win.event);\n              evt.type = evt.type === 'focus' ? 'focusin' : 'focusout';\n              executeHandlers(evt, id);\n            };\n          }\n          callbackList = events[id][name];\n          if (!callbackList) {\n            events[id][name] = callbackList = [{\n                func: callback,\n                scope: scope\n              }];\n            callbackList.fakeName = fakeName;\n            callbackList.capture = capture;\n            callbackList.nativeHandler = nativeHandler;\n            if (name === 'ready') {\n              bindOnReady(target, nativeHandler, self);\n            } else {\n              addEvent(target, fakeName || name, nativeHandler, capture);\n            }\n          } else {\n            if (name === 'ready' && self.domLoaded) {\n              callback({ type: name });\n            } else {\n              callbackList.push({\n                func: callback,\n                scope: scope\n              });\n            }\n          }\n        }\n        target = callbackList = 0;\n        return callback;\n      };\n      self.unbind = function (target, names, callback) {\n        var id, callbackList, i, ci, name, eventMap;\n        if (!target || target.nodeType === 3 || target.nodeType === 8) {\n          return self;\n        }\n        id = target[expando];\n        if (id) {\n          eventMap = events[id];\n          if (names) {\n            names = names.split(' ');\n            i = names.length;\n            while (i--) {\n              name = names[i];\n              callbackList = eventMap[name];\n              if (callbackList) {\n                if (callback) {\n                  ci = callbackList.length;\n                  while (ci--) {\n                    if (callbackList[ci].func === callback) {\n                      var nativeHandler = callbackList.nativeHandler;\n                      var fakeName = callbackList.fakeName, capture = callbackList.capture;\n                      callbackList = callbackList.slice(0, ci).concat(callbackList.slice(ci + 1));\n                      callbackList.nativeHandler = nativeHandler;\n                      callbackList.fakeName = fakeName;\n                      callbackList.capture = capture;\n                      eventMap[name] = callbackList;\n                    }\n                  }\n                }\n                if (!callback || callbackList.length === 0) {\n                  delete eventMap[name];\n                  removeEvent(target, callbackList.fakeName || name, callbackList.nativeHandler, callbackList.capture);\n                }\n              }\n            }\n          } else {\n            for (name in eventMap) {\n              callbackList = eventMap[name];\n              removeEvent(target, callbackList.fakeName || name, callbackList.nativeHandler, callbackList.capture);\n            }\n            eventMap = {};\n          }\n          for (name in eventMap) {\n            return self;\n          }\n          delete events[id];\n          try {\n            delete target[expando];\n          } catch (ex) {\n            target[expando] = null;\n          }\n        }\n        return self;\n      };\n      self.fire = function (target, name, args) {\n        var id;\n        if (!target || target.nodeType === 3 || target.nodeType === 8) {\n          return self;\n        }\n        args = fix(null, args);\n        args.type = name;\n        args.target = target;\n        do {\n          id = target[expando];\n          if (id) {\n            executeHandlers(args, id);\n          }\n          target = target.parentNode || target.ownerDocument || target.defaultView || target.parentWindow;\n        } while (target && !args.isPropagationStopped());\n        return self;\n      };\n      self.clean = function (target) {\n        var i, children;\n        var unbind = self.unbind;\n        if (!target || target.nodeType === 3 || target.nodeType === 8) {\n          return self;\n        }\n        if (target[expando]) {\n          unbind(target);\n        }\n        if (!target.getElementsByTagName) {\n          target = target.document;\n        }\n        if (target && target.getElementsByTagName) {\n          unbind(target);\n          children = target.getElementsByTagName('*');\n          i = children.length;\n          while (i--) {\n            target = children[i];\n            if (target[expando]) {\n              unbind(target);\n            }\n          }\n        }\n        return self;\n      };\n      self.destroy = function () {\n        events = {};\n      };\n      self.cancel = function (e) {\n        if (e) {\n          e.preventDefault();\n          e.stopImmediatePropagation();\n        }\n        return false;\n      };\n    };\n    EventUtils.Event = new EventUtils();\n    EventUtils.Event.bind(domGlobals.window, 'ready', function () {\n    });\n\n    var i, support, Expr, getText, isXML, tokenize, compile, select, outermostContext, sortInput, hasDuplicate, setDocument, document, docElem, documentIsHTML, rbuggyQSA, rbuggyMatches, matches, contains$1, expando = 'sizzle' + -new Date(), preferredDoc = domGlobals.window.document, dirruns = 0, done = 0, classCache = createCache(), tokenCache = createCache(), compilerCache = createCache(), sortOrder = function (a, b) {\n        if (a === b) {\n          hasDuplicate = true;\n        }\n        return 0;\n      }, strundefined = typeof undefined, MAX_NEGATIVE = 1 << 31, hasOwn = {}.hasOwnProperty, arr = [], pop = arr.pop, push_native = arr.push, push = arr.push, slice = arr.slice, indexOf$1 = arr.indexOf || function (elem) {\n        var i = 0, len = this.length;\n        for (; i < len; i++) {\n          if (this[i] === elem) {\n            return i;\n          }\n        }\n        return -1;\n      }, booleans = 'checked|selected|async|autofocus|autoplay|controls|defer|disabled|hidden|ismap|loop|multiple|open|readonly|required|scoped', whitespace = '[\\\\x20\\\\t\\\\r\\\\n\\\\f]', identifier = '(?:\\\\\\\\.|[\\\\w-]|[^\\\\x00-\\\\xa0])+', attributes = '\\\\[' + whitespace + '*(' + identifier + ')(?:' + whitespace + '*([*^$|!~]?=)' + whitespace + '*(?:\\'((?:\\\\\\\\.|[^\\\\\\\\\\'])*)\\'|\"((?:\\\\\\\\.|[^\\\\\\\\\"])*)\"|(' + identifier + '))|)' + whitespace + '*\\\\]', pseudos = ':(' + identifier + ')(?:\\\\((' + '(\\'((?:\\\\\\\\.|[^\\\\\\\\\\'])*)\\'|\"((?:\\\\\\\\.|[^\\\\\\\\\"])*)\")|' + '((?:\\\\\\\\.|[^\\\\\\\\()[\\\\]]|' + attributes + ')*)|' + '.*' + ')\\\\)|)', rtrim = new RegExp('^' + whitespace + '+|((?:^|[^\\\\\\\\])(?:\\\\\\\\.)*)' + whitespace + '+$', 'g'), rcomma = new RegExp('^' + whitespace + '*,' + whitespace + '*'), rcombinators = new RegExp('^' + whitespace + '*([>+~]|' + whitespace + ')' + whitespace + '*'), rattributeQuotes = new RegExp('=' + whitespace + '*([^\\\\]\\'\"]*?)' + whitespace + '*\\\\]', 'g'), rpseudo = new RegExp(pseudos), ridentifier = new RegExp('^' + identifier + '$'), matchExpr = {\n        ID: new RegExp('^#(' + identifier + ')'),\n        CLASS: new RegExp('^\\\\.(' + identifier + ')'),\n        TAG: new RegExp('^(' + identifier + '|[*])'),\n        ATTR: new RegExp('^' + attributes),\n        PSEUDO: new RegExp('^' + pseudos),\n        CHILD: new RegExp('^:(only|first|last|nth|nth-last)-(child|of-type)(?:\\\\(' + whitespace + '*(even|odd|(([+-]|)(\\\\d*)n|)' + whitespace + '*(?:([+-]|)' + whitespace + '*(\\\\d+)|))' + whitespace + '*\\\\)|)', 'i'),\n        bool: new RegExp('^(?:' + booleans + ')$', 'i'),\n        needsContext: new RegExp('^' + whitespace + '*[>+~]|:(even|odd|eq|gt|lt|nth|first|last)(?:\\\\(' + whitespace + '*((?:-\\\\d)?\\\\d*)' + whitespace + '*\\\\)|)(?=[^-]|$)', 'i')\n      }, rinputs = /^(?:input|select|textarea|button)$/i, rheader = /^h\\d$/i, rnative = /^[^{]+\\{\\s*\\[native \\w/, rquickExpr = /^(?:#([\\w-]+)|(\\w+)|\\.([\\w-]+))$/, rsibling = /[+~]/, rescape = /'|\\\\/g, runescape = new RegExp('\\\\\\\\([\\\\da-f]{1,6}' + whitespace + '?|(' + whitespace + ')|.)', 'ig'), funescape = function (_, escaped, escapedWhitespace) {\n        var high = '0x' + escaped - 65536;\n        return high !== high || escapedWhitespace ? escaped : high < 0 ? String.fromCharCode(high + 65536) : String.fromCharCode(high >> 10 | 55296, high & 1023 | 56320);\n      };\n    try {\n      push.apply(arr = slice.call(preferredDoc.childNodes), preferredDoc.childNodes);\n      arr[preferredDoc.childNodes.length].nodeType;\n    } catch (e) {\n      push = {\n        apply: arr.length ? function (target, els) {\n          push_native.apply(target, slice.call(els));\n        } : function (target, els) {\n          var j = target.length, i = 0;\n          while (target[j++] = els[i++]) {\n          }\n          target.length = j - 1;\n        }\n      };\n    }\n    var Sizzle = function (selector, context, results, seed) {\n      var match, elem, m, nodeType, i, groups, old, nid, newContext, newSelector;\n      if ((context ? context.ownerDocument || context : preferredDoc) !== document) {\n        setDocument(context);\n      }\n      context = context || document;\n      results = results || [];\n      if (!selector || typeof selector !== 'string') {\n        return results;\n      }\n      if ((nodeType = context.nodeType) !== 1 && nodeType !== 9) {\n        return [];\n      }\n      if (documentIsHTML && !seed) {\n        if (match = rquickExpr.exec(selector)) {\n          if (m = match[1]) {\n            if (nodeType === 9) {\n              elem = context.getElementById(m);\n              if (elem && elem.parentNode) {\n                if (elem.id === m) {\n                  results.push(elem);\n                  return results;\n                }\n              } else {\n                return results;\n              }\n            } else {\n              if (context.ownerDocument && (elem = context.ownerDocument.getElementById(m)) && contains$1(context, elem) && elem.id === m) {\n                results.push(elem);\n                return results;\n              }\n            }\n          } else if (match[2]) {\n            push.apply(results, context.getElementsByTagName(selector));\n            return results;\n          } else if ((m = match[3]) && support.getElementsByClassName) {\n            push.apply(results, context.getElementsByClassName(m));\n            return results;\n          }\n        }\n        if (support.qsa && (!rbuggyQSA || !rbuggyQSA.test(selector))) {\n          nid = old = expando;\n          newContext = context;\n          newSelector = nodeType === 9 && selector;\n          if (nodeType === 1 && context.nodeName.toLowerCase() !== 'object') {\n            groups = tokenize(selector);\n            if (old = context.getAttribute('id')) {\n              nid = old.replace(rescape, '\\\\$&');\n            } else {\n              context.setAttribute('id', nid);\n            }\n            nid = '[id=\\'' + nid + '\\'] ';\n            i = groups.length;\n            while (i--) {\n              groups[i] = nid + toSelector(groups[i]);\n            }\n            newContext = rsibling.test(selector) && testContext(context.parentNode) || context;\n            newSelector = groups.join(',');\n          }\n          if (newSelector) {\n            try {\n              push.apply(results, newContext.querySelectorAll(newSelector));\n              return results;\n            } catch (qsaError) {\n            } finally {\n              if (!old) {\n                context.removeAttribute('id');\n              }\n            }\n          }\n        }\n      }\n      return select(selector.replace(rtrim, '$1'), context, results, seed);\n    };\n    function createCache() {\n      var keys = [];\n      function cache(key, value) {\n        if (keys.push(key + ' ') > Expr.cacheLength) {\n          delete cache[keys.shift()];\n        }\n        return cache[key + ' '] = value;\n      }\n      return cache;\n    }\n    function markFunction(fn) {\n      fn[expando] = true;\n      return fn;\n    }\n    function siblingCheck(a, b) {\n      var cur = b && a, diff = cur && a.nodeType === 1 && b.nodeType === 1 && (~b.sourceIndex || MAX_NEGATIVE) - (~a.sourceIndex || MAX_NEGATIVE);\n      if (diff) {\n        return diff;\n      }\n      if (cur) {\n        while (cur = cur.nextSibling) {\n          if (cur === b) {\n            return -1;\n          }\n        }\n      }\n      return a ? 1 : -1;\n    }\n    function createInputPseudo(type) {\n      return function (elem) {\n        var name = elem.nodeName.toLowerCase();\n        return name === 'input' && elem.type === type;\n      };\n    }\n    function createButtonPseudo(type) {\n      return function (elem) {\n        var name = elem.nodeName.toLowerCase();\n        return (name === 'input' || name === 'button') && elem.type === type;\n      };\n    }\n    function createPositionalPseudo(fn) {\n      return markFunction(function (argument) {\n        argument = +argument;\n        return markFunction(function (seed, matches) {\n          var j, matchIndexes = fn([], seed.length, argument), i = matchIndexes.length;\n          while (i--) {\n            if (seed[j = matchIndexes[i]]) {\n              seed[j] = !(matches[j] = seed[j]);\n            }\n          }\n        });\n      });\n    }\n    function testContext(context) {\n      return context && typeof context.getElementsByTagName !== strundefined && context;\n    }\n    support = Sizzle.support = {};\n    isXML = Sizzle.isXML = function (elem) {\n      var documentElement = elem && (elem.ownerDocument || elem).documentElement;\n      return documentElement ? documentElement.nodeName !== 'HTML' : false;\n    };\n    setDocument = Sizzle.setDocument = function (node) {\n      var hasCompare, doc = node ? node.ownerDocument || node : preferredDoc, parent = doc.defaultView;\n      function getTop(win) {\n        try {\n          return win.top;\n        } catch (ex) {\n        }\n        return null;\n      }\n      if (doc === document || doc.nodeType !== 9 || !doc.documentElement) {\n        return document;\n      }\n      document = doc;\n      docElem = doc.documentElement;\n      documentIsHTML = !isXML(doc);\n      if (parent && parent !== getTop(parent)) {\n        if (parent.addEventListener) {\n          parent.addEventListener('unload', function () {\n            setDocument();\n          }, false);\n        } else if (parent.attachEvent) {\n          parent.attachEvent('onunload', function () {\n            setDocument();\n          });\n        }\n      }\n      support.attributes = true;\n      support.getElementsByTagName = true;\n      support.getElementsByClassName = rnative.test(doc.getElementsByClassName);\n      support.getById = true;\n      Expr.find.ID = function (id, context) {\n        if (typeof context.getElementById !== strundefined && documentIsHTML) {\n          var m = context.getElementById(id);\n          return m && m.parentNode ? [m] : [];\n        }\n      };\n      Expr.filter.ID = function (id) {\n        var attrId = id.replace(runescape, funescape);\n        return function (elem) {\n          return elem.getAttribute('id') === attrId;\n        };\n      };\n      Expr.find.TAG = support.getElementsByTagName ? function (tag, context) {\n        if (typeof context.getElementsByTagName !== strundefined) {\n          return context.getElementsByTagName(tag);\n        }\n      } : function (tag, context) {\n        var elem, tmp = [], i = 0, results = context.getElementsByTagName(tag);\n        if (tag === '*') {\n          while (elem = results[i++]) {\n            if (elem.nodeType === 1) {\n              tmp.push(elem);\n            }\n          }\n          return tmp;\n        }\n        return results;\n      };\n      Expr.find.CLASS = support.getElementsByClassName && function (className, context) {\n        if (documentIsHTML) {\n          return context.getElementsByClassName(className);\n        }\n      };\n      rbuggyMatches = [];\n      rbuggyQSA = [];\n      support.disconnectedMatch = true;\n      rbuggyQSA = rbuggyQSA.length && new RegExp(rbuggyQSA.join('|'));\n      rbuggyMatches = rbuggyMatches.length && new RegExp(rbuggyMatches.join('|'));\n      hasCompare = rnative.test(docElem.compareDocumentPosition);\n      contains$1 = hasCompare || rnative.test(docElem.contains) ? function (a, b) {\n        var adown = a.nodeType === 9 ? a.documentElement : a, bup = b && b.parentNode;\n        return a === bup || !!(bup && bup.nodeType === 1 && (adown.contains ? adown.contains(bup) : a.compareDocumentPosition && a.compareDocumentPosition(bup) & 16));\n      } : function (a, b) {\n        if (b) {\n          while (b = b.parentNode) {\n            if (b === a) {\n              return true;\n            }\n          }\n        }\n        return false;\n      };\n      sortOrder = hasCompare ? function (a, b) {\n        if (a === b) {\n          hasDuplicate = true;\n          return 0;\n        }\n        var compare = !a.compareDocumentPosition - !b.compareDocumentPosition;\n        if (compare) {\n          return compare;\n        }\n        compare = (a.ownerDocument || a) === (b.ownerDocument || b) ? a.compareDocumentPosition(b) : 1;\n        if (compare & 1 || !support.sortDetached && b.compareDocumentPosition(a) === compare) {\n          if (a === doc || a.ownerDocument === preferredDoc && contains$1(preferredDoc, a)) {\n            return -1;\n          }\n          if (b === doc || b.ownerDocument === preferredDoc && contains$1(preferredDoc, b)) {\n            return 1;\n          }\n          return sortInput ? indexOf$1.call(sortInput, a) - indexOf$1.call(sortInput, b) : 0;\n        }\n        return compare & 4 ? -1 : 1;\n      } : function (a, b) {\n        if (a === b) {\n          hasDuplicate = true;\n          return 0;\n        }\n        var cur, i = 0, aup = a.parentNode, bup = b.parentNode, ap = [a], bp = [b];\n        if (!aup || !bup) {\n          return a === doc ? -1 : b === doc ? 1 : aup ? -1 : bup ? 1 : sortInput ? indexOf$1.call(sortInput, a) - indexOf$1.call(sortInput, b) : 0;\n        } else if (aup === bup) {\n          return siblingCheck(a, b);\n        }\n        cur = a;\n        while (cur = cur.parentNode) {\n          ap.unshift(cur);\n        }\n        cur = b;\n        while (cur = cur.parentNode) {\n          bp.unshift(cur);\n        }\n        while (ap[i] === bp[i]) {\n          i++;\n        }\n        return i ? siblingCheck(ap[i], bp[i]) : ap[i] === preferredDoc ? -1 : bp[i] === preferredDoc ? 1 : 0;\n      };\n      return doc;\n    };\n    Sizzle.matches = function (expr, elements) {\n      return Sizzle(expr, null, null, elements);\n    };\n    Sizzle.matchesSelector = function (elem, expr) {\n      if ((elem.ownerDocument || elem) !== document) {\n        setDocument(elem);\n      }\n      expr = expr.replace(rattributeQuotes, '=\\'$1\\']');\n      if (support.matchesSelector && documentIsHTML && (!rbuggyMatches || !rbuggyMatches.test(expr)) && (!rbuggyQSA || !rbuggyQSA.test(expr))) {\n        try {\n          var ret = matches.call(elem, expr);\n          if (ret || support.disconnectedMatch || elem.document && elem.document.nodeType !== 11) {\n            return ret;\n          }\n        } catch (e) {\n        }\n      }\n      return Sizzle(expr, document, null, [elem]).length > 0;\n    };\n    Sizzle.contains = function (context, elem) {\n      if ((context.ownerDocument || context) !== document) {\n        setDocument(context);\n      }\n      return contains$1(context, elem);\n    };\n    Sizzle.attr = function (elem, name) {\n      if ((elem.ownerDocument || elem) !== document) {\n        setDocument(elem);\n      }\n      var fn = Expr.attrHandle[name.toLowerCase()], val = fn && hasOwn.call(Expr.attrHandle, name.toLowerCase()) ? fn(elem, name, !documentIsHTML) : undefined;\n      return val !== undefined ? val : support.attributes || !documentIsHTML ? elem.getAttribute(name) : (val = elem.getAttributeNode(name)) && val.specified ? val.value : null;\n    };\n    Sizzle.error = function (msg) {\n      throw new Error('Syntax error, unrecognized expression: ' + msg);\n    };\n    Sizzle.uniqueSort = function (results) {\n      var elem, duplicates = [], j = 0, i = 0;\n      hasDuplicate = !support.detectDuplicates;\n      sortInput = !support.sortStable && results.slice(0);\n      results.sort(sortOrder);\n      if (hasDuplicate) {\n        while (elem = results[i++]) {\n          if (elem === results[i]) {\n            j = duplicates.push(i);\n          }\n        }\n        while (j--) {\n          results.splice(duplicates[j], 1);\n        }\n      }\n      sortInput = null;\n      return results;\n    };\n    getText = Sizzle.getText = function (elem) {\n      var node, ret = '', i = 0, nodeType = elem.nodeType;\n      if (!nodeType) {\n        while (node = elem[i++]) {\n          ret += getText(node);\n        }\n      } else if (nodeType === 1 || nodeType === 9 || nodeType === 11) {\n        if (typeof elem.textContent === 'string') {\n          return elem.textContent;\n        } else {\n          for (elem = elem.firstChild; elem; elem = elem.nextSibling) {\n            ret += getText(elem);\n          }\n        }\n      } else if (nodeType === 3 || nodeType === 4) {\n        return elem.nodeValue;\n      }\n      return ret;\n    };\n    Expr = Sizzle.selectors = {\n      cacheLength: 50,\n      createPseudo: markFunction,\n      match: matchExpr,\n      attrHandle: {},\n      find: {},\n      relative: {\n        '>': {\n          dir: 'parentNode',\n          first: true\n        },\n        ' ': { dir: 'parentNode' },\n        '+': {\n          dir: 'previousSibling',\n          first: true\n        },\n        '~': { dir: 'previousSibling' }\n      },\n      preFilter: {\n        ATTR: function (match) {\n          match[1] = match[1].replace(runescape, funescape);\n          match[3] = (match[3] || match[4] || match[5] || '').replace(runescape, funescape);\n          if (match[2] === '~=') {\n            match[3] = ' ' + match[3] + ' ';\n          }\n          return match.slice(0, 4);\n        },\n        CHILD: function (match) {\n          match[1] = match[1].toLowerCase();\n          if (match[1].slice(0, 3) === 'nth') {\n            if (!match[3]) {\n              Sizzle.error(match[0]);\n            }\n            match[4] = +(match[4] ? match[5] + (match[6] || 1) : 2 * (match[3] === 'even' || match[3] === 'odd'));\n            match[5] = +(match[7] + match[8] || match[3] === 'odd');\n          } else if (match[3]) {\n            Sizzle.error(match[0]);\n          }\n          return match;\n        },\n        PSEUDO: function (match) {\n          var excess, unquoted = !match[6] && match[2];\n          if (matchExpr.CHILD.test(match[0])) {\n            return null;\n          }\n          if (match[3]) {\n            match[2] = match[4] || match[5] || '';\n          } else if (unquoted && rpseudo.test(unquoted) && (excess = tokenize(unquoted, true)) && (excess = unquoted.indexOf(')', unquoted.length - excess) - unquoted.length)) {\n            match[0] = match[0].slice(0, excess);\n            match[2] = unquoted.slice(0, excess);\n          }\n          return match.slice(0, 3);\n        }\n      },\n      filter: {\n        TAG: function (nodeNameSelector) {\n          var nodeName = nodeNameSelector.replace(runescape, funescape).toLowerCase();\n          return nodeNameSelector === '*' ? function () {\n            return true;\n          } : function (elem) {\n            return elem.nodeName && elem.nodeName.toLowerCase() === nodeName;\n          };\n        },\n        CLASS: function (className) {\n          var pattern = classCache[className + ' '];\n          return pattern || (pattern = new RegExp('(^|' + whitespace + ')' + className + '(' + whitespace + '|$)')) && classCache(className, function (elem) {\n            return pattern.test(typeof elem.className === 'string' && elem.className || typeof elem.getAttribute !== strundefined && elem.getAttribute('class') || '');\n          });\n        },\n        ATTR: function (name, operator, check) {\n          return function (elem) {\n            var result = Sizzle.attr(elem, name);\n            if (result == null) {\n              return operator === '!=';\n            }\n            if (!operator) {\n              return true;\n            }\n            result += '';\n            return operator === '=' ? result === check : operator === '!=' ? result !== check : operator === '^=' ? check && result.indexOf(check) === 0 : operator === '*=' ? check && result.indexOf(check) > -1 : operator === '$=' ? check && result.slice(-check.length) === check : operator === '~=' ? (' ' + result + ' ').indexOf(check) > -1 : operator === '|=' ? result === check || result.slice(0, check.length + 1) === check + '-' : false;\n          };\n        },\n        CHILD: function (type, what, argument, first, last) {\n          var simple = type.slice(0, 3) !== 'nth', forward = type.slice(-4) !== 'last', ofType = what === 'of-type';\n          return first === 1 && last === 0 ? function (elem) {\n            return !!elem.parentNode;\n          } : function (elem, context, xml) {\n            var cache, outerCache, node, diff, nodeIndex, start, dir = simple !== forward ? 'nextSibling' : 'previousSibling', parent = elem.parentNode, name = ofType && elem.nodeName.toLowerCase(), useCache = !xml && !ofType;\n            if (parent) {\n              if (simple) {\n                while (dir) {\n                  node = elem;\n                  while (node = node[dir]) {\n                    if (ofType ? node.nodeName.toLowerCase() === name : node.nodeType === 1) {\n                      return false;\n                    }\n                  }\n                  start = dir = type === 'only' && !start && 'nextSibling';\n                }\n                return true;\n              }\n              start = [forward ? parent.firstChild : parent.lastChild];\n              if (forward && useCache) {\n                outerCache = parent[expando] || (parent[expando] = {});\n                cache = outerCache[type] || [];\n                nodeIndex = cache[0] === dirruns && cache[1];\n                diff = cache[0] === dirruns && cache[2];\n                node = nodeIndex && parent.childNodes[nodeIndex];\n                while (node = ++nodeIndex && node && node[dir] || (diff = nodeIndex = 0) || start.pop()) {\n                  if (node.nodeType === 1 && ++diff && node === elem) {\n                    outerCache[type] = [\n                      dirruns,\n                      nodeIndex,\n                      diff\n                    ];\n                    break;\n                  }\n                }\n              } else if (useCache && (cache = (elem[expando] || (elem[expando] = {}))[type]) && cache[0] === dirruns) {\n                diff = cache[1];\n              } else {\n                while (node = ++nodeIndex && node && node[dir] || (diff = nodeIndex = 0) || start.pop()) {\n                  if ((ofType ? node.nodeName.toLowerCase() === name : node.nodeType === 1) && ++diff) {\n                    if (useCache) {\n                      (node[expando] || (node[expando] = {}))[type] = [\n                        dirruns,\n                        diff\n                      ];\n                    }\n                    if (node === elem) {\n                      break;\n                    }\n                  }\n                }\n              }\n              diff -= last;\n              return diff === first || diff % first === 0 && diff / first >= 0;\n            }\n          };\n        },\n        PSEUDO: function (pseudo, argument) {\n          var args, fn = Expr.pseudos[pseudo] || Expr.setFilters[pseudo.toLowerCase()] || Sizzle.error('unsupported pseudo: ' + pseudo);\n          if (fn[expando]) {\n            return fn(argument);\n          }\n          if (fn.length > 1) {\n            args = [\n              pseudo,\n              pseudo,\n              '',\n              argument\n            ];\n            return Expr.setFilters.hasOwnProperty(pseudo.toLowerCase()) ? markFunction(function (seed, matches) {\n              var idx, matched = fn(seed, argument), i = matched.length;\n              while (i--) {\n                idx = indexOf$1.call(seed, matched[i]);\n                seed[idx] = !(matches[idx] = matched[i]);\n              }\n            }) : function (elem) {\n              return fn(elem, 0, args);\n            };\n          }\n          return fn;\n        }\n      },\n      pseudos: {\n        not: markFunction(function (selector) {\n          var input = [], results = [], matcher = compile(selector.replace(rtrim, '$1'));\n          return matcher[expando] ? markFunction(function (seed, matches, context, xml) {\n            var elem, unmatched = matcher(seed, null, xml, []), i = seed.length;\n            while (i--) {\n              if (elem = unmatched[i]) {\n                seed[i] = !(matches[i] = elem);\n              }\n            }\n          }) : function (elem, context, xml) {\n            input[0] = elem;\n            matcher(input, null, xml, results);\n            return !results.pop();\n          };\n        }),\n        has: markFunction(function (selector) {\n          return function (elem) {\n            return Sizzle(selector, elem).length > 0;\n          };\n        }),\n        contains: markFunction(function (text) {\n          text = text.replace(runescape, funescape);\n          return function (elem) {\n            return (elem.textContent || elem.innerText || getText(elem)).indexOf(text) > -1;\n          };\n        }),\n        lang: markFunction(function (lang) {\n          if (!ridentifier.test(lang || '')) {\n            Sizzle.error('unsupported lang: ' + lang);\n          }\n          lang = lang.replace(runescape, funescape).toLowerCase();\n          return function (elem) {\n            var elemLang;\n            do {\n              if (elemLang = documentIsHTML ? elem.lang : elem.getAttribute('xml:lang') || elem.getAttribute('lang')) {\n                elemLang = elemLang.toLowerCase();\n                return elemLang === lang || elemLang.indexOf(lang + '-') === 0;\n              }\n            } while ((elem = elem.parentNode) && elem.nodeType === 1);\n            return false;\n          };\n        }),\n        target: function (elem) {\n          var hash = domGlobals.window.location && domGlobals.window.location.hash;\n          return hash && hash.slice(1) === elem.id;\n        },\n        root: function (elem) {\n          return elem === docElem;\n        },\n        focus: function (elem) {\n          return elem === document.activeElement && (!document.hasFocus || document.hasFocus()) && !!(elem.type || elem.href || ~elem.tabIndex);\n        },\n        enabled: function (elem) {\n          return elem.disabled === false;\n        },\n        disabled: function (elem) {\n          return elem.disabled === true;\n        },\n        checked: function (elem) {\n          var nodeName = elem.nodeName.toLowerCase();\n          return nodeName === 'input' && !!elem.checked || nodeName === 'option' && !!elem.selected;\n        },\n        selected: function (elem) {\n          if (elem.parentNode) {\n            elem.parentNode.selectedIndex;\n          }\n          return elem.selected === true;\n        },\n        empty: function (elem) {\n          for (elem = elem.firstChild; elem; elem = elem.nextSibling) {\n            if (elem.nodeType < 6) {\n              return false;\n            }\n          }\n          return true;\n        },\n        parent: function (elem) {\n          return !Expr.pseudos.empty(elem);\n        },\n        header: function (elem) {\n          return rheader.test(elem.nodeName);\n        },\n        input: function (elem) {\n          return rinputs.test(elem.nodeName);\n        },\n        button: function (elem) {\n          var name = elem.nodeName.toLowerCase();\n          return name === 'input' && elem.type === 'button' || name === 'button';\n        },\n        text: function (elem) {\n          var attr;\n          return elem.nodeName.toLowerCase() === 'input' && elem.type === 'text' && ((attr = elem.getAttribute('type')) == null || attr.toLowerCase() === 'text');\n        },\n        first: createPositionalPseudo(function () {\n          return [0];\n        }),\n        last: createPositionalPseudo(function (matchIndexes, length) {\n          return [length - 1];\n        }),\n        eq: createPositionalPseudo(function (matchIndexes, length, argument) {\n          return [argument < 0 ? argument + length : argument];\n        }),\n        even: createPositionalPseudo(function (matchIndexes, length) {\n          var i = 0;\n          for (; i < length; i += 2) {\n            matchIndexes.push(i);\n          }\n          return matchIndexes;\n        }),\n        odd: createPositionalPseudo(function (matchIndexes, length) {\n          var i = 1;\n          for (; i < length; i += 2) {\n            matchIndexes.push(i);\n          }\n          return matchIndexes;\n        }),\n        lt: createPositionalPseudo(function (matchIndexes, length, argument) {\n          var i = argument < 0 ? argument + length : argument;\n          for (; --i >= 0;) {\n            matchIndexes.push(i);\n          }\n          return matchIndexes;\n        }),\n        gt: createPositionalPseudo(function (matchIndexes, length, argument) {\n          var i = argument < 0 ? argument + length : argument;\n          for (; ++i < length;) {\n            matchIndexes.push(i);\n          }\n          return matchIndexes;\n        })\n      }\n    };\n    Expr.pseudos.nth = Expr.pseudos.eq;\n    for (i in {\n        radio: true,\n        checkbox: true,\n        file: true,\n        password: true,\n        image: true\n      }) {\n      Expr.pseudos[i] = createInputPseudo(i);\n    }\n    for (i in {\n        submit: true,\n        reset: true\n      }) {\n      Expr.pseudos[i] = createButtonPseudo(i);\n    }\n    function setFilters() {\n    }\n    setFilters.prototype = Expr.filters = Expr.pseudos;\n    Expr.setFilters = new setFilters();\n    tokenize = Sizzle.tokenize = function (selector, parseOnly) {\n      var matched, match, tokens, type, soFar, groups, preFilters, cached = tokenCache[selector + ' '];\n      if (cached) {\n        return parseOnly ? 0 : cached.slice(0);\n      }\n      soFar = selector;\n      groups = [];\n      preFilters = Expr.preFilter;\n      while (soFar) {\n        if (!matched || (match = rcomma.exec(soFar))) {\n          if (match) {\n            soFar = soFar.slice(match[0].length) || soFar;\n          }\n          groups.push(tokens = []);\n        }\n        matched = false;\n        if (match = rcombinators.exec(soFar)) {\n          matched = match.shift();\n          tokens.push({\n            value: matched,\n            type: match[0].replace(rtrim, ' ')\n          });\n          soFar = soFar.slice(matched.length);\n        }\n        for (type in Expr.filter) {\n          if ((match = matchExpr[type].exec(soFar)) && (!preFilters[type] || (match = preFilters[type](match)))) {\n            matched = match.shift();\n            tokens.push({\n              value: matched,\n              type: type,\n              matches: match\n            });\n            soFar = soFar.slice(matched.length);\n          }\n        }\n        if (!matched) {\n          break;\n        }\n      }\n      return parseOnly ? soFar.length : soFar ? Sizzle.error(selector) : tokenCache(selector, groups).slice(0);\n    };\n    function toSelector(tokens) {\n      var i = 0, len = tokens.length, selector = '';\n      for (; i < len; i++) {\n        selector += tokens[i].value;\n      }\n      return selector;\n    }\n    function addCombinator(matcher, combinator, base) {\n      var dir = combinator.dir, checkNonElements = base && dir === 'parentNode', doneName = done++;\n      return combinator.first ? function (elem, context, xml) {\n        while (elem = elem[dir]) {\n          if (elem.nodeType === 1 || checkNonElements) {\n            return matcher(elem, context, xml);\n          }\n        }\n      } : function (elem, context, xml) {\n        var oldCache, outerCache, newCache = [\n            dirruns,\n            doneName\n          ];\n        if (xml) {\n          while (elem = elem[dir]) {\n            if (elem.nodeType === 1 || checkNonElements) {\n              if (matcher(elem, context, xml)) {\n                return true;\n              }\n            }\n          }\n        } else {\n          while (elem = elem[dir]) {\n            if (elem.nodeType === 1 || checkNonElements) {\n              outerCache = elem[expando] || (elem[expando] = {});\n              if ((oldCache = outerCache[dir]) && oldCache[0] === dirruns && oldCache[1] === doneName) {\n                return newCache[2] = oldCache[2];\n              } else {\n                outerCache[dir] = newCache;\n                if (newCache[2] = matcher(elem, context, xml)) {\n                  return true;\n                }\n              }\n            }\n          }\n        }\n      };\n    }\n    function elementMatcher(matchers) {\n      return matchers.length > 1 ? function (elem, context, xml) {\n        var i = matchers.length;\n        while (i--) {\n          if (!matchers[i](elem, context, xml)) {\n            return false;\n          }\n        }\n        return true;\n      } : matchers[0];\n    }\n    function multipleContexts(selector, contexts, results) {\n      var i = 0, len = contexts.length;\n      for (; i < len; i++) {\n        Sizzle(selector, contexts[i], results);\n      }\n      return results;\n    }\n    function condense(unmatched, map, filter, context, xml) {\n      var elem, newUnmatched = [], i = 0, len = unmatched.length, mapped = map != null;\n      for (; i < len; i++) {\n        if (elem = unmatched[i]) {\n          if (!filter || filter(elem, context, xml)) {\n            newUnmatched.push(elem);\n            if (mapped) {\n              map.push(i);\n            }\n          }\n        }\n      }\n      return newUnmatched;\n    }\n    function setMatcher(preFilter, selector, matcher, postFilter, postFinder, postSelector) {\n      if (postFilter && !postFilter[expando]) {\n        postFilter = setMatcher(postFilter);\n      }\n      if (postFinder && !postFinder[expando]) {\n        postFinder = setMatcher(postFinder, postSelector);\n      }\n      return markFunction(function (seed, results, context, xml) {\n        var temp, i, elem, preMap = [], postMap = [], preexisting = results.length, elems = seed || multipleContexts(selector || '*', context.nodeType ? [context] : context, []), matcherIn = preFilter && (seed || !selector) ? condense(elems, preMap, preFilter, context, xml) : elems, matcherOut = matcher ? postFinder || (seed ? preFilter : preexisting || postFilter) ? [] : results : matcherIn;\n        if (matcher) {\n          matcher(matcherIn, matcherOut, context, xml);\n        }\n        if (postFilter) {\n          temp = condense(matcherOut, postMap);\n          postFilter(temp, [], context, xml);\n          i = temp.length;\n          while (i--) {\n            if (elem = temp[i]) {\n              matcherOut[postMap[i]] = !(matcherIn[postMap[i]] = elem);\n            }\n          }\n        }\n        if (seed) {\n          if (postFinder || preFilter) {\n            if (postFinder) {\n              temp = [];\n              i = matcherOut.length;\n              while (i--) {\n                if (elem = matcherOut[i]) {\n                  temp.push(matcherIn[i] = elem);\n                }\n              }\n              postFinder(null, matcherOut = [], temp, xml);\n            }\n            i = matcherOut.length;\n            while (i--) {\n              if ((elem = matcherOut[i]) && (temp = postFinder ? indexOf$1.call(seed, elem) : preMap[i]) > -1) {\n                seed[temp] = !(results[temp] = elem);\n              }\n            }\n          }\n        } else {\n          matcherOut = condense(matcherOut === results ? matcherOut.splice(preexisting, matcherOut.length) : matcherOut);\n          if (postFinder) {\n            postFinder(null, results, matcherOut, xml);\n          } else {\n            push.apply(results, matcherOut);\n          }\n        }\n      });\n    }\n    function matcherFromTokens(tokens) {\n      var checkContext, matcher, j, len = tokens.length, leadingRelative = Expr.relative[tokens[0].type], implicitRelative = leadingRelative || Expr.relative[' '], i = leadingRelative ? 1 : 0, matchContext = addCombinator(function (elem) {\n          return elem === checkContext;\n        }, implicitRelative, true), matchAnyContext = addCombinator(function (elem) {\n          return indexOf$1.call(checkContext, elem) > -1;\n        }, implicitRelative, true), matchers = [function (elem, context, xml) {\n            return !leadingRelative && (xml || context !== outermostContext) || ((checkContext = context).nodeType ? matchContext(elem, context, xml) : matchAnyContext(elem, context, xml));\n          }];\n      for (; i < len; i++) {\n        if (matcher = Expr.relative[tokens[i].type]) {\n          matchers = [addCombinator(elementMatcher(matchers), matcher)];\n        } else {\n          matcher = Expr.filter[tokens[i].type].apply(null, tokens[i].matches);\n          if (matcher[expando]) {\n            j = ++i;\n            for (; j < len; j++) {\n              if (Expr.relative[tokens[j].type]) {\n                break;\n              }\n            }\n            return setMatcher(i > 1 && elementMatcher(matchers), i > 1 && toSelector(tokens.slice(0, i - 1).concat({ value: tokens[i - 2].type === ' ' ? '*' : '' })).replace(rtrim, '$1'), matcher, i < j && matcherFromTokens(tokens.slice(i, j)), j < len && matcherFromTokens(tokens = tokens.slice(j)), j < len && toSelector(tokens));\n          }\n          matchers.push(matcher);\n        }\n      }\n      return elementMatcher(matchers);\n    }\n    function matcherFromGroupMatchers(elementMatchers, setMatchers) {\n      var bySet = setMatchers.length > 0, byElement = elementMatchers.length > 0, superMatcher = function (seed, context, xml, results, outermost) {\n          var elem, j, matcher, matchedCount = 0, i = '0', unmatched = seed && [], setMatched = [], contextBackup = outermostContext, elems = seed || byElement && Expr.find.TAG('*', outermost), dirrunsUnique = dirruns += contextBackup == null ? 1 : Math.random() || 0.1, len = elems.length;\n          if (outermost) {\n            outermostContext = context !== document && context;\n          }\n          for (; i !== len && (elem = elems[i]) != null; i++) {\n            if (byElement && elem) {\n              j = 0;\n              while (matcher = elementMatchers[j++]) {\n                if (matcher(elem, context, xml)) {\n                  results.push(elem);\n                  break;\n                }\n              }\n              if (outermost) {\n                dirruns = dirrunsUnique;\n              }\n            }\n            if (bySet) {\n              if (elem = !matcher && elem) {\n                matchedCount--;\n              }\n              if (seed) {\n                unmatched.push(elem);\n              }\n            }\n          }\n          matchedCount += i;\n          if (bySet && i !== matchedCount) {\n            j = 0;\n            while (matcher = setMatchers[j++]) {\n              matcher(unmatched, setMatched, context, xml);\n            }\n            if (seed) {\n              if (matchedCount > 0) {\n                while (i--) {\n                  if (!(unmatched[i] || setMatched[i])) {\n                    setMatched[i] = pop.call(results);\n                  }\n                }\n              }\n              setMatched = condense(setMatched);\n            }\n            push.apply(results, setMatched);\n            if (outermost && !seed && setMatched.length > 0 && matchedCount + setMatchers.length > 1) {\n              Sizzle.uniqueSort(results);\n            }\n          }\n          if (outermost) {\n            dirruns = dirrunsUnique;\n            outermostContext = contextBackup;\n          }\n          return unmatched;\n        };\n      return bySet ? markFunction(superMatcher) : superMatcher;\n    }\n    compile = Sizzle.compile = function (selector, match) {\n      var i, setMatchers = [], elementMatchers = [], cached = compilerCache[selector + ' '];\n      if (!cached) {\n        if (!match) {\n          match = tokenize(selector);\n        }\n        i = match.length;\n        while (i--) {\n          cached = matcherFromTokens(match[i]);\n          if (cached[expando]) {\n            setMatchers.push(cached);\n          } else {\n            elementMatchers.push(cached);\n          }\n        }\n        cached = compilerCache(selector, matcherFromGroupMatchers(elementMatchers, setMatchers));\n        cached.selector = selector;\n      }\n      return cached;\n    };\n    select = Sizzle.select = function (selector, context, results, seed) {\n      var i, tokens, token, type, find, compiled = typeof selector === 'function' && selector, match = !seed && tokenize(selector = compiled.selector || selector);\n      results = results || [];\n      if (match.length === 1) {\n        tokens = match[0] = match[0].slice(0);\n        if (tokens.length > 2 && (token = tokens[0]).type === 'ID' && support.getById && context.nodeType === 9 && documentIsHTML && Expr.relative[tokens[1].type]) {\n          context = (Expr.find.ID(token.matches[0].replace(runescape, funescape), context) || [])[0];\n          if (!context) {\n            return results;\n          } else if (compiled) {\n            context = context.parentNode;\n          }\n          selector = selector.slice(tokens.shift().value.length);\n        }\n        i = matchExpr.needsContext.test(selector) ? 0 : tokens.length;\n        while (i--) {\n          token = tokens[i];\n          if (Expr.relative[type = token.type]) {\n            break;\n          }\n          if (find = Expr.find[type]) {\n            if (seed = find(token.matches[0].replace(runescape, funescape), rsibling.test(tokens[0].type) && testContext(context.parentNode) || context)) {\n              tokens.splice(i, 1);\n              selector = seed.length && toSelector(tokens);\n              if (!selector) {\n                push.apply(results, seed);\n                return results;\n              }\n              break;\n            }\n          }\n        }\n      }\n      (compiled || compile(selector, match))(seed, context, !documentIsHTML, results, rsibling.test(selector) && testContext(context.parentNode) || context);\n      return results;\n    };\n    support.sortStable = expando.split('').sort(sortOrder).join('') === expando;\n    support.detectDuplicates = !!hasDuplicate;\n    setDocument();\n    support.sortDetached = true;\n\n    var isArray$1 = Array.isArray;\n    var toArray = function (obj) {\n      var array = obj, i, l;\n      if (!isArray$1(obj)) {\n        array = [];\n        for (i = 0, l = obj.length; i < l; i++) {\n          array[i] = obj[i];\n        }\n      }\n      return array;\n    };\n    var each$1 = function (o, cb, s) {\n      var n, l;\n      if (!o) {\n        return 0;\n      }\n      s = s || o;\n      if (o.length !== undefined) {\n        for (n = 0, l = o.length; n < l; n++) {\n          if (cb.call(s, o[n], n, o) === false) {\n            return 0;\n          }\n        }\n      } else {\n        for (n in o) {\n          if (o.hasOwnProperty(n)) {\n            if (cb.call(s, o[n], n, o) === false) {\n              return 0;\n            }\n          }\n        }\n      }\n      return 1;\n    };\n    var map$1 = function (array, callback) {\n      var out = [];\n      each$1(array, function (item, index) {\n        out.push(callback(item, index, array));\n      });\n      return out;\n    };\n    var filter$1 = function (a, f) {\n      var o = [];\n      each$1(a, function (v, index) {\n        if (!f || f(v, index, a)) {\n          o.push(v);\n        }\n      });\n      return o;\n    };\n    var indexOf$2 = function (a, v) {\n      var i, l;\n      if (a) {\n        for (i = 0, l = a.length; i < l; i++) {\n          if (a[i] === v) {\n            return i;\n          }\n        }\n      }\n      return -1;\n    };\n    var reduce = function (collection, iteratee, accumulator, thisArg) {\n      var i = 0;\n      if (arguments.length < 3) {\n        accumulator = collection[0];\n      }\n      for (; i < collection.length; i++) {\n        accumulator = iteratee.call(thisArg, accumulator, collection[i], i);\n      }\n      return accumulator;\n    };\n    var findIndex$1 = function (array, predicate, thisArg) {\n      var i, l;\n      for (i = 0, l = array.length; i < l; i++) {\n        if (predicate.call(thisArg, array[i], i, array)) {\n          return i;\n        }\n      }\n      return -1;\n    };\n    var find$1 = function (array, predicate, thisArg) {\n      var idx = findIndex$1(array, predicate, thisArg);\n      if (idx !== -1) {\n        return array[idx];\n      }\n      return undefined;\n    };\n    var last$1 = function (collection) {\n      return collection[collection.length - 1];\n    };\n    var ArrUtils = {\n      isArray: isArray$1,\n      toArray: toArray,\n      each: each$1,\n      map: map$1,\n      filter: filter$1,\n      indexOf: indexOf$2,\n      reduce: reduce,\n      findIndex: findIndex$1,\n      find: find$1,\n      last: last$1\n    };\n\n    var whiteSpaceRegExp = /^\\s*|\\s*$/g;\n    var trim = function (str) {\n      return str === null || str === undefined ? '' : ('' + str).replace(whiteSpaceRegExp, '');\n    };\n    var is = function (obj, type) {\n      if (!type) {\n        return obj !== undefined;\n      }\n      if (type === 'array' && ArrUtils.isArray(obj)) {\n        return true;\n      }\n      return typeof obj === type;\n    };\n    var makeMap = function (items, delim, map) {\n      var i;\n      items = items || [];\n      delim = delim || ',';\n      if (typeof items === 'string') {\n        items = items.split(delim);\n      }\n      map = map || {};\n      i = items.length;\n      while (i--) {\n        map[items[i]] = {};\n      }\n      return map;\n    };\n    var hasOwnProperty = function (obj, prop) {\n      return Object.prototype.hasOwnProperty.call(obj, prop);\n    };\n    var create = function (s, p, root) {\n      var self = this;\n      var sp, ns, cn, scn, c, de = 0;\n      s = /^((static) )?([\\w.]+)(:([\\w.]+))?/.exec(s);\n      cn = s[3].match(/(^|\\.)(\\w+)$/i)[2];\n      ns = self.createNS(s[3].replace(/\\.\\w+$/, ''), root);\n      if (ns[cn]) {\n        return;\n      }\n      if (s[2] === 'static') {\n        ns[cn] = p;\n        if (this.onCreate) {\n          this.onCreate(s[2], s[3], ns[cn]);\n        }\n        return;\n      }\n      if (!p[cn]) {\n        p[cn] = function () {\n        };\n        de = 1;\n      }\n      ns[cn] = p[cn];\n      self.extend(ns[cn].prototype, p);\n      if (s[5]) {\n        sp = self.resolve(s[5]).prototype;\n        scn = s[5].match(/\\.(\\w+)$/i)[1];\n        c = ns[cn];\n        if (de) {\n          ns[cn] = function () {\n            return sp[scn].apply(this, arguments);\n          };\n        } else {\n          ns[cn] = function () {\n            this.parent = sp[scn];\n            return c.apply(this, arguments);\n          };\n        }\n        ns[cn].prototype[cn] = ns[cn];\n        self.each(sp, function (f, n) {\n          ns[cn].prototype[n] = sp[n];\n        });\n        self.each(p, function (f, n) {\n          if (sp[n]) {\n            ns[cn].prototype[n] = function () {\n              this.parent = sp[n];\n              return f.apply(this, arguments);\n            };\n          } else {\n            if (n !== cn) {\n              ns[cn].prototype[n] = f;\n            }\n          }\n        });\n      }\n      self.each(p.static, function (f, n) {\n        ns[cn][n] = f;\n      });\n    };\n    var extend = function (obj, ext) {\n      var x = [];\n      for (var _i = 2; _i < arguments.length; _i++) {\n        x[_i - 2] = arguments[_i];\n      }\n      var i, l, name;\n      var args = arguments;\n      var value;\n      for (i = 1, l = args.length; i < l; i++) {\n        ext = args[i];\n        for (name in ext) {\n          if (ext.hasOwnProperty(name)) {\n            value = ext[name];\n            if (value !== undefined) {\n              obj[name] = value;\n            }\n          }\n        }\n      }\n      return obj;\n    };\n    var walk = function (o, f, n, s) {\n      s = s || this;\n      if (o) {\n        if (n) {\n          o = o[n];\n        }\n        ArrUtils.each(o, function (o, i) {\n          if (f.call(s, o, i, n) === false) {\n            return false;\n          }\n          walk(o, f, n, s);\n        });\n      }\n    };\n    var createNS = function (n, o) {\n      var i, v;\n      o = o || domGlobals.window;\n      n = n.split('.');\n      for (i = 0; i < n.length; i++) {\n        v = n[i];\n        if (!o[v]) {\n          o[v] = {};\n        }\n        o = o[v];\n      }\n      return o;\n    };\n    var resolve$1 = function (n, o) {\n      var i, l;\n      o = o || domGlobals.window;\n      n = n.split('.');\n      for (i = 0, l = n.length; i < l; i++) {\n        o = o[n[i]];\n        if (!o) {\n          break;\n        }\n      }\n      return o;\n    };\n    var explode = function (s, d) {\n      if (!s || is(s, 'array')) {\n        return s;\n      }\n      return ArrUtils.map(s.split(d || ','), trim);\n    };\n    var _addCacheSuffix = function (url) {\n      var cacheSuffix = Env.cacheSuffix;\n      if (cacheSuffix) {\n        url += (url.indexOf('?') === -1 ? '?' : '&') + cacheSuffix;\n      }\n      return url;\n    };\n    var Tools = {\n      trim: trim,\n      isArray: ArrUtils.isArray,\n      is: is,\n      toArray: ArrUtils.toArray,\n      makeMap: makeMap,\n      each: ArrUtils.each,\n      map: ArrUtils.map,\n      grep: ArrUtils.filter,\n      inArray: ArrUtils.indexOf,\n      hasOwn: hasOwnProperty,\n      extend: extend,\n      create: create,\n      walk: walk,\n      createNS: createNS,\n      resolve: resolve$1,\n      explode: explode,\n      _addCacheSuffix: _addCacheSuffix\n    };\n\n    var doc = domGlobals.document, push$1 = Array.prototype.push, slice$1 = Array.prototype.slice;\n    var rquickExpr$1 = /^(?:[^#<]*(<[\\w\\W]+>)[^>]*$|#([\\w\\-]*)$)/;\n    var Event = EventUtils.Event;\n    var skipUniques = Tools.makeMap('children,contents,next,prev');\n    var isDefined = function (obj) {\n      return typeof obj !== 'undefined';\n    };\n    var isString$1 = function (obj) {\n      return typeof obj === 'string';\n    };\n    var isWindow = function (obj) {\n      return obj && obj === obj.window;\n    };\n    var createFragment = function (html, fragDoc) {\n      var frag, node, container;\n      fragDoc = fragDoc || doc;\n      container = fragDoc.createElement('div');\n      frag = fragDoc.createDocumentFragment();\n      container.innerHTML = html;\n      while (node = container.firstChild) {\n        frag.appendChild(node);\n      }\n      return frag;\n    };\n    var domManipulate = function (targetNodes, sourceItem, callback, reverse) {\n      var i;\n      if (isString$1(sourceItem)) {\n        sourceItem = createFragment(sourceItem, getElementDocument(targetNodes[0]));\n      } else if (sourceItem.length && !sourceItem.nodeType) {\n        sourceItem = DomQuery.makeArray(sourceItem);\n        if (reverse) {\n          for (i = sourceItem.length - 1; i >= 0; i--) {\n            domManipulate(targetNodes, sourceItem[i], callback, reverse);\n          }\n        } else {\n          for (i = 0; i < sourceItem.length; i++) {\n            domManipulate(targetNodes, sourceItem[i], callback, reverse);\n          }\n        }\n        return targetNodes;\n      }\n      if (sourceItem.nodeType) {\n        i = targetNodes.length;\n        while (i--) {\n          callback.call(targetNodes[i], sourceItem);\n        }\n      }\n      return targetNodes;\n    };\n    var hasClass = function (node, className) {\n      return node && className && (' ' + node.className + ' ').indexOf(' ' + className + ' ') !== -1;\n    };\n    var wrap = function (elements, wrapper, all) {\n      var lastParent, newWrapper;\n      wrapper = DomQuery(wrapper)[0];\n      elements.each(function () {\n        var self = this;\n        if (!all || lastParent !== self.parentNode) {\n          lastParent = self.parentNode;\n          newWrapper = wrapper.cloneNode(false);\n          self.parentNode.insertBefore(newWrapper, self);\n          newWrapper.appendChild(self);\n        } else {\n          newWrapper.appendChild(self);\n        }\n      });\n      return elements;\n    };\n    var numericCssMap = Tools.makeMap('fillOpacity fontWeight lineHeight opacity orphans widows zIndex zoom', ' ');\n    var booleanMap = Tools.makeMap('checked compact declare defer disabled ismap multiple nohref noshade nowrap readonly selected', ' ');\n    var propFix = {\n      for: 'htmlFor',\n      class: 'className',\n      readonly: 'readOnly'\n    };\n    var cssFix = { float: 'cssFloat' };\n    var attrHooks = {}, cssHooks = {};\n    var DomQuery = function (selector, context) {\n      return new DomQuery.fn.init(selector, context);\n    };\n    var inArray = function (item, array) {\n      var i;\n      if (array.indexOf) {\n        return array.indexOf(item);\n      }\n      i = array.length;\n      while (i--) {\n        if (array[i] === item) {\n          return i;\n        }\n      }\n      return -1;\n    };\n    var whiteSpaceRegExp$1 = /^\\s*|\\s*$/g;\n    var trim$1 = function (str) {\n      return str === null || str === undefined ? '' : ('' + str).replace(whiteSpaceRegExp$1, '');\n    };\n    var each$2 = function (obj, callback) {\n      var length, key, i, value;\n      if (obj) {\n        length = obj.length;\n        if (length === undefined) {\n          for (key in obj) {\n            if (obj.hasOwnProperty(key)) {\n              value = obj[key];\n              if (callback.call(value, key, value) === false) {\n                break;\n              }\n            }\n          }\n        } else {\n          for (i = 0; i < length; i++) {\n            value = obj[i];\n            if (callback.call(value, i, value) === false) {\n              break;\n            }\n          }\n        }\n      }\n      return obj;\n    };\n    var grep = function (array, callback) {\n      var out = [];\n      each$2(array, function (i, item) {\n        if (callback(item, i)) {\n          out.push(item);\n        }\n      });\n      return out;\n    };\n    var getElementDocument = function (element) {\n      if (!element) {\n        return doc;\n      }\n      if (element.nodeType === 9) {\n        return element;\n      }\n      return element.ownerDocument;\n    };\n    DomQuery.fn = DomQuery.prototype = {\n      constructor: DomQuery,\n      selector: '',\n      context: null,\n      length: 0,\n      init: function (selector, context) {\n        var self = this;\n        var match, node;\n        if (!selector) {\n          return self;\n        }\n        if (selector.nodeType) {\n          self.context = self[0] = selector;\n          self.length = 1;\n          return self;\n        }\n        if (context && context.nodeType) {\n          self.context = context;\n        } else {\n          if (context) {\n            return DomQuery(selector).attr(context);\n          }\n          self.context = context = domGlobals.document;\n        }\n        if (isString$1(selector)) {\n          self.selector = selector;\n          if (selector.charAt(0) === '<' && selector.charAt(selector.length - 1) === '>' && selector.length >= 3) {\n            match = [\n              null,\n              selector,\n              null\n            ];\n          } else {\n            match = rquickExpr$1.exec(selector);\n          }\n          if (match) {\n            if (match[1]) {\n              node = createFragment(selector, getElementDocument(context)).firstChild;\n              while (node) {\n                push$1.call(self, node);\n                node = node.nextSibling;\n              }\n            } else {\n              node = getElementDocument(context).getElementById(match[2]);\n              if (!node) {\n                return self;\n              }\n              if (node.id !== match[2]) {\n                return self.find(selector);\n              }\n              self.length = 1;\n              self[0] = node;\n            }\n          } else {\n            return DomQuery(context).find(selector);\n          }\n        } else {\n          this.add(selector, false);\n        }\n        return self;\n      },\n      toArray: function () {\n        return Tools.toArray(this);\n      },\n      add: function (items, sort) {\n        var self = this;\n        var nodes, i;\n        if (isString$1(items)) {\n          return self.add(DomQuery(items));\n        }\n        if (sort !== false) {\n          nodes = DomQuery.unique(self.toArray().concat(DomQuery.makeArray(items)));\n          self.length = nodes.length;\n          for (i = 0; i < nodes.length; i++) {\n            self[i] = nodes[i];\n          }\n        } else {\n          push$1.apply(self, DomQuery.makeArray(items));\n        }\n        return self;\n      },\n      attr: function (name, value) {\n        var self = this;\n        var hook;\n        if (typeof name === 'object') {\n          each$2(name, function (name, value) {\n            self.attr(name, value);\n          });\n        } else if (isDefined(value)) {\n          this.each(function () {\n            var hook;\n            if (this.nodeType === 1) {\n              hook = attrHooks[name];\n              if (hook && hook.set) {\n                hook.set(this, value);\n                return;\n              }\n              if (value === null) {\n                this.removeAttribute(name, 2);\n              } else {\n                this.setAttribute(name, value, 2);\n              }\n            }\n          });\n        } else {\n          if (self[0] && self[0].nodeType === 1) {\n            hook = attrHooks[name];\n            if (hook && hook.get) {\n              return hook.get(self[0], name);\n            }\n            if (booleanMap[name]) {\n              return self.prop(name) ? name : undefined;\n            }\n            value = self[0].getAttribute(name, 2);\n            if (value === null) {\n              value = undefined;\n            }\n          }\n          return value;\n        }\n        return self;\n      },\n      removeAttr: function (name) {\n        return this.attr(name, null);\n      },\n      prop: function (name, value) {\n        var self = this;\n        name = propFix[name] || name;\n        if (typeof name === 'object') {\n          each$2(name, function (name, value) {\n            self.prop(name, value);\n          });\n        } else if (isDefined(value)) {\n          this.each(function () {\n            if (this.nodeType === 1) {\n              this[name] = value;\n            }\n          });\n        } else {\n          if (self[0] && self[0].nodeType && name in self[0]) {\n            return self[0][name];\n          }\n          return value;\n        }\n        return self;\n      },\n      css: function (name, value) {\n        var self = this;\n        var elm, hook;\n        var camel = function (name) {\n          return name.replace(/-(\\D)/g, function (a, b) {\n            return b.toUpperCase();\n          });\n        };\n        var dashed = function (name) {\n          return name.replace(/[A-Z]/g, function (a) {\n            return '-' + a;\n          });\n        };\n        if (typeof name === 'object') {\n          each$2(name, function (name, value) {\n            self.css(name, value);\n          });\n        } else {\n          if (isDefined(value)) {\n            name = camel(name);\n            if (typeof value === 'number' && !numericCssMap[name]) {\n              value = value.toString() + 'px';\n            }\n            self.each(function () {\n              var style = this.style;\n              hook = cssHooks[name];\n              if (hook && hook.set) {\n                hook.set(this, value);\n                return;\n              }\n              try {\n                this.style[cssFix[name] || name] = value;\n              } catch (ex) {\n              }\n              if (value === null || value === '') {\n                if (style.removeProperty) {\n                  style.removeProperty(dashed(name));\n                } else {\n                  style.removeAttribute(name);\n                }\n              }\n            });\n          } else {\n            elm = self[0];\n            hook = cssHooks[name];\n            if (hook && hook.get) {\n              return hook.get(elm);\n            }\n            if (elm.ownerDocument.defaultView) {\n              try {\n                return elm.ownerDocument.defaultView.getComputedStyle(elm, null).getPropertyValue(dashed(name));\n              } catch (ex) {\n                return undefined;\n              }\n            } else if (elm.currentStyle) {\n              return elm.currentStyle[camel(name)];\n            } else {\n              return '';\n            }\n          }\n        }\n        return self;\n      },\n      remove: function () {\n        var self = this;\n        var node, i = this.length;\n        while (i--) {\n          node = self[i];\n          Event.clean(node);\n          if (node.parentNode) {\n            node.parentNode.removeChild(node);\n          }\n        }\n        return this;\n      },\n      empty: function () {\n        var self = this;\n        var node, i = this.length;\n        while (i--) {\n          node = self[i];\n          while (node.firstChild) {\n            node.removeChild(node.firstChild);\n          }\n        }\n        return this;\n      },\n      html: function (value) {\n        var self = this;\n        var i;\n        if (isDefined(value)) {\n          i = self.length;\n          try {\n            while (i--) {\n              self[i].innerHTML = value;\n            }\n          } catch (ex) {\n            DomQuery(self[i]).empty().append(value);\n          }\n          return self;\n        }\n        return self[0] ? self[0].innerHTML : '';\n      },\n      text: function (value) {\n        var self = this;\n        var i;\n        if (isDefined(value)) {\n          i = self.length;\n          while (i--) {\n            if ('innerText' in self[i]) {\n              self[i].innerText = value;\n            } else {\n              self[0].textContent = value;\n            }\n          }\n          return self;\n        }\n        return self[0] ? self[0].innerText || self[0].textContent : '';\n      },\n      append: function () {\n        return domManipulate(this, arguments, function (node) {\n          if (this.nodeType === 1 || this.host && this.host.nodeType === 1) {\n            this.appendChild(node);\n          }\n        });\n      },\n      prepend: function () {\n        return domManipulate(this, arguments, function (node) {\n          if (this.nodeType === 1 || this.host && this.host.nodeType === 1) {\n            this.insertBefore(node, this.firstChild);\n          }\n        }, true);\n      },\n      before: function () {\n        var self = this;\n        if (self[0] && self[0].parentNode) {\n          return domManipulate(self, arguments, function (node) {\n            this.parentNode.insertBefore(node, this);\n          });\n        }\n        return self;\n      },\n      after: function () {\n        var self = this;\n        if (self[0] && self[0].parentNode) {\n          return domManipulate(self, arguments, function (node) {\n            this.parentNode.insertBefore(node, this.nextSibling);\n          }, true);\n        }\n        return self;\n      },\n      appendTo: function (val) {\n        DomQuery(val).append(this);\n        return this;\n      },\n      prependTo: function (val) {\n        DomQuery(val).prepend(this);\n        return this;\n      },\n      replaceWith: function (content) {\n        return this.before(content).remove();\n      },\n      wrap: function (content) {\n        return wrap(this, content);\n      },\n      wrapAll: function (content) {\n        return wrap(this, content, true);\n      },\n      wrapInner: function (content) {\n        this.each(function () {\n          DomQuery(this).contents().wrapAll(content);\n        });\n        return this;\n      },\n      unwrap: function () {\n        return this.parent().each(function () {\n          DomQuery(this).replaceWith(this.childNodes);\n        });\n      },\n      clone: function () {\n        var result = [];\n        this.each(function () {\n          result.push(this.cloneNode(true));\n        });\n        return DomQuery(result);\n      },\n      addClass: function (className) {\n        return this.toggleClass(className, true);\n      },\n      removeClass: function (className) {\n        return this.toggleClass(className, false);\n      },\n      toggleClass: function (className, state) {\n        var self = this;\n        if (typeof className !== 'string') {\n          return self;\n        }\n        if (className.indexOf(' ') !== -1) {\n          each$2(className.split(' '), function () {\n            self.toggleClass(this, state);\n          });\n        } else {\n          self.each(function (index, node) {\n            var existingClassName, classState;\n            classState = hasClass(node, className);\n            if (classState !== state) {\n              existingClassName = node.className;\n              if (classState) {\n                node.className = trim$1((' ' + existingClassName + ' ').replace(' ' + className + ' ', ' '));\n              } else {\n                node.className += existingClassName ? ' ' + className : className;\n              }\n            }\n          });\n        }\n        return self;\n      },\n      hasClass: function (className) {\n        return hasClass(this[0], className);\n      },\n      each: function (callback) {\n        return each$2(this, callback);\n      },\n      on: function (name, callback) {\n        return this.each(function () {\n          Event.bind(this, name, callback);\n        });\n      },\n      off: function (name, callback) {\n        return this.each(function () {\n          Event.unbind(this, name, callback);\n        });\n      },\n      trigger: function (name) {\n        return this.each(function () {\n          if (typeof name === 'object') {\n            Event.fire(this, name.type, name);\n          } else {\n            Event.fire(this, name);\n          }\n        });\n      },\n      show: function () {\n        return this.css('display', '');\n      },\n      hide: function () {\n        return this.css('display', 'none');\n      },\n      slice: function () {\n        return new DomQuery(slice$1.apply(this, arguments));\n      },\n      eq: function (index) {\n        return index === -1 ? this.slice(index) : this.slice(index, +index + 1);\n      },\n      first: function () {\n        return this.eq(0);\n      },\n      last: function () {\n        return this.eq(-1);\n      },\n      find: function (selector) {\n        var i, l;\n        var ret = [];\n        for (i = 0, l = this.length; i < l; i++) {\n          DomQuery.find(selector, this[i], ret);\n        }\n        return DomQuery(ret);\n      },\n      filter: function (selector) {\n        if (typeof selector === 'function') {\n          return DomQuery(grep(this.toArray(), function (item, i) {\n            return selector(i, item);\n          }));\n        }\n        return DomQuery(DomQuery.filter(selector, this.toArray()));\n      },\n      closest: function (selector) {\n        var result = [];\n        if (selector instanceof DomQuery) {\n          selector = selector[0];\n        }\n        this.each(function (i, node) {\n          while (node) {\n            if (typeof selector === 'string' && DomQuery(node).is(selector)) {\n              result.push(node);\n              break;\n            } else if (node === selector) {\n              result.push(node);\n              break;\n            }\n            node = node.parentNode;\n          }\n        });\n        return DomQuery(result);\n      },\n      offset: function (offset) {\n        var elm, doc, docElm;\n        var x = 0, y = 0, pos;\n        if (!offset) {\n          elm = this[0];\n          if (elm) {\n            doc = elm.ownerDocument;\n            docElm = doc.documentElement;\n            if (elm.getBoundingClientRect) {\n              pos = elm.getBoundingClientRect();\n              x = pos.left + (docElm.scrollLeft || doc.body.scrollLeft) - docElm.clientLeft;\n              y = pos.top + (docElm.scrollTop || doc.body.scrollTop) - docElm.clientTop;\n            }\n          }\n          return {\n            left: x,\n            top: y\n          };\n        }\n        return this.css(offset);\n      },\n      push: push$1,\n      sort: [].sort,\n      splice: [].splice\n    };\n    Tools.extend(DomQuery, {\n      extend: Tools.extend,\n      makeArray: function (object) {\n        if (isWindow(object) || object.nodeType) {\n          return [object];\n        }\n        return Tools.toArray(object);\n      },\n      inArray: inArray,\n      isArray: Tools.isArray,\n      each: each$2,\n      trim: trim$1,\n      grep: grep,\n      find: Sizzle,\n      expr: Sizzle.selectors,\n      unique: Sizzle.uniqueSort,\n      text: Sizzle.getText,\n      contains: Sizzle.contains,\n      filter: function (expr, elems, not) {\n        var i = elems.length;\n        if (not) {\n          expr = ':not(' + expr + ')';\n        }\n        while (i--) {\n          if (elems[i].nodeType !== 1) {\n            elems.splice(i, 1);\n          }\n        }\n        if (elems.length === 1) {\n          elems = DomQuery.find.matchesSelector(elems[0], expr) ? [elems[0]] : [];\n        } else {\n          elems = DomQuery.find.matches(expr, elems);\n        }\n        return elems;\n      }\n    });\n    var dir = function (el, prop, until) {\n      var matched = [];\n      var cur = el[prop];\n      if (typeof until !== 'string' && until instanceof DomQuery) {\n        until = until[0];\n      }\n      while (cur && cur.nodeType !== 9) {\n        if (until !== undefined) {\n          if (cur === until) {\n            break;\n          }\n          if (typeof until === 'string' && DomQuery(cur).is(until)) {\n            break;\n          }\n        }\n        if (cur.nodeType === 1) {\n          matched.push(cur);\n        }\n        cur = cur[prop];\n      }\n      return matched;\n    };\n    var sibling = function (node, siblingName, nodeType, until) {\n      var result = [];\n      if (until instanceof DomQuery) {\n        until = until[0];\n      }\n      for (; node; node = node[siblingName]) {\n        if (nodeType && node.nodeType !== nodeType) {\n          continue;\n        }\n        if (until !== undefined) {\n          if (node === until) {\n            break;\n          }\n          if (typeof until === 'string' && DomQuery(node).is(until)) {\n            break;\n          }\n        }\n        result.push(node);\n      }\n      return result;\n    };\n    var firstSibling = function (node, siblingName, nodeType) {\n      for (node = node[siblingName]; node; node = node[siblingName]) {\n        if (node.nodeType === nodeType) {\n          return node;\n        }\n      }\n      return null;\n    };\n    each$2({\n      parent: function (node) {\n        var parent = node.parentNode;\n        return parent && parent.nodeType !== 11 ? parent : null;\n      },\n      parents: function (node) {\n        return dir(node, 'parentNode');\n      },\n      next: function (node) {\n        return firstSibling(node, 'nextSibling', 1);\n      },\n      prev: function (node) {\n        return firstSibling(node, 'previousSibling', 1);\n      },\n      children: function (node) {\n        return sibling(node.firstChild, 'nextSibling', 1);\n      },\n      contents: function (node) {\n        return Tools.toArray((node.nodeName === 'iframe' ? node.contentDocument || node.contentWindow.document : node).childNodes);\n      }\n    }, function (name, fn) {\n      DomQuery.fn[name] = function (selector) {\n        var self = this;\n        var result = [];\n        self.each(function () {\n          var nodes = fn.call(result, this, selector, result);\n          if (nodes) {\n            if (DomQuery.isArray(nodes)) {\n              result.push.apply(result, nodes);\n            } else {\n              result.push(nodes);\n            }\n          }\n        });\n        if (this.length > 1) {\n          if (!skipUniques[name]) {\n            result = DomQuery.unique(result);\n          }\n          if (name.indexOf('parents') === 0) {\n            result = result.reverse();\n          }\n        }\n        result = DomQuery(result);\n        if (selector) {\n          return result.filter(selector);\n        }\n        return result;\n      };\n    });\n    each$2({\n      parentsUntil: function (node, until) {\n        return dir(node, 'parentNode', until);\n      },\n      nextUntil: function (node, until) {\n        return sibling(node, 'nextSibling', 1, until).slice(1);\n      },\n      prevUntil: function (node, until) {\n        return sibling(node, 'previousSibling', 1, until).slice(1);\n      }\n    }, function (name, fn) {\n      DomQuery.fn[name] = function (selector, filter) {\n        var self = this;\n        var result = [];\n        self.each(function () {\n          var nodes = fn.call(result, this, selector, result);\n          if (nodes) {\n            if (DomQuery.isArray(nodes)) {\n              result.push.apply(result, nodes);\n            } else {\n              result.push(nodes);\n            }\n          }\n        });\n        if (this.length > 1) {\n          result = DomQuery.unique(result);\n          if (name.indexOf('parents') === 0 || name === 'prevUntil') {\n            result = result.reverse();\n          }\n        }\n        result = DomQuery(result);\n        if (filter) {\n          return result.filter(filter);\n        }\n        return result;\n      };\n    });\n    DomQuery.fn.is = function (selector) {\n      return !!selector && this.filter(selector).length > 0;\n    };\n    DomQuery.fn.init.prototype = DomQuery.fn;\n    DomQuery.overrideDefaults = function (callback) {\n      var defaults;\n      var sub = function (selector, context) {\n        defaults = defaults || callback();\n        if (arguments.length === 0) {\n          selector = defaults.element;\n        }\n        if (!context) {\n          context = defaults.context;\n        }\n        return new sub.fn.init(selector, context);\n      };\n      DomQuery.extend(sub, this);\n      return sub;\n    };\n    var appendHooks = function (targetHooks, prop, hooks) {\n      each$2(hooks, function (name, func) {\n        targetHooks[name] = targetHooks[name] || {};\n        targetHooks[name][prop] = func;\n      });\n    };\n    if (Env.ie && Env.ie < 8) {\n      appendHooks(attrHooks, 'get', {\n        maxlength: function (elm) {\n          var value = elm.maxLength;\n          if (value === 2147483647) {\n            return undefined;\n          }\n          return value;\n        },\n        size: function (elm) {\n          var value = elm.size;\n          if (value === 20) {\n            return undefined;\n          }\n          return value;\n        },\n        class: function (elm) {\n          return elm.className;\n        },\n        style: function (elm) {\n          var value = elm.style.cssText;\n          if (value.length === 0) {\n            return undefined;\n          }\n          return value;\n        }\n      });\n      appendHooks(attrHooks, 'set', {\n        class: function (elm, value) {\n          elm.className = value;\n        },\n        style: function (elm, value) {\n          elm.style.cssText = value;\n        }\n      });\n    }\n    if (Env.ie && Env.ie < 9) {\n      cssFix.float = 'styleFloat';\n      appendHooks(cssHooks, 'set', {\n        opacity: function (elm, value) {\n          var style = elm.style;\n          if (value === null || value === '') {\n            style.removeAttribute('filter');\n          } else {\n            style.zoom = 1;\n            style.filter = 'alpha(opacity=' + value * 100 + ')';\n          }\n        }\n      });\n    }\n    DomQuery.attrHooks = attrHooks;\n    DomQuery.cssHooks = cssHooks;\n\n    var cached = function (f) {\n      var called = false;\n      var r;\n      return function () {\n        var args = [];\n        for (var _i = 0; _i < arguments.length; _i++) {\n          args[_i] = arguments[_i];\n        }\n        if (!called) {\n          called = true;\n          r = f.apply(null, args);\n        }\n        return r;\n      };\n    };\n\n    var firstMatch = function (regexes, s) {\n      for (var i = 0; i < regexes.length; i++) {\n        var x = regexes[i];\n        if (x.test(s)) {\n          return x;\n        }\n      }\n      return undefined;\n    };\n    var find$2 = function (regexes, agent) {\n      var r = firstMatch(regexes, agent);\n      if (!r) {\n        return {\n          major: 0,\n          minor: 0\n        };\n      }\n      var group = function (i) {\n        return Number(agent.replace(r, '$' + i));\n      };\n      return nu(group(1), group(2));\n    };\n    var detect = function (versionRegexes, agent) {\n      var cleanedAgent = String(agent).toLowerCase();\n      if (versionRegexes.length === 0) {\n        return unknown();\n      }\n      return find$2(versionRegexes, cleanedAgent);\n    };\n    var unknown = function () {\n      return nu(0, 0);\n    };\n    var nu = function (major, minor) {\n      return {\n        major: major,\n        minor: minor\n      };\n    };\n    var Version = {\n      nu: nu,\n      detect: detect,\n      unknown: unknown\n    };\n\n    var edge = 'Edge';\n    var chrome = 'Chrome';\n    var ie$1 = 'IE';\n    var opera$1 = 'Opera';\n    var firefox = 'Firefox';\n    var safari = 'Safari';\n    var isBrowser = function (name, current) {\n      return function () {\n        return current === name;\n      };\n    };\n    var unknown$1 = function () {\n      return nu$1({\n        current: undefined,\n        version: Version.unknown()\n      });\n    };\n    var nu$1 = function (info) {\n      var current = info.current;\n      var version = info.version;\n      return {\n        current: current,\n        version: version,\n        isEdge: isBrowser(edge, current),\n        isChrome: isBrowser(chrome, current),\n        isIE: isBrowser(ie$1, current),\n        isOpera: isBrowser(opera$1, current),\n        isFirefox: isBrowser(firefox, current),\n        isSafari: isBrowser(safari, current)\n      };\n    };\n    var Browser = {\n      unknown: unknown$1,\n      nu: nu$1,\n      edge: constant(edge),\n      chrome: constant(chrome),\n      ie: constant(ie$1),\n      opera: constant(opera$1),\n      firefox: constant(firefox),\n      safari: constant(safari)\n    };\n\n    var windows = 'Windows';\n    var ios = 'iOS';\n    var android$1 = 'Android';\n    var linux = 'Linux';\n    var osx = 'OSX';\n    var solaris = 'Solaris';\n    var freebsd = 'FreeBSD';\n    var isOS = function (name, current) {\n      return function () {\n        return current === name;\n      };\n    };\n    var unknown$2 = function () {\n      return nu$2({\n        current: undefined,\n        version: Version.unknown()\n      });\n    };\n    var nu$2 = function (info) {\n      var current = info.current;\n      var version = info.version;\n      return {\n        current: current,\n        version: version,\n        isWindows: isOS(windows, current),\n        isiOS: isOS(ios, current),\n        isAndroid: isOS(android$1, current),\n        isOSX: isOS(osx, current),\n        isLinux: isOS(linux, current),\n        isSolaris: isOS(solaris, current),\n        isFreeBSD: isOS(freebsd, current)\n      };\n    };\n    var OperatingSystem = {\n      unknown: unknown$2,\n      nu: nu$2,\n      windows: constant(windows),\n      ios: constant(ios),\n      android: constant(android$1),\n      linux: constant(linux),\n      osx: constant(osx),\n      solaris: constant(solaris),\n      freebsd: constant(freebsd)\n    };\n\n    var DeviceType = function (os, browser, userAgent) {\n      var isiPad = os.isiOS() && /ipad/i.test(userAgent) === true;\n      var isiPhone = os.isiOS() && !isiPad;\n      var isAndroid3 = os.isAndroid() && os.version.major === 3;\n      var isAndroid4 = os.isAndroid() && os.version.major === 4;\n      var isTablet = isiPad || isAndroid3 || isAndroid4 && /mobile/i.test(userAgent) === true;\n      var isTouch = os.isiOS() || os.isAndroid();\n      var isPhone = isTouch && !isTablet;\n      var iOSwebview = browser.isSafari() && os.isiOS() && /safari/i.test(userAgent) === false;\n      return {\n        isiPad: constant(isiPad),\n        isiPhone: constant(isiPhone),\n        isTablet: constant(isTablet),\n        isPhone: constant(isPhone),\n        isTouch: constant(isTouch),\n        isAndroid: os.isAndroid,\n        isiOS: os.isiOS,\n        isWebView: constant(iOSwebview)\n      };\n    };\n\n    var detect$1 = function (candidates, userAgent) {\n      var agent = String(userAgent).toLowerCase();\n      return find(candidates, function (candidate) {\n        return candidate.search(agent);\n      });\n    };\n    var detectBrowser = function (browsers, userAgent) {\n      return detect$1(browsers, userAgent).map(function (browser) {\n        var version = Version.detect(browser.versionRegexes, userAgent);\n        return {\n          current: browser.name,\n          version: version\n        };\n      });\n    };\n    var detectOs = function (oses, userAgent) {\n      return detect$1(oses, userAgent).map(function (os) {\n        var version = Version.detect(os.versionRegexes, userAgent);\n        return {\n          current: os.name,\n          version: version\n        };\n      });\n    };\n    var UaString = {\n      detectBrowser: detectBrowser,\n      detectOs: detectOs\n    };\n\n    var contains$2 = function (str, substr) {\n      return str.indexOf(substr) !== -1;\n    };\n    var trim$2 = function (str) {\n      return str.replace(/^\\s+|\\s+$/g, '');\n    };\n    var lTrim = function (str) {\n      return str.replace(/^\\s+/g, '');\n    };\n    var rTrim = function (str) {\n      return str.replace(/\\s+$/g, '');\n    };\n\n    var normalVersionRegex = /.*?version\\/\\ ?([0-9]+)\\.([0-9]+).*/;\n    var checkContains = function (target) {\n      return function (uastring) {\n        return contains$2(uastring, target);\n      };\n    };\n    var browsers = [\n      {\n        name: 'Edge',\n        versionRegexes: [/.*?edge\\/ ?([0-9]+)\\.([0-9]+)$/],\n        search: function (uastring) {\n          return contains$2(uastring, 'edge/') && contains$2(uastring, 'chrome') && contains$2(uastring, 'safari') && contains$2(uastring, 'applewebkit');\n        }\n      },\n      {\n        name: 'Chrome',\n        versionRegexes: [\n          /.*?chrome\\/([0-9]+)\\.([0-9]+).*/,\n          normalVersionRegex\n        ],\n        search: function (uastring) {\n          return contains$2(uastring, 'chrome') && !contains$2(uastring, 'chromeframe');\n        }\n      },\n      {\n        name: 'IE',\n        versionRegexes: [\n          /.*?msie\\ ?([0-9]+)\\.([0-9]+).*/,\n          /.*?rv:([0-9]+)\\.([0-9]+).*/\n        ],\n        search: function (uastring) {\n          return contains$2(uastring, 'msie') || contains$2(uastring, 'trident');\n        }\n      },\n      {\n        name: 'Opera',\n        versionRegexes: [\n          normalVersionRegex,\n          /.*?opera\\/([0-9]+)\\.([0-9]+).*/\n        ],\n        search: checkContains('opera')\n      },\n      {\n        name: 'Firefox',\n        versionRegexes: [/.*?firefox\\/\\ ?([0-9]+)\\.([0-9]+).*/],\n        search: checkContains('firefox')\n      },\n      {\n        name: 'Safari',\n        versionRegexes: [\n          normalVersionRegex,\n          /.*?cpu os ([0-9]+)_([0-9]+).*/\n        ],\n        search: function (uastring) {\n          return (contains$2(uastring, 'safari') || contains$2(uastring, 'mobile/')) && contains$2(uastring, 'applewebkit');\n        }\n      }\n    ];\n    var oses = [\n      {\n        name: 'Windows',\n        search: checkContains('win'),\n        versionRegexes: [/.*?windows\\ nt\\ ?([0-9]+)\\.([0-9]+).*/]\n      },\n      {\n        name: 'iOS',\n        search: function (uastring) {\n          return contains$2(uastring, 'iphone') || contains$2(uastring, 'ipad');\n        },\n        versionRegexes: [\n          /.*?version\\/\\ ?([0-9]+)\\.([0-9]+).*/,\n          /.*cpu os ([0-9]+)_([0-9]+).*/,\n          /.*cpu iphone os ([0-9]+)_([0-9]+).*/\n        ]\n      },\n      {\n        name: 'Android',\n        search: checkContains('android'),\n        versionRegexes: [/.*?android\\ ?([0-9]+)\\.([0-9]+).*/]\n      },\n      {\n        name: 'OSX',\n        search: checkContains('os x'),\n        versionRegexes: [/.*?os\\ x\\ ?([0-9]+)_([0-9]+).*/]\n      },\n      {\n        name: 'Linux',\n        search: checkContains('linux'),\n        versionRegexes: []\n      },\n      {\n        name: 'Solaris',\n        search: checkContains('sunos'),\n        versionRegexes: []\n      },\n      {\n        name: 'FreeBSD',\n        search: checkContains('freebsd'),\n        versionRegexes: []\n      }\n    ];\n    var PlatformInfo = {\n      browsers: constant(browsers),\n      oses: constant(oses)\n    };\n\n    var detect$2 = function (userAgent) {\n      var browsers = PlatformInfo.browsers();\n      var oses = PlatformInfo.oses();\n      var browser = UaString.detectBrowser(browsers, userAgent).fold(Browser.unknown, Browser.nu);\n      var os = UaString.detectOs(oses, userAgent).fold(OperatingSystem.unknown, OperatingSystem.nu);\n      var deviceType = DeviceType(os, browser, userAgent);\n      return {\n        browser: browser,\n        os: os,\n        deviceType: deviceType\n      };\n    };\n    var PlatformDetection = { detect: detect$2 };\n\n    var detect$3 = cached(function () {\n      var userAgent = domGlobals.navigator.userAgent;\n      return PlatformDetection.detect(userAgent);\n    });\n    var PlatformDetection$1 = { detect: detect$3 };\n\n    var fromHtml = function (html, scope) {\n      var doc = scope || domGlobals.document;\n      var div = doc.createElement('div');\n      div.innerHTML = html;\n      if (!div.hasChildNodes() || div.childNodes.length > 1) {\n        domGlobals.console.error('HTML does not have a single root node', html);\n        throw new Error('HTML must have a single root node');\n      }\n      return fromDom(div.childNodes[0]);\n    };\n    var fromTag = function (tag, scope) {\n      var doc = scope || domGlobals.document;\n      var node = doc.createElement(tag);\n      return fromDom(node);\n    };\n    var fromText = function (text, scope) {\n      var doc = scope || domGlobals.document;\n      var node = doc.createTextNode(text);\n      return fromDom(node);\n    };\n    var fromDom = function (node) {\n      if (node === null || node === undefined) {\n        throw new Error('Node cannot be null or undefined');\n      }\n      return { dom: constant(node) };\n    };\n    var fromPoint = function (docElm, x, y) {\n      var doc = docElm.dom();\n      return Option.from(doc.elementFromPoint(x, y)).map(fromDom);\n    };\n    var Element = {\n      fromHtml: fromHtml,\n      fromTag: fromTag,\n      fromText: fromText,\n      fromDom: fromDom,\n      fromPoint: fromPoint\n    };\n\n    var ATTRIBUTE = domGlobals.Node.ATTRIBUTE_NODE;\n    var CDATA_SECTION = domGlobals.Node.CDATA_SECTION_NODE;\n    var COMMENT = domGlobals.Node.COMMENT_NODE;\n    var DOCUMENT = domGlobals.Node.DOCUMENT_NODE;\n    var DOCUMENT_TYPE = domGlobals.Node.DOCUMENT_TYPE_NODE;\n    var DOCUMENT_FRAGMENT = domGlobals.Node.DOCUMENT_FRAGMENT_NODE;\n    var ELEMENT = domGlobals.Node.ELEMENT_NODE;\n    var TEXT = domGlobals.Node.TEXT_NODE;\n    var PROCESSING_INSTRUCTION = domGlobals.Node.PROCESSING_INSTRUCTION_NODE;\n    var ENTITY_REFERENCE = domGlobals.Node.ENTITY_REFERENCE_NODE;\n    var ENTITY = domGlobals.Node.ENTITY_NODE;\n    var NOTATION = domGlobals.Node.NOTATION_NODE;\n\n    var name = function (element) {\n      var r = element.dom().nodeName;\n      return r.toLowerCase();\n    };\n    var type = function (element) {\n      return element.dom().nodeType;\n    };\n    var isType$1 = function (t) {\n      return function (element) {\n        return type(element) === t;\n      };\n    };\n    var isElement = isType$1(ELEMENT);\n    var isText = isType$1(TEXT);\n\n    var keys = Object.keys;\n    var hasOwnProperty$1 = Object.hasOwnProperty;\n    var each$3 = function (obj, f) {\n      var props = keys(obj);\n      for (var k = 0, len = props.length; k < len; k++) {\n        var i = props[k];\n        var x = obj[i];\n        f(x, i);\n      }\n    };\n    var map$2 = function (obj, f) {\n      return tupleMap(obj, function (x, i) {\n        return {\n          k: i,\n          v: f(x, i)\n        };\n      });\n    };\n    var tupleMap = function (obj, f) {\n      var r = {};\n      each$3(obj, function (x, i) {\n        var tuple = f(x, i);\n        r[tuple.k] = tuple.v;\n      });\n      return r;\n    };\n    var bifilter = function (obj, pred) {\n      var t = {};\n      var f = {};\n      each$3(obj, function (x, i) {\n        var branch = pred(x, i) ? t : f;\n        branch[i] = x;\n      });\n      return {\n        t: t,\n        f: f\n      };\n    };\n    var has = function (obj, key) {\n      return hasOwnProperty$1.call(obj, key);\n    };\n\n    var isSupported = function (dom) {\n      return dom.style !== undefined && isFunction(dom.style.getPropertyValue);\n    };\n\n    var inBody = function (element) {\n      var dom = isText(element) ? element.dom().parentNode : element.dom();\n      return dom !== undefined && dom !== null && dom.ownerDocument.body.contains(dom);\n    };\n\n    var rawSet = function (dom, key, value) {\n      if (isString(value) || isBoolean(value) || isNumber(value)) {\n        dom.setAttribute(key, value + '');\n      } else {\n        domGlobals.console.error('Invalid call to Attr.set. Key ', key, ':: Value ', value, ':: Element ', dom);\n        throw new Error('Attribute value was not simple');\n      }\n    };\n    var set = function (element, key, value) {\n      rawSet(element.dom(), key, value);\n    };\n    var setAll = function (element, attrs) {\n      var dom = element.dom();\n      each$3(attrs, function (v, k) {\n        rawSet(dom, k, v);\n      });\n    };\n    var get = function (element, key) {\n      var v = element.dom().getAttribute(key);\n      return v === null ? undefined : v;\n    };\n    var has$1 = function (element, key) {\n      var dom = element.dom();\n      return dom && dom.hasAttribute ? dom.hasAttribute(key) : false;\n    };\n    var remove = function (element, key) {\n      element.dom().removeAttribute(key);\n    };\n\n    var internalSet = function (dom, property, value) {\n      if (!isString(value)) {\n        domGlobals.console.error('Invalid call to CSS.set. Property ', property, ':: Value ', value, ':: Element ', dom);\n        throw new Error('CSS value must be a string: ' + value);\n      }\n      if (isSupported(dom)) {\n        dom.style.setProperty(property, value);\n      }\n    };\n    var setAll$1 = function (element, css) {\n      var dom = element.dom();\n      each$3(css, function (v, k) {\n        internalSet(dom, k, v);\n      });\n    };\n    var get$1 = function (element, property) {\n      var dom = element.dom();\n      var styles = domGlobals.window.getComputedStyle(dom);\n      var r = styles.getPropertyValue(property);\n      var v = r === '' && !inBody(element) ? getUnsafeProperty(dom, property) : r;\n      return v === null ? undefined : v;\n    };\n    var getUnsafeProperty = function (dom, property) {\n      return isSupported(dom) ? dom.style.getPropertyValue(property) : '';\n    };\n    var getRaw = function (element, property) {\n      var dom = element.dom();\n      var raw = getUnsafeProperty(dom, property);\n      return Option.from(raw).filter(function (r) {\n        return r.length > 0;\n      });\n    };\n    var getAllRaw = function (element) {\n      var css = {};\n      var dom = element.dom();\n      if (isSupported(dom)) {\n        for (var i = 0; i < dom.style.length; i++) {\n          var ruleName = dom.style.item(i);\n          css[ruleName] = dom.style[ruleName];\n        }\n      }\n      return css;\n    };\n\n    var Immutable = function () {\n      var fields = [];\n      for (var _i = 0; _i < arguments.length; _i++) {\n        fields[_i] = arguments[_i];\n      }\n      return function () {\n        var values = [];\n        for (var _i = 0; _i < arguments.length; _i++) {\n          values[_i] = arguments[_i];\n        }\n        if (fields.length !== values.length) {\n          throw new Error('Wrong number of arguments to struct. Expected \"[' + fields.length + ']\", got ' + values.length + ' arguments');\n        }\n        var struct = {};\n        each(fields, function (name, i) {\n          struct[name] = constant(values[i]);\n        });\n        return struct;\n      };\n    };\n\n    var toArray$1 = function (target, f) {\n      var r = [];\n      var recurse = function (e) {\n        r.push(e);\n        return f(e);\n      };\n      var cur = f(target);\n      do {\n        cur = cur.bind(recurse);\n      } while (cur.isSome());\n      return r;\n    };\n    var Recurse = { toArray: toArray$1 };\n\n    var node = function () {\n      var f = Global$1.getOrDie('Node');\n      return f;\n    };\n    var compareDocumentPosition = function (a, b, match) {\n      return (a.compareDocumentPosition(b) & match) !== 0;\n    };\n    var documentPositionPreceding = function (a, b) {\n      return compareDocumentPosition(a, b, node().DOCUMENT_POSITION_PRECEDING);\n    };\n    var documentPositionContainedBy = function (a, b) {\n      return compareDocumentPosition(a, b, node().DOCUMENT_POSITION_CONTAINED_BY);\n    };\n    var Node = {\n      documentPositionPreceding: documentPositionPreceding,\n      documentPositionContainedBy: documentPositionContainedBy\n    };\n\n    var ELEMENT$1 = ELEMENT;\n    var DOCUMENT$1 = DOCUMENT;\n    var is$1 = function (element, selector) {\n      var dom = element.dom();\n      if (dom.nodeType !== ELEMENT$1) {\n        return false;\n      } else {\n        var elem = dom;\n        if (elem.matches !== undefined) {\n          return elem.matches(selector);\n        } else if (elem.msMatchesSelector !== undefined) {\n          return elem.msMatchesSelector(selector);\n        } else if (elem.webkitMatchesSelector !== undefined) {\n          return elem.webkitMatchesSelector(selector);\n        } else if (elem.mozMatchesSelector !== undefined) {\n          return elem.mozMatchesSelector(selector);\n        } else {\n          throw new Error('Browser lacks native selectors');\n        }\n      }\n    };\n    var bypassSelector = function (dom) {\n      return dom.nodeType !== ELEMENT$1 && dom.nodeType !== DOCUMENT$1 || dom.childElementCount === 0;\n    };\n    var all = function (selector, scope) {\n      var base = scope === undefined ? domGlobals.document : scope.dom();\n      return bypassSelector(base) ? [] : map(base.querySelectorAll(selector), Element.fromDom);\n    };\n    var one = function (selector, scope) {\n      var base = scope === undefined ? domGlobals.document : scope.dom();\n      return bypassSelector(base) ? Option.none() : Option.from(base.querySelector(selector)).map(Element.fromDom);\n    };\n\n    var eq = function (e1, e2) {\n      return e1.dom() === e2.dom();\n    };\n    var regularContains = function (e1, e2) {\n      var d1 = e1.dom();\n      var d2 = e2.dom();\n      return d1 === d2 ? false : d1.contains(d2);\n    };\n    var ieContains = function (e1, e2) {\n      return Node.documentPositionContainedBy(e1.dom(), e2.dom());\n    };\n    var browser = PlatformDetection$1.detect().browser;\n    var contains$3 = browser.isIE() ? ieContains : regularContains;\n\n    var owner = function (element) {\n      return Element.fromDom(element.dom().ownerDocument);\n    };\n    var documentElement = function (element) {\n      return Element.fromDom(element.dom().ownerDocument.documentElement);\n    };\n    var defaultView = function (element) {\n      return Element.fromDom(element.dom().ownerDocument.defaultView);\n    };\n    var parent = function (element) {\n      return Option.from(element.dom().parentNode).map(Element.fromDom);\n    };\n    var parents = function (element, isRoot) {\n      var stop = isFunction(isRoot) ? isRoot : never;\n      var dom = element.dom();\n      var ret = [];\n      while (dom.parentNode !== null && dom.parentNode !== undefined) {\n        var rawParent = dom.parentNode;\n        var p = Element.fromDom(rawParent);\n        ret.push(p);\n        if (stop(p) === true) {\n          break;\n        } else {\n          dom = rawParent;\n        }\n      }\n      return ret;\n    };\n    var prevSibling = function (element) {\n      return Option.from(element.dom().previousSibling).map(Element.fromDom);\n    };\n    var nextSibling = function (element) {\n      return Option.from(element.dom().nextSibling).map(Element.fromDom);\n    };\n    var prevSiblings = function (element) {\n      return reverse(Recurse.toArray(element, prevSibling));\n    };\n    var nextSiblings = function (element) {\n      return Recurse.toArray(element, nextSibling);\n    };\n    var children = function (element) {\n      return map(element.dom().childNodes, Element.fromDom);\n    };\n    var child = function (element, index) {\n      var cs = element.dom().childNodes;\n      return Option.from(cs[index]).map(Element.fromDom);\n    };\n    var firstChild = function (element) {\n      return child(element, 0);\n    };\n    var lastChild = function (element) {\n      return child(element, element.dom().childNodes.length - 1);\n    };\n    var childNodesCount = function (element) {\n      return element.dom().childNodes.length;\n    };\n    var spot = Immutable('element', 'offset');\n\n    var browser$1 = PlatformDetection$1.detect().browser;\n    var firstElement = function (nodes) {\n      return find(nodes, isElement);\n    };\n    var getTableCaptionDeltaY = function (elm) {\n      if (browser$1.isFirefox() && name(elm) === 'table') {\n        return firstElement(children(elm)).filter(function (elm) {\n          return name(elm) === 'caption';\n        }).bind(function (caption) {\n          return firstElement(nextSiblings(caption)).map(function (body) {\n            var bodyTop = body.dom().offsetTop;\n            var captionTop = caption.dom().offsetTop;\n            var captionHeight = caption.dom().offsetHeight;\n            return bodyTop <= captionTop ? -captionHeight : 0;\n          });\n        }).getOr(0);\n      } else {\n        return 0;\n      }\n    };\n    var getPos = function (body, elm, rootElm) {\n      var x = 0, y = 0, offsetParent;\n      var doc = body.ownerDocument;\n      var pos;\n      rootElm = rootElm ? rootElm : body;\n      if (elm) {\n        if (rootElm === body && elm.getBoundingClientRect && get$1(Element.fromDom(body), 'position') === 'static') {\n          pos = elm.getBoundingClientRect();\n          x = pos.left + (doc.documentElement.scrollLeft || body.scrollLeft) - doc.documentElement.clientLeft;\n          y = pos.top + (doc.documentElement.scrollTop || body.scrollTop) - doc.documentElement.clientTop;\n          return {\n            x: x,\n            y: y\n          };\n        }\n        offsetParent = elm;\n        while (offsetParent && offsetParent !== rootElm && offsetParent.nodeType) {\n          x += offsetParent.offsetLeft || 0;\n          y += offsetParent.offsetTop || 0;\n          offsetParent = offsetParent.offsetParent;\n        }\n        offsetParent = elm.parentNode;\n        while (offsetParent && offsetParent !== rootElm && offsetParent.nodeType) {\n          x -= offsetParent.scrollLeft || 0;\n          y -= offsetParent.scrollTop || 0;\n          offsetParent = offsetParent.parentNode;\n        }\n        y += getTableCaptionDeltaY(Element.fromDom(elm));\n      }\n      return {\n        x: x,\n        y: y\n      };\n    };\n    var Position = { getPos: getPos };\n\n    var exports$1 = {}, module$1 = { exports: exports$1 };\n    (function (define, exports, module, require) {\n      (function (f) {\n        if (typeof exports === 'object' && typeof module !== 'undefined') {\n          module.exports = f();\n        } else if (typeof define === 'function' && define.amd) {\n          define([], f);\n        } else {\n          var g;\n          if (typeof window !== 'undefined') {\n            g = window;\n          } else if (typeof global !== 'undefined') {\n            g = global;\n          } else if (typeof self !== 'undefined') {\n            g = self;\n          } else {\n            g = this;\n          }\n          g.EphoxContactWrapper = f();\n        }\n      }(function () {\n        return function () {\n          function r(e, n, t) {\n            function o(i, f) {\n              if (!n[i]) {\n                if (!e[i]) {\n                  var c = 'function' == typeof require && require;\n                  if (!f && c)\n                    return c(i, !0);\n                  if (u)\n                    return u(i, !0);\n                  var a = new Error('Cannot find module \\'' + i + '\\'');\n                  throw a.code = 'MODULE_NOT_FOUND', a;\n                }\n                var p = n[i] = { exports: {} };\n                e[i][0].call(p.exports, function (r) {\n                  var n = e[i][1][r];\n                  return o(n || r);\n                }, p, p.exports, r, e, n, t);\n              }\n              return n[i].exports;\n            }\n            for (var u = 'function' == typeof require && require, i = 0; i < t.length; i++)\n              o(t[i]);\n            return o;\n          }\n          return r;\n        }()({\n          1: [\n            function (require, module, exports) {\n              var process = module.exports = {};\n              var cachedSetTimeout;\n              var cachedClearTimeout;\n              function defaultSetTimout() {\n                throw new Error('setTimeout has not been defined');\n              }\n              function defaultClearTimeout() {\n                throw new Error('clearTimeout has not been defined');\n              }\n              (function () {\n                try {\n                  if (typeof setTimeout === 'function') {\n                    cachedSetTimeout = setTimeout;\n                  } else {\n                    cachedSetTimeout = defaultSetTimout;\n                  }\n                } catch (e) {\n                  cachedSetTimeout = defaultSetTimout;\n                }\n                try {\n                  if (typeof clearTimeout === 'function') {\n                    cachedClearTimeout = clearTimeout;\n                  } else {\n                    cachedClearTimeout = defaultClearTimeout;\n                  }\n                } catch (e) {\n                  cachedClearTimeout = defaultClearTimeout;\n                }\n              }());\n              function runTimeout(fun) {\n                if (cachedSetTimeout === setTimeout) {\n                  return setTimeout(fun, 0);\n                }\n                if ((cachedSetTimeout === defaultSetTimout || !cachedSetTimeout) && setTimeout) {\n                  cachedSetTimeout = setTimeout;\n                  return setTimeout(fun, 0);\n                }\n                try {\n                  return cachedSetTimeout(fun, 0);\n                } catch (e) {\n                  try {\n                    return cachedSetTimeout.call(null, fun, 0);\n                  } catch (e) {\n                    return cachedSetTimeout.call(this, fun, 0);\n                  }\n                }\n              }\n              function runClearTimeout(marker) {\n                if (cachedClearTimeout === clearTimeout) {\n                  return clearTimeout(marker);\n                }\n                if ((cachedClearTimeout === defaultClearTimeout || !cachedClearTimeout) && clearTimeout) {\n                  cachedClearTimeout = clearTimeout;\n                  return clearTimeout(marker);\n                }\n                try {\n                  return cachedClearTimeout(marker);\n                } catch (e) {\n                  try {\n                    return cachedClearTimeout.call(null, marker);\n                  } catch (e) {\n                    return cachedClearTimeout.call(this, marker);\n                  }\n                }\n              }\n              var queue = [];\n              var draining = false;\n              var currentQueue;\n              var queueIndex = -1;\n              function cleanUpNextTick() {\n                if (!draining || !currentQueue) {\n                  return;\n                }\n                draining = false;\n                if (currentQueue.length) {\n                  queue = currentQueue.concat(queue);\n                } else {\n                  queueIndex = -1;\n                }\n                if (queue.length) {\n                  drainQueue();\n                }\n              }\n              function drainQueue() {\n                if (draining) {\n                  return;\n                }\n                var timeout = runTimeout(cleanUpNextTick);\n                draining = true;\n                var len = queue.length;\n                while (len) {\n                  currentQueue = queue;\n                  queue = [];\n                  while (++queueIndex < len) {\n                    if (currentQueue) {\n                      currentQueue[queueIndex].run();\n                    }\n                  }\n                  queueIndex = -1;\n                  len = queue.length;\n                }\n                currentQueue = null;\n                draining = false;\n                runClearTimeout(timeout);\n              }\n              process.nextTick = function (fun) {\n                var args = new Array(arguments.length - 1);\n                if (arguments.length > 1) {\n                  for (var i = 1; i < arguments.length; i++) {\n                    args[i - 1] = arguments[i];\n                  }\n                }\n                queue.push(new Item(fun, args));\n                if (queue.length === 1 && !draining) {\n                  runTimeout(drainQueue);\n                }\n              };\n              function Item(fun, array) {\n                this.fun = fun;\n                this.array = array;\n              }\n              Item.prototype.run = function () {\n                this.fun.apply(null, this.array);\n              };\n              process.title = 'browser';\n              process.browser = true;\n              process.env = {};\n              process.argv = [];\n              process.version = '';\n              process.versions = {};\n              function noop() {\n              }\n              process.on = noop;\n              process.addListener = noop;\n              process.once = noop;\n              process.off = noop;\n              process.removeListener = noop;\n              process.removeAllListeners = noop;\n              process.emit = noop;\n              process.prependListener = noop;\n              process.prependOnceListener = noop;\n              process.listeners = function (name) {\n                return [];\n              };\n              process.binding = function (name) {\n                throw new Error('process.binding is not supported');\n              };\n              process.cwd = function () {\n                return '/';\n              };\n              process.chdir = function (dir) {\n                throw new Error('process.chdir is not supported');\n              };\n              process.umask = function () {\n                return 0;\n              };\n            },\n            {}\n          ],\n          2: [\n            function (require, module, exports) {\n              (function (setImmediate) {\n                (function (root) {\n                  var setTimeoutFunc = setTimeout;\n                  function noop() {\n                  }\n                  function bind(fn, thisArg) {\n                    return function () {\n                      fn.apply(thisArg, arguments);\n                    };\n                  }\n                  function Promise(fn) {\n                    if (typeof this !== 'object')\n                      throw new TypeError('Promises must be constructed via new');\n                    if (typeof fn !== 'function')\n                      throw new TypeError('not a function');\n                    this._state = 0;\n                    this._handled = false;\n                    this._value = undefined;\n                    this._deferreds = [];\n                    doResolve(fn, this);\n                  }\n                  function handle(self, deferred) {\n                    while (self._state === 3) {\n                      self = self._value;\n                    }\n                    if (self._state === 0) {\n                      self._deferreds.push(deferred);\n                      return;\n                    }\n                    self._handled = true;\n                    Promise._immediateFn(function () {\n                      var cb = self._state === 1 ? deferred.onFulfilled : deferred.onRejected;\n                      if (cb === null) {\n                        (self._state === 1 ? resolve : reject)(deferred.promise, self._value);\n                        return;\n                      }\n                      var ret;\n                      try {\n                        ret = cb(self._value);\n                      } catch (e) {\n                        reject(deferred.promise, e);\n                        return;\n                      }\n                      resolve(deferred.promise, ret);\n                    });\n                  }\n                  function resolve(self, newValue) {\n                    try {\n                      if (newValue === self)\n                        throw new TypeError('A promise cannot be resolved with itself.');\n                      if (newValue && (typeof newValue === 'object' || typeof newValue === 'function')) {\n                        var then = newValue.then;\n                        if (newValue instanceof Promise) {\n                          self._state = 3;\n                          self._value = newValue;\n                          finale(self);\n                          return;\n                        } else if (typeof then === 'function') {\n                          doResolve(bind(then, newValue), self);\n                          return;\n                        }\n                      }\n                      self._state = 1;\n                      self._value = newValue;\n                      finale(self);\n                    } catch (e) {\n                      reject(self, e);\n                    }\n                  }\n                  function reject(self, newValue) {\n                    self._state = 2;\n                    self._value = newValue;\n                    finale(self);\n                  }\n                  function finale(self) {\n                    if (self._state === 2 && self._deferreds.length === 0) {\n                      Promise._immediateFn(function () {\n                        if (!self._handled) {\n                          Promise._unhandledRejectionFn(self._value);\n                        }\n                      });\n                    }\n                    for (var i = 0, len = self._deferreds.length; i < len; i++) {\n                      handle(self, self._deferreds[i]);\n                    }\n                    self._deferreds = null;\n                  }\n                  function Handler(onFulfilled, onRejected, promise) {\n                    this.onFulfilled = typeof onFulfilled === 'function' ? onFulfilled : null;\n                    this.onRejected = typeof onRejected === 'function' ? onRejected : null;\n                    this.promise = promise;\n                  }\n                  function doResolve(fn, self) {\n                    var done = false;\n                    try {\n                      fn(function (value) {\n                        if (done)\n                          return;\n                        done = true;\n                        resolve(self, value);\n                      }, function (reason) {\n                        if (done)\n                          return;\n                        done = true;\n                        reject(self, reason);\n                      });\n                    } catch (ex) {\n                      if (done)\n                        return;\n                      done = true;\n                      reject(self, ex);\n                    }\n                  }\n                  Promise.prototype['catch'] = function (onRejected) {\n                    return this.then(null, onRejected);\n                  };\n                  Promise.prototype.then = function (onFulfilled, onRejected) {\n                    var prom = new this.constructor(noop);\n                    handle(this, new Handler(onFulfilled, onRejected, prom));\n                    return prom;\n                  };\n                  Promise.all = function (arr) {\n                    var args = Array.prototype.slice.call(arr);\n                    return new Promise(function (resolve, reject) {\n                      if (args.length === 0)\n                        return resolve([]);\n                      var remaining = args.length;\n                      function res(i, val) {\n                        try {\n                          if (val && (typeof val === 'object' || typeof val === 'function')) {\n                            var then = val.then;\n                            if (typeof then === 'function') {\n                              then.call(val, function (val) {\n                                res(i, val);\n                              }, reject);\n                              return;\n                            }\n                          }\n                          args[i] = val;\n                          if (--remaining === 0) {\n                            resolve(args);\n                          }\n                        } catch (ex) {\n                          reject(ex);\n                        }\n                      }\n                      for (var i = 0; i < args.length; i++) {\n                        res(i, args[i]);\n                      }\n                    });\n                  };\n                  Promise.resolve = function (value) {\n                    if (value && typeof value === 'object' && value.constructor === Promise) {\n                      return value;\n                    }\n                    return new Promise(function (resolve) {\n                      resolve(value);\n                    });\n                  };\n                  Promise.reject = function (value) {\n                    return new Promise(function (resolve, reject) {\n                      reject(value);\n                    });\n                  };\n                  Promise.race = function (values) {\n                    return new Promise(function (resolve, reject) {\n                      for (var i = 0, len = values.length; i < len; i++) {\n                        values[i].then(resolve, reject);\n                      }\n                    });\n                  };\n                  Promise._immediateFn = typeof setImmediate === 'function' ? function (fn) {\n                    setImmediate(fn);\n                  } : function (fn) {\n                    setTimeoutFunc(fn, 0);\n                  };\n                  Promise._unhandledRejectionFn = function _unhandledRejectionFn(err) {\n                    if (typeof console !== 'undefined' && console) {\n                      console.warn('Possible Unhandled Promise Rejection:', err);\n                    }\n                  };\n                  Promise._setImmediateFn = function _setImmediateFn(fn) {\n                    Promise._immediateFn = fn;\n                  };\n                  Promise._setUnhandledRejectionFn = function _setUnhandledRejectionFn(fn) {\n                    Promise._unhandledRejectionFn = fn;\n                  };\n                  if (typeof module !== 'undefined' && module.exports) {\n                    module.exports = Promise;\n                  } else if (!root.Promise) {\n                    root.Promise = Promise;\n                  }\n                }(this));\n              }.call(this, require('timers').setImmediate));\n            },\n            { 'timers': 3 }\n          ],\n          3: [\n            function (require, module, exports) {\n              (function (setImmediate, clearImmediate) {\n                var nextTick = require('process/browser.js').nextTick;\n                var apply = Function.prototype.apply;\n                var slice = Array.prototype.slice;\n                var immediateIds = {};\n                var nextImmediateId = 0;\n                exports.setTimeout = function () {\n                  return new Timeout(apply.call(setTimeout, window, arguments), clearTimeout);\n                };\n                exports.setInterval = function () {\n                  return new Timeout(apply.call(setInterval, window, arguments), clearInterval);\n                };\n                exports.clearTimeout = exports.clearInterval = function (timeout) {\n                  timeout.close();\n                };\n                function Timeout(id, clearFn) {\n                  this._id = id;\n                  this._clearFn = clearFn;\n                }\n                Timeout.prototype.unref = Timeout.prototype.ref = function () {\n                };\n                Timeout.prototype.close = function () {\n                  this._clearFn.call(window, this._id);\n                };\n                exports.enroll = function (item, msecs) {\n                  clearTimeout(item._idleTimeoutId);\n                  item._idleTimeout = msecs;\n                };\n                exports.unenroll = function (item) {\n                  clearTimeout(item._idleTimeoutId);\n                  item._idleTimeout = -1;\n                };\n                exports._unrefActive = exports.active = function (item) {\n                  clearTimeout(item._idleTimeoutId);\n                  var msecs = item._idleTimeout;\n                  if (msecs >= 0) {\n                    item._idleTimeoutId = setTimeout(function onTimeout() {\n                      if (item._onTimeout)\n                        item._onTimeout();\n                    }, msecs);\n                  }\n                };\n                exports.setImmediate = typeof setImmediate === 'function' ? setImmediate : function (fn) {\n                  var id = nextImmediateId++;\n                  var args = arguments.length < 2 ? false : slice.call(arguments, 1);\n                  immediateIds[id] = true;\n                  nextTick(function onNextTick() {\n                    if (immediateIds[id]) {\n                      if (args) {\n                        fn.apply(null, args);\n                      } else {\n                        fn.call(null);\n                      }\n                      exports.clearImmediate(id);\n                    }\n                  });\n                  return id;\n                };\n                exports.clearImmediate = typeof clearImmediate === 'function' ? clearImmediate : function (id) {\n                  delete immediateIds[id];\n                };\n              }.call(this, require('timers').setImmediate, require('timers').clearImmediate));\n            },\n            {\n              'process/browser.js': 1,\n              'timers': 3\n            }\n          ],\n          4: [\n            function (require, module, exports) {\n              var promisePolyfill = require('promise-polyfill');\n              var Global = function () {\n                if (typeof window !== 'undefined') {\n                  return window;\n                } else {\n                  return Function('return this;')();\n                }\n              }();\n              module.exports = { boltExport: Global.Promise || promisePolyfill };\n            },\n            { 'promise-polyfill': 2 }\n          ]\n        }, {}, [4])(4);\n      }));\n    }(undefined, exports$1, module$1, undefined));\n    var Promise = module$1.exports.boltExport;\n\n    var nu$3 = function (baseFn) {\n      var data = Option.none();\n      var callbacks = [];\n      var map = function (f) {\n        return nu$3(function (nCallback) {\n          get(function (data) {\n            nCallback(f(data));\n          });\n        });\n      };\n      var get = function (nCallback) {\n        if (isReady()) {\n          call(nCallback);\n        } else {\n          callbacks.push(nCallback);\n        }\n      };\n      var set = function (x) {\n        data = Option.some(x);\n        run(callbacks);\n        callbacks = [];\n      };\n      var isReady = function () {\n        return data.isSome();\n      };\n      var run = function (cbs) {\n        each(cbs, call);\n      };\n      var call = function (cb) {\n        data.each(function (x) {\n          domGlobals.setTimeout(function () {\n            cb(x);\n          }, 0);\n        });\n      };\n      baseFn(set);\n      return {\n        get: get,\n        map: map,\n        isReady: isReady\n      };\n    };\n    var pure = function (a) {\n      return nu$3(function (callback) {\n        callback(a);\n      });\n    };\n    var LazyValue = {\n      nu: nu$3,\n      pure: pure\n    };\n\n    var errorReporter = function (err) {\n      domGlobals.setTimeout(function () {\n        throw err;\n      }, 0);\n    };\n    var make = function (run) {\n      var get = function (callback) {\n        run().then(callback, errorReporter);\n      };\n      var map = function (fab) {\n        return make(function () {\n          return run().then(fab);\n        });\n      };\n      var bind = function (aFutureB) {\n        return make(function () {\n          return run().then(function (v) {\n            return aFutureB(v).toPromise();\n          });\n        });\n      };\n      var anonBind = function (futureB) {\n        return make(function () {\n          return run().then(function () {\n            return futureB.toPromise();\n          });\n        });\n      };\n      var toLazy = function () {\n        return LazyValue.nu(get);\n      };\n      var toCached = function () {\n        var cache = null;\n        return make(function () {\n          if (cache === null) {\n            cache = run();\n          }\n          return cache;\n        });\n      };\n      var toPromise = run;\n      return {\n        map: map,\n        bind: bind,\n        anonBind: anonBind,\n        toLazy: toLazy,\n        toCached: toCached,\n        toPromise: toPromise,\n        get: get\n      };\n    };\n    var nu$4 = function (baseFn) {\n      return make(function () {\n        return new Promise(baseFn);\n      });\n    };\n    var pure$1 = function (a) {\n      return make(function () {\n        return Promise.resolve(a);\n      });\n    };\n    var Future = {\n      nu: nu$4,\n      pure: pure$1\n    };\n\n    var par = function (asyncValues, nu) {\n      return nu(function (callback) {\n        var r = [];\n        var count = 0;\n        var cb = function (i) {\n          return function (value) {\n            r[i] = value;\n            count++;\n            if (count >= asyncValues.length) {\n              callback(r);\n            }\n          };\n        };\n        if (asyncValues.length === 0) {\n          callback([]);\n        } else {\n          each(asyncValues, function (asyncValue, i) {\n            asyncValue.get(cb(i));\n          });\n        }\n      });\n    };\n\n    var par$1 = function (futures) {\n      return par(futures, Future.nu);\n    };\n\n    var value = function (o) {\n      var is = function (v) {\n        return o === v;\n      };\n      var or = function (opt) {\n        return value(o);\n      };\n      var orThunk = function (f) {\n        return value(o);\n      };\n      var map = function (f) {\n        return value(f(o));\n      };\n      var mapError = function (f) {\n        return value(o);\n      };\n      var each = function (f) {\n        f(o);\n      };\n      var bind = function (f) {\n        return f(o);\n      };\n      var fold = function (_, onValue) {\n        return onValue(o);\n      };\n      var exists = function (f) {\n        return f(o);\n      };\n      var forall = function (f) {\n        return f(o);\n      };\n      var toOption = function () {\n        return Option.some(o);\n      };\n      return {\n        is: is,\n        isValue: always,\n        isError: never,\n        getOr: constant(o),\n        getOrThunk: constant(o),\n        getOrDie: constant(o),\n        or: or,\n        orThunk: orThunk,\n        fold: fold,\n        map: map,\n        mapError: mapError,\n        each: each,\n        bind: bind,\n        exists: exists,\n        forall: forall,\n        toOption: toOption\n      };\n    };\n    var error = function (message) {\n      var getOrThunk = function (f) {\n        return f();\n      };\n      var getOrDie = function () {\n        return die(String(message))();\n      };\n      var or = function (opt) {\n        return opt;\n      };\n      var orThunk = function (f) {\n        return f();\n      };\n      var map = function (f) {\n        return error(message);\n      };\n      var mapError = function (f) {\n        return error(f(message));\n      };\n      var bind = function (f) {\n        return error(message);\n      };\n      var fold = function (onError, _) {\n        return onError(message);\n      };\n      return {\n        is: never,\n        isValue: never,\n        isError: always,\n        getOr: identity,\n        getOrThunk: getOrThunk,\n        getOrDie: getOrDie,\n        or: or,\n        orThunk: orThunk,\n        fold: fold,\n        map: map,\n        mapError: mapError,\n        each: noop,\n        bind: bind,\n        exists: never,\n        forall: always,\n        toOption: Option.none\n      };\n    };\n    var fromOption = function (opt, err) {\n      return opt.fold(function () {\n        return error(err);\n      }, value);\n    };\n    var Result = {\n      value: value,\n      error: error,\n      fromOption: fromOption\n    };\n\n    function StyleSheetLoader(document, settings) {\n      if (settings === void 0) {\n        settings = {};\n      }\n      var idCount = 0;\n      var loadedStates = {};\n      var maxLoadTime;\n      maxLoadTime = settings.maxLoadTime || 5000;\n      var appendToHead = function (node) {\n        document.getElementsByTagName('head')[0].appendChild(node);\n      };\n      var load = function (url, loadedCallback, errorCallback) {\n        var link, style, startTime, state;\n        var passed = function () {\n          var callbacks = state.passed;\n          var i = callbacks.length;\n          while (i--) {\n            callbacks[i]();\n          }\n          state.status = 2;\n          state.passed = [];\n          state.failed = [];\n        };\n        var failed = function () {\n          var callbacks = state.failed;\n          var i = callbacks.length;\n          while (i--) {\n            callbacks[i]();\n          }\n          state.status = 3;\n          state.passed = [];\n          state.failed = [];\n        };\n        var isOldWebKit = function () {\n          var webKitChunks = domGlobals.navigator.userAgent.match(/WebKit\\/(\\d*)/);\n          return !!(webKitChunks && parseInt(webKitChunks[1], 10) < 536);\n        };\n        var wait = function (testCallback, waitCallback) {\n          if (!testCallback()) {\n            if (new Date().getTime() - startTime < maxLoadTime) {\n              Delay.setTimeout(waitCallback);\n            } else {\n              failed();\n            }\n          }\n        };\n        var waitForWebKitLinkLoaded = function () {\n          wait(function () {\n            var styleSheets = document.styleSheets;\n            var styleSheet, i = styleSheets.length, owner;\n            while (i--) {\n              styleSheet = styleSheets[i];\n              owner = styleSheet.ownerNode ? styleSheet.ownerNode : styleSheet.owningElement;\n              if (owner && owner.id === link.id) {\n                passed();\n                return true;\n              }\n            }\n          }, waitForWebKitLinkLoaded);\n        };\n        var waitForGeckoLinkLoaded = function () {\n          wait(function () {\n            try {\n              var cssRules = style.sheet.cssRules;\n              passed();\n              return !!cssRules;\n            } catch (ex) {\n            }\n          }, waitForGeckoLinkLoaded);\n        };\n        url = Tools._addCacheSuffix(url);\n        if (!loadedStates[url]) {\n          state = {\n            passed: [],\n            failed: []\n          };\n          loadedStates[url] = state;\n        } else {\n          state = loadedStates[url];\n        }\n        if (loadedCallback) {\n          state.passed.push(loadedCallback);\n        }\n        if (errorCallback) {\n          state.failed.push(errorCallback);\n        }\n        if (state.status === 1) {\n          return;\n        }\n        if (state.status === 2) {\n          passed();\n          return;\n        }\n        if (state.status === 3) {\n          failed();\n          return;\n        }\n        state.status = 1;\n        link = document.createElement('link');\n        link.rel = 'stylesheet';\n        link.type = 'text/css';\n        link.id = 'u' + idCount++;\n        link.async = false;\n        link.defer = false;\n        startTime = new Date().getTime();\n        if (settings.contentCssCors) {\n          link.crossOrigin = 'anonymous';\n        }\n        if ('onload' in link && !isOldWebKit()) {\n          link.onload = waitForWebKitLinkLoaded;\n          link.onerror = failed;\n        } else {\n          if (domGlobals.navigator.userAgent.indexOf('Firefox') > 0) {\n            style = document.createElement('style');\n            style.textContent = '@import \"' + url + '\"';\n            waitForGeckoLinkLoaded();\n            appendToHead(style);\n            return;\n          }\n          waitForWebKitLinkLoaded();\n        }\n        appendToHead(link);\n        link.href = url;\n      };\n      var loadF = function (url) {\n        return Future.nu(function (resolve) {\n          load(url, compose(resolve, constant(Result.value(url))), compose(resolve, constant(Result.error(url))));\n        });\n      };\n      var unbox = function (result) {\n        return result.fold(identity, identity);\n      };\n      var loadAll = function (urls, success, failure) {\n        par$1(map(urls, loadF)).get(function (result) {\n          var parts = partition(result, function (r) {\n            return r.isValue();\n          });\n          if (parts.fail.length > 0) {\n            failure(parts.fail.map(unbox));\n          } else {\n            success(parts.pass.map(unbox));\n          }\n        });\n      };\n      return {\n        load: load,\n        loadAll: loadAll\n      };\n    }\n\n    function TreeWalker (startNode, rootNode) {\n      var node = startNode;\n      var findSibling = function (node, startName, siblingName, shallow) {\n        var sibling, parent;\n        if (node) {\n          if (!shallow && node[startName]) {\n            return node[startName];\n          }\n          if (node !== rootNode) {\n            sibling = node[siblingName];\n            if (sibling) {\n              return sibling;\n            }\n            for (parent = node.parentNode; parent && parent !== rootNode; parent = parent.parentNode) {\n              sibling = parent[siblingName];\n              if (sibling) {\n                return sibling;\n              }\n            }\n          }\n        }\n      };\n      var findPreviousNode = function (node, startName, siblingName, shallow) {\n        var sibling, parent, child;\n        if (node) {\n          sibling = node[siblingName];\n          if (rootNode && sibling === rootNode) {\n            return;\n          }\n          if (sibling) {\n            if (!shallow) {\n              for (child = sibling[startName]; child; child = child[startName]) {\n                if (!child[startName]) {\n                  return child;\n                }\n              }\n            }\n            return sibling;\n          }\n          parent = node.parentNode;\n          if (parent && parent !== rootNode) {\n            return parent;\n          }\n        }\n      };\n      this.current = function () {\n        return node;\n      };\n      this.next = function (shallow) {\n        node = findSibling(node, 'firstChild', 'nextSibling', shallow);\n        return node;\n      };\n      this.prev = function (shallow) {\n        node = findSibling(node, 'lastChild', 'previousSibling', shallow);\n        return node;\n      };\n      this.prev2 = function (shallow) {\n        node = findPreviousNode(node, 'lastChild', 'previousSibling', shallow);\n        return node;\n      };\n    }\n\n    var blocks = [\n      'article',\n      'aside',\n      'details',\n      'div',\n      'dt',\n      'figcaption',\n      'footer',\n      'form',\n      'fieldset',\n      'header',\n      'hgroup',\n      'html',\n      'main',\n      'nav',\n      'section',\n      'summary',\n      'body',\n      'p',\n      'dl',\n      'multicol',\n      'dd',\n      'figure',\n      'address',\n      'center',\n      'blockquote',\n      'h1',\n      'h2',\n      'h3',\n      'h4',\n      'h5',\n      'h6',\n      'listing',\n      'xmp',\n      'pre',\n      'plaintext',\n      'menu',\n      'dir',\n      'ul',\n      'ol',\n      'li',\n      'hr',\n      'table',\n      'tbody',\n      'thead',\n      'tfoot',\n      'th',\n      'tr',\n      'td',\n      'caption'\n    ];\n    var voids = [\n      'area',\n      'base',\n      'basefont',\n      'br',\n      'col',\n      'frame',\n      'hr',\n      'img',\n      'input',\n      'isindex',\n      'link',\n      'meta',\n      'param',\n      'embed',\n      'source',\n      'wbr',\n      'track'\n    ];\n    var tableCells = [\n      'td',\n      'th'\n    ];\n    var tableSections = [\n      'thead',\n      'tbody',\n      'tfoot'\n    ];\n    var textBlocks = [\n      'h1',\n      'h2',\n      'h3',\n      'h4',\n      'h5',\n      'h6',\n      'p',\n      'div',\n      'address',\n      'pre',\n      'form',\n      'blockquote',\n      'center',\n      'dir',\n      'fieldset',\n      'header',\n      'footer',\n      'article',\n      'section',\n      'hgroup',\n      'aside',\n      'nav',\n      'figure'\n    ];\n    var headings = [\n      'h1',\n      'h2',\n      'h3',\n      'h4',\n      'h5',\n      'h6'\n    ];\n    var listItems = [\n      'li',\n      'dd',\n      'dt'\n    ];\n    var lists = [\n      'ul',\n      'ol',\n      'dl'\n    ];\n    var wsElements = [\n      'pre',\n      'script',\n      'textarea',\n      'style'\n    ];\n    var lazyLookup = function (items) {\n      var lookup;\n      return function (node) {\n        lookup = lookup ? lookup : mapToObject(items, constant(true));\n        return lookup.hasOwnProperty(name(node));\n      };\n    };\n    var isHeading = lazyLookup(headings);\n    var isBlock = lazyLookup(blocks);\n    var isInline = function (node) {\n      return isElement(node) && !isBlock(node);\n    };\n    var isBr = function (node) {\n      return isElement(node) && name(node) === 'br';\n    };\n    var isTextBlock = lazyLookup(textBlocks);\n    var isList = lazyLookup(lists);\n    var isListItem = lazyLookup(listItems);\n    var isVoid = lazyLookup(voids);\n    var isTableSection = lazyLookup(tableSections);\n    var isTableCell = lazyLookup(tableCells);\n    var isWsPreserveElement = lazyLookup(wsElements);\n\n    var isNodeType = function (type) {\n      return function (node) {\n        return !!node && node.nodeType === type;\n      };\n    };\n    var isRestrictedNode = function (node) {\n      return !!node && !Object.getPrototypeOf(node);\n    };\n    var isElement$1 = isNodeType(1);\n    var matchNodeNames = function (names) {\n      var items = names.toLowerCase().split(' ');\n      return function (node) {\n        var i, name;\n        if (node && node.nodeType) {\n          name = node.nodeName.toLowerCase();\n          for (i = 0; i < items.length; i++) {\n            if (name === items[i]) {\n              return true;\n            }\n          }\n        }\n        return false;\n      };\n    };\n    var matchStyleValues = function (name, values) {\n      var items = values.toLowerCase().split(' ');\n      return function (node) {\n        var i, cssValue;\n        if (isElement$1(node)) {\n          for (i = 0; i < items.length; i++) {\n            var computed = node.ownerDocument.defaultView.getComputedStyle(node, null);\n            cssValue = computed ? computed.getPropertyValue(name) : null;\n            if (cssValue === items[i]) {\n              return true;\n            }\n          }\n        }\n        return false;\n      };\n    };\n    var hasPropValue = function (propName, propValue) {\n      return function (node) {\n        return isElement$1(node) && node[propName] === propValue;\n      };\n    };\n    var hasAttribute = function (attrName, attrValue) {\n      return function (node) {\n        return isElement$1(node) && node.hasAttribute(attrName);\n      };\n    };\n    var hasAttributeValue = function (attrName, attrValue) {\n      return function (node) {\n        return isElement$1(node) && node.getAttribute(attrName) === attrValue;\n      };\n    };\n    var isBogus = function (node) {\n      return isElement$1(node) && node.hasAttribute('data-mce-bogus');\n    };\n    var isBogusAll = function (node) {\n      return isElement$1(node) && node.getAttribute('data-mce-bogus') === 'all';\n    };\n    var isTable = function (node) {\n      return isElement$1(node) && node.tagName === 'TABLE';\n    };\n    var hasContentEditableState = function (value) {\n      return function (node) {\n        if (isElement$1(node)) {\n          if (node.contentEditable === value) {\n            return true;\n          }\n          if (node.getAttribute('data-mce-contenteditable') === value) {\n            return true;\n          }\n        }\n        return false;\n      };\n    };\n    var isText$1 = isNodeType(3);\n    var isComment = isNodeType(8);\n    var isDocument = isNodeType(9);\n    var isDocumentFragment = isNodeType(11);\n    var isBr$1 = matchNodeNames('br');\n    var isContentEditableTrue = hasContentEditableState('true');\n    var isContentEditableFalse = hasContentEditableState('false');\n    var NodeType = {\n      isText: isText$1,\n      isElement: isElement$1,\n      isComment: isComment,\n      isDocument: isDocument,\n      isDocumentFragment: isDocumentFragment,\n      isBr: isBr$1,\n      isContentEditableTrue: isContentEditableTrue,\n      isContentEditableFalse: isContentEditableFalse,\n      isRestrictedNode: isRestrictedNode,\n      matchNodeNames: matchNodeNames,\n      hasPropValue: hasPropValue,\n      hasAttribute: hasAttribute,\n      hasAttributeValue: hasAttributeValue,\n      matchStyleValues: matchStyleValues,\n      isBogus: isBogus,\n      isBogusAll: isBogusAll,\n      isTable: isTable\n    };\n\n    var surroundedBySpans = function (node) {\n      var previousIsSpan = node.previousSibling && node.previousSibling.nodeName === 'SPAN';\n      var nextIsSpan = node.nextSibling && node.nextSibling.nodeName === 'SPAN';\n      return previousIsSpan && nextIsSpan;\n    };\n    var isBookmarkNode = function (node) {\n      return node && node.tagName === 'SPAN' && node.getAttribute('data-mce-type') === 'bookmark';\n    };\n    var trimNode = function (dom, node) {\n      var i, children = node.childNodes;\n      if (NodeType.isElement(node) && isBookmarkNode(node)) {\n        return;\n      }\n      for (i = children.length - 1; i >= 0; i--) {\n        trimNode(dom, children[i]);\n      }\n      if (NodeType.isDocument(node) === false) {\n        if (NodeType.isText(node) && node.nodeValue.length > 0) {\n          var trimmedLength = Tools.trim(node.nodeValue).length;\n          if (dom.isBlock(node.parentNode) || trimmedLength > 0) {\n            return;\n          }\n          if (trimmedLength === 0 && surroundedBySpans(node)) {\n            return;\n          }\n        } else if (NodeType.isElement(node)) {\n          children = node.childNodes;\n          if (children.length === 1 && isBookmarkNode(children[0])) {\n            node.parentNode.insertBefore(children[0], node);\n          }\n          if (children.length || isVoid(Element.fromDom(node))) {\n            return;\n          }\n        }\n        dom.remove(node);\n      }\n      return node;\n    };\n    var TrimNode = { trimNode: trimNode };\n\n    var makeMap$1 = Tools.makeMap;\n    var namedEntities, baseEntities, reverseEntities;\n    var attrsCharsRegExp = /[&<>\\\"\\u0060\\u007E-\\uD7FF\\uE000-\\uFFEF]|[\\uD800-\\uDBFF][\\uDC00-\\uDFFF]/g;\n    var textCharsRegExp = /[<>&\\u007E-\\uD7FF\\uE000-\\uFFEF]|[\\uD800-\\uDBFF][\\uDC00-\\uDFFF]/g;\n    var rawCharsRegExp = /[<>&\\\"\\']/g;\n    var entityRegExp = /&#([a-z0-9]+);?|&([a-z0-9]+);/gi;\n    var asciiMap = {\n      128: '\\u20AC',\n      130: '\\u201A',\n      131: '\\u0192',\n      132: '\\u201E',\n      133: '\\u2026',\n      134: '\\u2020',\n      135: '\\u2021',\n      136: '\\u02c6',\n      137: '\\u2030',\n      138: '\\u0160',\n      139: '\\u2039',\n      140: '\\u0152',\n      142: '\\u017d',\n      145: '\\u2018',\n      146: '\\u2019',\n      147: '\\u201C',\n      148: '\\u201D',\n      149: '\\u2022',\n      150: '\\u2013',\n      151: '\\u2014',\n      152: '\\u02DC',\n      153: '\\u2122',\n      154: '\\u0161',\n      155: '\\u203A',\n      156: '\\u0153',\n      158: '\\u017e',\n      159: '\\u0178'\n    };\n    baseEntities = {\n      '\"': '&quot;',\n      '\\'': '&#39;',\n      '<': '&lt;',\n      '>': '&gt;',\n      '&': '&amp;',\n      '`': '&#96;'\n    };\n    reverseEntities = {\n      '&lt;': '<',\n      '&gt;': '>',\n      '&amp;': '&',\n      '&quot;': '\"',\n      '&apos;': '\\''\n    };\n    var nativeDecode = function (text) {\n      var elm;\n      elm = Element.fromTag('div').dom();\n      elm.innerHTML = text;\n      return elm.textContent || elm.innerText || text;\n    };\n    var buildEntitiesLookup = function (items, radix) {\n      var i, chr, entity;\n      var lookup = {};\n      if (items) {\n        items = items.split(',');\n        radix = radix || 10;\n        for (i = 0; i < items.length; i += 2) {\n          chr = String.fromCharCode(parseInt(items[i], radix));\n          if (!baseEntities[chr]) {\n            entity = '&' + items[i + 1] + ';';\n            lookup[chr] = entity;\n            lookup[entity] = chr;\n          }\n        }\n        return lookup;\n      }\n    };\n    namedEntities = buildEntitiesLookup('50,nbsp,51,iexcl,52,cent,53,pound,54,curren,55,yen,56,brvbar,57,sect,58,uml,59,copy,' + '5a,ordf,5b,laquo,5c,not,5d,shy,5e,reg,5f,macr,5g,deg,5h,plusmn,5i,sup2,5j,sup3,5k,acute,' + '5l,micro,5m,para,5n,middot,5o,cedil,5p,sup1,5q,ordm,5r,raquo,5s,frac14,5t,frac12,5u,frac34,' + '5v,iquest,60,Agrave,61,Aacute,62,Acirc,63,Atilde,64,Auml,65,Aring,66,AElig,67,Ccedil,' + '68,Egrave,69,Eacute,6a,Ecirc,6b,Euml,6c,Igrave,6d,Iacute,6e,Icirc,6f,Iuml,6g,ETH,6h,Ntilde,' + '6i,Ograve,6j,Oacute,6k,Ocirc,6l,Otilde,6m,Ouml,6n,times,6o,Oslash,6p,Ugrave,6q,Uacute,' + '6r,Ucirc,6s,Uuml,6t,Yacute,6u,THORN,6v,szlig,70,agrave,71,aacute,72,acirc,73,atilde,74,auml,' + '75,aring,76,aelig,77,ccedil,78,egrave,79,eacute,7a,ecirc,7b,euml,7c,igrave,7d,iacute,7e,icirc,' + '7f,iuml,7g,eth,7h,ntilde,7i,ograve,7j,oacute,7k,ocirc,7l,otilde,7m,ouml,7n,divide,7o,oslash,' + '7p,ugrave,7q,uacute,7r,ucirc,7s,uuml,7t,yacute,7u,thorn,7v,yuml,ci,fnof,sh,Alpha,si,Beta,' + 'sj,Gamma,sk,Delta,sl,Epsilon,sm,Zeta,sn,Eta,so,Theta,sp,Iota,sq,Kappa,sr,Lambda,ss,Mu,' + 'st,Nu,su,Xi,sv,Omicron,t0,Pi,t1,Rho,t3,Sigma,t4,Tau,t5,Upsilon,t6,Phi,t7,Chi,t8,Psi,' + 't9,Omega,th,alpha,ti,beta,tj,gamma,tk,delta,tl,epsilon,tm,zeta,tn,eta,to,theta,tp,iota,' + 'tq,kappa,tr,lambda,ts,mu,tt,nu,tu,xi,tv,omicron,u0,pi,u1,rho,u2,sigmaf,u3,sigma,u4,tau,' + 'u5,upsilon,u6,phi,u7,chi,u8,psi,u9,omega,uh,thetasym,ui,upsih,um,piv,812,bull,816,hellip,' + '81i,prime,81j,Prime,81u,oline,824,frasl,88o,weierp,88h,image,88s,real,892,trade,89l,alefsym,' + '8cg,larr,8ch,uarr,8ci,rarr,8cj,darr,8ck,harr,8dl,crarr,8eg,lArr,8eh,uArr,8ei,rArr,8ej,dArr,' + '8ek,hArr,8g0,forall,8g2,part,8g3,exist,8g5,empty,8g7,nabla,8g8,isin,8g9,notin,8gb,ni,8gf,prod,' + '8gh,sum,8gi,minus,8gn,lowast,8gq,radic,8gt,prop,8gu,infin,8h0,ang,8h7,and,8h8,or,8h9,cap,8ha,cup,' + '8hb,int,8hk,there4,8hs,sim,8i5,cong,8i8,asymp,8j0,ne,8j1,equiv,8j4,le,8j5,ge,8k2,sub,8k3,sup,8k4,' + 'nsub,8k6,sube,8k7,supe,8kl,oplus,8kn,otimes,8l5,perp,8m5,sdot,8o8,lceil,8o9,rceil,8oa,lfloor,8ob,' + 'rfloor,8p9,lang,8pa,rang,9ea,loz,9j0,spades,9j3,clubs,9j5,hearts,9j6,diams,ai,OElig,aj,oelig,b0,' + 'Scaron,b1,scaron,bo,Yuml,m6,circ,ms,tilde,802,ensp,803,emsp,809,thinsp,80c,zwnj,80d,zwj,80e,lrm,' + '80f,rlm,80j,ndash,80k,mdash,80o,lsquo,80p,rsquo,80q,sbquo,80s,ldquo,80t,rdquo,80u,bdquo,810,dagger,' + '811,Dagger,81g,permil,81p,lsaquo,81q,rsaquo,85c,euro', 32);\n    var encodeRaw = function (text, attr) {\n      return text.replace(attr ? attrsCharsRegExp : textCharsRegExp, function (chr) {\n        return baseEntities[chr] || chr;\n      });\n    };\n    var encodeAllRaw = function (text) {\n      return ('' + text).replace(rawCharsRegExp, function (chr) {\n        return baseEntities[chr] || chr;\n      });\n    };\n    var encodeNumeric = function (text, attr) {\n      return text.replace(attr ? attrsCharsRegExp : textCharsRegExp, function (chr) {\n        if (chr.length > 1) {\n          return '&#' + ((chr.charCodeAt(0) - 55296) * 1024 + (chr.charCodeAt(1) - 56320) + 65536) + ';';\n        }\n        return baseEntities[chr] || '&#' + chr.charCodeAt(0) + ';';\n      });\n    };\n    var encodeNamed = function (text, attr, entities) {\n      entities = entities || namedEntities;\n      return text.replace(attr ? attrsCharsRegExp : textCharsRegExp, function (chr) {\n        return baseEntities[chr] || entities[chr] || chr;\n      });\n    };\n    var getEncodeFunc = function (name, entities) {\n      var entitiesMap = buildEntitiesLookup(entities) || namedEntities;\n      var encodeNamedAndNumeric = function (text, attr) {\n        return text.replace(attr ? attrsCharsRegExp : textCharsRegExp, function (chr) {\n          if (baseEntities[chr] !== undefined) {\n            return baseEntities[chr];\n          }\n          if (entitiesMap[chr] !== undefined) {\n            return entitiesMap[chr];\n          }\n          if (chr.length > 1) {\n            return '&#' + ((chr.charCodeAt(0) - 55296) * 1024 + (chr.charCodeAt(1) - 56320) + 65536) + ';';\n          }\n          return '&#' + chr.charCodeAt(0) + ';';\n        });\n      };\n      var encodeCustomNamed = function (text, attr) {\n        return encodeNamed(text, attr, entitiesMap);\n      };\n      var nameMap = makeMap$1(name.replace(/\\+/g, ','));\n      if (nameMap.named && nameMap.numeric) {\n        return encodeNamedAndNumeric;\n      }\n      if (nameMap.named) {\n        if (entities) {\n          return encodeCustomNamed;\n        }\n        return encodeNamed;\n      }\n      if (nameMap.numeric) {\n        return encodeNumeric;\n      }\n      return encodeRaw;\n    };\n    var decode = function (text) {\n      return text.replace(entityRegExp, function (all, numeric) {\n        if (numeric) {\n          if (numeric.charAt(0).toLowerCase() === 'x') {\n            numeric = parseInt(numeric.substr(1), 16);\n          } else {\n            numeric = parseInt(numeric, 10);\n          }\n          if (numeric > 65535) {\n            numeric -= 65536;\n            return String.fromCharCode(55296 + (numeric >> 10), 56320 + (numeric & 1023));\n          }\n          return asciiMap[numeric] || String.fromCharCode(numeric);\n        }\n        return reverseEntities[all] || namedEntities[all] || nativeDecode(all);\n      });\n    };\n    var Entities = {\n      encodeRaw: encodeRaw,\n      encodeAllRaw: encodeAllRaw,\n      encodeNumeric: encodeNumeric,\n      encodeNamed: encodeNamed,\n      getEncodeFunc: getEncodeFunc,\n      decode: decode\n    };\n\n    var mapCache = {}, dummyObj = {};\n    var makeMap$2 = Tools.makeMap, each$4 = Tools.each, extend$1 = Tools.extend, explode$1 = Tools.explode, inArray$1 = Tools.inArray;\n    var split = function (items, delim) {\n      items = Tools.trim(items);\n      return items ? items.split(delim || ' ') : [];\n    };\n    var compileSchema = function (type) {\n      var schema = {};\n      var globalAttributes, blockContent;\n      var phrasingContent, flowContent, html4BlockContent, html4PhrasingContent;\n      var add = function (name, attributes, children) {\n        var ni, attributesOrder, element;\n        var arrayToMap = function (array, obj) {\n          var map = {};\n          var i, l;\n          for (i = 0, l = array.length; i < l; i++) {\n            map[array[i]] = obj || {};\n          }\n          return map;\n        };\n        children = children || [];\n        attributes = attributes || '';\n        if (typeof children === 'string') {\n          children = split(children);\n        }\n        name = split(name);\n        ni = name.length;\n        while (ni--) {\n          attributesOrder = split([\n            globalAttributes,\n            attributes\n          ].join(' '));\n          element = {\n            attributes: arrayToMap(attributesOrder),\n            attributesOrder: attributesOrder,\n            children: arrayToMap(children, dummyObj)\n          };\n          schema[name[ni]] = element;\n        }\n      };\n      var addAttrs = function (name, attributes) {\n        var ni, schemaItem, i, l;\n        name = split(name);\n        ni = name.length;\n        attributes = split(attributes);\n        while (ni--) {\n          schemaItem = schema[name[ni]];\n          for (i = 0, l = attributes.length; i < l; i++) {\n            schemaItem.attributes[attributes[i]] = {};\n            schemaItem.attributesOrder.push(attributes[i]);\n          }\n        }\n      };\n      if (mapCache[type]) {\n        return mapCache[type];\n      }\n      globalAttributes = 'id accesskey class dir lang style tabindex title role';\n      blockContent = 'address blockquote div dl fieldset form h1 h2 h3 h4 h5 h6 hr menu ol p pre table ul';\n      phrasingContent = 'a abbr b bdo br button cite code del dfn em embed i iframe img input ins kbd ' + 'label map noscript object q s samp script select small span strong sub sup ' + 'textarea u var #text #comment';\n      if (type !== 'html4') {\n        globalAttributes += ' contenteditable contextmenu draggable dropzone ' + 'hidden spellcheck translate';\n        blockContent += ' article aside details dialog figure main header footer hgroup section nav';\n        phrasingContent += ' audio canvas command datalist mark meter output picture ' + 'progress time wbr video ruby bdi keygen';\n      }\n      if (type !== 'html5-strict') {\n        globalAttributes += ' xml:lang';\n        html4PhrasingContent = 'acronym applet basefont big font strike tt';\n        phrasingContent = [\n          phrasingContent,\n          html4PhrasingContent\n        ].join(' ');\n        each$4(split(html4PhrasingContent), function (name) {\n          add(name, '', phrasingContent);\n        });\n        html4BlockContent = 'center dir isindex noframes';\n        blockContent = [\n          blockContent,\n          html4BlockContent\n        ].join(' ');\n        flowContent = [\n          blockContent,\n          phrasingContent\n        ].join(' ');\n        each$4(split(html4BlockContent), function (name) {\n          add(name, '', flowContent);\n        });\n      }\n      flowContent = flowContent || [\n        blockContent,\n        phrasingContent\n      ].join(' ');\n      add('html', 'manifest', 'head body');\n      add('head', '', 'base command link meta noscript script style title');\n      add('title hr noscript br');\n      add('base', 'href target');\n      add('link', 'href rel media hreflang type sizes hreflang');\n      add('meta', 'name http-equiv content charset');\n      add('style', 'media type scoped');\n      add('script', 'src async defer type charset');\n      add('body', 'onafterprint onbeforeprint onbeforeunload onblur onerror onfocus ' + 'onhashchange onload onmessage onoffline ononline onpagehide onpageshow ' + 'onpopstate onresize onscroll onstorage onunload', flowContent);\n      add('address dt dd div caption', '', flowContent);\n      add('h1 h2 h3 h4 h5 h6 pre p abbr code var samp kbd sub sup i b u bdo span legend em strong small s cite dfn', '', phrasingContent);\n      add('blockquote', 'cite', flowContent);\n      add('ol', 'reversed start type', 'li');\n      add('ul', '', 'li');\n      add('li', 'value', flowContent);\n      add('dl', '', 'dt dd');\n      add('a', 'href target rel media hreflang type', phrasingContent);\n      add('q', 'cite', phrasingContent);\n      add('ins del', 'cite datetime', flowContent);\n      add('img', 'src sizes srcset alt usemap ismap width height');\n      add('iframe', 'src name width height', flowContent);\n      add('embed', 'src type width height');\n      add('object', 'data type typemustmatch name usemap form width height', [\n        flowContent,\n        'param'\n      ].join(' '));\n      add('param', 'name value');\n      add('map', 'name', [\n        flowContent,\n        'area'\n      ].join(' '));\n      add('area', 'alt coords shape href target rel media hreflang type');\n      add('table', 'border', 'caption colgroup thead tfoot tbody tr' + (type === 'html4' ? ' col' : ''));\n      add('colgroup', 'span', 'col');\n      add('col', 'span');\n      add('tbody thead tfoot', '', 'tr');\n      add('tr', '', 'td th');\n      add('td', 'colspan rowspan headers', flowContent);\n      add('th', 'colspan rowspan headers scope abbr', flowContent);\n      add('form', 'accept-charset action autocomplete enctype method name novalidate target', flowContent);\n      add('fieldset', 'disabled form name', [\n        flowContent,\n        'legend'\n      ].join(' '));\n      add('label', 'form for', phrasingContent);\n      add('input', 'accept alt autocomplete checked dirname disabled form formaction formenctype formmethod formnovalidate ' + 'formtarget height list max maxlength min multiple name pattern readonly required size src step type value width');\n      add('button', 'disabled form formaction formenctype formmethod formnovalidate formtarget name type value', type === 'html4' ? flowContent : phrasingContent);\n      add('select', 'disabled form multiple name required size', 'option optgroup');\n      add('optgroup', 'disabled label', 'option');\n      add('option', 'disabled label selected value');\n      add('textarea', 'cols dirname disabled form maxlength name readonly required rows wrap');\n      add('menu', 'type label', [\n        flowContent,\n        'li'\n      ].join(' '));\n      add('noscript', '', flowContent);\n      if (type !== 'html4') {\n        add('wbr');\n        add('ruby', '', [\n          phrasingContent,\n          'rt rp'\n        ].join(' '));\n        add('figcaption', '', flowContent);\n        add('mark rt rp summary bdi', '', phrasingContent);\n        add('canvas', 'width height', flowContent);\n        add('video', 'src crossorigin poster preload autoplay mediagroup loop ' + 'muted controls width height buffered', [\n          flowContent,\n          'track source'\n        ].join(' '));\n        add('audio', 'src crossorigin preload autoplay mediagroup loop muted controls ' + 'buffered volume', [\n          flowContent,\n          'track source'\n        ].join(' '));\n        add('picture', '', 'img source');\n        add('source', 'src srcset type media sizes');\n        add('track', 'kind src srclang label default');\n        add('datalist', '', [\n          phrasingContent,\n          'option'\n        ].join(' '));\n        add('article section nav aside main header footer', '', flowContent);\n        add('hgroup', '', 'h1 h2 h3 h4 h5 h6');\n        add('figure', '', [\n          flowContent,\n          'figcaption'\n        ].join(' '));\n        add('time', 'datetime', phrasingContent);\n        add('dialog', 'open', flowContent);\n        add('command', 'type label icon disabled checked radiogroup command');\n        add('output', 'for form name', phrasingContent);\n        add('progress', 'value max', phrasingContent);\n        add('meter', 'value min max low high optimum', phrasingContent);\n        add('details', 'open', [\n          flowContent,\n          'summary'\n        ].join(' '));\n        add('keygen', 'autofocus challenge disabled form keytype name');\n      }\n      if (type !== 'html5-strict') {\n        addAttrs('script', 'language xml:space');\n        addAttrs('style', 'xml:space');\n        addAttrs('object', 'declare classid code codebase codetype archive standby align border hspace vspace');\n        addAttrs('embed', 'align name hspace vspace');\n        addAttrs('param', 'valuetype type');\n        addAttrs('a', 'charset name rev shape coords');\n        addAttrs('br', 'clear');\n        addAttrs('applet', 'codebase archive code object alt name width height align hspace vspace');\n        addAttrs('img', 'name longdesc align border hspace vspace');\n        addAttrs('iframe', 'longdesc frameborder marginwidth marginheight scrolling align');\n        addAttrs('font basefont', 'size color face');\n        addAttrs('input', 'usemap align');\n        addAttrs('select', 'onchange');\n        addAttrs('textarea');\n        addAttrs('h1 h2 h3 h4 h5 h6 div p legend caption', 'align');\n        addAttrs('ul', 'type compact');\n        addAttrs('li', 'type');\n        addAttrs('ol dl menu dir', 'compact');\n        addAttrs('pre', 'width xml:space');\n        addAttrs('hr', 'align noshade size width');\n        addAttrs('isindex', 'prompt');\n        addAttrs('table', 'summary width frame rules cellspacing cellpadding align bgcolor');\n        addAttrs('col', 'width align char charoff valign');\n        addAttrs('colgroup', 'width align char charoff valign');\n        addAttrs('thead', 'align char charoff valign');\n        addAttrs('tr', 'align char charoff valign bgcolor');\n        addAttrs('th', 'axis align char charoff valign nowrap bgcolor width height');\n        addAttrs('form', 'accept');\n        addAttrs('td', 'abbr axis scope align char charoff valign nowrap bgcolor width height');\n        addAttrs('tfoot', 'align char charoff valign');\n        addAttrs('tbody', 'align char charoff valign');\n        addAttrs('area', 'nohref');\n        addAttrs('body', 'background bgcolor text link vlink alink');\n      }\n      if (type !== 'html4') {\n        addAttrs('input button select textarea', 'autofocus');\n        addAttrs('input textarea', 'placeholder');\n        addAttrs('a', 'download');\n        addAttrs('link script img', 'crossorigin');\n        addAttrs('iframe', 'sandbox seamless allowfullscreen');\n      }\n      each$4(split('a form meter progress dfn'), function (name) {\n        if (schema[name]) {\n          delete schema[name].children[name];\n        }\n      });\n      delete schema.caption.children.table;\n      delete schema.script;\n      mapCache[type] = schema;\n      return schema;\n    };\n    var compileElementMap = function (value, mode) {\n      var styles;\n      if (value) {\n        styles = {};\n        if (typeof value === 'string') {\n          value = { '*': value };\n        }\n        each$4(value, function (value, key) {\n          styles[key] = styles[key.toUpperCase()] = mode === 'map' ? makeMap$2(value, /[, ]/) : explode$1(value, /[, ]/);\n        });\n      }\n      return styles;\n    };\n    function Schema(settings) {\n      var elements = {};\n      var children = {};\n      var patternElements = [];\n      var validStyles;\n      var invalidStyles;\n      var schemaItems;\n      var whiteSpaceElementsMap, selfClosingElementsMap, shortEndedElementsMap, boolAttrMap, validClasses;\n      var blockElementsMap, nonEmptyElementsMap, moveCaretBeforeOnEnterElementsMap, textBlockElementsMap, textInlineElementsMap;\n      var customElementsMap = {}, specialElements = {};\n      var createLookupTable = function (option, defaultValue, extendWith) {\n        var value = settings[option];\n        if (!value) {\n          value = mapCache[option];\n          if (!value) {\n            value = makeMap$2(defaultValue, ' ', makeMap$2(defaultValue.toUpperCase(), ' '));\n            value = extend$1(value, extendWith);\n            mapCache[option] = value;\n          }\n        } else {\n          value = makeMap$2(value, /[, ]/, makeMap$2(value.toUpperCase(), /[, ]/));\n        }\n        return value;\n      };\n      settings = settings || {};\n      schemaItems = compileSchema(settings.schema);\n      if (settings.verify_html === false) {\n        settings.valid_elements = '*[*]';\n      }\n      validStyles = compileElementMap(settings.valid_styles);\n      invalidStyles = compileElementMap(settings.invalid_styles, 'map');\n      validClasses = compileElementMap(settings.valid_classes, 'map');\n      whiteSpaceElementsMap = createLookupTable('whitespace_elements', 'pre script noscript style textarea video audio iframe object code');\n      selfClosingElementsMap = createLookupTable('self_closing_elements', 'colgroup dd dt li option p td tfoot th thead tr');\n      shortEndedElementsMap = createLookupTable('short_ended_elements', 'area base basefont br col frame hr img input isindex link ' + 'meta param embed source wbr track');\n      boolAttrMap = createLookupTable('boolean_attributes', 'checked compact declare defer disabled ismap multiple nohref noresize ' + 'noshade nowrap readonly selected autoplay loop controls');\n      nonEmptyElementsMap = createLookupTable('non_empty_elements', 'td th iframe video audio object ' + 'script pre code', shortEndedElementsMap);\n      moveCaretBeforeOnEnterElementsMap = createLookupTable('move_caret_before_on_enter_elements', 'table', nonEmptyElementsMap);\n      textBlockElementsMap = createLookupTable('text_block_elements', 'h1 h2 h3 h4 h5 h6 p div address pre form ' + 'blockquote center dir fieldset header footer article section hgroup aside main nav figure');\n      blockElementsMap = createLookupTable('block_elements', 'hr table tbody thead tfoot ' + 'th tr td li ol ul caption dl dt dd noscript menu isindex option ' + 'datalist select optgroup figcaption details summary', textBlockElementsMap);\n      textInlineElementsMap = createLookupTable('text_inline_elements', 'span strong b em i font strike u var cite ' + 'dfn code mark q sup sub samp');\n      each$4((settings.special || 'script noscript iframe noframes noembed title style textarea xmp').split(' '), function (name) {\n        specialElements[name] = new RegExp('</' + name + '[^>]*>', 'gi');\n      });\n      var patternToRegExp = function (str) {\n        return new RegExp('^' + str.replace(/([?+*])/g, '.$1') + '$');\n      };\n      var addValidElements = function (validElements) {\n        var ei, el, ai, al, matches, element, attr, attrData, elementName, attrName, attrType, attributes, attributesOrder, prefix, outputName, globalAttributes, globalAttributesOrder, key, value;\n        var elementRuleRegExp = /^([#+\\-])?([^\\[!\\/]+)(?:\\/([^\\[!]+))?(?:(!?)\\[([^\\]]+)\\])?$/, attrRuleRegExp = /^([!\\-])?(\\w+[\\\\:]:\\w+|[^=:<]+)?(?:([=:<])(.*))?$/, hasPatternsRegExp = /[*?+]/;\n        if (validElements) {\n          validElements = split(validElements, ',');\n          if (elements['@']) {\n            globalAttributes = elements['@'].attributes;\n            globalAttributesOrder = elements['@'].attributesOrder;\n          }\n          for (ei = 0, el = validElements.length; ei < el; ei++) {\n            matches = elementRuleRegExp.exec(validElements[ei]);\n            if (matches) {\n              prefix = matches[1];\n              elementName = matches[2];\n              outputName = matches[3];\n              attrData = matches[5];\n              attributes = {};\n              attributesOrder = [];\n              element = {\n                attributes: attributes,\n                attributesOrder: attributesOrder\n              };\n              if (prefix === '#') {\n                element.paddEmpty = true;\n              }\n              if (prefix === '-') {\n                element.removeEmpty = true;\n              }\n              if (matches[4] === '!') {\n                element.removeEmptyAttrs = true;\n              }\n              if (globalAttributes) {\n                for (key in globalAttributes) {\n                  attributes[key] = globalAttributes[key];\n                }\n                attributesOrder.push.apply(attributesOrder, globalAttributesOrder);\n              }\n              if (attrData) {\n                attrData = split(attrData, '|');\n                for (ai = 0, al = attrData.length; ai < al; ai++) {\n                  matches = attrRuleRegExp.exec(attrData[ai]);\n                  if (matches) {\n                    attr = {};\n                    attrType = matches[1];\n                    attrName = matches[2].replace(/[\\\\:]:/g, ':');\n                    prefix = matches[3];\n                    value = matches[4];\n                    if (attrType === '!') {\n                      element.attributesRequired = element.attributesRequired || [];\n                      element.attributesRequired.push(attrName);\n                      attr.required = true;\n                    }\n                    if (attrType === '-') {\n                      delete attributes[attrName];\n                      attributesOrder.splice(inArray$1(attributesOrder, attrName), 1);\n                      continue;\n                    }\n                    if (prefix) {\n                      if (prefix === '=') {\n                        element.attributesDefault = element.attributesDefault || [];\n                        element.attributesDefault.push({\n                          name: attrName,\n                          value: value\n                        });\n                        attr.defaultValue = value;\n                      }\n                      if (prefix === ':') {\n                        element.attributesForced = element.attributesForced || [];\n                        element.attributesForced.push({\n                          name: attrName,\n                          value: value\n                        });\n                        attr.forcedValue = value;\n                      }\n                      if (prefix === '<') {\n                        attr.validValues = makeMap$2(value, '?');\n                      }\n                    }\n                    if (hasPatternsRegExp.test(attrName)) {\n                      element.attributePatterns = element.attributePatterns || [];\n                      attr.pattern = patternToRegExp(attrName);\n                      element.attributePatterns.push(attr);\n                    } else {\n                      if (!attributes[attrName]) {\n                        attributesOrder.push(attrName);\n                      }\n                      attributes[attrName] = attr;\n                    }\n                  }\n                }\n              }\n              if (!globalAttributes && elementName === '@') {\n                globalAttributes = attributes;\n                globalAttributesOrder = attributesOrder;\n              }\n              if (outputName) {\n                element.outputName = elementName;\n                elements[outputName] = element;\n              }\n              if (hasPatternsRegExp.test(elementName)) {\n                element.pattern = patternToRegExp(elementName);\n                patternElements.push(element);\n              } else {\n                elements[elementName] = element;\n              }\n            }\n          }\n        }\n      };\n      var setValidElements = function (validElements) {\n        elements = {};\n        patternElements = [];\n        addValidElements(validElements);\n        each$4(schemaItems, function (element, name) {\n          children[name] = element.children;\n        });\n      };\n      var addCustomElements = function (customElements) {\n        var customElementRegExp = /^(~)?(.+)$/;\n        if (customElements) {\n          mapCache.text_block_elements = mapCache.block_elements = null;\n          each$4(split(customElements, ','), function (rule) {\n            var matches = customElementRegExp.exec(rule), inline = matches[1] === '~', cloneName = inline ? 'span' : 'div', name = matches[2];\n            children[name] = children[cloneName];\n            customElementsMap[name] = cloneName;\n            if (!inline) {\n              blockElementsMap[name.toUpperCase()] = {};\n              blockElementsMap[name] = {};\n            }\n            if (!elements[name]) {\n              var customRule = elements[cloneName];\n              customRule = extend$1({}, customRule);\n              delete customRule.removeEmptyAttrs;\n              delete customRule.removeEmpty;\n              elements[name] = customRule;\n            }\n            each$4(children, function (element, elmName) {\n              if (element[cloneName]) {\n                children[elmName] = element = extend$1({}, children[elmName]);\n                element[name] = element[cloneName];\n              }\n            });\n          });\n        }\n      };\n      var addValidChildren = function (validChildren) {\n        var childRuleRegExp = /^([+\\-]?)(\\w+)\\[([^\\]]+)\\]$/;\n        mapCache[settings.schema] = null;\n        if (validChildren) {\n          each$4(split(validChildren, ','), function (rule) {\n            var matches = childRuleRegExp.exec(rule);\n            var parent, prefix;\n            if (matches) {\n              prefix = matches[1];\n              if (prefix) {\n                parent = children[matches[2]];\n              } else {\n                parent = children[matches[2]] = { '#comment': {} };\n              }\n              parent = children[matches[2]];\n              each$4(split(matches[3], '|'), function (child) {\n                if (prefix === '-') {\n                  delete parent[child];\n                } else {\n                  parent[child] = {};\n                }\n              });\n            }\n          });\n        }\n      };\n      var getElementRule = function (name) {\n        var element = elements[name], i;\n        if (element) {\n          return element;\n        }\n        i = patternElements.length;\n        while (i--) {\n          element = patternElements[i];\n          if (element.pattern.test(name)) {\n            return element;\n          }\n        }\n      };\n      if (!settings.valid_elements) {\n        each$4(schemaItems, function (element, name) {\n          elements[name] = {\n            attributes: element.attributes,\n            attributesOrder: element.attributesOrder\n          };\n          children[name] = element.children;\n        });\n        if (settings.schema !== 'html5') {\n          each$4(split('strong/b em/i'), function (item) {\n            item = split(item, '/');\n            elements[item[1]].outputName = item[0];\n          });\n        }\n        each$4(split('ol ul sub sup blockquote span font a table tbody tr strong em b i'), function (name) {\n          if (elements[name]) {\n            elements[name].removeEmpty = true;\n          }\n        });\n        each$4(split('p h1 h2 h3 h4 h5 h6 th td pre div address caption li'), function (name) {\n          elements[name].paddEmpty = true;\n        });\n        each$4(split('span'), function (name) {\n          elements[name].removeEmptyAttrs = true;\n        });\n      } else {\n        setValidElements(settings.valid_elements);\n      }\n      addCustomElements(settings.custom_elements);\n      addValidChildren(settings.valid_children);\n      addValidElements(settings.extended_valid_elements);\n      addValidChildren('+ol[ul|ol],+ul[ul|ol]');\n      each$4({\n        dd: 'dl',\n        dt: 'dl',\n        li: 'ul ol',\n        td: 'tr',\n        th: 'tr',\n        tr: 'tbody thead tfoot',\n        tbody: 'table',\n        thead: 'table',\n        tfoot: 'table',\n        legend: 'fieldset',\n        area: 'map',\n        param: 'video audio object'\n      }, function (parents, item) {\n        if (elements[item]) {\n          elements[item].parentsRequired = split(parents);\n        }\n      });\n      if (settings.invalid_elements) {\n        each$4(explode$1(settings.invalid_elements), function (item) {\n          if (elements[item]) {\n            delete elements[item];\n          }\n        });\n      }\n      if (!getElementRule('span')) {\n        addValidElements('span[!data-mce-type|*]');\n      }\n      var getValidStyles = function () {\n        return validStyles;\n      };\n      var getInvalidStyles = function () {\n        return invalidStyles;\n      };\n      var getValidClasses = function () {\n        return validClasses;\n      };\n      var getBoolAttrs = function () {\n        return boolAttrMap;\n      };\n      var getBlockElements = function () {\n        return blockElementsMap;\n      };\n      var getTextBlockElements = function () {\n        return textBlockElementsMap;\n      };\n      var getTextInlineElements = function () {\n        return textInlineElementsMap;\n      };\n      var getShortEndedElements = function () {\n        return shortEndedElementsMap;\n      };\n      var getSelfClosingElements = function () {\n        return selfClosingElementsMap;\n      };\n      var getNonEmptyElements = function () {\n        return nonEmptyElementsMap;\n      };\n      var getMoveCaretBeforeOnEnterElements = function () {\n        return moveCaretBeforeOnEnterElementsMap;\n      };\n      var getWhiteSpaceElements = function () {\n        return whiteSpaceElementsMap;\n      };\n      var getSpecialElements = function () {\n        return specialElements;\n      };\n      var isValidChild = function (name, child) {\n        var parent = children[name.toLowerCase()];\n        return !!(parent && parent[child.toLowerCase()]);\n      };\n      var isValid = function (name, attr) {\n        var attrPatterns, i;\n        var rule = getElementRule(name);\n        if (rule) {\n          if (attr) {\n            if (rule.attributes[attr]) {\n              return true;\n            }\n            attrPatterns = rule.attributePatterns;\n            if (attrPatterns) {\n              i = attrPatterns.length;\n              while (i--) {\n                if (attrPatterns[i].pattern.test(name)) {\n                  return true;\n                }\n              }\n            }\n          } else {\n            return true;\n          }\n        }\n        return false;\n      };\n      var getCustomElements = function () {\n        return customElementsMap;\n      };\n      return {\n        children: children,\n        elements: elements,\n        getValidStyles: getValidStyles,\n        getValidClasses: getValidClasses,\n        getBlockElements: getBlockElements,\n        getInvalidStyles: getInvalidStyles,\n        getShortEndedElements: getShortEndedElements,\n        getTextBlockElements: getTextBlockElements,\n        getTextInlineElements: getTextInlineElements,\n        getBoolAttrs: getBoolAttrs,\n        getElementRule: getElementRule,\n        getSelfClosingElements: getSelfClosingElements,\n        getNonEmptyElements: getNonEmptyElements,\n        getMoveCaretBeforeOnEnterElements: getMoveCaretBeforeOnEnterElements,\n        getWhiteSpaceElements: getWhiteSpaceElements,\n        getSpecialElements: getSpecialElements,\n        isValidChild: isValidChild,\n        isValid: isValid,\n        getCustomElements: getCustomElements,\n        addValidElements: addValidElements,\n        setValidElements: setValidElements,\n        addCustomElements: addCustomElements,\n        addValidChildren: addValidChildren\n      };\n    }\n\n    var toHex = function (match, r, g, b) {\n      var hex = function (val) {\n        val = parseInt(val, 10).toString(16);\n        return val.length > 1 ? val : '0' + val;\n      };\n      return '#' + hex(r) + hex(g) + hex(b);\n    };\n    function Styles(settings, schema) {\n      var rgbRegExp = /rgb\\s*\\(\\s*([0-9]+)\\s*,\\s*([0-9]+)\\s*,\\s*([0-9]+)\\s*\\)/gi;\n      var urlOrStrRegExp = /(?:url(?:(?:\\(\\s*\\\"([^\\\"]+)\\\"\\s*\\))|(?:\\(\\s*\\'([^\\']+)\\'\\s*\\))|(?:\\(\\s*([^)\\s]+)\\s*\\))))|(?:\\'([^\\']+)\\')|(?:\\\"([^\\\"]+)\\\")/gi;\n      var styleRegExp = /\\s*([^:]+):\\s*([^;]+);?/g;\n      var trimRightRegExp = /\\s+$/;\n      var i;\n      var encodingLookup = {};\n      var encodingItems;\n      var validStyles;\n      var invalidStyles;\n      var invisibleChar = '\\uFEFF';\n      settings = settings || {};\n      if (schema) {\n        validStyles = schema.getValidStyles();\n        invalidStyles = schema.getInvalidStyles();\n      }\n      encodingItems = ('\\\\\" \\\\\\' \\\\; \\\\: ; : ' + invisibleChar).split(' ');\n      for (i = 0; i < encodingItems.length; i++) {\n        encodingLookup[encodingItems[i]] = invisibleChar + i;\n        encodingLookup[invisibleChar + i] = encodingItems[i];\n      }\n      return {\n        toHex: function (color) {\n          return color.replace(rgbRegExp, toHex);\n        },\n        parse: function (css) {\n          var styles = {};\n          var matches, name, value, isEncoded;\n          var urlConverter = settings.url_converter;\n          var urlConverterScope = settings.url_converter_scope || this;\n          var compress = function (prefix, suffix, noJoin) {\n            var top, right, bottom, left;\n            top = styles[prefix + '-top' + suffix];\n            if (!top) {\n              return;\n            }\n            right = styles[prefix + '-right' + suffix];\n            if (!right) {\n              return;\n            }\n            bottom = styles[prefix + '-bottom' + suffix];\n            if (!bottom) {\n              return;\n            }\n            left = styles[prefix + '-left' + suffix];\n            if (!left) {\n              return;\n            }\n            var box = [\n              top,\n              right,\n              bottom,\n              left\n            ];\n            i = box.length - 1;\n            while (i--) {\n              if (box[i] !== box[i + 1]) {\n                break;\n              }\n            }\n            if (i > -1 && noJoin) {\n              return;\n            }\n            styles[prefix + suffix] = i === -1 ? box[0] : box.join(' ');\n            delete styles[prefix + '-top' + suffix];\n            delete styles[prefix + '-right' + suffix];\n            delete styles[prefix + '-bottom' + suffix];\n            delete styles[prefix + '-left' + suffix];\n          };\n          var canCompress = function (key) {\n            var value = styles[key], i;\n            if (!value) {\n              return;\n            }\n            value = value.split(' ');\n            i = value.length;\n            while (i--) {\n              if (value[i] !== value[0]) {\n                return false;\n              }\n            }\n            styles[key] = value[0];\n            return true;\n          };\n          var compress2 = function (target, a, b, c) {\n            if (!canCompress(a)) {\n              return;\n            }\n            if (!canCompress(b)) {\n              return;\n            }\n            if (!canCompress(c)) {\n              return;\n            }\n            styles[target] = styles[a] + ' ' + styles[b] + ' ' + styles[c];\n            delete styles[a];\n            delete styles[b];\n            delete styles[c];\n          };\n          var encode = function (str) {\n            isEncoded = true;\n            return encodingLookup[str];\n          };\n          var decode = function (str, keepSlashes) {\n            if (isEncoded) {\n              str = str.replace(/\\uFEFF[0-9]/g, function (str) {\n                return encodingLookup[str];\n              });\n            }\n            if (!keepSlashes) {\n              str = str.replace(/\\\\([\\'\\\";:])/g, '$1');\n            }\n            return str;\n          };\n          var decodeSingleHexSequence = function (escSeq) {\n            return String.fromCharCode(parseInt(escSeq.slice(1), 16));\n          };\n          var decodeHexSequences = function (value) {\n            return value.replace(/\\\\[0-9a-f]+/gi, decodeSingleHexSequence);\n          };\n          var processUrl = function (match, url, url2, url3, str, str2) {\n            str = str || str2;\n            if (str) {\n              str = decode(str);\n              return '\\'' + str.replace(/\\'/g, '\\\\\\'') + '\\'';\n            }\n            url = decode(url || url2 || url3);\n            if (!settings.allow_script_urls) {\n              var scriptUrl = url.replace(/[\\s\\r\\n]+/g, '');\n              if (/(java|vb)script:/i.test(scriptUrl)) {\n                return '';\n              }\n              if (!settings.allow_svg_data_urls && /^data:image\\/svg/i.test(scriptUrl)) {\n                return '';\n              }\n            }\n            if (urlConverter) {\n              url = urlConverter.call(urlConverterScope, url, 'style');\n            }\n            return 'url(\\'' + url.replace(/\\'/g, '\\\\\\'') + '\\')';\n          };\n          if (css) {\n            css = css.replace(/[\\u0000-\\u001F]/g, '');\n            css = css.replace(/\\\\[\\\"\\';:\\uFEFF]/g, encode).replace(/\\\"[^\\\"]+\\\"|\\'[^\\']+\\'/g, function (str) {\n              return str.replace(/[;:]/g, encode);\n            });\n            while (matches = styleRegExp.exec(css)) {\n              styleRegExp.lastIndex = matches.index + matches[0].length;\n              name = matches[1].replace(trimRightRegExp, '').toLowerCase();\n              value = matches[2].replace(trimRightRegExp, '');\n              if (name && value) {\n                name = decodeHexSequences(name);\n                value = decodeHexSequences(value);\n                if (name.indexOf(invisibleChar) !== -1 || name.indexOf('\"') !== -1) {\n                  continue;\n                }\n                if (!settings.allow_script_urls && (name === 'behavior' || /expression\\s*\\(|\\/\\*|\\*\\//.test(value))) {\n                  continue;\n                }\n                if (name === 'font-weight' && value === '700') {\n                  value = 'bold';\n                } else if (name === 'color' || name === 'background-color') {\n                  value = value.toLowerCase();\n                }\n                value = value.replace(rgbRegExp, toHex);\n                value = value.replace(urlOrStrRegExp, processUrl);\n                styles[name] = isEncoded ? decode(value, true) : value;\n              }\n            }\n            compress('border', '', true);\n            compress('border', '-width');\n            compress('border', '-color');\n            compress('border', '-style');\n            compress('padding', '');\n            compress('margin', '');\n            compress2('border', 'border-width', 'border-style', 'border-color');\n            if (styles.border === 'medium none') {\n              delete styles.border;\n            }\n            if (styles['border-image'] === 'none') {\n              delete styles['border-image'];\n            }\n          }\n          return styles;\n        },\n        serialize: function (styles, elementName) {\n          var css = '', name, value;\n          var serializeStyles = function (name) {\n            var styleList, i, l, value;\n            styleList = validStyles[name];\n            if (styleList) {\n              for (i = 0, l = styleList.length; i < l; i++) {\n                name = styleList[i];\n                value = styles[name];\n                if (value) {\n                  css += (css.length > 0 ? ' ' : '') + name + ': ' + value + ';';\n                }\n              }\n            }\n          };\n          var isValid = function (name, elementName) {\n            var styleMap;\n            styleMap = invalidStyles['*'];\n            if (styleMap && styleMap[name]) {\n              return false;\n            }\n            styleMap = invalidStyles[elementName];\n            if (styleMap && styleMap[name]) {\n              return false;\n            }\n            return true;\n          };\n          if (elementName && validStyles) {\n            serializeStyles('*');\n            serializeStyles(elementName);\n          } else {\n            for (name in styles) {\n              value = styles[name];\n              if (value && (!invalidStyles || isValid(name, elementName))) {\n                css += (css.length > 0 ? ' ' : '') + name + ': ' + value + ';';\n              }\n            }\n          }\n          return css;\n        }\n      };\n    }\n\n    var each$5 = Tools.each;\n    var grep$1 = Tools.grep;\n    var isIE = Env.ie;\n    var simpleSelectorRe = /^([a-z0-9],?)+$/i;\n    var whiteSpaceRegExp$2 = /^[ \\t\\r\\n]*$/;\n    var setupAttrHooks = function (styles, settings, getContext) {\n      var attrHooks = {};\n      var keepValues = settings.keep_values;\n      var keepUrlHook = {\n        set: function ($elm, value, name) {\n          if (settings.url_converter) {\n            value = settings.url_converter.call(settings.url_converter_scope || getContext(), value, name, $elm[0]);\n          }\n          $elm.attr('data-mce-' + name, value).attr(name, value);\n        },\n        get: function ($elm, name) {\n          return $elm.attr('data-mce-' + name) || $elm.attr(name);\n        }\n      };\n      attrHooks = {\n        style: {\n          set: function ($elm, value) {\n            if (value !== null && typeof value === 'object') {\n              $elm.css(value);\n              return;\n            }\n            if (keepValues) {\n              $elm.attr('data-mce-style', value);\n            }\n            $elm.attr('style', value);\n          },\n          get: function ($elm) {\n            var value = $elm.attr('data-mce-style') || $elm.attr('style');\n            value = styles.serialize(styles.parse(value), $elm[0].nodeName);\n            return value;\n          }\n        }\n      };\n      if (keepValues) {\n        attrHooks.href = attrHooks.src = keepUrlHook;\n      }\n      return attrHooks;\n    };\n    var updateInternalStyleAttr = function (styles, $elm) {\n      var rawValue = $elm.attr('style');\n      var value = styles.serialize(styles.parse(rawValue), $elm[0].nodeName);\n      if (!value) {\n        value = null;\n      }\n      $elm.attr('data-mce-style', value);\n    };\n    var findNodeIndex = function (node, normalized) {\n      var idx = 0, lastNodeType, nodeType;\n      if (node) {\n        for (lastNodeType = node.nodeType, node = node.previousSibling; node; node = node.previousSibling) {\n          nodeType = node.nodeType;\n          if (normalized && nodeType === 3) {\n            if (nodeType === lastNodeType || !node.nodeValue.length) {\n              continue;\n            }\n          }\n          idx++;\n          lastNodeType = nodeType;\n        }\n      }\n      return idx;\n    };\n    function DOMUtils(doc, settings) {\n      var _this = this;\n      if (settings === void 0) {\n        settings = {};\n      }\n      var attrHooks;\n      var addedStyles = {};\n      var win = domGlobals.window;\n      var files = {};\n      var counter = 0;\n      var stdMode = true;\n      var boxModel = true;\n      var styleSheetLoader = StyleSheetLoader(doc, { contentCssCors: settings.contentCssCors });\n      var boundEvents = [];\n      var schema = settings.schema ? settings.schema : Schema({});\n      var styles = Styles({\n        url_converter: settings.url_converter,\n        url_converter_scope: settings.url_converter_scope\n      }, settings.schema);\n      var events = settings.ownEvents ? new EventUtils(settings.proxy) : EventUtils.Event;\n      var blockElementsMap = schema.getBlockElements();\n      var $ = DomQuery.overrideDefaults(function () {\n        return {\n          context: doc,\n          element: self.getRoot()\n        };\n      });\n      var isBlock = function (node) {\n        if (typeof node === 'string') {\n          return !!blockElementsMap[node];\n        } else if (node) {\n          var type = node.nodeType;\n          if (type) {\n            return !!(type === 1 && blockElementsMap[node.nodeName]);\n          }\n        }\n        return false;\n      };\n      var get = function (elm) {\n        if (elm && doc && typeof elm === 'string') {\n          var node = doc.getElementById(elm);\n          if (node && node.id !== elm) {\n            return doc.getElementsByName(elm)[1];\n          } else {\n            return node;\n          }\n        }\n        return elm;\n      };\n      var $$ = function (elm) {\n        if (typeof elm === 'string') {\n          elm = get(elm);\n        }\n        return $(elm);\n      };\n      var getAttrib = function (elm, name, defaultVal) {\n        var hook, value;\n        var $elm = $$(elm);\n        if ($elm.length) {\n          hook = attrHooks[name];\n          if (hook && hook.get) {\n            value = hook.get($elm, name);\n          } else {\n            value = $elm.attr(name);\n          }\n        }\n        if (typeof value === 'undefined') {\n          value = defaultVal || '';\n        }\n        return value;\n      };\n      var getAttribs = function (elm) {\n        var node = get(elm);\n        if (!node) {\n          return [];\n        }\n        return node.attributes;\n      };\n      var setAttrib = function (elm, name, value) {\n        var originalValue, hook;\n        if (value === '') {\n          value = null;\n        }\n        var $elm = $$(elm);\n        originalValue = $elm.attr(name);\n        if (!$elm.length) {\n          return;\n        }\n        hook = attrHooks[name];\n        if (hook && hook.set) {\n          hook.set($elm, value, name);\n        } else {\n          $elm.attr(name, value);\n        }\n        if (originalValue !== value && settings.onSetAttrib) {\n          settings.onSetAttrib({\n            attrElm: $elm,\n            attrName: name,\n            attrValue: value\n          });\n        }\n      };\n      var clone = function (node, deep) {\n        if (!isIE || node.nodeType !== 1 || deep) {\n          return node.cloneNode(deep);\n        }\n        if (!deep) {\n          var clone_1 = doc.createElement(node.nodeName);\n          each$5(getAttribs(node), function (attr) {\n            setAttrib(clone_1, attr.nodeName, getAttrib(node, attr.nodeName));\n          });\n          return clone_1;\n        }\n        return null;\n      };\n      var getRoot = function () {\n        return settings.root_element || doc.body;\n      };\n      var getViewPort = function (argWin) {\n        var actWin = !argWin ? win : argWin;\n        var doc = actWin.document;\n        var rootElm =  doc.documentElement ;\n        return {\n          x: actWin.pageXOffset || rootElm.scrollLeft,\n          y: actWin.pageYOffset || rootElm.scrollTop,\n          w: actWin.innerWidth || rootElm.clientWidth,\n          h: actWin.innerHeight || rootElm.clientHeight\n        };\n      };\n      var getPos = function (elm, rootElm) {\n        return Position.getPos(doc.body, get(elm), rootElm);\n      };\n      var setStyle = function (elm, name, value) {\n        var $elm = $$(elm).css(name, value);\n        if (settings.update_styles) {\n          updateInternalStyleAttr(styles, $elm);\n        }\n      };\n      var setStyles = function (elm, stylesArg) {\n        var $elm = $$(elm).css(stylesArg);\n        if (settings.update_styles) {\n          updateInternalStyleAttr(styles, $elm);\n        }\n      };\n      var getStyle = function (elm, name, computed) {\n        var $elm = $$(elm);\n        if (computed) {\n          return $elm.css(name);\n        }\n        name = name.replace(/-(\\D)/g, function (a, b) {\n          return b.toUpperCase();\n        });\n        if (name === 'float') {\n          name = Env.ie && Env.ie < 12 ? 'styleFloat' : 'cssFloat';\n        }\n        return $elm[0] && $elm[0].style ? $elm[0].style[name] : undefined;\n      };\n      var getSize = function (elm) {\n        var w, h;\n        elm = get(elm);\n        w = getStyle(elm, 'width');\n        h = getStyle(elm, 'height');\n        if (w.indexOf('px') === -1) {\n          w = 0;\n        }\n        if (h.indexOf('px') === -1) {\n          h = 0;\n        }\n        return {\n          w: parseInt(w, 10) || elm.offsetWidth || elm.clientWidth,\n          h: parseInt(h, 10) || elm.offsetHeight || elm.clientHeight\n        };\n      };\n      var getRect = function (elm) {\n        var pos, size;\n        elm = get(elm);\n        pos = getPos(elm);\n        size = getSize(elm);\n        return {\n          x: pos.x,\n          y: pos.y,\n          w: size.w,\n          h: size.h\n        };\n      };\n      var is = function (elm, selector) {\n        var i;\n        if (!elm) {\n          return false;\n        }\n        if (!Array.isArray(elm)) {\n          if (selector === '*') {\n            return elm.nodeType === 1;\n          }\n          if (simpleSelectorRe.test(selector)) {\n            var selectors = selector.toLowerCase().split(/,/);\n            var elmName = elm.nodeName.toLowerCase();\n            for (i = selectors.length - 1; i >= 0; i--) {\n              if (selectors[i] === elmName) {\n                return true;\n              }\n            }\n            return false;\n          }\n          if (elm.nodeType && elm.nodeType !== 1) {\n            return false;\n          }\n        }\n        var elms = !Array.isArray(elm) ? [elm] : elm;\n        return Sizzle(selector, elms[0].ownerDocument || elms[0], null, elms).length > 0;\n      };\n      var getParents = function (elm, selector, root, collect) {\n        var result = [];\n        var selectorVal;\n        var node = get(elm);\n        collect = collect === undefined;\n        root = root || (getRoot().nodeName !== 'BODY' ? getRoot().parentNode : null);\n        if (Tools.is(selector, 'string')) {\n          selectorVal = selector;\n          if (selector === '*') {\n            selector = function (node) {\n              return node.nodeType === 1;\n            };\n          } else {\n            selector = function (node) {\n              return is(node, selectorVal);\n            };\n          }\n        }\n        while (node) {\n          if (node === root || !node.nodeType || node.nodeType === 9) {\n            break;\n          }\n          if (!selector || typeof selector === 'function' && selector(node)) {\n            if (collect) {\n              result.push(node);\n            } else {\n              return [node];\n            }\n          }\n          node = node.parentNode;\n        }\n        return collect ? result : null;\n      };\n      var getParent = function (node, selector, root) {\n        var parents = getParents(node, selector, root, false);\n        return parents && parents.length > 0 ? parents[0] : null;\n      };\n      var _findSib = function (node, selector, name) {\n        var func = selector;\n        if (node) {\n          if (typeof selector === 'string') {\n            func = function (node) {\n              return is(node, selector);\n            };\n          }\n          for (node = node[name]; node; node = node[name]) {\n            if (typeof func === 'function' && func(node)) {\n              return node;\n            }\n          }\n        }\n        return null;\n      };\n      var getNext = function (node, selector) {\n        return _findSib(node, selector, 'nextSibling');\n      };\n      var getPrev = function (node, selector) {\n        return _findSib(node, selector, 'previousSibling');\n      };\n      var select = function (selector, scope) {\n        return Sizzle(selector, get(scope) || settings.root_element || doc, []);\n      };\n      var run = function (elm, func, scope) {\n        var result;\n        var node = typeof elm === 'string' ? get(elm) : elm;\n        if (!node) {\n          return false;\n        }\n        if (Tools.isArray(node) && (node.length || node.length === 0)) {\n          result = [];\n          each$5(node, function (elm, i) {\n            if (elm) {\n              if (typeof elm === 'string') {\n                elm = get(elm);\n              }\n              result.push(func.call(scope, elm, i));\n            }\n          });\n          return result;\n        }\n        var context = scope ? scope : _this;\n        return func.call(context, node);\n      };\n      var setAttribs = function (elm, attrs) {\n        $$(elm).each(function (i, node) {\n          each$5(attrs, function (value, name) {\n            setAttrib(node, name, value);\n          });\n        });\n      };\n      var setHTML = function (elm, html) {\n        var $elm = $$(elm);\n        if (isIE) {\n          $elm.each(function (i, target) {\n            if (target.canHaveHTML === false) {\n              return;\n            }\n            while (target.firstChild) {\n              target.removeChild(target.firstChild);\n            }\n            try {\n              target.innerHTML = '<br>' + html;\n              target.removeChild(target.firstChild);\n            } catch (ex) {\n              DomQuery('<div></div>').html('<br>' + html).contents().slice(1).appendTo(target);\n            }\n            return html;\n          });\n        } else {\n          $elm.html(html);\n        }\n      };\n      var add = function (parentElm, name, attrs, html, create) {\n        return run(parentElm, function (parentElm) {\n          var newElm = typeof name === 'string' ? doc.createElement(name) : name;\n          setAttribs(newElm, attrs);\n          if (html) {\n            if (typeof html !== 'string' && html.nodeType) {\n              newElm.appendChild(html);\n            } else if (typeof html === 'string') {\n              setHTML(newElm, html);\n            }\n          }\n          return !create ? parentElm.appendChild(newElm) : newElm;\n        });\n      };\n      var create = function (name, attrs, html) {\n        return add(doc.createElement(name), name, attrs, html, true);\n      };\n      var decode = Entities.decode;\n      var encode = Entities.encodeAllRaw;\n      var createHTML = function (name, attrs, html) {\n        var outHtml = '', key;\n        outHtml += '<' + name;\n        for (key in attrs) {\n          if (attrs.hasOwnProperty(key) && attrs[key] !== null && typeof attrs[key] !== 'undefined') {\n            outHtml += ' ' + key + '=\"' + encode(attrs[key]) + '\"';\n          }\n        }\n        if (typeof html !== 'undefined') {\n          return outHtml + '>' + html + '</' + name + '>';\n        }\n        return outHtml + ' />';\n      };\n      var createFragment = function (html) {\n        var node;\n        var container = doc.createElement('div');\n        var frag = doc.createDocumentFragment();\n        frag.appendChild(container);\n        if (html) {\n          container.innerHTML = html;\n        }\n        while (node = container.firstChild) {\n          frag.appendChild(node);\n        }\n        frag.removeChild(container);\n        return frag;\n      };\n      var remove = function (node, keepChildren) {\n        var $node = $$(node);\n        if (keepChildren) {\n          $node.each(function () {\n            var child;\n            while (child = this.firstChild) {\n              if (child.nodeType === 3 && child.data.length === 0) {\n                this.removeChild(child);\n              } else {\n                this.parentNode.insertBefore(child, this);\n              }\n            }\n          }).remove();\n        } else {\n          $node.remove();\n        }\n        return $node.length > 1 ? $node.toArray() : $node[0];\n      };\n      var removeAllAttribs = function (e) {\n        return run(e, function (e) {\n          var i;\n          var attrs = e.attributes;\n          for (i = attrs.length - 1; i >= 0; i--) {\n            e.removeAttributeNode(attrs.item(i));\n          }\n        });\n      };\n      var parseStyle = function (cssText) {\n        return styles.parse(cssText);\n      };\n      var serializeStyle = function (stylesArg, name) {\n        return styles.serialize(stylesArg, name);\n      };\n      var addStyle = function (cssText) {\n        var head, styleElm;\n        if (self !== DOMUtils.DOM && doc === domGlobals.document) {\n          if (addedStyles[cssText]) {\n            return;\n          }\n          addedStyles[cssText] = true;\n        }\n        styleElm = doc.getElementById('mceDefaultStyles');\n        if (!styleElm) {\n          styleElm = doc.createElement('style');\n          styleElm.id = 'mceDefaultStyles';\n          styleElm.type = 'text/css';\n          head = doc.getElementsByTagName('head')[0];\n          if (head.firstChild) {\n            head.insertBefore(styleElm, head.firstChild);\n          } else {\n            head.appendChild(styleElm);\n          }\n        }\n        if (styleElm.styleSheet) {\n          styleElm.styleSheet.cssText += cssText;\n        } else {\n          styleElm.appendChild(doc.createTextNode(cssText));\n        }\n      };\n      var loadCSS = function (url) {\n        var head;\n        if (self !== DOMUtils.DOM && doc === domGlobals.document) {\n          DOMUtils.DOM.loadCSS(url);\n          return;\n        }\n        if (!url) {\n          url = '';\n        }\n        head = doc.getElementsByTagName('head')[0];\n        each$5(url.split(','), function (url) {\n          var link;\n          url = Tools._addCacheSuffix(url);\n          if (files[url]) {\n            return;\n          }\n          files[url] = true;\n          link = create('link', {\n            rel: 'stylesheet',\n            href: url\n          });\n          head.appendChild(link);\n        });\n      };\n      var toggleClass = function (elm, cls, state) {\n        $$(elm).toggleClass(cls, state).each(function () {\n          if (this.className === '') {\n            DomQuery(this).attr('class', null);\n          }\n        });\n      };\n      var addClass = function (elm, cls) {\n        $$(elm).addClass(cls);\n      };\n      var removeClass = function (elm, cls) {\n        toggleClass(elm, cls, false);\n      };\n      var hasClass = function (elm, cls) {\n        return $$(elm).hasClass(cls);\n      };\n      var show = function (elm) {\n        $$(elm).show();\n      };\n      var hide = function (elm) {\n        $$(elm).hide();\n      };\n      var isHidden = function (elm) {\n        return $$(elm).css('display') === 'none';\n      };\n      var uniqueId = function (prefix) {\n        return (!prefix ? 'mce_' : prefix) + counter++;\n      };\n      var getOuterHTML = function (elm) {\n        var node = typeof elm === 'string' ? get(elm) : elm;\n        return NodeType.isElement(node) ? node.outerHTML : DomQuery('<div></div>').append(DomQuery(node).clone()).html();\n      };\n      var setOuterHTML = function (elm, html) {\n        $$(elm).each(function () {\n          try {\n            if ('outerHTML' in this) {\n              this.outerHTML = html;\n              return;\n            }\n          } catch (ex) {\n          }\n          remove(DomQuery(this).html(html), true);\n        });\n      };\n      var insertAfter = function (node, reference) {\n        var referenceNode = get(reference);\n        return run(node, function (node) {\n          var parent, nextSibling;\n          parent = referenceNode.parentNode;\n          nextSibling = referenceNode.nextSibling;\n          if (nextSibling) {\n            parent.insertBefore(node, nextSibling);\n          } else {\n            parent.appendChild(node);\n          }\n          return node;\n        });\n      };\n      var replace = function (newElm, oldElm, keepChildren) {\n        return run(oldElm, function (oldElm) {\n          if (Tools.is(oldElm, 'array')) {\n            newElm = newElm.cloneNode(true);\n          }\n          if (keepChildren) {\n            each$5(grep$1(oldElm.childNodes), function (node) {\n              newElm.appendChild(node);\n            });\n          }\n          return oldElm.parentNode.replaceChild(newElm, oldElm);\n        });\n      };\n      var rename = function (elm, name) {\n        var newElm;\n        if (elm.nodeName !== name.toUpperCase()) {\n          newElm = create(name);\n          each$5(getAttribs(elm), function (attrNode) {\n            setAttrib(newElm, attrNode.nodeName, getAttrib(elm, attrNode.nodeName));\n          });\n          replace(newElm, elm, true);\n        }\n        return newElm || elm;\n      };\n      var findCommonAncestor = function (a, b) {\n        var ps = a, pe;\n        while (ps) {\n          pe = b;\n          while (pe && ps !== pe) {\n            pe = pe.parentNode;\n          }\n          if (ps === pe) {\n            break;\n          }\n          ps = ps.parentNode;\n        }\n        if (!ps && a.ownerDocument) {\n          return a.ownerDocument.documentElement;\n        }\n        return ps;\n      };\n      var toHex = function (rgbVal) {\n        return styles.toHex(Tools.trim(rgbVal));\n      };\n      var isEmpty = function (node, elements) {\n        var i, attributes, type, whitespace, walker, name, brCount = 0;\n        node = node.firstChild;\n        if (node) {\n          walker = new TreeWalker(node, node.parentNode);\n          elements = elements || (schema ? schema.getNonEmptyElements() : null);\n          whitespace = schema ? schema.getWhiteSpaceElements() : {};\n          do {\n            type = node.nodeType;\n            if (NodeType.isElement(node)) {\n              var bogusVal = node.getAttribute('data-mce-bogus');\n              if (bogusVal) {\n                node = walker.next(bogusVal === 'all');\n                continue;\n              }\n              name = node.nodeName.toLowerCase();\n              if (elements && elements[name]) {\n                if (name === 'br') {\n                  brCount++;\n                  node = walker.next();\n                  continue;\n                }\n                return false;\n              }\n              attributes = getAttribs(node);\n              i = attributes.length;\n              while (i--) {\n                name = attributes[i].nodeName;\n                if (name === 'name' || name === 'data-mce-bookmark') {\n                  return false;\n                }\n              }\n            }\n            if (type === 8) {\n              return false;\n            }\n            if (type === 3 && !whiteSpaceRegExp$2.test(node.nodeValue)) {\n              return false;\n            }\n            if (type === 3 && node.parentNode && whitespace[node.parentNode.nodeName] && whiteSpaceRegExp$2.test(node.nodeValue)) {\n              return false;\n            }\n            node = walker.next();\n          } while (node);\n        }\n        return brCount <= 1;\n      };\n      var createRng = function () {\n        return doc.createRange();\n      };\n      var split = function (parentElm, splitElm, replacementElm) {\n        var r = createRng(), bef, aft, pa;\n        if (parentElm && splitElm) {\n          r.setStart(parentElm.parentNode, findNodeIndex(parentElm));\n          r.setEnd(splitElm.parentNode, findNodeIndex(splitElm));\n          bef = r.extractContents();\n          r = createRng();\n          r.setStart(splitElm.parentNode, findNodeIndex(splitElm) + 1);\n          r.setEnd(parentElm.parentNode, findNodeIndex(parentElm) + 1);\n          aft = r.extractContents();\n          pa = parentElm.parentNode;\n          pa.insertBefore(TrimNode.trimNode(self, bef), parentElm);\n          if (replacementElm) {\n            pa.insertBefore(replacementElm, parentElm);\n          } else {\n            pa.insertBefore(splitElm, parentElm);\n          }\n          pa.insertBefore(TrimNode.trimNode(self, aft), parentElm);\n          remove(parentElm);\n          return replacementElm || splitElm;\n        }\n      };\n      var bind = function (target, name, func, scope) {\n        if (Tools.isArray(target)) {\n          var i = target.length;\n          while (i--) {\n            target[i] = bind(target[i], name, func, scope);\n          }\n          return target;\n        }\n        if (settings.collect && (target === doc || target === win)) {\n          boundEvents.push([\n            target,\n            name,\n            func,\n            scope\n          ]);\n        }\n        return events.bind(target, name, func, scope || self);\n      };\n      var unbind = function (target, name, func) {\n        var i;\n        if (Tools.isArray(target)) {\n          i = target.length;\n          while (i--) {\n            target[i] = unbind(target[i], name, func);\n          }\n          return target;\n        }\n        if (boundEvents && (target === doc || target === win)) {\n          i = boundEvents.length;\n          while (i--) {\n            var item = boundEvents[i];\n            if (target === item[0] && (!name || name === item[1]) && (!func || func === item[2])) {\n              events.unbind(item[0], item[1], item[2]);\n            }\n          }\n        }\n        return events.unbind(target, name, func);\n      };\n      var fire = function (target, name, evt) {\n        return events.fire(target, name, evt);\n      };\n      var getContentEditable = function (node) {\n        if (node && NodeType.isElement(node)) {\n          var contentEditable = node.getAttribute('data-mce-contenteditable');\n          if (contentEditable && contentEditable !== 'inherit') {\n            return contentEditable;\n          }\n          return node.contentEditable !== 'inherit' ? node.contentEditable : null;\n        } else {\n          return null;\n        }\n      };\n      var getContentEditableParent = function (node) {\n        var root = getRoot();\n        var state = null;\n        for (; node && node !== root; node = node.parentNode) {\n          state = getContentEditable(node);\n          if (state !== null) {\n            break;\n          }\n        }\n        return state;\n      };\n      var destroy = function () {\n        if (boundEvents) {\n          var i = boundEvents.length;\n          while (i--) {\n            var item = boundEvents[i];\n            events.unbind(item[0], item[1], item[2]);\n          }\n        }\n        if (Sizzle.setDocument) {\n          Sizzle.setDocument();\n        }\n      };\n      var isChildOf = function (node, parent) {\n        while (node) {\n          if (parent === node) {\n            return true;\n          }\n          node = node.parentNode;\n        }\n        return false;\n      };\n      var dumpRng = function (r) {\n        return 'startContainer: ' + r.startContainer.nodeName + ', startOffset: ' + r.startOffset + ', endContainer: ' + r.endContainer.nodeName + ', endOffset: ' + r.endOffset;\n      };\n      var self = {\n        doc: doc,\n        settings: settings,\n        win: win,\n        files: files,\n        stdMode: stdMode,\n        boxModel: boxModel,\n        styleSheetLoader: styleSheetLoader,\n        boundEvents: boundEvents,\n        styles: styles,\n        schema: schema,\n        events: events,\n        isBlock: isBlock,\n        $: $,\n        $$: $$,\n        root: null,\n        clone: clone,\n        getRoot: getRoot,\n        getViewPort: getViewPort,\n        getRect: getRect,\n        getSize: getSize,\n        getParent: getParent,\n        getParents: getParents,\n        get: get,\n        getNext: getNext,\n        getPrev: getPrev,\n        select: select,\n        is: is,\n        add: add,\n        create: create,\n        createHTML: createHTML,\n        createFragment: createFragment,\n        remove: remove,\n        setStyle: setStyle,\n        getStyle: getStyle,\n        setStyles: setStyles,\n        removeAllAttribs: removeAllAttribs,\n        setAttrib: setAttrib,\n        setAttribs: setAttribs,\n        getAttrib: getAttrib,\n        getPos: getPos,\n        parseStyle: parseStyle,\n        serializeStyle: serializeStyle,\n        addStyle: addStyle,\n        loadCSS: loadCSS,\n        addClass: addClass,\n        removeClass: removeClass,\n        hasClass: hasClass,\n        toggleClass: toggleClass,\n        show: show,\n        hide: hide,\n        isHidden: isHidden,\n        uniqueId: uniqueId,\n        setHTML: setHTML,\n        getOuterHTML: getOuterHTML,\n        setOuterHTML: setOuterHTML,\n        decode: decode,\n        encode: encode,\n        insertAfter: insertAfter,\n        replace: replace,\n        rename: rename,\n        findCommonAncestor: findCommonAncestor,\n        toHex: toHex,\n        run: run,\n        getAttribs: getAttribs,\n        isEmpty: isEmpty,\n        createRng: createRng,\n        nodeIndex: findNodeIndex,\n        split: split,\n        bind: bind,\n        unbind: unbind,\n        fire: fire,\n        getContentEditable: getContentEditable,\n        getContentEditableParent: getContentEditableParent,\n        destroy: destroy,\n        isChildOf: isChildOf,\n        dumpRng: dumpRng\n      };\n      attrHooks = setupAttrHooks(styles, settings, function () {\n        return self;\n      });\n      return self;\n    }\n    (function (DOMUtils) {\n      DOMUtils.DOM = DOMUtils(domGlobals.document);\n      DOMUtils.nodeIndex = findNodeIndex;\n    }(DOMUtils || (DOMUtils = {})));\n    var DOMUtils$1 = DOMUtils;\n\n    var DOM = DOMUtils$1.DOM;\n    var each$6 = Tools.each, grep$2 = Tools.grep;\n    var isFunction$1 = function (f) {\n      return typeof f === 'function';\n    };\n    var ScriptLoader = function () {\n      var QUEUED = 0;\n      var LOADING = 1;\n      var LOADED = 2;\n      var FAILED = 3;\n      var states = {};\n      var queue = [];\n      var scriptLoadedCallbacks = {};\n      var queueLoadedCallbacks = [];\n      var loading = 0;\n      var loadScript = function (url, success, failure) {\n        var dom = DOM;\n        var elm, id;\n        var done = function () {\n          dom.remove(id);\n          if (elm) {\n            elm.onreadystatechange = elm.onload = elm = null;\n          }\n          success();\n        };\n        var error = function () {\n          if (isFunction$1(failure)) {\n            failure();\n          } else {\n            if (typeof console !== 'undefined' && console.log) {\n              console.log('Failed to load script: ' + url);\n            }\n          }\n        };\n        id = dom.uniqueId();\n        elm = domGlobals.document.createElement('script');\n        elm.id = id;\n        elm.type = 'text/javascript';\n        elm.src = Tools._addCacheSuffix(url);\n        elm.onload = done;\n        elm.onerror = error;\n        (domGlobals.document.getElementsByTagName('head')[0] || domGlobals.document.body).appendChild(elm);\n      };\n      this.isDone = function (url) {\n        return states[url] === LOADED;\n      };\n      this.markDone = function (url) {\n        states[url] = LOADED;\n      };\n      this.add = this.load = function (url, success, scope, failure) {\n        var state = states[url];\n        if (state === undefined) {\n          queue.push(url);\n          states[url] = QUEUED;\n        }\n        if (success) {\n          if (!scriptLoadedCallbacks[url]) {\n            scriptLoadedCallbacks[url] = [];\n          }\n          scriptLoadedCallbacks[url].push({\n            success: success,\n            failure: failure,\n            scope: scope || this\n          });\n        }\n      };\n      this.remove = function (url) {\n        delete states[url];\n        delete scriptLoadedCallbacks[url];\n      };\n      this.loadQueue = function (success, scope, failure) {\n        this.loadScripts(queue, success, scope, failure);\n      };\n      this.loadScripts = function (scripts, success, scope, failure) {\n        var loadScripts;\n        var failures = [];\n        var execCallbacks = function (name, url) {\n          each$6(scriptLoadedCallbacks[url], function (callback) {\n            if (isFunction$1(callback[name])) {\n              callback[name].call(callback.scope);\n            }\n          });\n          scriptLoadedCallbacks[url] = undefined;\n        };\n        queueLoadedCallbacks.push({\n          success: success,\n          failure: failure,\n          scope: scope || this\n        });\n        loadScripts = function () {\n          var loadingScripts = grep$2(scripts);\n          scripts.length = 0;\n          each$6(loadingScripts, function (url) {\n            if (states[url] === LOADED) {\n              execCallbacks('success', url);\n              return;\n            }\n            if (states[url] === FAILED) {\n              execCallbacks('failure', url);\n              return;\n            }\n            if (states[url] !== LOADING) {\n              states[url] = LOADING;\n              loading++;\n              loadScript(url, function () {\n                states[url] = LOADED;\n                loading--;\n                execCallbacks('success', url);\n                loadScripts();\n              }, function () {\n                states[url] = FAILED;\n                loading--;\n                failures.push(url);\n                execCallbacks('failure', url);\n                loadScripts();\n              });\n            }\n          });\n          if (!loading) {\n            var notifyCallbacks = queueLoadedCallbacks.slice(0);\n            queueLoadedCallbacks.length = 0;\n            each$6(notifyCallbacks, function (callback) {\n              if (failures.length === 0) {\n                if (isFunction$1(callback.success)) {\n                  callback.success.call(callback.scope);\n                }\n              } else {\n                if (isFunction$1(callback.failure)) {\n                  callback.failure.call(callback.scope, failures);\n                }\n              }\n            });\n          }\n        };\n        loadScripts();\n      };\n    };\n    ScriptLoader.ScriptLoader = new ScriptLoader();\n\n    var each$7 = Tools.each;\n    function AddOnManager() {\n      var _this = this;\n      var items = [];\n      var urls = {};\n      var lookup = {};\n      var _listeners = [];\n      var get = function (name) {\n        if (lookup[name]) {\n          return lookup[name].instance;\n        }\n        return undefined;\n      };\n      var dependencies = function (name) {\n        var result;\n        if (lookup[name]) {\n          result = lookup[name].dependencies;\n        }\n        return result || [];\n      };\n      var requireLangPack = function (name, languages) {\n        var language = AddOnManager.language;\n        if (language && AddOnManager.languageLoad !== false) {\n          if (languages) {\n            languages = ',' + languages + ',';\n            if (languages.indexOf(',' + language.substr(0, 2) + ',') !== -1) {\n              language = language.substr(0, 2);\n            } else if (languages.indexOf(',' + language + ',') === -1) {\n              return;\n            }\n          }\n          ScriptLoader.ScriptLoader.add(urls[name] + '/langs/' + language + '.js');\n        }\n      };\n      var add = function (id, addOn, dependencies) {\n        items.push(addOn);\n        lookup[id] = {\n          instance: addOn,\n          dependencies: dependencies\n        };\n        var result = partition(_listeners, function (listener) {\n          return listener.name === id;\n        });\n        _listeners = result.fail;\n        each$7(result.pass, function (listener) {\n          listener.callback();\n        });\n        return addOn;\n      };\n      var remove = function (name) {\n        delete urls[name];\n        delete lookup[name];\n      };\n      var createUrl = function (baseUrl, dep) {\n        if (typeof dep === 'object') {\n          return dep;\n        }\n        return typeof baseUrl === 'string' ? {\n          prefix: '',\n          resource: dep,\n          suffix: ''\n        } : {\n          prefix: baseUrl.prefix,\n          resource: dep,\n          suffix: baseUrl.suffix\n        };\n      };\n      var addComponents = function (pluginName, scripts) {\n        var pluginUrl = _this.urls[pluginName];\n        each$7(scripts, function (script) {\n          ScriptLoader.ScriptLoader.add(pluginUrl + '/' + script);\n        });\n      };\n      var loadDependencies = function (name, addOnUrl, success, scope) {\n        var deps = dependencies(name);\n        each$7(deps, function (dep) {\n          var newUrl = createUrl(addOnUrl, dep);\n          load(newUrl.resource, newUrl, undefined, undefined);\n        });\n        if (success) {\n          if (scope) {\n            success.call(scope);\n          } else {\n            success.call(ScriptLoader);\n          }\n        }\n      };\n      var load = function (name, addOnUrl, success, scope, failure) {\n        if (urls[name]) {\n          return;\n        }\n        var urlString = typeof addOnUrl === 'string' ? addOnUrl : addOnUrl.prefix + addOnUrl.resource + addOnUrl.suffix;\n        if (urlString.indexOf('/') !== 0 && urlString.indexOf('://') === -1) {\n          urlString = AddOnManager.baseURL + '/' + urlString;\n        }\n        urls[name] = urlString.substring(0, urlString.lastIndexOf('/'));\n        if (lookup[name]) {\n          loadDependencies(name, addOnUrl, success, scope);\n        } else {\n          ScriptLoader.ScriptLoader.add(urlString, function () {\n            return loadDependencies(name, addOnUrl, success, scope);\n          }, scope, failure);\n        }\n      };\n      var waitFor = function (name, callback) {\n        if (lookup.hasOwnProperty(name)) {\n          callback();\n        } else {\n          _listeners.push({\n            name: name,\n            callback: callback\n          });\n        }\n      };\n      return {\n        items: items,\n        urls: urls,\n        lookup: lookup,\n        _listeners: _listeners,\n        get: get,\n        dependencies: dependencies,\n        requireLangPack: requireLangPack,\n        add: add,\n        remove: remove,\n        createUrl: createUrl,\n        addComponents: addComponents,\n        load: load,\n        waitFor: waitFor\n      };\n    }\n    (function (AddOnManager) {\n      AddOnManager.PluginManager = AddOnManager();\n      AddOnManager.ThemeManager = AddOnManager();\n    }(AddOnManager || (AddOnManager = {})));\n\n    var before = function (marker, element) {\n      var parent$1 = parent(marker);\n      parent$1.each(function (v) {\n        v.dom().insertBefore(element.dom(), marker.dom());\n      });\n    };\n    var after = function (marker, element) {\n      var sibling = nextSibling(marker);\n      sibling.fold(function () {\n        var parent$1 = parent(marker);\n        parent$1.each(function (v) {\n          append(v, element);\n        });\n      }, function (v) {\n        before(v, element);\n      });\n    };\n    var prepend = function (parent, element) {\n      var firstChild$1 = firstChild(parent);\n      firstChild$1.fold(function () {\n        append(parent, element);\n      }, function (v) {\n        parent.dom().insertBefore(element.dom(), v.dom());\n      });\n    };\n    var append = function (parent, element) {\n      parent.dom().appendChild(element.dom());\n    };\n    var wrap$1 = function (element, wrapper) {\n      before(element, wrapper);\n      append(wrapper, element);\n    };\n\n    var before$1 = function (marker, elements) {\n      each(elements, function (x) {\n        before(marker, x);\n      });\n    };\n    var append$1 = function (parent, elements) {\n      each(elements, function (x) {\n        append(parent, x);\n      });\n    };\n\n    var empty = function (element) {\n      element.dom().textContent = '';\n      each(children(element), function (rogue) {\n        remove$1(rogue);\n      });\n    };\n    var remove$1 = function (element) {\n      var dom = element.dom();\n      if (dom.parentNode !== null) {\n        dom.parentNode.removeChild(dom);\n      }\n    };\n    var unwrap = function (wrapper) {\n      var children$1 = children(wrapper);\n      if (children$1.length > 0) {\n        before$1(wrapper, children$1);\n      }\n      remove$1(wrapper);\n    };\n\n    var first = function (fn, rate) {\n      var timer = null;\n      var cancel = function () {\n        if (timer !== null) {\n          domGlobals.clearTimeout(timer);\n          timer = null;\n        }\n      };\n      var throttle = function () {\n        var args = [];\n        for (var _i = 0; _i < arguments.length; _i++) {\n          args[_i] = arguments[_i];\n        }\n        if (timer === null) {\n          timer = domGlobals.setTimeout(function () {\n            fn.apply(null, args);\n            timer = null;\n          }, rate);\n        }\n      };\n      return {\n        cancel: cancel,\n        throttle: throttle\n      };\n    };\n    var last$2 = function (fn, rate) {\n      var timer = null;\n      var cancel = function () {\n        if (timer !== null) {\n          domGlobals.clearTimeout(timer);\n          timer = null;\n        }\n      };\n      var throttle = function () {\n        var args = [];\n        for (var _i = 0; _i < arguments.length; _i++) {\n          args[_i] = arguments[_i];\n        }\n        if (timer !== null) {\n          domGlobals.clearTimeout(timer);\n        }\n        timer = domGlobals.setTimeout(function () {\n          fn.apply(null, args);\n          timer = null;\n        }, rate);\n      };\n      return {\n        cancel: cancel,\n        throttle: throttle\n      };\n    };\n\n    var Cell = function (initial) {\n      var value = initial;\n      var get = function () {\n        return value;\n      };\n      var set = function (v) {\n        value = v;\n      };\n      var clone = function () {\n        return Cell(get());\n      };\n      return {\n        get: get,\n        set: set,\n        clone: clone\n      };\n    };\n\n    var read = function (element, attr) {\n      var value = get(element, attr);\n      return value === undefined || value === '' ? [] : value.split(' ');\n    };\n    var add = function (element, attr, id) {\n      var old = read(element, attr);\n      var nu = old.concat([id]);\n      set(element, attr, nu.join(' '));\n      return true;\n    };\n    var remove$2 = function (element, attr, id) {\n      var nu = filter(read(element, attr), function (v) {\n        return v !== id;\n      });\n      if (nu.length > 0) {\n        set(element, attr, nu.join(' '));\n      } else {\n        remove(element, attr);\n      }\n      return false;\n    };\n\n    var supports = function (element) {\n      return element.dom().classList !== undefined;\n    };\n    var get$2 = function (element) {\n      return read(element, 'class');\n    };\n    var add$1 = function (element, clazz) {\n      return add(element, 'class', clazz);\n    };\n    var remove$3 = function (element, clazz) {\n      return remove$2(element, 'class', clazz);\n    };\n\n    var add$2 = function (element, clazz) {\n      if (supports(element)) {\n        element.dom().classList.add(clazz);\n      } else {\n        add$1(element, clazz);\n      }\n    };\n    var cleanClass = function (element) {\n      var classList = supports(element) ? element.dom().classList : get$2(element);\n      if (classList.length === 0) {\n        remove(element, 'class');\n      }\n    };\n    var remove$4 = function (element, clazz) {\n      if (supports(element)) {\n        var classList = element.dom().classList;\n        classList.remove(clazz);\n      } else {\n        remove$3(element, clazz);\n      }\n      cleanClass(element);\n    };\n    var has$2 = function (element, clazz) {\n      return supports(element) && element.dom().classList.contains(clazz);\n    };\n\n    var descendants = function (scope, predicate) {\n      var result = [];\n      each(children(scope), function (x) {\n        if (predicate(x)) {\n          result = result.concat([x]);\n        }\n        result = result.concat(descendants(x, predicate));\n      });\n      return result;\n    };\n\n    var descendants$1 = function (scope, selector) {\n      return all(selector, scope);\n    };\n\n    function ClosestOrAncestor (is, ancestor, scope, a, isRoot) {\n      return is(scope, a) ? Option.some(scope) : isFunction(isRoot) && isRoot(scope) ? Option.none() : ancestor(scope, a, isRoot);\n    }\n\n    var ancestor = function (scope, predicate, isRoot) {\n      var element = scope.dom();\n      var stop = isFunction(isRoot) ? isRoot : constant(false);\n      while (element.parentNode) {\n        element = element.parentNode;\n        var el = Element.fromDom(element);\n        if (predicate(el)) {\n          return Option.some(el);\n        } else if (stop(el)) {\n          break;\n        }\n      }\n      return Option.none();\n    };\n    var closest = function (scope, predicate, isRoot) {\n      var is = function (s, test) {\n        return test(s);\n      };\n      return ClosestOrAncestor(is, ancestor, scope, predicate, isRoot);\n    };\n\n    var ancestor$1 = function (scope, selector, isRoot) {\n      return ancestor(scope, function (e) {\n        return is$1(e, selector);\n      }, isRoot);\n    };\n    var descendant = function (scope, selector) {\n      return one(selector, scope);\n    };\n    var closest$1 = function (scope, selector, isRoot) {\n      return ClosestOrAncestor(is$1, ancestor$1, scope, selector, isRoot);\n    };\n\n    var annotation = constant('mce-annotation');\n    var dataAnnotation = constant('data-mce-annotation');\n    var dataAnnotationId = constant('data-mce-annotation-uid');\n\n    var identify = function (editor, annotationName) {\n      var rng = editor.selection.getRng();\n      var start = Element.fromDom(rng.startContainer);\n      var root = Element.fromDom(editor.getBody());\n      var selector = annotationName.fold(function () {\n        return '.' + annotation();\n      }, function (an) {\n        return '[' + dataAnnotation() + '=\"' + an + '\"]';\n      });\n      var newStart = child(start, rng.startOffset).getOr(start);\n      var closest = closest$1(newStart, selector, function (n) {\n        return eq(n, root);\n      });\n      var getAttr = function (c, property) {\n        if (has$1(c, property)) {\n          return Option.some(get(c, property));\n        } else {\n          return Option.none();\n        }\n      };\n      return closest.bind(function (c) {\n        return getAttr(c, '' + dataAnnotationId()).bind(function (uid) {\n          return getAttr(c, '' + dataAnnotation()).map(function (name) {\n            var elements = findMarkers(editor, uid);\n            return {\n              uid: uid,\n              name: name,\n              elements: elements\n            };\n          });\n        });\n      });\n    };\n    var isAnnotation = function (elem) {\n      return isElement(elem) && has$2(elem, annotation());\n    };\n    var findMarkers = function (editor, uid) {\n      var body = Element.fromDom(editor.getBody());\n      return descendants$1(body, '[' + dataAnnotationId() + '=\"' + uid + '\"]');\n    };\n    var findAll = function (editor, name) {\n      var body = Element.fromDom(editor.getBody());\n      var markers = descendants$1(body, '[' + dataAnnotation() + '=\"' + name + '\"]');\n      var directory = {};\n      each(markers, function (m) {\n        var uid = get(m, dataAnnotationId());\n        var nodesAlready = directory.hasOwnProperty(uid) ? directory[uid] : [];\n        directory[uid] = nodesAlready.concat([m]);\n      });\n      return directory;\n    };\n\n    var setup = function (editor, registry) {\n      var changeCallbacks = Cell({});\n      var initData = function () {\n        return {\n          listeners: [],\n          previous: Cell(Option.none())\n        };\n      };\n      var withCallbacks = function (name, f) {\n        updateCallbacks(name, function (data) {\n          f(data);\n          return data;\n        });\n      };\n      var updateCallbacks = function (name, f) {\n        var callbackMap = changeCallbacks.get();\n        var data = callbackMap.hasOwnProperty(name) ? callbackMap[name] : initData();\n        var outputData = f(data);\n        callbackMap[name] = outputData;\n        changeCallbacks.set(callbackMap);\n      };\n      var fireCallbacks = function (name, uid, elements) {\n        withCallbacks(name, function (data) {\n          each(data.listeners, function (f) {\n            return f(true, name, {\n              uid: uid,\n              nodes: map(elements, function (elem) {\n                return elem.dom();\n              })\n            });\n          });\n        });\n      };\n      var fireNoAnnotation = function (name) {\n        withCallbacks(name, function (data) {\n          each(data.listeners, function (f) {\n            return f(false, name);\n          });\n        });\n      };\n      var onNodeChange = last$2(function () {\n        var callbackMap = changeCallbacks.get();\n        var annotations = sort(keys(callbackMap));\n        each(annotations, function (name) {\n          updateCallbacks(name, function (data) {\n            var prev = data.previous.get();\n            identify(editor, Option.some(name)).fold(function () {\n              if (prev.isSome()) {\n                fireNoAnnotation(name);\n                data.previous.set(Option.none());\n              }\n            }, function (_a) {\n              var uid = _a.uid, name = _a.name, elements = _a.elements;\n              if (!prev.is(uid)) {\n                fireCallbacks(name, uid, elements);\n                data.previous.set(Option.some(uid));\n              }\n            });\n            return {\n              previous: data.previous,\n              listeners: data.listeners\n            };\n          });\n        });\n      }, 30);\n      editor.on('remove', function () {\n        onNodeChange.cancel();\n      });\n      editor.on('nodeChange', function () {\n        onNodeChange.throttle();\n      });\n      var addListener = function (name, f) {\n        updateCallbacks(name, function (data) {\n          return {\n            previous: data.previous,\n            listeners: data.listeners.concat([f])\n          };\n        });\n      };\n      return { addListener: addListener };\n    };\n\n    var setup$1 = function (editor, registry) {\n      var identifyParserNode = function (span) {\n        var optAnnotation = Option.from(span.attributes.map[dataAnnotation()]);\n        return optAnnotation.bind(registry.lookup);\n      };\n      editor.on('init', function () {\n        editor.serializer.addNodeFilter('span', function (spans) {\n          each(spans, function (span) {\n            identifyParserNode(span).each(function (settings) {\n              if (settings.persistent === false) {\n                span.unwrap();\n              }\n            });\n          });\n        });\n      });\n    };\n\n    var create$1 = function () {\n      var annotations = {};\n      var register = function (name, settings) {\n        annotations[name] = {\n          name: name,\n          settings: settings\n        };\n      };\n      var lookup = function (name) {\n        return annotations.hasOwnProperty(name) ? Option.from(annotations[name]).map(function (a) {\n          return a.settings;\n        }) : Option.none();\n      };\n      return {\n        register: register,\n        lookup: lookup\n      };\n    };\n\n    var __assign = function () {\n      __assign = Object.assign || function __assign(t) {\n        for (var s, i = 1, n = arguments.length; i < n; i++) {\n          s = arguments[i];\n          for (var p in s)\n            if (Object.prototype.hasOwnProperty.call(s, p))\n              t[p] = s[p];\n        }\n        return t;\n      };\n      return __assign.apply(this, arguments);\n    };\n    function __rest(s, e) {\n      var t = {};\n      for (var p in s)\n        if (Object.prototype.hasOwnProperty.call(s, p) && e.indexOf(p) < 0)\n          t[p] = s[p];\n      if (s != null && typeof Object.getOwnPropertySymbols === 'function')\n        for (var i = 0, p = Object.getOwnPropertySymbols(s); i < p.length; i++) {\n          if (e.indexOf(p[i]) < 0 && Object.prototype.propertyIsEnumerable.call(s, p[i]))\n            t[p[i]] = s[p[i]];\n        }\n      return t;\n    }\n    function __spreadArrays() {\n      for (var s = 0, i = 0, il = arguments.length; i < il; i++)\n        s += arguments[i].length;\n      for (var r = Array(s), k = 0, i = 0; i < il; i++)\n        for (var a = arguments[i], j = 0, jl = a.length; j < jl; j++, k++)\n          r[k] = a[j];\n      return r;\n    }\n\n    var unique = 0;\n    var generate = function (prefix) {\n      var date = new Date();\n      var time = date.getTime();\n      var random = Math.floor(Math.random() * 1000000000);\n      unique++;\n      return prefix + '_' + random + unique + String(time);\n    };\n\n    var add$3 = function (element, classes) {\n      each(classes, function (x) {\n        add$2(element, x);\n      });\n    };\n\n    var clone = function (original, isDeep) {\n      return Element.fromDom(original.dom().cloneNode(isDeep));\n    };\n    var shallow = function (original) {\n      return clone(original, false);\n    };\n    var deep = function (original) {\n      return clone(original, true);\n    };\n\n    var fromHtml$1 = function (html, scope) {\n      var doc = scope || domGlobals.document;\n      var div = doc.createElement('div');\n      div.innerHTML = html;\n      return children(Element.fromDom(div));\n    };\n\n    var get$3 = function (element) {\n      return element.dom().innerHTML;\n    };\n    var set$1 = function (element, content) {\n      var owner$1 = owner(element);\n      var docDom = owner$1.dom();\n      var fragment = Element.fromDom(docDom.createDocumentFragment());\n      var contentElements = fromHtml$1(content, docDom);\n      append$1(fragment, contentElements);\n      empty(element);\n      append(element, fragment);\n    };\n\n    var ZWSP = '\\uFEFF';\n    var isZwsp = function (chr) {\n      return chr === ZWSP;\n    };\n    var trim$3 = function (text) {\n      return text.replace(new RegExp(ZWSP, 'g'), '');\n    };\n    var Zwsp = {\n      isZwsp: isZwsp,\n      ZWSP: ZWSP,\n      trim: trim$3\n    };\n\n    var isElement$2 = NodeType.isElement;\n    var isText$2 = NodeType.isText;\n    var isCaretContainerBlock = function (node) {\n      if (isText$2(node)) {\n        node = node.parentNode;\n      }\n      return isElement$2(node) && node.hasAttribute('data-mce-caret');\n    };\n    var isCaretContainerInline = function (node) {\n      return isText$2(node) && Zwsp.isZwsp(node.data);\n    };\n    var isCaretContainer = function (node) {\n      return isCaretContainerBlock(node) || isCaretContainerInline(node);\n    };\n    var hasContent = function (node) {\n      return node.firstChild !== node.lastChild || !NodeType.isBr(node.firstChild);\n    };\n    var insertInline = function (node, before) {\n      var doc, sibling, textNode, parentNode;\n      doc = node.ownerDocument;\n      textNode = doc.createTextNode(Zwsp.ZWSP);\n      parentNode = node.parentNode;\n      if (!before) {\n        sibling = node.nextSibling;\n        if (isText$2(sibling)) {\n          if (isCaretContainer(sibling)) {\n            return sibling;\n          }\n          if (startsWithCaretContainer(sibling)) {\n            sibling.splitText(1);\n            return sibling;\n          }\n        }\n        if (node.nextSibling) {\n          parentNode.insertBefore(textNode, node.nextSibling);\n        } else {\n          parentNode.appendChild(textNode);\n        }\n      } else {\n        sibling = node.previousSibling;\n        if (isText$2(sibling)) {\n          if (isCaretContainer(sibling)) {\n            return sibling;\n          }\n          if (endsWithCaretContainer(sibling)) {\n            return sibling.splitText(sibling.data.length - 1);\n          }\n        }\n        parentNode.insertBefore(textNode, node);\n      }\n      return textNode;\n    };\n    var isBeforeInline = function (pos) {\n      var container = pos.container();\n      if (!pos || !NodeType.isText(container)) {\n        return false;\n      }\n      return container.data.charAt(pos.offset()) === Zwsp.ZWSP || pos.isAtStart() && isCaretContainerInline(container.previousSibling);\n    };\n    var isAfterInline = function (pos) {\n      var container = pos.container();\n      if (!pos || !NodeType.isText(container)) {\n        return false;\n      }\n      return container.data.charAt(pos.offset() - 1) === Zwsp.ZWSP || pos.isAtEnd() && isCaretContainerInline(container.nextSibling);\n    };\n    var createBogusBr = function () {\n      var br = domGlobals.document.createElement('br');\n      br.setAttribute('data-mce-bogus', '1');\n      return br;\n    };\n    var insertBlock = function (blockName, node, before) {\n      var doc, blockNode, parentNode;\n      doc = node.ownerDocument;\n      blockNode = doc.createElement(blockName);\n      blockNode.setAttribute('data-mce-caret', before ? 'before' : 'after');\n      blockNode.setAttribute('data-mce-bogus', 'all');\n      blockNode.appendChild(createBogusBr());\n      parentNode = node.parentNode;\n      if (!before) {\n        if (node.nextSibling) {\n          parentNode.insertBefore(blockNode, node.nextSibling);\n        } else {\n          parentNode.appendChild(blockNode);\n        }\n      } else {\n        parentNode.insertBefore(blockNode, node);\n      }\n      return blockNode;\n    };\n    var startsWithCaretContainer = function (node) {\n      return isText$2(node) && node.data[0] === Zwsp.ZWSP;\n    };\n    var endsWithCaretContainer = function (node) {\n      return isText$2(node) && node.data[node.data.length - 1] === Zwsp.ZWSP;\n    };\n    var trimBogusBr = function (elm) {\n      var brs = elm.getElementsByTagName('br');\n      var lastBr = brs[brs.length - 1];\n      if (NodeType.isBogus(lastBr)) {\n        lastBr.parentNode.removeChild(lastBr);\n      }\n    };\n    var showCaretContainerBlock = function (caretContainer) {\n      if (caretContainer && caretContainer.hasAttribute('data-mce-caret')) {\n        trimBogusBr(caretContainer);\n        caretContainer.removeAttribute('data-mce-caret');\n        caretContainer.removeAttribute('data-mce-bogus');\n        caretContainer.removeAttribute('style');\n        caretContainer.removeAttribute('_moz_abspos');\n        return caretContainer;\n      }\n      return null;\n    };\n    var isRangeInCaretContainerBlock = function (range) {\n      return isCaretContainerBlock(range.startContainer);\n    };\n\n    var isContentEditableTrue$1 = NodeType.isContentEditableTrue;\n    var isContentEditableFalse$1 = NodeType.isContentEditableFalse;\n    var isBr$2 = NodeType.isBr;\n    var isText$3 = NodeType.isText;\n    var isInvalidTextElement = NodeType.matchNodeNames('script style textarea');\n    var isAtomicInline = NodeType.matchNodeNames('img input textarea hr iframe video audio object');\n    var isTable$1 = NodeType.matchNodeNames('table');\n    var isCaretContainer$1 = isCaretContainer;\n    var isCaretCandidate = function (node) {\n      if (isCaretContainer$1(node)) {\n        return false;\n      }\n      if (isText$3(node)) {\n        if (isInvalidTextElement(node.parentNode)) {\n          return false;\n        }\n        return true;\n      }\n      return isAtomicInline(node) || isBr$2(node) || isTable$1(node) || isNonUiContentEditableFalse(node);\n    };\n    var isUnselectable = function (node) {\n      return NodeType.isElement(node) && node.getAttribute('unselectable') === 'true';\n    };\n    var isNonUiContentEditableFalse = function (node) {\n      return isUnselectable(node) === false && isContentEditableFalse$1(node);\n    };\n    var isInEditable = function (node, root) {\n      for (node = node.parentNode; node && node !== root; node = node.parentNode) {\n        if (isNonUiContentEditableFalse(node)) {\n          return false;\n        }\n        if (isContentEditableTrue$1(node)) {\n          return true;\n        }\n      }\n      return true;\n    };\n    var isAtomicContentEditableFalse = function (node) {\n      if (!isNonUiContentEditableFalse(node)) {\n        return false;\n      }\n      return foldl(from$1(node.getElementsByTagName('*')), function (result, elm) {\n        return result || isContentEditableTrue$1(elm);\n      }, false) !== true;\n    };\n    var isAtomic = function (node) {\n      return isAtomicInline(node) || isAtomicContentEditableFalse(node);\n    };\n    var isEditableCaretCandidate = function (node, root) {\n      return isCaretCandidate(node) && isInEditable(node, root);\n    };\n\n    var round = Math.round;\n    var clone$1 = function (rect) {\n      if (!rect) {\n        return {\n          left: 0,\n          top: 0,\n          bottom: 0,\n          right: 0,\n          width: 0,\n          height: 0\n        };\n      }\n      return {\n        left: round(rect.left),\n        top: round(rect.top),\n        bottom: round(rect.bottom),\n        right: round(rect.right),\n        width: round(rect.width),\n        height: round(rect.height)\n      };\n    };\n    var collapse = function (rect, toStart) {\n      rect = clone$1(rect);\n      if (toStart) {\n        rect.right = rect.left;\n      } else {\n        rect.left = rect.left + rect.width;\n        rect.right = rect.left;\n      }\n      rect.width = 0;\n      return rect;\n    };\n    var isEqual = function (rect1, rect2) {\n      return rect1.left === rect2.left && rect1.top === rect2.top && rect1.bottom === rect2.bottom && rect1.right === rect2.right;\n    };\n    var isValidOverflow = function (overflowY, rect1, rect2) {\n      return overflowY >= 0 && overflowY <= Math.min(rect1.height, rect2.height) / 2;\n    };\n    var isAbove = function (rect1, rect2) {\n      var halfHeight = Math.min(rect2.height / 2, rect1.height / 2);\n      if (rect1.bottom - halfHeight < rect2.top) {\n        return true;\n      }\n      if (rect1.top > rect2.bottom) {\n        return false;\n      }\n      return isValidOverflow(rect2.top - rect1.bottom, rect1, rect2);\n    };\n    var isBelow = function (rect1, rect2) {\n      if (rect1.top > rect2.bottom) {\n        return true;\n      }\n      if (rect1.bottom < rect2.top) {\n        return false;\n      }\n      return isValidOverflow(rect2.bottom - rect1.top, rect1, rect2);\n    };\n    var containsXY = function (rect, clientX, clientY) {\n      return clientX >= rect.left && clientX <= rect.right && clientY >= rect.top && clientY <= rect.bottom;\n    };\n    var overflowX = function (outer, inner) {\n      if (inner.left > outer.left && inner.right < outer.right) {\n        return 0;\n      } else {\n        return inner.left < outer.left ? inner.left - outer.left : inner.right - outer.right;\n      }\n    };\n    var overflowY = function (outer, inner) {\n      if (inner.top > outer.top && inner.bottom < outer.bottom) {\n        return 0;\n      } else {\n        return inner.top < outer.top ? inner.top - outer.top : inner.bottom - outer.bottom;\n      }\n    };\n    var getOverflow = function (outer, inner) {\n      return {\n        x: overflowX(outer, inner),\n        y: overflowY(outer, inner)\n      };\n    };\n\n    var getSelectedNode = function (range) {\n      var startContainer = range.startContainer, startOffset = range.startOffset;\n      if (startContainer.hasChildNodes() && range.endOffset === startOffset + 1) {\n        return startContainer.childNodes[startOffset];\n      }\n      return null;\n    };\n    var getNode = function (container, offset) {\n      if (container.nodeType === 1 && container.hasChildNodes()) {\n        if (offset >= container.childNodes.length) {\n          offset = container.childNodes.length - 1;\n        }\n        container = container.childNodes[offset];\n      }\n      return container;\n    };\n\n    var extendingChars = new RegExp('[\\u0300-\\u036f\\u0483-\\u0487\\u0488-\\u0489\\u0591-\\u05bd\\u05bf\\u05c1-\\u05c2\\u05c4-\\u05c5\\u05c7\\u0610-\\u061a' + '\\u064b-\\u065f\\u0670\\u06d6-\\u06dc\\u06df-\\u06e4\\u06e7-\\u06e8\\u06ea-\\u06ed\\u0711\\u0730-\\u074a\\u07a6-\\u07b0' + '\\u07eb-\\u07f3\\u0816-\\u0819\\u081b-\\u0823\\u0825-\\u0827\\u0829-\\u082d\\u0859-\\u085b\\u08e3-\\u0902\\u093a\\u093c' + '\\u0941-\\u0948\\u094d\\u0951-\\u0957\\u0962-\\u0963\\u0981\\u09bc\\u09be\\u09c1-\\u09c4\\u09cd\\u09d7\\u09e2-\\u09e3' + '\\u0a01-\\u0a02\\u0a3c\\u0a41-\\u0a42\\u0a47-\\u0a48\\u0a4b-\\u0a4d\\u0a51\\u0a70-\\u0a71\\u0a75\\u0a81-\\u0a82\\u0abc' + '\\u0ac1-\\u0ac5\\u0ac7-\\u0ac8\\u0acd\\u0ae2-\\u0ae3\\u0b01\\u0b3c\\u0b3e\\u0b3f\\u0b41-\\u0b44\\u0b4d\\u0b56\\u0b57' + '\\u0b62-\\u0b63\\u0b82\\u0bbe\\u0bc0\\u0bcd\\u0bd7\\u0c00\\u0c3e-\\u0c40\\u0c46-\\u0c48\\u0c4a-\\u0c4d\\u0c55-\\u0c56' + '\\u0c62-\\u0c63\\u0c81\\u0cbc\\u0cbf\\u0cc2\\u0cc6\\u0ccc-\\u0ccd\\u0cd5-\\u0cd6\\u0ce2-\\u0ce3\\u0d01\\u0d3e\\u0d41-\\u0d44' + '\\u0d4d\\u0d57\\u0d62-\\u0d63\\u0dca\\u0dcf\\u0dd2-\\u0dd4\\u0dd6\\u0ddf\\u0e31\\u0e34-\\u0e3a\\u0e47-\\u0e4e\\u0eb1\\u0eb4-\\u0eb9' + '\\u0ebb-\\u0ebc\\u0ec8-\\u0ecd\\u0f18-\\u0f19\\u0f35\\u0f37\\u0f39\\u0f71-\\u0f7e\\u0f80-\\u0f84\\u0f86-\\u0f87\\u0f8d-\\u0f97' + '\\u0f99-\\u0fbc\\u0fc6\\u102d-\\u1030\\u1032-\\u1037\\u1039-\\u103a\\u103d-\\u103e\\u1058-\\u1059\\u105e-\\u1060\\u1071-\\u1074' + '\\u1082\\u1085-\\u1086\\u108d\\u109d\\u135d-\\u135f\\u1712-\\u1714\\u1732-\\u1734\\u1752-\\u1753\\u1772-\\u1773\\u17b4-\\u17b5' + '\\u17b7-\\u17bd\\u17c6\\u17c9-\\u17d3\\u17dd\\u180b-\\u180d\\u18a9\\u1920-\\u1922\\u1927-\\u1928\\u1932\\u1939-\\u193b\\u1a17-\\u1a18' + '\\u1a1b\\u1a56\\u1a58-\\u1a5e\\u1a60\\u1a62\\u1a65-\\u1a6c\\u1a73-\\u1a7c\\u1a7f\\u1ab0-\\u1abd\\u1ABE\\u1b00-\\u1b03\\u1b34' + '\\u1b36-\\u1b3a\\u1b3c\\u1b42\\u1b6b-\\u1b73\\u1b80-\\u1b81\\u1ba2-\\u1ba5\\u1ba8-\\u1ba9\\u1bab-\\u1bad\\u1be6\\u1be8-\\u1be9' + '\\u1bed\\u1bef-\\u1bf1\\u1c2c-\\u1c33\\u1c36-\\u1c37\\u1cd0-\\u1cd2\\u1cd4-\\u1ce0\\u1ce2-\\u1ce8\\u1ced\\u1cf4\\u1cf8-\\u1cf9' + '\\u1dc0-\\u1df5\\u1dfc-\\u1dff\\u200c-\\u200d\\u20d0-\\u20dc\\u20DD-\\u20E0\\u20e1\\u20E2-\\u20E4\\u20e5-\\u20f0\\u2cef-\\u2cf1' + '\\u2d7f\\u2de0-\\u2dff\\u302a-\\u302d\\u302e-\\u302f\\u3099-\\u309a\\ua66f\\uA670-\\uA672\\ua674-\\ua67d\\ua69e-\\ua69f\\ua6f0-\\ua6f1' + '\\ua802\\ua806\\ua80b\\ua825-\\ua826\\ua8c4\\ua8e0-\\ua8f1\\ua926-\\ua92d\\ua947-\\ua951\\ua980-\\ua982\\ua9b3\\ua9b6-\\ua9b9\\ua9bc' + '\\ua9e5\\uaa29-\\uaa2e\\uaa31-\\uaa32\\uaa35-\\uaa36\\uaa43\\uaa4c\\uaa7c\\uaab0\\uaab2-\\uaab4\\uaab7-\\uaab8\\uaabe-\\uaabf\\uaac1' + '\\uaaec-\\uaaed\\uaaf6\\uabe5\\uabe8\\uabed\\ufb1e\\ufe00-\\ufe0f\\ufe20-\\ufe2f\\uff9e-\\uff9f]');\n    var isExtendingChar = function (ch) {\n      return typeof ch === 'string' && ch.charCodeAt(0) >= 768 && extendingChars.test(ch);\n    };\n\n    var lift2 = function (oa, ob, f) {\n      return oa.isSome() && ob.isSome() ? Option.some(f(oa.getOrDie(), ob.getOrDie())) : Option.none();\n    };\n    var lift3 = function (oa, ob, oc, f) {\n      return oa.isSome() && ob.isSome() && oc.isSome() ? Option.some(f(oa.getOrDie(), ob.getOrDie(), oc.getOrDie())) : Option.none();\n    };\n\n    var slice$2 = [].slice;\n    var or = function () {\n      var x = [];\n      for (var _i = 0; _i < arguments.length; _i++) {\n        x[_i] = arguments[_i];\n      }\n      var args = slice$2.call(arguments);\n      return function (x) {\n        for (var i = 0; i < args.length; i++) {\n          if (args[i](x)) {\n            return true;\n          }\n        }\n        return false;\n      };\n    };\n    var and = function () {\n      var x = [];\n      for (var _i = 0; _i < arguments.length; _i++) {\n        x[_i] = arguments[_i];\n      }\n      var args = slice$2.call(arguments);\n      return function (x) {\n        for (var i = 0; i < args.length; i++) {\n          if (!args[i](x)) {\n            return false;\n          }\n        }\n        return true;\n      };\n    };\n    var Predicate = {\n      and: and,\n      or: or\n    };\n\n    var isElement$3 = NodeType.isElement;\n    var isCaretCandidate$1 = isCaretCandidate;\n    var isBlock$1 = NodeType.matchStyleValues('display', 'block table');\n    var isFloated = NodeType.matchStyleValues('float', 'left right');\n    var isValidElementCaretCandidate = Predicate.and(isElement$3, isCaretCandidate$1, not(isFloated));\n    var isNotPre = not(NodeType.matchStyleValues('white-space', 'pre pre-line pre-wrap'));\n    var isText$4 = NodeType.isText;\n    var isBr$3 = NodeType.isBr;\n    var nodeIndex = DOMUtils$1.nodeIndex;\n    var resolveIndex = getNode;\n    var createRange = function (doc) {\n      return 'createRange' in doc ? doc.createRange() : DOMUtils$1.DOM.createRng();\n    };\n    var isWhiteSpace = function (chr) {\n      return chr && /[\\r\\n\\t ]/.test(chr);\n    };\n    var isRange = function (rng) {\n      return !!rng.setStart && !!rng.setEnd;\n    };\n    var isHiddenWhiteSpaceRange = function (range) {\n      var container = range.startContainer;\n      var offset = range.startOffset;\n      var text;\n      if (isWhiteSpace(range.toString()) && isNotPre(container.parentNode) && NodeType.isText(container)) {\n        text = container.data;\n        if (isWhiteSpace(text[offset - 1]) || isWhiteSpace(text[offset + 1])) {\n          return true;\n        }\n      }\n      return false;\n    };\n    var getBrClientRect = function (brNode) {\n      var doc = brNode.ownerDocument;\n      var rng = createRange(doc);\n      var nbsp = doc.createTextNode('\\xA0');\n      var parentNode = brNode.parentNode;\n      var clientRect;\n      parentNode.insertBefore(nbsp, brNode);\n      rng.setStart(nbsp, 0);\n      rng.setEnd(nbsp, 1);\n      clientRect = clone$1(rng.getBoundingClientRect());\n      parentNode.removeChild(nbsp);\n      return clientRect;\n    };\n    var getBoundingClientRectWebKitText = function (rng) {\n      var sc = rng.startContainer;\n      var ec = rng.endContainer;\n      var so = rng.startOffset;\n      var eo = rng.endOffset;\n      if (sc === ec && NodeType.isText(ec) && so === 0 && eo === 1) {\n        var newRng = rng.cloneRange();\n        newRng.setEndAfter(ec);\n        return getBoundingClientRect(newRng);\n      } else {\n        return null;\n      }\n    };\n    var isZeroRect = function (r) {\n      return r.left === 0 && r.right === 0 && r.top === 0 && r.bottom === 0;\n    };\n    var getBoundingClientRect = function (item) {\n      var clientRect, clientRects;\n      clientRects = item.getClientRects();\n      if (clientRects.length > 0) {\n        clientRect = clone$1(clientRects[0]);\n      } else {\n        clientRect = clone$1(item.getBoundingClientRect());\n      }\n      if (!isRange(item) && isBr$3(item) && isZeroRect(clientRect)) {\n        return getBrClientRect(item);\n      }\n      if (isZeroRect(clientRect) && isRange(item)) {\n        return getBoundingClientRectWebKitText(item);\n      }\n      return clientRect;\n    };\n    var collapseAndInflateWidth = function (clientRect, toStart) {\n      var newClientRect = collapse(clientRect, toStart);\n      newClientRect.width = 1;\n      newClientRect.right = newClientRect.left + 1;\n      return newClientRect;\n    };\n    var getCaretPositionClientRects = function (caretPosition) {\n      var clientRects = [];\n      var beforeNode, node;\n      var addUniqueAndValidRect = function (clientRect) {\n        if (clientRect.height === 0) {\n          return;\n        }\n        if (clientRects.length > 0) {\n          if (isEqual(clientRect, clientRects[clientRects.length - 1])) {\n            return;\n          }\n        }\n        clientRects.push(clientRect);\n      };\n      var addCharacterOffset = function (container, offset) {\n        var range = createRange(container.ownerDocument);\n        if (offset < container.data.length) {\n          if (isExtendingChar(container.data[offset])) {\n            return clientRects;\n          }\n          if (isExtendingChar(container.data[offset - 1])) {\n            range.setStart(container, offset);\n            range.setEnd(container, offset + 1);\n            if (!isHiddenWhiteSpaceRange(range)) {\n              addUniqueAndValidRect(collapseAndInflateWidth(getBoundingClientRect(range), false));\n              return clientRects;\n            }\n          }\n        }\n        if (offset > 0) {\n          range.setStart(container, offset - 1);\n          range.setEnd(container, offset);\n          if (!isHiddenWhiteSpaceRange(range)) {\n            addUniqueAndValidRect(collapseAndInflateWidth(getBoundingClientRect(range), false));\n          }\n        }\n        if (offset < container.data.length) {\n          range.setStart(container, offset);\n          range.setEnd(container, offset + 1);\n          if (!isHiddenWhiteSpaceRange(range)) {\n            addUniqueAndValidRect(collapseAndInflateWidth(getBoundingClientRect(range), true));\n          }\n        }\n      };\n      if (isText$4(caretPosition.container())) {\n        addCharacterOffset(caretPosition.container(), caretPosition.offset());\n        return clientRects;\n      }\n      if (isElement$3(caretPosition.container())) {\n        if (caretPosition.isAtEnd()) {\n          node = resolveIndex(caretPosition.container(), caretPosition.offset());\n          if (isText$4(node)) {\n            addCharacterOffset(node, node.data.length);\n          }\n          if (isValidElementCaretCandidate(node) && !isBr$3(node)) {\n            addUniqueAndValidRect(collapseAndInflateWidth(getBoundingClientRect(node), false));\n          }\n        } else {\n          node = resolveIndex(caretPosition.container(), caretPosition.offset());\n          if (isText$4(node)) {\n            addCharacterOffset(node, 0);\n          }\n          if (isValidElementCaretCandidate(node) && caretPosition.isAtEnd()) {\n            addUniqueAndValidRect(collapseAndInflateWidth(getBoundingClientRect(node), false));\n            return clientRects;\n          }\n          beforeNode = resolveIndex(caretPosition.container(), caretPosition.offset() - 1);\n          if (isValidElementCaretCandidate(beforeNode) && !isBr$3(beforeNode)) {\n            if (isBlock$1(beforeNode) || isBlock$1(node) || !isValidElementCaretCandidate(node)) {\n              addUniqueAndValidRect(collapseAndInflateWidth(getBoundingClientRect(beforeNode), false));\n            }\n          }\n          if (isValidElementCaretCandidate(node)) {\n            addUniqueAndValidRect(collapseAndInflateWidth(getBoundingClientRect(node), true));\n          }\n        }\n      }\n      return clientRects;\n    };\n    function CaretPosition(container, offset, clientRects) {\n      var isAtStart = function () {\n        if (isText$4(container)) {\n          return offset === 0;\n        }\n        return offset === 0;\n      };\n      var isAtEnd = function () {\n        if (isText$4(container)) {\n          return offset >= container.data.length;\n        }\n        return offset >= container.childNodes.length;\n      };\n      var toRange = function () {\n        var range;\n        range = createRange(container.ownerDocument);\n        range.setStart(container, offset);\n        range.setEnd(container, offset);\n        return range;\n      };\n      var getClientRects = function () {\n        if (!clientRects) {\n          clientRects = getCaretPositionClientRects(CaretPosition(container, offset));\n        }\n        return clientRects;\n      };\n      var isVisible = function () {\n        return getClientRects().length > 0;\n      };\n      var isEqual = function (caretPosition) {\n        return caretPosition && container === caretPosition.container() && offset === caretPosition.offset();\n      };\n      var getNode = function (before) {\n        return resolveIndex(container, before ? offset - 1 : offset);\n      };\n      return {\n        container: constant(container),\n        offset: constant(offset),\n        toRange: toRange,\n        getClientRects: getClientRects,\n        isVisible: isVisible,\n        isAtStart: isAtStart,\n        isAtEnd: isAtEnd,\n        isEqual: isEqual,\n        getNode: getNode\n      };\n    }\n    (function (CaretPosition) {\n      CaretPosition.fromRangeStart = function (range) {\n        return CaretPosition(range.startContainer, range.startOffset);\n      };\n      CaretPosition.fromRangeEnd = function (range) {\n        return CaretPosition(range.endContainer, range.endOffset);\n      };\n      CaretPosition.after = function (node) {\n        return CaretPosition(node.parentNode, nodeIndex(node) + 1);\n      };\n      CaretPosition.before = function (node) {\n        return CaretPosition(node.parentNode, nodeIndex(node));\n      };\n      CaretPosition.isAbove = function (pos1, pos2) {\n        return lift2(head(pos2.getClientRects()), last(pos1.getClientRects()), isAbove).getOr(false);\n      };\n      CaretPosition.isBelow = function (pos1, pos2) {\n        return lift2(last(pos2.getClientRects()), head(pos1.getClientRects()), isBelow).getOr(false);\n      };\n      CaretPosition.isAtStart = function (pos) {\n        return pos ? pos.isAtStart() : false;\n      };\n      CaretPosition.isAtEnd = function (pos) {\n        return pos ? pos.isAtEnd() : false;\n      };\n      CaretPosition.isTextPosition = function (pos) {\n        return pos ? NodeType.isText(pos.container()) : false;\n      };\n      CaretPosition.isElementPosition = function (pos) {\n        return CaretPosition.isTextPosition(pos) === false;\n      };\n    }(CaretPosition || (CaretPosition = {})));\n    var CaretPosition$1 = CaretPosition;\n\n    var isText$5 = NodeType.isText;\n    var isBogus$1 = NodeType.isBogus;\n    var nodeIndex$1 = DOMUtils$1.nodeIndex;\n    var normalizedParent = function (node) {\n      var parentNode = node.parentNode;\n      if (isBogus$1(parentNode)) {\n        return normalizedParent(parentNode);\n      }\n      return parentNode;\n    };\n    var getChildNodes = function (node) {\n      if (!node) {\n        return [];\n      }\n      return ArrUtils.reduce(node.childNodes, function (result, node) {\n        if (isBogus$1(node) && node.nodeName !== 'BR') {\n          result = result.concat(getChildNodes(node));\n        } else {\n          result.push(node);\n        }\n        return result;\n      }, []);\n    };\n    var normalizedTextOffset = function (node, offset) {\n      while (node = node.previousSibling) {\n        if (!isText$5(node)) {\n          break;\n        }\n        offset += node.data.length;\n      }\n      return offset;\n    };\n    var equal = function (a) {\n      return function (b) {\n        return a === b;\n      };\n    };\n    var normalizedNodeIndex = function (node) {\n      var nodes, index, numTextFragments;\n      nodes = getChildNodes(normalizedParent(node));\n      index = ArrUtils.findIndex(nodes, equal(node), node);\n      nodes = nodes.slice(0, index + 1);\n      numTextFragments = ArrUtils.reduce(nodes, function (result, node, i) {\n        if (isText$5(node) && isText$5(nodes[i - 1])) {\n          result++;\n        }\n        return result;\n      }, 0);\n      nodes = ArrUtils.filter(nodes, NodeType.matchNodeNames(node.nodeName));\n      index = ArrUtils.findIndex(nodes, equal(node), node);\n      return index - numTextFragments;\n    };\n    var createPathItem = function (node) {\n      var name;\n      if (isText$5(node)) {\n        name = 'text()';\n      } else {\n        name = node.nodeName.toLowerCase();\n      }\n      return name + '[' + normalizedNodeIndex(node) + ']';\n    };\n    var parentsUntil = function (root, node, predicate) {\n      var parents = [];\n      for (node = node.parentNode; node !== root; node = node.parentNode) {\n        if (predicate && predicate(node)) {\n          break;\n        }\n        parents.push(node);\n      }\n      return parents;\n    };\n    var create$2 = function (root, caretPosition) {\n      var container, offset, path = [], outputOffset, childNodes, parents;\n      container = caretPosition.container();\n      offset = caretPosition.offset();\n      if (isText$5(container)) {\n        outputOffset = normalizedTextOffset(container, offset);\n      } else {\n        childNodes = container.childNodes;\n        if (offset >= childNodes.length) {\n          outputOffset = 'after';\n          offset = childNodes.length - 1;\n        } else {\n          outputOffset = 'before';\n        }\n        container = childNodes[offset];\n      }\n      path.push(createPathItem(container));\n      parents = parentsUntil(root, container);\n      parents = ArrUtils.filter(parents, not(NodeType.isBogus));\n      path = path.concat(ArrUtils.map(parents, function (node) {\n        return createPathItem(node);\n      }));\n      return path.reverse().join('/') + ',' + outputOffset;\n    };\n    var resolvePathItem = function (node, name, index) {\n      var nodes = getChildNodes(node);\n      nodes = ArrUtils.filter(nodes, function (node, index) {\n        return !isText$5(node) || !isText$5(nodes[index - 1]);\n      });\n      nodes = ArrUtils.filter(nodes, NodeType.matchNodeNames(name));\n      return nodes[index];\n    };\n    var findTextPosition = function (container, offset) {\n      var node = container, targetOffset = 0, dataLen;\n      while (isText$5(node)) {\n        dataLen = node.data.length;\n        if (offset >= targetOffset && offset <= targetOffset + dataLen) {\n          container = node;\n          offset = offset - targetOffset;\n          break;\n        }\n        if (!isText$5(node.nextSibling)) {\n          container = node;\n          offset = dataLen;\n          break;\n        }\n        targetOffset += dataLen;\n        node = node.nextSibling;\n      }\n      if (isText$5(container) && offset > container.data.length) {\n        offset = container.data.length;\n      }\n      return CaretPosition$1(container, offset);\n    };\n    var resolve$2 = function (root, path) {\n      var parts, container, offset;\n      if (!path) {\n        return null;\n      }\n      parts = path.split(',');\n      path = parts[0].split('/');\n      offset = parts.length > 1 ? parts[1] : 'before';\n      container = ArrUtils.reduce(path, function (result, value) {\n        value = /([\\w\\-\\(\\)]+)\\[([0-9]+)\\]/.exec(value);\n        if (!value) {\n          return null;\n        }\n        if (value[1] === 'text()') {\n          value[1] = '#text';\n        }\n        return resolvePathItem(result, value[1], parseInt(value[2], 10));\n      }, root);\n      if (!container) {\n        return null;\n      }\n      if (!isText$5(container)) {\n        if (offset === 'after') {\n          offset = nodeIndex$1(container) + 1;\n        } else {\n          offset = nodeIndex$1(container);\n        }\n        return CaretPosition$1(container.parentNode, offset);\n      }\n      return findTextPosition(container, parseInt(offset, 10));\n    };\n\n    var trimEmptyTextNode = function (dom, node) {\n      if (NodeType.isText(node) && node.data.length === 0) {\n        dom.remove(node);\n      }\n    };\n    var insertNode = function (dom, rng, node) {\n      rng.insertNode(node);\n      trimEmptyTextNode(dom, node.previousSibling);\n      trimEmptyTextNode(dom, node.nextSibling);\n    };\n    var insertFragment = function (dom, rng, frag) {\n      var firstChild = Option.from(frag.firstChild);\n      var lastChild = Option.from(frag.lastChild);\n      rng.insertNode(frag);\n      firstChild.each(function (child) {\n        return trimEmptyTextNode(dom, child.previousSibling);\n      });\n      lastChild.each(function (child) {\n        return trimEmptyTextNode(dom, child.nextSibling);\n      });\n    };\n    var rangeInsertNode = function (dom, rng, node) {\n      if (NodeType.isDocumentFragment(node)) {\n        insertFragment(dom, rng, node);\n      } else {\n        insertNode(dom, rng, node);\n      }\n    };\n\n    var isContentEditableFalse$2 = NodeType.isContentEditableFalse;\n    var getNormalizedTextOffset = function (trim, container, offset) {\n      var node, trimmedOffset;\n      trimmedOffset = trim(container.data.slice(0, offset)).length;\n      for (node = container.previousSibling; node && NodeType.isText(node); node = node.previousSibling) {\n        trimmedOffset += trim(node.data).length;\n      }\n      return trimmedOffset;\n    };\n    var getPoint = function (dom, trim, normalized, rng, start) {\n      var container = rng[start ? 'startContainer' : 'endContainer'];\n      var offset = rng[start ? 'startOffset' : 'endOffset'];\n      var point = [];\n      var childNodes, after = 0;\n      var root = dom.getRoot();\n      if (NodeType.isText(container)) {\n        point.push(normalized ? getNormalizedTextOffset(trim, container, offset) : offset);\n      } else {\n        childNodes = container.childNodes;\n        if (offset >= childNodes.length && childNodes.length) {\n          after = 1;\n          offset = Math.max(0, childNodes.length - 1);\n        }\n        point.push(dom.nodeIndex(childNodes[offset], normalized) + after);\n      }\n      for (; container && container !== root; container = container.parentNode) {\n        point.push(dom.nodeIndex(container, normalized));\n      }\n      return point;\n    };\n    var getLocation = function (trim, selection, normalized, rng) {\n      var dom = selection.dom, bookmark = {};\n      bookmark.start = getPoint(dom, trim, normalized, rng, true);\n      if (!selection.isCollapsed()) {\n        bookmark.end = getPoint(dom, trim, normalized, rng, false);\n      }\n      return bookmark;\n    };\n    var findIndex$2 = function (dom, name, element) {\n      var count = 0;\n      Tools.each(dom.select(name), function (node) {\n        if (node.getAttribute('data-mce-bogus') === 'all') {\n          return;\n        }\n        if (node === element) {\n          return false;\n        }\n        count++;\n      });\n      return count;\n    };\n    var moveEndPoint = function (rng, start) {\n      var container, offset, childNodes;\n      var prefix = start ? 'start' : 'end';\n      container = rng[prefix + 'Container'];\n      offset = rng[prefix + 'Offset'];\n      if (NodeType.isElement(container) && container.nodeName === 'TR') {\n        childNodes = container.childNodes;\n        container = childNodes[Math.min(start ? offset : offset - 1, childNodes.length - 1)];\n        if (container) {\n          offset = start ? 0 : container.childNodes.length;\n          rng['set' + (start ? 'Start' : 'End')](container, offset);\n        }\n      }\n    };\n    var normalizeTableCellSelection = function (rng) {\n      moveEndPoint(rng, true);\n      moveEndPoint(rng, false);\n      return rng;\n    };\n    var findSibling = function (node, offset) {\n      var sibling;\n      if (NodeType.isElement(node)) {\n        node = getNode(node, offset);\n        if (isContentEditableFalse$2(node)) {\n          return node;\n        }\n      }\n      if (isCaretContainer(node)) {\n        if (NodeType.isText(node) && isCaretContainerBlock(node)) {\n          node = node.parentNode;\n        }\n        sibling = node.previousSibling;\n        if (isContentEditableFalse$2(sibling)) {\n          return sibling;\n        }\n        sibling = node.nextSibling;\n        if (isContentEditableFalse$2(sibling)) {\n          return sibling;\n        }\n      }\n    };\n    var findAdjacentContentEditableFalseElm = function (rng) {\n      return findSibling(rng.startContainer, rng.startOffset) || findSibling(rng.endContainer, rng.endOffset);\n    };\n    var getOffsetBookmark = function (trim, normalized, selection) {\n      var element = selection.getNode();\n      var name = element ? element.nodeName : null;\n      var rng = selection.getRng();\n      if (isContentEditableFalse$2(element) || name === 'IMG') {\n        return {\n          name: name,\n          index: findIndex$2(selection.dom, name, element)\n        };\n      }\n      var sibling = findAdjacentContentEditableFalseElm(rng);\n      if (sibling) {\n        name = sibling.tagName;\n        return {\n          name: name,\n          index: findIndex$2(selection.dom, name, sibling)\n        };\n      }\n      return getLocation(trim, selection, normalized, rng);\n    };\n    var getCaretBookmark = function (selection) {\n      var rng = selection.getRng();\n      return {\n        start: create$2(selection.dom.getRoot(), CaretPosition$1.fromRangeStart(rng)),\n        end: create$2(selection.dom.getRoot(), CaretPosition$1.fromRangeEnd(rng))\n      };\n    };\n    var getRangeBookmark = function (selection) {\n      return { rng: selection.getRng() };\n    };\n    var createBookmarkSpan = function (dom, id, filled) {\n      var args = {\n        'data-mce-type': 'bookmark',\n        'id': id,\n        'style': 'overflow:hidden;line-height:0px'\n      };\n      return filled ? dom.create('span', args, '&#xFEFF;') : dom.create('span', args);\n    };\n    var getPersistentBookmark = function (selection, filled) {\n      var dom = selection.dom;\n      var rng = selection.getRng();\n      var id = dom.uniqueId();\n      var collapsed = selection.isCollapsed();\n      var element = selection.getNode();\n      var name = element.nodeName;\n      if (name === 'IMG') {\n        return {\n          name: name,\n          index: findIndex$2(dom, name, element)\n        };\n      }\n      var rng2 = normalizeTableCellSelection(rng.cloneRange());\n      if (!collapsed) {\n        rng2.collapse(false);\n        var endBookmarkNode = createBookmarkSpan(dom, id + '_end', filled);\n        rangeInsertNode(dom, rng2, endBookmarkNode);\n      }\n      rng = normalizeTableCellSelection(rng);\n      rng.collapse(true);\n      var startBookmarkNode = createBookmarkSpan(dom, id + '_start', filled);\n      rangeInsertNode(dom, rng, startBookmarkNode);\n      selection.moveToBookmark({\n        id: id,\n        keep: 1\n      });\n      return { id: id };\n    };\n    var getBookmark = function (selection, type, normalized) {\n      if (type === 2) {\n        return getOffsetBookmark(Zwsp.trim, normalized, selection);\n      } else if (type === 3) {\n        return getCaretBookmark(selection);\n      } else if (type) {\n        return getRangeBookmark(selection);\n      } else {\n        return getPersistentBookmark(selection, false);\n      }\n    };\n    var GetBookmark = {\n      getBookmark: getBookmark,\n      getUndoBookmark: curry(getOffsetBookmark, identity, true),\n      getPersistentBookmark: getPersistentBookmark\n    };\n\n    var CARET_ID = '_mce_caret';\n    var isCaretNode = function (node) {\n      return NodeType.isElement(node) && node.id === CARET_ID;\n    };\n    var getParentCaretContainer = function (body, node) {\n      while (node && node !== body) {\n        if (node.id === CARET_ID) {\n          return node;\n        }\n        node = node.parentNode;\n      }\n      return null;\n    };\n\n    var isElement$4 = NodeType.isElement;\n    var isText$6 = NodeType.isText;\n    var removeNode = function (node) {\n      var parentNode = node.parentNode;\n      if (parentNode) {\n        parentNode.removeChild(node);\n      }\n    };\n    var getNodeValue = function (node) {\n      try {\n        return node.nodeValue;\n      } catch (ex) {\n        return '';\n      }\n    };\n    var setNodeValue = function (node, text) {\n      if (text.length === 0) {\n        removeNode(node);\n      } else {\n        node.nodeValue = text;\n      }\n    };\n    var trimCount = function (text) {\n      var trimmedText = Zwsp.trim(text);\n      return {\n        count: text.length - trimmedText.length,\n        text: trimmedText\n      };\n    };\n    var removeUnchanged = function (caretContainer, pos) {\n      remove$5(caretContainer);\n      return pos;\n    };\n    var removeTextAndReposition = function (caretContainer, pos) {\n      var before = trimCount(caretContainer.data.substr(0, pos.offset()));\n      var after = trimCount(caretContainer.data.substr(pos.offset()));\n      var text = before.text + after.text;\n      if (text.length > 0) {\n        setNodeValue(caretContainer, text);\n        return CaretPosition$1(caretContainer, pos.offset() - before.count);\n      } else {\n        return pos;\n      }\n    };\n    var removeElementAndReposition = function (caretContainer, pos) {\n      var parentNode = pos.container();\n      var newPosition = indexOf(from$1(parentNode.childNodes), caretContainer).map(function (index) {\n        return index < pos.offset() ? CaretPosition$1(parentNode, pos.offset() - 1) : pos;\n      }).getOr(pos);\n      remove$5(caretContainer);\n      return newPosition;\n    };\n    var removeTextCaretContainer = function (caretContainer, pos) {\n      return isText$6(caretContainer) && pos.container() === caretContainer ? removeTextAndReposition(caretContainer, pos) : removeUnchanged(caretContainer, pos);\n    };\n    var removeElementCaretContainer = function (caretContainer, pos) {\n      return pos.container() === caretContainer.parentNode ? removeElementAndReposition(caretContainer, pos) : removeUnchanged(caretContainer, pos);\n    };\n    var removeAndReposition = function (container, pos) {\n      return CaretPosition$1.isTextPosition(pos) ? removeTextCaretContainer(container, pos) : removeElementCaretContainer(container, pos);\n    };\n    var remove$5 = function (caretContainerNode) {\n      if (isElement$4(caretContainerNode) && isCaretContainer(caretContainerNode)) {\n        if (hasContent(caretContainerNode)) {\n          caretContainerNode.removeAttribute('data-mce-caret');\n        } else {\n          removeNode(caretContainerNode);\n        }\n      }\n      if (isText$6(caretContainerNode)) {\n        var text = Zwsp.trim(getNodeValue(caretContainerNode));\n        setNodeValue(caretContainerNode, text);\n      }\n    };\n    var CaretContainerRemove = {\n      removeAndReposition: removeAndReposition,\n      remove: remove$5\n    };\n\n    var browser$2 = PlatformDetection$1.detect().browser;\n    var isContentEditableFalse$3 = NodeType.isContentEditableFalse;\n    var isTableCell$1 = function (node) {\n      return NodeType.isElement(node) && /^(TD|TH)$/i.test(node.tagName);\n    };\n    var getAbsoluteClientRect = function (root, element, before) {\n      var clientRect = collapse(element.getBoundingClientRect(), before);\n      var docElm, scrollX, scrollY, margin, rootRect;\n      if (root.tagName === 'BODY') {\n        docElm = root.ownerDocument.documentElement;\n        scrollX = root.scrollLeft || docElm.scrollLeft;\n        scrollY = root.scrollTop || docElm.scrollTop;\n      } else {\n        rootRect = root.getBoundingClientRect();\n        scrollX = root.scrollLeft - rootRect.left;\n        scrollY = root.scrollTop - rootRect.top;\n      }\n      clientRect.left += scrollX;\n      clientRect.right += scrollX;\n      clientRect.top += scrollY;\n      clientRect.bottom += scrollY;\n      clientRect.width = 1;\n      margin = element.offsetWidth - element.clientWidth;\n      if (margin > 0) {\n        if (before) {\n          margin *= -1;\n        }\n        clientRect.left += margin;\n        clientRect.right += margin;\n      }\n      return clientRect;\n    };\n    var trimInlineCaretContainers = function (root) {\n      var contentEditableFalseNodes, node, sibling, i, data;\n      contentEditableFalseNodes = DomQuery('*[contentEditable=false]', root);\n      for (i = 0; i < contentEditableFalseNodes.length; i++) {\n        node = contentEditableFalseNodes[i];\n        sibling = node.previousSibling;\n        if (endsWithCaretContainer(sibling)) {\n          data = sibling.data;\n          if (data.length === 1) {\n            sibling.parentNode.removeChild(sibling);\n          } else {\n            sibling.deleteData(data.length - 1, 1);\n          }\n        }\n        sibling = node.nextSibling;\n        if (startsWithCaretContainer(sibling)) {\n          data = sibling.data;\n          if (data.length === 1) {\n            sibling.parentNode.removeChild(sibling);\n          } else {\n            sibling.deleteData(0, 1);\n          }\n        }\n      }\n    };\n    var FakeCaret = function (root, isBlock, hasFocus) {\n      var lastVisualCaret = Cell(Option.none());\n      var cursorInterval, caretContainerNode;\n      var show = function (before, element) {\n        var clientRect, rng;\n        hide();\n        if (isTableCell$1(element)) {\n          return null;\n        }\n        if (isBlock(element)) {\n          caretContainerNode = insertBlock('p', element, before);\n          clientRect = getAbsoluteClientRect(root, element, before);\n          DomQuery(caretContainerNode).css('top', clientRect.top);\n          var caret = DomQuery('<div class=\"mce-visual-caret\" data-mce-bogus=\"all\"></div>').css(clientRect).appendTo(root)[0];\n          lastVisualCaret.set(Option.some({\n            caret: caret,\n            element: element,\n            before: before\n          }));\n          lastVisualCaret.get().each(function (caretState) {\n            if (before) {\n              DomQuery(caretState.caret).addClass('mce-visual-caret-before');\n            }\n          });\n          startBlink();\n          rng = element.ownerDocument.createRange();\n          rng.setStart(caretContainerNode, 0);\n          rng.setEnd(caretContainerNode, 0);\n        } else {\n          caretContainerNode = insertInline(element, before);\n          rng = element.ownerDocument.createRange();\n          if (isContentEditableFalse$3(caretContainerNode.nextSibling)) {\n            rng.setStart(caretContainerNode, 0);\n            rng.setEnd(caretContainerNode, 0);\n          } else {\n            rng.setStart(caretContainerNode, 1);\n            rng.setEnd(caretContainerNode, 1);\n          }\n          return rng;\n        }\n        return rng;\n      };\n      var hide = function () {\n        trimInlineCaretContainers(root);\n        if (caretContainerNode) {\n          CaretContainerRemove.remove(caretContainerNode);\n          caretContainerNode = null;\n        }\n        lastVisualCaret.get().each(function (caretState) {\n          DomQuery(caretState.caret).remove();\n          lastVisualCaret.set(Option.none());\n        });\n        clearInterval(cursorInterval);\n      };\n      var startBlink = function () {\n        cursorInterval = Delay.setInterval(function () {\n          if (hasFocus()) {\n            DomQuery('div.mce-visual-caret', root).toggleClass('mce-visual-caret-hidden');\n          } else {\n            DomQuery('div.mce-visual-caret', root).addClass('mce-visual-caret-hidden');\n          }\n        }, 500);\n      };\n      var reposition = function () {\n        lastVisualCaret.get().each(function (caretState) {\n          var clientRect = getAbsoluteClientRect(root, caretState.element, caretState.before);\n          DomQuery(caretState.caret).css(clientRect);\n        });\n      };\n      var destroy = function () {\n        return Delay.clearInterval(cursorInterval);\n      };\n      var getCss = function () {\n        return '.mce-visual-caret {' + 'position: absolute;' + 'background-color: black;' + 'background-color: currentcolor;' + '}' + '.mce-visual-caret-hidden {' + 'display: none;' + '}' + '*[data-mce-caret] {' + 'position: absolute;' + 'left: -1000px;' + 'right: auto;' + 'top: 0;' + 'margin: 0;' + 'padding: 0;' + '}';\n      };\n      return {\n        show: show,\n        hide: hide,\n        getCss: getCss,\n        reposition: reposition,\n        destroy: destroy\n      };\n    };\n    var isFakeCaretTableBrowser = function () {\n      return browser$2.isIE() || browser$2.isEdge() || browser$2.isFirefox();\n    };\n    var isFakeCaretTarget = function (node) {\n      return isContentEditableFalse$3(node) || NodeType.isTable(node) && isFakeCaretTableBrowser();\n    };\n\n    var isContentEditableFalse$4 = NodeType.isContentEditableFalse;\n    var isBlockLike = NodeType.matchStyleValues('display', 'block table table-cell table-caption list-item');\n    var isCaretContainer$2 = isCaretContainer;\n    var isCaretContainerBlock$1 = isCaretContainerBlock;\n    var isElement$5 = NodeType.isElement;\n    var isCaretCandidate$2 = isCaretCandidate;\n    var isForwards = function (direction) {\n      return direction > 0;\n    };\n    var isBackwards = function (direction) {\n      return direction < 0;\n    };\n    var skipCaretContainers = function (walk, shallow) {\n      var node;\n      while (node = walk(shallow)) {\n        if (!isCaretContainerBlock$1(node)) {\n          return node;\n        }\n      }\n      return null;\n    };\n    var findNode = function (node, direction, predicateFn, rootNode, shallow) {\n      var walker = new TreeWalker(node, rootNode);\n      if (isBackwards(direction)) {\n        if (isContentEditableFalse$4(node) || isCaretContainerBlock$1(node)) {\n          node = skipCaretContainers(walker.prev, true);\n          if (predicateFn(node)) {\n            return node;\n          }\n        }\n        while (node = skipCaretContainers(walker.prev, shallow)) {\n          if (predicateFn(node)) {\n            return node;\n          }\n        }\n      }\n      if (isForwards(direction)) {\n        if (isContentEditableFalse$4(node) || isCaretContainerBlock$1(node)) {\n          node = skipCaretContainers(walker.next, true);\n          if (predicateFn(node)) {\n            return node;\n          }\n        }\n        while (node = skipCaretContainers(walker.next, shallow)) {\n          if (predicateFn(node)) {\n            return node;\n          }\n        }\n      }\n      return null;\n    };\n    var getParentBlock = function (node, rootNode) {\n      while (node && node !== rootNode) {\n        if (isBlockLike(node)) {\n          return node;\n        }\n        node = node.parentNode;\n      }\n      return null;\n    };\n    var isInSameBlock = function (caretPosition1, caretPosition2, rootNode) {\n      return getParentBlock(caretPosition1.container(), rootNode) === getParentBlock(caretPosition2.container(), rootNode);\n    };\n    var getChildNodeAtRelativeOffset = function (relativeOffset, caretPosition) {\n      var container, offset;\n      if (!caretPosition) {\n        return null;\n      }\n      container = caretPosition.container();\n      offset = caretPosition.offset();\n      if (!isElement$5(container)) {\n        return null;\n      }\n      return container.childNodes[offset + relativeOffset];\n    };\n    var beforeAfter = function (before, node) {\n      var range = node.ownerDocument.createRange();\n      if (before) {\n        range.setStartBefore(node);\n        range.setEndBefore(node);\n      } else {\n        range.setStartAfter(node);\n        range.setEndAfter(node);\n      }\n      return range;\n    };\n    var isNodesInSameBlock = function (root, node1, node2) {\n      return getParentBlock(node1, root) === getParentBlock(node2, root);\n    };\n    var lean = function (left, root, node) {\n      var sibling, siblingName;\n      if (left) {\n        siblingName = 'previousSibling';\n      } else {\n        siblingName = 'nextSibling';\n      }\n      while (node && node !== root) {\n        sibling = node[siblingName];\n        if (isCaretContainer$2(sibling)) {\n          sibling = sibling[siblingName];\n        }\n        if (isContentEditableFalse$4(sibling)) {\n          if (isNodesInSameBlock(root, sibling, node)) {\n            return sibling;\n          }\n          break;\n        }\n        if (isCaretCandidate$2(sibling)) {\n          break;\n        }\n        node = node.parentNode;\n      }\n      return null;\n    };\n    var before$2 = curry(beforeAfter, true);\n    var after$1 = curry(beforeAfter, false);\n    var normalizeRange = function (direction, root, range) {\n      var node, container, offset, location;\n      var leanLeft = curry(lean, true, root);\n      var leanRight = curry(lean, false, root);\n      container = range.startContainer;\n      offset = range.startOffset;\n      if (isCaretContainerBlock(container)) {\n        if (!isElement$5(container)) {\n          container = container.parentNode;\n        }\n        location = container.getAttribute('data-mce-caret');\n        if (location === 'before') {\n          node = container.nextSibling;\n          if (isFakeCaretTarget(node)) {\n            return before$2(node);\n          }\n        }\n        if (location === 'after') {\n          node = container.previousSibling;\n          if (isFakeCaretTarget(node)) {\n            return after$1(node);\n          }\n        }\n      }\n      if (!range.collapsed) {\n        return range;\n      }\n      if (NodeType.isText(container)) {\n        if (isCaretContainer$2(container)) {\n          if (direction === 1) {\n            node = leanRight(container);\n            if (node) {\n              return before$2(node);\n            }\n            node = leanLeft(container);\n            if (node) {\n              return after$1(node);\n            }\n          }\n          if (direction === -1) {\n            node = leanLeft(container);\n            if (node) {\n              return after$1(node);\n            }\n            node = leanRight(container);\n            if (node) {\n              return before$2(node);\n            }\n          }\n          return range;\n        }\n        if (endsWithCaretContainer(container) && offset >= container.data.length - 1) {\n          if (direction === 1) {\n            node = leanRight(container);\n            if (node) {\n              return before$2(node);\n            }\n          }\n          return range;\n        }\n        if (startsWithCaretContainer(container) && offset <= 1) {\n          if (direction === -1) {\n            node = leanLeft(container);\n            if (node) {\n              return after$1(node);\n            }\n          }\n          return range;\n        }\n        if (offset === container.data.length) {\n          node = leanRight(container);\n          if (node) {\n            return before$2(node);\n          }\n          return range;\n        }\n        if (offset === 0) {\n          node = leanLeft(container);\n          if (node) {\n            return after$1(node);\n          }\n          return range;\n        }\n      }\n      return range;\n    };\n    var getRelativeCefElm = function (forward, caretPosition) {\n      return Option.from(getChildNodeAtRelativeOffset(forward ? 0 : -1, caretPosition)).filter(isContentEditableFalse$4);\n    };\n    var getNormalizedRangeEndPoint = function (direction, root, range) {\n      var normalizedRange = normalizeRange(direction, root, range);\n      if (direction === -1) {\n        return CaretPosition.fromRangeStart(normalizedRange);\n      }\n      return CaretPosition.fromRangeEnd(normalizedRange);\n    };\n    var getElementFromPosition = function (pos) {\n      return Option.from(pos.getNode()).map(Element.fromDom);\n    };\n    var getElementFromPrevPosition = function (pos) {\n      return Option.from(pos.getNode(true)).map(Element.fromDom);\n    };\n    var getVisualCaretPosition = function (walkFn, caretPosition) {\n      while (caretPosition = walkFn(caretPosition)) {\n        if (caretPosition.isVisible()) {\n          return caretPosition;\n        }\n      }\n      return caretPosition;\n    };\n    var isMoveInsideSameBlock = function (from, to) {\n      var inSameBlock = isInSameBlock(from, to);\n      if (!inSameBlock && NodeType.isBr(from.getNode())) {\n        return true;\n      }\n      return inSameBlock;\n    };\n\n    var HDirection;\n    (function (HDirection) {\n      HDirection[HDirection['Backwards'] = -1] = 'Backwards';\n      HDirection[HDirection['Forwards'] = 1] = 'Forwards';\n    }(HDirection || (HDirection = {})));\n    var isContentEditableFalse$5 = NodeType.isContentEditableFalse;\n    var isText$7 = NodeType.isText;\n    var isElement$6 = NodeType.isElement;\n    var isBr$4 = NodeType.isBr;\n    var isCaretCandidate$3 = isCaretCandidate;\n    var isAtomic$1 = isAtomic;\n    var isEditableCaretCandidate$1 = isEditableCaretCandidate;\n    var getParents = function (node, root) {\n      var parents = [];\n      while (node && node !== root) {\n        parents.push(node);\n        node = node.parentNode;\n      }\n      return parents;\n    };\n    var nodeAtIndex = function (container, offset) {\n      if (container.hasChildNodes() && offset < container.childNodes.length) {\n        return container.childNodes[offset];\n      }\n      return null;\n    };\n    var getCaretCandidatePosition = function (direction, node) {\n      if (isForwards(direction)) {\n        if (isCaretCandidate$3(node.previousSibling) && !isText$7(node.previousSibling)) {\n          return CaretPosition$1.before(node);\n        }\n        if (isText$7(node)) {\n          return CaretPosition$1(node, 0);\n        }\n      }\n      if (isBackwards(direction)) {\n        if (isCaretCandidate$3(node.nextSibling) && !isText$7(node.nextSibling)) {\n          return CaretPosition$1.after(node);\n        }\n        if (isText$7(node)) {\n          return CaretPosition$1(node, node.data.length);\n        }\n      }\n      if (isBackwards(direction)) {\n        if (isBr$4(node)) {\n          return CaretPosition$1.before(node);\n        }\n        return CaretPosition$1.after(node);\n      }\n      return CaretPosition$1.before(node);\n    };\n    var moveForwardFromBr = function (root, nextNode) {\n      var nextSibling = nextNode.nextSibling;\n      if (nextSibling && isCaretCandidate$3(nextSibling)) {\n        if (isText$7(nextSibling)) {\n          return CaretPosition$1(nextSibling, 0);\n        } else {\n          return CaretPosition$1.before(nextSibling);\n        }\n      } else {\n        return findCaretPosition(HDirection.Forwards, CaretPosition$1.after(nextNode), root);\n      }\n    };\n    var findCaretPosition = function (direction, startPos, root) {\n      var node, nextNode, innerNode;\n      var rootContentEditableFalseElm, caretPosition;\n      if (!isElement$6(root) || !startPos) {\n        return null;\n      }\n      if (startPos.isEqual(CaretPosition$1.after(root)) && root.lastChild) {\n        caretPosition = CaretPosition$1.after(root.lastChild);\n        if (isBackwards(direction) && isCaretCandidate$3(root.lastChild) && isElement$6(root.lastChild)) {\n          return isBr$4(root.lastChild) ? CaretPosition$1.before(root.lastChild) : caretPosition;\n        }\n      } else {\n        caretPosition = startPos;\n      }\n      var container = caretPosition.container();\n      var offset = caretPosition.offset();\n      if (isText$7(container)) {\n        if (isBackwards(direction) && offset > 0) {\n          return CaretPosition$1(container, --offset);\n        }\n        if (isForwards(direction) && offset < container.length) {\n          return CaretPosition$1(container, ++offset);\n        }\n        node = container;\n      } else {\n        if (isBackwards(direction) && offset > 0) {\n          nextNode = nodeAtIndex(container, offset - 1);\n          if (isCaretCandidate$3(nextNode)) {\n            if (!isAtomic$1(nextNode)) {\n              innerNode = findNode(nextNode, direction, isEditableCaretCandidate$1, nextNode);\n              if (innerNode) {\n                if (isText$7(innerNode)) {\n                  return CaretPosition$1(innerNode, innerNode.data.length);\n                }\n                return CaretPosition$1.after(innerNode);\n              }\n            }\n            if (isText$7(nextNode)) {\n              return CaretPosition$1(nextNode, nextNode.data.length);\n            }\n            return CaretPosition$1.before(nextNode);\n          }\n        }\n        if (isForwards(direction) && offset < container.childNodes.length) {\n          nextNode = nodeAtIndex(container, offset);\n          if (isCaretCandidate$3(nextNode)) {\n            if (isBr$4(nextNode)) {\n              return moveForwardFromBr(root, nextNode);\n            }\n            if (!isAtomic$1(nextNode)) {\n              innerNode = findNode(nextNode, direction, isEditableCaretCandidate$1, nextNode);\n              if (innerNode) {\n                if (isText$7(innerNode)) {\n                  return CaretPosition$1(innerNode, 0);\n                }\n                return CaretPosition$1.before(innerNode);\n              }\n            }\n            if (isText$7(nextNode)) {\n              return CaretPosition$1(nextNode, 0);\n            }\n            return CaretPosition$1.after(nextNode);\n          }\n        }\n        node = nextNode ? nextNode : caretPosition.getNode();\n      }\n      if (isForwards(direction) && caretPosition.isAtEnd() || isBackwards(direction) && caretPosition.isAtStart()) {\n        node = findNode(node, direction, constant(true), root, true);\n        if (isEditableCaretCandidate$1(node, root)) {\n          return getCaretCandidatePosition(direction, node);\n        }\n      }\n      nextNode = findNode(node, direction, isEditableCaretCandidate$1, root);\n      rootContentEditableFalseElm = ArrUtils.last(filter(getParents(container, root), isContentEditableFalse$5));\n      if (rootContentEditableFalseElm && (!nextNode || !rootContentEditableFalseElm.contains(nextNode))) {\n        if (isForwards(direction)) {\n          caretPosition = CaretPosition$1.after(rootContentEditableFalseElm);\n        } else {\n          caretPosition = CaretPosition$1.before(rootContentEditableFalseElm);\n        }\n        return caretPosition;\n      }\n      if (nextNode) {\n        return getCaretCandidatePosition(direction, nextNode);\n      }\n      return null;\n    };\n    var CaretWalker = function (root) {\n      return {\n        next: function (caretPosition) {\n          return findCaretPosition(HDirection.Forwards, caretPosition, root);\n        },\n        prev: function (caretPosition) {\n          return findCaretPosition(HDirection.Backwards, caretPosition, root);\n        }\n      };\n    };\n\n    var walkToPositionIn = function (forward, root, start) {\n      var position = forward ? CaretPosition$1.before(start) : CaretPosition$1.after(start);\n      return fromPosition(forward, root, position);\n    };\n    var afterElement = function (node) {\n      return NodeType.isBr(node) ? CaretPosition$1.before(node) : CaretPosition$1.after(node);\n    };\n    var isBeforeOrStart = function (position) {\n      if (CaretPosition$1.isTextPosition(position)) {\n        return position.offset() === 0;\n      } else {\n        return isCaretCandidate(position.getNode());\n      }\n    };\n    var isAfterOrEnd = function (position) {\n      if (CaretPosition$1.isTextPosition(position)) {\n        var container = position.container();\n        return position.offset() === container.data.length;\n      } else {\n        return isCaretCandidate(position.getNode(true));\n      }\n    };\n    var isBeforeAfterSameElement = function (from, to) {\n      return !CaretPosition$1.isTextPosition(from) && !CaretPosition$1.isTextPosition(to) && from.getNode() === to.getNode(true);\n    };\n    var isAtBr = function (position) {\n      return !CaretPosition$1.isTextPosition(position) && NodeType.isBr(position.getNode());\n    };\n    var shouldSkipPosition = function (forward, from, to) {\n      if (forward) {\n        return !isBeforeAfterSameElement(from, to) && !isAtBr(from) && isAfterOrEnd(from) && isBeforeOrStart(to);\n      } else {\n        return !isBeforeAfterSameElement(to, from) && isBeforeOrStart(from) && isAfterOrEnd(to);\n      }\n    };\n    var fromPosition = function (forward, root, pos) {\n      var walker = CaretWalker(root);\n      return Option.from(forward ? walker.next(pos) : walker.prev(pos));\n    };\n    var navigate = function (forward, root, from) {\n      return fromPosition(forward, root, from).bind(function (to) {\n        if (isInSameBlock(from, to, root) && shouldSkipPosition(forward, from, to)) {\n          return fromPosition(forward, root, to);\n        } else {\n          return Option.some(to);\n        }\n      });\n    };\n    var navigateIgnore = function (forward, root, from, ignoreFilter) {\n      return navigate(forward, root, from).bind(function (pos) {\n        return ignoreFilter(pos) ? navigateIgnore(forward, root, pos, ignoreFilter) : Option.some(pos);\n      });\n    };\n    var positionIn = function (forward, element) {\n      var startNode = forward ? element.firstChild : element.lastChild;\n      if (NodeType.isText(startNode)) {\n        return Option.some(CaretPosition$1(startNode, forward ? 0 : startNode.data.length));\n      } else if (startNode) {\n        if (isCaretCandidate(startNode)) {\n          return Option.some(forward ? CaretPosition$1.before(startNode) : afterElement(startNode));\n        } else {\n          return walkToPositionIn(forward, element, startNode);\n        }\n      } else {\n        return Option.none();\n      }\n    };\n    var nextPosition = curry(fromPosition, true);\n    var prevPosition = curry(fromPosition, false);\n    var CaretFinder = {\n      fromPosition: fromPosition,\n      nextPosition: nextPosition,\n      prevPosition: prevPosition,\n      navigate: navigate,\n      navigateIgnore: navigateIgnore,\n      positionIn: positionIn,\n      firstPositionIn: curry(positionIn, true),\n      lastPositionIn: curry(positionIn, false)\n    };\n\n    var isStringPathBookmark = function (bookmark) {\n      return typeof bookmark.start === 'string';\n    };\n    var isRangeBookmark = function (bookmark) {\n      return bookmark.hasOwnProperty('rng');\n    };\n    var isIdBookmark = function (bookmark) {\n      return bookmark.hasOwnProperty('id');\n    };\n    var isIndexBookmark = function (bookmark) {\n      return bookmark.hasOwnProperty('name');\n    };\n    var isPathBookmark = function (bookmark) {\n      return Tools.isArray(bookmark.start);\n    };\n\n    var addBogus = function (dom, node) {\n      if (NodeType.isElement(node) && dom.isBlock(node) && !node.innerHTML && !Env.ie) {\n        node.innerHTML = '<br data-mce-bogus=\"1\" />';\n      }\n      return node;\n    };\n    var resolveCaretPositionBookmark = function (dom, bookmark) {\n      var rng, pos;\n      rng = dom.createRng();\n      pos = resolve$2(dom.getRoot(), bookmark.start);\n      rng.setStart(pos.container(), pos.offset());\n      pos = resolve$2(dom.getRoot(), bookmark.end);\n      rng.setEnd(pos.container(), pos.offset());\n      return rng;\n    };\n    var insertZwsp = function (node, rng) {\n      var textNode = node.ownerDocument.createTextNode(Zwsp.ZWSP);\n      node.appendChild(textNode);\n      rng.setStart(textNode, 0);\n      rng.setEnd(textNode, 0);\n    };\n    var isEmpty = function (node) {\n      return node.hasChildNodes() === false;\n    };\n    var tryFindRangePosition = function (node, rng) {\n      return CaretFinder.lastPositionIn(node).fold(function () {\n        return false;\n      }, function (pos) {\n        rng.setStart(pos.container(), pos.offset());\n        rng.setEnd(pos.container(), pos.offset());\n        return true;\n      });\n    };\n    var padEmptyCaretContainer = function (root, node, rng) {\n      if (isEmpty(node) && getParentCaretContainer(root, node)) {\n        insertZwsp(node, rng);\n        return true;\n      } else {\n        return false;\n      }\n    };\n    var setEndPoint = function (dom, start, bookmark, rng) {\n      var point = bookmark[start ? 'start' : 'end'];\n      var i, node, offset, children;\n      var root = dom.getRoot();\n      if (point) {\n        offset = point[0];\n        for (node = root, i = point.length - 1; i >= 1; i--) {\n          children = node.childNodes;\n          if (padEmptyCaretContainer(root, node, rng)) {\n            return true;\n          }\n          if (point[i] > children.length - 1) {\n            if (padEmptyCaretContainer(root, node, rng)) {\n              return true;\n            }\n            return tryFindRangePosition(node, rng);\n          }\n          node = children[point[i]];\n        }\n        if (node.nodeType === 3) {\n          offset = Math.min(point[0], node.nodeValue.length);\n        }\n        if (node.nodeType === 1) {\n          offset = Math.min(point[0], node.childNodes.length);\n        }\n        if (start) {\n          rng.setStart(node, offset);\n        } else {\n          rng.setEnd(node, offset);\n        }\n      }\n      return true;\n    };\n    var isValidTextNode = function (node) {\n      return NodeType.isText(node) && node.data.length > 0;\n    };\n    var restoreEndPoint = function (dom, suffix, bookmark) {\n      var marker = dom.get(bookmark.id + '_' + suffix), node, idx, next, prev;\n      var keep = bookmark.keep;\n      var container, offset;\n      if (marker) {\n        node = marker.parentNode;\n        if (suffix === 'start') {\n          if (!keep) {\n            idx = dom.nodeIndex(marker);\n          } else {\n            if (marker.hasChildNodes()) {\n              node = marker.firstChild;\n              idx = 1;\n            } else if (isValidTextNode(marker.nextSibling)) {\n              node = marker.nextSibling;\n              idx = 0;\n            } else if (isValidTextNode(marker.previousSibling)) {\n              node = marker.previousSibling;\n              idx = marker.previousSibling.data.length;\n            } else {\n              node = marker.parentNode;\n              idx = dom.nodeIndex(marker) + 1;\n            }\n          }\n          container = node;\n          offset = idx;\n        } else {\n          if (!keep) {\n            idx = dom.nodeIndex(marker);\n          } else {\n            if (marker.hasChildNodes()) {\n              node = marker.firstChild;\n              idx = 1;\n            } else if (isValidTextNode(marker.previousSibling)) {\n              node = marker.previousSibling;\n              idx = marker.previousSibling.data.length;\n            } else {\n              node = marker.parentNode;\n              idx = dom.nodeIndex(marker);\n            }\n          }\n          container = node;\n          offset = idx;\n        }\n        if (!keep) {\n          prev = marker.previousSibling;\n          next = marker.nextSibling;\n          Tools.each(Tools.grep(marker.childNodes), function (node) {\n            if (NodeType.isText(node)) {\n              node.nodeValue = node.nodeValue.replace(/\\uFEFF/g, '');\n            }\n          });\n          while (marker = dom.get(bookmark.id + '_' + suffix)) {\n            dom.remove(marker, true);\n          }\n          if (prev && next && prev.nodeType === next.nodeType && NodeType.isText(prev) && !Env.opera) {\n            idx = prev.nodeValue.length;\n            prev.appendData(next.nodeValue);\n            dom.remove(next);\n            if (suffix === 'start') {\n              container = prev;\n              offset = idx;\n            } else {\n              container = prev;\n              offset = idx;\n            }\n          }\n        }\n        return Option.some(CaretPosition$1(container, offset));\n      } else {\n        return Option.none();\n      }\n    };\n    var alt = function (o1, o2) {\n      return o1.isSome() ? o1 : o2;\n    };\n    var resolvePaths = function (dom, bookmark) {\n      var rng = dom.createRng();\n      if (setEndPoint(dom, true, bookmark, rng) && setEndPoint(dom, false, bookmark, rng)) {\n        return Option.some(rng);\n      } else {\n        return Option.none();\n      }\n    };\n    var resolveId = function (dom, bookmark) {\n      var startPos = restoreEndPoint(dom, 'start', bookmark);\n      var endPos = restoreEndPoint(dom, 'end', bookmark);\n      return lift2(startPos, alt(endPos, startPos), function (spos, epos) {\n        var rng = dom.createRng();\n        rng.setStart(addBogus(dom, spos.container()), spos.offset());\n        rng.setEnd(addBogus(dom, epos.container()), epos.offset());\n        return rng;\n      });\n    };\n    var resolveIndex$1 = function (dom, bookmark) {\n      return Option.from(dom.select(bookmark.name)[bookmark.index]).map(function (elm) {\n        var rng = dom.createRng();\n        rng.selectNode(elm);\n        return rng;\n      });\n    };\n    var resolve$3 = function (selection, bookmark) {\n      var dom = selection.dom;\n      if (bookmark) {\n        if (isPathBookmark(bookmark)) {\n          return resolvePaths(dom, bookmark);\n        } else if (isStringPathBookmark(bookmark)) {\n          return Option.some(resolveCaretPositionBookmark(dom, bookmark));\n        } else if (isIdBookmark(bookmark)) {\n          return resolveId(dom, bookmark);\n        } else if (isIndexBookmark(bookmark)) {\n          return resolveIndex$1(dom, bookmark);\n        } else if (isRangeBookmark(bookmark)) {\n          return Option.some(bookmark.rng);\n        }\n      }\n      return Option.none();\n    };\n    var ResolveBookmark = { resolve: resolve$3 };\n\n    var getBookmark$1 = function (selection, type, normalized) {\n      return GetBookmark.getBookmark(selection, type, normalized);\n    };\n    var moveToBookmark = function (selection, bookmark) {\n      ResolveBookmark.resolve(selection, bookmark).each(function (rng) {\n        selection.setRng(rng);\n      });\n    };\n    var isBookmarkNode$1 = function (node) {\n      return NodeType.isElement(node) && node.tagName === 'SPAN' && node.getAttribute('data-mce-type') === 'bookmark';\n    };\n    var Bookmarks = {\n      getBookmark: getBookmark$1,\n      moveToBookmark: moveToBookmark,\n      isBookmarkNode: isBookmarkNode$1\n    };\n\n    var isInlineBlock = function (node) {\n      return node && /^(IMG)$/.test(node.nodeName);\n    };\n    var moveStart = function (dom, selection, rng) {\n      var offset = rng.startOffset;\n      var container = rng.startContainer, walker, node, nodes;\n      if (rng.startContainer === rng.endContainer) {\n        if (isInlineBlock(rng.startContainer.childNodes[rng.startOffset])) {\n          return;\n        }\n      }\n      if (container.nodeType === 1) {\n        nodes = container.childNodes;\n        if (offset < nodes.length) {\n          container = nodes[offset];\n          walker = new TreeWalker(container, dom.getParent(container, dom.isBlock));\n        } else {\n          container = nodes[nodes.length - 1];\n          walker = new TreeWalker(container, dom.getParent(container, dom.isBlock));\n          walker.next(true);\n        }\n        for (node = walker.current(); node; node = walker.next()) {\n          if (node.nodeType === 3 && !isWhiteSpaceNode(node)) {\n            rng.setStart(node, 0);\n            selection.setRng(rng);\n            return;\n          }\n        }\n      }\n    };\n    var getNonWhiteSpaceSibling = function (node, next, inc) {\n      if (node) {\n        next = next ? 'nextSibling' : 'previousSibling';\n        for (node = inc ? node : node[next]; node; node = node[next]) {\n          if (node.nodeType === 1 || !isWhiteSpaceNode(node)) {\n            return node;\n          }\n        }\n      }\n    };\n    var isTextBlock$1 = function (editor, name) {\n      if (name.nodeType) {\n        name = name.nodeName;\n      }\n      return !!editor.schema.getTextBlockElements()[name.toLowerCase()];\n    };\n    var isValid = function (ed, parent, child) {\n      return ed.schema.isValidChild(parent, child);\n    };\n    var isWhiteSpaceNode = function (node) {\n      return node && node.nodeType === 3 && /^([\\t \\r\\n]+|)$/.test(node.nodeValue);\n    };\n    var replaceVars = function (value, vars) {\n      if (typeof value !== 'string') {\n        value = value(vars);\n      } else if (vars) {\n        value = value.replace(/%(\\w+)/g, function (str, name) {\n          return vars[name] || str;\n        });\n      }\n      return value;\n    };\n    var isEq = function (str1, str2) {\n      str1 = str1 || '';\n      str2 = str2 || '';\n      str1 = '' + (str1.nodeName || str1);\n      str2 = '' + (str2.nodeName || str2);\n      return str1.toLowerCase() === str2.toLowerCase();\n    };\n    var normalizeStyleValue = function (dom, value, name) {\n      if (name === 'color' || name === 'backgroundColor') {\n        value = dom.toHex(value);\n      }\n      if (name === 'fontWeight' && value === 700) {\n        value = 'bold';\n      }\n      if (name === 'fontFamily') {\n        value = value.replace(/[\\'\\\"]/g, '').replace(/,\\s+/g, ',');\n      }\n      return '' + value;\n    };\n    var getStyle = function (dom, node, name) {\n      return normalizeStyleValue(dom, dom.getStyle(node, name), name);\n    };\n    var getTextDecoration = function (dom, node) {\n      var decoration;\n      dom.getParent(node, function (n) {\n        decoration = dom.getStyle(n, 'text-decoration');\n        return decoration && decoration !== 'none';\n      });\n      return decoration;\n    };\n    var getParents$1 = function (dom, node, selector) {\n      return dom.getParents(node, selector, dom.getRoot());\n    };\n    var FormatUtils = {\n      isInlineBlock: isInlineBlock,\n      moveStart: moveStart,\n      getNonWhiteSpaceSibling: getNonWhiteSpaceSibling,\n      isTextBlock: isTextBlock$1,\n      isValid: isValid,\n      isWhiteSpaceNode: isWhiteSpaceNode,\n      replaceVars: replaceVars,\n      isEq: isEq,\n      normalizeStyleValue: normalizeStyleValue,\n      getStyle: getStyle,\n      getTextDecoration: getTextDecoration,\n      getParents: getParents$1\n    };\n\n    var isBookmarkNode$2 = Bookmarks.isBookmarkNode;\n    var getParents$2 = FormatUtils.getParents, isWhiteSpaceNode$1 = FormatUtils.isWhiteSpaceNode, isTextBlock$2 = FormatUtils.isTextBlock;\n    var findLeaf = function (node, offset) {\n      if (typeof offset === 'undefined') {\n        offset = node.nodeType === 3 ? node.length : node.childNodes.length;\n      }\n      while (node && node.hasChildNodes()) {\n        node = node.childNodes[offset];\n        if (node) {\n          offset = node.nodeType === 3 ? node.length : node.childNodes.length;\n        }\n      }\n      return {\n        node: node,\n        offset: offset\n      };\n    };\n    var excludeTrailingWhitespace = function (endContainer, endOffset) {\n      var leaf = findLeaf(endContainer, endOffset);\n      if (leaf.node) {\n        while (leaf.node && leaf.offset === 0 && leaf.node.previousSibling) {\n          leaf = findLeaf(leaf.node.previousSibling);\n        }\n        if (leaf.node && leaf.offset > 0 && leaf.node.nodeType === 3 && leaf.node.nodeValue.charAt(leaf.offset - 1) === ' ') {\n          if (leaf.offset > 1) {\n            endContainer = leaf.node;\n            endContainer.splitText(leaf.offset - 1);\n          }\n        }\n      }\n      return endContainer;\n    };\n    var isBogusBr = function (node) {\n      return node.nodeName === 'BR' && node.getAttribute('data-mce-bogus') && !node.nextSibling;\n    };\n    var findParentContentEditable = function (dom, node) {\n      var parent = node;\n      while (parent) {\n        if (parent.nodeType === 1 && dom.getContentEditable(parent)) {\n          return dom.getContentEditable(parent) === 'false' ? parent : node;\n        }\n        parent = parent.parentNode;\n      }\n      return node;\n    };\n    var findSpace = function (start, remove, node, offset) {\n      var pos, pos2;\n      var str = node.nodeValue;\n      if (typeof offset === 'undefined') {\n        offset = start ? str.length : 0;\n      }\n      if (start) {\n        pos = str.lastIndexOf(' ', offset);\n        pos2 = str.lastIndexOf('\\xA0', offset);\n        pos = pos > pos2 ? pos : pos2;\n        if (pos !== -1 && !remove && (pos < offset || !start) && pos <= str.length) {\n          pos++;\n        }\n      } else {\n        pos = str.indexOf(' ', offset);\n        pos2 = str.indexOf('\\xA0', offset);\n        pos = pos !== -1 && (pos2 === -1 || pos < pos2) ? pos : pos2;\n      }\n      return pos;\n    };\n    var findWordEndPoint = function (dom, body, container, offset, start, remove) {\n      var walker, node, pos, lastTextNode;\n      if (container.nodeType === 3) {\n        pos = findSpace(start, remove, container, offset);\n        if (pos !== -1) {\n          return {\n            container: container,\n            offset: pos\n          };\n        }\n        lastTextNode = container;\n      }\n      walker = new TreeWalker(container, dom.getParent(container, dom.isBlock) || body);\n      while (node = walker[start ? 'prev' : 'next']()) {\n        if (node.nodeType === 3 && !isBookmarkNode$2(node.parentNode)) {\n          lastTextNode = node;\n          pos = findSpace(start, remove, node);\n          if (pos !== -1) {\n            return {\n              container: node,\n              offset: pos\n            };\n          }\n        } else if (dom.isBlock(node) || FormatUtils.isEq(node, 'BR')) {\n          break;\n        }\n      }\n      if (lastTextNode) {\n        if (start) {\n          offset = 0;\n        } else {\n          offset = lastTextNode.length;\n        }\n        return {\n          container: lastTextNode,\n          offset: offset\n        };\n      }\n    };\n    var findSelectorEndPoint = function (dom, format, rng, container, siblingName) {\n      var parents, i, y, curFormat;\n      if (container.nodeType === 3 && container.nodeValue.length === 0 && container[siblingName]) {\n        container = container[siblingName];\n      }\n      parents = getParents$2(dom, container);\n      for (i = 0; i < parents.length; i++) {\n        for (y = 0; y < format.length; y++) {\n          curFormat = format[y];\n          if ('collapsed' in curFormat && curFormat.collapsed !== rng.collapsed) {\n            continue;\n          }\n          if (dom.is(parents[i], curFormat.selector)) {\n            return parents[i];\n          }\n        }\n      }\n      return container;\n    };\n    var findBlockEndPoint = function (editor, format, container, siblingName) {\n      var node;\n      var dom = editor.dom;\n      var root = dom.getRoot();\n      if (!format[0].wrapper) {\n        node = dom.getParent(container, format[0].block, root);\n      }\n      if (!node) {\n        var scopeRoot = dom.getParent(container, 'LI,TD,TH');\n        node = dom.getParent(container.nodeType === 3 ? container.parentNode : container, function (node) {\n          return node !== root && isTextBlock$2(editor, node);\n        }, scopeRoot);\n      }\n      if (node && format[0].wrapper) {\n        node = getParents$2(dom, node, 'ul,ol').reverse()[0] || node;\n      }\n      if (!node) {\n        node = container;\n        while (node[siblingName] && !dom.isBlock(node[siblingName])) {\n          node = node[siblingName];\n          if (FormatUtils.isEq(node, 'br')) {\n            break;\n          }\n        }\n      }\n      return node || container;\n    };\n    var findParentContainer = function (dom, format, startContainer, startOffset, endContainer, endOffset, start) {\n      var container, parent, sibling, siblingName, root;\n      container = parent = start ? startContainer : endContainer;\n      siblingName = start ? 'previousSibling' : 'nextSibling';\n      root = dom.getRoot();\n      if (container.nodeType === 3 && !isWhiteSpaceNode$1(container)) {\n        if (start ? startOffset > 0 : endOffset < container.nodeValue.length) {\n          return container;\n        }\n      }\n      while (true) {\n        if (!format[0].block_expand && dom.isBlock(parent)) {\n          return parent;\n        }\n        for (sibling = parent[siblingName]; sibling; sibling = sibling[siblingName]) {\n          if (!isBookmarkNode$2(sibling) && !isWhiteSpaceNode$1(sibling) && !isBogusBr(sibling)) {\n            return parent;\n          }\n        }\n        if (parent === root || parent.parentNode === root) {\n          container = parent;\n          break;\n        }\n        parent = parent.parentNode;\n      }\n      return container;\n    };\n    var expandRng = function (editor, rng, format, remove) {\n      var endPoint, startContainer = rng.startContainer, startOffset = rng.startOffset, endContainer = rng.endContainer, endOffset = rng.endOffset;\n      var dom = editor.dom;\n      if (startContainer.nodeType === 1 && startContainer.hasChildNodes()) {\n        startContainer = getNode(startContainer, startOffset);\n        if (startContainer.nodeType === 3) {\n          startOffset = 0;\n        }\n      }\n      if (endContainer.nodeType === 1 && endContainer.hasChildNodes()) {\n        endContainer = getNode(endContainer, rng.collapsed ? endOffset : endOffset - 1);\n        if (endContainer.nodeType === 3) {\n          endOffset = endContainer.nodeValue.length;\n        }\n      }\n      startContainer = findParentContentEditable(dom, startContainer);\n      endContainer = findParentContentEditable(dom, endContainer);\n      if (isBookmarkNode$2(startContainer.parentNode) || isBookmarkNode$2(startContainer)) {\n        startContainer = isBookmarkNode$2(startContainer) ? startContainer : startContainer.parentNode;\n        if (rng.collapsed) {\n          startContainer = startContainer.previousSibling || startContainer;\n        } else {\n          startContainer = startContainer.nextSibling || startContainer;\n        }\n        if (startContainer.nodeType === 3) {\n          startOffset = rng.collapsed ? startContainer.length : 0;\n        }\n      }\n      if (isBookmarkNode$2(endContainer.parentNode) || isBookmarkNode$2(endContainer)) {\n        endContainer = isBookmarkNode$2(endContainer) ? endContainer : endContainer.parentNode;\n        if (rng.collapsed) {\n          endContainer = endContainer.nextSibling || endContainer;\n        } else {\n          endContainer = endContainer.previousSibling || endContainer;\n        }\n        if (endContainer.nodeType === 3) {\n          endOffset = rng.collapsed ? 0 : endContainer.length;\n        }\n      }\n      if (rng.collapsed) {\n        endPoint = findWordEndPoint(dom, editor.getBody(), startContainer, startOffset, true, remove);\n        if (endPoint) {\n          startContainer = endPoint.container;\n          startOffset = endPoint.offset;\n        }\n        endPoint = findWordEndPoint(dom, editor.getBody(), endContainer, endOffset, false, remove);\n        if (endPoint) {\n          endContainer = endPoint.container;\n          endOffset = endPoint.offset;\n        }\n      }\n      if (format[0].inline) {\n        endContainer = remove ? endContainer : excludeTrailingWhitespace(endContainer, endOffset);\n      }\n      if (format[0].inline || format[0].block_expand) {\n        if (!format[0].inline || (startContainer.nodeType !== 3 || startOffset === 0)) {\n          startContainer = findParentContainer(dom, format, startContainer, startOffset, endContainer, endOffset, true);\n        }\n        if (!format[0].inline || (endContainer.nodeType !== 3 || endOffset === endContainer.nodeValue.length)) {\n          endContainer = findParentContainer(dom, format, startContainer, startOffset, endContainer, endOffset, false);\n        }\n      }\n      if (format[0].selector && format[0].expand !== false && !format[0].inline) {\n        startContainer = findSelectorEndPoint(dom, format, rng, startContainer, 'previousSibling');\n        endContainer = findSelectorEndPoint(dom, format, rng, endContainer, 'nextSibling');\n      }\n      if (format[0].block || format[0].selector) {\n        startContainer = findBlockEndPoint(editor, format, startContainer, 'previousSibling');\n        endContainer = findBlockEndPoint(editor, format, endContainer, 'nextSibling');\n        if (format[0].block) {\n          if (!dom.isBlock(startContainer)) {\n            startContainer = findParentContainer(dom, format, startContainer, startOffset, endContainer, endOffset, true);\n          }\n          if (!dom.isBlock(endContainer)) {\n            endContainer = findParentContainer(dom, format, startContainer, startOffset, endContainer, endOffset, false);\n          }\n        }\n      }\n      if (startContainer.nodeType === 1) {\n        startOffset = dom.nodeIndex(startContainer);\n        startContainer = startContainer.parentNode;\n      }\n      if (endContainer.nodeType === 1) {\n        endOffset = dom.nodeIndex(endContainer) + 1;\n        endContainer = endContainer.parentNode;\n      }\n      return {\n        startContainer: startContainer,\n        startOffset: startOffset,\n        endContainer: endContainer,\n        endOffset: endOffset\n      };\n    };\n    var ExpandRange = { expandRng: expandRng };\n\n    var each$8 = Tools.each;\n    var getEndChild = function (container, index) {\n      var childNodes = container.childNodes;\n      index--;\n      if (index > childNodes.length - 1) {\n        index = childNodes.length - 1;\n      } else if (index < 0) {\n        index = 0;\n      }\n      return childNodes[index] || container;\n    };\n    var walk$1 = function (dom, rng, callback) {\n      var startContainer = rng.startContainer;\n      var startOffset = rng.startOffset;\n      var endContainer = rng.endContainer;\n      var endOffset = rng.endOffset;\n      var ancestor;\n      var startPoint;\n      var endPoint;\n      var node;\n      var parent;\n      var siblings;\n      var nodes;\n      nodes = dom.select('td[data-mce-selected],th[data-mce-selected]');\n      if (nodes.length > 0) {\n        each$8(nodes, function (node) {\n          callback([node]);\n        });\n        return;\n      }\n      var exclude = function (nodes) {\n        var node;\n        node = nodes[0];\n        if (node.nodeType === 3 && node === startContainer && startOffset >= node.nodeValue.length) {\n          nodes.splice(0, 1);\n        }\n        node = nodes[nodes.length - 1];\n        if (endOffset === 0 && nodes.length > 0 && node === endContainer && node.nodeType === 3) {\n          nodes.splice(nodes.length - 1, 1);\n        }\n        return nodes;\n      };\n      var collectSiblings = function (node, name, endNode) {\n        var siblings = [];\n        for (; node && node !== endNode; node = node[name]) {\n          siblings.push(node);\n        }\n        return siblings;\n      };\n      var findEndPoint = function (node, root) {\n        do {\n          if (node.parentNode === root) {\n            return node;\n          }\n          node = node.parentNode;\n        } while (node);\n      };\n      var walkBoundary = function (startNode, endNode, next) {\n        var siblingName = next ? 'nextSibling' : 'previousSibling';\n        for (node = startNode, parent = node.parentNode; node && node !== endNode; node = parent) {\n          parent = node.parentNode;\n          siblings = collectSiblings(node === startNode ? node : node[siblingName], siblingName);\n          if (siblings.length) {\n            if (!next) {\n              siblings.reverse();\n            }\n            callback(exclude(siblings));\n          }\n        }\n      };\n      if (startContainer.nodeType === 1 && startContainer.hasChildNodes()) {\n        startContainer = startContainer.childNodes[startOffset];\n      }\n      if (endContainer.nodeType === 1 && endContainer.hasChildNodes()) {\n        endContainer = getEndChild(endContainer, endOffset);\n      }\n      if (startContainer === endContainer) {\n        return callback(exclude([startContainer]));\n      }\n      ancestor = dom.findCommonAncestor(startContainer, endContainer);\n      for (node = startContainer; node; node = node.parentNode) {\n        if (node === endContainer) {\n          return walkBoundary(startContainer, ancestor, true);\n        }\n        if (node === ancestor) {\n          break;\n        }\n      }\n      for (node = endContainer; node; node = node.parentNode) {\n        if (node === startContainer) {\n          return walkBoundary(endContainer, ancestor);\n        }\n        if (node === ancestor) {\n          break;\n        }\n      }\n      startPoint = findEndPoint(startContainer, ancestor) || startContainer;\n      endPoint = findEndPoint(endContainer, ancestor) || endContainer;\n      walkBoundary(startContainer, startPoint, true);\n      siblings = collectSiblings(startPoint === startContainer ? startPoint : startPoint.nextSibling, 'nextSibling', endPoint === endContainer ? endPoint.nextSibling : endPoint);\n      if (siblings.length) {\n        callback(exclude(siblings));\n      }\n      walkBoundary(endContainer, endPoint);\n    };\n    var RangeWalk = { walk: walk$1 };\n\n    var zeroWidth = function () {\n      return '\\uFEFF';\n    };\n\n    function NodeValue (is, name) {\n      var get = function (element) {\n        if (!is(element)) {\n          throw new Error('Can only get ' + name + ' value of a ' + name + ' node');\n        }\n        return getOption(element).getOr('');\n      };\n      var getOption = function (element) {\n        return is(element) ? Option.from(element.dom().nodeValue) : Option.none();\n      };\n      var set = function (element, value) {\n        if (!is(element)) {\n          throw new Error('Can only set raw ' + name + ' value of a ' + name + ' node');\n        }\n        element.dom().nodeValue = value;\n      };\n      return {\n        get: get,\n        getOption: getOption,\n        set: set\n      };\n    }\n\n    var api = NodeValue(isText, 'text');\n    var get$4 = function (element) {\n      return api.get(element);\n    };\n\n    var isZeroWidth = function (elem) {\n      return isText(elem) && get$4(elem) === zeroWidth();\n    };\n    var context = function (editor, elem, wrapName, nodeName) {\n      return parent(elem).fold(function () {\n        return 'skipping';\n      }, function (parent) {\n        if (nodeName === 'br' || isZeroWidth(elem)) {\n          return 'valid';\n        } else if (isAnnotation(elem)) {\n          return 'existing';\n        } else if (isCaretNode(elem)) {\n          return 'caret';\n        } else if (!FormatUtils.isValid(editor, wrapName, nodeName) || !FormatUtils.isValid(editor, name(parent), wrapName)) {\n          return 'invalid-child';\n        } else {\n          return 'valid';\n        }\n      });\n    };\n\n    var shouldApplyToTrailingSpaces = function (rng) {\n      return rng.startContainer.nodeType === 3 && rng.startContainer.nodeValue.length >= rng.startOffset && rng.startContainer.nodeValue[rng.startOffset] === '\\xA0';\n    };\n    var applyWordGrab = function (editor, rng) {\n      var r = ExpandRange.expandRng(editor, rng, [{ inline: true }], shouldApplyToTrailingSpaces(rng));\n      rng.setStart(r.startContainer, r.startOffset);\n      rng.setEnd(r.endContainer, r.endOffset);\n      editor.selection.setRng(rng);\n    };\n    var makeAnnotation = function (eDoc, _a, annotationName, decorate) {\n      var _b = _a.uid, uid = _b === void 0 ? generate('mce-annotation') : _b, data = __rest(_a, ['uid']);\n      var master = Element.fromTag('span', eDoc);\n      add$2(master, annotation());\n      set(master, '' + dataAnnotationId(), uid);\n      set(master, '' + dataAnnotation(), annotationName);\n      var _c = decorate(uid, data), _d = _c.attributes, attributes = _d === void 0 ? {} : _d, _e = _c.classes, classes = _e === void 0 ? [] : _e;\n      setAll(master, attributes);\n      add$3(master, classes);\n      return master;\n    };\n    var annotate = function (editor, rng, annotationName, decorate, data) {\n      var newWrappers = [];\n      var master = makeAnnotation(editor.getDoc(), data, annotationName, decorate);\n      var wrapper = Cell(Option.none());\n      var finishWrapper = function () {\n        wrapper.set(Option.none());\n      };\n      var getOrOpenWrapper = function () {\n        return wrapper.get().getOrThunk(function () {\n          var nu = shallow(master);\n          newWrappers.push(nu);\n          wrapper.set(Option.some(nu));\n          return nu;\n        });\n      };\n      var processElements = function (elems) {\n        each(elems, processElement);\n      };\n      var processElement = function (elem) {\n        var ctx = context(editor, elem, 'span', name(elem));\n        switch (ctx) {\n        case 'invalid-child': {\n            finishWrapper();\n            var children$1 = children(elem);\n            processElements(children$1);\n            finishWrapper();\n            break;\n          }\n        case 'valid': {\n            var w = getOrOpenWrapper();\n            wrap$1(elem, w);\n            break;\n          }\n        case 'skipping':\n        case 'existing':\n        case 'caret':\n        }\n      };\n      var processNodes = function (nodes) {\n        var elems = map(nodes, Element.fromDom);\n        processElements(elems);\n      };\n      RangeWalk.walk(editor.dom, rng, function (nodes) {\n        finishWrapper();\n        processNodes(nodes);\n      });\n      return newWrappers;\n    };\n    var annotateWithBookmark = function (editor, name, settings, data) {\n      editor.undoManager.transact(function () {\n        var initialRng = editor.selection.getRng();\n        if (initialRng.collapsed) {\n          applyWordGrab(editor, initialRng);\n        }\n        if (editor.selection.getRng().collapsed) {\n          var wrapper = makeAnnotation(editor.getDoc(), data, name, settings.decorate);\n          set$1(wrapper, '\\xA0');\n          editor.selection.getRng().insertNode(wrapper.dom());\n          editor.selection.select(wrapper.dom());\n        } else {\n          var bookmark = GetBookmark.getPersistentBookmark(editor.selection, false);\n          var rng = editor.selection.getRng();\n          annotate(editor, rng, name, settings.decorate, data);\n          editor.selection.moveToBookmark(bookmark);\n        }\n      });\n    };\n\n    function Annotator (editor) {\n      var registry = create$1();\n      setup$1(editor, registry);\n      var changes = setup(editor);\n      return {\n        register: function (name, settings) {\n          registry.register(name, settings);\n        },\n        annotate: function (name, data) {\n          registry.lookup(name).each(function (settings) {\n            annotateWithBookmark(editor, name, settings, data);\n          });\n        },\n        annotationChanged: function (name, callback) {\n          changes.addListener(name, callback);\n        },\n        remove: function (name) {\n          identify(editor, Option.some(name)).each(function (_a) {\n            var elements = _a.elements;\n            each(elements, unwrap);\n          });\n        },\n        getAll: function (name) {\n          var directory = findAll(editor, name);\n          return map$2(directory, function (elems) {\n            return map(elems, function (elem) {\n              return elem.dom();\n            });\n          });\n        }\n      };\n    }\n\n    var hasOnlyOneChild = function (node) {\n      return node.firstChild && node.firstChild === node.lastChild;\n    };\n    var isPaddingNode = function (node) {\n      return node.name === 'br' || node.value === '\\xA0';\n    };\n    var isPaddedEmptyBlock = function (schema, node) {\n      var blockElements = schema.getBlockElements();\n      return blockElements[node.name] && hasOnlyOneChild(node) && isPaddingNode(node.firstChild);\n    };\n    var isEmptyFragmentElement = function (schema, node) {\n      var nonEmptyElements = schema.getNonEmptyElements();\n      return node && (node.isEmpty(nonEmptyElements) || isPaddedEmptyBlock(schema, node));\n    };\n    var isListFragment = function (schema, fragment) {\n      var firstChild = fragment.firstChild;\n      var lastChild = fragment.lastChild;\n      if (firstChild && firstChild.name === 'meta') {\n        firstChild = firstChild.next;\n      }\n      if (lastChild && lastChild.attr('id') === 'mce_marker') {\n        lastChild = lastChild.prev;\n      }\n      if (isEmptyFragmentElement(schema, lastChild)) {\n        lastChild = lastChild.prev;\n      }\n      if (!firstChild || firstChild !== lastChild) {\n        return false;\n      }\n      return firstChild.name === 'ul' || firstChild.name === 'ol';\n    };\n    var cleanupDomFragment = function (domFragment) {\n      var firstChild = domFragment.firstChild;\n      var lastChild = domFragment.lastChild;\n      if (firstChild && firstChild.nodeName === 'META') {\n        firstChild.parentNode.removeChild(firstChild);\n      }\n      if (lastChild && lastChild.id === 'mce_marker') {\n        lastChild.parentNode.removeChild(lastChild);\n      }\n      return domFragment;\n    };\n    var toDomFragment = function (dom, serializer, fragment) {\n      var html = serializer.serialize(fragment);\n      var domFragment = dom.createFragment(html);\n      return cleanupDomFragment(domFragment);\n    };\n    var listItems$1 = function (elm) {\n      return Tools.grep(elm.childNodes, function (child) {\n        return child.nodeName === 'LI';\n      });\n    };\n    var isPadding = function (node) {\n      return node.data === '\\xA0' || NodeType.isBr(node);\n    };\n    var isListItemPadded = function (node) {\n      return node && node.firstChild && node.firstChild === node.lastChild && isPadding(node.firstChild);\n    };\n    var isEmptyOrPadded = function (elm) {\n      return !elm.firstChild || isListItemPadded(elm);\n    };\n    var trimListItems = function (elms) {\n      return elms.length > 0 && isEmptyOrPadded(elms[elms.length - 1]) ? elms.slice(0, -1) : elms;\n    };\n    var getParentLi = function (dom, node) {\n      var parentBlock = dom.getParent(node, dom.isBlock);\n      return parentBlock && parentBlock.nodeName === 'LI' ? parentBlock : null;\n    };\n    var isParentBlockLi = function (dom, node) {\n      return !!getParentLi(dom, node);\n    };\n    var getSplit = function (parentNode, rng) {\n      var beforeRng = rng.cloneRange();\n      var afterRng = rng.cloneRange();\n      beforeRng.setStartBefore(parentNode);\n      afterRng.setEndAfter(parentNode);\n      return [\n        beforeRng.cloneContents(),\n        afterRng.cloneContents()\n      ];\n    };\n    var findFirstIn = function (node, rootNode) {\n      var caretPos = CaretPosition$1.before(node);\n      var caretWalker = CaretWalker(rootNode);\n      var newCaretPos = caretWalker.next(caretPos);\n      return newCaretPos ? newCaretPos.toRange() : null;\n    };\n    var findLastOf = function (node, rootNode) {\n      var caretPos = CaretPosition$1.after(node);\n      var caretWalker = CaretWalker(rootNode);\n      var newCaretPos = caretWalker.prev(caretPos);\n      return newCaretPos ? newCaretPos.toRange() : null;\n    };\n    var insertMiddle = function (target, elms, rootNode, rng) {\n      var parts = getSplit(target, rng);\n      var parentElm = target.parentNode;\n      parentElm.insertBefore(parts[0], target);\n      Tools.each(elms, function (li) {\n        parentElm.insertBefore(li, target);\n      });\n      parentElm.insertBefore(parts[1], target);\n      parentElm.removeChild(target);\n      return findLastOf(elms[elms.length - 1], rootNode);\n    };\n    var insertBefore = function (target, elms, rootNode) {\n      var parentElm = target.parentNode;\n      Tools.each(elms, function (elm) {\n        parentElm.insertBefore(elm, target);\n      });\n      return findFirstIn(target, rootNode);\n    };\n    var insertAfter = function (target, elms, rootNode, dom) {\n      dom.insertAfter(elms.reverse(), target);\n      return findLastOf(elms[0], rootNode);\n    };\n    var insertAtCaret = function (serializer, dom, rng, fragment) {\n      var domFragment = toDomFragment(dom, serializer, fragment);\n      var liTarget = getParentLi(dom, rng.startContainer);\n      var liElms = trimListItems(listItems$1(domFragment.firstChild));\n      var BEGINNING = 1, END = 2;\n      var rootNode = dom.getRoot();\n      var isAt = function (location) {\n        var caretPos = CaretPosition$1.fromRangeStart(rng);\n        var caretWalker = CaretWalker(dom.getRoot());\n        var newPos = location === BEGINNING ? caretWalker.prev(caretPos) : caretWalker.next(caretPos);\n        return newPos ? getParentLi(dom, newPos.getNode()) !== liTarget : true;\n      };\n      if (isAt(BEGINNING)) {\n        return insertBefore(liTarget, liElms, rootNode);\n      } else if (isAt(END)) {\n        return insertAfter(liTarget, liElms, rootNode, dom);\n      }\n      return insertMiddle(liTarget, liElms, rootNode, rng);\n    };\n    var InsertList = {\n      isListFragment: isListFragment,\n      insertAtCaret: insertAtCaret,\n      isParentBlockLi: isParentBlockLi,\n      trimListItems: trimListItems,\n      listItems: listItems$1\n    };\n\n    var each$9 = Tools.each;\n    var ElementUtils = function (dom) {\n      this.compare = function (node1, node2) {\n        if (node1.nodeName !== node2.nodeName) {\n          return false;\n        }\n        var getAttribs = function (node) {\n          var attribs = {};\n          each$9(dom.getAttribs(node), function (attr) {\n            var name = attr.nodeName.toLowerCase();\n            if (name.indexOf('_') !== 0 && name !== 'style' && name.indexOf('data-') !== 0) {\n              attribs[name] = dom.getAttrib(node, name);\n            }\n          });\n          return attribs;\n        };\n        var compareObjects = function (obj1, obj2) {\n          var value, name;\n          for (name in obj1) {\n            if (obj1.hasOwnProperty(name)) {\n              value = obj2[name];\n              if (typeof value === 'undefined') {\n                return false;\n              }\n              if (obj1[name] !== value) {\n                return false;\n              }\n              delete obj2[name];\n            }\n          }\n          for (name in obj2) {\n            if (obj2.hasOwnProperty(name)) {\n              return false;\n            }\n          }\n          return true;\n        };\n        if (!compareObjects(getAttribs(node1), getAttribs(node2))) {\n          return false;\n        }\n        if (!compareObjects(dom.parseStyle(dom.getAttrib(node1, 'style')), dom.parseStyle(dom.getAttrib(node2, 'style')))) {\n          return false;\n        }\n        return !Bookmarks.isBookmarkNode(node1) && !Bookmarks.isBookmarkNode(node2);\n      };\n    };\n\n    var getLastChildren = function (elm) {\n      var children = [];\n      var rawNode = elm.dom();\n      while (rawNode) {\n        children.push(Element.fromDom(rawNode));\n        rawNode = rawNode.lastChild;\n      }\n      return children;\n    };\n    var removeTrailingBr = function (elm) {\n      var allBrs = descendants$1(elm, 'br');\n      var brs = filter(getLastChildren(elm).slice(-1), isBr);\n      if (allBrs.length === brs.length) {\n        each(brs, remove$1);\n      }\n    };\n    var fillWithPaddingBr = function (elm) {\n      empty(elm);\n      append(elm, Element.fromHtml('<br data-mce-bogus=\"1\">'));\n    };\n    var isPaddingContents = function (elm) {\n      return isText(elm) ? get$4(elm) === '\\xA0' : isBr(elm);\n    };\n    var isPaddedElement = function (elm) {\n      return filter(children(elm), isPaddingContents).length === 1;\n    };\n    var trimBlockTrailingBr = function (elm) {\n      lastChild(elm).each(function (lastChild) {\n        prevSibling(lastChild).each(function (lastChildPrevSibling) {\n          if (isBlock(elm) && isBr(lastChild) && isBlock(lastChildPrevSibling)) {\n            remove$1(lastChild);\n          }\n        });\n      });\n    };\n    var PaddingBr = {\n      removeTrailingBr: removeTrailingBr,\n      fillWithPaddingBr: fillWithPaddingBr,\n      isPaddedElement: isPaddedElement,\n      trimBlockTrailingBr: trimBlockTrailingBr\n    };\n\n    var makeMap$3 = Tools.makeMap;\n    function Writer (settings) {\n      var html = [];\n      var indent, indentBefore, indentAfter, encode, htmlOutput;\n      settings = settings || {};\n      indent = settings.indent;\n      indentBefore = makeMap$3(settings.indent_before || '');\n      indentAfter = makeMap$3(settings.indent_after || '');\n      encode = Entities.getEncodeFunc(settings.entity_encoding || 'raw', settings.entities);\n      htmlOutput = settings.element_format === 'html';\n      return {\n        start: function (name, attrs, empty) {\n          var i, l, attr, value;\n          if (indent && indentBefore[name] && html.length > 0) {\n            value = html[html.length - 1];\n            if (value.length > 0 && value !== '\\n') {\n              html.push('\\n');\n            }\n          }\n          html.push('<', name);\n          if (attrs) {\n            for (i = 0, l = attrs.length; i < l; i++) {\n              attr = attrs[i];\n              html.push(' ', attr.name, '=\"', encode(attr.value, true), '\"');\n            }\n          }\n          if (!empty || htmlOutput) {\n            html[html.length] = '>';\n          } else {\n            html[html.length] = ' />';\n          }\n          if (empty && indent && indentAfter[name] && html.length > 0) {\n            value = html[html.length - 1];\n            if (value.length > 0 && value !== '\\n') {\n              html.push('\\n');\n            }\n          }\n        },\n        end: function (name) {\n          var value;\n          html.push('</', name, '>');\n          if (indent && indentAfter[name] && html.length > 0) {\n            value = html[html.length - 1];\n            if (value.length > 0 && value !== '\\n') {\n              html.push('\\n');\n            }\n          }\n        },\n        text: function (text, raw) {\n          if (text.length > 0) {\n            html[html.length] = raw ? text : encode(text);\n          }\n        },\n        cdata: function (text) {\n          html.push('<![CDATA[', text, ']]>');\n        },\n        comment: function (text) {\n          html.push('<!--', text, '-->');\n        },\n        pi: function (name, text) {\n          if (text) {\n            html.push('<?', name, ' ', encode(text), '?>');\n          } else {\n            html.push('<?', name, '?>');\n          }\n          if (indent) {\n            html.push('\\n');\n          }\n        },\n        doctype: function (text) {\n          html.push('<!DOCTYPE', text, '>', indent ? '\\n' : '');\n        },\n        reset: function () {\n          html.length = 0;\n        },\n        getContent: function () {\n          return html.join('').replace(/\\n$/, '');\n        }\n      };\n    }\n\n    function HtmlSerializer (settings, schema) {\n      if (schema === void 0) {\n        schema = Schema();\n      }\n      var writer = Writer(settings);\n      settings = settings || {};\n      settings.validate = 'validate' in settings ? settings.validate : true;\n      var serialize = function (node) {\n        var handlers, validate;\n        validate = settings.validate;\n        handlers = {\n          3: function (node) {\n            writer.text(node.value, node.raw);\n          },\n          8: function (node) {\n            writer.comment(node.value);\n          },\n          7: function (node) {\n            writer.pi(node.name, node.value);\n          },\n          10: function (node) {\n            writer.doctype(node.value);\n          },\n          4: function (node) {\n            writer.cdata(node.value);\n          },\n          11: function (node) {\n            if (node = node.firstChild) {\n              do {\n                walk(node);\n              } while (node = node.next);\n            }\n          }\n        };\n        writer.reset();\n        var walk = function (node) {\n          var handler = handlers[node.type];\n          var name, isEmpty, attrs, attrName, attrValue, sortedAttrs, i, l, elementRule;\n          if (!handler) {\n            name = node.name;\n            isEmpty = node.shortEnded;\n            attrs = node.attributes;\n            if (validate && attrs && attrs.length > 1) {\n              sortedAttrs = [];\n              sortedAttrs.map = {};\n              elementRule = schema.getElementRule(node.name);\n              if (elementRule) {\n                for (i = 0, l = elementRule.attributesOrder.length; i < l; i++) {\n                  attrName = elementRule.attributesOrder[i];\n                  if (attrName in attrs.map) {\n                    attrValue = attrs.map[attrName];\n                    sortedAttrs.map[attrName] = attrValue;\n                    sortedAttrs.push({\n                      name: attrName,\n                      value: attrValue\n                    });\n                  }\n                }\n                for (i = 0, l = attrs.length; i < l; i++) {\n                  attrName = attrs[i].name;\n                  if (!(attrName in sortedAttrs.map)) {\n                    attrValue = attrs.map[attrName];\n                    sortedAttrs.map[attrName] = attrValue;\n                    sortedAttrs.push({\n                      name: attrName,\n                      value: attrValue\n                    });\n                  }\n                }\n                attrs = sortedAttrs;\n              }\n            }\n            writer.start(node.name, attrs, isEmpty);\n            if (!isEmpty) {\n              if (node = node.firstChild) {\n                do {\n                  walk(node);\n                } while (node = node.next);\n              }\n              writer.end(name);\n            }\n          } else {\n            handler(node);\n          }\n        };\n        if (node.type === 1 && !settings.inner) {\n          walk(node);\n        } else {\n          handlers[11](node);\n        }\n        return writer.getContent();\n      };\n      return { serialize: serialize };\n    }\n\n    var createRange$1 = function (sc, so, ec, eo) {\n      var rng = domGlobals.document.createRange();\n      rng.setStart(sc, so);\n      rng.setEnd(ec, eo);\n      return rng;\n    };\n    var normalizeBlockSelectionRange = function (rng) {\n      var startPos = CaretPosition$1.fromRangeStart(rng);\n      var endPos = CaretPosition$1.fromRangeEnd(rng);\n      var rootNode = rng.commonAncestorContainer;\n      return CaretFinder.fromPosition(false, rootNode, endPos).map(function (newEndPos) {\n        if (!isInSameBlock(startPos, endPos, rootNode) && isInSameBlock(startPos, newEndPos, rootNode)) {\n          return createRange$1(startPos.container(), startPos.offset(), newEndPos.container(), newEndPos.offset());\n        } else {\n          return rng;\n        }\n      }).getOr(rng);\n    };\n    var normalize = function (rng) {\n      return rng.collapsed ? rng : normalizeBlockSelectionRange(rng);\n    };\n    var RangeNormalizer = { normalize: normalize };\n\n    var isAfterNbsp = function (container, offset) {\n      return NodeType.isText(container) && container.nodeValue[offset - 1] === '\\xA0';\n    };\n    var trimOrPadLeftRight = function (rng, html) {\n      var container, offset;\n      container = rng.startContainer;\n      offset = rng.startOffset;\n      var hasSiblingText = function (siblingName) {\n        return container[siblingName] && container[siblingName].nodeType === 3;\n      };\n      if (container.nodeType === 3) {\n        if (offset > 0) {\n          html = html.replace(/^&nbsp;/, ' ');\n        } else if (!hasSiblingText('previousSibling')) {\n          html = html.replace(/^ /, '&nbsp;');\n        }\n        if (offset < container.length) {\n          html = html.replace(/&nbsp;(<br>|)$/, ' ');\n        } else if (!hasSiblingText('nextSibling')) {\n          html = html.replace(/(&nbsp;| )(<br>|)$/, '&nbsp;');\n        }\n      }\n      return html;\n    };\n    var trimNbspAfterDeleteAndPadValue = function (rng, value) {\n      var container, offset;\n      container = rng.startContainer;\n      offset = rng.startOffset;\n      if (container.nodeType === 3 && rng.collapsed) {\n        if (container.data[offset] === '\\xA0') {\n          container.deleteData(offset, 1);\n          if (!/[\\u00a0| ]$/.test(value)) {\n            value += ' ';\n          }\n        } else if (container.data[offset - 1] === '\\xA0') {\n          container.deleteData(offset - 1, 1);\n          if (!/[\\u00a0| ]$/.test(value)) {\n            value = ' ' + value;\n          }\n        }\n      }\n      return value;\n    };\n\n    var isTableCell$2 = NodeType.matchNodeNames('td th');\n    var selectionSetContent = function (editor, content) {\n      var rng = editor.selection.getRng();\n      var container = rng.startContainer;\n      var offset = rng.startOffset;\n      if (rng.collapsed && isAfterNbsp(container, offset) && NodeType.isText(container)) {\n        container.insertData(offset - 1, ' ');\n        container.deleteData(offset, 1);\n        rng.setStart(container, offset);\n        rng.setEnd(container, offset);\n        editor.selection.setRng(rng);\n      }\n      editor.selection.setContent(content);\n    };\n    var validInsertion = function (editor, value, parentNode) {\n      if (parentNode.getAttribute('data-mce-bogus') === 'all') {\n        parentNode.parentNode.insertBefore(editor.dom.createFragment(value), parentNode);\n      } else {\n        var node = parentNode.firstChild;\n        var node2 = parentNode.lastChild;\n        if (!node || node === node2 && node.nodeName === 'BR') {\n          editor.dom.setHTML(parentNode, value);\n        } else {\n          selectionSetContent(editor, value);\n        }\n      }\n    };\n    var trimBrsFromTableCell = function (dom, elm) {\n      Option.from(dom.getParent(elm, 'td,th')).map(Element.fromDom).each(PaddingBr.trimBlockTrailingBr);\n    };\n    var reduceInlineTextElements = function (editor, merge) {\n      var textInlineElements = editor.schema.getTextInlineElements();\n      var dom = editor.dom;\n      if (merge) {\n        var root_1 = editor.getBody(), elementUtils_1 = new ElementUtils(dom);\n        Tools.each(dom.select('*[data-mce-fragment]'), function (node) {\n          for (var testNode = node.parentNode; testNode && testNode !== root_1; testNode = testNode.parentNode) {\n            if (textInlineElements[node.nodeName.toLowerCase()] && elementUtils_1.compare(testNode, node)) {\n              dom.remove(node, true);\n            }\n          }\n        });\n      }\n    };\n    var markFragmentElements = function (fragment) {\n      var node = fragment;\n      while (node = node.walk()) {\n        if (node.type === 1) {\n          node.attr('data-mce-fragment', '1');\n        }\n      }\n    };\n    var umarkFragmentElements = function (elm) {\n      Tools.each(elm.getElementsByTagName('*'), function (elm) {\n        elm.removeAttribute('data-mce-fragment');\n      });\n    };\n    var isPartOfFragment = function (node) {\n      return !!node.getAttribute('data-mce-fragment');\n    };\n    var canHaveChildren = function (editor, node) {\n      return node && !editor.schema.getShortEndedElements()[node.nodeName];\n    };\n    var moveSelectionToMarker = function (editor, marker) {\n      var parentEditableFalseElm, parentBlock, nextRng;\n      var dom = editor.dom, selection = editor.selection;\n      var node, node2;\n      var getContentEditableFalseParent = function (node) {\n        var root = editor.getBody();\n        for (; node && node !== root; node = node.parentNode) {\n          if (editor.dom.getContentEditable(node) === 'false') {\n            return node;\n          }\n        }\n        return null;\n      };\n      if (!marker) {\n        return;\n      }\n      editor.selection.scrollIntoView(marker);\n      parentEditableFalseElm = getContentEditableFalseParent(marker);\n      if (parentEditableFalseElm) {\n        dom.remove(marker);\n        selection.select(parentEditableFalseElm);\n        return;\n      }\n      var rng = dom.createRng();\n      node = marker.previousSibling;\n      if (node && node.nodeType === 3) {\n        rng.setStart(node, node.nodeValue.length);\n        if (!Env.ie) {\n          node2 = marker.nextSibling;\n          if (node2 && node2.nodeType === 3) {\n            node.appendData(node2.data);\n            node2.parentNode.removeChild(node2);\n          }\n        }\n      } else {\n        rng.setStartBefore(marker);\n        rng.setEndBefore(marker);\n      }\n      var findNextCaretRng = function (rng) {\n        var caretPos = CaretPosition$1.fromRangeStart(rng);\n        var caretWalker = CaretWalker(editor.getBody());\n        caretPos = caretWalker.next(caretPos);\n        if (caretPos) {\n          return caretPos.toRange();\n        }\n      };\n      parentBlock = dom.getParent(marker, dom.isBlock);\n      dom.remove(marker);\n      if (parentBlock && dom.isEmpty(parentBlock)) {\n        editor.$(parentBlock).empty();\n        rng.setStart(parentBlock, 0);\n        rng.setEnd(parentBlock, 0);\n        if (!isTableCell$2(parentBlock) && !isPartOfFragment(parentBlock) && (nextRng = findNextCaretRng(rng))) {\n          rng = nextRng;\n          dom.remove(parentBlock);\n        } else {\n          dom.add(parentBlock, dom.create('br', { 'data-mce-bogus': '1' }));\n        }\n      }\n      selection.setRng(rng);\n    };\n    var insertHtmlAtCaret = function (editor, value, details) {\n      var parser, serializer, parentNode, rootNode, fragment, args;\n      var marker, rng, node, bookmarkHtml, merge;\n      var selection = editor.selection, dom = editor.dom;\n      if (/^ | $/.test(value)) {\n        value = trimOrPadLeftRight(selection.getRng(), value);\n      }\n      parser = editor.parser;\n      merge = details.merge;\n      serializer = HtmlSerializer({ validate: editor.settings.validate }, editor.schema);\n      bookmarkHtml = '<span id=\"mce_marker\" data-mce-type=\"bookmark\">&#xFEFF;&#x200B;</span>';\n      args = {\n        content: value,\n        format: 'html',\n        selection: true,\n        paste: details.paste\n      };\n      args = editor.fire('BeforeSetContent', args);\n      if (args.isDefaultPrevented()) {\n        editor.fire('SetContent', {\n          content: args.content,\n          format: 'html',\n          selection: true,\n          paste: details.paste\n        });\n        return;\n      }\n      value = args.content;\n      if (value.indexOf('{$caret}') === -1) {\n        value += '{$caret}';\n      }\n      value = value.replace(/\\{\\$caret\\}/, bookmarkHtml);\n      rng = selection.getRng();\n      var caretElement = rng.startContainer || (rng.parentElement ? rng.parentElement() : null);\n      var body = editor.getBody();\n      if (caretElement === body && selection.isCollapsed()) {\n        if (dom.isBlock(body.firstChild) && canHaveChildren(editor, body.firstChild) && dom.isEmpty(body.firstChild)) {\n          rng = dom.createRng();\n          rng.setStart(body.firstChild, 0);\n          rng.setEnd(body.firstChild, 0);\n          selection.setRng(rng);\n        }\n      }\n      if (!selection.isCollapsed()) {\n        editor.selection.setRng(RangeNormalizer.normalize(editor.selection.getRng()));\n        editor.getDoc().execCommand('Delete', false, null);\n        value = trimNbspAfterDeleteAndPadValue(editor.selection.getRng(), value);\n      }\n      parentNode = selection.getNode();\n      var parserArgs = {\n        context: parentNode.nodeName.toLowerCase(),\n        data: details.data,\n        insert: true\n      };\n      fragment = parser.parse(value, parserArgs);\n      if (details.paste === true && InsertList.isListFragment(editor.schema, fragment) && InsertList.isParentBlockLi(dom, parentNode)) {\n        rng = InsertList.insertAtCaret(serializer, dom, editor.selection.getRng(), fragment);\n        editor.selection.setRng(rng);\n        editor.fire('SetContent', args);\n        return;\n      }\n      markFragmentElements(fragment);\n      node = fragment.lastChild;\n      if (node.attr('id') === 'mce_marker') {\n        marker = node;\n        for (node = node.prev; node; node = node.walk(true)) {\n          if (node.type === 3 || !dom.isBlock(node.name)) {\n            if (editor.schema.isValidChild(node.parent.name, 'span')) {\n              node.parent.insert(marker, node, node.name === 'br');\n            }\n            break;\n          }\n        }\n      }\n      editor._selectionOverrides.showBlockCaretContainer(parentNode);\n      if (!parserArgs.invalid) {\n        value = serializer.serialize(fragment);\n        validInsertion(editor, value, parentNode);\n      } else {\n        selectionSetContent(editor, bookmarkHtml);\n        parentNode = selection.getNode();\n        rootNode = editor.getBody();\n        if (parentNode.nodeType === 9) {\n          parentNode = node = rootNode;\n        } else {\n          node = parentNode;\n        }\n        while (node !== rootNode) {\n          parentNode = node;\n          node = node.parentNode;\n        }\n        value = parentNode === rootNode ? rootNode.innerHTML : dom.getOuterHTML(parentNode);\n        value = serializer.serialize(parser.parse(value.replace(/<span (id=\"mce_marker\"|id=mce_marker).+?<\\/span>/i, function () {\n          return serializer.serialize(fragment);\n        })));\n        if (parentNode === rootNode) {\n          dom.setHTML(rootNode, value);\n        } else {\n          dom.setOuterHTML(parentNode, value);\n        }\n      }\n      reduceInlineTextElements(editor, merge);\n      moveSelectionToMarker(editor, dom.get('mce_marker'));\n      umarkFragmentElements(editor.getBody());\n      trimBrsFromTableCell(editor.dom, editor.selection.getStart());\n      editor.fire('SetContent', args);\n      editor.addVisual();\n    };\n    var processValue = function (value) {\n      var details;\n      if (typeof value !== 'string') {\n        details = Tools.extend({\n          paste: value.paste,\n          data: { paste: value.paste }\n        }, value);\n        return {\n          content: value.content,\n          details: details\n        };\n      }\n      return {\n        content: value,\n        details: {}\n      };\n    };\n    var insertAtCaret$1 = function (editor, value) {\n      var result = processValue(value);\n      insertHtmlAtCaret(editor, result.content, result.details);\n    };\n    var InsertContent = { insertAtCaret: insertAtCaret$1 };\n\n    var strongRtl = /[\\u0591-\\u07FF\\uFB1D-\\uFDFF\\uFE70-\\uFEFC]/;\n    var hasStrongRtl = function (text) {\n      return strongRtl.test(text);\n    };\n\n    var getBodySetting = function (editor, name, defaultValue) {\n      var value = editor.getParam(name, defaultValue);\n      if (value.indexOf('=') !== -1) {\n        var bodyObj = editor.getParam(name, '', 'hash');\n        return bodyObj.hasOwnProperty(editor.id) ? bodyObj[editor.id] : defaultValue;\n      } else {\n        return value;\n      }\n    };\n    var getIframeAttrs = function (editor) {\n      return editor.getParam('iframe_attrs', {});\n    };\n    var getDocType = function (editor) {\n      return editor.getParam('doctype', '<!DOCTYPE html>');\n    };\n    var getDocumentBaseUrl = function (editor) {\n      return editor.getParam('document_base_url', '');\n    };\n    var getBodyId = function (editor) {\n      return getBodySetting(editor, 'body_id', 'tinymce');\n    };\n    var getBodyClass = function (editor) {\n      return getBodySetting(editor, 'body_class', '');\n    };\n    var getContentSecurityPolicy = function (editor) {\n      return editor.getParam('content_security_policy', '');\n    };\n    var shouldPutBrInPre = function (editor) {\n      return editor.getParam('br_in_pre', true);\n    };\n    var getForcedRootBlock = function (editor) {\n      if (editor.getParam('force_p_newlines', false)) {\n        return 'p';\n      }\n      var block = editor.getParam('forced_root_block', 'p');\n      return block === false ? '' : block;\n    };\n    var getForcedRootBlockAttrs = function (editor) {\n      return editor.getParam('forced_root_block_attrs', {});\n    };\n    var getBrNewLineSelector = function (editor) {\n      return editor.getParam('br_newline_selector', '.mce-toc h2,figcaption,caption');\n    };\n    var getNoNewLineSelector = function (editor) {\n      return editor.getParam('no_newline_selector', '');\n    };\n    var shouldKeepStyles = function (editor) {\n      return editor.getParam('keep_styles', true);\n    };\n    var shouldEndContainerOnEmptyBlock = function (editor) {\n      return editor.getParam('end_container_on_empty_block', false);\n    };\n    var getFontStyleValues = function (editor) {\n      return Tools.explode(editor.getParam('font_size_style_values', ''));\n    };\n    var getFontSizeClasses = function (editor) {\n      return Tools.explode(editor.getParam('font_size_classes', ''));\n    };\n    var getImagesDataImgFilter = function (editor) {\n      return editor.getParam('images_dataimg_filter', constant(true), 'function');\n    };\n    var isAutomaticUploadsEnabled = function (editor) {\n      return editor.getParam('automatic_uploads', true, 'boolean');\n    };\n    var shouldReuseFileName = function (editor) {\n      return editor.getParam('images_reuse_filename', false, 'boolean');\n    };\n    var shouldReplaceBlobUris = function (editor) {\n      return editor.getParam('images_replace_blob_uris', true, 'boolean');\n    };\n    var getImageUploadUrl = function (editor) {\n      return editor.getParam('images_upload_url', '', 'string');\n    };\n    var getImageUploadBasePath = function (editor) {\n      return editor.getParam('images_upload_base_path', '', 'string');\n    };\n    var getImagesUploadCredentials = function (editor) {\n      return editor.getParam('images_upload_credentials', false, 'boolean');\n    };\n    var getImagesUploadHandler = function (editor) {\n      return editor.getParam('images_upload_handler', null, 'function');\n    };\n    var shouldUseContentCssCors = function (editor) {\n      return editor.getParam('content_css_cors', false, 'boolean');\n    };\n    var getInlineBoundarySelector = function (editor) {\n      return editor.getParam('inline_boundaries_selector', 'a[href],code,.mce-annotation', 'string');\n    };\n    var Settings = {\n      getIframeAttrs: getIframeAttrs,\n      getDocType: getDocType,\n      getDocumentBaseUrl: getDocumentBaseUrl,\n      getBodyId: getBodyId,\n      getBodyClass: getBodyClass,\n      getContentSecurityPolicy: getContentSecurityPolicy,\n      shouldPutBrInPre: shouldPutBrInPre,\n      getForcedRootBlock: getForcedRootBlock,\n      getForcedRootBlockAttrs: getForcedRootBlockAttrs,\n      getBrNewLineSelector: getBrNewLineSelector,\n      getNoNewLineSelector: getNoNewLineSelector,\n      shouldKeepStyles: shouldKeepStyles,\n      shouldEndContainerOnEmptyBlock: shouldEndContainerOnEmptyBlock,\n      getFontStyleValues: getFontStyleValues,\n      getFontSizeClasses: getFontSizeClasses,\n      getImagesDataImgFilter: getImagesDataImgFilter,\n      isAutomaticUploadsEnabled: isAutomaticUploadsEnabled,\n      shouldReuseFileName: shouldReuseFileName,\n      shouldReplaceBlobUris: shouldReplaceBlobUris,\n      getImageUploadUrl: getImageUploadUrl,\n      getImageUploadBasePath: getImageUploadBasePath,\n      getImagesUploadCredentials: getImagesUploadCredentials,\n      getImagesUploadHandler: getImagesUploadHandler,\n      shouldUseContentCssCors: shouldUseContentCssCors,\n      getInlineBoundarySelector: getInlineBoundarySelector\n    };\n\n    var isInlineTarget = function (editor, elm) {\n      return is$1(Element.fromDom(elm), Settings.getInlineBoundarySelector(editor));\n    };\n    var isRtl = function (element) {\n      return DOMUtils$1.DOM.getStyle(element, 'direction', true) === 'rtl' || hasStrongRtl(element.textContent);\n    };\n    var findInlineParents = function (isInlineTarget, rootNode, pos) {\n      return filter(DOMUtils$1.DOM.getParents(pos.container(), '*', rootNode), isInlineTarget);\n    };\n    var findRootInline = function (isInlineTarget, rootNode, pos) {\n      var parents = findInlineParents(isInlineTarget, rootNode, pos);\n      return Option.from(parents[parents.length - 1]);\n    };\n    var hasSameParentBlock = function (rootNode, node1, node2) {\n      var block1 = getParentBlock(node1, rootNode);\n      var block2 = getParentBlock(node2, rootNode);\n      return block1 && block1 === block2;\n    };\n    var isAtZwsp = function (pos) {\n      return isBeforeInline(pos) || isAfterInline(pos);\n    };\n    var normalizePosition = function (forward, pos) {\n      if (!pos) {\n        return pos;\n      }\n      var container = pos.container(), offset = pos.offset();\n      if (forward) {\n        if (isCaretContainerInline(container)) {\n          if (NodeType.isText(container.nextSibling)) {\n            return CaretPosition$1(container.nextSibling, 0);\n          } else {\n            return CaretPosition$1.after(container);\n          }\n        } else {\n          return isBeforeInline(pos) ? CaretPosition$1(container, offset + 1) : pos;\n        }\n      } else {\n        if (isCaretContainerInline(container)) {\n          if (NodeType.isText(container.previousSibling)) {\n            return CaretPosition$1(container.previousSibling, container.previousSibling.data.length);\n          } else {\n            return CaretPosition$1.before(container);\n          }\n        } else {\n          return isAfterInline(pos) ? CaretPosition$1(container, offset - 1) : pos;\n        }\n      }\n    };\n    var normalizeForwards = curry(normalizePosition, true);\n    var normalizeBackwards = curry(normalizePosition, false);\n    var InlineUtils = {\n      isInlineTarget: isInlineTarget,\n      findRootInline: findRootInline,\n      isRtl: isRtl,\n      isAtZwsp: isAtZwsp,\n      normalizePosition: normalizePosition,\n      normalizeForwards: normalizeForwards,\n      normalizeBackwards: normalizeBackwards,\n      hasSameParentBlock: hasSameParentBlock\n    };\n\n    var isBeforeRoot = function (rootNode) {\n      return function (elm) {\n        return eq(rootNode, Element.fromDom(elm.dom().parentNode));\n      };\n    };\n    var getParentBlock$1 = function (rootNode, elm) {\n      return contains$3(rootNode, elm) ? closest(elm, function (element) {\n        return isTextBlock(element) || isListItem(element);\n      }, isBeforeRoot(rootNode)) : Option.none();\n    };\n    var placeCaretInEmptyBody = function (editor) {\n      var body = editor.getBody();\n      var node = body.firstChild && editor.dom.isBlock(body.firstChild) ? body.firstChild : body;\n      editor.selection.setCursorLocation(node, 0);\n    };\n    var paddEmptyBody = function (editor) {\n      if (editor.dom.isEmpty(editor.getBody())) {\n        editor.setContent('');\n        placeCaretInEmptyBody(editor);\n      }\n    };\n    var willDeleteLastPositionInElement = function (forward, fromPos, elm) {\n      return lift2(CaretFinder.firstPositionIn(elm), CaretFinder.lastPositionIn(elm), function (firstPos, lastPos) {\n        var normalizedFirstPos = InlineUtils.normalizePosition(true, firstPos);\n        var normalizedLastPos = InlineUtils.normalizePosition(false, lastPos);\n        var normalizedFromPos = InlineUtils.normalizePosition(false, fromPos);\n        if (forward) {\n          return CaretFinder.nextPosition(elm, normalizedFromPos).map(function (nextPos) {\n            return nextPos.isEqual(normalizedLastPos) && fromPos.isEqual(normalizedFirstPos);\n          }).getOr(false);\n        } else {\n          return CaretFinder.prevPosition(elm, normalizedFromPos).map(function (prevPos) {\n            return prevPos.isEqual(normalizedFirstPos) && fromPos.isEqual(normalizedLastPos);\n          }).getOr(false);\n        }\n      }).getOr(true);\n    };\n    var DeleteUtils = {\n      getParentBlock: getParentBlock$1,\n      paddEmptyBody: paddEmptyBody,\n      willDeleteLastPositionInElement: willDeleteLastPositionInElement\n    };\n\n    var ancestor$2 = function (scope, selector, isRoot) {\n      return ancestor$1(scope, selector, isRoot).isSome();\n    };\n\n    var hasWhitespacePreserveParent = function (rootNode, node) {\n      var rootElement = Element.fromDom(rootNode);\n      var startNode = Element.fromDom(node);\n      return ancestor$2(startNode, 'pre,code', curry(eq, rootElement));\n    };\n    var isWhitespace = function (rootNode, node) {\n      return NodeType.isText(node) && /^[ \\t\\r\\n]*$/.test(node.data) && hasWhitespacePreserveParent(rootNode, node) === false;\n    };\n    var isNamedAnchor = function (node) {\n      return NodeType.isElement(node) && node.nodeName === 'A' && node.hasAttribute('name');\n    };\n    var isContent = function (rootNode, node) {\n      return isCaretCandidate(node) && isWhitespace(rootNode, node) === false || isNamedAnchor(node) || isBookmark(node);\n    };\n    var isBookmark = NodeType.hasAttribute('data-mce-bookmark');\n    var isBogus$2 = NodeType.hasAttribute('data-mce-bogus');\n    var isBogusAll$1 = NodeType.hasAttributeValue('data-mce-bogus', 'all');\n    var isEmptyNode = function (targetNode) {\n      var walker, node, brCount = 0;\n      if (isContent(targetNode, targetNode)) {\n        return false;\n      } else {\n        node = targetNode.firstChild;\n        if (!node) {\n          return true;\n        }\n        walker = new TreeWalker(node, targetNode);\n        do {\n          if (isBogusAll$1(node)) {\n            node = walker.next(true);\n            continue;\n          }\n          if (isBogus$2(node)) {\n            node = walker.next();\n            continue;\n          }\n          if (NodeType.isBr(node)) {\n            brCount++;\n            node = walker.next();\n            continue;\n          }\n          if (isContent(targetNode, node)) {\n            return false;\n          }\n          node = walker.next();\n        } while (node);\n        return brCount <= 1;\n      }\n    };\n    var isEmpty$1 = function (elm) {\n      return isEmptyNode(elm.dom());\n    };\n    var Empty = { isEmpty: isEmpty$1 };\n\n    var BlockPosition = Immutable('block', 'position');\n    var BlockBoundary = Immutable('from', 'to');\n    var getBlockPosition = function (rootNode, pos) {\n      var rootElm = Element.fromDom(rootNode);\n      var containerElm = Element.fromDom(pos.container());\n      return DeleteUtils.getParentBlock(rootElm, containerElm).map(function (block) {\n        return BlockPosition(block, pos);\n      });\n    };\n    var isDifferentBlocks = function (blockBoundary) {\n      return eq(blockBoundary.from().block(), blockBoundary.to().block()) === false;\n    };\n    var hasSameParent = function (blockBoundary) {\n      return parent(blockBoundary.from().block()).bind(function (parent1) {\n        return parent(blockBoundary.to().block()).filter(function (parent2) {\n          return eq(parent1, parent2);\n        });\n      }).isSome();\n    };\n    var isEditable = function (blockBoundary) {\n      return NodeType.isContentEditableFalse(blockBoundary.from().block().dom()) === false && NodeType.isContentEditableFalse(blockBoundary.to().block().dom()) === false;\n    };\n    var skipLastBr = function (rootNode, forward, blockPosition) {\n      if (NodeType.isBr(blockPosition.position().getNode()) && Empty.isEmpty(blockPosition.block()) === false) {\n        return CaretFinder.positionIn(false, blockPosition.block().dom()).bind(function (lastPositionInBlock) {\n          if (lastPositionInBlock.isEqual(blockPosition.position())) {\n            return CaretFinder.fromPosition(forward, rootNode, lastPositionInBlock).bind(function (to) {\n              return getBlockPosition(rootNode, to);\n            });\n          } else {\n            return Option.some(blockPosition);\n          }\n        }).getOr(blockPosition);\n      } else {\n        return blockPosition;\n      }\n    };\n    var readFromRange = function (rootNode, forward, rng) {\n      var fromBlockPos = getBlockPosition(rootNode, CaretPosition$1.fromRangeStart(rng));\n      var toBlockPos = fromBlockPos.bind(function (blockPos) {\n        return CaretFinder.fromPosition(forward, rootNode, blockPos.position()).bind(function (to) {\n          return getBlockPosition(rootNode, to).map(function (blockPos) {\n            return skipLastBr(rootNode, forward, blockPos);\n          });\n        });\n      });\n      return lift2(fromBlockPos, toBlockPos, BlockBoundary).filter(function (blockBoundary) {\n        return isDifferentBlocks(blockBoundary) && hasSameParent(blockBoundary) && isEditable(blockBoundary);\n      });\n    };\n    var read$1 = function (rootNode, forward, rng) {\n      return rng.collapsed ? readFromRange(rootNode, forward, rng) : Option.none();\n    };\n    var BlockMergeBoundary = { read: read$1 };\n\n    var dropLast = function (xs) {\n      return xs.slice(0, -1);\n    };\n    var parentsUntil$1 = function (start, root, predicate) {\n      if (contains$3(root, start)) {\n        return dropLast(parents(start, function (elm) {\n          return predicate(elm) || eq(elm, root);\n        }));\n      } else {\n        return [];\n      }\n    };\n    var parents$1 = function (start, root) {\n      return parentsUntil$1(start, root, constant(false));\n    };\n    var parentsAndSelf = function (start, root) {\n      return [start].concat(parents$1(start, root));\n    };\n    var Parents = {\n      parentsUntil: parentsUntil$1,\n      parents: parents$1,\n      parentsAndSelf: parentsAndSelf\n    };\n\n    var getChildrenUntilBlockBoundary = function (block) {\n      var children$1 = children(block);\n      return findIndex(children$1, isBlock).fold(function () {\n        return children$1;\n      }, function (index) {\n        return children$1.slice(0, index);\n      });\n    };\n    var extractChildren = function (block) {\n      var children = getChildrenUntilBlockBoundary(block);\n      each(children, remove$1);\n      return children;\n    };\n    var removeEmptyRoot = function (rootNode, block) {\n      var parents = Parents.parentsAndSelf(block, rootNode);\n      return find(parents.reverse(), Empty.isEmpty).each(remove$1);\n    };\n    var isEmptyBefore = function (el) {\n      return filter(prevSiblings(el), function (el) {\n        return !Empty.isEmpty(el);\n      }).length === 0;\n    };\n    var nestedBlockMerge = function (rootNode, fromBlock, toBlock, insertionPoint) {\n      if (Empty.isEmpty(toBlock)) {\n        PaddingBr.fillWithPaddingBr(toBlock);\n        return CaretFinder.firstPositionIn(toBlock.dom());\n      }\n      if (isEmptyBefore(insertionPoint) && Empty.isEmpty(fromBlock)) {\n        before(insertionPoint, Element.fromTag('br'));\n      }\n      var position = CaretFinder.prevPosition(toBlock.dom(), CaretPosition$1.before(insertionPoint.dom()));\n      each(extractChildren(fromBlock), function (child) {\n        before(insertionPoint, child);\n      });\n      removeEmptyRoot(rootNode, fromBlock);\n      return position;\n    };\n    var sidelongBlockMerge = function (rootNode, fromBlock, toBlock) {\n      if (Empty.isEmpty(toBlock)) {\n        remove$1(toBlock);\n        if (Empty.isEmpty(fromBlock)) {\n          PaddingBr.fillWithPaddingBr(fromBlock);\n        }\n        return CaretFinder.firstPositionIn(fromBlock.dom());\n      }\n      var position = CaretFinder.lastPositionIn(toBlock.dom());\n      each(extractChildren(fromBlock), function (child) {\n        append(toBlock, child);\n      });\n      removeEmptyRoot(rootNode, fromBlock);\n      return position;\n    };\n    var findInsertionPoint = function (toBlock, block) {\n      var parentsAndSelf = Parents.parentsAndSelf(block, toBlock);\n      return Option.from(parentsAndSelf[parentsAndSelf.length - 1]);\n    };\n    var getInsertionPoint = function (fromBlock, toBlock) {\n      return contains$3(toBlock, fromBlock) ? findInsertionPoint(toBlock, fromBlock) : Option.none();\n    };\n    var trimBr = function (first, block) {\n      CaretFinder.positionIn(first, block.dom()).map(function (position) {\n        return position.getNode();\n      }).map(Element.fromDom).filter(isBr).each(remove$1);\n    };\n    var mergeBlockInto = function (rootNode, fromBlock, toBlock) {\n      trimBr(true, fromBlock);\n      trimBr(false, toBlock);\n      return getInsertionPoint(fromBlock, toBlock).fold(curry(sidelongBlockMerge, rootNode, fromBlock, toBlock), curry(nestedBlockMerge, rootNode, fromBlock, toBlock));\n    };\n    var mergeBlocks = function (rootNode, forward, block1, block2) {\n      return forward ? mergeBlockInto(rootNode, block2, block1) : mergeBlockInto(rootNode, block1, block2);\n    };\n    var MergeBlocks = { mergeBlocks: mergeBlocks };\n\n    var backspaceDelete = function (editor, forward) {\n      var position;\n      var rootNode = Element.fromDom(editor.getBody());\n      position = BlockMergeBoundary.read(rootNode.dom(), forward, editor.selection.getRng()).bind(function (blockBoundary) {\n        return MergeBlocks.mergeBlocks(rootNode, forward, blockBoundary.from().block(), blockBoundary.to().block());\n      });\n      position.each(function (pos) {\n        editor.selection.setRng(pos.toRange());\n      });\n      return position.isSome();\n    };\n    var BlockBoundaryDelete = { backspaceDelete: backspaceDelete };\n\n    var deleteRangeMergeBlocks = function (rootNode, selection) {\n      var rng = selection.getRng();\n      return lift2(DeleteUtils.getParentBlock(rootNode, Element.fromDom(rng.startContainer)), DeleteUtils.getParentBlock(rootNode, Element.fromDom(rng.endContainer)), function (block1, block2) {\n        if (eq(block1, block2) === false) {\n          rng.deleteContents();\n          MergeBlocks.mergeBlocks(rootNode, true, block1, block2).each(function (pos) {\n            selection.setRng(pos.toRange());\n          });\n          return true;\n        } else {\n          return false;\n        }\n      }).getOr(false);\n    };\n    var isRawNodeInTable = function (root, rawNode) {\n      var node = Element.fromDom(rawNode);\n      var isRoot = curry(eq, root);\n      return ancestor(node, isTableCell, isRoot).isSome();\n    };\n    var isSelectionInTable = function (root, rng) {\n      return isRawNodeInTable(root, rng.startContainer) || isRawNodeInTable(root, rng.endContainer);\n    };\n    var isEverythingSelected = function (root, rng) {\n      var noPrevious = CaretFinder.prevPosition(root.dom(), CaretPosition$1.fromRangeStart(rng)).isNone();\n      var noNext = CaretFinder.nextPosition(root.dom(), CaretPosition$1.fromRangeEnd(rng)).isNone();\n      return !isSelectionInTable(root, rng) && noPrevious && noNext;\n    };\n    var emptyEditor = function (editor) {\n      editor.setContent('');\n      editor.selection.setCursorLocation();\n      return true;\n    };\n    var deleteRange = function (editor) {\n      var rootNode = Element.fromDom(editor.getBody());\n      var rng = editor.selection.getRng();\n      return isEverythingSelected(rootNode, rng) ? emptyEditor(editor) : deleteRangeMergeBlocks(rootNode, editor.selection);\n    };\n    var backspaceDelete$1 = function (editor, forward) {\n      return editor.selection.isCollapsed() ? false : deleteRange(editor);\n    };\n    var BlockRangeDelete = { backspaceDelete: backspaceDelete$1 };\n\n    var generate$1 = function (cases) {\n      if (!isArray(cases)) {\n        throw new Error('cases must be an array');\n      }\n      if (cases.length === 0) {\n        throw new Error('there must be at least one case');\n      }\n      var constructors = [];\n      var adt = {};\n      each(cases, function (acase, count) {\n        var keys$1 = keys(acase);\n        if (keys$1.length !== 1) {\n          throw new Error('one and only one name per case');\n        }\n        var key = keys$1[0];\n        var value = acase[key];\n        if (adt[key] !== undefined) {\n          throw new Error('duplicate key detected:' + key);\n        } else if (key === 'cata') {\n          throw new Error('cannot have a case named cata (sorry)');\n        } else if (!isArray(value)) {\n          throw new Error('case arguments must be an array');\n        }\n        constructors.push(key);\n        adt[key] = function () {\n          var argLength = arguments.length;\n          if (argLength !== value.length) {\n            throw new Error('Wrong number of arguments to case ' + key + '. Expected ' + value.length + ' (' + value + '), got ' + argLength);\n          }\n          var args = new Array(argLength);\n          for (var i = 0; i < args.length; i++) {\n            args[i] = arguments[i];\n          }\n          var match = function (branches) {\n            var branchKeys = keys(branches);\n            if (constructors.length !== branchKeys.length) {\n              throw new Error('Wrong number of arguments to match. Expected: ' + constructors.join(',') + '\\nActual: ' + branchKeys.join(','));\n            }\n            var allReqd = forall(constructors, function (reqKey) {\n              return contains(branchKeys, reqKey);\n            });\n            if (!allReqd) {\n              throw new Error('Not all branches were specified when using match. Specified: ' + branchKeys.join(', ') + '\\nRequired: ' + constructors.join(', '));\n            }\n            return branches[key].apply(null, args);\n          };\n          return {\n            fold: function () {\n              if (arguments.length !== cases.length) {\n                throw new Error('Wrong number of arguments to fold. Expected ' + cases.length + ', got ' + arguments.length);\n              }\n              var target = arguments[count];\n              return target.apply(null, args);\n            },\n            match: match,\n            log: function (label) {\n              domGlobals.console.log(label, {\n                constructors: constructors,\n                constructor: key,\n                params: args\n              });\n            }\n          };\n        };\n      });\n      return adt;\n    };\n    var Adt = { generate: generate$1 };\n\n    var isBr$5 = function (pos) {\n      return getElementFromPosition(pos).exists(isBr);\n    };\n    var findBr = function (forward, root, pos) {\n      var parentBlocks = filter(Parents.parentsAndSelf(Element.fromDom(pos.container()), root), isBlock);\n      var scope = head(parentBlocks).getOr(root);\n      return CaretFinder.fromPosition(forward, scope.dom(), pos).filter(isBr$5);\n    };\n    var isBeforeBr = function (root, pos) {\n      return getElementFromPosition(pos).exists(isBr) || findBr(true, root, pos).isSome();\n    };\n    var isAfterBr = function (root, pos) {\n      return getElementFromPrevPosition(pos).exists(isBr) || findBr(false, root, pos).isSome();\n    };\n    var findPreviousBr = curry(findBr, false);\n    var findNextBr = curry(findBr, true);\n\n    var is$2 = function (expected) {\n      return function (actual) {\n        return expected === actual;\n      };\n    };\n    var isNbsp = is$2('\\xA0');\n    var isWhiteSpace$1 = function (chr) {\n      return /^[\\r\\n\\t ]$/.test(chr);\n    };\n    var isContent$1 = function (chr) {\n      return !isWhiteSpace$1(chr) && !isNbsp(chr);\n    };\n\n    var isChar = function (forward, predicate, pos) {\n      return Option.from(pos.container()).filter(NodeType.isText).exists(function (text) {\n        var delta = forward ? 0 : -1;\n        return predicate(text.data.charAt(pos.offset() + delta));\n      });\n    };\n    var isBeforeSpace = curry(isChar, true, isWhiteSpace$1);\n    var isAfterSpace = curry(isChar, false, isWhiteSpace$1);\n    var isEmptyText = function (pos) {\n      var container = pos.container();\n      return NodeType.isText(container) && container.data.length === 0;\n    };\n    var isNextToContentEditableFalse = function (relativeOffset, caretPosition) {\n      var node = getChildNodeAtRelativeOffset(relativeOffset, caretPosition);\n      return NodeType.isContentEditableFalse(node) && !NodeType.isBogusAll(node);\n    };\n    var isBeforeContentEditableFalse = curry(isNextToContentEditableFalse, 0);\n    var isAfterContentEditableFalse = curry(isNextToContentEditableFalse, -1);\n    var isNextToTable = function (relativeOffset, caretPosition) {\n      return NodeType.isTable(getChildNodeAtRelativeOffset(relativeOffset, caretPosition));\n    };\n    var isBeforeTable = curry(isNextToTable, 0);\n    var isAfterTable = curry(isNextToTable, -1);\n\n    var isCompoundElement = function (node) {\n      return isTableCell(Element.fromDom(node)) || isListItem(Element.fromDom(node));\n    };\n    var DeleteAction = Adt.generate([\n      { remove: ['element'] },\n      { moveToElement: ['element'] },\n      { moveToPosition: ['position'] }\n    ]);\n    var isAtContentEditableBlockCaret = function (forward, from) {\n      var elm = from.getNode(forward === false);\n      var caretLocation = forward ? 'after' : 'before';\n      return NodeType.isElement(elm) && elm.getAttribute('data-mce-caret') === caretLocation;\n    };\n    var isDeleteFromCefDifferentBlocks = function (root, forward, from, to) {\n      var inSameBlock = function (elm) {\n        return isInline(Element.fromDom(elm)) && !isInSameBlock(from, to, root);\n      };\n      return getRelativeCefElm(!forward, from).fold(function () {\n        return getRelativeCefElm(forward, to).fold(constant(false), inSameBlock);\n      }, inSameBlock);\n    };\n    var deleteEmptyBlockOrMoveToCef = function (root, forward, from, to) {\n      var toCefElm = to.getNode(forward === false);\n      return DeleteUtils.getParentBlock(Element.fromDom(root), Element.fromDom(from.getNode())).map(function (blockElm) {\n        return Empty.isEmpty(blockElm) ? DeleteAction.remove(blockElm.dom()) : DeleteAction.moveToElement(toCefElm);\n      }).orThunk(function () {\n        return Option.some(DeleteAction.moveToElement(toCefElm));\n      });\n    };\n    var findCefPosition = function (root, forward, from) {\n      return CaretFinder.fromPosition(forward, root, from).bind(function (to) {\n        if (isCompoundElement(to.getNode())) {\n          return Option.none();\n        } else if (isDeleteFromCefDifferentBlocks(root, forward, from, to)) {\n          return Option.none();\n        } else if (forward && NodeType.isContentEditableFalse(to.getNode())) {\n          return deleteEmptyBlockOrMoveToCef(root, forward, from, to);\n        } else if (forward === false && NodeType.isContentEditableFalse(to.getNode(true))) {\n          return deleteEmptyBlockOrMoveToCef(root, forward, from, to);\n        } else if (forward && isAfterContentEditableFalse(from)) {\n          return Option.some(DeleteAction.moveToPosition(to));\n        } else if (forward === false && isBeforeContentEditableFalse(from)) {\n          return Option.some(DeleteAction.moveToPosition(to));\n        } else {\n          return Option.none();\n        }\n      });\n    };\n    var getContentEditableBlockAction = function (forward, elm) {\n      if (forward && NodeType.isContentEditableFalse(elm.nextSibling)) {\n        return Option.some(DeleteAction.moveToElement(elm.nextSibling));\n      } else if (forward === false && NodeType.isContentEditableFalse(elm.previousSibling)) {\n        return Option.some(DeleteAction.moveToElement(elm.previousSibling));\n      } else {\n        return Option.none();\n      }\n    };\n    var skipMoveToActionFromInlineCefToContent = function (root, from, deleteAction) {\n      return deleteAction.fold(function (elm) {\n        return Option.some(DeleteAction.remove(elm));\n      }, function (elm) {\n        return Option.some(DeleteAction.moveToElement(elm));\n      }, function (to) {\n        if (isInSameBlock(from, to, root)) {\n          return Option.none();\n        } else {\n          return Option.some(DeleteAction.moveToPosition(to));\n        }\n      });\n    };\n    var getContentEditableAction = function (root, forward, from) {\n      if (isAtContentEditableBlockCaret(forward, from)) {\n        return getContentEditableBlockAction(forward, from.getNode(forward === false)).fold(function () {\n          return findCefPosition(root, forward, from);\n        }, Option.some);\n      } else {\n        return findCefPosition(root, forward, from).bind(function (deleteAction) {\n          return skipMoveToActionFromInlineCefToContent(root, from, deleteAction);\n        });\n      }\n    };\n    var read$2 = function (root, forward, rng) {\n      var normalizedRange = normalizeRange(forward ? 1 : -1, root, rng);\n      var from = CaretPosition$1.fromRangeStart(normalizedRange);\n      var rootElement = Element.fromDom(root);\n      if (forward === false && isAfterContentEditableFalse(from)) {\n        return Option.some(DeleteAction.remove(from.getNode(true)));\n      } else if (forward && isBeforeContentEditableFalse(from)) {\n        return Option.some(DeleteAction.remove(from.getNode()));\n      } else if (forward === false && isBeforeContentEditableFalse(from) && isAfterBr(rootElement, from)) {\n        return findPreviousBr(rootElement, from).map(function (br) {\n          return DeleteAction.remove(br.getNode());\n        });\n      } else if (forward && isAfterContentEditableFalse(from) && isBeforeBr(rootElement, from)) {\n        return findNextBr(rootElement, from).map(function (br) {\n          return DeleteAction.remove(br.getNode());\n        });\n      } else {\n        return getContentEditableAction(root, forward, from);\n      }\n    };\n\n    var isCollapsibleWhitespace = function (c) {\n      return ' \\f\\n\\r\\t\\x0B'.indexOf(c) !== -1;\n    };\n    var normalizeContent = function (content, isStartOfContent, isEndOfContent) {\n      var result = foldl(content.split(''), function (acc, c) {\n        if (isCollapsibleWhitespace(c) || c === '\\xA0') {\n          if (acc.previousCharIsSpace || acc.str === '' && isStartOfContent || acc.str.length === content.length - 1 && isEndOfContent) {\n            return {\n              previousCharIsSpace: false,\n              str: acc.str + '\\xA0'\n            };\n          } else {\n            return {\n              previousCharIsSpace: true,\n              str: acc.str + ' '\n            };\n          }\n        } else {\n          return {\n            previousCharIsSpace: false,\n            str: acc.str + c\n          };\n        }\n      }, {\n        previousCharIsSpace: false,\n        str: ''\n      });\n      return result.str;\n    };\n    var normalize$1 = function (node, offset, count) {\n      if (count === 0) {\n        return;\n      }\n      var whitespace = node.data.slice(offset, offset + count);\n      var isEndOfContent = offset + count >= node.data.length;\n      var isStartOfContent = offset === 0;\n      node.replaceData(offset, count, normalizeContent(whitespace, isStartOfContent, isEndOfContent));\n    };\n    var normalizeWhitespaceAfter = function (node, offset) {\n      var content = node.data.slice(offset);\n      var whitespaceCount = content.length - lTrim(content).length;\n      return normalize$1(node, offset, whitespaceCount);\n    };\n    var normalizeWhitespaceBefore = function (node, offset) {\n      var content = node.data.slice(0, offset);\n      var whitespaceCount = content.length - rTrim(content).length;\n      return normalize$1(node, offset - whitespaceCount, whitespaceCount);\n    };\n    var mergeTextNodes = function (prevNode, nextNode, normalizeWhitespace) {\n      var whitespaceOffset = rTrim(prevNode.data).length;\n      prevNode.appendData(nextNode.data);\n      remove$1(Element.fromDom(nextNode));\n      if (normalizeWhitespace) {\n        normalizeWhitespaceAfter(prevNode, whitespaceOffset);\n      }\n      return prevNode;\n    };\n\n    var needsReposition = function (pos, elm) {\n      var container = pos.container();\n      var offset = pos.offset();\n      return CaretPosition$1.isTextPosition(pos) === false && container === elm.parentNode && offset > CaretPosition$1.before(elm).offset();\n    };\n    var reposition = function (elm, pos) {\n      return needsReposition(pos, elm) ? CaretPosition$1(pos.container(), pos.offset() - 1) : pos;\n    };\n    var beforeOrStartOf = function (node) {\n      return NodeType.isText(node) ? CaretPosition$1(node, 0) : CaretPosition$1.before(node);\n    };\n    var afterOrEndOf = function (node) {\n      return NodeType.isText(node) ? CaretPosition$1(node, node.data.length) : CaretPosition$1.after(node);\n    };\n    var getPreviousSiblingCaretPosition = function (elm) {\n      if (isCaretCandidate(elm.previousSibling)) {\n        return Option.some(afterOrEndOf(elm.previousSibling));\n      } else {\n        return elm.previousSibling ? CaretFinder.lastPositionIn(elm.previousSibling) : Option.none();\n      }\n    };\n    var getNextSiblingCaretPosition = function (elm) {\n      if (isCaretCandidate(elm.nextSibling)) {\n        return Option.some(beforeOrStartOf(elm.nextSibling));\n      } else {\n        return elm.nextSibling ? CaretFinder.firstPositionIn(elm.nextSibling) : Option.none();\n      }\n    };\n    var findCaretPositionBackwardsFromElm = function (rootElement, elm) {\n      var startPosition = CaretPosition$1.before(elm.previousSibling ? elm.previousSibling : elm.parentNode);\n      return CaretFinder.prevPosition(rootElement, startPosition).fold(function () {\n        return CaretFinder.nextPosition(rootElement, CaretPosition$1.after(elm));\n      }, Option.some);\n    };\n    var findCaretPositionForwardsFromElm = function (rootElement, elm) {\n      return CaretFinder.nextPosition(rootElement, CaretPosition$1.after(elm)).fold(function () {\n        return CaretFinder.prevPosition(rootElement, CaretPosition$1.before(elm));\n      }, Option.some);\n    };\n    var findCaretPositionBackwards = function (rootElement, elm) {\n      return getPreviousSiblingCaretPosition(elm).orThunk(function () {\n        return getNextSiblingCaretPosition(elm);\n      }).orThunk(function () {\n        return findCaretPositionBackwardsFromElm(rootElement, elm);\n      });\n    };\n    var findCaretPositionForward = function (rootElement, elm) {\n      return getNextSiblingCaretPosition(elm).orThunk(function () {\n        return getPreviousSiblingCaretPosition(elm);\n      }).orThunk(function () {\n        return findCaretPositionForwardsFromElm(rootElement, elm);\n      });\n    };\n    var findCaretPosition$1 = function (forward, rootElement, elm) {\n      return forward ? findCaretPositionForward(rootElement, elm) : findCaretPositionBackwards(rootElement, elm);\n    };\n    var findCaretPosOutsideElmAfterDelete = function (forward, rootElement, elm) {\n      return findCaretPosition$1(forward, rootElement, elm).map(curry(reposition, elm));\n    };\n    var setSelection = function (editor, forward, pos) {\n      pos.fold(function () {\n        editor.focus();\n      }, function (pos) {\n        editor.selection.setRng(pos.toRange(), forward);\n      });\n    };\n    var eqRawNode = function (rawNode) {\n      return function (elm) {\n        return elm.dom() === rawNode;\n      };\n    };\n    var isBlock$2 = function (editor, elm) {\n      return elm && editor.schema.getBlockElements().hasOwnProperty(name(elm));\n    };\n    var paddEmptyBlock = function (elm) {\n      if (Empty.isEmpty(elm)) {\n        var br = Element.fromHtml('<br data-mce-bogus=\"1\">');\n        empty(elm);\n        append(elm, br);\n        return Option.some(CaretPosition$1.before(br.dom()));\n      } else {\n        return Option.none();\n      }\n    };\n    var deleteNormalized = function (elm, afterDeletePosOpt, normalizeWhitespace) {\n      var prevTextOpt = prevSibling(elm).filter(isText);\n      var nextTextOpt = nextSibling(elm).filter(isText);\n      remove$1(elm);\n      return lift3(prevTextOpt, nextTextOpt, afterDeletePosOpt, function (prev, next, pos) {\n        var prevNode = prev.dom(), nextNode = next.dom();\n        var offset = prevNode.data.length;\n        mergeTextNodes(prevNode, nextNode, normalizeWhitespace);\n        return pos.container() === nextNode ? CaretPosition$1(prevNode, offset) : pos;\n      }).orThunk(function () {\n        if (normalizeWhitespace) {\n          prevTextOpt.each(function (elm) {\n            return normalizeWhitespaceBefore(elm.dom(), elm.dom().length);\n          });\n          nextTextOpt.each(function (elm) {\n            return normalizeWhitespaceAfter(elm.dom(), 0);\n          });\n        }\n        return afterDeletePosOpt;\n      });\n    };\n    var isInlineElement = function (editor, element) {\n      return has(editor.schema.getTextInlineElements(), name(element));\n    };\n    var deleteElement = function (editor, forward, elm, moveCaret) {\n      if (moveCaret === void 0) {\n        moveCaret = true;\n      }\n      var afterDeletePos = findCaretPosOutsideElmAfterDelete(forward, editor.getBody(), elm.dom());\n      var parentBlock = ancestor(elm, curry(isBlock$2, editor), eqRawNode(editor.getBody()));\n      var normalizedAfterDeletePos = deleteNormalized(elm, afterDeletePos, isInlineElement(editor, elm));\n      if (editor.dom.isEmpty(editor.getBody())) {\n        editor.setContent('');\n        editor.selection.setCursorLocation();\n      } else {\n        parentBlock.bind(paddEmptyBlock).fold(function () {\n          if (moveCaret) {\n            setSelection(editor, forward, normalizedAfterDeletePos);\n          }\n        }, function (paddPos) {\n          if (moveCaret) {\n            setSelection(editor, forward, Option.some(paddPos));\n          }\n        });\n      }\n    };\n    var DeleteElement = { deleteElement: deleteElement };\n\n    var deleteElement$1 = function (editor, forward) {\n      return function (element) {\n        editor._selectionOverrides.hideFakeCaret();\n        DeleteElement.deleteElement(editor, forward, Element.fromDom(element));\n        return true;\n      };\n    };\n    var moveToElement = function (editor, forward) {\n      return function (element) {\n        var pos = forward ? CaretPosition$1.before(element) : CaretPosition$1.after(element);\n        editor.selection.setRng(pos.toRange());\n        return true;\n      };\n    };\n    var moveToPosition = function (editor) {\n      return function (pos) {\n        editor.selection.setRng(pos.toRange());\n        return true;\n      };\n    };\n    var backspaceDeleteCaret = function (editor, forward) {\n      var result = read$2(editor.getBody(), forward, editor.selection.getRng()).map(function (deleteAction) {\n        return deleteAction.fold(deleteElement$1(editor, forward), moveToElement(editor, forward), moveToPosition(editor));\n      });\n      return result.getOr(false);\n    };\n    var deleteOffscreenSelection = function (rootElement) {\n      each(descendants$1(rootElement, '.mce-offscreen-selection'), remove$1);\n    };\n    var backspaceDeleteRange = function (editor, forward) {\n      var selectedElement = editor.selection.getNode();\n      if (NodeType.isContentEditableFalse(selectedElement)) {\n        deleteOffscreenSelection(Element.fromDom(editor.getBody()));\n        DeleteElement.deleteElement(editor, forward, Element.fromDom(editor.selection.getNode()));\n        DeleteUtils.paddEmptyBody(editor);\n        return true;\n      } else {\n        return false;\n      }\n    };\n    var getContentEditableRoot = function (root, node) {\n      while (node && node !== root) {\n        if (NodeType.isContentEditableTrue(node) || NodeType.isContentEditableFalse(node)) {\n          return node;\n        }\n        node = node.parentNode;\n      }\n      return null;\n    };\n    var paddEmptyElement = function (editor) {\n      var br;\n      var ceRoot = getContentEditableRoot(editor.getBody(), editor.selection.getNode());\n      if (NodeType.isContentEditableTrue(ceRoot) && editor.dom.isBlock(ceRoot) && editor.dom.isEmpty(ceRoot)) {\n        br = editor.dom.create('br', { 'data-mce-bogus': '1' });\n        editor.dom.setHTML(ceRoot, '');\n        ceRoot.appendChild(br);\n        editor.selection.setRng(CaretPosition$1.before(br).toRange());\n      }\n      return true;\n    };\n    var backspaceDelete$2 = function (editor, forward) {\n      if (editor.selection.isCollapsed()) {\n        return backspaceDeleteCaret(editor, forward);\n      } else {\n        return backspaceDeleteRange(editor, forward);\n      }\n    };\n    var CefDelete = {\n      backspaceDelete: backspaceDelete$2,\n      paddEmptyElement: paddEmptyElement\n    };\n\n    var isText$8 = NodeType.isText;\n    var startsWithCaretContainer$1 = function (node) {\n      return isText$8(node) && node.data[0] === Zwsp.ZWSP;\n    };\n    var endsWithCaretContainer$1 = function (node) {\n      return isText$8(node) && node.data[node.data.length - 1] === Zwsp.ZWSP;\n    };\n    var createZwsp = function (node) {\n      return node.ownerDocument.createTextNode(Zwsp.ZWSP);\n    };\n    var insertBefore$1 = function (node) {\n      if (isText$8(node.previousSibling)) {\n        if (endsWithCaretContainer$1(node.previousSibling)) {\n          return node.previousSibling;\n        } else {\n          node.previousSibling.appendData(Zwsp.ZWSP);\n          return node.previousSibling;\n        }\n      } else if (isText$8(node)) {\n        if (startsWithCaretContainer$1(node)) {\n          return node;\n        } else {\n          node.insertData(0, Zwsp.ZWSP);\n          return node;\n        }\n      } else {\n        var newNode = createZwsp(node);\n        node.parentNode.insertBefore(newNode, node);\n        return newNode;\n      }\n    };\n    var insertAfter$1 = function (node) {\n      if (isText$8(node.nextSibling)) {\n        if (startsWithCaretContainer$1(node.nextSibling)) {\n          return node.nextSibling;\n        } else {\n          node.nextSibling.insertData(0, Zwsp.ZWSP);\n          return node.nextSibling;\n        }\n      } else if (isText$8(node)) {\n        if (endsWithCaretContainer$1(node)) {\n          return node;\n        } else {\n          node.appendData(Zwsp.ZWSP);\n          return node;\n        }\n      } else {\n        var newNode = createZwsp(node);\n        if (node.nextSibling) {\n          node.parentNode.insertBefore(newNode, node.nextSibling);\n        } else {\n          node.parentNode.appendChild(newNode);\n        }\n        return newNode;\n      }\n    };\n    var insertInline$1 = function (before, node) {\n      return before ? insertBefore$1(node) : insertAfter$1(node);\n    };\n    var insertInlineBefore = curry(insertInline$1, true);\n    var insertInlineAfter = curry(insertInline$1, false);\n\n    var insertInlinePos = function (pos, before) {\n      if (NodeType.isText(pos.container())) {\n        return insertInline$1(before, pos.container());\n      } else {\n        return insertInline$1(before, pos.getNode());\n      }\n    };\n    var isPosCaretContainer = function (pos, caret) {\n      var caretNode = caret.get();\n      return caretNode && pos.container() === caretNode && isCaretContainerInline(caretNode);\n    };\n    var renderCaret = function (caret, location) {\n      return location.fold(function (element) {\n        CaretContainerRemove.remove(caret.get());\n        var text = insertInlineBefore(element);\n        caret.set(text);\n        return Option.some(CaretPosition$1(text, text.length - 1));\n      }, function (element) {\n        return CaretFinder.firstPositionIn(element).map(function (pos) {\n          if (!isPosCaretContainer(pos, caret)) {\n            CaretContainerRemove.remove(caret.get());\n            var text = insertInlinePos(pos, true);\n            caret.set(text);\n            return CaretPosition$1(text, 1);\n          } else {\n            return CaretPosition$1(caret.get(), 1);\n          }\n        });\n      }, function (element) {\n        return CaretFinder.lastPositionIn(element).map(function (pos) {\n          if (!isPosCaretContainer(pos, caret)) {\n            CaretContainerRemove.remove(caret.get());\n            var text = insertInlinePos(pos, false);\n            caret.set(text);\n            return CaretPosition$1(text, text.length - 1);\n          } else {\n            return CaretPosition$1(caret.get(), caret.get().length - 1);\n          }\n        });\n      }, function (element) {\n        CaretContainerRemove.remove(caret.get());\n        var text = insertInlineAfter(element);\n        caret.set(text);\n        return Option.some(CaretPosition$1(text, 1));\n      });\n    };\n    var BoundaryCaret = { renderCaret: renderCaret };\n\n    var evaluateUntil = function (fns, args) {\n      for (var i = 0; i < fns.length; i++) {\n        var result = fns[i].apply(null, args);\n        if (result.isSome()) {\n          return result;\n        }\n      }\n      return Option.none();\n    };\n    var LazyEvaluator = { evaluateUntil: evaluateUntil };\n\n    var Location = Adt.generate([\n      { before: ['element'] },\n      { start: ['element'] },\n      { end: ['element'] },\n      { after: ['element'] }\n    ]);\n    var rescope = function (rootNode, node) {\n      var parentBlock = getParentBlock(node, rootNode);\n      return parentBlock ? parentBlock : rootNode;\n    };\n    var before$3 = function (isInlineTarget, rootNode, pos) {\n      var nPos = InlineUtils.normalizeForwards(pos);\n      var scope = rescope(rootNode, nPos.container());\n      return InlineUtils.findRootInline(isInlineTarget, scope, nPos).fold(function () {\n        return CaretFinder.nextPosition(scope, nPos).bind(curry(InlineUtils.findRootInline, isInlineTarget, scope)).map(function (inline) {\n          return Location.before(inline);\n        });\n      }, Option.none);\n    };\n    var isNotInsideFormatCaretContainer = function (rootNode, elm) {\n      return getParentCaretContainer(rootNode, elm) === null;\n    };\n    var findInsideRootInline = function (isInlineTarget, rootNode, pos) {\n      return InlineUtils.findRootInline(isInlineTarget, rootNode, pos).filter(curry(isNotInsideFormatCaretContainer, rootNode));\n    };\n    var start = function (isInlineTarget, rootNode, pos) {\n      var nPos = InlineUtils.normalizeBackwards(pos);\n      return findInsideRootInline(isInlineTarget, rootNode, nPos).bind(function (inline) {\n        var prevPos = CaretFinder.prevPosition(inline, nPos);\n        return prevPos.isNone() ? Option.some(Location.start(inline)) : Option.none();\n      });\n    };\n    var end = function (isInlineTarget, rootNode, pos) {\n      var nPos = InlineUtils.normalizeForwards(pos);\n      return findInsideRootInline(isInlineTarget, rootNode, nPos).bind(function (inline) {\n        var nextPos = CaretFinder.nextPosition(inline, nPos);\n        return nextPos.isNone() ? Option.some(Location.end(inline)) : Option.none();\n      });\n    };\n    var after$2 = function (isInlineTarget, rootNode, pos) {\n      var nPos = InlineUtils.normalizeBackwards(pos);\n      var scope = rescope(rootNode, nPos.container());\n      return InlineUtils.findRootInline(isInlineTarget, scope, nPos).fold(function () {\n        return CaretFinder.prevPosition(scope, nPos).bind(curry(InlineUtils.findRootInline, isInlineTarget, scope)).map(function (inline) {\n          return Location.after(inline);\n        });\n      }, Option.none);\n    };\n    var isValidLocation = function (location) {\n      return InlineUtils.isRtl(getElement(location)) === false;\n    };\n    var readLocation = function (isInlineTarget, rootNode, pos) {\n      var location = LazyEvaluator.evaluateUntil([\n        before$3,\n        start,\n        end,\n        after$2\n      ], [\n        isInlineTarget,\n        rootNode,\n        pos\n      ]);\n      return location.filter(isValidLocation);\n    };\n    var getElement = function (location) {\n      return location.fold(identity, identity, identity, identity);\n    };\n    var getName = function (location) {\n      return location.fold(constant('before'), constant('start'), constant('end'), constant('after'));\n    };\n    var outside = function (location) {\n      return location.fold(Location.before, Location.before, Location.after, Location.after);\n    };\n    var inside = function (location) {\n      return location.fold(Location.start, Location.start, Location.end, Location.end);\n    };\n    var isEq$1 = function (location1, location2) {\n      return getName(location1) === getName(location2) && getElement(location1) === getElement(location2);\n    };\n    var betweenInlines = function (forward, isInlineTarget, rootNode, from, to, location) {\n      return lift2(InlineUtils.findRootInline(isInlineTarget, rootNode, from), InlineUtils.findRootInline(isInlineTarget, rootNode, to), function (fromInline, toInline) {\n        if (fromInline !== toInline && InlineUtils.hasSameParentBlock(rootNode, fromInline, toInline)) {\n          return Location.after(forward ? fromInline : toInline);\n        } else {\n          return location;\n        }\n      }).getOr(location);\n    };\n    var skipNoMovement = function (fromLocation, toLocation) {\n      return fromLocation.fold(constant(true), function (fromLocation) {\n        return !isEq$1(fromLocation, toLocation);\n      });\n    };\n    var findLocationTraverse = function (forward, isInlineTarget, rootNode, fromLocation, pos) {\n      var from = InlineUtils.normalizePosition(forward, pos);\n      var to = CaretFinder.fromPosition(forward, rootNode, from).map(curry(InlineUtils.normalizePosition, forward));\n      var location = to.fold(function () {\n        return fromLocation.map(outside);\n      }, function (to) {\n        return readLocation(isInlineTarget, rootNode, to).map(curry(betweenInlines, forward, isInlineTarget, rootNode, from, to)).filter(curry(skipNoMovement, fromLocation));\n      });\n      return location.filter(isValidLocation);\n    };\n    var findLocationSimple = function (forward, location) {\n      if (forward) {\n        return location.fold(compose(Option.some, Location.start), Option.none, compose(Option.some, Location.after), Option.none);\n      } else {\n        return location.fold(Option.none, compose(Option.some, Location.before), Option.none, compose(Option.some, Location.end));\n      }\n    };\n    var findLocation = function (forward, isInlineTarget, rootNode, pos) {\n      var from = InlineUtils.normalizePosition(forward, pos);\n      var fromLocation = readLocation(isInlineTarget, rootNode, from);\n      return readLocation(isInlineTarget, rootNode, from).bind(curry(findLocationSimple, forward)).orThunk(function () {\n        return findLocationTraverse(forward, isInlineTarget, rootNode, fromLocation, pos);\n      });\n    };\n    var BoundaryLocation = {\n      readLocation: readLocation,\n      findLocation: findLocation,\n      prevLocation: curry(findLocation, false),\n      nextLocation: curry(findLocation, true),\n      getElement: getElement,\n      outside: outside,\n      inside: inside\n    };\n\n    var hasSelectionModifyApi = function (editor) {\n      return isFunction(editor.selection.getSel().modify);\n    };\n    var moveRel = function (forward, selection, pos) {\n      var delta = forward ? 1 : -1;\n      selection.setRng(CaretPosition$1(pos.container(), pos.offset() + delta).toRange());\n      selection.getSel().modify('move', forward ? 'forward' : 'backward', 'word');\n      return true;\n    };\n    var moveByWord = function (forward, editor) {\n      var rng = editor.selection.getRng();\n      var pos = forward ? CaretPosition$1.fromRangeEnd(rng) : CaretPosition$1.fromRangeStart(rng);\n      if (!hasSelectionModifyApi(editor)) {\n        return false;\n      } else if (forward && isBeforeInline(pos)) {\n        return moveRel(true, editor.selection, pos);\n      } else if (!forward && isAfterInline(pos)) {\n        return moveRel(false, editor.selection, pos);\n      } else {\n        return false;\n      }\n    };\n    var WordSelection = {\n      hasSelectionModifyApi: hasSelectionModifyApi,\n      moveByWord: moveByWord\n    };\n\n    var setCaretPosition = function (editor, pos) {\n      var rng = editor.dom.createRng();\n      rng.setStart(pos.container(), pos.offset());\n      rng.setEnd(pos.container(), pos.offset());\n      editor.selection.setRng(rng);\n    };\n    var isFeatureEnabled = function (editor) {\n      return editor.settings.inline_boundaries !== false;\n    };\n    var setSelected = function (state, elm) {\n      if (state) {\n        elm.setAttribute('data-mce-selected', 'inline-boundary');\n      } else {\n        elm.removeAttribute('data-mce-selected');\n      }\n    };\n    var renderCaretLocation = function (editor, caret, location) {\n      return BoundaryCaret.renderCaret(caret, location).map(function (pos) {\n        setCaretPosition(editor, pos);\n        return location;\n      });\n    };\n    var findLocation$1 = function (editor, caret, forward) {\n      var rootNode = editor.getBody();\n      var from = CaretPosition$1.fromRangeStart(editor.selection.getRng());\n      var isInlineTarget = curry(InlineUtils.isInlineTarget, editor);\n      var location = BoundaryLocation.findLocation(forward, isInlineTarget, rootNode, from);\n      return location.bind(function (location) {\n        return renderCaretLocation(editor, caret, location);\n      });\n    };\n    var toggleInlines = function (isInlineTarget, dom, elms) {\n      var selectedInlines = filter(dom.select('*[data-mce-selected=\"inline-boundary\"]'), isInlineTarget);\n      var targetInlines = filter(elms, isInlineTarget);\n      each(difference(selectedInlines, targetInlines), curry(setSelected, false));\n      each(difference(targetInlines, selectedInlines), curry(setSelected, true));\n    };\n    var safeRemoveCaretContainer = function (editor, caret) {\n      if (editor.selection.isCollapsed() && editor.composing !== true && caret.get()) {\n        var pos = CaretPosition$1.fromRangeStart(editor.selection.getRng());\n        if (CaretPosition$1.isTextPosition(pos) && InlineUtils.isAtZwsp(pos) === false) {\n          setCaretPosition(editor, CaretContainerRemove.removeAndReposition(caret.get(), pos));\n          caret.set(null);\n        }\n      }\n    };\n    var renderInsideInlineCaret = function (isInlineTarget, editor, caret, elms) {\n      if (editor.selection.isCollapsed()) {\n        var inlines = filter(elms, isInlineTarget);\n        each(inlines, function (inline) {\n          var pos = CaretPosition$1.fromRangeStart(editor.selection.getRng());\n          BoundaryLocation.readLocation(isInlineTarget, editor.getBody(), pos).bind(function (location) {\n            return renderCaretLocation(editor, caret, location);\n          });\n        });\n      }\n    };\n    var move = function (editor, caret, forward) {\n      return function () {\n        return isFeatureEnabled(editor) ? findLocation$1(editor, caret, forward).isSome() : false;\n      };\n    };\n    var moveWord = function (forward, editor, caret) {\n      return function () {\n        return isFeatureEnabled(editor) ? WordSelection.moveByWord(forward, editor) : false;\n      };\n    };\n    var setupSelectedState = function (editor) {\n      var caret = Cell(null);\n      var isInlineTarget = curry(InlineUtils.isInlineTarget, editor);\n      editor.on('NodeChange', function (e) {\n        if (isFeatureEnabled(editor)) {\n          toggleInlines(isInlineTarget, editor.dom, e.parents);\n          safeRemoveCaretContainer(editor, caret);\n          renderInsideInlineCaret(isInlineTarget, editor, caret, e.parents);\n        }\n      });\n      return caret;\n    };\n    var moveNextWord = curry(moveWord, true);\n    var movePrevWord = curry(moveWord, false);\n    var BoundarySelection = {\n      move: move,\n      moveNextWord: moveNextWord,\n      movePrevWord: movePrevWord,\n      setupSelectedState: setupSelectedState,\n      setCaretPosition: setCaretPosition\n    };\n\n    var isFeatureEnabled$1 = function (editor) {\n      return editor.settings.inline_boundaries !== false;\n    };\n    var rangeFromPositions = function (from, to) {\n      var range = domGlobals.document.createRange();\n      range.setStart(from.container(), from.offset());\n      range.setEnd(to.container(), to.offset());\n      return range;\n    };\n    var hasOnlyTwoOrLessPositionsLeft = function (elm) {\n      return lift2(CaretFinder.firstPositionIn(elm), CaretFinder.lastPositionIn(elm), function (firstPos, lastPos) {\n        var normalizedFirstPos = InlineUtils.normalizePosition(true, firstPos);\n        var normalizedLastPos = InlineUtils.normalizePosition(false, lastPos);\n        return CaretFinder.nextPosition(elm, normalizedFirstPos).map(function (pos) {\n          return pos.isEqual(normalizedLastPos);\n        }).getOr(true);\n      }).getOr(true);\n    };\n    var setCaretLocation = function (editor, caret) {\n      return function (location) {\n        return BoundaryCaret.renderCaret(caret, location).map(function (pos) {\n          BoundarySelection.setCaretPosition(editor, pos);\n          return true;\n        }).getOr(false);\n      };\n    };\n    var deleteFromTo = function (editor, caret, from, to) {\n      var rootNode = editor.getBody();\n      var isInlineTarget = curry(InlineUtils.isInlineTarget, editor);\n      editor.undoManager.ignore(function () {\n        editor.selection.setRng(rangeFromPositions(from, to));\n        editor.execCommand('Delete');\n        BoundaryLocation.readLocation(isInlineTarget, rootNode, CaretPosition$1.fromRangeStart(editor.selection.getRng())).map(BoundaryLocation.inside).map(setCaretLocation(editor, caret));\n      });\n      editor.nodeChanged();\n    };\n    var rescope$1 = function (rootNode, node) {\n      var parentBlock = getParentBlock(node, rootNode);\n      return parentBlock ? parentBlock : rootNode;\n    };\n    var backspaceDeleteCollapsed = function (editor, caret, forward, from) {\n      var rootNode = rescope$1(editor.getBody(), from.container());\n      var isInlineTarget = curry(InlineUtils.isInlineTarget, editor);\n      var fromLocation = BoundaryLocation.readLocation(isInlineTarget, rootNode, from);\n      return fromLocation.bind(function (location) {\n        if (forward) {\n          return location.fold(constant(Option.some(BoundaryLocation.inside(location))), Option.none, constant(Option.some(BoundaryLocation.outside(location))), Option.none);\n        } else {\n          return location.fold(Option.none, constant(Option.some(BoundaryLocation.outside(location))), Option.none, constant(Option.some(BoundaryLocation.inside(location))));\n        }\n      }).map(setCaretLocation(editor, caret)).getOrThunk(function () {\n        var toPosition = CaretFinder.navigate(forward, rootNode, from);\n        var toLocation = toPosition.bind(function (pos) {\n          return BoundaryLocation.readLocation(isInlineTarget, rootNode, pos);\n        });\n        if (fromLocation.isSome() && toLocation.isSome()) {\n          return InlineUtils.findRootInline(isInlineTarget, rootNode, from).map(function (elm) {\n            if (hasOnlyTwoOrLessPositionsLeft(elm)) {\n              DeleteElement.deleteElement(editor, forward, Element.fromDom(elm));\n              return true;\n            } else {\n              return false;\n            }\n          }).getOr(false);\n        } else {\n          return toLocation.bind(function (_) {\n            return toPosition.map(function (to) {\n              if (forward) {\n                deleteFromTo(editor, caret, from, to);\n              } else {\n                deleteFromTo(editor, caret, to, from);\n              }\n              return true;\n            });\n          }).getOr(false);\n        }\n      });\n    };\n    var backspaceDelete$3 = function (editor, caret, forward) {\n      if (editor.selection.isCollapsed() && isFeatureEnabled$1(editor)) {\n        var from = CaretPosition$1.fromRangeStart(editor.selection.getRng());\n        return backspaceDeleteCollapsed(editor, caret, forward, from);\n      }\n      return false;\n    };\n    var InlineBoundaryDelete = { backspaceDelete: backspaceDelete$3 };\n\n    var tableCellRng = Immutable('start', 'end');\n    var tableSelection = Immutable('rng', 'table', 'cells');\n    var deleteAction = Adt.generate([\n      { removeTable: ['element'] },\n      { emptyCells: ['cells'] }\n    ]);\n    var isRootFromElement = function (root) {\n      return curry(eq, root);\n    };\n    var getClosestCell = function (container, isRoot) {\n      return closest$1(Element.fromDom(container), 'td,th', isRoot);\n    };\n    var getClosestTable = function (cell, isRoot) {\n      return ancestor$1(cell, 'table', isRoot);\n    };\n    var isExpandedCellRng = function (cellRng) {\n      return eq(cellRng.start(), cellRng.end()) === false;\n    };\n    var getTableFromCellRng = function (cellRng, isRoot) {\n      return getClosestTable(cellRng.start(), isRoot).bind(function (startParentTable) {\n        return getClosestTable(cellRng.end(), isRoot).bind(function (endParentTable) {\n          return eq(startParentTable, endParentTable) ? Option.some(startParentTable) : Option.none();\n        });\n      });\n    };\n    var getTableCells = function (table) {\n      return descendants$1(table, 'td,th');\n    };\n    var getCellRangeFromStartTable = function (cellRng, isRoot) {\n      return getClosestTable(cellRng.start(), isRoot).bind(function (table) {\n        return last(getTableCells(table)).map(function (endCell) {\n          return tableCellRng(cellRng.start(), endCell);\n        });\n      });\n    };\n    var partialSelection = function (isRoot, rng) {\n      var startCell = getClosestCell(rng.startContainer, isRoot);\n      var endCell = getClosestCell(rng.endContainer, isRoot);\n      return rng.collapsed ? Option.none() : lift2(startCell, endCell, tableCellRng).fold(function () {\n        return startCell.fold(function () {\n          return endCell.bind(function (endCell) {\n            return getClosestTable(endCell, isRoot).bind(function (table) {\n              return head(getTableCells(table)).map(function (startCell) {\n                return tableCellRng(startCell, endCell);\n              });\n            });\n          });\n        }, function (startCell) {\n          return getClosestTable(startCell, isRoot).bind(function (table) {\n            return last(getTableCells(table)).map(function (endCell) {\n              return tableCellRng(startCell, endCell);\n            });\n          });\n        });\n      }, function (cellRng) {\n        return isWithinSameTable(isRoot, cellRng) ? Option.none() : getCellRangeFromStartTable(cellRng, isRoot);\n      });\n    };\n    var isWithinSameTable = function (isRoot, cellRng) {\n      return getTableFromCellRng(cellRng, isRoot).isSome();\n    };\n    var getCellRng = function (rng, isRoot) {\n      var startCell = getClosestCell(rng.startContainer, isRoot);\n      var endCell = getClosestCell(rng.endContainer, isRoot);\n      return lift2(startCell, endCell, tableCellRng).filter(isExpandedCellRng).filter(function (cellRng) {\n        return isWithinSameTable(isRoot, cellRng);\n      }).orThunk(function () {\n        return partialSelection(isRoot, rng);\n      });\n    };\n    var getTableSelectionFromCellRng = function (cellRng, isRoot) {\n      return getTableFromCellRng(cellRng, isRoot).map(function (table) {\n        return tableSelection(cellRng, table, getTableCells(table));\n      });\n    };\n    var getTableSelectionFromRng = function (root, rng) {\n      var isRoot = isRootFromElement(root);\n      return getCellRng(rng, isRoot).bind(function (cellRng) {\n        return getTableSelectionFromCellRng(cellRng, isRoot);\n      });\n    };\n    var getCellIndex = function (cells, cell) {\n      return findIndex(cells, function (x) {\n        return eq(x, cell);\n      });\n    };\n    var getSelectedCells = function (tableSelection) {\n      return lift2(getCellIndex(tableSelection.cells(), tableSelection.rng().start()), getCellIndex(tableSelection.cells(), tableSelection.rng().end()), function (startIndex, endIndex) {\n        return tableSelection.cells().slice(startIndex, endIndex + 1);\n      });\n    };\n    var getAction = function (tableSelection) {\n      return getSelectedCells(tableSelection).map(function (selected) {\n        var cells = tableSelection.cells();\n        return selected.length === cells.length ? deleteAction.removeTable(tableSelection.table()) : deleteAction.emptyCells(selected);\n      });\n    };\n    var getActionFromCells = function (cells) {\n      return deleteAction.emptyCells(cells);\n    };\n    var getActionFromRange = function (root, rng) {\n      return getTableSelectionFromRng(root, rng).bind(getAction);\n    };\n    var TableDeleteAction = {\n      getActionFromRange: getActionFromRange,\n      getActionFromCells: getActionFromCells\n    };\n\n    var getRanges = function (selection) {\n      var ranges = [];\n      if (selection) {\n        for (var i = 0; i < selection.rangeCount; i++) {\n          ranges.push(selection.getRangeAt(i));\n        }\n      }\n      return ranges;\n    };\n    var getSelectedNodes = function (ranges) {\n      return bind(ranges, function (range) {\n        var node = getSelectedNode(range);\n        return node ? [Element.fromDom(node)] : [];\n      });\n    };\n    var hasMultipleRanges = function (selection) {\n      return getRanges(selection).length > 1;\n    };\n    var MultiRange = {\n      getRanges: getRanges,\n      getSelectedNodes: getSelectedNodes,\n      hasMultipleRanges: hasMultipleRanges\n    };\n\n    var getCellsFromRanges = function (ranges) {\n      return filter(MultiRange.getSelectedNodes(ranges), isTableCell);\n    };\n    var getCellsFromElement = function (elm) {\n      var selectedCells = descendants$1(elm, 'td[data-mce-selected],th[data-mce-selected]');\n      return selectedCells;\n    };\n    var getCellsFromElementOrRanges = function (ranges, element) {\n      var selectedCells = getCellsFromElement(element);\n      var rangeCells = getCellsFromRanges(ranges);\n      return selectedCells.length > 0 ? selectedCells : rangeCells;\n    };\n    var getCellsFromEditor = function (editor) {\n      return getCellsFromElementOrRanges(MultiRange.getRanges(editor.selection.getSel()), Element.fromDom(editor.getBody()));\n    };\n    var TableCellSelection = {\n      getCellsFromRanges: getCellsFromRanges,\n      getCellsFromElement: getCellsFromElement,\n      getCellsFromElementOrRanges: getCellsFromElementOrRanges,\n      getCellsFromEditor: getCellsFromEditor\n    };\n\n    var emptyCells = function (editor, cells) {\n      each(cells, PaddingBr.fillWithPaddingBr);\n      editor.selection.setCursorLocation(cells[0].dom(), 0);\n      return true;\n    };\n    var deleteTableElement = function (editor, table) {\n      DeleteElement.deleteElement(editor, false, table);\n      return true;\n    };\n    var deleteCellRange = function (editor, rootElm, rng) {\n      return TableDeleteAction.getActionFromRange(rootElm, rng).map(function (action) {\n        return action.fold(curry(deleteTableElement, editor), curry(emptyCells, editor));\n      });\n    };\n    var deleteCaptionRange = function (editor, caption) {\n      return emptyElement(editor, caption);\n    };\n    var deleteTableRange = function (editor, rootElm, rng, startElm) {\n      return getParentCaption(rootElm, startElm).fold(function () {\n        return deleteCellRange(editor, rootElm, rng);\n      }, function (caption) {\n        return deleteCaptionRange(editor, caption);\n      }).getOr(false);\n    };\n    var deleteRange$1 = function (editor, startElm) {\n      var rootNode = Element.fromDom(editor.getBody());\n      var rng = editor.selection.getRng();\n      var selectedCells = TableCellSelection.getCellsFromEditor(editor);\n      return selectedCells.length !== 0 ? emptyCells(editor, selectedCells) : deleteTableRange(editor, rootNode, rng, startElm);\n    };\n    var getParentCell = function (rootElm, elm) {\n      return find(Parents.parentsAndSelf(elm, rootElm), isTableCell);\n    };\n    var getParentCaption = function (rootElm, elm) {\n      return find(Parents.parentsAndSelf(elm, rootElm), function (elm) {\n        return name(elm) === 'caption';\n      });\n    };\n    var deleteBetweenCells = function (editor, rootElm, forward, fromCell, from) {\n      return CaretFinder.navigate(forward, editor.getBody(), from).bind(function (to) {\n        return getParentCell(rootElm, Element.fromDom(to.getNode())).map(function (toCell) {\n          return eq(toCell, fromCell) === false;\n        });\n      });\n    };\n    var emptyElement = function (editor, elm) {\n      PaddingBr.fillWithPaddingBr(elm);\n      editor.selection.setCursorLocation(elm.dom(), 0);\n      return Option.some(true);\n    };\n    var isDeleteOfLastCharPos = function (fromCaption, forward, from, to) {\n      return CaretFinder.firstPositionIn(fromCaption.dom()).bind(function (first) {\n        return CaretFinder.lastPositionIn(fromCaption.dom()).map(function (last) {\n          return forward ? from.isEqual(first) && to.isEqual(last) : from.isEqual(last) && to.isEqual(first);\n        });\n      }).getOr(true);\n    };\n    var emptyCaretCaption = function (editor, elm) {\n      return emptyElement(editor, elm);\n    };\n    var validateCaretCaption = function (rootElm, fromCaption, to) {\n      return getParentCaption(rootElm, Element.fromDom(to.getNode())).map(function (toCaption) {\n        return eq(toCaption, fromCaption) === false;\n      });\n    };\n    var deleteCaretInsideCaption = function (editor, rootElm, forward, fromCaption, from) {\n      return CaretFinder.navigate(forward, editor.getBody(), from).bind(function (to) {\n        return isDeleteOfLastCharPos(fromCaption, forward, from, to) ? emptyCaretCaption(editor, fromCaption) : validateCaretCaption(rootElm, fromCaption, to);\n      }).or(Option.some(true));\n    };\n    var deleteCaretCells = function (editor, forward, rootElm, startElm) {\n      var from = CaretPosition$1.fromRangeStart(editor.selection.getRng());\n      return getParentCell(rootElm, startElm).bind(function (fromCell) {\n        return Empty.isEmpty(fromCell) ? emptyElement(editor, fromCell) : deleteBetweenCells(editor, rootElm, forward, fromCell, from);\n      });\n    };\n    var deleteCaretCaption = function (editor, forward, rootElm, fromCaption) {\n      var from = CaretPosition$1.fromRangeStart(editor.selection.getRng());\n      return Empty.isEmpty(fromCaption) ? emptyElement(editor, fromCaption) : deleteCaretInsideCaption(editor, rootElm, forward, fromCaption, from);\n    };\n    var deleteCaret = function (editor, forward, startElm) {\n      var rootElm = Element.fromDom(editor.getBody());\n      return getParentCaption(rootElm, startElm).fold(function () {\n        return deleteCaretCells(editor, forward, rootElm, startElm);\n      }, function (fromCaption) {\n        return deleteCaretCaption(editor, forward, rootElm, fromCaption);\n      }).getOr(false);\n    };\n    var backspaceDelete$4 = function (editor, forward) {\n      var startElm = Element.fromDom(editor.selection.getStart(true));\n      var cells = TableCellSelection.getCellsFromEditor(editor);\n      return editor.selection.isCollapsed() && cells.length === 0 ? deleteCaret(editor, forward, startElm) : deleteRange$1(editor, startElm);\n    };\n    var TableDelete = { backspaceDelete: backspaceDelete$4 };\n\n    var isEq$2 = FormatUtils.isEq;\n    var matchesUnInheritedFormatSelector = function (ed, node, name) {\n      var formatList = ed.formatter.get(name);\n      if (formatList) {\n        for (var i = 0; i < formatList.length; i++) {\n          if (formatList[i].inherit === false && ed.dom.is(node, formatList[i].selector)) {\n            return true;\n          }\n        }\n      }\n      return false;\n    };\n    var matchParents = function (editor, node, name, vars) {\n      var root = editor.dom.getRoot();\n      if (node === root) {\n        return false;\n      }\n      node = editor.dom.getParent(node, function (node) {\n        if (matchesUnInheritedFormatSelector(editor, node, name)) {\n          return true;\n        }\n        return node.parentNode === root || !!matchNode(editor, node, name, vars, true);\n      });\n      return matchNode(editor, node, name, vars);\n    };\n    var matchName = function (dom, node, format) {\n      if (isEq$2(node, format.inline)) {\n        return true;\n      }\n      if (isEq$2(node, format.block)) {\n        return true;\n      }\n      if (format.selector) {\n        return node.nodeType === 1 && dom.is(node, format.selector);\n      }\n    };\n    var matchItems = function (dom, node, format, itemName, similar, vars) {\n      var key, value;\n      var items = format[itemName];\n      var i;\n      if (format.onmatch) {\n        return format.onmatch(node, format, itemName);\n      }\n      if (items) {\n        if (typeof items.length === 'undefined') {\n          for (key in items) {\n            if (items.hasOwnProperty(key)) {\n              if (itemName === 'attributes') {\n                value = dom.getAttrib(node, key);\n              } else {\n                value = FormatUtils.getStyle(dom, node, key);\n              }\n              if (similar && !value && !format.exact) {\n                return;\n              }\n              if ((!similar || format.exact) && !isEq$2(value, FormatUtils.normalizeStyleValue(dom, FormatUtils.replaceVars(items[key], vars), key))) {\n                return;\n              }\n            }\n          }\n        } else {\n          for (i = 0; i < items.length; i++) {\n            if (itemName === 'attributes' ? dom.getAttrib(node, items[i]) : FormatUtils.getStyle(dom, node, items[i])) {\n              return format;\n            }\n          }\n        }\n      }\n      return format;\n    };\n    var matchNode = function (ed, node, name, vars, similar) {\n      var formatList = ed.formatter.get(name);\n      var format, i, x, classes;\n      var dom = ed.dom;\n      if (formatList && node) {\n        for (i = 0; i < formatList.length; i++) {\n          format = formatList[i];\n          if (matchName(ed.dom, node, format) && matchItems(dom, node, format, 'attributes', similar, vars) && matchItems(dom, node, format, 'styles', similar, vars)) {\n            if (classes = format.classes) {\n              for (x = 0; x < classes.length; x++) {\n                if (!ed.dom.hasClass(node, classes[x])) {\n                  return;\n                }\n              }\n            }\n            return format;\n          }\n        }\n      }\n    };\n    var match = function (editor, name, vars, node) {\n      var startNode;\n      if (node) {\n        return matchParents(editor, node, name, vars);\n      }\n      node = editor.selection.getNode();\n      if (matchParents(editor, node, name, vars)) {\n        return true;\n      }\n      startNode = editor.selection.getStart();\n      if (startNode !== node) {\n        if (matchParents(editor, startNode, name, vars)) {\n          return true;\n        }\n      }\n      return false;\n    };\n    var matchAll = function (editor, names, vars) {\n      var startElement;\n      var matchedFormatNames = [];\n      var checkedMap = {};\n      startElement = editor.selection.getStart();\n      editor.dom.getParent(startElement, function (node) {\n        var i, name;\n        for (i = 0; i < names.length; i++) {\n          name = names[i];\n          if (!checkedMap[name] && matchNode(editor, node, name, vars)) {\n            checkedMap[name] = true;\n            matchedFormatNames.push(name);\n          }\n        }\n      }, editor.dom.getRoot());\n      return matchedFormatNames;\n    };\n    var canApply = function (editor, name) {\n      var formatList = editor.formatter.get(name);\n      var startNode, parents, i, x, selector;\n      var dom = editor.dom;\n      if (formatList) {\n        startNode = editor.selection.getStart();\n        parents = FormatUtils.getParents(dom, startNode);\n        for (x = formatList.length - 1; x >= 0; x--) {\n          selector = formatList[x].selector;\n          if (!selector || formatList[x].defaultBlock) {\n            return true;\n          }\n          for (i = parents.length - 1; i >= 0; i--) {\n            if (dom.is(parents[i], selector)) {\n              return true;\n            }\n          }\n        }\n      }\n      return false;\n    };\n    var MatchFormat = {\n      matchNode: matchNode,\n      matchName: matchName,\n      match: match,\n      matchAll: matchAll,\n      canApply: canApply,\n      matchesUnInheritedFormatSelector: matchesUnInheritedFormatSelector\n    };\n\n    var splitText = function (node, offset) {\n      return node.splitText(offset);\n    };\n    var split$1 = function (rng) {\n      var startContainer = rng.startContainer, startOffset = rng.startOffset, endContainer = rng.endContainer, endOffset = rng.endOffset;\n      if (startContainer === endContainer && NodeType.isText(startContainer)) {\n        if (startOffset > 0 && startOffset < startContainer.nodeValue.length) {\n          endContainer = splitText(startContainer, startOffset);\n          startContainer = endContainer.previousSibling;\n          if (endOffset > startOffset) {\n            endOffset = endOffset - startOffset;\n            startContainer = endContainer = splitText(endContainer, endOffset).previousSibling;\n            endOffset = endContainer.nodeValue.length;\n            startOffset = 0;\n          } else {\n            endOffset = 0;\n          }\n        }\n      } else {\n        if (NodeType.isText(startContainer) && startOffset > 0 && startOffset < startContainer.nodeValue.length) {\n          startContainer = splitText(startContainer, startOffset);\n          startOffset = 0;\n        }\n        if (NodeType.isText(endContainer) && endOffset > 0 && endOffset < endContainer.nodeValue.length) {\n          endContainer = splitText(endContainer, endOffset).previousSibling;\n          endOffset = endContainer.nodeValue.length;\n        }\n      }\n      return {\n        startContainer: startContainer,\n        startOffset: startOffset,\n        endContainer: endContainer,\n        endOffset: endOffset\n      };\n    };\n    var SplitRange = { split: split$1 };\n\n    var ZWSP$1 = Zwsp.ZWSP, CARET_ID$1 = '_mce_caret';\n    var importNode = function (ownerDocument, node) {\n      return ownerDocument.importNode(node, true);\n    };\n    var getEmptyCaretContainers = function (node) {\n      var nodes = [];\n      while (node) {\n        if (node.nodeType === 3 && node.nodeValue !== ZWSP$1 || node.childNodes.length > 1) {\n          return [];\n        }\n        if (node.nodeType === 1) {\n          nodes.push(node);\n        }\n        node = node.firstChild;\n      }\n      return nodes;\n    };\n    var isCaretContainerEmpty = function (node) {\n      return getEmptyCaretContainers(node).length > 0;\n    };\n    var findFirstTextNode = function (node) {\n      var walker;\n      if (node) {\n        walker = new TreeWalker(node, node);\n        for (node = walker.current(); node; node = walker.next()) {\n          if (node.nodeType === 3) {\n            return node;\n          }\n        }\n      }\n      return null;\n    };\n    var createCaretContainer = function (fill) {\n      var caretContainer = Element.fromTag('span');\n      setAll(caretContainer, {\n        'id': CARET_ID$1,\n        'data-mce-bogus': '1',\n        'data-mce-type': 'format-caret'\n      });\n      if (fill) {\n        append(caretContainer, Element.fromText(ZWSP$1));\n      }\n      return caretContainer;\n    };\n    var trimZwspFromCaretContainer = function (caretContainerNode) {\n      var textNode = findFirstTextNode(caretContainerNode);\n      if (textNode && textNode.nodeValue.charAt(0) === ZWSP$1) {\n        textNode.deleteData(0, 1);\n      }\n      return textNode;\n    };\n    var removeCaretContainerNode = function (editor, node, moveCaret) {\n      if (moveCaret === void 0) {\n        moveCaret = true;\n      }\n      var dom = editor.dom, selection = editor.selection;\n      if (isCaretContainerEmpty(node)) {\n        DeleteElement.deleteElement(editor, false, Element.fromDom(node), moveCaret);\n      } else {\n        var rng = selection.getRng();\n        var block = dom.getParent(node, dom.isBlock);\n        var textNode = trimZwspFromCaretContainer(node);\n        if (rng.startContainer === textNode && rng.startOffset > 0) {\n          rng.setStart(textNode, rng.startOffset - 1);\n        }\n        if (rng.endContainer === textNode && rng.endOffset > 0) {\n          rng.setEnd(textNode, rng.endOffset - 1);\n        }\n        dom.remove(node, true);\n        if (block && dom.isEmpty(block)) {\n          PaddingBr.fillWithPaddingBr(Element.fromDom(block));\n        }\n        selection.setRng(rng);\n      }\n    };\n    var removeCaretContainer = function (editor, node, moveCaret) {\n      if (moveCaret === void 0) {\n        moveCaret = true;\n      }\n      var dom = editor.dom, selection = editor.selection;\n      if (!node) {\n        node = getParentCaretContainer(editor.getBody(), selection.getStart());\n        if (!node) {\n          while (node = dom.get(CARET_ID$1)) {\n            removeCaretContainerNode(editor, node, false);\n          }\n        }\n      } else {\n        removeCaretContainerNode(editor, node, moveCaret);\n      }\n    };\n    var insertCaretContainerNode = function (editor, caretContainer, formatNode) {\n      var dom = editor.dom, block = dom.getParent(formatNode, curry(FormatUtils.isTextBlock, editor));\n      if (block && dom.isEmpty(block)) {\n        formatNode.parentNode.replaceChild(caretContainer, formatNode);\n      } else {\n        PaddingBr.removeTrailingBr(Element.fromDom(formatNode));\n        if (dom.isEmpty(formatNode)) {\n          formatNode.parentNode.replaceChild(caretContainer, formatNode);\n        } else {\n          dom.insertAfter(caretContainer, formatNode);\n        }\n      }\n    };\n    var appendNode = function (parentNode, node) {\n      parentNode.appendChild(node);\n      return node;\n    };\n    var insertFormatNodesIntoCaretContainer = function (formatNodes, caretContainer) {\n      var innerMostFormatNode = foldr(formatNodes, function (parentNode, formatNode) {\n        return appendNode(parentNode, formatNode.cloneNode(false));\n      }, caretContainer);\n      return appendNode(innerMostFormatNode, innerMostFormatNode.ownerDocument.createTextNode(ZWSP$1));\n    };\n    var applyCaretFormat = function (editor, name, vars) {\n      var rng, caretContainer, textNode, offset, bookmark, container, text;\n      var selection = editor.selection;\n      rng = selection.getRng(true);\n      offset = rng.startOffset;\n      container = rng.startContainer;\n      text = container.nodeValue;\n      caretContainer = getParentCaretContainer(editor.getBody(), selection.getStart());\n      if (caretContainer) {\n        textNode = findFirstTextNode(caretContainer);\n      }\n      var wordcharRegex = /[^\\s\\u00a0\\u00ad\\u200b\\ufeff]/;\n      if (text && offset > 0 && offset < text.length && wordcharRegex.test(text.charAt(offset)) && wordcharRegex.test(text.charAt(offset - 1))) {\n        bookmark = selection.getBookmark();\n        rng.collapse(true);\n        rng = ExpandRange.expandRng(editor, rng, editor.formatter.get(name));\n        rng = SplitRange.split(rng);\n        editor.formatter.apply(name, vars, rng);\n        selection.moveToBookmark(bookmark);\n      } else {\n        if (!caretContainer || textNode.nodeValue !== ZWSP$1) {\n          caretContainer = importNode(editor.getDoc(), createCaretContainer(true).dom());\n          textNode = caretContainer.firstChild;\n          rng.insertNode(caretContainer);\n          offset = 1;\n          editor.formatter.apply(name, vars, caretContainer);\n        } else {\n          editor.formatter.apply(name, vars, caretContainer);\n        }\n        selection.setCursorLocation(textNode, offset);\n      }\n    };\n    var removeCaretFormat = function (editor, name, vars, similar) {\n      var dom = editor.dom, selection = editor.selection;\n      var container, offset, bookmark;\n      var hasContentAfter, node, formatNode;\n      var parents = [], rng = selection.getRng();\n      var caretContainer;\n      container = rng.startContainer;\n      offset = rng.startOffset;\n      node = container;\n      if (container.nodeType === 3) {\n        if (offset !== container.nodeValue.length) {\n          hasContentAfter = true;\n        }\n        node = node.parentNode;\n      }\n      while (node) {\n        if (MatchFormat.matchNode(editor, node, name, vars, similar)) {\n          formatNode = node;\n          break;\n        }\n        if (node.nextSibling) {\n          hasContentAfter = true;\n        }\n        parents.push(node);\n        node = node.parentNode;\n      }\n      if (!formatNode) {\n        return;\n      }\n      if (hasContentAfter) {\n        bookmark = selection.getBookmark();\n        rng.collapse(true);\n        var expandedRng = ExpandRange.expandRng(editor, rng, editor.formatter.get(name), true);\n        expandedRng = SplitRange.split(expandedRng);\n        editor.formatter.remove(name, vars, expandedRng);\n        selection.moveToBookmark(bookmark);\n      } else {\n        caretContainer = getParentCaretContainer(editor.getBody(), formatNode);\n        var newCaretContainer = createCaretContainer(false).dom();\n        var caretNode = insertFormatNodesIntoCaretContainer(parents, newCaretContainer);\n        if (caretContainer) {\n          insertCaretContainerNode(editor, newCaretContainer, caretContainer);\n        } else {\n          insertCaretContainerNode(editor, newCaretContainer, formatNode);\n        }\n        removeCaretContainerNode(editor, caretContainer, false);\n        selection.setCursorLocation(caretNode, 1);\n        if (dom.isEmpty(formatNode)) {\n          dom.remove(formatNode);\n        }\n      }\n    };\n    var disableCaretContainer = function (editor, keyCode) {\n      var selection = editor.selection, body = editor.getBody();\n      removeCaretContainer(editor, null, false);\n      if ((keyCode === 8 || keyCode === 46) && selection.isCollapsed() && selection.getStart().innerHTML === ZWSP$1) {\n        removeCaretContainer(editor, getParentCaretContainer(body, selection.getStart()));\n      }\n      if (keyCode === 37 || keyCode === 39) {\n        removeCaretContainer(editor, getParentCaretContainer(body, selection.getStart()));\n      }\n    };\n    var setup$2 = function (editor) {\n      editor.on('mouseup keydown', function (e) {\n        disableCaretContainer(editor, e.keyCode);\n      });\n    };\n    var replaceWithCaretFormat = function (targetNode, formatNodes) {\n      var caretContainer = createCaretContainer(false);\n      var innerMost = insertFormatNodesIntoCaretContainer(formatNodes, caretContainer.dom());\n      before(Element.fromDom(targetNode), caretContainer);\n      remove$1(Element.fromDom(targetNode));\n      return CaretPosition$1(innerMost, 0);\n    };\n    var isFormatElement = function (editor, element) {\n      var inlineElements = editor.schema.getTextInlineElements();\n      return inlineElements.hasOwnProperty(name(element)) && !isCaretNode(element.dom()) && !NodeType.isBogus(element.dom());\n    };\n    var isEmptyCaretFormatElement = function (element) {\n      return isCaretNode(element.dom()) && isCaretContainerEmpty(element.dom());\n    };\n\n    var getParentInlines = function (rootElm, startElm) {\n      var parents = Parents.parentsAndSelf(startElm, rootElm);\n      return findIndex(parents, isBlock).fold(constant(parents), function (index) {\n        return parents.slice(0, index);\n      });\n    };\n    var hasOnlyOneChild$1 = function (elm) {\n      return children(elm).length === 1;\n    };\n    var deleteLastPosition = function (forward, editor, target, parentInlines) {\n      var isFormatElement$1 = curry(isFormatElement, editor);\n      var formatNodes = map(filter(parentInlines, isFormatElement$1), function (elm) {\n        return elm.dom();\n      });\n      if (formatNodes.length === 0) {\n        DeleteElement.deleteElement(editor, forward, target);\n      } else {\n        var pos = replaceWithCaretFormat(target.dom(), formatNodes);\n        editor.selection.setRng(pos.toRange());\n      }\n    };\n    var deleteCaret$1 = function (editor, forward) {\n      var rootElm = Element.fromDom(editor.getBody());\n      var startElm = Element.fromDom(editor.selection.getStart());\n      var parentInlines = filter(getParentInlines(rootElm, startElm), hasOnlyOneChild$1);\n      return last(parentInlines).map(function (target) {\n        var fromPos = CaretPosition$1.fromRangeStart(editor.selection.getRng());\n        if (DeleteUtils.willDeleteLastPositionInElement(forward, fromPos, target.dom()) && !isEmptyCaretFormatElement(target)) {\n          deleteLastPosition(forward, editor, target, parentInlines);\n          return true;\n        } else {\n          return false;\n        }\n      }).getOr(false);\n    };\n    var backspaceDelete$5 = function (editor, forward) {\n      return editor.selection.isCollapsed() ? deleteCaret$1(editor, forward) : false;\n    };\n    var InlineFormatDelete = { backspaceDelete: backspaceDelete$5 };\n\n    var getPos$1 = function (elm) {\n      var x = 0, y = 0;\n      var offsetParent = elm;\n      while (offsetParent && offsetParent.nodeType) {\n        x += offsetParent.offsetLeft || 0;\n        y += offsetParent.offsetTop || 0;\n        offsetParent = offsetParent.offsetParent;\n      }\n      return {\n        x: x,\n        y: y\n      };\n    };\n    var fireScrollIntoViewEvent = function (editor, elm, alignToTop) {\n      var scrollEvent = {\n        elm: elm,\n        alignToTop: alignToTop\n      };\n      editor.fire('scrollIntoView', scrollEvent);\n      return scrollEvent.isDefaultPrevented();\n    };\n    var scrollElementIntoView = function (editor, elm, alignToTop) {\n      var y, viewPort;\n      var dom = editor.dom;\n      var root = dom.getRoot();\n      var viewPortY, viewPortH, offsetY = 0;\n      if (fireScrollIntoViewEvent(editor, elm, alignToTop)) {\n        return;\n      }\n      if (!NodeType.isElement(elm)) {\n        return;\n      }\n      if (alignToTop === false) {\n        offsetY = elm.offsetHeight;\n      }\n      if (root.nodeName !== 'BODY') {\n        var scrollContainer = editor.selection.getScrollContainer();\n        if (scrollContainer) {\n          y = getPos$1(elm).y - getPos$1(scrollContainer).y + offsetY;\n          viewPortH = scrollContainer.clientHeight;\n          viewPortY = scrollContainer.scrollTop;\n          if (y < viewPortY || y + 25 > viewPortY + viewPortH) {\n            scrollContainer.scrollTop = y < viewPortY ? y : y - viewPortH + 25;\n          }\n          return;\n        }\n      }\n      viewPort = dom.getViewPort(editor.getWin());\n      y = dom.getPos(elm).y + offsetY;\n      viewPortY = viewPort.y;\n      viewPortH = viewPort.h;\n      if (y < viewPort.y || y + 25 > viewPortY + viewPortH) {\n        editor.getWin().scrollTo(0, y < viewPortY ? y : y - viewPortH + 25);\n      }\n    };\n    var getViewPortRect = function (editor) {\n      if (editor.inline) {\n        return editor.getBody().getBoundingClientRect();\n      } else {\n        var win = editor.getWin();\n        return {\n          left: 0,\n          right: win.innerWidth,\n          top: 0,\n          bottom: win.innerHeight,\n          width: win.innerWidth,\n          height: win.innerHeight\n        };\n      }\n    };\n    var scrollBy = function (editor, dx, dy) {\n      if (editor.inline) {\n        editor.getBody().scrollLeft += dx;\n        editor.getBody().scrollTop += dy;\n      } else {\n        editor.getWin().scrollBy(dx, dy);\n      }\n    };\n    var scrollRangeIntoView = function (editor, rng) {\n      head(CaretPosition.fromRangeStart(rng).getClientRects()).each(function (rngRect) {\n        var bodyRect = getViewPortRect(editor);\n        var overflow = getOverflow(bodyRect, rngRect);\n        var margin = 4;\n        var dx = overflow.x > 0 ? overflow.x + margin : overflow.x - margin;\n        var dy = overflow.y > 0 ? overflow.y + margin : overflow.y - margin;\n        scrollBy(editor, overflow.x !== 0 ? dx : 0, overflow.y !== 0 ? dy : 0);\n      });\n    };\n    var ScrollIntoView = {\n      scrollElementIntoView: scrollElementIntoView,\n      scrollRangeIntoView: scrollRangeIntoView\n    };\n\n    var isContentEditableTrue$2 = NodeType.isContentEditableTrue;\n    var isContentEditableFalse$6 = NodeType.isContentEditableFalse;\n    var showCaret = function (direction, editor, node, before, scrollIntoView) {\n      return editor._selectionOverrides.showCaret(direction, node, before, scrollIntoView);\n    };\n    var getNodeRange = function (node) {\n      var rng = node.ownerDocument.createRange();\n      rng.selectNode(node);\n      return rng;\n    };\n    var selectNode = function (editor, node) {\n      var e = editor.fire('BeforeObjectSelected', { target: node });\n      if (e.isDefaultPrevented()) {\n        return null;\n      }\n      return getNodeRange(node);\n    };\n    var renderCaretAtRange = function (editor, range, scrollIntoView) {\n      var normalizedRange = normalizeRange(1, editor.getBody(), range);\n      var caretPosition = CaretPosition$1.fromRangeStart(normalizedRange);\n      var caretPositionNode = caretPosition.getNode();\n      if (isContentEditableFalse$6(caretPositionNode)) {\n        return showCaret(1, editor, caretPositionNode, !caretPosition.isAtEnd(), false);\n      }\n      var caretPositionBeforeNode = caretPosition.getNode(true);\n      if (isContentEditableFalse$6(caretPositionBeforeNode)) {\n        return showCaret(1, editor, caretPositionBeforeNode, false, false);\n      }\n      var ceRoot = editor.dom.getParent(caretPosition.getNode(), function (node) {\n        return isContentEditableFalse$6(node) || isContentEditableTrue$2(node);\n      });\n      if (isContentEditableFalse$6(ceRoot)) {\n        return showCaret(1, editor, ceRoot, false, scrollIntoView);\n      }\n      return null;\n    };\n    var renderRangeCaret = function (editor, range, scrollIntoView) {\n      if (!range || !range.collapsed) {\n        return range;\n      }\n      var caretRange = renderCaretAtRange(editor, range, scrollIntoView);\n      if (caretRange) {\n        return caretRange;\n      }\n      return range;\n    };\n    var moveToRange = function (editor, rng) {\n      editor.selection.setRng(rng);\n      ScrollIntoView.scrollRangeIntoView(editor, editor.selection.getRng());\n    };\n\n    var trimEmptyTextNode$1 = function (dom, node) {\n      if (NodeType.isText(node) && node.data.length === 0) {\n        dom.remove(node);\n      }\n    };\n    var deleteContentAndShowCaret = function (editor, range, node, direction, forward, peekCaretPosition) {\n      var caretRange = showCaret(direction, editor, peekCaretPosition.getNode(!forward), forward, true);\n      if (range.collapsed) {\n        var deleteRange = range.cloneRange();\n        if (forward) {\n          deleteRange.setEnd(caretRange.startContainer, caretRange.startOffset);\n        } else {\n          deleteRange.setStart(caretRange.endContainer, caretRange.endOffset);\n        }\n        deleteRange.deleteContents();\n      } else {\n        range.deleteContents();\n      }\n      editor.selection.setRng(caretRange);\n      trimEmptyTextNode$1(editor.dom, node);\n      return true;\n    };\n    var deleteCefBoundaryText = function (editor, forward) {\n      var range = editor.selection.getRng();\n      if (!NodeType.isText(range.commonAncestorContainer)) {\n        return false;\n      }\n      var direction = forward ? HDirection.Forwards : HDirection.Backwards;\n      var caretWalker = CaretWalker(editor.getBody());\n      var getNextVisualCaretPosition = curry(getVisualCaretPosition, caretWalker.next);\n      var getPrevVisualCaretPosition = curry(getVisualCaretPosition, caretWalker.prev);\n      var getNextPosFn = forward ? getNextVisualCaretPosition : getPrevVisualCaretPosition;\n      var isBeforeContentEditableFalseFn = forward ? isBeforeContentEditableFalse : isAfterContentEditableFalse;\n      var caretPosition = getNormalizedRangeEndPoint(direction, editor.getBody(), range);\n      var nextCaretPosition = InlineUtils.normalizePosition(forward, getNextPosFn(caretPosition));\n      if (!nextCaretPosition) {\n        return false;\n      } else if (isBeforeContentEditableFalseFn(nextCaretPosition)) {\n        return deleteContentAndShowCaret(editor, range, caretPosition.getNode(), direction, forward, nextCaretPosition);\n      }\n      var peekCaretPosition = getNextPosFn(nextCaretPosition);\n      if (peekCaretPosition && isBeforeContentEditableFalseFn(peekCaretPosition)) {\n        if (isMoveInsideSameBlock(nextCaretPosition, peekCaretPosition)) {\n          return deleteContentAndShowCaret(editor, range, caretPosition.getNode(), direction, forward, peekCaretPosition);\n        }\n      }\n      return false;\n    };\n    var backspaceDelete$6 = function (editor, forward) {\n      return deleteCefBoundaryText(editor, forward);\n    };\n    var CefBoundaryDelete = { backspaceDelete: backspaceDelete$6 };\n\n    var nativeCommand = function (editor, command) {\n      editor.getDoc().execCommand(command, false, null);\n    };\n    var deleteCommand = function (editor) {\n      if (CefDelete.backspaceDelete(editor, false)) {\n        return;\n      } else if (CefBoundaryDelete.backspaceDelete(editor, false)) {\n        return;\n      } else if (InlineBoundaryDelete.backspaceDelete(editor, false)) {\n        return;\n      } else if (BlockBoundaryDelete.backspaceDelete(editor, false)) {\n        return;\n      } else if (TableDelete.backspaceDelete(editor)) {\n        return;\n      } else if (BlockRangeDelete.backspaceDelete(editor, false)) {\n        return;\n      } else if (InlineFormatDelete.backspaceDelete(editor, false)) {\n        return;\n      } else {\n        nativeCommand(editor, 'Delete');\n        DeleteUtils.paddEmptyBody(editor);\n      }\n    };\n    var forwardDeleteCommand = function (editor) {\n      if (CefDelete.backspaceDelete(editor, true)) {\n        return;\n      } else if (CefBoundaryDelete.backspaceDelete(editor, true)) {\n        return;\n      } else if (InlineBoundaryDelete.backspaceDelete(editor, true)) {\n        return;\n      } else if (BlockBoundaryDelete.backspaceDelete(editor, true)) {\n        return;\n      } else if (TableDelete.backspaceDelete(editor)) {\n        return;\n      } else if (BlockRangeDelete.backspaceDelete(editor, true)) {\n        return;\n      } else if (InlineFormatDelete.backspaceDelete(editor, true)) {\n        return;\n      } else {\n        nativeCommand(editor, 'ForwardDelete');\n      }\n    };\n    var DeleteCommands = {\n      deleteCommand: deleteCommand,\n      forwardDeleteCommand: forwardDeleteCommand\n    };\n\n    var getSpecifiedFontProp = function (propName, rootElm, elm) {\n      var getProperty = function (elm) {\n        return getRaw(elm, propName);\n      };\n      var isRoot = function (elm) {\n        return eq(Element.fromDom(rootElm), elm);\n      };\n      return closest(Element.fromDom(elm), function (elm) {\n        return getProperty(elm).isSome();\n      }, isRoot).bind(getProperty);\n    };\n    var round$1 = function (number, precision) {\n      var factor = Math.pow(10, precision);\n      return Math.round(number * factor) / factor;\n    };\n    var toPt = function (fontSize, precision) {\n      if (/[0-9.]+px$/.test(fontSize)) {\n        return round$1(parseInt(fontSize, 10) * 72 / 96, precision || 0) + 'pt';\n      }\n      return fontSize;\n    };\n    var normalizeFontFamily = function (fontFamily) {\n      return fontFamily.replace(/[\\'\\\"\\\\]/g, '').replace(/,\\s+/g, ',');\n    };\n    var getComputedFontProp = function (propName, elm) {\n      return Option.from(DOMUtils$1.DOM.getStyle(elm, propName, true));\n    };\n    var getFontProp = function (propName) {\n      return function (rootElm, elm) {\n        return Option.from(elm).map(Element.fromDom).filter(isElement).bind(function (element) {\n          return getSpecifiedFontProp(propName, rootElm, element.dom()).or(getComputedFontProp(propName, element.dom()));\n        }).getOr('');\n      };\n    };\n    var FontInfo = {\n      getFontSize: getFontProp('font-size'),\n      getFontFamily: compose(normalizeFontFamily, getFontProp('font-family')),\n      toPt: toPt\n    };\n\n    var findFirstCaretElement = function (editor) {\n      return CaretFinder.firstPositionIn(editor.getBody()).map(function (caret) {\n        var container = caret.container();\n        return NodeType.isText(container) ? container.parentNode : container;\n      });\n    };\n    var isRangeAtStartOfNode = function (rng, root) {\n      return rng.startContainer === root && rng.startOffset === 0;\n    };\n    var getCaretElement = function (editor) {\n      return Option.from(editor.selection.getRng()).bind(function (rng) {\n        var root = editor.getBody();\n        return isRangeAtStartOfNode(rng, root) ? Option.none() : Option.from(editor.selection.getStart(true));\n      });\n    };\n    var fromFontSizeNumber = function (editor, value) {\n      if (/^[0-9\\.]+$/.test(value)) {\n        var fontSizeNumber = parseInt(value, 10);\n        if (fontSizeNumber >= 1 && fontSizeNumber <= 7) {\n          var fontSizes = Settings.getFontStyleValues(editor);\n          var fontClasses = Settings.getFontSizeClasses(editor);\n          if (fontClasses) {\n            return fontClasses[fontSizeNumber - 1] || value;\n          } else {\n            return fontSizes[fontSizeNumber - 1] || value;\n          }\n        } else {\n          return value;\n        }\n      } else {\n        return value;\n      }\n    };\n    var fontNameAction = function (editor, value) {\n      editor.formatter.toggle('fontname', { value: fromFontSizeNumber(editor, value) });\n      editor.nodeChanged();\n    };\n    var fontNameQuery = function (editor) {\n      return getCaretElement(editor).fold(function () {\n        return findFirstCaretElement(editor).map(function (caretElement) {\n          return FontInfo.getFontFamily(editor.getBody(), caretElement);\n        }).getOr('');\n      }, function (caretElement) {\n        return FontInfo.getFontFamily(editor.getBody(), caretElement);\n      });\n    };\n    var fontSizeAction = function (editor, value) {\n      editor.formatter.toggle('fontsize', { value: fromFontSizeNumber(editor, value) });\n      editor.nodeChanged();\n    };\n    var fontSizeQuery = function (editor) {\n      return getCaretElement(editor).fold(function () {\n        return findFirstCaretElement(editor).map(function (caretElement) {\n          return FontInfo.getFontSize(editor.getBody(), caretElement);\n        }).getOr('');\n      }, function (caretElement) {\n        return FontInfo.getFontSize(editor.getBody(), caretElement);\n      });\n    };\n\n    var isEq$3 = function (rng1, rng2) {\n      return rng1 && rng2 && (rng1.startContainer === rng2.startContainer && rng1.startOffset === rng2.startOffset) && (rng1.endContainer === rng2.endContainer && rng1.endOffset === rng2.endOffset);\n    };\n    var RangeCompare = { isEq: isEq$3 };\n\n    var findParent = function (node, rootNode, predicate) {\n      while (node && node !== rootNode) {\n        if (predicate(node)) {\n          return node;\n        }\n        node = node.parentNode;\n      }\n      return null;\n    };\n    var hasParent = function (node, rootNode, predicate) {\n      return findParent(node, rootNode, predicate) !== null;\n    };\n    var hasParentWithName = function (node, rootNode, name) {\n      return hasParent(node, rootNode, function (node) {\n        return node.nodeName === name;\n      });\n    };\n    var isTable$2 = function (node) {\n      return node && node.nodeName === 'TABLE';\n    };\n    var isTableCell$3 = function (node) {\n      return node && /^(TD|TH|CAPTION)$/.test(node.nodeName);\n    };\n    var isCeFalseCaretContainer = function (node, rootNode) {\n      return isCaretContainer(node) && hasParent(node, rootNode, isCaretNode) === false;\n    };\n    var hasBrBeforeAfter = function (dom, node, left) {\n      var walker = new TreeWalker(node, dom.getParent(node.parentNode, dom.isBlock) || dom.getRoot());\n      while (node = walker[left ? 'prev' : 'next']()) {\n        if (NodeType.isBr(node)) {\n          return true;\n        }\n      }\n    };\n    var isPrevNode = function (node, name) {\n      return node.previousSibling && node.previousSibling.nodeName === name;\n    };\n    var hasContentEditableFalseParent = function (body, node) {\n      while (node && node !== body) {\n        if (NodeType.isContentEditableFalse(node)) {\n          return true;\n        }\n        node = node.parentNode;\n      }\n      return false;\n    };\n    var findTextNodeRelative = function (dom, isAfterNode, collapsed, left, startNode) {\n      var walker, lastInlineElement, parentBlockContainer;\n      var body = dom.getRoot();\n      var node;\n      var nonEmptyElementsMap = dom.schema.getNonEmptyElements();\n      parentBlockContainer = dom.getParent(startNode.parentNode, dom.isBlock) || body;\n      if (left && NodeType.isBr(startNode) && isAfterNode && dom.isEmpty(parentBlockContainer)) {\n        return Option.some(CaretPosition(startNode.parentNode, dom.nodeIndex(startNode)));\n      }\n      walker = new TreeWalker(startNode, parentBlockContainer);\n      while (node = walker[left ? 'prev' : 'next']()) {\n        if (dom.getContentEditableParent(node) === 'false' || isCeFalseCaretContainer(node, body)) {\n          return Option.none();\n        }\n        if (NodeType.isText(node) && node.nodeValue.length > 0) {\n          if (hasParentWithName(node, body, 'A') === false) {\n            return Option.some(CaretPosition(node, left ? node.nodeValue.length : 0));\n          }\n          return Option.none();\n        }\n        if (dom.isBlock(node) || nonEmptyElementsMap[node.nodeName.toLowerCase()]) {\n          return Option.none();\n        }\n        lastInlineElement = node;\n      }\n      if (collapsed && lastInlineElement) {\n        return Option.some(CaretPosition(lastInlineElement, 0));\n      }\n      return Option.none();\n    };\n    var normalizeEndPoint = function (dom, collapsed, start, rng) {\n      var container, offset, walker;\n      var body = dom.getRoot();\n      var node, nonEmptyElementsMap;\n      var directionLeft, isAfterNode, normalized = false;\n      container = rng[(start ? 'start' : 'end') + 'Container'];\n      offset = rng[(start ? 'start' : 'end') + 'Offset'];\n      isAfterNode = NodeType.isElement(container) && offset === container.childNodes.length;\n      nonEmptyElementsMap = dom.schema.getNonEmptyElements();\n      directionLeft = start;\n      if (isCaretContainer(container)) {\n        return Option.none();\n      }\n      if (NodeType.isElement(container) && offset > container.childNodes.length - 1) {\n        directionLeft = false;\n      }\n      if (NodeType.isDocument(container)) {\n        container = body;\n        offset = 0;\n      }\n      if (container === body) {\n        if (directionLeft) {\n          node = container.childNodes[offset > 0 ? offset - 1 : 0];\n          if (node) {\n            if (isCaretContainer(node)) {\n              return Option.none();\n            }\n            if (nonEmptyElementsMap[node.nodeName] || isTable$2(node)) {\n              return Option.none();\n            }\n          }\n        }\n        if (container.hasChildNodes()) {\n          offset = Math.min(!directionLeft && offset > 0 ? offset - 1 : offset, container.childNodes.length - 1);\n          container = container.childNodes[offset];\n          offset = NodeType.isText(container) && isAfterNode ? container.data.length : 0;\n          if (!collapsed && container === body.lastChild && isTable$2(container)) {\n            return Option.none();\n          }\n          if (hasContentEditableFalseParent(body, container) || isCaretContainer(container)) {\n            return Option.none();\n          }\n          if (container.hasChildNodes() && isTable$2(container) === false) {\n            node = container;\n            walker = new TreeWalker(container, body);\n            do {\n              if (NodeType.isContentEditableFalse(node) || isCaretContainer(node)) {\n                normalized = false;\n                break;\n              }\n              if (NodeType.isText(node) && node.nodeValue.length > 0) {\n                offset = directionLeft ? 0 : node.nodeValue.length;\n                container = node;\n                normalized = true;\n                break;\n              }\n              if (nonEmptyElementsMap[node.nodeName.toLowerCase()] && !isTableCell$3(node)) {\n                offset = dom.nodeIndex(node);\n                container = node.parentNode;\n                if (!directionLeft) {\n                  offset++;\n                }\n                normalized = true;\n                break;\n              }\n            } while (node = directionLeft ? walker.next() : walker.prev());\n          }\n        }\n      }\n      if (collapsed) {\n        if (NodeType.isText(container) && offset === 0) {\n          findTextNodeRelative(dom, isAfterNode, collapsed, true, container).each(function (pos) {\n            container = pos.container();\n            offset = pos.offset();\n            normalized = true;\n          });\n        }\n        if (NodeType.isElement(container)) {\n          node = container.childNodes[offset];\n          if (!node) {\n            node = container.childNodes[offset - 1];\n          }\n          if (node && NodeType.isBr(node) && !isPrevNode(node, 'A') && !hasBrBeforeAfter(dom, node, false) && !hasBrBeforeAfter(dom, node, true)) {\n            findTextNodeRelative(dom, isAfterNode, collapsed, true, node).each(function (pos) {\n              container = pos.container();\n              offset = pos.offset();\n              normalized = true;\n            });\n          }\n        }\n      }\n      if (directionLeft && !collapsed && NodeType.isText(container) && offset === container.nodeValue.length) {\n        findTextNodeRelative(dom, isAfterNode, collapsed, false, container).each(function (pos) {\n          container = pos.container();\n          offset = pos.offset();\n          normalized = true;\n        });\n      }\n      return normalized ? Option.some(CaretPosition(container, offset)) : Option.none();\n    };\n    var normalize$2 = function (dom, rng) {\n      var collapsed = rng.collapsed, normRng = rng.cloneRange();\n      var startPos = CaretPosition.fromRangeStart(rng);\n      normalizeEndPoint(dom, collapsed, true, normRng).each(function (pos) {\n        if (!collapsed || !CaretPosition.isAbove(startPos, pos)) {\n          normRng.setStart(pos.container(), pos.offset());\n        }\n      });\n      if (!collapsed) {\n        normalizeEndPoint(dom, collapsed, false, normRng).each(function (pos) {\n          normRng.setEnd(pos.container(), pos.offset());\n        });\n      }\n      if (collapsed) {\n        normRng.collapse(true);\n      }\n      return RangeCompare.isEq(rng, normRng) ? Option.none() : Option.some(normRng);\n    };\n    var NormalizeRange = { normalize: normalize$2 };\n\n    var hasRightSideContent = function (schema, container, parentBlock) {\n      var walker = new TreeWalker(container, parentBlock);\n      var node;\n      var nonEmptyElementsMap = schema.getNonEmptyElements();\n      while (node = walker.next()) {\n        if (nonEmptyElementsMap[node.nodeName.toLowerCase()] || node.length > 0) {\n          return true;\n        }\n      }\n    };\n    var scrollToBr = function (dom, selection, brElm) {\n      var marker = dom.create('span', {}, '&nbsp;');\n      brElm.parentNode.insertBefore(marker, brElm);\n      selection.scrollIntoView(marker);\n      dom.remove(marker);\n    };\n    var moveSelectionToBr = function (dom, selection, brElm, extraBr) {\n      var rng = dom.createRng();\n      if (!extraBr) {\n        rng.setStartAfter(brElm);\n        rng.setEndAfter(brElm);\n      } else {\n        rng.setStartBefore(brElm);\n        rng.setEndBefore(brElm);\n      }\n      selection.setRng(rng);\n    };\n    var insertBrAtCaret = function (editor, evt) {\n      var selection = editor.selection;\n      var dom = editor.dom;\n      var rng = selection.getRng();\n      var brElm;\n      var extraBr;\n      NormalizeRange.normalize(dom, rng).each(function (normRng) {\n        rng.setStart(normRng.startContainer, normRng.startOffset);\n        rng.setEnd(normRng.endContainer, normRng.endOffset);\n      });\n      var offset = rng.startOffset;\n      var container = rng.startContainer;\n      if (container.nodeType === 1 && container.hasChildNodes()) {\n        var isAfterLastNodeInContainer = offset > container.childNodes.length - 1;\n        container = container.childNodes[Math.min(offset, container.childNodes.length - 1)] || container;\n        if (isAfterLastNodeInContainer && container.nodeType === 3) {\n          offset = container.nodeValue.length;\n        } else {\n          offset = 0;\n        }\n      }\n      var parentBlock = dom.getParent(container, dom.isBlock);\n      var containerBlock = parentBlock ? dom.getParent(parentBlock.parentNode, dom.isBlock) : null;\n      var containerBlockName = containerBlock ? containerBlock.nodeName.toUpperCase() : '';\n      var isControlKey = evt && evt.ctrlKey;\n      if (containerBlockName === 'LI' && !isControlKey) {\n        parentBlock = containerBlock;\n      }\n      if (container && container.nodeType === 3 && offset >= container.nodeValue.length) {\n        if (!hasRightSideContent(editor.schema, container, parentBlock)) {\n          brElm = dom.create('br');\n          rng.insertNode(brElm);\n          rng.setStartAfter(brElm);\n          rng.setEndAfter(brElm);\n          extraBr = true;\n        }\n      }\n      brElm = dom.create('br');\n      rangeInsertNode(dom, rng, brElm);\n      scrollToBr(dom, selection, brElm);\n      moveSelectionToBr(dom, selection, brElm, extraBr);\n      editor.undoManager.add();\n    };\n    var insertBrBefore = function (editor, inline) {\n      var br = Element.fromTag('br');\n      before(Element.fromDom(inline), br);\n      editor.undoManager.add();\n    };\n    var insertBrAfter = function (editor, inline) {\n      if (!hasBrAfter(editor.getBody(), inline)) {\n        after(Element.fromDom(inline), Element.fromTag('br'));\n      }\n      var br = Element.fromTag('br');\n      after(Element.fromDom(inline), br);\n      scrollToBr(editor.dom, editor.selection, br.dom());\n      moveSelectionToBr(editor.dom, editor.selection, br.dom(), false);\n      editor.undoManager.add();\n    };\n    var isBeforeBr$1 = function (pos) {\n      return NodeType.isBr(pos.getNode());\n    };\n    var hasBrAfter = function (rootNode, startNode) {\n      if (isBeforeBr$1(CaretPosition$1.after(startNode))) {\n        return true;\n      } else {\n        return CaretFinder.nextPosition(rootNode, CaretPosition$1.after(startNode)).map(function (pos) {\n          return NodeType.isBr(pos.getNode());\n        }).getOr(false);\n      }\n    };\n    var isAnchorLink = function (elm) {\n      return elm && elm.nodeName === 'A' && 'href' in elm;\n    };\n    var isInsideAnchor = function (location) {\n      return location.fold(constant(false), isAnchorLink, isAnchorLink, constant(false));\n    };\n    var readInlineAnchorLocation = function (editor) {\n      var isInlineTarget = curry(InlineUtils.isInlineTarget, editor);\n      var position = CaretPosition$1.fromRangeStart(editor.selection.getRng());\n      return BoundaryLocation.readLocation(isInlineTarget, editor.getBody(), position).filter(isInsideAnchor);\n    };\n    var insertBrOutsideAnchor = function (editor, location) {\n      location.fold(noop, curry(insertBrBefore, editor), curry(insertBrAfter, editor), noop);\n    };\n    var insert = function (editor, evt) {\n      var anchorLocation = readInlineAnchorLocation(editor);\n      if (anchorLocation.isSome()) {\n        anchorLocation.each(curry(insertBrOutsideAnchor, editor));\n      } else {\n        insertBrAtCaret(editor, evt);\n      }\n    };\n    var InsertBr = { insert: insert };\n\n    var create$3 = Immutable('start', 'soffset', 'finish', 'foffset');\n    var SimRange = { create: create$3 };\n\n    var adt = Adt.generate([\n      { before: ['element'] },\n      {\n        on: [\n          'element',\n          'offset'\n        ]\n      },\n      { after: ['element'] }\n    ]);\n    var cata = function (subject, onBefore, onOn, onAfter) {\n      return subject.fold(onBefore, onOn, onAfter);\n    };\n    var getStart = function (situ) {\n      return situ.fold(identity, identity, identity);\n    };\n    var before$4 = adt.before;\n    var on = adt.on;\n    var after$3 = adt.after;\n    var Situ = {\n      before: before$4,\n      on: on,\n      after: after$3,\n      cata: cata,\n      getStart: getStart\n    };\n\n    var adt$1 = Adt.generate([\n      { domRange: ['rng'] },\n      {\n        relative: [\n          'startSitu',\n          'finishSitu'\n        ]\n      },\n      {\n        exact: [\n          'start',\n          'soffset',\n          'finish',\n          'foffset'\n        ]\n      }\n    ]);\n    var exactFromRange = function (simRange) {\n      return adt$1.exact(simRange.start(), simRange.soffset(), simRange.finish(), simRange.foffset());\n    };\n    var getStart$1 = function (selection) {\n      return selection.match({\n        domRange: function (rng) {\n          return Element.fromDom(rng.startContainer);\n        },\n        relative: function (startSitu, finishSitu) {\n          return Situ.getStart(startSitu);\n        },\n        exact: function (start, soffset, finish, foffset) {\n          return start;\n        }\n      });\n    };\n    var domRange = adt$1.domRange;\n    var relative = adt$1.relative;\n    var exact = adt$1.exact;\n    var getWin = function (selection) {\n      var start = getStart$1(selection);\n      return defaultView(start);\n    };\n    var range = SimRange.create;\n    var Selection = {\n      domRange: domRange,\n      relative: relative,\n      exact: exact,\n      exactFromRange: exactFromRange,\n      getWin: getWin,\n      range: range\n    };\n\n    var browser$3 = PlatformDetection$1.detect().browser;\n    var clamp = function (offset, element) {\n      var max = isText(element) ? get$4(element).length : children(element).length + 1;\n      if (offset > max) {\n        return max;\n      } else if (offset < 0) {\n        return 0;\n      }\n      return offset;\n    };\n    var normalizeRng = function (rng) {\n      return Selection.range(rng.start(), clamp(rng.soffset(), rng.start()), rng.finish(), clamp(rng.foffset(), rng.finish()));\n    };\n    var isOrContains = function (root, elm) {\n      return !NodeType.isRestrictedNode(elm.dom()) && (contains$3(root, elm) || eq(root, elm));\n    };\n    var isRngInRoot = function (root) {\n      return function (rng) {\n        return isOrContains(root, rng.start()) && isOrContains(root, rng.finish());\n      };\n    };\n    var shouldStore = function (editor) {\n      return editor.inline === true || browser$3.isIE();\n    };\n    var nativeRangeToSelectionRange = function (r) {\n      return Selection.range(Element.fromDom(r.startContainer), r.startOffset, Element.fromDom(r.endContainer), r.endOffset);\n    };\n    var readRange = function (win) {\n      var selection = win.getSelection();\n      var rng = !selection || selection.rangeCount === 0 ? Option.none() : Option.from(selection.getRangeAt(0));\n      return rng.map(nativeRangeToSelectionRange);\n    };\n    var getBookmark$2 = function (root) {\n      var win = defaultView(root);\n      return readRange(win.dom()).filter(isRngInRoot(root));\n    };\n    var validate = function (root, bookmark) {\n      return Option.from(bookmark).filter(isRngInRoot(root)).map(normalizeRng);\n    };\n    var bookmarkToNativeRng = function (bookmark) {\n      var rng = domGlobals.document.createRange();\n      try {\n        rng.setStart(bookmark.start().dom(), bookmark.soffset());\n        rng.setEnd(bookmark.finish().dom(), bookmark.foffset());\n        return Option.some(rng);\n      } catch (_) {\n        return Option.none();\n      }\n    };\n    var store = function (editor) {\n      var newBookmark = shouldStore(editor) ? getBookmark$2(Element.fromDom(editor.getBody())) : Option.none();\n      editor.bookmark = newBookmark.isSome() ? newBookmark : editor.bookmark;\n    };\n    var storeNative = function (editor, rng) {\n      var root = Element.fromDom(editor.getBody());\n      var range = shouldStore(editor) ? Option.from(rng) : Option.none();\n      var newBookmark = range.map(nativeRangeToSelectionRange).filter(isRngInRoot(root));\n      editor.bookmark = newBookmark.isSome() ? newBookmark : editor.bookmark;\n    };\n    var getRng = function (editor) {\n      var bookmark = editor.bookmark ? editor.bookmark : Option.none();\n      return bookmark.bind(curry(validate, Element.fromDom(editor.getBody()))).bind(bookmarkToNativeRng);\n    };\n    var restore = function (editor) {\n      getRng(editor).each(function (rng) {\n        editor.selection.setRng(rng);\n      });\n    };\n    var SelectionBookmark = {\n      store: store,\n      storeNative: storeNative,\n      readRange: readRange,\n      restore: restore,\n      getRng: getRng,\n      getBookmark: getBookmark$2,\n      validate: validate\n    };\n\n    var indentElement = function (dom, command, useMargin, value, unit, element) {\n      if (dom.getContentEditable(element) === 'false') {\n        return;\n      }\n      var indentStyleName = useMargin ? 'margin' : 'padding';\n      indentStyleName = element.nodeName === 'TABLE' ? 'margin' : indentStyleName;\n      indentStyleName += dom.getStyle(element, 'direction', true) === 'rtl' ? 'Right' : 'Left';\n      if (command === 'outdent') {\n        var styleValue = Math.max(0, parseInt(element.style[indentStyleName] || 0, 10) - value);\n        dom.setStyle(element, indentStyleName, styleValue ? styleValue + unit : '');\n      } else {\n        var styleValue = parseInt(element.style[indentStyleName] || 0, 10) + value + unit;\n        dom.setStyle(element, indentStyleName, styleValue);\n      }\n    };\n    var isListComponent = function (el) {\n      return isList(el) || isListItem(el);\n    };\n    var parentIsListComponent = function (el) {\n      return parent(el).map(isListComponent).getOr(false);\n    };\n    var getBlocksToIndent = function (editor) {\n      return filter(map(editor.selection.getSelectedBlocks(), Element.fromDom), function (el) {\n        return !isListComponent(el) && !parentIsListComponent(el);\n      });\n    };\n    var handle = function (editor, command) {\n      var settings = editor.settings, dom = editor.dom, selection = editor.selection, formatter = editor.formatter;\n      var indentUnit = /[a-z%]+$/i.exec(settings.indentation)[0];\n      var indentValue = parseInt(settings.indentation, 10);\n      var useMargin = editor.getParam('indent_use_margin', false);\n      if (!editor.queryCommandState('InsertUnorderedList') && !editor.queryCommandState('InsertOrderedList')) {\n        if (!settings.forced_root_block && !dom.getParent(selection.getNode(), dom.isBlock)) {\n          formatter.apply('div');\n        }\n      }\n      each(getBlocksToIndent(editor), function (block) {\n        indentElement(dom, command, useMargin, indentValue, indentUnit, block.dom());\n      });\n    };\n\n    var each$a = Tools.each, extend$2 = Tools.extend;\n    var map$3 = Tools.map, inArray$2 = Tools.inArray;\n    function EditorCommands (editor) {\n      var dom, selection, formatter;\n      var commands = {\n        state: {},\n        exec: {},\n        value: {}\n      };\n      var settings = editor.settings, bookmark;\n      editor.on('PreInit', function () {\n        dom = editor.dom;\n        selection = editor.selection;\n        settings = editor.settings;\n        formatter = editor.formatter;\n      });\n      var execCommand = function (command, ui, value, args) {\n        var func, customCommand, state = false;\n        if (editor.removed) {\n          return;\n        }\n        if (!/^(mceAddUndoLevel|mceEndUndoLevel|mceBeginUndoLevel|mceRepaint)$/.test(command) && (!args || !args.skip_focus)) {\n          editor.focus();\n        } else {\n          SelectionBookmark.restore(editor);\n        }\n        args = editor.fire('BeforeExecCommand', {\n          command: command,\n          ui: ui,\n          value: value\n        });\n        if (args.isDefaultPrevented()) {\n          return false;\n        }\n        customCommand = command.toLowerCase();\n        if (func = commands.exec[customCommand]) {\n          func(customCommand, ui, value);\n          editor.fire('ExecCommand', {\n            command: command,\n            ui: ui,\n            value: value\n          });\n          return true;\n        }\n        each$a(editor.plugins, function (p) {\n          if (p.execCommand && p.execCommand(command, ui, value)) {\n            editor.fire('ExecCommand', {\n              command: command,\n              ui: ui,\n              value: value\n            });\n            state = true;\n            return false;\n          }\n        });\n        if (state) {\n          return state;\n        }\n        if (editor.theme && editor.theme.execCommand && editor.theme.execCommand(command, ui, value)) {\n          editor.fire('ExecCommand', {\n            command: command,\n            ui: ui,\n            value: value\n          });\n          return true;\n        }\n        try {\n          state = editor.getDoc().execCommand(command, ui, value);\n        } catch (ex) {\n        }\n        if (state) {\n          editor.fire('ExecCommand', {\n            command: command,\n            ui: ui,\n            value: value\n          });\n          return true;\n        }\n        return false;\n      };\n      var queryCommandState = function (command) {\n        var func;\n        if (editor.quirks.isHidden() || editor.removed) {\n          return;\n        }\n        command = command.toLowerCase();\n        if (func = commands.state[command]) {\n          return func(command);\n        }\n        try {\n          return editor.getDoc().queryCommandState(command);\n        } catch (ex) {\n        }\n        return false;\n      };\n      var queryCommandValue = function (command) {\n        var func;\n        if (editor.quirks.isHidden() || editor.removed) {\n          return;\n        }\n        command = command.toLowerCase();\n        if (func = commands.value[command]) {\n          return func(command);\n        }\n        try {\n          return editor.getDoc().queryCommandValue(command);\n        } catch (ex) {\n        }\n      };\n      var addCommands = function (commandList, type) {\n        type = type || 'exec';\n        each$a(commandList, function (callback, command) {\n          each$a(command.toLowerCase().split(','), function (command) {\n            commands[type][command] = callback;\n          });\n        });\n      };\n      var addCommand = function (command, callback, scope) {\n        command = command.toLowerCase();\n        commands.exec[command] = function (command, ui, value, args) {\n          return callback.call(scope || editor, ui, value, args);\n        };\n      };\n      var queryCommandSupported = function (command) {\n        command = command.toLowerCase();\n        if (commands.exec[command]) {\n          return true;\n        }\n        try {\n          return editor.getDoc().queryCommandSupported(command);\n        } catch (ex) {\n        }\n        return false;\n      };\n      var addQueryStateHandler = function (command, callback, scope) {\n        command = command.toLowerCase();\n        commands.state[command] = function () {\n          return callback.call(scope || editor);\n        };\n      };\n      var addQueryValueHandler = function (command, callback, scope) {\n        command = command.toLowerCase();\n        commands.value[command] = function () {\n          return callback.call(scope || editor);\n        };\n      };\n      var hasCustomCommand = function (command) {\n        command = command.toLowerCase();\n        return !!commands.exec[command];\n      };\n      extend$2(this, {\n        execCommand: execCommand,\n        queryCommandState: queryCommandState,\n        queryCommandValue: queryCommandValue,\n        queryCommandSupported: queryCommandSupported,\n        addCommands: addCommands,\n        addCommand: addCommand,\n        addQueryStateHandler: addQueryStateHandler,\n        addQueryValueHandler: addQueryValueHandler,\n        hasCustomCommand: hasCustomCommand\n      });\n      var execNativeCommand = function (command, ui, value) {\n        if (ui === undefined) {\n          ui = false;\n        }\n        if (value === undefined) {\n          value = null;\n        }\n        return editor.getDoc().execCommand(command, ui, value);\n      };\n      var isFormatMatch = function (name) {\n        return formatter.match(name);\n      };\n      var toggleFormat = function (name, value) {\n        formatter.toggle(name, value ? { value: value } : undefined);\n        editor.nodeChanged();\n      };\n      var storeSelection = function (type) {\n        bookmark = selection.getBookmark(type);\n      };\n      var restoreSelection = function () {\n        selection.moveToBookmark(bookmark);\n      };\n      addCommands({\n        'mceResetDesignMode,mceBeginUndoLevel': function () {\n        },\n        'mceEndUndoLevel,mceAddUndoLevel': function () {\n          editor.undoManager.add();\n        },\n        'Cut,Copy,Paste': function (command) {\n          var doc = editor.getDoc();\n          var failed;\n          try {\n            execNativeCommand(command);\n          } catch (ex) {\n            failed = true;\n          }\n          if (command === 'paste' && !doc.queryCommandEnabled(command)) {\n            failed = true;\n          }\n          if (failed || !doc.queryCommandSupported(command)) {\n            var msg = editor.translate('Your browser doesn\\'t support direct access to the clipboard. ' + 'Please use the Ctrl+X/C/V keyboard shortcuts instead.');\n            if (Env.mac) {\n              msg = msg.replace(/Ctrl\\+/g, '\\u2318+');\n            }\n            editor.notificationManager.open({\n              text: msg,\n              type: 'error'\n            });\n          }\n        },\n        'unlink': function () {\n          if (selection.isCollapsed()) {\n            var elm = editor.dom.getParent(editor.selection.getStart(), 'a');\n            if (elm) {\n              editor.dom.remove(elm, true);\n            }\n            return;\n          }\n          formatter.remove('link');\n        },\n        'JustifyLeft,JustifyCenter,JustifyRight,JustifyFull,JustifyNone': function (command) {\n          var align = command.substring(7);\n          if (align === 'full') {\n            align = 'justify';\n          }\n          each$a('left,center,right,justify'.split(','), function (name) {\n            if (align !== name) {\n              formatter.remove('align' + name);\n            }\n          });\n          if (align !== 'none') {\n            toggleFormat('align' + align);\n          }\n        },\n        'InsertUnorderedList,InsertOrderedList': function (command) {\n          var listElm, listParent;\n          execNativeCommand(command);\n          listElm = dom.getParent(selection.getNode(), 'ol,ul');\n          if (listElm) {\n            listParent = listElm.parentNode;\n            if (/^(H[1-6]|P|ADDRESS|PRE)$/.test(listParent.nodeName)) {\n              storeSelection();\n              dom.split(listParent, listElm);\n              restoreSelection();\n            }\n          }\n        },\n        'Bold,Italic,Underline,Strikethrough,Superscript,Subscript': function (command) {\n          toggleFormat(command);\n        },\n        'ForeColor,HiliteColor': function (command, ui, value) {\n          toggleFormat(command, value);\n        },\n        'FontName': function (command, ui, value) {\n          fontNameAction(editor, value);\n        },\n        'FontSize': function (command, ui, value) {\n          fontSizeAction(editor, value);\n        },\n        'RemoveFormat': function (command) {\n          formatter.remove(command);\n        },\n        'mceBlockQuote': function () {\n          toggleFormat('blockquote');\n        },\n        'FormatBlock': function (command, ui, value) {\n          return toggleFormat(value || 'p');\n        },\n        'mceCleanup': function () {\n          var bookmark = selection.getBookmark();\n          editor.setContent(editor.getContent());\n          selection.moveToBookmark(bookmark);\n        },\n        'mceRemoveNode': function (command, ui, value) {\n          var node = value || selection.getNode();\n          if (node !== editor.getBody()) {\n            storeSelection();\n            editor.dom.remove(node, true);\n            restoreSelection();\n          }\n        },\n        'mceSelectNodeDepth': function (command, ui, value) {\n          var counter = 0;\n          dom.getParent(selection.getNode(), function (node) {\n            if (node.nodeType === 1 && counter++ === value) {\n              selection.select(node);\n              return false;\n            }\n          }, editor.getBody());\n        },\n        'mceSelectNode': function (command, ui, value) {\n          selection.select(value);\n        },\n        'mceInsertContent': function (command, ui, value) {\n          InsertContent.insertAtCaret(editor, value);\n        },\n        'mceInsertRawHTML': function (command, ui, value) {\n          selection.setContent('tiny_mce_marker');\n          var content = editor.getContent();\n          editor.setContent(content.replace(/tiny_mce_marker/g, function () {\n            return value;\n          }));\n        },\n        'mceToggleFormat': function (command, ui, value) {\n          toggleFormat(value);\n        },\n        'mceSetContent': function (command, ui, value) {\n          editor.setContent(value);\n        },\n        'Indent,Outdent': function (command) {\n          handle(editor, command);\n        },\n        'mceRepaint': function () {\n        },\n        'InsertHorizontalRule': function () {\n          editor.execCommand('mceInsertContent', false, '<hr />');\n        },\n        'mceToggleVisualAid': function () {\n          editor.hasVisual = !editor.hasVisual;\n          editor.addVisual();\n        },\n        'mceReplaceContent': function (command, ui, value) {\n          editor.execCommand('mceInsertContent', false, value.replace(/\\{\\$selection\\}/g, selection.getContent({ format: 'text' })));\n        },\n        'mceInsertLink': function (command, ui, value) {\n          var anchor;\n          if (typeof value === 'string') {\n            value = { href: value };\n          }\n          anchor = dom.getParent(selection.getNode(), 'a');\n          value.href = value.href.replace(' ', '%20');\n          if (!anchor || !value.href) {\n            formatter.remove('link');\n          }\n          if (value.href) {\n            formatter.apply('link', value, anchor);\n          }\n        },\n        'selectAll': function () {\n          var editingHost = dom.getParent(selection.getStart(), NodeType.isContentEditableTrue);\n          if (editingHost) {\n            var rng = dom.createRng();\n            rng.selectNodeContents(editingHost);\n            selection.setRng(rng);\n          }\n        },\n        'delete': function () {\n          DeleteCommands.deleteCommand(editor);\n        },\n        'forwardDelete': function () {\n          DeleteCommands.forwardDeleteCommand(editor);\n        },\n        'mceNewDocument': function () {\n          editor.setContent('');\n        },\n        'InsertLineBreak': function (command, ui, value) {\n          InsertBr.insert(editor, value);\n          return true;\n        }\n      });\n      var alignStates = function (name) {\n        return function () {\n          var nodes = selection.isCollapsed() ? [dom.getParent(selection.getNode(), dom.isBlock)] : selection.getSelectedBlocks();\n          var matches = map$3(nodes, function (node) {\n            return !!formatter.matchNode(node, name);\n          });\n          return inArray$2(matches, true) !== -1;\n        };\n      };\n      addCommands({\n        'JustifyLeft': alignStates('alignleft'),\n        'JustifyCenter': alignStates('aligncenter'),\n        'JustifyRight': alignStates('alignright'),\n        'JustifyFull': alignStates('alignjustify'),\n        'Bold,Italic,Underline,Strikethrough,Superscript,Subscript': function (command) {\n          return isFormatMatch(command);\n        },\n        'mceBlockQuote': function () {\n          return isFormatMatch('blockquote');\n        },\n        'Outdent': function () {\n          var node;\n          if (settings.inline_styles) {\n            if ((node = dom.getParent(selection.getStart(), dom.isBlock)) && parseInt(node.style.paddingLeft, 10) > 0) {\n              return true;\n            }\n            if ((node = dom.getParent(selection.getEnd(), dom.isBlock)) && parseInt(node.style.paddingLeft, 10) > 0) {\n              return true;\n            }\n          }\n          return queryCommandState('InsertUnorderedList') || queryCommandState('InsertOrderedList') || !settings.inline_styles && !!dom.getParent(selection.getNode(), 'BLOCKQUOTE');\n        },\n        'InsertUnorderedList,InsertOrderedList': function (command) {\n          var list = dom.getParent(selection.getNode(), 'ul,ol');\n          return list && (command === 'insertunorderedlist' && list.tagName === 'UL' || command === 'insertorderedlist' && list.tagName === 'OL');\n        }\n      }, 'state');\n      addCommands({\n        Undo: function () {\n          editor.undoManager.undo();\n        },\n        Redo: function () {\n          editor.undoManager.redo();\n        }\n      });\n      addQueryValueHandler('FontName', function () {\n        return fontNameQuery(editor);\n      }, this);\n      addQueryValueHandler('FontSize', function () {\n        return fontSizeQuery(editor);\n      }, this);\n    }\n\n    var nativeEvents = Tools.makeMap('focus blur focusin focusout click dblclick mousedown mouseup mousemove mouseover beforepaste paste cut copy selectionchange ' + 'mouseout mouseenter mouseleave wheel keydown keypress keyup input contextmenu dragstart dragend dragover ' + 'draggesture dragdrop drop drag submit ' + 'compositionstart compositionend compositionupdate touchstart touchmove touchend', ' ');\n    var Dispatcher = function (settings) {\n      var self = this;\n      var scope, bindings = {}, toggleEvent;\n      var returnFalse = function () {\n        return false;\n      };\n      var returnTrue = function () {\n        return true;\n      };\n      settings = settings || {};\n      scope = settings.scope || self;\n      toggleEvent = settings.toggleEvent || returnFalse;\n      var fire = function (name, args) {\n        var handlers, i, l, callback;\n        name = name.toLowerCase();\n        args = args || {};\n        args.type = name;\n        if (!args.target) {\n          args.target = scope;\n        }\n        if (!args.preventDefault) {\n          args.preventDefault = function () {\n            args.isDefaultPrevented = returnTrue;\n          };\n          args.stopPropagation = function () {\n            args.isPropagationStopped = returnTrue;\n          };\n          args.stopImmediatePropagation = function () {\n            args.isImmediatePropagationStopped = returnTrue;\n          };\n          args.isDefaultPrevented = returnFalse;\n          args.isPropagationStopped = returnFalse;\n          args.isImmediatePropagationStopped = returnFalse;\n        }\n        if (settings.beforeFire) {\n          settings.beforeFire(args);\n        }\n        handlers = bindings[name];\n        if (handlers) {\n          for (i = 0, l = handlers.length; i < l; i++) {\n            callback = handlers[i];\n            if (callback.once) {\n              off(name, callback.func);\n            }\n            if (args.isImmediatePropagationStopped()) {\n              args.stopPropagation();\n              return args;\n            }\n            if (callback.func.call(scope, args) === false) {\n              args.preventDefault();\n              return args;\n            }\n          }\n        }\n        return args;\n      };\n      var on = function (name, callback, prepend, extra) {\n        var handlers, names, i;\n        if (callback === false) {\n          callback = returnFalse;\n        }\n        if (callback) {\n          callback = { func: callback };\n          if (extra) {\n            Tools.extend(callback, extra);\n          }\n          names = name.toLowerCase().split(' ');\n          i = names.length;\n          while (i--) {\n            name = names[i];\n            handlers = bindings[name];\n            if (!handlers) {\n              handlers = bindings[name] = [];\n              toggleEvent(name, true);\n            }\n            if (prepend) {\n              handlers.unshift(callback);\n            } else {\n              handlers.push(callback);\n            }\n          }\n        }\n        return self;\n      };\n      var off = function (name, callback) {\n        var i, handlers, bindingName, names, hi;\n        if (name) {\n          names = name.toLowerCase().split(' ');\n          i = names.length;\n          while (i--) {\n            name = names[i];\n            handlers = bindings[name];\n            if (!name) {\n              for (bindingName in bindings) {\n                toggleEvent(bindingName, false);\n                delete bindings[bindingName];\n              }\n              return self;\n            }\n            if (handlers) {\n              if (!callback) {\n                handlers.length = 0;\n              } else {\n                hi = handlers.length;\n                while (hi--) {\n                  if (handlers[hi].func === callback) {\n                    handlers = handlers.slice(0, hi).concat(handlers.slice(hi + 1));\n                    bindings[name] = handlers;\n                  }\n                }\n              }\n              if (!handlers.length) {\n                toggleEvent(name, false);\n                delete bindings[name];\n              }\n            }\n          }\n        } else {\n          for (name in bindings) {\n            toggleEvent(name, false);\n          }\n          bindings = {};\n        }\n        return self;\n      };\n      var once = function (name, callback, prepend) {\n        return on(name, callback, prepend, { once: true });\n      };\n      var has = function (name) {\n        name = name.toLowerCase();\n        return !(!bindings[name] || bindings[name].length === 0);\n      };\n      self.fire = fire;\n      self.on = on;\n      self.off = off;\n      self.once = once;\n      self.has = has;\n    };\n    Dispatcher.isNative = function (name) {\n      return !!nativeEvents[name.toLowerCase()];\n    };\n\n    var getEventDispatcher = function (obj) {\n      if (!obj._eventDispatcher) {\n        obj._eventDispatcher = new Dispatcher({\n          scope: obj,\n          toggleEvent: function (name, state) {\n            if (Dispatcher.isNative(name) && obj.toggleNativeEvent) {\n              obj.toggleNativeEvent(name, state);\n            }\n          }\n        });\n      }\n      return obj._eventDispatcher;\n    };\n    var Observable = {\n      fire: function (name, args, bubble) {\n        var self = this;\n        if (self.removed && name !== 'remove' && name !== 'detach') {\n          return args;\n        }\n        args = getEventDispatcher(self).fire(name, args, bubble);\n        if (bubble !== false && self.parent) {\n          var parent = self.parent();\n          while (parent && !args.isPropagationStopped()) {\n            parent.fire(name, args, false);\n            parent = parent.parent();\n          }\n        }\n        return args;\n      },\n      on: function (name, callback, prepend) {\n        return getEventDispatcher(this).on(name, callback, prepend);\n      },\n      off: function (name, callback) {\n        return getEventDispatcher(this).off(name, callback);\n      },\n      once: function (name, callback) {\n        return getEventDispatcher(this).once(name, callback);\n      },\n      hasEventListeners: function (name) {\n        return getEventDispatcher(this).has(name);\n      }\n    };\n\n    var firePreProcess = function (editor, args) {\n      return editor.fire('PreProcess', args);\n    };\n    var firePostProcess = function (editor, args) {\n      return editor.fire('PostProcess', args);\n    };\n    var fireRemove = function (editor) {\n      return editor.fire('remove');\n    };\n    var fireDetach = function (editor) {\n      return editor.fire('detach');\n    };\n    var fireSwitchMode = function (editor, mode) {\n      return editor.fire('SwitchMode', { mode: mode });\n    };\n    var fireObjectResizeStart = function (editor, target, width, height) {\n      editor.fire('ObjectResizeStart', {\n        target: target,\n        width: width,\n        height: height\n      });\n    };\n    var fireObjectResized = function (editor, target, width, height) {\n      editor.fire('ObjectResized', {\n        target: target,\n        width: width,\n        height: height\n      });\n    };\n    var Events = {\n      firePreProcess: firePreProcess,\n      firePostProcess: firePostProcess,\n      fireRemove: fireRemove,\n      fireDetach: fireDetach,\n      fireSwitchMode: fireSwitchMode,\n      fireObjectResizeStart: fireObjectResizeStart,\n      fireObjectResized: fireObjectResized\n    };\n\n    var setEditorCommandState = function (editor, cmd, state) {\n      try {\n        editor.getDoc().execCommand(cmd, false, state);\n      } catch (ex) {\n      }\n    };\n    var toggleClass = function (elm, cls, state) {\n      if (has$2(elm, cls) && state === false) {\n        remove$4(elm, cls);\n      } else if (state) {\n        add$2(elm, cls);\n      }\n    };\n    var toggleReadOnly = function (editor, state) {\n      toggleClass(Element.fromDom(editor.getBody()), 'mce-content-readonly', state);\n      if (state) {\n        editor.selection.controlSelection.hideResizeRect();\n        editor.readonly = true;\n        editor.getBody().contentEditable = 'false';\n      } else {\n        editor.readonly = false;\n        editor.getBody().contentEditable = 'true';\n        setEditorCommandState(editor, 'StyleWithCSS', false);\n        setEditorCommandState(editor, 'enableInlineTableEditing', false);\n        setEditorCommandState(editor, 'enableObjectResizing', false);\n        editor.focus();\n        editor.nodeChanged();\n      }\n    };\n    var setMode = function (editor, mode) {\n      if (mode === getMode(editor)) {\n        return;\n      }\n      if (editor.initialized) {\n        toggleReadOnly(editor, mode === 'readonly');\n      } else {\n        editor.on('init', function () {\n          toggleReadOnly(editor, mode === 'readonly');\n        });\n      }\n      Events.fireSwitchMode(editor, mode);\n    };\n    var getMode = function (editor) {\n      return editor.readonly ? 'readonly' : 'design';\n    };\n    var isReadOnly = function (editor) {\n      return editor.readonly === true;\n    };\n\n    var DOM$1 = DOMUtils$1.DOM;\n    var customEventRootDelegates;\n    var getEventTarget = function (editor, eventName) {\n      if (eventName === 'selectionchange') {\n        return editor.getDoc();\n      }\n      if (!editor.inline && /^mouse|touch|click|contextmenu|drop|dragover|dragend/.test(eventName)) {\n        return editor.getDoc().documentElement;\n      }\n      if (editor.settings.event_root) {\n        if (!editor.eventRoot) {\n          editor.eventRoot = DOM$1.select(editor.settings.event_root)[0];\n        }\n        return editor.eventRoot;\n      }\n      return editor.getBody();\n    };\n    var isListening = function (editor) {\n      return !editor.hidden && !editor.readonly;\n    };\n    var fireEvent = function (editor, eventName, e) {\n      if (isListening(editor)) {\n        editor.fire(eventName, e);\n      } else if (isReadOnly(editor)) {\n        e.preventDefault();\n      }\n    };\n    var bindEventDelegate = function (editor, eventName) {\n      var eventRootElm, delegate;\n      if (!editor.delegates) {\n        editor.delegates = {};\n      }\n      if (editor.delegates[eventName] || editor.removed) {\n        return;\n      }\n      eventRootElm = getEventTarget(editor, eventName);\n      if (editor.settings.event_root) {\n        if (!customEventRootDelegates) {\n          customEventRootDelegates = {};\n          editor.editorManager.on('removeEditor', function () {\n            var name;\n            if (!editor.editorManager.activeEditor) {\n              if (customEventRootDelegates) {\n                for (name in customEventRootDelegates) {\n                  editor.dom.unbind(getEventTarget(editor, name));\n                }\n                customEventRootDelegates = null;\n              }\n            }\n          });\n        }\n        if (customEventRootDelegates[eventName]) {\n          return;\n        }\n        delegate = function (e) {\n          var target = e.target;\n          var editors = editor.editorManager.get();\n          var i = editors.length;\n          while (i--) {\n            var body = editors[i].getBody();\n            if (body === target || DOM$1.isChildOf(target, body)) {\n              fireEvent(editors[i], eventName, e);\n            }\n          }\n        };\n        customEventRootDelegates[eventName] = delegate;\n        DOM$1.bind(eventRootElm, eventName, delegate);\n      } else {\n        delegate = function (e) {\n          fireEvent(editor, eventName, e);\n        };\n        DOM$1.bind(eventRootElm, eventName, delegate);\n        editor.delegates[eventName] = delegate;\n      }\n    };\n    var EditorObservable = {\n      bindPendingEventDelegates: function () {\n        var self = this;\n        Tools.each(self._pendingNativeEvents, function (name) {\n          bindEventDelegate(self, name);\n        });\n      },\n      toggleNativeEvent: function (name, state) {\n        var self = this;\n        if (name === 'focus' || name === 'blur') {\n          return;\n        }\n        if (state) {\n          if (self.initialized) {\n            bindEventDelegate(self, name);\n          } else {\n            if (!self._pendingNativeEvents) {\n              self._pendingNativeEvents = [name];\n            } else {\n              self._pendingNativeEvents.push(name);\n            }\n          }\n        } else if (self.initialized) {\n          self.dom.unbind(getEventTarget(self, name), name, self.delegates[name]);\n          delete self.delegates[name];\n        }\n      },\n      unbindAllNativeEvents: function () {\n        var self = this;\n        var body = self.getBody();\n        var dom = self.dom;\n        var name;\n        if (self.delegates) {\n          for (name in self.delegates) {\n            self.dom.unbind(getEventTarget(self, name), name, self.delegates[name]);\n          }\n          delete self.delegates;\n        }\n        if (!self.inline && body && dom) {\n          body.onload = null;\n          dom.unbind(self.getWin());\n          dom.unbind(self.getDoc());\n        }\n        if (dom) {\n          dom.unbind(body);\n          dom.unbind(self.getContainer());\n        }\n      }\n    };\n    EditorObservable = Tools.extend({}, Observable, EditorObservable);\n    var EditorObservable$1 = EditorObservable;\n\n    var sectionResult = Immutable('sections', 'settings');\n    var detection = PlatformDetection$1.detect();\n    var isTouch = detection.deviceType.isTouch();\n    var mobilePlugins = [\n      'lists',\n      'autolink',\n      'autosave'\n    ];\n    var defaultMobileSettings = { theme: 'mobile' };\n    var normalizePlugins = function (plugins) {\n      var pluginNames = isArray(plugins) ? plugins.join(' ') : plugins;\n      var trimmedPlugins = map(isString(pluginNames) ? pluginNames.split(' ') : [], trim$2);\n      return filter(trimmedPlugins, function (item) {\n        return item.length > 0;\n      });\n    };\n    var filterMobilePlugins = function (plugins) {\n      return filter(plugins, curry(contains, mobilePlugins));\n    };\n    var extractSections = function (keys, settings) {\n      var result = bifilter(settings, function (value, key) {\n        return contains(keys, key);\n      });\n      return sectionResult(result.t, result.f);\n    };\n    var getSection = function (sectionResult, name, defaults) {\n      var sections = sectionResult.sections();\n      var sectionSettings = sections.hasOwnProperty(name) ? sections[name] : {};\n      return Tools.extend({}, defaults, sectionSettings);\n    };\n    var hasSection = function (sectionResult, name) {\n      return sectionResult.sections().hasOwnProperty(name);\n    };\n    var getDefaultSettings = function (id, documentBaseUrl, editor) {\n      return {\n        id: id,\n        theme: 'modern',\n        delta_width: 0,\n        delta_height: 0,\n        popup_css: '',\n        plugins: '',\n        document_base_url: documentBaseUrl,\n        add_form_submit_trigger: true,\n        submit_patch: true,\n        add_unload_trigger: true,\n        convert_urls: true,\n        relative_urls: true,\n        remove_script_host: true,\n        object_resizing: true,\n        doctype: '<!DOCTYPE html>',\n        visual: true,\n        font_size_style_values: 'xx-small,x-small,small,medium,large,x-large,xx-large',\n        font_size_legacy_values: 'xx-small,small,medium,large,x-large,xx-large,300%',\n        forced_root_block: 'p',\n        hidden_input: true,\n        render_ui: true,\n        indentation: '40px',\n        inline_styles: true,\n        convert_fonts_to_spans: true,\n        indent: 'simple',\n        indent_before: 'p,h1,h2,h3,h4,h5,h6,blockquote,div,title,style,pre,script,td,th,ul,ol,li,dl,dt,dd,area,table,thead,' + 'tfoot,tbody,tr,section,summary,article,hgroup,aside,figure,figcaption,option,optgroup,datalist',\n        indent_after: 'p,h1,h2,h3,h4,h5,h6,blockquote,div,title,style,pre,script,td,th,ul,ol,li,dl,dt,dd,area,table,thead,' + 'tfoot,tbody,tr,section,summary,article,hgroup,aside,figure,figcaption,option,optgroup,datalist',\n        entity_encoding: 'named',\n        url_converter: editor.convertURL,\n        url_converter_scope: editor,\n        ie7_compat: true\n      };\n    };\n    var getExternalPlugins = function (overrideSettings, settings) {\n      var userDefinedExternalPlugins = settings.external_plugins ? settings.external_plugins : {};\n      if (overrideSettings && overrideSettings.external_plugins) {\n        return Tools.extend({}, overrideSettings.external_plugins, userDefinedExternalPlugins);\n      } else {\n        return userDefinedExternalPlugins;\n      }\n    };\n    var combinePlugins = function (forcedPlugins, plugins) {\n      return [].concat(normalizePlugins(forcedPlugins)).concat(normalizePlugins(plugins));\n    };\n    var processPlugins = function (isTouchDevice, sectionResult, defaultOverrideSettings, settings) {\n      var forcedPlugins = normalizePlugins(defaultOverrideSettings.forced_plugins);\n      var plugins = normalizePlugins(settings.plugins);\n      var platformPlugins = isTouchDevice && hasSection(sectionResult, 'mobile') ? filterMobilePlugins(plugins) : plugins;\n      var combinedPlugins = combinePlugins(forcedPlugins, platformPlugins);\n      return Tools.extend(settings, { plugins: combinedPlugins.join(' ') });\n    };\n    var isOnMobile = function (isTouchDevice, sectionResult) {\n      var isInline = sectionResult.settings().inline;\n      return isTouchDevice && hasSection(sectionResult, 'mobile') && !isInline;\n    };\n    var combineSettings = function (isTouchDevice, defaultSettings, defaultOverrideSettings, settings) {\n      var sectionResult = extractSections(['mobile'], settings);\n      var extendedSettings = Tools.extend(defaultSettings, defaultOverrideSettings, sectionResult.settings(), isOnMobile(isTouchDevice, sectionResult) ? getSection(sectionResult, 'mobile', defaultMobileSettings) : {}, {\n        validate: true,\n        content_editable: sectionResult.settings().inline,\n        external_plugins: getExternalPlugins(defaultOverrideSettings, sectionResult.settings())\n      });\n      return processPlugins(isTouchDevice, sectionResult, defaultOverrideSettings, extendedSettings);\n    };\n    var getEditorSettings = function (editor, id, documentBaseUrl, defaultOverrideSettings, settings) {\n      var defaultSettings = getDefaultSettings(id, documentBaseUrl, editor);\n      return combineSettings(isTouch, defaultSettings, defaultOverrideSettings, settings);\n    };\n    var getFiltered = function (predicate, editor, name) {\n      return Option.from(editor.settings[name]).filter(predicate);\n    };\n    var getParamObject = function (value) {\n      var output = {};\n      if (typeof value === 'string') {\n        each(value.indexOf('=') > 0 ? value.split(/[;,](?![^=;,]*(?:[;,]|$))/) : value.split(','), function (val) {\n          var arr = val.split('=');\n          if (arr.length > 1) {\n            output[Tools.trim(arr[0])] = Tools.trim(arr[1]);\n          } else {\n            output[Tools.trim(arr[0])] = Tools.trim(arr);\n          }\n        });\n      } else {\n        output = value;\n      }\n      return output;\n    };\n    var isArrayOf = function (p) {\n      return function (a) {\n        return isArray(a) && forall(a, p);\n      };\n    };\n    var getParam = function (editor, name, defaultVal, type) {\n      var value = name in editor.settings ? editor.settings[name] : defaultVal;\n      if (type === 'hash') {\n        return getParamObject(value);\n      } else if (type === 'string') {\n        return getFiltered(isString, editor, name).getOr(defaultVal);\n      } else if (type === 'number') {\n        return getFiltered(isNumber, editor, name).getOr(defaultVal);\n      } else if (type === 'boolean') {\n        return getFiltered(isBoolean, editor, name).getOr(defaultVal);\n      } else if (type === 'object') {\n        return getFiltered(isObject, editor, name).getOr(defaultVal);\n      } else if (type === 'array') {\n        return getFiltered(isArray, editor, name).getOr(defaultVal);\n      } else if (type === 'string[]') {\n        return getFiltered(isArrayOf(isString), editor, name).getOr(defaultVal);\n      } else if (type === 'function') {\n        return getFiltered(isFunction, editor, name).getOr(defaultVal);\n      } else {\n        return value;\n      }\n    };\n\n    var each$b = Tools.each, explode$2 = Tools.explode;\n    var keyCodeLookup = {\n      f1: 112,\n      f2: 113,\n      f3: 114,\n      f4: 115,\n      f5: 116,\n      f6: 117,\n      f7: 118,\n      f8: 119,\n      f9: 120,\n      f10: 121,\n      f11: 122,\n      f12: 123\n    };\n    var modifierNames = Tools.makeMap('alt,ctrl,shift,meta,access');\n    function Shortcuts (editor) {\n      var self = this;\n      var shortcuts = {};\n      var pendingPatterns = [];\n      var parseShortcut = function (pattern) {\n        var id, key;\n        var shortcut = {};\n        each$b(explode$2(pattern, '+'), function (value) {\n          if (value in modifierNames) {\n            shortcut[value] = true;\n          } else {\n            if (/^[0-9]{2,}$/.test(value)) {\n              shortcut.keyCode = parseInt(value, 10);\n            } else {\n              shortcut.charCode = value.charCodeAt(0);\n              shortcut.keyCode = keyCodeLookup[value] || value.toUpperCase().charCodeAt(0);\n            }\n          }\n        });\n        id = [shortcut.keyCode];\n        for (key in modifierNames) {\n          if (shortcut[key]) {\n            id.push(key);\n          } else {\n            shortcut[key] = false;\n          }\n        }\n        shortcut.id = id.join(',');\n        if (shortcut.access) {\n          shortcut.alt = true;\n          if (Env.mac) {\n            shortcut.ctrl = true;\n          } else {\n            shortcut.shift = true;\n          }\n        }\n        if (shortcut.meta) {\n          if (Env.mac) {\n            shortcut.meta = true;\n          } else {\n            shortcut.ctrl = true;\n            shortcut.meta = false;\n          }\n        }\n        return shortcut;\n      };\n      var createShortcut = function (pattern, desc, cmdFunc, scope) {\n        var shortcuts;\n        shortcuts = Tools.map(explode$2(pattern, '>'), parseShortcut);\n        shortcuts[shortcuts.length - 1] = Tools.extend(shortcuts[shortcuts.length - 1], {\n          func: cmdFunc,\n          scope: scope || editor\n        });\n        return Tools.extend(shortcuts[0], {\n          desc: editor.translate(desc),\n          subpatterns: shortcuts.slice(1)\n        });\n      };\n      var hasModifier = function (e) {\n        return e.altKey || e.ctrlKey || e.metaKey;\n      };\n      var isFunctionKey = function (e) {\n        return e.type === 'keydown' && e.keyCode >= 112 && e.keyCode <= 123;\n      };\n      var matchShortcut = function (e, shortcut) {\n        if (!shortcut) {\n          return false;\n        }\n        if (shortcut.ctrl !== e.ctrlKey || shortcut.meta !== e.metaKey) {\n          return false;\n        }\n        if (shortcut.alt !== e.altKey || shortcut.shift !== e.shiftKey) {\n          return false;\n        }\n        if (e.keyCode === shortcut.keyCode || e.charCode && e.charCode === shortcut.charCode) {\n          e.preventDefault();\n          return true;\n        }\n        return false;\n      };\n      var executeShortcutAction = function (shortcut) {\n        return shortcut.func ? shortcut.func.call(shortcut.scope) : null;\n      };\n      editor.on('keyup keypress keydown', function (e) {\n        if ((hasModifier(e) || isFunctionKey(e)) && !e.isDefaultPrevented()) {\n          each$b(shortcuts, function (shortcut) {\n            if (matchShortcut(e, shortcut)) {\n              pendingPatterns = shortcut.subpatterns.slice(0);\n              if (e.type === 'keydown') {\n                executeShortcutAction(shortcut);\n              }\n              return true;\n            }\n          });\n          if (matchShortcut(e, pendingPatterns[0])) {\n            if (pendingPatterns.length === 1) {\n              if (e.type === 'keydown') {\n                executeShortcutAction(pendingPatterns[0]);\n              }\n            }\n            pendingPatterns.shift();\n          }\n        }\n      });\n      self.add = function (pattern, desc, cmdFunc, scope) {\n        var cmd;\n        cmd = cmdFunc;\n        if (typeof cmdFunc === 'string') {\n          cmdFunc = function () {\n            editor.execCommand(cmd, false, null);\n          };\n        } else if (Tools.isArray(cmd)) {\n          cmdFunc = function () {\n            editor.execCommand(cmd[0], cmd[1], cmd[2]);\n          };\n        }\n        each$b(explode$2(Tools.trim(pattern.toLowerCase())), function (pattern) {\n          var shortcut = createShortcut(pattern, desc, cmdFunc, scope);\n          shortcuts[shortcut.id] = shortcut;\n        });\n        return true;\n      };\n      self.remove = function (pattern) {\n        var shortcut = createShortcut(pattern);\n        if (shortcuts[shortcut.id]) {\n          delete shortcuts[shortcut.id];\n          return true;\n        }\n        return false;\n      };\n    }\n\n    var hasFocus = function (element) {\n      var doc = owner(element).dom();\n      return element.dom() === doc.activeElement;\n    };\n    var active = function (_doc) {\n      var doc = _doc !== undefined ? _doc.dom() : domGlobals.document;\n      return Option.from(doc.activeElement).map(Element.fromDom);\n    };\n    var search = function (element) {\n      return active(owner(element)).filter(function (e) {\n        return element.dom().contains(e.dom());\n      });\n    };\n\n    var getContentEditableHost = function (editor, node) {\n      return editor.dom.getParent(node, function (node) {\n        return editor.dom.getContentEditable(node) === 'true';\n      });\n    };\n    var getCollapsedNode = function (rng) {\n      return rng.collapsed ? Option.from(getNode(rng.startContainer, rng.startOffset)).map(Element.fromDom) : Option.none();\n    };\n    var getFocusInElement = function (root, rng) {\n      return getCollapsedNode(rng).bind(function (node) {\n        if (isTableSection(node)) {\n          return Option.some(node);\n        } else if (contains$3(root, node) === false) {\n          return Option.some(root);\n        } else {\n          return Option.none();\n        }\n      });\n    };\n    var normalizeSelection = function (editor, rng) {\n      getFocusInElement(Element.fromDom(editor.getBody()), rng).bind(function (elm) {\n        return CaretFinder.firstPositionIn(elm.dom());\n      }).fold(function () {\n        editor.selection.normalize();\n        return;\n      }, function (caretPos) {\n        return editor.selection.setRng(caretPos.toRange());\n      });\n    };\n    var focusBody = function (body) {\n      if (body.setActive) {\n        try {\n          body.setActive();\n        } catch (ex) {\n          body.focus();\n        }\n      } else {\n        body.focus();\n      }\n    };\n    var hasElementFocus = function (elm) {\n      return hasFocus(elm) || search(elm).isSome();\n    };\n    var hasIframeFocus = function (editor) {\n      return editor.iframeElement && hasFocus(Element.fromDom(editor.iframeElement));\n    };\n    var hasInlineFocus = function (editor) {\n      var rawBody = editor.getBody();\n      return rawBody && hasElementFocus(Element.fromDom(rawBody));\n    };\n    var hasFocus$1 = function (editor) {\n      return editor.inline ? hasInlineFocus(editor) : hasIframeFocus(editor);\n    };\n    var focusEditor = function (editor) {\n      var selection = editor.selection, contentEditable = editor.settings.content_editable;\n      var body = editor.getBody();\n      var rng = selection.getRng();\n      editor.quirks.refreshContentEditable();\n      var contentEditableHost = getContentEditableHost(editor, selection.getNode());\n      if (editor.$.contains(body, contentEditableHost)) {\n        focusBody(contentEditableHost);\n        normalizeSelection(editor, rng);\n        activateEditor(editor);\n        return;\n      }\n      if (editor.bookmark !== undefined && hasFocus$1(editor) === false) {\n        SelectionBookmark.getRng(editor).each(function (bookmarkRng) {\n          editor.selection.setRng(bookmarkRng);\n          rng = bookmarkRng;\n        });\n      }\n      if (!contentEditable) {\n        if (!Env.opera) {\n          focusBody(body);\n        }\n        editor.getWin().focus();\n      }\n      if (Env.gecko || contentEditable) {\n        focusBody(body);\n        normalizeSelection(editor, rng);\n      }\n      activateEditor(editor);\n    };\n    var activateEditor = function (editor) {\n      return editor.editorManager.setActive(editor);\n    };\n    var focus = function (editor, skipFocus) {\n      if (editor.removed) {\n        return;\n      }\n      skipFocus ? activateEditor(editor) : focusEditor(editor);\n    };\n    var EditorFocus = {\n      focus: focus,\n      hasFocus: hasFocus$1\n    };\n\n    var getProp = function (propName, elm) {\n      var rawElm = elm.dom();\n      return rawElm[propName];\n    };\n    var getComputedSizeProp = function (propName, elm) {\n      return parseInt(get$1(elm, propName), 10);\n    };\n    var getClientWidth = curry(getProp, 'clientWidth');\n    var getClientHeight = curry(getProp, 'clientHeight');\n    var getMarginTop = curry(getComputedSizeProp, 'margin-top');\n    var getMarginLeft = curry(getComputedSizeProp, 'margin-left');\n    var getBoundingClientRect$1 = function (elm) {\n      return elm.dom().getBoundingClientRect();\n    };\n    var isInsideElementContentArea = function (bodyElm, clientX, clientY) {\n      var clientWidth = getClientWidth(bodyElm);\n      var clientHeight = getClientHeight(bodyElm);\n      return clientX >= 0 && clientY >= 0 && clientX <= clientWidth && clientY <= clientHeight;\n    };\n    var transpose = function (inline, elm, clientX, clientY) {\n      var clientRect = getBoundingClientRect$1(elm);\n      var deltaX = inline ? clientRect.left + elm.dom().clientLeft + getMarginLeft(elm) : 0;\n      var deltaY = inline ? clientRect.top + elm.dom().clientTop + getMarginTop(elm) : 0;\n      var x = clientX - deltaX;\n      var y = clientY - deltaY;\n      return {\n        x: x,\n        y: y\n      };\n    };\n    var isXYInContentArea = function (editor, clientX, clientY) {\n      var bodyElm = Element.fromDom(editor.getBody());\n      var targetElm = editor.inline ? bodyElm : documentElement(bodyElm);\n      var transposedPoint = transpose(editor.inline, targetElm, clientX, clientY);\n      return isInsideElementContentArea(targetElm, transposedPoint.x, transposedPoint.y);\n    };\n    var fromDomSafe = function (node) {\n      return Option.from(node).map(Element.fromDom);\n    };\n    var isEditorAttachedToDom = function (editor) {\n      var rawContainer = editor.inline ? editor.getBody() : editor.getContentAreaContainer();\n      return fromDomSafe(rawContainer).map(function (container) {\n        return contains$3(owner(container), container);\n      }).getOr(false);\n    };\n    var EditorView = {\n      isXYInContentArea: isXYInContentArea,\n      isEditorAttachedToDom: isEditorAttachedToDom\n    };\n\n    function NotificationManagerImpl () {\n      var unimplemented = function () {\n        throw new Error('Theme did not provide a NotificationManager implementation.');\n      };\n      return {\n        open: unimplemented,\n        close: unimplemented,\n        reposition: unimplemented,\n        getArgs: unimplemented\n      };\n    }\n\n    function NotificationManager (editor) {\n      var notifications = [];\n      var getImplementation = function () {\n        var theme = editor.theme;\n        return theme && theme.getNotificationManagerImpl ? theme.getNotificationManagerImpl() : NotificationManagerImpl();\n      };\n      var getTopNotification = function () {\n        return Option.from(notifications[0]);\n      };\n      var isEqual = function (a, b) {\n        return a.type === b.type && a.text === b.text && !a.progressBar && !a.timeout && !b.progressBar && !b.timeout;\n      };\n      var reposition = function () {\n        if (notifications.length > 0) {\n          getImplementation().reposition(notifications);\n        }\n      };\n      var addNotification = function (notification) {\n        notifications.push(notification);\n      };\n      var closeNotification = function (notification) {\n        findIndex(notifications, function (otherNotification) {\n          return otherNotification === notification;\n        }).each(function (index) {\n          notifications.splice(index, 1);\n        });\n      };\n      var open = function (args) {\n        if (editor.removed || !EditorView.isEditorAttachedToDom(editor)) {\n          return;\n        }\n        return find(notifications, function (notification) {\n          return isEqual(getImplementation().getArgs(notification), args);\n        }).getOrThunk(function () {\n          editor.editorManager.setActive(editor);\n          var notification = getImplementation().open(args, function () {\n            closeNotification(notification);\n            reposition();\n          });\n          addNotification(notification);\n          reposition();\n          return notification;\n        });\n      };\n      var close = function () {\n        getTopNotification().each(function (notification) {\n          getImplementation().close(notification);\n          closeNotification(notification);\n          reposition();\n        });\n      };\n      var getNotifications = function () {\n        return notifications;\n      };\n      var registerEvents = function (editor) {\n        editor.on('SkinLoaded', function () {\n          var serviceMessage = editor.settings.service_message;\n          if (serviceMessage) {\n            open({\n              text: serviceMessage,\n              type: 'warning',\n              timeout: 0,\n              icon: ''\n            });\n          }\n        });\n        editor.on('ResizeEditor ResizeWindow', function () {\n          Delay.requestAnimationFrame(reposition);\n        });\n        editor.on('remove', function () {\n          each(notifications.slice(), function (notification) {\n            getImplementation().close(notification);\n          });\n        });\n      };\n      registerEvents(editor);\n      return {\n        open: open,\n        close: close,\n        getNotifications: getNotifications\n      };\n    }\n\n    function WindowManagerImpl () {\n      var unimplemented = function () {\n        throw new Error('Theme did not provide a WindowManager implementation.');\n      };\n      return {\n        open: unimplemented,\n        alert: unimplemented,\n        confirm: unimplemented,\n        close: unimplemented,\n        getParams: unimplemented,\n        setParams: unimplemented\n      };\n    }\n\n    function WindowManager (editor) {\n      var windows = [];\n      var getImplementation = function () {\n        var theme = editor.theme;\n        return theme && theme.getWindowManagerImpl ? theme.getWindowManagerImpl() : WindowManagerImpl();\n      };\n      var funcBind = function (scope, f) {\n        return function () {\n          return f ? f.apply(scope, arguments) : undefined;\n        };\n      };\n      var fireOpenEvent = function (win) {\n        editor.fire('OpenWindow', { win: win });\n      };\n      var fireCloseEvent = function (win) {\n        editor.fire('CloseWindow', { win: win });\n      };\n      var addWindow = function (win) {\n        windows.push(win);\n        fireOpenEvent(win);\n      };\n      var closeWindow = function (win) {\n        findIndex(windows, function (otherWindow) {\n          return otherWindow === win;\n        }).each(function (index) {\n          windows.splice(index, 1);\n          fireCloseEvent(win);\n          if (windows.length === 0) {\n            editor.focus();\n          }\n        });\n      };\n      var getTopWindow = function () {\n        return Option.from(windows[windows.length - 1]);\n      };\n      var open = function (args, params) {\n        editor.editorManager.setActive(editor);\n        SelectionBookmark.store(editor);\n        var win = getImplementation().open(args, params, closeWindow);\n        addWindow(win);\n        return win;\n      };\n      var alert = function (message, callback, scope) {\n        var win = getImplementation().alert(message, funcBind(scope ? scope : this, callback), closeWindow);\n        addWindow(win);\n      };\n      var confirm = function (message, callback, scope) {\n        var win = getImplementation().confirm(message, funcBind(scope ? scope : this, callback), closeWindow);\n        addWindow(win);\n      };\n      var close = function () {\n        getTopWindow().each(function (win) {\n          getImplementation().close(win);\n          closeWindow(win);\n        });\n      };\n      var getParams = function () {\n        return getTopWindow().map(getImplementation().getParams).getOr(null);\n      };\n      var setParams = function (params) {\n        getTopWindow().each(function (win) {\n          getImplementation().setParams(win, params);\n        });\n      };\n      var getWindows = function () {\n        return windows;\n      };\n      editor.on('remove', function () {\n        each(windows.slice(0), function (win) {\n          getImplementation().close(win);\n        });\n      });\n      return {\n        windows: windows,\n        open: open,\n        alert: alert,\n        confirm: confirm,\n        close: close,\n        getParams: getParams,\n        setParams: setParams,\n        getWindows: getWindows\n      };\n    }\n\n    var data = {};\n    var code = 'en';\n    var I18n = {\n      setCode: function (newCode) {\n        if (newCode) {\n          code = newCode;\n          this.rtl = this.data[newCode] ? this.data[newCode]._dir === 'rtl' : false;\n        }\n      },\n      getCode: function () {\n        return code;\n      },\n      rtl: false,\n      add: function (code, items) {\n        var langData = data[code];\n        if (!langData) {\n          data[code] = langData = {};\n        }\n        for (var name in items) {\n          langData[name] = items[name];\n        }\n        this.setCode(code);\n      },\n      translate: function (text) {\n        var langData = data[code] || {};\n        var toString = function (obj) {\n          if (Tools.is(obj, 'function')) {\n            return Object.prototype.toString.call(obj);\n          }\n          return !isEmpty(obj) ? '' + obj : '';\n        };\n        var isEmpty = function (text) {\n          return text === '' || text === null || Tools.is(text, 'undefined');\n        };\n        var getLangData = function (text) {\n          text = toString(text);\n          return Tools.hasOwn(langData, text) ? toString(langData[text]) : text;\n        };\n        if (isEmpty(text)) {\n          return '';\n        }\n        if (Tools.is(text, 'object') && Tools.hasOwn(text, 'raw')) {\n          return toString(text.raw);\n        }\n        if (Tools.is(text, 'array')) {\n          var values_1 = text.slice(1);\n          text = getLangData(text[0]).replace(/\\{([0-9]+)\\}/g, function ($1, $2) {\n            return Tools.hasOwn(values_1, $2) ? toString(values_1[$2]) : $1;\n          });\n        }\n        return getLangData(text).replace(/{context:\\w+}$/, '');\n      },\n      data: data\n    };\n\n    var PluginManager = AddOnManager.PluginManager;\n    var resolvePluginName = function (targetUrl, suffix) {\n      for (var name in PluginManager.urls) {\n        var matchUrl = PluginManager.urls[name] + '/plugin' + suffix + '.js';\n        if (matchUrl === targetUrl) {\n          return name;\n        }\n      }\n      return null;\n    };\n    var pluginUrlToMessage = function (editor, url) {\n      var plugin = resolvePluginName(url, editor.suffix);\n      return plugin ? I18n.translate([\n        'Failed to load plugin: {0} from url {1}',\n        plugin,\n        url\n      ]) : I18n.translate([\n        'Failed to load plugin url: {0}',\n        url\n      ]);\n    };\n    var displayNotification = function (editor, message) {\n      editor.notificationManager.open({\n        type: 'error',\n        text: message\n      });\n    };\n    var displayError = function (editor, message) {\n      if (editor._skinLoaded) {\n        displayNotification(editor, message);\n      } else {\n        editor.on('SkinLoaded', function () {\n          displayNotification(editor, message);\n        });\n      }\n    };\n    var uploadError = function (editor, message) {\n      displayError(editor, I18n.translate([\n        'Failed to upload image: {0}',\n        message\n      ]));\n    };\n    var pluginLoadError = function (editor, url) {\n      displayError(editor, pluginUrlToMessage(editor, url));\n    };\n    var pluginInitError = function (editor, name, err) {\n      var message = I18n.translate([\n        'Failed to initialize plugin: {0}',\n        name\n      ]);\n      initError(message, err);\n      displayError(editor, message);\n    };\n    var initError = function (message) {\n      var x = [];\n      for (var _i = 1; _i < arguments.length; _i++) {\n        x[_i - 1] = arguments[_i];\n      }\n      var console = domGlobals.window.console;\n      if (console) {\n        if (console.error) {\n          console.error.apply(console, arguments);\n        } else {\n          console.log.apply(console, arguments);\n        }\n      }\n    };\n    var ErrorReporter = {\n      pluginLoadError: pluginLoadError,\n      pluginInitError: pluginInitError,\n      uploadError: uploadError,\n      displayError: displayError,\n      initError: initError\n    };\n\n    var PluginManager$1 = AddOnManager.PluginManager;\n\n    var ThemeManager = AddOnManager.ThemeManager;\n\n    function XMLHttpRequest () {\n      var f = Global$1.getOrDie('XMLHttpRequest');\n      return new f();\n    }\n\n    function Uploader (uploadStatus, settings) {\n      var pendingPromises = {};\n      var pathJoin = function (path1, path2) {\n        if (path1) {\n          return path1.replace(/\\/$/, '') + '/' + path2.replace(/^\\//, '');\n        }\n        return path2;\n      };\n      var defaultHandler = function (blobInfo, success, failure, progress) {\n        var xhr, formData;\n        xhr = XMLHttpRequest();\n        xhr.open('POST', settings.url);\n        xhr.withCredentials = settings.credentials;\n        xhr.upload.onprogress = function (e) {\n          progress(e.loaded / e.total * 100);\n        };\n        xhr.onerror = function () {\n          failure('Image upload failed due to a XHR Transport error. Code: ' + xhr.status);\n        };\n        xhr.onload = function () {\n          var json;\n          if (xhr.status < 200 || xhr.status >= 300) {\n            failure('HTTP Error: ' + xhr.status);\n            return;\n          }\n          json = JSON.parse(xhr.responseText);\n          if (!json || typeof json.location !== 'string') {\n            failure('Invalid JSON: ' + xhr.responseText);\n            return;\n          }\n          success(pathJoin(settings.basePath, json.location));\n        };\n        formData = new domGlobals.FormData();\n        formData.append('file', blobInfo.blob(), blobInfo.filename());\n        xhr.send(formData);\n      };\n      var noUpload = function () {\n        return new promiseObj(function (resolve) {\n          resolve([]);\n        });\n      };\n      var handlerSuccess = function (blobInfo, url) {\n        return {\n          url: url,\n          blobInfo: blobInfo,\n          status: true\n        };\n      };\n      var handlerFailure = function (blobInfo, error) {\n        return {\n          url: '',\n          blobInfo: blobInfo,\n          status: false,\n          error: error\n        };\n      };\n      var resolvePending = function (blobUri, result) {\n        Tools.each(pendingPromises[blobUri], function (resolve) {\n          resolve(result);\n        });\n        delete pendingPromises[blobUri];\n      };\n      var uploadBlobInfo = function (blobInfo, handler, openNotification) {\n        uploadStatus.markPending(blobInfo.blobUri());\n        return new promiseObj(function (resolve) {\n          var notification, progress;\n          var noop = function () {\n          };\n          try {\n            var closeNotification_1 = function () {\n              if (notification) {\n                notification.close();\n                progress = noop;\n              }\n            };\n            var success = function (url) {\n              closeNotification_1();\n              uploadStatus.markUploaded(blobInfo.blobUri(), url);\n              resolvePending(blobInfo.blobUri(), handlerSuccess(blobInfo, url));\n              resolve(handlerSuccess(blobInfo, url));\n            };\n            var failure = function (error) {\n              closeNotification_1();\n              uploadStatus.removeFailed(blobInfo.blobUri());\n              resolvePending(blobInfo.blobUri(), handlerFailure(blobInfo, error));\n              resolve(handlerFailure(blobInfo, error));\n            };\n            progress = function (percent) {\n              if (percent < 0 || percent > 100) {\n                return;\n              }\n              if (!notification) {\n                notification = openNotification();\n              }\n              notification.progressBar.value(percent);\n            };\n            handler(blobInfo, success, failure, progress);\n          } catch (ex) {\n            resolve(handlerFailure(blobInfo, ex.message));\n          }\n        });\n      };\n      var isDefaultHandler = function (handler) {\n        return handler === defaultHandler;\n      };\n      var pendingUploadBlobInfo = function (blobInfo) {\n        var blobUri = blobInfo.blobUri();\n        return new promiseObj(function (resolve) {\n          pendingPromises[blobUri] = pendingPromises[blobUri] || [];\n          pendingPromises[blobUri].push(resolve);\n        });\n      };\n      var uploadBlobs = function (blobInfos, openNotification) {\n        blobInfos = Tools.grep(blobInfos, function (blobInfo) {\n          return !uploadStatus.isUploaded(blobInfo.blobUri());\n        });\n        return promiseObj.all(Tools.map(blobInfos, function (blobInfo) {\n          return uploadStatus.isPending(blobInfo.blobUri()) ? pendingUploadBlobInfo(blobInfo) : uploadBlobInfo(blobInfo, settings.handler, openNotification);\n        }));\n      };\n      var upload = function (blobInfos, openNotification) {\n        return !settings.url && isDefaultHandler(settings.handler) ? noUpload() : uploadBlobs(blobInfos, openNotification);\n      };\n      if (isFunction(settings.handler) === false) {\n        settings.handler = defaultHandler;\n      }\n      return { upload: upload };\n    }\n\n    function FileReader () {\n      var f = Global$1.getOrDie('FileReader');\n      return new f();\n    }\n\n    function Uint8Array (arr) {\n      var f = Global$1.getOrDie('Uint8Array');\n      return new f(arr);\n    }\n\n    var requestAnimationFrame$1 = function (callback) {\n      var f = Global$1.getOrDie('requestAnimationFrame');\n      f(callback);\n    };\n    var atob = function (base64) {\n      var f = Global$1.getOrDie('atob');\n      return f(base64);\n    };\n    var Window = {\n      atob: atob,\n      requestAnimationFrame: requestAnimationFrame$1\n    };\n\n    var blobUriToBlob = function (url) {\n      return new promiseObj(function (resolve, reject) {\n        var rejectWithError = function () {\n          reject('Cannot convert ' + url + ' to Blob. Resource might not exist or is inaccessible.');\n        };\n        try {\n          var xhr = XMLHttpRequest();\n          xhr.open('GET', url, true);\n          xhr.responseType = 'blob';\n          xhr.onload = function () {\n            if (this.status === 200) {\n              resolve(this.response);\n            } else {\n              rejectWithError();\n            }\n          };\n          xhr.onerror = rejectWithError;\n          xhr.send();\n        } catch (ex) {\n          rejectWithError();\n        }\n      });\n    };\n    var parseDataUri = function (uri) {\n      var type, matches;\n      var uriParts = decodeURIComponent(uri).split(',');\n      matches = /data:([^;]+)/.exec(uriParts[0]);\n      if (matches) {\n        type = matches[1];\n      }\n      return {\n        type: type,\n        data: uriParts[1]\n      };\n    };\n    var dataUriToBlob = function (uri) {\n      return new promiseObj(function (resolve) {\n        var str, arr, i;\n        var uriParts = parseDataUri(uri);\n        try {\n          str = Window.atob(uriParts.data);\n        } catch (e) {\n          resolve(new domGlobals.Blob([]));\n          return;\n        }\n        arr = Uint8Array(str.length);\n        for (i = 0; i < arr.length; i++) {\n          arr[i] = str.charCodeAt(i);\n        }\n        resolve(new domGlobals.Blob([arr], { type: uriParts.type }));\n      });\n    };\n    var uriToBlob = function (url) {\n      if (url.indexOf('blob:') === 0) {\n        return blobUriToBlob(url);\n      }\n      if (url.indexOf('data:') === 0) {\n        return dataUriToBlob(url);\n      }\n      return null;\n    };\n    var blobToDataUri = function (blob) {\n      return new promiseObj(function (resolve) {\n        var reader = FileReader();\n        reader.onloadend = function () {\n          resolve(reader.result);\n        };\n        reader.readAsDataURL(blob);\n      });\n    };\n    var Conversions = {\n      uriToBlob: uriToBlob,\n      blobToDataUri: blobToDataUri,\n      parseDataUri: parseDataUri\n    };\n\n    var count = 0;\n    var uniqueId = function (prefix) {\n      return (prefix || 'blobid') + count++;\n    };\n    var imageToBlobInfo = function (blobCache, img, resolve, reject) {\n      var base64, blobInfo;\n      if (img.src.indexOf('blob:') === 0) {\n        blobInfo = blobCache.getByUri(img.src);\n        if (blobInfo) {\n          resolve({\n            image: img,\n            blobInfo: blobInfo\n          });\n        } else {\n          Conversions.uriToBlob(img.src).then(function (blob) {\n            Conversions.blobToDataUri(blob).then(function (dataUri) {\n              base64 = Conversions.parseDataUri(dataUri).data;\n              blobInfo = blobCache.create(uniqueId(), blob, base64);\n              blobCache.add(blobInfo);\n              resolve({\n                image: img,\n                blobInfo: blobInfo\n              });\n            });\n          }, function (err) {\n            reject(err);\n          });\n        }\n        return;\n      }\n      base64 = Conversions.parseDataUri(img.src).data;\n      blobInfo = blobCache.findFirst(function (cachedBlobInfo) {\n        return cachedBlobInfo.base64() === base64;\n      });\n      if (blobInfo) {\n        resolve({\n          image: img,\n          blobInfo: blobInfo\n        });\n      } else {\n        Conversions.uriToBlob(img.src).then(function (blob) {\n          blobInfo = blobCache.create(uniqueId(), blob, base64);\n          blobCache.add(blobInfo);\n          resolve({\n            image: img,\n            blobInfo: blobInfo\n          });\n        }, function (err) {\n          reject(err);\n        });\n      }\n    };\n    var getAllImages = function (elm) {\n      return elm ? from$1(elm.getElementsByTagName('img')) : [];\n    };\n    function ImageScanner (uploadStatus, blobCache) {\n      var cachedPromises = {};\n      var findAll = function (elm, predicate) {\n        var images;\n        if (!predicate) {\n          predicate = constant(true);\n        }\n        images = filter(getAllImages(elm), function (img) {\n          var src = img.src;\n          if (!Env.fileApi) {\n            return false;\n          }\n          if (img.hasAttribute('data-mce-bogus')) {\n            return false;\n          }\n          if (img.hasAttribute('data-mce-placeholder')) {\n            return false;\n          }\n          if (!src || src === Env.transparentSrc) {\n            return false;\n          }\n          if (src.indexOf('blob:') === 0) {\n            return !uploadStatus.isUploaded(src) && predicate(img);\n          }\n          if (src.indexOf('data:') === 0) {\n            return predicate(img);\n          }\n          return false;\n        });\n        var promises = map(images, function (img) {\n          if (cachedPromises[img.src]) {\n            return new promiseObj(function (resolve) {\n              cachedPromises[img.src].then(function (imageInfo) {\n                if (typeof imageInfo === 'string') {\n                  return imageInfo;\n                }\n                resolve({\n                  image: img,\n                  blobInfo: imageInfo.blobInfo\n                });\n              });\n            });\n          }\n          var newPromise = new promiseObj(function (resolve, reject) {\n            imageToBlobInfo(blobCache, img, resolve, reject);\n          }).then(function (result) {\n            delete cachedPromises[result.image.src];\n            return result;\n          }).catch(function (error) {\n            delete cachedPromises[img.src];\n            return error;\n          });\n          cachedPromises[img.src] = newPromise;\n          return newPromise;\n        });\n        return promiseObj.all(promises);\n      };\n      return { findAll: findAll };\n    }\n\n    var count$1 = 0;\n    var seed = function () {\n      var rnd = function () {\n        return Math.round(Math.random() * 4294967295).toString(36);\n      };\n      var now = new Date().getTime();\n      return 's' + now.toString(36) + rnd() + rnd() + rnd();\n    };\n    var uuid = function (prefix) {\n      return prefix + count$1++ + seed();\n    };\n    var Uuid = { uuid: uuid };\n\n    function BlobCache () {\n      var cache = [];\n      var mimeToExt = function (mime) {\n        var mimes = {\n          'image/jpeg': 'jpg',\n          'image/jpg': 'jpg',\n          'image/gif': 'gif',\n          'image/png': 'png'\n        };\n        return mimes[mime.toLowerCase()] || 'dat';\n      };\n      var create = function (o, blob, base64, filename) {\n        if (isString(o)) {\n          var id = o;\n          return toBlobInfo({\n            id: id,\n            name: filename,\n            blob: blob,\n            base64: base64\n          });\n        } else if (isObject(o)) {\n          return toBlobInfo(o);\n        } else {\n          throw new Error('Unknown input type');\n        }\n      };\n      var toBlobInfo = function (o) {\n        var id, name;\n        if (!o.blob || !o.base64) {\n          throw new Error('blob and base64 representations of the image are required for BlobInfo to be created');\n        }\n        id = o.id || Uuid.uuid('blobid');\n        name = o.name || id;\n        return {\n          id: constant(id),\n          name: constant(name),\n          filename: constant(name + '.' + mimeToExt(o.blob.type)),\n          blob: constant(o.blob),\n          base64: constant(o.base64),\n          blobUri: constant(o.blobUri || URL.createObjectURL(o.blob)),\n          uri: constant(o.uri)\n        };\n      };\n      var add = function (blobInfo) {\n        if (!get(blobInfo.id())) {\n          cache.push(blobInfo);\n        }\n      };\n      var get = function (id) {\n        return findFirst(function (cachedBlobInfo) {\n          return cachedBlobInfo.id() === id;\n        });\n      };\n      var findFirst = function (predicate) {\n        return filter(cache, predicate)[0];\n      };\n      var getByUri = function (blobUri) {\n        return findFirst(function (blobInfo) {\n          return blobInfo.blobUri() === blobUri;\n        });\n      };\n      var removeByUri = function (blobUri) {\n        cache = filter(cache, function (blobInfo) {\n          if (blobInfo.blobUri() === blobUri) {\n            URL.revokeObjectURL(blobInfo.blobUri());\n            return false;\n          }\n          return true;\n        });\n      };\n      var destroy = function () {\n        each(cache, function (cachedBlobInfo) {\n          URL.revokeObjectURL(cachedBlobInfo.blobUri());\n        });\n        cache = [];\n      };\n      return {\n        create: create,\n        add: add,\n        get: get,\n        getByUri: getByUri,\n        findFirst: findFirst,\n        removeByUri: removeByUri,\n        destroy: destroy\n      };\n    }\n\n    function UploadStatus () {\n      var PENDING = 1, UPLOADED = 2;\n      var blobUriStatuses = {};\n      var createStatus = function (status, resultUri) {\n        return {\n          status: status,\n          resultUri: resultUri\n        };\n      };\n      var hasBlobUri = function (blobUri) {\n        return blobUri in blobUriStatuses;\n      };\n      var getResultUri = function (blobUri) {\n        var result = blobUriStatuses[blobUri];\n        return result ? result.resultUri : null;\n      };\n      var isPending = function (blobUri) {\n        return hasBlobUri(blobUri) ? blobUriStatuses[blobUri].status === PENDING : false;\n      };\n      var isUploaded = function (blobUri) {\n        return hasBlobUri(blobUri) ? blobUriStatuses[blobUri].status === UPLOADED : false;\n      };\n      var markPending = function (blobUri) {\n        blobUriStatuses[blobUri] = createStatus(PENDING, null);\n      };\n      var markUploaded = function (blobUri, resultUri) {\n        blobUriStatuses[blobUri] = createStatus(UPLOADED, resultUri);\n      };\n      var removeFailed = function (blobUri) {\n        delete blobUriStatuses[blobUri];\n      };\n      var destroy = function () {\n        blobUriStatuses = {};\n      };\n      return {\n        hasBlobUri: hasBlobUri,\n        getResultUri: getResultUri,\n        isPending: isPending,\n        isUploaded: isUploaded,\n        markPending: markPending,\n        markUploaded: markUploaded,\n        removeFailed: removeFailed,\n        destroy: destroy\n      };\n    }\n\n    function EditorUpload (editor) {\n      var blobCache = BlobCache();\n      var uploader, imageScanner;\n      var uploadStatus = UploadStatus();\n      var urlFilters = [];\n      var aliveGuard = function (callback) {\n        return function (result) {\n          if (editor.selection) {\n            return callback(result);\n          }\n          return [];\n        };\n      };\n      var cacheInvalidator = function () {\n        return '?' + new Date().getTime();\n      };\n      var replaceString = function (content, search, replace) {\n        var index = 0;\n        do {\n          index = content.indexOf(search, index);\n          if (index !== -1) {\n            content = content.substring(0, index) + replace + content.substr(index + search.length);\n            index += replace.length - search.length + 1;\n          }\n        } while (index !== -1);\n        return content;\n      };\n      var replaceImageUrl = function (content, targetUrl, replacementUrl) {\n        content = replaceString(content, 'src=\"' + targetUrl + '\"', 'src=\"' + replacementUrl + '\"');\n        content = replaceString(content, 'data-mce-src=\"' + targetUrl + '\"', 'data-mce-src=\"' + replacementUrl + '\"');\n        return content;\n      };\n      var replaceUrlInUndoStack = function (targetUrl, replacementUrl) {\n        each(editor.undoManager.data, function (level) {\n          if (level.type === 'fragmented') {\n            level.fragments = map(level.fragments, function (fragment) {\n              return replaceImageUrl(fragment, targetUrl, replacementUrl);\n            });\n          } else {\n            level.content = replaceImageUrl(level.content, targetUrl, replacementUrl);\n          }\n        });\n      };\n      var openNotification = function () {\n        return editor.notificationManager.open({\n          text: editor.translate('Image uploading...'),\n          type: 'info',\n          timeout: -1,\n          progressBar: true\n        });\n      };\n      var replaceImageUri = function (image, resultUri) {\n        blobCache.removeByUri(image.src);\n        replaceUrlInUndoStack(image.src, resultUri);\n        editor.$(image).attr({\n          'src': Settings.shouldReuseFileName(editor) ? resultUri + cacheInvalidator() : resultUri,\n          'data-mce-src': editor.convertURL(resultUri, 'src')\n        });\n      };\n      var uploadImages = function (callback) {\n        if (!uploader) {\n          uploader = Uploader(uploadStatus, {\n            url: Settings.getImageUploadUrl(editor),\n            basePath: Settings.getImageUploadBasePath(editor),\n            credentials: Settings.getImagesUploadCredentials(editor),\n            handler: Settings.getImagesUploadHandler(editor)\n          });\n        }\n        return scanForImages().then(aliveGuard(function (imageInfos) {\n          var blobInfos;\n          blobInfos = map(imageInfos, function (imageInfo) {\n            return imageInfo.blobInfo;\n          });\n          return uploader.upload(blobInfos, openNotification).then(aliveGuard(function (result) {\n            var filteredResult = map(result, function (uploadInfo, index) {\n              var image = imageInfos[index].image;\n              if (uploadInfo.status && Settings.shouldReplaceBlobUris(editor)) {\n                replaceImageUri(image, uploadInfo.url);\n              } else if (uploadInfo.error) {\n                ErrorReporter.uploadError(editor, uploadInfo.error);\n              }\n              return {\n                element: image,\n                status: uploadInfo.status\n              };\n            });\n            if (callback) {\n              callback(filteredResult);\n            }\n            return filteredResult;\n          }));\n        }));\n      };\n      var uploadImagesAuto = function (callback) {\n        if (Settings.isAutomaticUploadsEnabled(editor)) {\n          return uploadImages(callback);\n        }\n      };\n      var isValidDataUriImage = function (imgElm) {\n        if (forall(urlFilters, function (filter) {\n            return filter(imgElm);\n          }) === false) {\n          return false;\n        }\n        if (imgElm.getAttribute('src').indexOf('data:') === 0) {\n          var dataImgFilter = Settings.getImagesDataImgFilter(editor);\n          return dataImgFilter(imgElm);\n        }\n        return true;\n      };\n      var addFilter = function (filter) {\n        urlFilters.push(filter);\n      };\n      var scanForImages = function () {\n        if (!imageScanner) {\n          imageScanner = ImageScanner(uploadStatus, blobCache);\n        }\n        return imageScanner.findAll(editor.getBody(), isValidDataUriImage).then(aliveGuard(function (result) {\n          result = filter(result, function (resultItem) {\n            if (typeof resultItem === 'string') {\n              ErrorReporter.displayError(editor, resultItem);\n              return false;\n            }\n            return true;\n          });\n          each(result, function (resultItem) {\n            replaceUrlInUndoStack(resultItem.image.src, resultItem.blobInfo.blobUri());\n            resultItem.image.src = resultItem.blobInfo.blobUri();\n            resultItem.image.removeAttribute('data-mce-src');\n          });\n          return result;\n        }));\n      };\n      var destroy = function () {\n        blobCache.destroy();\n        uploadStatus.destroy();\n        imageScanner = uploader = null;\n      };\n      var replaceBlobUris = function (content) {\n        return content.replace(/src=\"(blob:[^\"]+)\"/g, function (match, blobUri) {\n          var resultUri = uploadStatus.getResultUri(blobUri);\n          if (resultUri) {\n            return 'src=\"' + resultUri + '\"';\n          }\n          var blobInfo = blobCache.getByUri(blobUri);\n          if (!blobInfo) {\n            blobInfo = foldl(editor.editorManager.get(), function (result, editor) {\n              return result || editor.editorUpload && editor.editorUpload.blobCache.getByUri(blobUri);\n            }, null);\n          }\n          if (blobInfo) {\n            var blob = blobInfo.blob();\n            return 'src=\"data:' + blob.type + ';base64,' + blobInfo.base64() + '\"';\n          }\n          return match;\n        });\n      };\n      editor.on('setContent', function () {\n        if (Settings.isAutomaticUploadsEnabled(editor)) {\n          uploadImagesAuto();\n        } else {\n          scanForImages();\n        }\n      });\n      editor.on('RawSaveContent', function (e) {\n        e.content = replaceBlobUris(e.content);\n      });\n      editor.on('getContent', function (e) {\n        if (e.source_view || e.format === 'raw') {\n          return;\n        }\n        e.content = replaceBlobUris(e.content);\n      });\n      editor.on('PostRender', function () {\n        editor.parser.addNodeFilter('img', function (images) {\n          each(images, function (img) {\n            var src = img.attr('src');\n            if (blobCache.getByUri(src)) {\n              return;\n            }\n            var resultUri = uploadStatus.getResultUri(src);\n            if (resultUri) {\n              img.attr('src', resultUri);\n            }\n          });\n        });\n      });\n      return {\n        blobCache: blobCache,\n        addFilter: addFilter,\n        uploadImages: uploadImages,\n        uploadImagesAuto: uploadImagesAuto,\n        scanForImages: scanForImages,\n        destroy: destroy\n      };\n    }\n\n    var isBlockElement = function (blockElements, node) {\n      return blockElements.hasOwnProperty(node.nodeName);\n    };\n    var isValidTarget = function (blockElements, node) {\n      if (NodeType.isText(node)) {\n        return true;\n      } else if (NodeType.isElement(node)) {\n        return !isBlockElement(blockElements, node) && !Bookmarks.isBookmarkNode(node);\n      } else {\n        return false;\n      }\n    };\n    var hasBlockParent = function (blockElements, root, node) {\n      return exists(Parents.parents(Element.fromDom(node), Element.fromDom(root)), function (elm) {\n        return isBlockElement(blockElements, elm.dom());\n      });\n    };\n    var shouldRemoveTextNode = function (blockElements, node) {\n      if (NodeType.isText(node)) {\n        if (node.nodeValue.length === 0) {\n          return true;\n        } else if (/^\\s+$/.test(node.nodeValue) && (!node.nextSibling || isBlockElement(blockElements, node.nextSibling))) {\n          return true;\n        }\n      }\n      return false;\n    };\n    var addRootBlocks = function (editor) {\n      var settings = editor.settings, dom = editor.dom, selection = editor.selection;\n      var schema = editor.schema, blockElements = schema.getBlockElements();\n      var node = selection.getStart();\n      var rootNode = editor.getBody();\n      var rng;\n      var startContainer, startOffset, endContainer, endOffset, rootBlockNode;\n      var tempNode, wrapped, restoreSelection;\n      var rootNodeName, forcedRootBlock;\n      forcedRootBlock = settings.forced_root_block;\n      if (!node || !NodeType.isElement(node) || !forcedRootBlock) {\n        return;\n      }\n      rootNodeName = rootNode.nodeName.toLowerCase();\n      if (!schema.isValidChild(rootNodeName, forcedRootBlock.toLowerCase()) || hasBlockParent(blockElements, rootNode, node)) {\n        return;\n      }\n      rng = selection.getRng();\n      startContainer = rng.startContainer;\n      startOffset = rng.startOffset;\n      endContainer = rng.endContainer;\n      endOffset = rng.endOffset;\n      restoreSelection = EditorFocus.hasFocus(editor);\n      node = rootNode.firstChild;\n      while (node) {\n        if (isValidTarget(blockElements, node)) {\n          if (shouldRemoveTextNode(blockElements, node)) {\n            tempNode = node;\n            node = node.nextSibling;\n            dom.remove(tempNode);\n            continue;\n          }\n          if (!rootBlockNode) {\n            rootBlockNode = dom.create(forcedRootBlock, editor.settings.forced_root_block_attrs);\n            node.parentNode.insertBefore(rootBlockNode, node);\n            wrapped = true;\n          }\n          tempNode = node;\n          node = node.nextSibling;\n          rootBlockNode.appendChild(tempNode);\n        } else {\n          rootBlockNode = null;\n          node = node.nextSibling;\n        }\n      }\n      if (wrapped && restoreSelection) {\n        rng.setStart(startContainer, startOffset);\n        rng.setEnd(endContainer, endOffset);\n        selection.setRng(rng);\n        editor.nodeChanged();\n      }\n    };\n    var setup$3 = function (editor) {\n      if (editor.settings.forced_root_block) {\n        editor.on('NodeChange', curry(addRootBlocks, editor));\n      }\n    };\n    var ForceBlocks = { setup: setup$3 };\n\n    var getStartNode = function (rng) {\n      var sc = rng.startContainer, so = rng.startOffset;\n      if (NodeType.isText(sc)) {\n        return so === 0 ? Option.some(Element.fromDom(sc)) : Option.none();\n      } else {\n        return Option.from(sc.childNodes[so]).map(Element.fromDom);\n      }\n    };\n    var getEndNode = function (rng) {\n      var ec = rng.endContainer, eo = rng.endOffset;\n      if (NodeType.isText(ec)) {\n        return eo === ec.data.length ? Option.some(Element.fromDom(ec)) : Option.none();\n      } else {\n        return Option.from(ec.childNodes[eo - 1]).map(Element.fromDom);\n      }\n    };\n    var getFirstChildren = function (node) {\n      return firstChild(node).fold(constant([node]), function (child) {\n        return [node].concat(getFirstChildren(child));\n      });\n    };\n    var getLastChildren$1 = function (node) {\n      return lastChild(node).fold(constant([node]), function (child) {\n        if (name(child) === 'br') {\n          return prevSibling(child).map(function (sibling) {\n            return [node].concat(getLastChildren$1(sibling));\n          }).getOr([]);\n        } else {\n          return [node].concat(getLastChildren$1(child));\n        }\n      });\n    };\n    var hasAllContentsSelected = function (elm, rng) {\n      return lift2(getStartNode(rng), getEndNode(rng), function (startNode, endNode) {\n        var start = find(getFirstChildren(elm), curry(eq, startNode));\n        var end = find(getLastChildren$1(elm), curry(eq, endNode));\n        return start.isSome() && end.isSome();\n      }).getOr(false);\n    };\n    var moveEndPoint$1 = function (dom, rng, node, start) {\n      var root = node, walker = new TreeWalker(node, root);\n      var nonEmptyElementsMap = dom.schema.getNonEmptyElements();\n      do {\n        if (node.nodeType === 3 && Tools.trim(node.nodeValue).length !== 0) {\n          if (start) {\n            rng.setStart(node, 0);\n          } else {\n            rng.setEnd(node, node.nodeValue.length);\n          }\n          return;\n        }\n        if (nonEmptyElementsMap[node.nodeName] && !/^(TD|TH)$/.test(node.nodeName)) {\n          if (start) {\n            rng.setStartBefore(node);\n          } else {\n            if (node.nodeName === 'BR') {\n              rng.setEndBefore(node);\n            } else {\n              rng.setEndAfter(node);\n            }\n          }\n          return;\n        }\n        if (Env.ie && Env.ie < 11 && dom.isBlock(node) && dom.isEmpty(node)) {\n          if (start) {\n            rng.setStart(node, 0);\n          } else {\n            rng.setEnd(node, 0);\n          }\n          return;\n        }\n      } while (node = start ? walker.next() : walker.prev());\n      if (root.nodeName === 'BODY') {\n        if (start) {\n          rng.setStart(root, 0);\n        } else {\n          rng.setEnd(root, root.childNodes.length);\n        }\n      }\n    };\n    var hasAnyRanges = function (editor) {\n      var sel = editor.selection.getSel();\n      return sel && sel.rangeCount > 0;\n    };\n\n    function NodeChange (editor) {\n      var lastRng, lastPath = [];\n      var isSameElementPath = function (startElm) {\n        var i, currentPath;\n        currentPath = editor.$(startElm).parentsUntil(editor.getBody()).add(startElm);\n        if (currentPath.length === lastPath.length) {\n          for (i = currentPath.length; i >= 0; i--) {\n            if (currentPath[i] !== lastPath[i]) {\n              break;\n            }\n          }\n          if (i === -1) {\n            lastPath = currentPath;\n            return true;\n          }\n        }\n        lastPath = currentPath;\n        return false;\n      };\n      if (!('onselectionchange' in editor.getDoc())) {\n        editor.on('NodeChange Click MouseUp KeyUp Focus', function (e) {\n          var nativeRng, fakeRng;\n          nativeRng = editor.selection.getRng();\n          fakeRng = {\n            startContainer: nativeRng.startContainer,\n            startOffset: nativeRng.startOffset,\n            endContainer: nativeRng.endContainer,\n            endOffset: nativeRng.endOffset\n          };\n          if (e.type === 'nodechange' || !RangeCompare.isEq(fakeRng, lastRng)) {\n            editor.fire('SelectionChange');\n          }\n          lastRng = fakeRng;\n        });\n      }\n      editor.on('contextmenu', function () {\n        editor.fire('SelectionChange');\n      });\n      editor.on('SelectionChange', function () {\n        var startElm = editor.selection.getStart(true);\n        if (!startElm || !Env.range && editor.selection.isCollapsed()) {\n          return;\n        }\n        if (hasAnyRanges(editor) && !isSameElementPath(startElm) && editor.dom.isChildOf(startElm, editor.getBody())) {\n          editor.nodeChanged({ selectionChange: true });\n        }\n      });\n      editor.on('MouseUp', function (e) {\n        if (!e.isDefaultPrevented() && hasAnyRanges(editor)) {\n          if (editor.selection.getNode().nodeName === 'IMG') {\n            Delay.setEditorTimeout(editor, function () {\n              editor.nodeChanged();\n            });\n          } else {\n            editor.nodeChanged();\n          }\n        }\n      });\n      this.nodeChanged = function (args) {\n        var selection = editor.selection;\n        var node, parents, root;\n        if (editor.initialized && selection && !editor.settings.disable_nodechange && !editor.readonly) {\n          root = editor.getBody();\n          node = selection.getStart(true) || root;\n          if (node.ownerDocument !== editor.getDoc() || !editor.dom.isChildOf(node, root)) {\n            node = root;\n          }\n          parents = [];\n          editor.dom.getParent(node, function (node) {\n            if (node === root) {\n              return true;\n            }\n            parents.push(node);\n          });\n          args = args || {};\n          args.element = node;\n          args.parents = parents;\n          editor.fire('NodeChange', args);\n        }\n      };\n    }\n\n    var VK = {\n      BACKSPACE: 8,\n      DELETE: 46,\n      DOWN: 40,\n      ENTER: 13,\n      LEFT: 37,\n      RIGHT: 39,\n      SPACEBAR: 32,\n      TAB: 9,\n      UP: 38,\n      END: 35,\n      HOME: 36,\n      modifierPressed: function (e) {\n        return e.shiftKey || e.ctrlKey || e.altKey || this.metaKeyPressed(e);\n      },\n      metaKeyPressed: function (e) {\n        return Env.mac ? e.metaKey : e.ctrlKey && !e.altKey;\n      }\n    };\n\n    var getNodeClientRects = function (node) {\n      var toArrayWithNode = function (clientRects) {\n        return map(clientRects, function (clientRect) {\n          clientRect = clone$1(clientRect);\n          clientRect.node = node;\n          return clientRect;\n        });\n      };\n      if (NodeType.isElement(node)) {\n        return toArrayWithNode(node.getClientRects());\n      }\n      if (NodeType.isText(node)) {\n        var rng = node.ownerDocument.createRange();\n        rng.setStart(node, 0);\n        rng.setEnd(node, node.data.length);\n        return toArrayWithNode(rng.getClientRects());\n      }\n    };\n    var getClientRects = function (node) {\n      return foldl(node, function (result, node) {\n        return result.concat(getNodeClientRects(node));\n      }, []);\n    };\n\n    var VDirection;\n    (function (VDirection) {\n      VDirection[VDirection['Up'] = -1] = 'Up';\n      VDirection[VDirection['Down'] = 1] = 'Down';\n    }(VDirection || (VDirection = {})));\n    var findUntil = function (direction, root, predicateFn, node) {\n      while (node = findNode(node, direction, isEditableCaretCandidate, root)) {\n        if (predicateFn(node)) {\n          return;\n        }\n      }\n    };\n    var walkUntil = function (direction, isAboveFn, isBeflowFn, root, predicateFn, caretPosition) {\n      var line = 0, node;\n      var result = [];\n      var targetClientRect;\n      var add = function (node) {\n        var i, clientRect, clientRects;\n        clientRects = getClientRects([node]);\n        if (direction === -1) {\n          clientRects = clientRects.reverse();\n        }\n        for (i = 0; i < clientRects.length; i++) {\n          clientRect = clientRects[i];\n          if (isBeflowFn(clientRect, targetClientRect)) {\n            continue;\n          }\n          if (result.length > 0 && isAboveFn(clientRect, ArrUtils.last(result))) {\n            line++;\n          }\n          clientRect.line = line;\n          if (predicateFn(clientRect)) {\n            return true;\n          }\n          result.push(clientRect);\n        }\n      };\n      targetClientRect = ArrUtils.last(caretPosition.getClientRects());\n      if (!targetClientRect) {\n        return result;\n      }\n      node = caretPosition.getNode();\n      add(node);\n      findUntil(direction, root, add, node);\n      return result;\n    };\n    var aboveLineNumber = function (lineNumber, clientRect) {\n      return clientRect.line > lineNumber;\n    };\n    var isLineNumber = function (lineNumber, clientRect) {\n      return clientRect.line === lineNumber;\n    };\n    var upUntil = curry(walkUntil, VDirection.Up, isAbove, isBelow);\n    var downUntil = curry(walkUntil, VDirection.Down, isBelow, isAbove);\n    var positionsUntil = function (direction, root, predicateFn, node) {\n      var caretWalker = CaretWalker(root);\n      var walkFn, isBelowFn, isAboveFn, caretPosition;\n      var result = [];\n      var line = 0, clientRect, targetClientRect;\n      var getClientRect = function (caretPosition) {\n        if (direction === 1) {\n          return ArrUtils.last(caretPosition.getClientRects());\n        }\n        return ArrUtils.last(caretPosition.getClientRects());\n      };\n      if (direction === 1) {\n        walkFn = caretWalker.next;\n        isBelowFn = isBelow;\n        isAboveFn = isAbove;\n        caretPosition = CaretPosition$1.after(node);\n      } else {\n        walkFn = caretWalker.prev;\n        isBelowFn = isAbove;\n        isAboveFn = isBelow;\n        caretPosition = CaretPosition$1.before(node);\n      }\n      targetClientRect = getClientRect(caretPosition);\n      do {\n        if (!caretPosition.isVisible()) {\n          continue;\n        }\n        clientRect = getClientRect(caretPosition);\n        if (isAboveFn(clientRect, targetClientRect)) {\n          continue;\n        }\n        if (result.length > 0 && isBelowFn(clientRect, ArrUtils.last(result))) {\n          line++;\n        }\n        clientRect = clone$1(clientRect);\n        clientRect.position = caretPosition;\n        clientRect.line = line;\n        if (predicateFn(clientRect)) {\n          return result;\n        }\n        result.push(clientRect);\n      } while (caretPosition = walkFn(caretPosition));\n      return result;\n    };\n    var isAboveLine = function (lineNumber) {\n      return function (clientRect) {\n        return aboveLineNumber(lineNumber, clientRect);\n      };\n    };\n    var isLine = function (lineNumber) {\n      return function (clientRect) {\n        return isLineNumber(lineNumber, clientRect);\n      };\n    };\n\n    var isContentEditableFalse$7 = NodeType.isContentEditableFalse;\n    var findNode$1 = findNode;\n    var distanceToRectLeft = function (clientRect, clientX) {\n      return Math.abs(clientRect.left - clientX);\n    };\n    var distanceToRectRight = function (clientRect, clientX) {\n      return Math.abs(clientRect.right - clientX);\n    };\n    var isInside = function (clientX, clientRect) {\n      return clientX >= clientRect.left && clientX <= clientRect.right;\n    };\n    var findClosestClientRect = function (clientRects, clientX) {\n      return ArrUtils.reduce(clientRects, function (oldClientRect, clientRect) {\n        var oldDistance, newDistance;\n        oldDistance = Math.min(distanceToRectLeft(oldClientRect, clientX), distanceToRectRight(oldClientRect, clientX));\n        newDistance = Math.min(distanceToRectLeft(clientRect, clientX), distanceToRectRight(clientRect, clientX));\n        if (isInside(clientX, clientRect)) {\n          return clientRect;\n        }\n        if (isInside(clientX, oldClientRect)) {\n          return oldClientRect;\n        }\n        if (newDistance === oldDistance && isContentEditableFalse$7(clientRect.node)) {\n          return clientRect;\n        }\n        if (newDistance < oldDistance) {\n          return clientRect;\n        }\n        return oldClientRect;\n      });\n    };\n    var walkUntil$1 = function (direction, root, predicateFn, node) {\n      while (node = findNode$1(node, direction, isEditableCaretCandidate, root)) {\n        if (predicateFn(node)) {\n          return;\n        }\n      }\n    };\n    var findLineNodeRects = function (root, targetNodeRect) {\n      var clientRects = [];\n      var collect = function (checkPosFn, node) {\n        var lineRects;\n        lineRects = filter(getClientRects([node]), function (clientRect) {\n          return !checkPosFn(clientRect, targetNodeRect);\n        });\n        clientRects = clientRects.concat(lineRects);\n        return lineRects.length === 0;\n      };\n      clientRects.push(targetNodeRect);\n      walkUntil$1(VDirection.Up, root, curry(collect, isAbove), targetNodeRect.node);\n      walkUntil$1(VDirection.Down, root, curry(collect, isBelow), targetNodeRect.node);\n      return clientRects;\n    };\n    var getFakeCaretTargets = function (root) {\n      return filter(from$1(root.getElementsByTagName('*')), isFakeCaretTarget);\n    };\n    var caretInfo = function (clientRect, clientX) {\n      return {\n        node: clientRect.node,\n        before: distanceToRectLeft(clientRect, clientX) < distanceToRectRight(clientRect, clientX)\n      };\n    };\n    var closestCaret = function (root, clientX, clientY) {\n      var closestNodeRect;\n      var contentEditableFalseNodeRects = getClientRects(getFakeCaretTargets(root));\n      var targetNodeRects = filter(contentEditableFalseNodeRects, function (rect) {\n        return clientY >= rect.top && clientY <= rect.bottom;\n      });\n      closestNodeRect = findClosestClientRect(targetNodeRects, clientX);\n      if (closestNodeRect) {\n        closestNodeRect = findClosestClientRect(findLineNodeRects(root, closestNodeRect), clientX);\n        if (closestNodeRect && isFakeCaretTarget(closestNodeRect.node)) {\n          return caretInfo(closestNodeRect, clientX);\n        }\n      }\n      return null;\n    };\n\n    var isXYWithinRange = function (clientX, clientY, range) {\n      if (range.collapsed) {\n        return false;\n      }\n      if (Env.ie && Env.ie <= 11 && range.startOffset === range.endOffset - 1 && range.startContainer === range.endContainer) {\n        var elm = range.startContainer.childNodes[range.startOffset];\n        if (NodeType.isElement(elm)) {\n          return exists(elm.getClientRects(), function (rect) {\n            return containsXY(rect, clientX, clientY);\n          });\n        }\n      }\n      return exists(range.getClientRects(), function (rect) {\n        return containsXY(rect, clientX, clientY);\n      });\n    };\n    var RangePoint = { isXYWithinRange: isXYWithinRange };\n\n    var getAbsolutePosition = function (elm) {\n      var doc, docElem, win, clientRect;\n      clientRect = elm.getBoundingClientRect();\n      doc = elm.ownerDocument;\n      docElem = doc.documentElement;\n      win = doc.defaultView;\n      return {\n        top: clientRect.top + win.pageYOffset - docElem.clientTop,\n        left: clientRect.left + win.pageXOffset - docElem.clientLeft\n      };\n    };\n    var getBodyPosition = function (editor) {\n      return editor.inline ? getAbsolutePosition(editor.getBody()) : {\n        left: 0,\n        top: 0\n      };\n    };\n    var getScrollPosition = function (editor) {\n      var body = editor.getBody();\n      return editor.inline ? {\n        left: body.scrollLeft,\n        top: body.scrollTop\n      } : {\n        left: 0,\n        top: 0\n      };\n    };\n    var getBodyScroll = function (editor) {\n      var body = editor.getBody(), docElm = editor.getDoc().documentElement;\n      var inlineScroll = {\n        left: body.scrollLeft,\n        top: body.scrollTop\n      };\n      var iframeScroll = {\n        left: body.scrollLeft || docElm.scrollLeft,\n        top: body.scrollTop || docElm.scrollTop\n      };\n      return editor.inline ? inlineScroll : iframeScroll;\n    };\n    var getMousePosition = function (editor, event) {\n      if (event.target.ownerDocument !== editor.getDoc()) {\n        var iframePosition = getAbsolutePosition(editor.getContentAreaContainer());\n        var scrollPosition = getBodyScroll(editor);\n        return {\n          left: event.pageX - iframePosition.left + scrollPosition.left,\n          top: event.pageY - iframePosition.top + scrollPosition.top\n        };\n      }\n      return {\n        left: event.pageX,\n        top: event.pageY\n      };\n    };\n    var calculatePosition = function (bodyPosition, scrollPosition, mousePosition) {\n      return {\n        pageX: mousePosition.left - bodyPosition.left + scrollPosition.left,\n        pageY: mousePosition.top - bodyPosition.top + scrollPosition.top\n      };\n    };\n    var calc = function (editor, event) {\n      return calculatePosition(getBodyPosition(editor), getScrollPosition(editor), getMousePosition(editor, event));\n    };\n    var MousePosition = { calc: calc };\n\n    var isContentEditableFalse$8 = NodeType.isContentEditableFalse, isContentEditableTrue$3 = NodeType.isContentEditableTrue;\n    var isDraggable = function (rootElm, elm) {\n      return isContentEditableFalse$8(elm) && elm !== rootElm;\n    };\n    var isValidDropTarget = function (editor, targetElement, dragElement) {\n      if (targetElement === dragElement || editor.dom.isChildOf(targetElement, dragElement)) {\n        return false;\n      }\n      if (isContentEditableFalse$8(targetElement)) {\n        return false;\n      }\n      return true;\n    };\n    var cloneElement = function (elm) {\n      var cloneElm = elm.cloneNode(true);\n      cloneElm.removeAttribute('data-mce-selected');\n      return cloneElm;\n    };\n    var createGhost = function (editor, elm, width, height) {\n      var clonedElm = elm.cloneNode(true);\n      editor.dom.setStyles(clonedElm, {\n        width: width,\n        height: height\n      });\n      editor.dom.setAttrib(clonedElm, 'data-mce-selected', null);\n      var ghostElm = editor.dom.create('div', {\n        'class': 'mce-drag-container',\n        'data-mce-bogus': 'all',\n        'unselectable': 'on',\n        'contenteditable': 'false'\n      });\n      editor.dom.setStyles(ghostElm, {\n        position: 'absolute',\n        opacity: 0.5,\n        overflow: 'hidden',\n        border: 0,\n        padding: 0,\n        margin: 0,\n        width: width,\n        height: height\n      });\n      editor.dom.setStyles(clonedElm, {\n        margin: 0,\n        boxSizing: 'border-box'\n      });\n      ghostElm.appendChild(clonedElm);\n      return ghostElm;\n    };\n    var appendGhostToBody = function (ghostElm, bodyElm) {\n      if (ghostElm.parentNode !== bodyElm) {\n        bodyElm.appendChild(ghostElm);\n      }\n    };\n    var moveGhost = function (ghostElm, position, width, height, maxX, maxY) {\n      var overflowX = 0, overflowY = 0;\n      ghostElm.style.left = position.pageX + 'px';\n      ghostElm.style.top = position.pageY + 'px';\n      if (position.pageX + width > maxX) {\n        overflowX = position.pageX + width - maxX;\n      }\n      if (position.pageY + height > maxY) {\n        overflowY = position.pageY + height - maxY;\n      }\n      ghostElm.style.width = width - overflowX + 'px';\n      ghostElm.style.height = height - overflowY + 'px';\n    };\n    var removeElement = function (elm) {\n      if (elm && elm.parentNode) {\n        elm.parentNode.removeChild(elm);\n      }\n    };\n    var isLeftMouseButtonPressed = function (e) {\n      return e.button === 0;\n    };\n    var hasDraggableElement = function (state) {\n      return state.element;\n    };\n    var applyRelPos = function (state, position) {\n      return {\n        pageX: position.pageX - state.relX,\n        pageY: position.pageY + 5\n      };\n    };\n    var start$1 = function (state, editor) {\n      return function (e) {\n        if (isLeftMouseButtonPressed(e)) {\n          var ceElm = find(editor.dom.getParents(e.target), Predicate.or(isContentEditableFalse$8, isContentEditableTrue$3)).getOr(null);\n          if (isDraggable(editor.getBody(), ceElm)) {\n            var elmPos = editor.dom.getPos(ceElm);\n            var bodyElm = editor.getBody();\n            var docElm = editor.getDoc().documentElement;\n            state.element = ceElm;\n            state.screenX = e.screenX;\n            state.screenY = e.screenY;\n            state.maxX = (editor.inline ? bodyElm.scrollWidth : docElm.offsetWidth) - 2;\n            state.maxY = (editor.inline ? bodyElm.scrollHeight : docElm.offsetHeight) - 2;\n            state.relX = e.pageX - elmPos.x;\n            state.relY = e.pageY - elmPos.y;\n            state.width = ceElm.offsetWidth;\n            state.height = ceElm.offsetHeight;\n            state.ghost = createGhost(editor, ceElm, state.width, state.height);\n          }\n        }\n      };\n    };\n    var move$1 = function (state, editor) {\n      var throttledPlaceCaretAt = Delay.throttle(function (clientX, clientY) {\n        editor._selectionOverrides.hideFakeCaret();\n        editor.selection.placeCaretAt(clientX, clientY);\n      }, 0);\n      return function (e) {\n        var movement = Math.max(Math.abs(e.screenX - state.screenX), Math.abs(e.screenY - state.screenY));\n        if (hasDraggableElement(state) && !state.dragging && movement > 10) {\n          var args = editor.fire('dragstart', { target: state.element });\n          if (args.isDefaultPrevented()) {\n            return;\n          }\n          state.dragging = true;\n          editor.focus();\n        }\n        if (state.dragging) {\n          var targetPos = applyRelPos(state, MousePosition.calc(editor, e));\n          appendGhostToBody(state.ghost, editor.getBody());\n          moveGhost(state.ghost, targetPos, state.width, state.height, state.maxX, state.maxY);\n          throttledPlaceCaretAt(e.clientX, e.clientY);\n        }\n      };\n    };\n    var getRawTarget = function (selection) {\n      var rng = selection.getSel().getRangeAt(0);\n      var startContainer = rng.startContainer;\n      return startContainer.nodeType === 3 ? startContainer.parentNode : startContainer;\n    };\n    var drop = function (state, editor) {\n      return function (e) {\n        if (state.dragging) {\n          if (isValidDropTarget(editor, getRawTarget(editor.selection), state.element)) {\n            var targetClone_1 = cloneElement(state.element);\n            var args = editor.fire('drop', {\n              targetClone: targetClone_1,\n              clientX: e.clientX,\n              clientY: e.clientY\n            });\n            if (!args.isDefaultPrevented()) {\n              targetClone_1 = args.targetClone;\n              editor.undoManager.transact(function () {\n                removeElement(state.element);\n                editor.insertContent(editor.dom.getOuterHTML(targetClone_1));\n                editor._selectionOverrides.hideFakeCaret();\n              });\n            }\n          }\n        }\n        removeDragState(state);\n      };\n    };\n    var stop = function (state, editor) {\n      return function () {\n        if (state.dragging) {\n          editor.fire('dragend');\n        }\n        removeDragState(state);\n      };\n    };\n    var removeDragState = function (state) {\n      state.dragging = false;\n      state.element = null;\n      removeElement(state.ghost);\n    };\n    var bindFakeDragEvents = function (editor) {\n      var state = {};\n      var pageDom, dragStartHandler, dragHandler, dropHandler, dragEndHandler, rootDocument;\n      pageDom = DOMUtils$1.DOM;\n      rootDocument = domGlobals.document;\n      dragStartHandler = start$1(state, editor);\n      dragHandler = move$1(state, editor);\n      dropHandler = drop(state, editor);\n      dragEndHandler = stop(state, editor);\n      editor.on('mousedown', dragStartHandler);\n      editor.on('mousemove', dragHandler);\n      editor.on('mouseup', dropHandler);\n      pageDom.bind(rootDocument, 'mousemove', dragHandler);\n      pageDom.bind(rootDocument, 'mouseup', dragEndHandler);\n      editor.on('remove', function () {\n        pageDom.unbind(rootDocument, 'mousemove', dragHandler);\n        pageDom.unbind(rootDocument, 'mouseup', dragEndHandler);\n      });\n    };\n    var blockIeDrop = function (editor) {\n      editor.on('drop', function (e) {\n        var realTarget = typeof e.clientX !== 'undefined' ? editor.getDoc().elementFromPoint(e.clientX, e.clientY) : null;\n        if (isContentEditableFalse$8(realTarget) || isContentEditableFalse$8(editor.dom.getContentEditableParent(realTarget))) {\n          e.preventDefault();\n        }\n      });\n    };\n    var init = function (editor) {\n      bindFakeDragEvents(editor);\n      blockIeDrop(editor);\n    };\n    var DragDropOverrides = { init: init };\n\n    var setup$4 = function (editor) {\n      var renderFocusCaret = first(function () {\n        if (!editor.removed) {\n          var rng = editor.selection.getRng();\n          if (rng.collapsed) {\n            var caretRange = renderRangeCaret(editor, editor.selection.getRng(), false);\n            editor.selection.setRng(caretRange);\n          }\n        }\n      }, 0);\n      editor.on('focus', function () {\n        renderFocusCaret.throttle();\n      });\n      editor.on('blur', function () {\n        renderFocusCaret.cancel();\n      });\n    };\n    var CefFocus = { setup: setup$4 };\n\n    var isContentEditableTrue$4 = NodeType.isContentEditableTrue;\n    var isContentEditableFalse$9 = NodeType.isContentEditableFalse;\n    var getContentEditableRoot$1 = function (editor, node) {\n      var root = editor.getBody();\n      while (node && node !== root) {\n        if (isContentEditableTrue$4(node) || isContentEditableFalse$9(node)) {\n          return node;\n        }\n        node = node.parentNode;\n      }\n      return null;\n    };\n    var SelectionOverrides = function (editor) {\n      var isBlock = function (node) {\n        return editor.dom.isBlock(node);\n      };\n      var rootNode = editor.getBody();\n      var fakeCaret = FakeCaret(editor.getBody(), isBlock, function () {\n        return EditorFocus.hasFocus(editor);\n      });\n      var realSelectionId = 'sel-' + editor.dom.uniqueId();\n      var selectedContentEditableNode;\n      var isFakeSelectionElement = function (elm) {\n        return editor.dom.hasClass(elm, 'mce-offscreen-selection');\n      };\n      var getRealSelectionElement = function () {\n        var container = editor.dom.get(realSelectionId);\n        return container ? container.getElementsByTagName('*')[0] : container;\n      };\n      var setRange = function (range) {\n        if (range) {\n          editor.selection.setRng(range);\n        }\n      };\n      var getRange = function () {\n        return editor.selection.getRng();\n      };\n      var showCaret = function (direction, node, before, scrollIntoView) {\n        if (scrollIntoView === void 0) {\n          scrollIntoView = true;\n        }\n        var e;\n        e = editor.fire('ShowCaret', {\n          target: node,\n          direction: direction,\n          before: before\n        });\n        if (e.isDefaultPrevented()) {\n          return null;\n        }\n        if (scrollIntoView) {\n          editor.selection.scrollIntoView(node, direction === -1);\n        }\n        return fakeCaret.show(before, node);\n      };\n      var getNormalizedRangeEndPoint = function (direction, range) {\n        range = normalizeRange(direction, rootNode, range);\n        if (direction === -1) {\n          return CaretPosition$1.fromRangeStart(range);\n        }\n        return CaretPosition$1.fromRangeEnd(range);\n      };\n      var showBlockCaretContainer = function (blockCaretContainer) {\n        if (blockCaretContainer.hasAttribute('data-mce-caret')) {\n          showCaretContainerBlock(blockCaretContainer);\n          setRange(getRange());\n          editor.selection.scrollIntoView(blockCaretContainer[0]);\n        }\n      };\n      var registerEvents = function () {\n        editor.on('mouseup', function (e) {\n          var range = getRange();\n          if (range.collapsed && EditorView.isXYInContentArea(editor, e.clientX, e.clientY)) {\n            setRange(renderCaretAtRange(editor, range, false));\n          }\n        });\n        editor.on('click', function (e) {\n          var contentEditableRoot;\n          contentEditableRoot = getContentEditableRoot$1(editor, e.target);\n          if (contentEditableRoot) {\n            if (isContentEditableFalse$9(contentEditableRoot)) {\n              e.preventDefault();\n              editor.focus();\n            }\n            if (isContentEditableTrue$4(contentEditableRoot)) {\n              if (editor.dom.isChildOf(contentEditableRoot, editor.selection.getNode())) {\n                removeContentEditableSelection();\n              }\n            }\n          }\n        });\n        editor.on('blur NewBlock', function () {\n          removeContentEditableSelection();\n        });\n        editor.on('ResizeWindow FullscreenStateChanged', function () {\n          return fakeCaret.reposition();\n        });\n        var handleTouchSelect = function (editor) {\n          var moved = false;\n          editor.on('touchstart', function () {\n            moved = false;\n          });\n          editor.on('touchmove', function () {\n            moved = true;\n          });\n          editor.on('touchend', function (e) {\n            var contentEditableRoot = getContentEditableRoot$1(editor, e.target);\n            if (isContentEditableFalse$9(contentEditableRoot)) {\n              if (!moved) {\n                e.preventDefault();\n                setContentEditableSelection(selectNode(editor, contentEditableRoot));\n              }\n            }\n          });\n        };\n        var hasNormalCaretPosition = function (elm) {\n          var caretWalker = CaretWalker(elm);\n          if (!elm.firstChild) {\n            return false;\n          }\n          var startPos = CaretPosition$1.before(elm.firstChild);\n          var newPos = caretWalker.next(startPos);\n          return newPos && !isBeforeContentEditableFalse(newPos) && !isAfterContentEditableFalse(newPos);\n        };\n        var isInSameBlock = function (node1, node2) {\n          var block1 = editor.dom.getParent(node1, editor.dom.isBlock);\n          var block2 = editor.dom.getParent(node2, editor.dom.isBlock);\n          return block1 === block2;\n        };\n        var hasBetterMouseTarget = function (targetNode, caretNode) {\n          var targetBlock = editor.dom.getParent(targetNode, editor.dom.isBlock);\n          var caretBlock = editor.dom.getParent(caretNode, editor.dom.isBlock);\n          if (targetBlock && editor.dom.isChildOf(targetBlock, caretBlock) && isContentEditableFalse$9(getContentEditableRoot$1(editor, targetBlock)) === false) {\n            return true;\n          }\n          return targetBlock && !isInSameBlock(targetBlock, caretBlock) && hasNormalCaretPosition(targetBlock);\n        };\n        handleTouchSelect(editor);\n        editor.on('mousedown', function (e) {\n          var contentEditableRoot;\n          var targetElm = e.target;\n          if (targetElm !== rootNode && targetElm.nodeName !== 'HTML' && !editor.dom.isChildOf(targetElm, rootNode)) {\n            return;\n          }\n          if (EditorView.isXYInContentArea(editor, e.clientX, e.clientY) === false) {\n            return;\n          }\n          contentEditableRoot = getContentEditableRoot$1(editor, targetElm);\n          if (contentEditableRoot) {\n            if (isContentEditableFalse$9(contentEditableRoot)) {\n              e.preventDefault();\n              setContentEditableSelection(selectNode(editor, contentEditableRoot));\n            } else {\n              removeContentEditableSelection();\n              if (!(isContentEditableTrue$4(contentEditableRoot) && e.shiftKey) && !RangePoint.isXYWithinRange(e.clientX, e.clientY, editor.selection.getRng())) {\n                hideFakeCaret();\n                editor.selection.placeCaretAt(e.clientX, e.clientY);\n              }\n            }\n          } else if (isFakeCaretTarget(targetElm) === false) {\n            removeContentEditableSelection();\n            hideFakeCaret();\n            var caretInfo = closestCaret(rootNode, e.clientX, e.clientY);\n            if (caretInfo) {\n              if (!hasBetterMouseTarget(e.target, caretInfo.node)) {\n                e.preventDefault();\n                var range = showCaret(1, caretInfo.node, caretInfo.before, false);\n                editor.getBody().focus();\n                setRange(range);\n              }\n            }\n          }\n        });\n        editor.on('keypress', function (e) {\n          if (VK.modifierPressed(e)) {\n            return;\n          }\n          switch (e.keyCode) {\n          default:\n            if (isContentEditableFalse$9(editor.selection.getNode())) {\n              e.preventDefault();\n            }\n            break;\n          }\n        });\n        editor.on('getSelectionRange', function (e) {\n          var rng = e.range;\n          if (selectedContentEditableNode) {\n            if (!selectedContentEditableNode.parentNode) {\n              selectedContentEditableNode = null;\n              return;\n            }\n            rng = rng.cloneRange();\n            rng.selectNode(selectedContentEditableNode);\n            e.range = rng;\n          }\n        });\n        editor.on('setSelectionRange', function (e) {\n          e.range = normalizeShortEndedElementSelection(e.range);\n          var rng = setContentEditableSelection(e.range, e.forward);\n          if (rng) {\n            e.range = rng;\n          }\n        });\n        var isPasteBin = function (node) {\n          return node.id === 'mcepastebin';\n        };\n        editor.on('AfterSetSelectionRange', function (e) {\n          var rng = e.range;\n          if (!isRangeInCaretContainer(rng) && !isPasteBin(rng.startContainer.parentNode)) {\n            hideFakeCaret();\n          }\n          if (!isFakeSelectionElement(rng.startContainer.parentNode)) {\n            removeContentEditableSelection();\n          }\n        });\n        editor.on('copy', function (e) {\n          var clipboardData = e.clipboardData;\n          if (!e.isDefaultPrevented() && e.clipboardData && !Env.ie) {\n            var realSelectionElement = getRealSelectionElement();\n            if (realSelectionElement) {\n              e.preventDefault();\n              clipboardData.clearData();\n              clipboardData.setData('text/html', realSelectionElement.outerHTML);\n              clipboardData.setData('text/plain', realSelectionElement.outerText);\n            }\n          }\n        });\n        DragDropOverrides.init(editor);\n        CefFocus.setup(editor);\n      };\n      var addCss = function () {\n        var styles = editor.contentStyles, rootClass = '.mce-content-body';\n        styles.push(fakeCaret.getCss());\n        styles.push(rootClass + ' .mce-offscreen-selection {' + 'position: absolute;' + 'left: -9999999999px;' + 'max-width: 1000000px;' + '}' + rootClass + ' *[contentEditable=false] {' + 'cursor: default;' + '}' + rootClass + ' *[contentEditable=true] {' + 'cursor: text;' + '}');\n      };\n      var isWithinCaretContainer = function (node) {\n        return isCaretContainer(node) || startsWithCaretContainer(node) || endsWithCaretContainer(node);\n      };\n      var isRangeInCaretContainer = function (rng) {\n        return isWithinCaretContainer(rng.startContainer) || isWithinCaretContainer(rng.endContainer);\n      };\n      var normalizeShortEndedElementSelection = function (rng) {\n        var shortEndedElements = editor.schema.getShortEndedElements();\n        var newRng = editor.dom.createRng();\n        var startContainer = rng.startContainer;\n        var startOffset = rng.startOffset;\n        var endContainer = rng.endContainer;\n        var endOffset = rng.endOffset;\n        if (has(shortEndedElements, startContainer.nodeName.toLowerCase())) {\n          if (startOffset === 0) {\n            newRng.setStartBefore(startContainer);\n          } else {\n            newRng.setStartAfter(startContainer);\n          }\n        } else {\n          newRng.setStart(startContainer, startOffset);\n        }\n        if (has(shortEndedElements, endContainer.nodeName.toLowerCase())) {\n          if (endOffset === 0) {\n            newRng.setEndBefore(endContainer);\n          } else {\n            newRng.setEndAfter(endContainer);\n          }\n        } else {\n          newRng.setEnd(endContainer, endOffset);\n        }\n        return newRng;\n      };\n      var setContentEditableSelection = function (range, forward) {\n        var node;\n        var $ = editor.$;\n        var dom = editor.dom;\n        var $realSelectionContainer, sel, startContainer, startOffset, endOffset, e, caretPosition, targetClone, origTargetClone;\n        if (!range) {\n          return null;\n        }\n        if (range.collapsed) {\n          if (!isRangeInCaretContainer(range)) {\n            if (forward === false) {\n              caretPosition = getNormalizedRangeEndPoint(-1, range);\n              if (isFakeCaretTarget(caretPosition.getNode(true))) {\n                return showCaret(-1, caretPosition.getNode(true), false, false);\n              }\n              if (isFakeCaretTarget(caretPosition.getNode())) {\n                return showCaret(-1, caretPosition.getNode(), !caretPosition.isAtEnd(), false);\n              }\n            } else {\n              caretPosition = getNormalizedRangeEndPoint(1, range);\n              if (isFakeCaretTarget(caretPosition.getNode())) {\n                return showCaret(1, caretPosition.getNode(), !caretPosition.isAtEnd(), false);\n              }\n              if (isFakeCaretTarget(caretPosition.getNode(true))) {\n                return showCaret(1, caretPosition.getNode(true), false, false);\n              }\n            }\n          }\n          return null;\n        }\n        startContainer = range.startContainer;\n        startOffset = range.startOffset;\n        endOffset = range.endOffset;\n        if (startContainer.nodeType === 3 && startOffset === 0 && isContentEditableFalse$9(startContainer.parentNode)) {\n          startContainer = startContainer.parentNode;\n          startOffset = dom.nodeIndex(startContainer);\n          startContainer = startContainer.parentNode;\n        }\n        if (startContainer.nodeType !== 1) {\n          return null;\n        }\n        if (endOffset === startOffset + 1 && startContainer === range.endContainer) {\n          node = startContainer.childNodes[startOffset];\n        }\n        if (!isContentEditableFalse$9(node)) {\n          return null;\n        }\n        targetClone = origTargetClone = node.cloneNode(true);\n        e = editor.fire('ObjectSelected', {\n          target: node,\n          targetClone: targetClone\n        });\n        if (e.isDefaultPrevented()) {\n          return null;\n        }\n        $realSelectionContainer = descendant(Element.fromDom(editor.getBody()), '#' + realSelectionId).fold(function () {\n          return $([]);\n        }, function (elm) {\n          return $([elm.dom()]);\n        });\n        targetClone = e.targetClone;\n        if ($realSelectionContainer.length === 0) {\n          $realSelectionContainer = $('<div data-mce-bogus=\"all\" class=\"mce-offscreen-selection\"></div>').attr('id', realSelectionId);\n          $realSelectionContainer.appendTo(editor.getBody());\n        }\n        range = editor.dom.createRng();\n        if (targetClone === origTargetClone && Env.ie) {\n          $realSelectionContainer.empty().append('<p style=\"font-size: 0\" data-mce-bogus=\"all\">\\xA0</p>').append(targetClone);\n          range.setStartAfter($realSelectionContainer[0].firstChild.firstChild);\n          range.setEndAfter(targetClone);\n        } else {\n          $realSelectionContainer.empty().append('\\xA0').append(targetClone).append('\\xA0');\n          range.setStart($realSelectionContainer[0].firstChild, 1);\n          range.setEnd($realSelectionContainer[0].lastChild, 0);\n        }\n        $realSelectionContainer.css({ top: dom.getPos(node, editor.getBody()).y });\n        $realSelectionContainer[0].focus();\n        sel = editor.selection.getSel();\n        sel.removeAllRanges();\n        sel.addRange(range);\n        each(descendants$1(Element.fromDom(editor.getBody()), '*[data-mce-selected]'), function (elm) {\n          remove(elm, 'data-mce-selected');\n        });\n        node.setAttribute('data-mce-selected', '1');\n        selectedContentEditableNode = node;\n        hideFakeCaret();\n        return range;\n      };\n      var removeContentEditableSelection = function () {\n        if (selectedContentEditableNode) {\n          selectedContentEditableNode.removeAttribute('data-mce-selected');\n          descendant(Element.fromDom(editor.getBody()), '#' + realSelectionId).each(remove$1);\n          selectedContentEditableNode = null;\n        }\n        descendant(Element.fromDom(editor.getBody()), '#' + realSelectionId).each(remove$1);\n        selectedContentEditableNode = null;\n      };\n      var destroy = function () {\n        fakeCaret.destroy();\n        selectedContentEditableNode = null;\n      };\n      var hideFakeCaret = function () {\n        fakeCaret.hide();\n      };\n      if (Env.ceFalse) {\n        registerEvents();\n        addCss();\n      }\n      return {\n        showCaret: showCaret,\n        showBlockCaretContainer: showBlockCaretContainer,\n        hideFakeCaret: hideFakeCaret,\n        destroy: destroy\n      };\n    };\n\n    var isValidPrefixAttrName = function (name) {\n      return name.indexOf('data-') === 0 || name.indexOf('aria-') === 0;\n    };\n    var trimComments = function (text) {\n      var sanitizedText = text;\n      while (/<!--|--!?>/g.test(sanitizedText)) {\n        sanitizedText = sanitizedText.replace(/<!--|--!?>/g, '');\n      }\n      return sanitizedText;\n    };\n    var isInvalidUri = function (settings, uri) {\n      if (settings.allow_html_data_urls) {\n        return false;\n      } else if (/^data:image\\//i.test(uri)) {\n        return settings.allow_svg_data_urls === false && /^data:image\\/svg\\+xml/i.test(uri);\n      } else {\n        return /^data:/i.test(uri);\n      }\n    };\n    var findEndTagIndex = function (schema, html, startIndex) {\n      var count = 1, index, matches, tokenRegExp, shortEndedElements;\n      shortEndedElements = schema.getShortEndedElements();\n      tokenRegExp = /<([!?\\/])?([A-Za-z0-9\\-_\\:\\.]+)((?:\\s+[^\"\\'>]+(?:(?:\"[^\"]*\")|(?:\\'[^\\']*\\')|[^>]*))*|\\/|\\s+)>/g;\n      tokenRegExp.lastIndex = index = startIndex;\n      while (matches = tokenRegExp.exec(html)) {\n        index = tokenRegExp.lastIndex;\n        if (matches[1] === '/') {\n          count--;\n        } else if (!matches[1]) {\n          if (matches[2] in shortEndedElements) {\n            continue;\n          }\n          count++;\n        }\n        if (count === 0) {\n          break;\n        }\n      }\n      return index;\n    };\n    var checkBogusAttribute = function (regExp, attrString) {\n      var matches = regExp.exec(attrString);\n      if (matches) {\n        var name = matches[1];\n        var value = matches[2];\n        return typeof name === 'string' && name.toLowerCase() === 'data-mce-bogus' ? value : null;\n      } else {\n        return null;\n      }\n    };\n    function SaxParser(settings, schema) {\n      if (schema === void 0) {\n        schema = Schema();\n      }\n      var noop = function () {\n      };\n      settings = settings || {};\n      if (settings.fix_self_closing !== false) {\n        settings.fix_self_closing = true;\n      }\n      var comment = settings.comment ? settings.comment : noop;\n      var cdata = settings.cdata ? settings.cdata : noop;\n      var text = settings.text ? settings.text : noop;\n      var start = settings.start ? settings.start : noop;\n      var end = settings.end ? settings.end : noop;\n      var pi = settings.pi ? settings.pi : noop;\n      var doctype = settings.doctype ? settings.doctype : noop;\n      var parse = function (html) {\n        var matches, index = 0, value, endRegExp;\n        var stack = [];\n        var attrList, i, textData, name;\n        var isInternalElement, removeInternalElements, shortEndedElements, fillAttrsMap, isShortEnded;\n        var validate, elementRule, isValidElement, attr, attribsValue, validAttributesMap, validAttributePatterns;\n        var attributesRequired, attributesDefault, attributesForced, processHtml;\n        var anyAttributesRequired, selfClosing, tokenRegExp, attrRegExp, specialElements, attrValue, idCount = 0;\n        var decode = Entities.decode;\n        var fixSelfClosing;\n        var filteredUrlAttrs = Tools.makeMap('src,href,data,background,formaction,poster,xlink:href');\n        var scriptUriRegExp = /((java|vb)script|mhtml):/i;\n        var processEndTag = function (name) {\n          var pos, i;\n          pos = stack.length;\n          while (pos--) {\n            if (stack[pos].name === name) {\n              break;\n            }\n          }\n          if (pos >= 0) {\n            for (i = stack.length - 1; i >= pos; i--) {\n              name = stack[i];\n              if (name.valid) {\n                end(name.name);\n              }\n            }\n            stack.length = pos;\n          }\n        };\n        var parseAttribute = function (match, name, value, val2, val3) {\n          var attrRule, i;\n          var trimRegExp = /[\\s\\u0000-\\u001F]+/g;\n          name = name.toLowerCase();\n          value = name in fillAttrsMap ? name : decode(value || val2 || val3 || '');\n          if (validate && !isInternalElement && isValidPrefixAttrName(name) === false) {\n            attrRule = validAttributesMap[name];\n            if (!attrRule && validAttributePatterns) {\n              i = validAttributePatterns.length;\n              while (i--) {\n                attrRule = validAttributePatterns[i];\n                if (attrRule.pattern.test(name)) {\n                  break;\n                }\n              }\n              if (i === -1) {\n                attrRule = null;\n              }\n            }\n            if (!attrRule) {\n              return;\n            }\n            if (attrRule.validValues && !(value in attrRule.validValues)) {\n              return;\n            }\n          }\n          if (filteredUrlAttrs[name] && !settings.allow_script_urls) {\n            var uri = value.replace(trimRegExp, '');\n            try {\n              uri = decodeURIComponent(uri);\n            } catch (ex) {\n              uri = unescape(uri);\n            }\n            if (scriptUriRegExp.test(uri)) {\n              return;\n            }\n            if (isInvalidUri(settings, uri)) {\n              return;\n            }\n          }\n          if (isInternalElement && (name in filteredUrlAttrs || name.indexOf('on') === 0)) {\n            return;\n          }\n          attrList.map[name] = value;\n          attrList.push({\n            name: name,\n            value: value\n          });\n        };\n        tokenRegExp = new RegExp('<(?:' + '(?:!--([\\\\w\\\\W]*?)--!?>)|' + '(?:!\\\\[CDATA\\\\[([\\\\w\\\\W]*?)\\\\]\\\\]>)|' + '(?:!DOCTYPE([\\\\w\\\\W]*?)>)|' + '(?:\\\\?([^\\\\s\\\\/<>]+) ?([\\\\w\\\\W]*?)[?/]>)|' + '(?:\\\\/([A-Za-z][A-Za-z0-9\\\\-_\\\\:\\\\.]*)>)|' + '(?:([A-Za-z][A-Za-z0-9\\\\-_\\\\:\\\\.]*)((?:\\\\s+[^\"\\'>]+(?:(?:\"[^\"]*\")|(?:\\'[^\\']*\\')|[^>]*))*|\\\\/|\\\\s+)>)' + ')', 'g');\n        attrRegExp = /([\\w:\\-]+)(?:\\s*=\\s*(?:(?:\\\"((?:[^\\\"])*)\\\")|(?:\\'((?:[^\\'])*)\\')|([^>\\s]+)))?/g;\n        shortEndedElements = schema.getShortEndedElements();\n        selfClosing = settings.self_closing_elements || schema.getSelfClosingElements();\n        fillAttrsMap = schema.getBoolAttrs();\n        validate = settings.validate;\n        removeInternalElements = settings.remove_internals;\n        fixSelfClosing = settings.fix_self_closing;\n        specialElements = schema.getSpecialElements();\n        processHtml = html + '>';\n        while (matches = tokenRegExp.exec(processHtml)) {\n          if (index < matches.index) {\n            text(decode(html.substr(index, matches.index - index)));\n          }\n          if (value = matches[6]) {\n            value = value.toLowerCase();\n            if (value.charAt(0) === ':') {\n              value = value.substr(1);\n            }\n            processEndTag(value);\n          } else if (value = matches[7]) {\n            if (matches.index + matches[0].length > html.length) {\n              text(decode(html.substr(matches.index)));\n              index = matches.index + matches[0].length;\n              continue;\n            }\n            value = value.toLowerCase();\n            if (value.charAt(0) === ':') {\n              value = value.substr(1);\n            }\n            isShortEnded = value in shortEndedElements;\n            if (fixSelfClosing && selfClosing[value] && stack.length > 0 && stack[stack.length - 1].name === value) {\n              processEndTag(value);\n            }\n            var bogusValue = checkBogusAttribute(attrRegExp, matches[8]);\n            if (bogusValue !== null) {\n              if (bogusValue === 'all') {\n                index = findEndTagIndex(schema, html, tokenRegExp.lastIndex);\n                tokenRegExp.lastIndex = index;\n                continue;\n              }\n              isValidElement = false;\n            }\n            if (!validate || (elementRule = schema.getElementRule(value))) {\n              isValidElement = true;\n              if (validate) {\n                validAttributesMap = elementRule.attributes;\n                validAttributePatterns = elementRule.attributePatterns;\n              }\n              if (attribsValue = matches[8]) {\n                isInternalElement = attribsValue.indexOf('data-mce-type') !== -1;\n                if (isInternalElement && removeInternalElements) {\n                  isValidElement = false;\n                }\n                attrList = [];\n                attrList.map = {};\n                attribsValue.replace(attrRegExp, parseAttribute);\n              } else {\n                attrList = [];\n                attrList.map = {};\n              }\n              if (validate && !isInternalElement) {\n                attributesRequired = elementRule.attributesRequired;\n                attributesDefault = elementRule.attributesDefault;\n                attributesForced = elementRule.attributesForced;\n                anyAttributesRequired = elementRule.removeEmptyAttrs;\n                if (anyAttributesRequired && !attrList.length) {\n                  isValidElement = false;\n                }\n                if (attributesForced) {\n                  i = attributesForced.length;\n                  while (i--) {\n                    attr = attributesForced[i];\n                    name = attr.name;\n                    attrValue = attr.value;\n                    if (attrValue === '{$uid}') {\n                      attrValue = 'mce_' + idCount++;\n                    }\n                    attrList.map[name] = attrValue;\n                    attrList.push({\n                      name: name,\n                      value: attrValue\n                    });\n                  }\n                }\n                if (attributesDefault) {\n                  i = attributesDefault.length;\n                  while (i--) {\n                    attr = attributesDefault[i];\n                    name = attr.name;\n                    if (!(name in attrList.map)) {\n                      attrValue = attr.value;\n                      if (attrValue === '{$uid}') {\n                        attrValue = 'mce_' + idCount++;\n                      }\n                      attrList.map[name] = attrValue;\n                      attrList.push({\n                        name: name,\n                        value: attrValue\n                      });\n                    }\n                  }\n                }\n                if (attributesRequired) {\n                  i = attributesRequired.length;\n                  while (i--) {\n                    if (attributesRequired[i] in attrList.map) {\n                      break;\n                    }\n                  }\n                  if (i === -1) {\n                    isValidElement = false;\n                  }\n                }\n                if (attr = attrList.map['data-mce-bogus']) {\n                  if (attr === 'all') {\n                    index = findEndTagIndex(schema, html, tokenRegExp.lastIndex);\n                    tokenRegExp.lastIndex = index;\n                    continue;\n                  }\n                  isValidElement = false;\n                }\n              }\n              if (isValidElement) {\n                start(value, attrList, isShortEnded);\n              }\n            } else {\n              isValidElement = false;\n            }\n            if (endRegExp = specialElements[value]) {\n              endRegExp.lastIndex = index = matches.index + matches[0].length;\n              if (matches = endRegExp.exec(html)) {\n                if (isValidElement) {\n                  textData = html.substr(index, matches.index - index);\n                }\n                index = matches.index + matches[0].length;\n              } else {\n                textData = html.substr(index);\n                index = html.length;\n              }\n              if (isValidElement) {\n                if (textData.length > 0) {\n                  text(textData, true);\n                }\n                end(value);\n              }\n              tokenRegExp.lastIndex = index;\n              continue;\n            }\n            if (!isShortEnded) {\n              if (!attribsValue || attribsValue.indexOf('/') !== attribsValue.length - 1) {\n                stack.push({\n                  name: value,\n                  valid: isValidElement\n                });\n              } else if (isValidElement) {\n                end(value);\n              }\n            }\n          } else if (value = matches[1]) {\n            if (value.charAt(0) === '>') {\n              value = ' ' + value;\n            }\n            if (!settings.allow_conditional_comments && value.substr(0, 3).toLowerCase() === '[if') {\n              value = ' ' + value;\n            }\n            comment(value);\n          } else if (value = matches[2]) {\n            cdata(trimComments(value));\n          } else if (value = matches[3]) {\n            doctype(value);\n          } else if (value = matches[4]) {\n            pi(value, matches[5]);\n          }\n          index = matches.index + matches[0].length;\n        }\n        if (index < html.length) {\n          text(decode(html.substr(index)));\n        }\n        for (i = stack.length - 1; i >= 0; i--) {\n          value = stack[i];\n          if (value.valid) {\n            end(value.name);\n          }\n        }\n      };\n      return { parse: parse };\n    }\n    (function (SaxParser) {\n      SaxParser.findEndTag = findEndTagIndex;\n    }(SaxParser || (SaxParser = {})));\n    var SaxParser$1 = SaxParser;\n\n    var trimHtml = function (tempAttrs, html) {\n      var trimContentRegExp = new RegExp(['\\\\s?(' + tempAttrs.join('|') + ')=\"[^\"]+\"'].join('|'), 'gi');\n      return html.replace(trimContentRegExp, '');\n    };\n    var trimInternal = function (serializer, html) {\n      var content = html;\n      var bogusAllRegExp = /<(\\w+) [^>]*data-mce-bogus=\"all\"[^>]*>/g;\n      var endTagIndex, index, matchLength, matches, shortEndedElements;\n      var schema = serializer.schema;\n      content = trimHtml(serializer.getTempAttrs(), content);\n      shortEndedElements = schema.getShortEndedElements();\n      while (matches = bogusAllRegExp.exec(content)) {\n        index = bogusAllRegExp.lastIndex;\n        matchLength = matches[0].length;\n        if (shortEndedElements[matches[1]]) {\n          endTagIndex = index;\n        } else {\n          endTagIndex = SaxParser$1.findEndTag(schema, content, index);\n        }\n        content = content.substring(0, index - matchLength) + content.substring(endTagIndex);\n        bogusAllRegExp.lastIndex = index - matchLength;\n      }\n      return Zwsp.trim(content);\n    };\n    var trimExternal = trimInternal;\n    var TrimHtml = {\n      trimExternal: trimExternal,\n      trimInternal: trimInternal\n    };\n\n    var KEEP = 0, INSERT = 1, DELETE = 2;\n    var diff = function (left, right) {\n      var size = left.length + right.length + 2;\n      var vDown = new Array(size);\n      var vUp = new Array(size);\n      var snake = function (start, end, diag) {\n        return {\n          start: start,\n          end: end,\n          diag: diag\n        };\n      };\n      var buildScript = function (start1, end1, start2, end2, script) {\n        var middle = getMiddleSnake(start1, end1, start2, end2);\n        if (middle === null || middle.start === end1 && middle.diag === end1 - end2 || middle.end === start1 && middle.diag === start1 - start2) {\n          var i = start1;\n          var j = start2;\n          while (i < end1 || j < end2) {\n            if (i < end1 && j < end2 && left[i] === right[j]) {\n              script.push([\n                KEEP,\n                left[i]\n              ]);\n              ++i;\n              ++j;\n            } else {\n              if (end1 - start1 > end2 - start2) {\n                script.push([\n                  DELETE,\n                  left[i]\n                ]);\n                ++i;\n              } else {\n                script.push([\n                  INSERT,\n                  right[j]\n                ]);\n                ++j;\n              }\n            }\n          }\n        } else {\n          buildScript(start1, middle.start, start2, middle.start - middle.diag, script);\n          for (var i2 = middle.start; i2 < middle.end; ++i2) {\n            script.push([\n              KEEP,\n              left[i2]\n            ]);\n          }\n          buildScript(middle.end, end1, middle.end - middle.diag, end2, script);\n        }\n      };\n      var buildSnake = function (start, diag, end1, end2) {\n        var end = start;\n        while (end - diag < end2 && end < end1 && left[end] === right[end - diag]) {\n          ++end;\n        }\n        return snake(start, end, diag);\n      };\n      var getMiddleSnake = function (start1, end1, start2, end2) {\n        var m = end1 - start1;\n        var n = end2 - start2;\n        if (m === 0 || n === 0) {\n          return null;\n        }\n        var delta = m - n;\n        var sum = n + m;\n        var offset = (sum % 2 === 0 ? sum : sum + 1) / 2;\n        vDown[1 + offset] = start1;\n        vUp[1 + offset] = end1 + 1;\n        var d, k, i, x, y;\n        for (d = 0; d <= offset; ++d) {\n          for (k = -d; k <= d; k += 2) {\n            i = k + offset;\n            if (k === -d || k !== d && vDown[i - 1] < vDown[i + 1]) {\n              vDown[i] = vDown[i + 1];\n            } else {\n              vDown[i] = vDown[i - 1] + 1;\n            }\n            x = vDown[i];\n            y = x - start1 + start2 - k;\n            while (x < end1 && y < end2 && left[x] === right[y]) {\n              vDown[i] = ++x;\n              ++y;\n            }\n            if (delta % 2 !== 0 && delta - d <= k && k <= delta + d) {\n              if (vUp[i - delta] <= vDown[i]) {\n                return buildSnake(vUp[i - delta], k + start1 - start2, end1, end2);\n              }\n            }\n          }\n          for (k = delta - d; k <= delta + d; k += 2) {\n            i = k + offset - delta;\n            if (k === delta - d || k !== delta + d && vUp[i + 1] <= vUp[i - 1]) {\n              vUp[i] = vUp[i + 1] - 1;\n            } else {\n              vUp[i] = vUp[i - 1];\n            }\n            x = vUp[i] - 1;\n            y = x - start1 + start2 - k;\n            while (x >= start1 && y >= start2 && left[x] === right[y]) {\n              vUp[i] = x--;\n              y--;\n            }\n            if (delta % 2 === 0 && -d <= k && k <= d) {\n              if (vUp[i] <= vDown[i + delta]) {\n                return buildSnake(vUp[i], k + start1 - start2, end1, end2);\n              }\n            }\n          }\n        }\n      };\n      var script = [];\n      buildScript(0, left.length, 0, right.length, script);\n      return script;\n    };\n    var Diff = {\n      KEEP: KEEP,\n      DELETE: DELETE,\n      INSERT: INSERT,\n      diff: diff\n    };\n\n    var getOuterHtml = function (elm) {\n      if (NodeType.isElement(elm)) {\n        return elm.outerHTML;\n      } else if (NodeType.isText(elm)) {\n        return Entities.encodeRaw(elm.data, false);\n      } else if (NodeType.isComment(elm)) {\n        return '<!--' + elm.data + '-->';\n      }\n      return '';\n    };\n    var createFragment$1 = function (html) {\n      var frag, node, container;\n      container = domGlobals.document.createElement('div');\n      frag = domGlobals.document.createDocumentFragment();\n      if (html) {\n        container.innerHTML = html;\n      }\n      while (node = container.firstChild) {\n        frag.appendChild(node);\n      }\n      return frag;\n    };\n    var insertAt = function (elm, html, index) {\n      var fragment = createFragment$1(html);\n      if (elm.hasChildNodes() && index < elm.childNodes.length) {\n        var target = elm.childNodes[index];\n        target.parentNode.insertBefore(fragment, target);\n      } else {\n        elm.appendChild(fragment);\n      }\n    };\n    var removeAt = function (elm, index) {\n      if (elm.hasChildNodes() && index < elm.childNodes.length) {\n        var target = elm.childNodes[index];\n        target.parentNode.removeChild(target);\n      }\n    };\n    var applyDiff = function (diff, elm) {\n      var index = 0;\n      each(diff, function (action) {\n        if (action[0] === Diff.KEEP) {\n          index++;\n        } else if (action[0] === Diff.INSERT) {\n          insertAt(elm, action[1], index);\n          index++;\n        } else if (action[0] === Diff.DELETE) {\n          removeAt(elm, index);\n        }\n      });\n    };\n    var read$3 = function (elm) {\n      return filter(map(from$1(elm.childNodes), getOuterHtml), function (item) {\n        return item.length > 0;\n      });\n    };\n    var write = function (fragments, elm) {\n      var currentFragments = map(from$1(elm.childNodes), getOuterHtml);\n      applyDiff(Diff.diff(currentFragments, fragments), elm);\n      return elm;\n    };\n    var Fragments = {\n      read: read$3,\n      write: write\n    };\n\n    var undoLevelDocument = Cell(Option.none());\n    var lazyTempDocument = function () {\n      return undoLevelDocument.get().getOrThunk(function () {\n        var doc = domGlobals.document.implementation.createHTMLDocument('undo');\n        undoLevelDocument.set(Option.some(doc));\n        return doc;\n      });\n    };\n    var hasIframes = function (html) {\n      return html.indexOf('</iframe>') !== -1;\n    };\n    var createFragmentedLevel = function (fragments) {\n      return {\n        type: 'fragmented',\n        fragments: fragments,\n        content: '',\n        bookmark: null,\n        beforeBookmark: null\n      };\n    };\n    var createCompleteLevel = function (content) {\n      return {\n        type: 'complete',\n        fragments: null,\n        content: content,\n        bookmark: null,\n        beforeBookmark: null\n      };\n    };\n    var createFromEditor = function (editor) {\n      var fragments, content, trimmedFragments;\n      fragments = Fragments.read(editor.getBody());\n      trimmedFragments = bind(fragments, function (html) {\n        var trimmed = TrimHtml.trimInternal(editor.serializer, html);\n        return trimmed.length > 0 ? [trimmed] : [];\n      });\n      content = trimmedFragments.join('');\n      return hasIframes(content) ? createFragmentedLevel(trimmedFragments) : createCompleteLevel(content);\n    };\n    var applyToEditor = function (editor, level, before) {\n      if (level.type === 'fragmented') {\n        Fragments.write(level.fragments, editor.getBody());\n      } else {\n        editor.setContent(level.content, { format: 'raw' });\n      }\n      editor.selection.moveToBookmark(before ? level.beforeBookmark : level.bookmark);\n    };\n    var getLevelContent = function (level) {\n      return level.type === 'fragmented' ? level.fragments.join('') : level.content;\n    };\n    var getCleanLevelContent = function (level) {\n      var elm = Element.fromTag('body', lazyTempDocument());\n      set$1(elm, getLevelContent(level));\n      each(descendants$1(elm, '*[data-mce-bogus]'), unwrap);\n      return get$3(elm);\n    };\n    var hasEqualContent = function (level1, level2) {\n      return getLevelContent(level1) === getLevelContent(level2);\n    };\n    var hasEqualCleanedContent = function (level1, level2) {\n      return getCleanLevelContent(level1) === getCleanLevelContent(level2);\n    };\n    var isEq$4 = function (level1, level2) {\n      if (!level1 || !level2) {\n        return false;\n      } else if (hasEqualContent(level1, level2)) {\n        return true;\n      } else {\n        return hasEqualCleanedContent(level1, level2);\n      }\n    };\n    var Levels = {\n      createFragmentedLevel: createFragmentedLevel,\n      createCompleteLevel: createCompleteLevel,\n      createFromEditor: createFromEditor,\n      applyToEditor: applyToEditor,\n      isEq: isEq$4\n    };\n\n    function UndoManager (editor) {\n      var self = this, index = 0, data = [], beforeBookmark, isFirstTypedCharacter, locks = 0;\n      var isUnlocked = function () {\n        return locks === 0;\n      };\n      var setTyping = function (typing) {\n        if (isUnlocked()) {\n          self.typing = typing;\n        }\n      };\n      var setDirty = function (state) {\n        editor.setDirty(state);\n      };\n      var addNonTypingUndoLevel = function (e) {\n        setTyping(false);\n        self.add({}, e);\n      };\n      var endTyping = function () {\n        if (self.typing) {\n          setTyping(false);\n          self.add();\n        }\n      };\n      editor.on('init', function () {\n        self.add();\n      });\n      editor.on('BeforeExecCommand', function (e) {\n        var cmd = e.command;\n        if (cmd !== 'Undo' && cmd !== 'Redo' && cmd !== 'mceRepaint') {\n          endTyping();\n          self.beforeChange();\n        }\n      });\n      editor.on('ExecCommand', function (e) {\n        var cmd = e.command;\n        if (cmd !== 'Undo' && cmd !== 'Redo' && cmd !== 'mceRepaint') {\n          addNonTypingUndoLevel(e);\n        }\n      });\n      editor.on('ObjectResizeStart Cut', function () {\n        self.beforeChange();\n      });\n      editor.on('SaveContent ObjectResized blur', addNonTypingUndoLevel);\n      editor.on('DragEnd', addNonTypingUndoLevel);\n      editor.on('KeyUp', function (e) {\n        var keyCode = e.keyCode;\n        if (e.isDefaultPrevented()) {\n          return;\n        }\n        if (keyCode >= 33 && keyCode <= 36 || keyCode >= 37 && keyCode <= 40 || keyCode === 45 || e.ctrlKey) {\n          addNonTypingUndoLevel();\n          editor.nodeChanged();\n        }\n        if (keyCode === 46 || keyCode === 8) {\n          editor.nodeChanged();\n        }\n        if (isFirstTypedCharacter && self.typing && Levels.isEq(Levels.createFromEditor(editor), data[0]) === false) {\n          if (editor.isDirty() === false) {\n            setDirty(true);\n            editor.fire('change', {\n              level: data[0],\n              lastLevel: null\n            });\n          }\n          editor.fire('TypingUndo');\n          isFirstTypedCharacter = false;\n          editor.nodeChanged();\n        }\n      });\n      editor.on('KeyDown', function (e) {\n        var keyCode = e.keyCode;\n        if (e.isDefaultPrevented()) {\n          return;\n        }\n        if (keyCode >= 33 && keyCode <= 36 || keyCode >= 37 && keyCode <= 40 || keyCode === 45) {\n          if (self.typing) {\n            addNonTypingUndoLevel(e);\n          }\n          return;\n        }\n        var modKey = e.ctrlKey && !e.altKey || e.metaKey;\n        if ((keyCode < 16 || keyCode > 20) && keyCode !== 224 && keyCode !== 91 && !self.typing && !modKey) {\n          self.beforeChange();\n          setTyping(true);\n          self.add({}, e);\n          isFirstTypedCharacter = true;\n        }\n      });\n      editor.on('MouseDown', function (e) {\n        if (self.typing) {\n          addNonTypingUndoLevel(e);\n        }\n      });\n      var isInsertReplacementText = function (event) {\n        return event.inputType === 'insertReplacementText';\n      };\n      var isInsertTextDataNull = function (event) {\n        return event.inputType === 'insertText' && event.data === null;\n      };\n      editor.on('input', function (e) {\n        if (e.inputType && (isInsertReplacementText(e) || isInsertTextDataNull(e))) {\n          addNonTypingUndoLevel(e);\n        }\n      });\n      editor.addShortcut('meta+z', '', 'Undo');\n      editor.addShortcut('meta+y,meta+shift+z', '', 'Redo');\n      editor.on('AddUndo Undo Redo ClearUndos', function (e) {\n        if (!e.isDefaultPrevented()) {\n          editor.nodeChanged();\n        }\n      });\n      self = {\n        data: data,\n        typing: false,\n        beforeChange: function () {\n          if (isUnlocked()) {\n            beforeBookmark = GetBookmark.getUndoBookmark(editor.selection);\n          }\n        },\n        add: function (level, event) {\n          var i;\n          var settings = editor.settings;\n          var lastLevel, currentLevel;\n          currentLevel = Levels.createFromEditor(editor);\n          level = level || {};\n          level = Tools.extend(level, currentLevel);\n          if (isUnlocked() === false || editor.removed) {\n            return null;\n          }\n          lastLevel = data[index];\n          if (editor.fire('BeforeAddUndo', {\n              level: level,\n              lastLevel: lastLevel,\n              originalEvent: event\n            }).isDefaultPrevented()) {\n            return null;\n          }\n          if (lastLevel && Levels.isEq(lastLevel, level)) {\n            return null;\n          }\n          if (data[index]) {\n            data[index].beforeBookmark = beforeBookmark;\n          }\n          if (settings.custom_undo_redo_levels) {\n            if (data.length > settings.custom_undo_redo_levels) {\n              for (i = 0; i < data.length - 1; i++) {\n                data[i] = data[i + 1];\n              }\n              data.length--;\n              index = data.length;\n            }\n          }\n          level.bookmark = GetBookmark.getUndoBookmark(editor.selection);\n          if (index < data.length - 1) {\n            data.length = index + 1;\n          }\n          data.push(level);\n          index = data.length - 1;\n          var args = {\n            level: level,\n            lastLevel: lastLevel,\n            originalEvent: event\n          };\n          editor.fire('AddUndo', args);\n          if (index > 0) {\n            setDirty(true);\n            editor.fire('change', args);\n          }\n          return level;\n        },\n        undo: function () {\n          var level;\n          if (self.typing) {\n            self.add();\n            self.typing = false;\n            setTyping(false);\n          }\n          if (index > 0) {\n            level = data[--index];\n            Levels.applyToEditor(editor, level, true);\n            setDirty(true);\n            editor.fire('undo', { level: level });\n          }\n          return level;\n        },\n        redo: function () {\n          var level;\n          if (index < data.length - 1) {\n            level = data[++index];\n            Levels.applyToEditor(editor, level, false);\n            setDirty(true);\n            editor.fire('redo', { level: level });\n          }\n          return level;\n        },\n        clear: function () {\n          data = [];\n          index = 0;\n          self.typing = false;\n          self.data = data;\n          editor.fire('ClearUndos');\n        },\n        hasUndo: function () {\n          return index > 0 || self.typing && data[0] && !Levels.isEq(Levels.createFromEditor(editor), data[0]);\n        },\n        hasRedo: function () {\n          return index < data.length - 1 && !self.typing;\n        },\n        transact: function (callback) {\n          endTyping();\n          self.beforeChange();\n          self.ignore(callback);\n          return self.add();\n        },\n        ignore: function (callback) {\n          try {\n            locks++;\n            callback();\n          } finally {\n            locks--;\n          }\n        },\n        extra: function (callback1, callback2) {\n          var lastLevel, bookmark;\n          if (self.transact(callback1)) {\n            bookmark = data[index].bookmark;\n            lastLevel = data[index - 1];\n            Levels.applyToEditor(editor, lastLevel, true);\n            if (self.transact(callback2)) {\n              data[index - 1].beforeBookmark = bookmark;\n            }\n          }\n        }\n      };\n      return self;\n    }\n\n    var postProcessHooks = {}, filter$2 = ArrUtils.filter, each$c = ArrUtils.each;\n    var addPostProcessHook = function (name, hook) {\n      var hooks = postProcessHooks[name];\n      if (!hooks) {\n        postProcessHooks[name] = hooks = [];\n      }\n      postProcessHooks[name].push(hook);\n    };\n    var postProcess = function (name, editor) {\n      each$c(postProcessHooks[name], function (hook) {\n        hook(editor);\n      });\n    };\n    addPostProcessHook('pre', function (editor) {\n      var rng = editor.selection.getRng();\n      var isPre, blocks;\n      var hasPreSibling = function (pre) {\n        return isPre(pre.previousSibling) && ArrUtils.indexOf(blocks, pre.previousSibling) !== -1;\n      };\n      var joinPre = function (pre1, pre2) {\n        DomQuery(pre2).remove();\n        DomQuery(pre1).append('<br><br>').append(pre2.childNodes);\n      };\n      isPre = NodeType.matchNodeNames('pre');\n      if (!rng.collapsed) {\n        blocks = editor.selection.getSelectedBlocks();\n        each$c(filter$2(filter$2(blocks, isPre), hasPreSibling), function (pre) {\n          joinPre(pre.previousSibling, pre);\n        });\n      }\n    });\n    var Hooks = { postProcess: postProcess };\n\n    var MCE_ATTR_RE = /^(src|href|style)$/;\n    var each$d = Tools.each;\n    var isEq$5 = FormatUtils.isEq;\n    var isTableCell$4 = function (node) {\n      return /^(TH|TD)$/.test(node.nodeName);\n    };\n    var isChildOfInlineParent = function (dom, node, parent) {\n      return dom.isChildOf(node, parent) && node !== parent && !dom.isBlock(parent);\n    };\n    var getContainer = function (ed, rng, start) {\n      var container, offset, lastIdx;\n      container = rng[start ? 'startContainer' : 'endContainer'];\n      offset = rng[start ? 'startOffset' : 'endOffset'];\n      if (NodeType.isElement(container)) {\n        lastIdx = container.childNodes.length - 1;\n        if (!start && offset) {\n          offset--;\n        }\n        container = container.childNodes[offset > lastIdx ? lastIdx : offset];\n      }\n      if (NodeType.isText(container) && start && offset >= container.nodeValue.length) {\n        container = new TreeWalker(container, ed.getBody()).next() || container;\n      }\n      if (NodeType.isText(container) && !start && offset === 0) {\n        container = new TreeWalker(container, ed.getBody()).prev() || container;\n      }\n      return container;\n    };\n    var wrap$2 = function (dom, node, name, attrs) {\n      var wrapper = dom.create(name, attrs);\n      node.parentNode.insertBefore(wrapper, node);\n      wrapper.appendChild(node);\n      return wrapper;\n    };\n    var wrapWithSiblings = function (dom, node, next, name, attrs) {\n      var start = Element.fromDom(node);\n      var wrapper = Element.fromDom(dom.create(name, attrs));\n      var siblings = next ? nextSiblings(start) : prevSiblings(start);\n      append$1(wrapper, siblings);\n      if (next) {\n        before(start, wrapper);\n        prepend(wrapper, start);\n      } else {\n        after(start, wrapper);\n        append(wrapper, start);\n      }\n      return wrapper.dom();\n    };\n    var matchName$1 = function (dom, node, format) {\n      if (isEq$5(node, format.inline)) {\n        return true;\n      }\n      if (isEq$5(node, format.block)) {\n        return true;\n      }\n      if (format.selector) {\n        return NodeType.isElement(node) && dom.is(node, format.selector);\n      }\n    };\n    var isColorFormatAndAnchor = function (node, format) {\n      return format.links && node.tagName === 'A';\n    };\n    var find$3 = function (dom, node, next, inc) {\n      node = FormatUtils.getNonWhiteSpaceSibling(node, next, inc);\n      return !node || (node.nodeName === 'BR' || dom.isBlock(node));\n    };\n    var removeNode$1 = function (ed, node, format) {\n      var parentNode = node.parentNode;\n      var rootBlockElm;\n      var dom = ed.dom, forcedRootBlock = ed.settings.forced_root_block;\n      if (format.block) {\n        if (!forcedRootBlock) {\n          if (dom.isBlock(node) && !dom.isBlock(parentNode)) {\n            if (!find$3(dom, node, false) && !find$3(dom, node.firstChild, true, 1)) {\n              node.insertBefore(dom.create('br'), node.firstChild);\n            }\n            if (!find$3(dom, node, true) && !find$3(dom, node.lastChild, false, 1)) {\n              node.appendChild(dom.create('br'));\n            }\n          }\n        } else {\n          if (parentNode === dom.getRoot()) {\n            if (!format.list_block || !isEq$5(node, format.list_block)) {\n              each$d(Tools.grep(node.childNodes), function (node) {\n                if (FormatUtils.isValid(ed, forcedRootBlock, node.nodeName.toLowerCase())) {\n                  if (!rootBlockElm) {\n                    rootBlockElm = wrap$2(dom, node, forcedRootBlock);\n                    dom.setAttribs(rootBlockElm, ed.settings.forced_root_block_attrs);\n                  } else {\n                    rootBlockElm.appendChild(node);\n                  }\n                } else {\n                  rootBlockElm = 0;\n                }\n              });\n            }\n          }\n        }\n      }\n      if (format.selector && format.inline && !isEq$5(format.inline, node)) {\n        return;\n      }\n      dom.remove(node, 1);\n    };\n    var removeFormat = function (ed, format, vars, node, compareNode) {\n      var i, attrs, stylesModified;\n      var dom = ed.dom;\n      if (!matchName$1(dom, node, format) && !isColorFormatAndAnchor(node, format)) {\n        return false;\n      }\n      if (format.remove !== 'all') {\n        each$d(format.styles, function (value, name) {\n          value = FormatUtils.normalizeStyleValue(dom, FormatUtils.replaceVars(value, vars), name);\n          if (typeof name === 'number') {\n            name = value;\n            compareNode = 0;\n          }\n          if (format.remove_similar || (!compareNode || isEq$5(FormatUtils.getStyle(dom, compareNode, name), value))) {\n            dom.setStyle(node, name, '');\n          }\n          stylesModified = 1;\n        });\n        if (stylesModified && dom.getAttrib(node, 'style') === '') {\n          node.removeAttribute('style');\n          node.removeAttribute('data-mce-style');\n        }\n        each$d(format.attributes, function (value, name) {\n          var valueOut;\n          value = FormatUtils.replaceVars(value, vars);\n          if (typeof name === 'number') {\n            name = value;\n            compareNode = 0;\n          }\n          if (!compareNode || isEq$5(dom.getAttrib(compareNode, name), value)) {\n            if (name === 'class') {\n              value = dom.getAttrib(node, name);\n              if (value) {\n                valueOut = '';\n                each$d(value.split(/\\s+/), function (cls) {\n                  if (/mce\\-\\w+/.test(cls)) {\n                    valueOut += (valueOut ? ' ' : '') + cls;\n                  }\n                });\n                if (valueOut) {\n                  dom.setAttrib(node, name, valueOut);\n                  return;\n                }\n              }\n            }\n            if (name === 'class') {\n              node.removeAttribute('className');\n            }\n            if (MCE_ATTR_RE.test(name)) {\n              node.removeAttribute('data-mce-' + name);\n            }\n            node.removeAttribute(name);\n          }\n        });\n        each$d(format.classes, function (value) {\n          value = FormatUtils.replaceVars(value, vars);\n          if (!compareNode || dom.hasClass(compareNode, value)) {\n            dom.removeClass(node, value);\n          }\n        });\n        attrs = dom.getAttribs(node);\n        for (i = 0; i < attrs.length; i++) {\n          var attrName = attrs[i].nodeName;\n          if (attrName.indexOf('_') !== 0 && attrName.indexOf('data-') !== 0) {\n            return false;\n          }\n        }\n      }\n      if (format.remove !== 'none') {\n        removeNode$1(ed, node, format);\n        return true;\n      }\n    };\n    var findFormatRoot = function (editor, container, name, vars, similar) {\n      var formatRoot;\n      each$d(FormatUtils.getParents(editor.dom, container.parentNode).reverse(), function (parent) {\n        var format;\n        if (!formatRoot && parent.id !== '_start' && parent.id !== '_end') {\n          format = MatchFormat.matchNode(editor, parent, name, vars, similar);\n          if (format && format.split !== false) {\n            formatRoot = parent;\n          }\n        }\n      });\n      return formatRoot;\n    };\n    var wrapAndSplit = function (editor, formatList, formatRoot, container, target, split, format, vars) {\n      var parent, clone, lastClone, firstClone, i, formatRootParent;\n      var dom = editor.dom;\n      if (formatRoot) {\n        formatRootParent = formatRoot.parentNode;\n        for (parent = container.parentNode; parent && parent !== formatRootParent; parent = parent.parentNode) {\n          clone = dom.clone(parent, false);\n          for (i = 0; i < formatList.length; i++) {\n            if (removeFormat(editor, formatList[i], vars, clone, clone)) {\n              clone = 0;\n              break;\n            }\n          }\n          if (clone) {\n            if (lastClone) {\n              clone.appendChild(lastClone);\n            }\n            if (!firstClone) {\n              firstClone = clone;\n            }\n            lastClone = clone;\n          }\n        }\n        if (split && (!format.mixed || !dom.isBlock(formatRoot))) {\n          container = dom.split(formatRoot, container);\n        }\n        if (lastClone) {\n          target.parentNode.insertBefore(lastClone, target);\n          firstClone.appendChild(target);\n        }\n      }\n      return container;\n    };\n    var remove$6 = function (ed, name, vars, node, similar) {\n      var formatList = ed.formatter.get(name), format = formatList[0];\n      var bookmark, rng, contentEditable = true;\n      var dom = ed.dom;\n      var selection = ed.selection;\n      var splitToFormatRoot = function (container) {\n        var formatRoot = findFormatRoot(ed, container, name, vars, similar);\n        return wrapAndSplit(ed, formatList, formatRoot, container, container, true, format, vars);\n      };\n      var isRemoveBookmarkNode = function (node) {\n        return Bookmarks.isBookmarkNode(node) && NodeType.isElement(node) && (node.id === '_start' || node.id === '_end');\n      };\n      var process = function (node) {\n        var children, i, l, lastContentEditable, hasContentEditableState;\n        if (NodeType.isElement(node) && dom.getContentEditable(node)) {\n          lastContentEditable = contentEditable;\n          contentEditable = dom.getContentEditable(node) === 'true';\n          hasContentEditableState = true;\n        }\n        children = Tools.grep(node.childNodes);\n        if (contentEditable && !hasContentEditableState) {\n          for (i = 0, l = formatList.length; i < l; i++) {\n            if (removeFormat(ed, formatList[i], vars, node, node)) {\n              break;\n            }\n          }\n        }\n        if (format.deep) {\n          if (children.length) {\n            for (i = 0, l = children.length; i < l; i++) {\n              process(children[i]);\n            }\n            if (hasContentEditableState) {\n              contentEditable = lastContentEditable;\n            }\n          }\n        }\n      };\n      var unwrap = function (start) {\n        var node = dom.get(start ? '_start' : '_end');\n        var out = node[start ? 'firstChild' : 'lastChild'];\n        if (isRemoveBookmarkNode(out)) {\n          out = out[start ? 'firstChild' : 'lastChild'];\n        }\n        if (NodeType.isText(out) && out.data.length === 0) {\n          out = start ? node.previousSibling || node.nextSibling : node.nextSibling || node.previousSibling;\n        }\n        dom.remove(node, true);\n        return out;\n      };\n      var removeRngStyle = function (rng) {\n        var startContainer, endContainer;\n        var commonAncestorContainer = rng.commonAncestorContainer;\n        rng = ExpandRange.expandRng(ed, rng, formatList, true);\n        if (format.split) {\n          rng = SplitRange.split(rng);\n          startContainer = getContainer(ed, rng, true);\n          endContainer = getContainer(ed, rng);\n          if (startContainer !== endContainer) {\n            if (/^(TR|TH|TD)$/.test(startContainer.nodeName) && startContainer.firstChild) {\n              if (startContainer.nodeName === 'TR') {\n                startContainer = startContainer.firstChild.firstChild || startContainer;\n              } else {\n                startContainer = startContainer.firstChild || startContainer;\n              }\n            }\n            if (commonAncestorContainer && /^T(HEAD|BODY|FOOT|R)$/.test(commonAncestorContainer.nodeName) && isTableCell$4(endContainer) && endContainer.firstChild) {\n              endContainer = endContainer.firstChild || endContainer;\n            }\n            if (isChildOfInlineParent(dom, startContainer, endContainer)) {\n              var marker = Option.from(startContainer.firstChild).getOr(startContainer);\n              splitToFormatRoot(wrapWithSiblings(dom, marker, true, 'span', {\n                'id': '_start',\n                'data-mce-type': 'bookmark'\n              }));\n              unwrap(true);\n              return;\n            }\n            if (isChildOfInlineParent(dom, endContainer, startContainer)) {\n              var marker = Option.from(endContainer.lastChild).getOr(endContainer);\n              splitToFormatRoot(wrapWithSiblings(dom, marker, false, 'span', {\n                'id': '_end',\n                'data-mce-type': 'bookmark'\n              }));\n              unwrap(false);\n              return;\n            }\n            startContainer = wrap$2(dom, startContainer, 'span', {\n              'id': '_start',\n              'data-mce-type': 'bookmark'\n            });\n            endContainer = wrap$2(dom, endContainer, 'span', {\n              'id': '_end',\n              'data-mce-type': 'bookmark'\n            });\n            splitToFormatRoot(startContainer);\n            splitToFormatRoot(endContainer);\n            startContainer = unwrap(true);\n            endContainer = unwrap();\n          } else {\n            startContainer = endContainer = splitToFormatRoot(startContainer);\n          }\n          rng.startContainer = startContainer.parentNode ? startContainer.parentNode : startContainer;\n          rng.startOffset = dom.nodeIndex(startContainer);\n          rng.endContainer = endContainer.parentNode ? endContainer.parentNode : endContainer;\n          rng.endOffset = dom.nodeIndex(endContainer) + 1;\n        }\n        RangeWalk.walk(dom, rng, function (nodes) {\n          each$d(nodes, function (node) {\n            process(node);\n            if (NodeType.isElement(node) && ed.dom.getStyle(node, 'text-decoration') === 'underline' && node.parentNode && FormatUtils.getTextDecoration(dom, node.parentNode) === 'underline') {\n              removeFormat(ed, {\n                deep: false,\n                exact: true,\n                inline: 'span',\n                styles: { textDecoration: 'underline' }\n              }, null, node);\n            }\n          });\n        });\n      };\n      if (node) {\n        if (node.nodeType) {\n          rng = dom.createRng();\n          rng.setStartBefore(node);\n          rng.setEndAfter(node);\n          removeRngStyle(rng);\n        } else {\n          removeRngStyle(node);\n        }\n        return;\n      }\n      if (dom.getContentEditable(selection.getNode()) === 'false') {\n        node = selection.getNode();\n        for (var i = 0, l = formatList.length; i < l; i++) {\n          if (formatList[i].ceFalseOverride) {\n            if (removeFormat(ed, formatList[i], vars, node, node)) {\n              break;\n            }\n          }\n        }\n        return;\n      }\n      if (!selection.isCollapsed() || !format.inline || dom.select('td[data-mce-selected],th[data-mce-selected]').length) {\n        bookmark = GetBookmark.getPersistentBookmark(ed.selection, true);\n        removeRngStyle(selection.getRng());\n        selection.moveToBookmark(bookmark);\n        if (format.inline && MatchFormat.match(ed, name, vars, selection.getStart())) {\n          FormatUtils.moveStart(dom, selection, selection.getRng());\n        }\n        ed.nodeChanged();\n      } else {\n        removeCaretFormat(ed, name, vars, similar);\n      }\n    };\n    var RemoveFormat = {\n      removeFormat: removeFormat,\n      remove: remove$6\n    };\n\n    var each$e = Tools.each;\n    var isElementNode = function (node) {\n      return node && node.nodeType === 1 && !Bookmarks.isBookmarkNode(node) && !isCaretNode(node) && !NodeType.isBogus(node);\n    };\n    var findElementSibling = function (node, siblingName) {\n      var sibling;\n      for (sibling = node; sibling; sibling = sibling[siblingName]) {\n        if (sibling.nodeType === 3 && sibling.nodeValue.length !== 0) {\n          return node;\n        }\n        if (sibling.nodeType === 1 && !Bookmarks.isBookmarkNode(sibling)) {\n          return sibling;\n        }\n      }\n      return node;\n    };\n    var mergeSiblingsNodes = function (dom, prev, next) {\n      var sibling, tmpSibling;\n      var elementUtils = new ElementUtils(dom);\n      if (prev && next) {\n        prev = findElementSibling(prev, 'previousSibling');\n        next = findElementSibling(next, 'nextSibling');\n        if (elementUtils.compare(prev, next)) {\n          for (sibling = prev.nextSibling; sibling && sibling !== next;) {\n            tmpSibling = sibling;\n            sibling = sibling.nextSibling;\n            prev.appendChild(tmpSibling);\n          }\n          dom.remove(next);\n          Tools.each(Tools.grep(next.childNodes), function (node) {\n            prev.appendChild(node);\n          });\n          return prev;\n        }\n      }\n      return next;\n    };\n    var processChildElements = function (node, filter, process) {\n      each$e(node.childNodes, function (node) {\n        if (isElementNode(node)) {\n          if (filter(node)) {\n            process(node);\n          }\n          if (node.hasChildNodes()) {\n            processChildElements(node, filter, process);\n          }\n        }\n      });\n    };\n    var hasStyle = function (dom, name) {\n      return curry(function (name, node) {\n        return !!(node && FormatUtils.getStyle(dom, node, name));\n      }, name);\n    };\n    var applyStyle = function (dom, name, value) {\n      return curry(function (name, value, node) {\n        dom.setStyle(node, name, value);\n        if (node.getAttribute('style') === '') {\n          node.removeAttribute('style');\n        }\n        unwrapEmptySpan(dom, node);\n      }, name, value);\n    };\n    var unwrapEmptySpan = function (dom, node) {\n      if (node.nodeName === 'SPAN' && dom.getAttribs(node).length === 0) {\n        dom.remove(node, true);\n      }\n    };\n    var processUnderlineAndColor = function (dom, node) {\n      var textDecoration;\n      if (node.nodeType === 1 && node.parentNode && node.parentNode.nodeType === 1) {\n        textDecoration = FormatUtils.getTextDecoration(dom, node.parentNode);\n        if (dom.getStyle(node, 'color') && textDecoration) {\n          dom.setStyle(node, 'text-decoration', textDecoration);\n        } else if (dom.getStyle(node, 'text-decoration') === textDecoration) {\n          dom.setStyle(node, 'text-decoration', null);\n        }\n      }\n    };\n    var mergeUnderlineAndColor = function (dom, format, vars, node) {\n      if (format.styles.color || format.styles.textDecoration) {\n        Tools.walk(node, curry(processUnderlineAndColor, dom), 'childNodes');\n        processUnderlineAndColor(dom, node);\n      }\n    };\n    var mergeBackgroundColorAndFontSize = function (dom, format, vars, node) {\n      if (format.styles && format.styles.backgroundColor) {\n        processChildElements(node, hasStyle(dom, 'fontSize'), applyStyle(dom, 'backgroundColor', FormatUtils.replaceVars(format.styles.backgroundColor, vars)));\n      }\n    };\n    var mergeSubSup = function (dom, format, vars, node) {\n      if (format.inline === 'sub' || format.inline === 'sup') {\n        processChildElements(node, hasStyle(dom, 'fontSize'), applyStyle(dom, 'fontSize', ''));\n        dom.remove(dom.select(format.inline === 'sup' ? 'sub' : 'sup', node), true);\n      }\n    };\n    var mergeSiblings = function (dom, format, vars, node) {\n      if (node && format.merge_siblings !== false) {\n        node = mergeSiblingsNodes(dom, FormatUtils.getNonWhiteSpaceSibling(node), node);\n        node = mergeSiblingsNodes(dom, node, FormatUtils.getNonWhiteSpaceSibling(node, true));\n      }\n    };\n    var clearChildStyles = function (dom, format, node) {\n      if (format.clear_child_styles) {\n        var selector = format.links ? '*:not(a)' : '*';\n        each$e(dom.select(selector, node), function (node) {\n          if (isElementNode(node)) {\n            each$e(format.styles, function (value, name) {\n              dom.setStyle(node, name, '');\n            });\n          }\n        });\n      }\n    };\n    var mergeWithChildren = function (editor, formatList, vars, node) {\n      each$e(formatList, function (format) {\n        each$e(editor.dom.select(format.inline, node), function (child) {\n          if (!isElementNode(child)) {\n            return;\n          }\n          RemoveFormat.removeFormat(editor, format, vars, child, format.exact ? child : null);\n        });\n        clearChildStyles(editor.dom, format, node);\n      });\n    };\n    var mergeWithParents = function (editor, format, name, vars, node) {\n      if (MatchFormat.matchNode(editor, node.parentNode, name, vars)) {\n        if (RemoveFormat.removeFormat(editor, format, vars, node)) {\n          return;\n        }\n      }\n      if (format.merge_with_parents) {\n        editor.dom.getParent(node.parentNode, function (parent) {\n          if (MatchFormat.matchNode(editor, parent, name, vars)) {\n            RemoveFormat.removeFormat(editor, format, vars, node);\n            return true;\n          }\n        });\n      }\n    };\n    var MergeFormats = {\n      mergeWithChildren: mergeWithChildren,\n      mergeUnderlineAndColor: mergeUnderlineAndColor,\n      mergeBackgroundColorAndFontSize: mergeBackgroundColorAndFontSize,\n      mergeSubSup: mergeSubSup,\n      mergeSiblings: mergeSiblings,\n      mergeWithParents: mergeWithParents\n    };\n\n    var each$f = Tools.each;\n    var isElementNode$1 = function (node) {\n      return node && node.nodeType === 1 && !Bookmarks.isBookmarkNode(node) && !isCaretNode(node) && !NodeType.isBogus(node);\n    };\n    var applyFormat = function (ed, name, vars, node) {\n      var formatList = ed.formatter.get(name);\n      var format = formatList[0];\n      var bookmark, rng;\n      var isCollapsed = !node && ed.selection.isCollapsed();\n      var dom = ed.dom, selection = ed.selection;\n      var setElementFormat = function (elm, fmt) {\n        fmt = fmt || format;\n        if (elm) {\n          if (fmt.onformat) {\n            fmt.onformat(elm, fmt, vars, node);\n          }\n          each$f(fmt.styles, function (value, name) {\n            dom.setStyle(elm, name, FormatUtils.replaceVars(value, vars));\n          });\n          if (fmt.styles) {\n            var styleVal = dom.getAttrib(elm, 'style');\n            if (styleVal) {\n              elm.setAttribute('data-mce-style', styleVal);\n            }\n          }\n          each$f(fmt.attributes, function (value, name) {\n            dom.setAttrib(elm, name, FormatUtils.replaceVars(value, vars));\n          });\n          each$f(fmt.classes, function (value) {\n            value = FormatUtils.replaceVars(value, vars);\n            if (!dom.hasClass(elm, value)) {\n              dom.addClass(elm, value);\n            }\n          });\n        }\n      };\n      var applyNodeStyle = function (formatList, node) {\n        var found = false;\n        if (!format.selector) {\n          return false;\n        }\n        each$f(formatList, function (format) {\n          if ('collapsed' in format && format.collapsed !== isCollapsed) {\n            return;\n          }\n          if (dom.is(node, format.selector) && !isCaretNode(node)) {\n            setElementFormat(node, format);\n            found = true;\n            return false;\n          }\n        });\n        return found;\n      };\n      var applyRngStyle = function (dom, rng, bookmark, nodeSpecific) {\n        var newWrappers = [];\n        var wrapName, wrapElm, contentEditable = true;\n        wrapName = format.inline || format.block;\n        wrapElm = dom.create(wrapName);\n        setElementFormat(wrapElm);\n        RangeWalk.walk(dom, rng, function (nodes) {\n          var currentWrapElm;\n          var process = function (node) {\n            var nodeName, parentName, hasContentEditableState, lastContentEditable;\n            lastContentEditable = contentEditable;\n            nodeName = node.nodeName.toLowerCase();\n            parentName = node.parentNode.nodeName.toLowerCase();\n            if (node.nodeType === 1 && dom.getContentEditable(node)) {\n              lastContentEditable = contentEditable;\n              contentEditable = dom.getContentEditable(node) === 'true';\n              hasContentEditableState = true;\n            }\n            if (FormatUtils.isEq(nodeName, 'br')) {\n              currentWrapElm = 0;\n              if (format.block) {\n                dom.remove(node);\n              }\n              return;\n            }\n            if (format.wrapper && MatchFormat.matchNode(ed, node, name, vars)) {\n              currentWrapElm = 0;\n              return;\n            }\n            if (contentEditable && !hasContentEditableState && format.block && !format.wrapper && FormatUtils.isTextBlock(ed, nodeName) && FormatUtils.isValid(ed, parentName, wrapName)) {\n              node = dom.rename(node, wrapName);\n              setElementFormat(node);\n              newWrappers.push(node);\n              currentWrapElm = 0;\n              return;\n            }\n            if (format.selector) {\n              var found = applyNodeStyle(formatList, node);\n              if (!format.inline || found) {\n                currentWrapElm = 0;\n                return;\n              }\n            }\n            if (contentEditable && !hasContentEditableState && FormatUtils.isValid(ed, wrapName, nodeName) && FormatUtils.isValid(ed, parentName, wrapName) && !(!nodeSpecific && node.nodeType === 3 && node.nodeValue.length === 1 && node.nodeValue.charCodeAt(0) === 65279) && !isCaretNode(node) && (!format.inline || !dom.isBlock(node))) {\n              if (!currentWrapElm) {\n                currentWrapElm = dom.clone(wrapElm, false);\n                node.parentNode.insertBefore(currentWrapElm, node);\n                newWrappers.push(currentWrapElm);\n              }\n              currentWrapElm.appendChild(node);\n            } else {\n              currentWrapElm = 0;\n              each$f(Tools.grep(node.childNodes), process);\n              if (hasContentEditableState) {\n                contentEditable = lastContentEditable;\n              }\n              currentWrapElm = 0;\n            }\n          };\n          each$f(nodes, process);\n        });\n        if (format.links === true) {\n          each$f(newWrappers, function (node) {\n            var process = function (node) {\n              if (node.nodeName === 'A') {\n                setElementFormat(node, format);\n              }\n              each$f(Tools.grep(node.childNodes), process);\n            };\n            process(node);\n          });\n        }\n        each$f(newWrappers, function (node) {\n          var childCount;\n          var getChildCount = function (node) {\n            var count = 0;\n            each$f(node.childNodes, function (node) {\n              if (!FormatUtils.isWhiteSpaceNode(node) && !Bookmarks.isBookmarkNode(node)) {\n                count++;\n              }\n            });\n            return count;\n          };\n          var getChildElementNode = function (root) {\n            var child = false;\n            each$f(root.childNodes, function (node) {\n              if (isElementNode$1(node)) {\n                child = node;\n                return false;\n              }\n            });\n            return child;\n          };\n          var mergeStyles = function (node) {\n            var child, clone;\n            child = getChildElementNode(node);\n            if (child && !Bookmarks.isBookmarkNode(child) && MatchFormat.matchName(dom, child, format)) {\n              clone = dom.clone(child, false);\n              setElementFormat(clone);\n              dom.replace(clone, node, true);\n              dom.remove(child, 1);\n            }\n            return clone || node;\n          };\n          childCount = getChildCount(node);\n          if ((newWrappers.length > 1 || !dom.isBlock(node)) && childCount === 0) {\n            dom.remove(node, 1);\n            return;\n          }\n          if (format.inline || format.wrapper) {\n            if (!format.exact && childCount === 1) {\n              node = mergeStyles(node);\n            }\n            MergeFormats.mergeWithChildren(ed, formatList, vars, node);\n            MergeFormats.mergeWithParents(ed, format, name, vars, node);\n            MergeFormats.mergeBackgroundColorAndFontSize(dom, format, vars, node);\n            MergeFormats.mergeSubSup(dom, format, vars, node);\n            MergeFormats.mergeSiblings(dom, format, vars, node);\n          }\n        });\n      };\n      if (dom.getContentEditable(selection.getNode()) === 'false') {\n        node = selection.getNode();\n        for (var i = 0, l = formatList.length; i < l; i++) {\n          if (formatList[i].ceFalseOverride && dom.is(node, formatList[i].selector)) {\n            setElementFormat(node, formatList[i]);\n            return;\n          }\n        }\n        return;\n      }\n      if (format) {\n        if (node) {\n          if (node.nodeType) {\n            if (!applyNodeStyle(formatList, node)) {\n              rng = dom.createRng();\n              rng.setStartBefore(node);\n              rng.setEndAfter(node);\n              applyRngStyle(dom, ExpandRange.expandRng(ed, rng, formatList), null, true);\n            }\n          } else {\n            applyRngStyle(dom, node, null, true);\n          }\n        } else {\n          if (!isCollapsed || !format.inline || dom.select('td[data-mce-selected],th[data-mce-selected]').length) {\n            var curSelNode = ed.selection.getNode();\n            if (!ed.settings.forced_root_block && formatList[0].defaultBlock && !dom.getParent(curSelNode, dom.isBlock)) {\n              applyFormat(ed, formatList[0].defaultBlock);\n            }\n            ed.selection.setRng(RangeNormalizer.normalize(ed.selection.getRng()));\n            bookmark = GetBookmark.getPersistentBookmark(ed.selection, true);\n            applyRngStyle(dom, ExpandRange.expandRng(ed, selection.getRng(), formatList));\n            if (format.styles) {\n              MergeFormats.mergeUnderlineAndColor(dom, format, vars, curSelNode);\n            }\n            selection.moveToBookmark(bookmark);\n            FormatUtils.moveStart(dom, selection, selection.getRng());\n            ed.nodeChanged();\n          } else {\n            applyCaretFormat(ed, name, vars);\n          }\n        }\n        Hooks.postProcess(name, ed);\n      }\n    };\n    var ApplyFormat = { applyFormat: applyFormat };\n\n    var each$g = Tools.each;\n    var setup$5 = function (formatChangeData, editor) {\n      var currentFormats = {};\n      formatChangeData.set({});\n      editor.on('NodeChange', function (e) {\n        var parents = FormatUtils.getParents(editor.dom, e.element);\n        var matchedFormats = {};\n        parents = Tools.grep(parents, function (node) {\n          return node.nodeType === 1 && !node.getAttribute('data-mce-bogus');\n        });\n        each$g(formatChangeData.get(), function (callbacks, format) {\n          each$g(parents, function (node) {\n            if (editor.formatter.matchNode(node, format, {}, callbacks.similar)) {\n              if (!currentFormats[format]) {\n                each$g(callbacks, function (callback) {\n                  callback(true, {\n                    node: node,\n                    format: format,\n                    parents: parents\n                  });\n                });\n                currentFormats[format] = callbacks;\n              }\n              matchedFormats[format] = callbacks;\n              return false;\n            }\n            if (MatchFormat.matchesUnInheritedFormatSelector(editor, node, format)) {\n              return false;\n            }\n          });\n        });\n        each$g(currentFormats, function (callbacks, format) {\n          if (!matchedFormats[format]) {\n            delete currentFormats[format];\n            each$g(callbacks, function (callback) {\n              callback(false, {\n                node: e.element,\n                format: format,\n                parents: parents\n              });\n            });\n          }\n        });\n      });\n    };\n    var addListeners = function (formatChangeData, formats, callback, similar) {\n      var formatChangeItems = formatChangeData.get();\n      each$g(formats.split(','), function (format) {\n        if (!formatChangeItems[format]) {\n          formatChangeItems[format] = [];\n          formatChangeItems[format].similar = similar;\n        }\n        formatChangeItems[format].push(callback);\n      });\n      formatChangeData.set(formatChangeItems);\n    };\n    var formatChanged = function (editor, formatChangeState, formats, callback, similar) {\n      if (formatChangeState.get() === null) {\n        setup$5(formatChangeState, editor);\n      }\n      addListeners(formatChangeState, formats, callback, similar);\n    };\n    var FormatChanged = { formatChanged: formatChanged };\n\n    var get$5 = function (dom) {\n      var formats = {\n        valigntop: [{\n            selector: 'td,th',\n            styles: { verticalAlign: 'top' }\n          }],\n        valignmiddle: [{\n            selector: 'td,th',\n            styles: { verticalAlign: 'middle' }\n          }],\n        valignbottom: [{\n            selector: 'td,th',\n            styles: { verticalAlign: 'bottom' }\n          }],\n        alignleft: [\n          {\n            selector: 'figure.image',\n            collapsed: false,\n            classes: 'align-left',\n            ceFalseOverride: true,\n            preview: 'font-family font-size'\n          },\n          {\n            selector: 'figure,p,h1,h2,h3,h4,h5,h6,td,th,tr,div,ul,ol,li',\n            styles: { textAlign: 'left' },\n            inherit: false,\n            preview: false,\n            defaultBlock: 'div'\n          },\n          {\n            selector: 'img,table',\n            collapsed: false,\n            styles: { float: 'left' },\n            preview: 'font-family font-size'\n          }\n        ],\n        aligncenter: [\n          {\n            selector: 'figure,p,h1,h2,h3,h4,h5,h6,td,th,tr,div,ul,ol,li',\n            styles: { textAlign: 'center' },\n            inherit: false,\n            preview: 'font-family font-size',\n            defaultBlock: 'div'\n          },\n          {\n            selector: 'figure.image',\n            collapsed: false,\n            classes: 'align-center',\n            ceFalseOverride: true,\n            preview: 'font-family font-size'\n          },\n          {\n            selector: 'img',\n            collapsed: false,\n            styles: {\n              display: 'block',\n              marginLeft: 'auto',\n              marginRight: 'auto'\n            },\n            preview: false\n          },\n          {\n            selector: 'table',\n            collapsed: false,\n            styles: {\n              marginLeft: 'auto',\n              marginRight: 'auto'\n            },\n            preview: 'font-family font-size'\n          }\n        ],\n        alignright: [\n          {\n            selector: 'figure.image',\n            collapsed: false,\n            classes: 'align-right',\n            ceFalseOverride: true,\n            preview: 'font-family font-size'\n          },\n          {\n            selector: 'figure,p,h1,h2,h3,h4,h5,h6,td,th,tr,div,ul,ol,li',\n            styles: { textAlign: 'right' },\n            inherit: false,\n            preview: 'font-family font-size',\n            defaultBlock: 'div'\n          },\n          {\n            selector: 'img,table',\n            collapsed: false,\n            styles: { float: 'right' },\n            preview: 'font-family font-size'\n          }\n        ],\n        alignjustify: [{\n            selector: 'figure,p,h1,h2,h3,h4,h5,h6,td,th,tr,div,ul,ol,li',\n            styles: { textAlign: 'justify' },\n            inherit: false,\n            defaultBlock: 'div',\n            preview: 'font-family font-size'\n          }],\n        bold: [\n          {\n            inline: 'strong',\n            remove: 'all'\n          },\n          {\n            inline: 'span',\n            styles: { fontWeight: 'bold' }\n          },\n          {\n            inline: 'b',\n            remove: 'all'\n          }\n        ],\n        italic: [\n          {\n            inline: 'em',\n            remove: 'all'\n          },\n          {\n            inline: 'span',\n            styles: { fontStyle: 'italic' }\n          },\n          {\n            inline: 'i',\n            remove: 'all'\n          }\n        ],\n        underline: [\n          {\n            inline: 'span',\n            styles: { textDecoration: 'underline' },\n            exact: true\n          },\n          {\n            inline: 'u',\n            remove: 'all'\n          }\n        ],\n        strikethrough: [\n          {\n            inline: 'span',\n            styles: { textDecoration: 'line-through' },\n            exact: true\n          },\n          {\n            inline: 'strike',\n            remove: 'all'\n          }\n        ],\n        forecolor: {\n          inline: 'span',\n          styles: { color: '%value' },\n          links: true,\n          remove_similar: true,\n          clear_child_styles: true\n        },\n        hilitecolor: {\n          inline: 'span',\n          styles: { backgroundColor: '%value' },\n          links: true,\n          remove_similar: true,\n          clear_child_styles: true\n        },\n        fontname: {\n          inline: 'span',\n          toggle: false,\n          styles: { fontFamily: '%value' },\n          clear_child_styles: true\n        },\n        fontsize: {\n          inline: 'span',\n          toggle: false,\n          styles: { fontSize: '%value' },\n          clear_child_styles: true\n        },\n        fontsize_class: {\n          inline: 'span',\n          attributes: { class: '%value' }\n        },\n        blockquote: {\n          block: 'blockquote',\n          wrapper: 1,\n          remove: 'all'\n        },\n        subscript: { inline: 'sub' },\n        superscript: { inline: 'sup' },\n        code: { inline: 'code' },\n        link: {\n          inline: 'a',\n          selector: 'a',\n          remove: 'all',\n          split: true,\n          deep: true,\n          onmatch: function () {\n            return true;\n          },\n          onformat: function (elm, fmt, vars) {\n            Tools.each(vars, function (value, key) {\n              dom.setAttrib(elm, key, value);\n            });\n          }\n        },\n        removeformat: [\n          {\n            selector: 'b,strong,em,i,font,u,strike,sub,sup,dfn,code,samp,kbd,var,cite,mark,q,del,ins',\n            remove: 'all',\n            split: true,\n            expand: false,\n            block_expand: true,\n            deep: true\n          },\n          {\n            selector: 'span',\n            attributes: [\n              'style',\n              'class'\n            ],\n            remove: 'empty',\n            split: true,\n            expand: false,\n            deep: true\n          },\n          {\n            selector: '*',\n            attributes: [\n              'style',\n              'class'\n            ],\n            split: false,\n            expand: false,\n            deep: true\n          }\n        ]\n      };\n      Tools.each('p h1 h2 h3 h4 h5 h6 div address pre div dt dd samp'.split(/\\s/), function (name) {\n        formats[name] = {\n          block: name,\n          remove: 'all'\n        };\n      });\n      return formats;\n    };\n    var DefaultFormats = { get: get$5 };\n\n    function FormatRegistry (editor) {\n      var formats = {};\n      var get = function (name) {\n        return name ? formats[name] : formats;\n      };\n      var register = function (name, format) {\n        if (name) {\n          if (typeof name !== 'string') {\n            Tools.each(name, function (format, name) {\n              register(name, format);\n            });\n          } else {\n            format = format.length ? format : [format];\n            Tools.each(format, function (format) {\n              if (typeof format.deep === 'undefined') {\n                format.deep = !format.selector;\n              }\n              if (typeof format.split === 'undefined') {\n                format.split = !format.selector || format.inline;\n              }\n              if (typeof format.remove === 'undefined' && format.selector && !format.inline) {\n                format.remove = 'none';\n              }\n              if (format.selector && format.inline) {\n                format.mixed = true;\n                format.block_expand = true;\n              }\n              if (typeof format.classes === 'string') {\n                format.classes = format.classes.split(/\\s+/);\n              }\n            });\n            formats[name] = format;\n          }\n        }\n      };\n      var unregister = function (name) {\n        if (name && formats[name]) {\n          delete formats[name];\n        }\n        return formats;\n      };\n      register(DefaultFormats.get(editor.dom));\n      register(editor.settings.formats);\n      return {\n        get: get,\n        register: register,\n        unregister: unregister\n      };\n    }\n\n    var each$h = Tools.each;\n    var dom = DOMUtils$1.DOM;\n    var parsedSelectorToHtml = function (ancestry, editor) {\n      var elm, item, fragment;\n      var schema = editor && editor.schema || Schema({});\n      var decorate = function (elm, item) {\n        if (item.classes.length) {\n          dom.addClass(elm, item.classes.join(' '));\n        }\n        dom.setAttribs(elm, item.attrs);\n      };\n      var createElement = function (sItem) {\n        var elm;\n        item = typeof sItem === 'string' ? {\n          name: sItem,\n          classes: [],\n          attrs: {}\n        } : sItem;\n        elm = dom.create(item.name);\n        decorate(elm, item);\n        return elm;\n      };\n      var getRequiredParent = function (elm, candidate) {\n        var name = typeof elm !== 'string' ? elm.nodeName.toLowerCase() : elm;\n        var elmRule = schema.getElementRule(name);\n        var parentsRequired = elmRule && elmRule.parentsRequired;\n        if (parentsRequired && parentsRequired.length) {\n          return candidate && Tools.inArray(parentsRequired, candidate) !== -1 ? candidate : parentsRequired[0];\n        } else {\n          return false;\n        }\n      };\n      var wrapInHtml = function (elm, ancestry, siblings) {\n        var parent, parentCandidate, parentRequired;\n        var ancestor = ancestry.length > 0 && ancestry[0];\n        var ancestorName = ancestor && ancestor.name;\n        parentRequired = getRequiredParent(elm, ancestorName);\n        if (parentRequired) {\n          if (ancestorName === parentRequired) {\n            parentCandidate = ancestry[0];\n            ancestry = ancestry.slice(1);\n          } else {\n            parentCandidate = parentRequired;\n          }\n        } else if (ancestor) {\n          parentCandidate = ancestry[0];\n          ancestry = ancestry.slice(1);\n        } else if (!siblings) {\n          return elm;\n        }\n        if (parentCandidate) {\n          parent = createElement(parentCandidate);\n          parent.appendChild(elm);\n        }\n        if (siblings) {\n          if (!parent) {\n            parent = dom.create('div');\n            parent.appendChild(elm);\n          }\n          Tools.each(siblings, function (sibling) {\n            var siblingElm = createElement(sibling);\n            parent.insertBefore(siblingElm, elm);\n          });\n        }\n        return wrapInHtml(parent, ancestry, parentCandidate && parentCandidate.siblings);\n      };\n      if (ancestry && ancestry.length) {\n        item = ancestry[0];\n        elm = createElement(item);\n        fragment = dom.create('div');\n        fragment.appendChild(wrapInHtml(elm, ancestry.slice(1), item.siblings));\n        return fragment;\n      } else {\n        return '';\n      }\n    };\n    var selectorToHtml = function (selector, editor) {\n      return parsedSelectorToHtml(parseSelector(selector), editor);\n    };\n    var parseSelectorItem = function (item) {\n      var tagName;\n      var obj = {\n        classes: [],\n        attrs: {}\n      };\n      item = obj.selector = Tools.trim(item);\n      if (item !== '*') {\n        tagName = item.replace(/(?:([#\\.]|::?)([\\w\\-]+)|(\\[)([^\\]]+)\\]?)/g, function ($0, $1, $2, $3, $4) {\n          switch ($1) {\n          case '#':\n            obj.attrs.id = $2;\n            break;\n          case '.':\n            obj.classes.push($2);\n            break;\n          case ':':\n            if (Tools.inArray('checked disabled enabled read-only required'.split(' '), $2) !== -1) {\n              obj.attrs[$2] = $2;\n            }\n            break;\n          }\n          if ($3 === '[') {\n            var m = $4.match(/([\\w\\-]+)(?:\\=\\\"([^\\\"]+))?/);\n            if (m) {\n              obj.attrs[m[1]] = m[2];\n            }\n          }\n          return '';\n        });\n      }\n      obj.name = tagName || 'div';\n      return obj;\n    };\n    var parseSelector = function (selector) {\n      if (!selector || typeof selector !== 'string') {\n        return [];\n      }\n      selector = selector.split(/\\s*,\\s*/)[0];\n      selector = selector.replace(/\\s*(~\\+|~|\\+|>)\\s*/g, '$1');\n      return Tools.map(selector.split(/(?:>|\\s+(?![^\\[\\]]+\\]))/), function (item) {\n        var siblings = Tools.map(item.split(/(?:~\\+|~|\\+)/), parseSelectorItem);\n        var obj = siblings.pop();\n        if (siblings.length) {\n          obj.siblings = siblings;\n        }\n        return obj;\n      }).reverse();\n    };\n    var getCssText = function (editor, format) {\n      var name, previewFrag, previewElm, items;\n      var previewCss = '', parentFontSize, previewStyles;\n      previewStyles = editor.settings.preview_styles;\n      if (previewStyles === false) {\n        return '';\n      }\n      if (typeof previewStyles !== 'string') {\n        previewStyles = 'font-family font-size font-weight font-style text-decoration ' + 'text-transform color background-color border border-radius outline text-shadow';\n      }\n      var removeVars = function (val) {\n        return val.replace(/%(\\w+)/g, '');\n      };\n      if (typeof format === 'string') {\n        format = editor.formatter.get(format);\n        if (!format) {\n          return;\n        }\n        format = format[0];\n      }\n      if ('preview' in format) {\n        previewStyles = format.preview;\n        if (previewStyles === false) {\n          return '';\n        }\n      }\n      name = format.block || format.inline || 'span';\n      items = parseSelector(format.selector);\n      if (items.length) {\n        if (!items[0].name) {\n          items[0].name = name;\n        }\n        name = format.selector;\n        previewFrag = parsedSelectorToHtml(items, editor);\n      } else {\n        previewFrag = parsedSelectorToHtml([name], editor);\n      }\n      previewElm = dom.select(name, previewFrag)[0] || previewFrag.firstChild;\n      each$h(format.styles, function (value, name) {\n        value = removeVars(value);\n        if (value) {\n          dom.setStyle(previewElm, name, value);\n        }\n      });\n      each$h(format.attributes, function (value, name) {\n        value = removeVars(value);\n        if (value) {\n          dom.setAttrib(previewElm, name, value);\n        }\n      });\n      each$h(format.classes, function (value) {\n        value = removeVars(value);\n        if (!dom.hasClass(previewElm, value)) {\n          dom.addClass(previewElm, value);\n        }\n      });\n      editor.fire('PreviewFormats');\n      dom.setStyles(previewFrag, {\n        position: 'absolute',\n        left: -65535\n      });\n      editor.getBody().appendChild(previewFrag);\n      parentFontSize = dom.getStyle(editor.getBody(), 'fontSize', true);\n      parentFontSize = /px$/.test(parentFontSize) ? parseInt(parentFontSize, 10) : 0;\n      each$h(previewStyles.split(' '), function (name) {\n        var value = dom.getStyle(previewElm, name, true);\n        if (name === 'background-color' && /transparent|rgba\\s*\\([^)]+,\\s*0\\)/.test(value)) {\n          value = dom.getStyle(editor.getBody(), name, true);\n          if (dom.toHex(value).toLowerCase() === '#ffffff') {\n            return;\n          }\n        }\n        if (name === 'color') {\n          if (dom.toHex(value).toLowerCase() === '#000000') {\n            return;\n          }\n        }\n        if (name === 'font-size') {\n          if (/em|%$/.test(value)) {\n            if (parentFontSize === 0) {\n              return;\n            }\n            var numValue = parseFloat(value) / (/%$/.test(value) ? 100 : 1);\n            value = numValue * parentFontSize + 'px';\n          }\n        }\n        if (name === 'border' && value) {\n          previewCss += 'padding:0 2px;';\n        }\n        previewCss += name + ':' + value + ';';\n      });\n      editor.fire('AfterPreviewFormats');\n      dom.remove(previewFrag);\n      return previewCss;\n    };\n    var Preview = {\n      getCssText: getCssText,\n      parseSelector: parseSelector,\n      selectorToHtml: selectorToHtml\n    };\n\n    var toggle = function (editor, formats, name, vars, node) {\n      var fmt = formats.get(name);\n      if (MatchFormat.match(editor, name, vars, node) && (!('toggle' in fmt[0]) || fmt[0].toggle)) {\n        RemoveFormat.remove(editor, name, vars, node);\n      } else {\n        ApplyFormat.applyFormat(editor, name, vars, node);\n      }\n    };\n    var ToggleFormat = { toggle: toggle };\n\n    var setup$6 = function (editor) {\n      editor.addShortcut('meta+b', '', 'Bold');\n      editor.addShortcut('meta+i', '', 'Italic');\n      editor.addShortcut('meta+u', '', 'Underline');\n      for (var i = 1; i <= 6; i++) {\n        editor.addShortcut('access+' + i, '', [\n          'FormatBlock',\n          false,\n          'h' + i\n        ]);\n      }\n      editor.addShortcut('access+7', '', [\n        'FormatBlock',\n        false,\n        'p'\n      ]);\n      editor.addShortcut('access+8', '', [\n        'FormatBlock',\n        false,\n        'div'\n      ]);\n      editor.addShortcut('access+9', '', [\n        'FormatBlock',\n        false,\n        'address'\n      ]);\n    };\n    var FormatShortcuts = { setup: setup$6 };\n\n    function Formatter (editor) {\n      var formats = FormatRegistry(editor);\n      var formatChangeState = Cell(null);\n      FormatShortcuts.setup(editor);\n      setup$2(editor);\n      return {\n        get: formats.get,\n        register: formats.register,\n        unregister: formats.unregister,\n        apply: curry(ApplyFormat.applyFormat, editor),\n        remove: curry(RemoveFormat.remove, editor),\n        toggle: curry(ToggleFormat.toggle, editor, formats),\n        match: curry(MatchFormat.match, editor),\n        matchAll: curry(MatchFormat.matchAll, editor),\n        matchNode: curry(MatchFormat.matchNode, editor),\n        canApply: curry(MatchFormat.canApply, editor),\n        formatChanged: curry(FormatChanged.formatChanged, editor, formatChangeState),\n        getCssText: curry(Preview.getCssText, editor)\n      };\n    }\n\n    var hasOwnProperty$2 = Object.prototype.hasOwnProperty;\n    var shallow$1 = function (old, nu) {\n      return nu;\n    };\n    var baseMerge = function (merger) {\n      return function () {\n        var objects = new Array(arguments.length);\n        for (var i = 0; i < objects.length; i++) {\n          objects[i] = arguments[i];\n        }\n        if (objects.length === 0) {\n          throw new Error('Can\\'t merge zero objects');\n        }\n        var ret = {};\n        for (var j = 0; j < objects.length; j++) {\n          var curObject = objects[j];\n          for (var key in curObject) {\n            if (hasOwnProperty$2.call(curObject, key)) {\n              ret[key] = merger(ret[key], curObject[key]);\n            }\n          }\n        }\n        return ret;\n      };\n    };\n    var merge = baseMerge(shallow$1);\n\n    var register = function (htmlParser, settings, dom) {\n      htmlParser.addAttributeFilter('data-mce-tabindex', function (nodes, name) {\n        var i = nodes.length, node;\n        while (i--) {\n          node = nodes[i];\n          node.attr('tabindex', node.attributes.map['data-mce-tabindex']);\n          node.attr(name, null);\n        }\n      });\n      htmlParser.addAttributeFilter('src,href,style', function (nodes, name) {\n        var i = nodes.length, node, value;\n        var internalName = 'data-mce-' + name;\n        var urlConverter = settings.url_converter;\n        var urlConverterScope = settings.url_converter_scope;\n        while (i--) {\n          node = nodes[i];\n          value = node.attributes.map[internalName];\n          if (value !== undefined) {\n            node.attr(name, value.length > 0 ? value : null);\n            node.attr(internalName, null);\n          } else {\n            value = node.attributes.map[name];\n            if (name === 'style') {\n              value = dom.serializeStyle(dom.parseStyle(value), node.name);\n            } else if (urlConverter) {\n              value = urlConverter.call(urlConverterScope, value, name, node.name);\n            }\n            node.attr(name, value.length > 0 ? value : null);\n          }\n        }\n      });\n      htmlParser.addAttributeFilter('class', function (nodes) {\n        var i = nodes.length, node, value;\n        while (i--) {\n          node = nodes[i];\n          value = node.attr('class');\n          if (value) {\n            value = node.attr('class').replace(/(?:^|\\s)mce-item-\\w+(?!\\S)/g, '');\n            node.attr('class', value.length > 0 ? value : null);\n          }\n        }\n      });\n      htmlParser.addAttributeFilter('data-mce-type', function (nodes, name, args) {\n        var i = nodes.length, node;\n        while (i--) {\n          node = nodes[i];\n          if (node.attributes.map['data-mce-type'] === 'bookmark' && !args.cleanup) {\n            var hasChildren = Option.from(node.firstChild).exists(function (firstChild) {\n              return !Zwsp.isZwsp(firstChild.value);\n            });\n            if (hasChildren) {\n              node.unwrap();\n            } else {\n              node.remove();\n            }\n          }\n        }\n      });\n      htmlParser.addNodeFilter('noscript', function (nodes) {\n        var i = nodes.length, node;\n        while (i--) {\n          node = nodes[i].firstChild;\n          if (node) {\n            node.value = Entities.decode(node.value);\n          }\n        }\n      });\n      htmlParser.addNodeFilter('script,style', function (nodes, name) {\n        var i = nodes.length, node, value, type;\n        var trim = function (value) {\n          return value.replace(/(<!--\\[CDATA\\[|\\]\\]-->)/g, '\\n').replace(/^[\\r\\n]*|[\\r\\n]*$/g, '').replace(/^\\s*((<!--)?(\\s*\\/\\/)?\\s*<!\\[CDATA\\[|(<!--\\s*)?\\/\\*\\s*<!\\[CDATA\\[\\s*\\*\\/|(\\/\\/)?\\s*<!--|\\/\\*\\s*<!--\\s*\\*\\/)\\s*[\\r\\n]*/gi, '').replace(/\\s*(\\/\\*\\s*\\]\\]>\\s*\\*\\/(-->)?|\\s*\\/\\/\\s*\\]\\]>(-->)?|\\/\\/\\s*(-->)?|\\]\\]>|\\/\\*\\s*-->\\s*\\*\\/|\\s*-->\\s*)\\s*$/g, '');\n        };\n        while (i--) {\n          node = nodes[i];\n          value = node.firstChild ? node.firstChild.value : '';\n          if (name === 'script') {\n            type = node.attr('type');\n            if (type) {\n              node.attr('type', type === 'mce-no/type' ? null : type.replace(/^mce\\-/, ''));\n            }\n            if (settings.element_format === 'xhtml' && value.length > 0) {\n              node.firstChild.value = '// <![CDATA[\\n' + trim(value) + '\\n// ]]>';\n            }\n          } else {\n            if (settings.element_format === 'xhtml' && value.length > 0) {\n              node.firstChild.value = '<!--\\n' + trim(value) + '\\n-->';\n            }\n          }\n        }\n      });\n      htmlParser.addNodeFilter('#comment', function (nodes) {\n        var i = nodes.length, node;\n        while (i--) {\n          node = nodes[i];\n          if (node.value.indexOf('[CDATA[') === 0) {\n            node.name = '#cdata';\n            node.type = 4;\n            node.value = node.value.replace(/^\\[CDATA\\[|\\]\\]$/g, '');\n          } else if (node.value.indexOf('mce:protected ') === 0) {\n            node.name = '#text';\n            node.type = 3;\n            node.raw = true;\n            node.value = unescape(node.value).substr(14);\n          }\n        }\n      });\n      htmlParser.addNodeFilter('xml:namespace,input', function (nodes, name) {\n        var i = nodes.length, node;\n        while (i--) {\n          node = nodes[i];\n          if (node.type === 7) {\n            node.remove();\n          } else if (node.type === 1) {\n            if (name === 'input' && !('type' in node.attributes.map)) {\n              node.attr('type', 'text');\n            }\n          }\n        }\n      });\n      htmlParser.addAttributeFilter('data-mce-type', function (nodes) {\n        each(nodes, function (node) {\n          if (node.attr('data-mce-type') === 'format-caret') {\n            if (node.isEmpty(htmlParser.schema.getNonEmptyElements())) {\n              node.remove();\n            } else {\n              node.unwrap();\n            }\n          }\n        });\n      });\n      htmlParser.addAttributeFilter('data-mce-src,data-mce-href,data-mce-style,' + 'data-mce-selected,data-mce-expando,' + 'data-mce-type,data-mce-resize', function (nodes, name) {\n        var i = nodes.length;\n        while (i--) {\n          nodes[i].attr(name, null);\n        }\n      });\n    };\n    var trimTrailingBr = function (rootNode) {\n      var brNode1, brNode2;\n      var isBr = function (node) {\n        return node && node.name === 'br';\n      };\n      brNode1 = rootNode.lastChild;\n      if (isBr(brNode1)) {\n        brNode2 = brNode1.prev;\n        if (isBr(brNode2)) {\n          brNode1.remove();\n          brNode2.remove();\n        }\n      }\n    };\n    var DomSerializerFilters = {\n      register: register,\n      trimTrailingBr: trimTrailingBr\n    };\n\n    var preProcess = function (editor, node, args) {\n      var impl, doc, oldDoc;\n      var dom = editor.dom;\n      node = node.cloneNode(true);\n      impl = domGlobals.document.implementation;\n      if (impl.createHTMLDocument) {\n        doc = impl.createHTMLDocument('');\n        Tools.each(node.nodeName === 'BODY' ? node.childNodes : [node], function (node) {\n          doc.body.appendChild(doc.importNode(node, true));\n        });\n        if (node.nodeName !== 'BODY') {\n          node = doc.body.firstChild;\n        } else {\n          node = doc.body;\n        }\n        oldDoc = dom.doc;\n        dom.doc = doc;\n      }\n      Events.firePreProcess(editor, merge(args, { node: node }));\n      if (oldDoc) {\n        dom.doc = oldDoc;\n      }\n      return node;\n    };\n    var shouldFireEvent = function (editor, args) {\n      return editor && editor.hasEventListeners('PreProcess') && !args.no_events;\n    };\n    var process = function (editor, node, args) {\n      return shouldFireEvent(editor, args) ? preProcess(editor, node, args) : node;\n    };\n    var DomSerializerPreProcess = { process: process };\n\n    var removeAttrs = function (node, names) {\n      each(names, function (name) {\n        node.attr(name, null);\n      });\n    };\n    var addFontToSpansFilter = function (domParser, styles, fontSizes) {\n      domParser.addNodeFilter('font', function (nodes) {\n        each(nodes, function (node) {\n          var props = styles.parse(node.attr('style'));\n          var color = node.attr('color');\n          var face = node.attr('face');\n          var size = node.attr('size');\n          if (color) {\n            props.color = color;\n          }\n          if (face) {\n            props['font-family'] = face;\n          }\n          if (size) {\n            props['font-size'] = fontSizes[parseInt(node.attr('size'), 10) - 1];\n          }\n          node.name = 'span';\n          node.attr('style', styles.serialize(props));\n          removeAttrs(node, [\n            'color',\n            'face',\n            'size'\n          ]);\n        });\n      });\n    };\n    var addStrikeToSpanFilter = function (domParser, styles) {\n      domParser.addNodeFilter('strike', function (nodes) {\n        each(nodes, function (node) {\n          var props = styles.parse(node.attr('style'));\n          props['text-decoration'] = 'line-through';\n          node.name = 'span';\n          node.attr('style', styles.serialize(props));\n        });\n      });\n    };\n    var addFilters = function (domParser, settings) {\n      var styles = Styles();\n      if (settings.convert_fonts_to_spans) {\n        addFontToSpansFilter(domParser, styles, Tools.explode(settings.font_size_legacy_values));\n      }\n      addStrikeToSpanFilter(domParser, styles);\n    };\n    var register$1 = function (domParser, settings) {\n      if (settings.inline_styles) {\n        addFilters(domParser, settings);\n      }\n    };\n    var LegacyFilter = { register: register$1 };\n\n    var whiteSpaceRegExp$3 = /^[ \\t\\r\\n]*$/;\n    var typeLookup = {\n      '#text': 3,\n      '#comment': 8,\n      '#cdata': 4,\n      '#pi': 7,\n      '#doctype': 10,\n      '#document-fragment': 11\n    };\n    var walk$2 = function (node, root, prev) {\n      var sibling;\n      var parent;\n      var startName = prev ? 'lastChild' : 'firstChild';\n      var siblingName = prev ? 'prev' : 'next';\n      if (node[startName]) {\n        return node[startName];\n      }\n      if (node !== root) {\n        sibling = node[siblingName];\n        if (sibling) {\n          return sibling;\n        }\n        for (parent = node.parent; parent && parent !== root; parent = parent.parent) {\n          sibling = parent[siblingName];\n          if (sibling) {\n            return sibling;\n          }\n        }\n      }\n    };\n    var Node$1 = function () {\n      function Node(name, type) {\n        this.name = name;\n        this.type = type;\n        if (type === 1) {\n          this.attributes = [];\n          this.attributes.map = {};\n        }\n      }\n      Node.create = function (name, attrs) {\n        var node, attrName;\n        node = new Node(name, typeLookup[name] || 1);\n        if (attrs) {\n          for (attrName in attrs) {\n            node.attr(attrName, attrs[attrName]);\n          }\n        }\n        return node;\n      };\n      Node.prototype.replace = function (node) {\n        var self = this;\n        if (node.parent) {\n          node.remove();\n        }\n        self.insert(node, self);\n        self.remove();\n        return self;\n      };\n      Node.prototype.attr = function (name, value) {\n        var self = this;\n        var attrs, i;\n        if (typeof name !== 'string') {\n          for (i in name) {\n            self.attr(i, name[i]);\n          }\n          return self;\n        }\n        if (attrs = self.attributes) {\n          if (value !== undefined) {\n            if (value === null) {\n              if (name in attrs.map) {\n                delete attrs.map[name];\n                i = attrs.length;\n                while (i--) {\n                  if (attrs[i].name === name) {\n                    attrs = attrs.splice(i, 1);\n                    return self;\n                  }\n                }\n              }\n              return self;\n            }\n            if (name in attrs.map) {\n              i = attrs.length;\n              while (i--) {\n                if (attrs[i].name === name) {\n                  attrs[i].value = value;\n                  break;\n                }\n              }\n            } else {\n              attrs.push({\n                name: name,\n                value: value\n              });\n            }\n            attrs.map[name] = value;\n            return self;\n          }\n          return attrs.map[name];\n        }\n      };\n      Node.prototype.clone = function () {\n        var self = this;\n        var clone = new Node(self.name, self.type);\n        var i, l, selfAttrs, selfAttr, cloneAttrs;\n        if (selfAttrs = self.attributes) {\n          cloneAttrs = [];\n          cloneAttrs.map = {};\n          for (i = 0, l = selfAttrs.length; i < l; i++) {\n            selfAttr = selfAttrs[i];\n            if (selfAttr.name !== 'id') {\n              cloneAttrs[cloneAttrs.length] = {\n                name: selfAttr.name,\n                value: selfAttr.value\n              };\n              cloneAttrs.map[selfAttr.name] = selfAttr.value;\n            }\n          }\n          clone.attributes = cloneAttrs;\n        }\n        clone.value = self.value;\n        clone.shortEnded = self.shortEnded;\n        return clone;\n      };\n      Node.prototype.wrap = function (wrapper) {\n        var self = this;\n        self.parent.insert(wrapper, self);\n        wrapper.append(self);\n        return self;\n      };\n      Node.prototype.unwrap = function () {\n        var self = this;\n        var node, next;\n        for (node = self.firstChild; node;) {\n          next = node.next;\n          self.insert(node, self, true);\n          node = next;\n        }\n        self.remove();\n      };\n      Node.prototype.remove = function () {\n        var self = this, parent = self.parent, next = self.next, prev = self.prev;\n        if (parent) {\n          if (parent.firstChild === self) {\n            parent.firstChild = next;\n            if (next) {\n              next.prev = null;\n            }\n          } else {\n            prev.next = next;\n          }\n          if (parent.lastChild === self) {\n            parent.lastChild = prev;\n            if (prev) {\n              prev.next = null;\n            }\n          } else {\n            next.prev = prev;\n          }\n          self.parent = self.next = self.prev = null;\n        }\n        return self;\n      };\n      Node.prototype.append = function (node) {\n        var self = this;\n        var last;\n        if (node.parent) {\n          node.remove();\n        }\n        last = self.lastChild;\n        if (last) {\n          last.next = node;\n          node.prev = last;\n          self.lastChild = node;\n        } else {\n          self.lastChild = self.firstChild = node;\n        }\n        node.parent = self;\n        return node;\n      };\n      Node.prototype.insert = function (node, refNode, before) {\n        var parent;\n        if (node.parent) {\n          node.remove();\n        }\n        parent = refNode.parent || this;\n        if (before) {\n          if (refNode === parent.firstChild) {\n            parent.firstChild = node;\n          } else {\n            refNode.prev.next = node;\n          }\n          node.prev = refNode.prev;\n          node.next = refNode;\n          refNode.prev = node;\n        } else {\n          if (refNode === parent.lastChild) {\n            parent.lastChild = node;\n          } else {\n            refNode.next.prev = node;\n          }\n          node.next = refNode.next;\n          node.prev = refNode;\n          refNode.next = node;\n        }\n        node.parent = parent;\n        return node;\n      };\n      Node.prototype.getAll = function (name) {\n        var self = this;\n        var node;\n        var collection = [];\n        for (node = self.firstChild; node; node = walk$2(node, self)) {\n          if (node.name === name) {\n            collection.push(node);\n          }\n        }\n        return collection;\n      };\n      Node.prototype.empty = function () {\n        var self = this;\n        var nodes, i, node;\n        if (self.firstChild) {\n          nodes = [];\n          for (node = self.firstChild; node; node = walk$2(node, self)) {\n            nodes.push(node);\n          }\n          i = nodes.length;\n          while (i--) {\n            node = nodes[i];\n            node.parent = node.firstChild = node.lastChild = node.next = node.prev = null;\n          }\n        }\n        self.firstChild = self.lastChild = null;\n        return self;\n      };\n      Node.prototype.isEmpty = function (elements, whitespace, predicate) {\n        var self = this;\n        var node = self.firstChild, i, name;\n        whitespace = whitespace || {};\n        if (node) {\n          do {\n            if (node.type === 1) {\n              if (node.attributes.map['data-mce-bogus']) {\n                continue;\n              }\n              if (elements[node.name]) {\n                return false;\n              }\n              i = node.attributes.length;\n              while (i--) {\n                name = node.attributes[i].name;\n                if (name === 'name' || name.indexOf('data-mce-bookmark') === 0) {\n                  return false;\n                }\n              }\n            }\n            if (node.type === 8) {\n              return false;\n            }\n            if (node.type === 3 && !whiteSpaceRegExp$3.test(node.value)) {\n              return false;\n            }\n            if (node.type === 3 && node.parent && whitespace[node.parent.name] && whiteSpaceRegExp$3.test(node.value)) {\n              return false;\n            }\n            if (predicate && predicate(node)) {\n              return false;\n            }\n          } while (node = walk$2(node, self));\n        }\n        return true;\n      };\n      Node.prototype.walk = function (prev) {\n        return walk$2(this, null, prev);\n      };\n      return Node;\n    }();\n\n    var paddEmptyNode = function (settings, args, blockElements, node) {\n      var brPreferred = settings.padd_empty_with_br || args.insert;\n      if (brPreferred && blockElements[node.name]) {\n        node.empty().append(new Node$1('br', 1)).shortEnded = true;\n      } else {\n        node.empty().append(new Node$1('#text', 3)).value = '\\xA0';\n      }\n    };\n    var isPaddedWithNbsp = function (node) {\n      return hasOnlyChild(node, '#text') && node.firstChild.value === '\\xA0';\n    };\n    var hasOnlyChild = function (node, name) {\n      return node && node.firstChild && node.firstChild === node.lastChild && node.firstChild.name === name;\n    };\n    var isPadded = function (schema, node) {\n      var rule = schema.getElementRule(node.name);\n      return rule && rule.paddEmpty;\n    };\n    var isEmpty$2 = function (schema, nonEmptyElements, whitespaceElements, node) {\n      return node.isEmpty(nonEmptyElements, whitespaceElements, function (node) {\n        return isPadded(schema, node);\n      });\n    };\n    var isLineBreakNode = function (node, blockElements) {\n      return node && (blockElements[node.name] || node.name === 'br');\n    };\n\n    var register$2 = function (parser, settings) {\n      var schema = parser.schema;\n      if (settings.remove_trailing_brs) {\n        parser.addNodeFilter('br', function (nodes, _, args) {\n          var i;\n          var l = nodes.length;\n          var node;\n          var blockElements = Tools.extend({}, schema.getBlockElements());\n          var nonEmptyElements = schema.getNonEmptyElements();\n          var parent, lastParent, prev, prevName;\n          var whiteSpaceElements = schema.getWhiteSpaceElements();\n          var elementRule, textNode;\n          blockElements.body = 1;\n          for (i = 0; i < l; i++) {\n            node = nodes[i];\n            parent = node.parent;\n            if (blockElements[node.parent.name] && node === parent.lastChild) {\n              prev = node.prev;\n              while (prev) {\n                prevName = prev.name;\n                if (prevName !== 'span' || prev.attr('data-mce-type') !== 'bookmark') {\n                  if (prevName !== 'br') {\n                    break;\n                  }\n                  if (prevName === 'br') {\n                    node = null;\n                    break;\n                  }\n                }\n                prev = prev.prev;\n              }\n              if (node) {\n                node.remove();\n                if (isEmpty$2(schema, nonEmptyElements, whiteSpaceElements, parent)) {\n                  elementRule = schema.getElementRule(parent.name);\n                  if (elementRule) {\n                    if (elementRule.removeEmpty) {\n                      parent.remove();\n                    } else if (elementRule.paddEmpty) {\n                      paddEmptyNode(settings, args, blockElements, parent);\n                    }\n                  }\n                }\n              }\n            } else {\n              lastParent = node;\n              while (parent && parent.firstChild === lastParent && parent.lastChild === lastParent) {\n                lastParent = parent;\n                if (blockElements[parent.name]) {\n                  break;\n                }\n                parent = parent.parent;\n              }\n              if (lastParent === parent && settings.padd_empty_with_br !== true) {\n                textNode = new Node$1('#text', 3);\n                textNode.value = '\\xA0';\n                node.replace(textNode);\n              }\n            }\n          }\n        });\n      }\n      parser.addAttributeFilter('href', function (nodes) {\n        var i = nodes.length, node;\n        var appendRel = function (rel) {\n          var parts = rel.split(' ').filter(function (p) {\n            return p.length > 0;\n          });\n          return parts.concat(['noopener']).sort().join(' ');\n        };\n        var addNoOpener = function (rel) {\n          var newRel = rel ? Tools.trim(rel) : '';\n          if (!/\\b(noopener)\\b/g.test(newRel)) {\n            return appendRel(newRel);\n          } else {\n            return newRel;\n          }\n        };\n        if (!settings.allow_unsafe_link_target) {\n          while (i--) {\n            node = nodes[i];\n            if (node.name === 'a' && node.attr('target') === '_blank') {\n              node.attr('rel', addNoOpener(node.attr('rel')));\n            }\n          }\n        }\n      });\n      if (!settings.allow_html_in_named_anchor) {\n        parser.addAttributeFilter('id,name', function (nodes) {\n          var i = nodes.length, sibling, prevSibling, parent, node;\n          while (i--) {\n            node = nodes[i];\n            if (node.name === 'a' && node.firstChild && !node.attr('href')) {\n              parent = node.parent;\n              sibling = node.lastChild;\n              do {\n                prevSibling = sibling.prev;\n                parent.insert(sibling, node);\n                sibling = prevSibling;\n              } while (sibling);\n            }\n          }\n        });\n      }\n      if (settings.fix_list_elements) {\n        parser.addNodeFilter('ul,ol', function (nodes) {\n          var i = nodes.length, node, parentNode;\n          while (i--) {\n            node = nodes[i];\n            parentNode = node.parent;\n            if (parentNode.name === 'ul' || parentNode.name === 'ol') {\n              if (node.prev && node.prev.name === 'li') {\n                node.prev.append(node);\n              } else {\n                var li = new Node$1('li', 1);\n                li.attr('style', 'list-style-type: none');\n                node.wrap(li);\n              }\n            }\n          }\n        });\n      }\n      if (settings.validate && schema.getValidClasses()) {\n        parser.addAttributeFilter('class', function (nodes) {\n          var i = nodes.length, node, classList, ci, className, classValue;\n          var validClasses = schema.getValidClasses();\n          var validClassesMap, valid;\n          while (i--) {\n            node = nodes[i];\n            classList = node.attr('class').split(' ');\n            classValue = '';\n            for (ci = 0; ci < classList.length; ci++) {\n              className = classList[ci];\n              valid = false;\n              validClassesMap = validClasses['*'];\n              if (validClassesMap && validClassesMap[className]) {\n                valid = true;\n              }\n              validClassesMap = validClasses[node.name];\n              if (!valid && validClassesMap && validClassesMap[className]) {\n                valid = true;\n              }\n              if (valid) {\n                if (classValue) {\n                  classValue += ' ';\n                }\n                classValue += className;\n              }\n            }\n            if (!classValue.length) {\n              classValue = null;\n            }\n            node.attr('class', classValue);\n          }\n        });\n      }\n    };\n\n    var makeMap$4 = Tools.makeMap, each$i = Tools.each, explode$3 = Tools.explode, extend$3 = Tools.extend;\n    function DomParser (settings, schema) {\n      if (schema === void 0) {\n        schema = Schema();\n      }\n      var nodeFilters = {};\n      var attributeFilters = [];\n      var matchedNodes = {};\n      var matchedAttributes = {};\n      settings = settings || {};\n      settings.validate = 'validate' in settings ? settings.validate : true;\n      settings.root_name = settings.root_name || 'body';\n      var fixInvalidChildren = function (nodes) {\n        var ni, node, parent, parents, newParent, currentNode, tempNode, childNode, i;\n        var nonEmptyElements, whitespaceElements, nonSplitableElements, textBlockElements, specialElements, sibling, nextNode;\n        nonSplitableElements = makeMap$4('tr,td,th,tbody,thead,tfoot,table');\n        nonEmptyElements = schema.getNonEmptyElements();\n        whitespaceElements = schema.getWhiteSpaceElements();\n        textBlockElements = schema.getTextBlockElements();\n        specialElements = schema.getSpecialElements();\n        for (ni = 0; ni < nodes.length; ni++) {\n          node = nodes[ni];\n          if (!node.parent || node.fixed) {\n            continue;\n          }\n          if (textBlockElements[node.name] && node.parent.name === 'li') {\n            sibling = node.next;\n            while (sibling) {\n              if (textBlockElements[sibling.name]) {\n                sibling.name = 'li';\n                sibling.fixed = true;\n                node.parent.insert(sibling, node.parent);\n              } else {\n                break;\n              }\n              sibling = sibling.next;\n            }\n            node.unwrap(node);\n            continue;\n          }\n          parents = [node];\n          for (parent = node.parent; parent && !schema.isValidChild(parent.name, node.name) && !nonSplitableElements[parent.name]; parent = parent.parent) {\n            parents.push(parent);\n          }\n          if (parent && parents.length > 1) {\n            parents.reverse();\n            newParent = currentNode = filterNode(parents[0].clone());\n            for (i = 0; i < parents.length - 1; i++) {\n              if (schema.isValidChild(currentNode.name, parents[i].name)) {\n                tempNode = filterNode(parents[i].clone());\n                currentNode.append(tempNode);\n              } else {\n                tempNode = currentNode;\n              }\n              for (childNode = parents[i].firstChild; childNode && childNode !== parents[i + 1];) {\n                nextNode = childNode.next;\n                tempNode.append(childNode);\n                childNode = nextNode;\n              }\n              currentNode = tempNode;\n            }\n            if (!isEmpty$2(schema, nonEmptyElements, whitespaceElements, newParent)) {\n              parent.insert(newParent, parents[0], true);\n              parent.insert(node, newParent);\n            } else {\n              parent.insert(node, parents[0], true);\n            }\n            parent = parents[0];\n            if (isEmpty$2(schema, nonEmptyElements, whitespaceElements, parent) || hasOnlyChild(parent, 'br')) {\n              parent.empty().remove();\n            }\n          } else if (node.parent) {\n            if (node.name === 'li') {\n              sibling = node.prev;\n              if (sibling && (sibling.name === 'ul' || sibling.name === 'ul')) {\n                sibling.append(node);\n                continue;\n              }\n              sibling = node.next;\n              if (sibling && (sibling.name === 'ul' || sibling.name === 'ul')) {\n                sibling.insert(node, sibling.firstChild, true);\n                continue;\n              }\n              node.wrap(filterNode(new Node$1('ul', 1)));\n              continue;\n            }\n            if (schema.isValidChild(node.parent.name, 'div') && schema.isValidChild('div', node.name)) {\n              node.wrap(filterNode(new Node$1('div', 1)));\n            } else {\n              if (specialElements[node.name]) {\n                node.empty().remove();\n              } else {\n                node.unwrap();\n              }\n            }\n          }\n        }\n      };\n      var filterNode = function (node) {\n        var i, name, list;\n        name = node.name;\n        if (name in nodeFilters) {\n          list = matchedNodes[name];\n          if (list) {\n            list.push(node);\n          } else {\n            matchedNodes[name] = [node];\n          }\n        }\n        i = attributeFilters.length;\n        while (i--) {\n          name = attributeFilters[i].name;\n          if (name in node.attributes.map) {\n            list = matchedAttributes[name];\n            if (list) {\n              list.push(node);\n            } else {\n              matchedAttributes[name] = [node];\n            }\n          }\n        }\n        return node;\n      };\n      var addNodeFilter = function (name, callback) {\n        each$i(explode$3(name), function (name) {\n          var list = nodeFilters[name];\n          if (!list) {\n            nodeFilters[name] = list = [];\n          }\n          list.push(callback);\n        });\n      };\n      var getNodeFilters = function () {\n        var out = [];\n        for (var name in nodeFilters) {\n          if (nodeFilters.hasOwnProperty(name)) {\n            out.push({\n              name: name,\n              callbacks: nodeFilters[name]\n            });\n          }\n        }\n        return out;\n      };\n      var addAttributeFilter = function (name, callback) {\n        each$i(explode$3(name), function (name) {\n          var i;\n          for (i = 0; i < attributeFilters.length; i++) {\n            if (attributeFilters[i].name === name) {\n              attributeFilters[i].callbacks.push(callback);\n              return;\n            }\n          }\n          attributeFilters.push({\n            name: name,\n            callbacks: [callback]\n          });\n        });\n      };\n      var getAttributeFilters = function () {\n        return [].concat(attributeFilters);\n      };\n      var parse = function (html, args) {\n        var parser, nodes, i, l, fi, fl, list, name;\n        var blockElements;\n        var invalidChildren = [];\n        var isInWhiteSpacePreservedElement;\n        var node;\n        args = args || {};\n        matchedNodes = {};\n        matchedAttributes = {};\n        blockElements = extend$3(makeMap$4('script,style,head,html,body,title,meta,param'), schema.getBlockElements());\n        var nonEmptyElements = schema.getNonEmptyElements();\n        var children = schema.children;\n        var validate = settings.validate;\n        var rootBlockName = 'forced_root_block' in args ? args.forced_root_block : settings.forced_root_block;\n        var whiteSpaceElements = schema.getWhiteSpaceElements();\n        var startWhiteSpaceRegExp = /^[ \\t\\r\\n]+/;\n        var endWhiteSpaceRegExp = /[ \\t\\r\\n]+$/;\n        var allWhiteSpaceRegExp = /[ \\t\\r\\n]+/g;\n        var isAllWhiteSpaceRegExp = /^[ \\t\\r\\n]+$/;\n        isInWhiteSpacePreservedElement = whiteSpaceElements.hasOwnProperty(args.context) || whiteSpaceElements.hasOwnProperty(settings.root_name);\n        var addRootBlocks = function () {\n          var node = rootNode.firstChild, next, rootBlockNode;\n          var trim = function (rootBlockNode) {\n            if (rootBlockNode) {\n              node = rootBlockNode.firstChild;\n              if (node && node.type === 3) {\n                node.value = node.value.replace(startWhiteSpaceRegExp, '');\n              }\n              node = rootBlockNode.lastChild;\n              if (node && node.type === 3) {\n                node.value = node.value.replace(endWhiteSpaceRegExp, '');\n              }\n            }\n          };\n          if (!schema.isValidChild(rootNode.name, rootBlockName.toLowerCase())) {\n            return;\n          }\n          while (node) {\n            next = node.next;\n            if (node.type === 3 || node.type === 1 && node.name !== 'p' && !blockElements[node.name] && !node.attr('data-mce-type')) {\n              if (!rootBlockNode) {\n                rootBlockNode = createNode(rootBlockName, 1);\n                rootBlockNode.attr(settings.forced_root_block_attrs);\n                rootNode.insert(rootBlockNode, node);\n                rootBlockNode.append(node);\n              } else {\n                rootBlockNode.append(node);\n              }\n            } else {\n              trim(rootBlockNode);\n              rootBlockNode = null;\n            }\n            node = next;\n          }\n          trim(rootBlockNode);\n        };\n        var createNode = function (name, type) {\n          var node = new Node$1(name, type);\n          var list;\n          if (name in nodeFilters) {\n            list = matchedNodes[name];\n            if (list) {\n              list.push(node);\n            } else {\n              matchedNodes[name] = [node];\n            }\n          }\n          return node;\n        };\n        var removeWhitespaceBefore = function (node) {\n          var textNode, textNodeNext, textVal, sibling;\n          var blockElements = schema.getBlockElements();\n          for (textNode = node.prev; textNode && textNode.type === 3;) {\n            textVal = textNode.value.replace(endWhiteSpaceRegExp, '');\n            if (textVal.length > 0) {\n              textNode.value = textVal;\n              return;\n            }\n            textNodeNext = textNode.next;\n            if (textNodeNext) {\n              if (textNodeNext.type === 3 && textNodeNext.value.length) {\n                textNode = textNode.prev;\n                continue;\n              }\n              if (!blockElements[textNodeNext.name] && textNodeNext.name !== 'script' && textNodeNext.name !== 'style') {\n                textNode = textNode.prev;\n                continue;\n              }\n            }\n            sibling = textNode.prev;\n            textNode.remove();\n            textNode = sibling;\n          }\n        };\n        var cloneAndExcludeBlocks = function (input) {\n          var name;\n          var output = {};\n          for (name in input) {\n            if (name !== 'li' && name !== 'p') {\n              output[name] = input[name];\n            }\n          }\n          return output;\n        };\n        parser = SaxParser$1({\n          validate: validate,\n          allow_script_urls: settings.allow_script_urls,\n          allow_conditional_comments: settings.allow_conditional_comments,\n          self_closing_elements: cloneAndExcludeBlocks(schema.getSelfClosingElements()),\n          cdata: function (text) {\n            node.append(createNode('#cdata', 4)).value = text;\n          },\n          text: function (text, raw) {\n            var textNode;\n            if (!isInWhiteSpacePreservedElement) {\n              text = text.replace(allWhiteSpaceRegExp, ' ');\n              if (isLineBreakNode(node.lastChild, blockElements)) {\n                text = text.replace(startWhiteSpaceRegExp, '');\n              }\n            }\n            if (text.length !== 0) {\n              textNode = createNode('#text', 3);\n              textNode.raw = !!raw;\n              node.append(textNode).value = text;\n            }\n          },\n          comment: function (text) {\n            node.append(createNode('#comment', 8)).value = text;\n          },\n          pi: function (name, text) {\n            node.append(createNode(name, 7)).value = text;\n            removeWhitespaceBefore(node);\n          },\n          doctype: function (text) {\n            var newNode;\n            newNode = node.append(createNode('#doctype', 10));\n            newNode.value = text;\n            removeWhitespaceBefore(node);\n          },\n          start: function (name, attrs, empty) {\n            var newNode, attrFiltersLen, elementRule, attrName, parent;\n            elementRule = validate ? schema.getElementRule(name) : {};\n            if (elementRule) {\n              newNode = createNode(elementRule.outputName || name, 1);\n              newNode.attributes = attrs;\n              newNode.shortEnded = empty;\n              node.append(newNode);\n              parent = children[node.name];\n              if (parent && children[newNode.name] && !parent[newNode.name]) {\n                invalidChildren.push(newNode);\n              }\n              attrFiltersLen = attributeFilters.length;\n              while (attrFiltersLen--) {\n                attrName = attributeFilters[attrFiltersLen].name;\n                if (attrName in attrs.map) {\n                  list = matchedAttributes[attrName];\n                  if (list) {\n                    list.push(newNode);\n                  } else {\n                    matchedAttributes[attrName] = [newNode];\n                  }\n                }\n              }\n              if (blockElements[name]) {\n                removeWhitespaceBefore(newNode);\n              }\n              if (!empty) {\n                node = newNode;\n              }\n              if (!isInWhiteSpacePreservedElement && whiteSpaceElements[name]) {\n                isInWhiteSpacePreservedElement = true;\n              }\n            }\n          },\n          end: function (name) {\n            var textNode, elementRule, text, sibling, tempNode;\n            elementRule = validate ? schema.getElementRule(name) : {};\n            if (elementRule) {\n              if (blockElements[name]) {\n                if (!isInWhiteSpacePreservedElement) {\n                  textNode = node.firstChild;\n                  if (textNode && textNode.type === 3) {\n                    text = textNode.value.replace(startWhiteSpaceRegExp, '');\n                    if (text.length > 0) {\n                      textNode.value = text;\n                      textNode = textNode.next;\n                    } else {\n                      sibling = textNode.next;\n                      textNode.remove();\n                      textNode = sibling;\n                      while (textNode && textNode.type === 3) {\n                        text = textNode.value;\n                        sibling = textNode.next;\n                        if (text.length === 0 || isAllWhiteSpaceRegExp.test(text)) {\n                          textNode.remove();\n                          textNode = sibling;\n                        }\n                        textNode = sibling;\n                      }\n                    }\n                  }\n                  textNode = node.lastChild;\n                  if (textNode && textNode.type === 3) {\n                    text = textNode.value.replace(endWhiteSpaceRegExp, '');\n                    if (text.length > 0) {\n                      textNode.value = text;\n                      textNode = textNode.prev;\n                    } else {\n                      sibling = textNode.prev;\n                      textNode.remove();\n                      textNode = sibling;\n                      while (textNode && textNode.type === 3) {\n                        text = textNode.value;\n                        sibling = textNode.prev;\n                        if (text.length === 0 || isAllWhiteSpaceRegExp.test(text)) {\n                          textNode.remove();\n                          textNode = sibling;\n                        }\n                        textNode = sibling;\n                      }\n                    }\n                  }\n                }\n              }\n              if (isInWhiteSpacePreservedElement && whiteSpaceElements[name]) {\n                isInWhiteSpacePreservedElement = false;\n              }\n              if (elementRule.removeEmpty && isEmpty$2(schema, nonEmptyElements, whiteSpaceElements, node)) {\n                if (!node.attributes.map.name && !node.attr('id')) {\n                  tempNode = node.parent;\n                  if (blockElements[node.name]) {\n                    node.empty().remove();\n                  } else {\n                    node.unwrap();\n                  }\n                  node = tempNode;\n                  return;\n                }\n              }\n              if (elementRule.paddEmpty && (isPaddedWithNbsp(node) || isEmpty$2(schema, nonEmptyElements, whiteSpaceElements, node))) {\n                paddEmptyNode(settings, args, blockElements, node);\n              }\n              node = node.parent;\n            }\n          }\n        }, schema);\n        var rootNode = node = new Node$1(args.context || settings.root_name, 11);\n        parser.parse(html);\n        if (validate && invalidChildren.length) {\n          if (!args.context) {\n            fixInvalidChildren(invalidChildren);\n          } else {\n            args.invalid = true;\n          }\n        }\n        if (rootBlockName && (rootNode.name === 'body' || args.isRootContent)) {\n          addRootBlocks();\n        }\n        if (!args.invalid) {\n          for (name in matchedNodes) {\n            list = nodeFilters[name];\n            nodes = matchedNodes[name];\n            fi = nodes.length;\n            while (fi--) {\n              if (!nodes[fi].parent) {\n                nodes.splice(fi, 1);\n              }\n            }\n            for (i = 0, l = list.length; i < l; i++) {\n              list[i](nodes, name, args);\n            }\n          }\n          for (i = 0, l = attributeFilters.length; i < l; i++) {\n            list = attributeFilters[i];\n            if (list.name in matchedAttributes) {\n              nodes = matchedAttributes[list.name];\n              fi = nodes.length;\n              while (fi--) {\n                if (!nodes[fi].parent) {\n                  nodes.splice(fi, 1);\n                }\n              }\n              for (fi = 0, fl = list.callbacks.length; fi < fl; fi++) {\n                list.callbacks[fi](nodes, list.name, args);\n              }\n            }\n          }\n        }\n        return rootNode;\n      };\n      var exports = {\n        schema: schema,\n        addAttributeFilter: addAttributeFilter,\n        getAttributeFilters: getAttributeFilters,\n        addNodeFilter: addNodeFilter,\n        getNodeFilters: getNodeFilters,\n        filterNode: filterNode,\n        parse: parse\n      };\n      register$2(exports, settings);\n      LegacyFilter.register(exports, settings);\n      return exports;\n    }\n\n    var addTempAttr = function (htmlParser, tempAttrs, name) {\n      if (Tools.inArray(tempAttrs, name) === -1) {\n        htmlParser.addAttributeFilter(name, function (nodes, name) {\n          var i = nodes.length;\n          while (i--) {\n            nodes[i].attr(name, null);\n          }\n        });\n        tempAttrs.push(name);\n      }\n    };\n    var postProcess$1 = function (editor, args, content) {\n      if (!args.no_events && editor) {\n        var outArgs = Events.firePostProcess(editor, merge(args, { content: content }));\n        return outArgs.content;\n      } else {\n        return content;\n      }\n    };\n    var getHtmlFromNode = function (dom, node, args) {\n      var html = Zwsp.trim(args.getInner ? node.innerHTML : dom.getOuterHTML(node));\n      return args.selection || isWsPreserveElement(Element.fromDom(node)) ? html : Tools.trim(html);\n    };\n    var parseHtml = function (htmlParser, html, args) {\n      var parserArgs = args.selection ? merge({ forced_root_block: false }, args) : args;\n      var rootNode = htmlParser.parse(html, parserArgs);\n      DomSerializerFilters.trimTrailingBr(rootNode);\n      return rootNode;\n    };\n    var serializeNode = function (settings, schema, node) {\n      var htmlSerializer = HtmlSerializer(settings, schema);\n      return htmlSerializer.serialize(node);\n    };\n    var toHtml = function (editor, settings, schema, rootNode, args) {\n      var content = serializeNode(settings, schema, rootNode);\n      return postProcess$1(editor, args, content);\n    };\n    function DomSerializer (settings, editor) {\n      var dom, schema, htmlParser;\n      var tempAttrs = ['data-mce-selected'];\n      dom = editor && editor.dom ? editor.dom : DOMUtils$1.DOM;\n      schema = editor && editor.schema ? editor.schema : Schema(settings);\n      settings.entity_encoding = settings.entity_encoding || 'named';\n      settings.remove_trailing_brs = 'remove_trailing_brs' in settings ? settings.remove_trailing_brs : true;\n      htmlParser = DomParser(settings, schema);\n      DomSerializerFilters.register(htmlParser, settings, dom);\n      var serialize = function (node, parserArgs) {\n        var args = merge({ format: 'html' }, parserArgs ? parserArgs : {});\n        var targetNode = DomSerializerPreProcess.process(editor, node, args);\n        var html = getHtmlFromNode(dom, targetNode, args);\n        var rootNode = parseHtml(htmlParser, html, args);\n        return args.format === 'tree' ? rootNode : toHtml(editor, settings, schema, rootNode, args);\n      };\n      return {\n        schema: schema,\n        addNodeFilter: htmlParser.addNodeFilter,\n        addAttributeFilter: htmlParser.addAttributeFilter,\n        serialize: serialize,\n        addRules: function (rules) {\n          schema.addValidElements(rules);\n        },\n        setRules: function (rules) {\n          schema.setValidElements(rules);\n        },\n        addTempAttr: curry(addTempAttr, htmlParser, tempAttrs),\n        getTempAttrs: function () {\n          return tempAttrs;\n        }\n      };\n    }\n\n    function DomSerializer$1 (settings, editor) {\n      var domSerializer = DomSerializer(settings, editor);\n      return {\n        schema: domSerializer.schema,\n        addNodeFilter: domSerializer.addNodeFilter,\n        addAttributeFilter: domSerializer.addAttributeFilter,\n        serialize: domSerializer.serialize,\n        addRules: domSerializer.addRules,\n        setRules: domSerializer.setRules,\n        addTempAttr: domSerializer.addTempAttr,\n        getTempAttrs: domSerializer.getTempAttrs\n      };\n    }\n\n    function BookmarkManager(selection) {\n      return {\n        getBookmark: curry(Bookmarks.getBookmark, selection),\n        moveToBookmark: curry(Bookmarks.moveToBookmark, selection)\n      };\n    }\n    (function (BookmarkManager) {\n      BookmarkManager.isBookmarkNode = Bookmarks.isBookmarkNode;\n    }(BookmarkManager || (BookmarkManager = {})));\n    var BookmarkManager$1 = BookmarkManager;\n\n    var isContentEditableFalse$a = NodeType.isContentEditableFalse;\n    var isContentEditableTrue$5 = NodeType.isContentEditableTrue;\n    var getContentEditableRoot$2 = function (root, node) {\n      while (node && node !== root) {\n        if (isContentEditableTrue$5(node) || isContentEditableFalse$a(node)) {\n          return node;\n        }\n        node = node.parentNode;\n      }\n      return null;\n    };\n    var ControlSelection = function (selection, editor) {\n      var dom = editor.dom, each = Tools.each;\n      var selectedElm, selectedElmGhost, resizeHelper, resizeHandles, selectedHandle;\n      var startX, startY, selectedElmX, selectedElmY, startW, startH, ratio, resizeStarted;\n      var width, height;\n      var editableDoc = editor.getDoc(), rootDocument = domGlobals.document;\n      var abs = Math.abs, round = Math.round, rootElement = editor.getBody();\n      var startScrollWidth, startScrollHeight;\n      resizeHandles = {\n        nw: [\n          0,\n          0,\n          -1,\n          -1\n        ],\n        ne: [\n          1,\n          0,\n          1,\n          -1\n        ],\n        se: [\n          1,\n          1,\n          1,\n          1\n        ],\n        sw: [\n          0,\n          1,\n          -1,\n          1\n        ]\n      };\n      var rootClass = '.mce-content-body';\n      editor.contentStyles.push(rootClass + ' div.mce-resizehandle {' + 'position: absolute;' + 'border: 1px solid black;' + 'box-sizing: content-box;' + 'background: #FFF;' + 'width: 7px;' + 'height: 7px;' + 'z-index: 10000' + '}' + rootClass + ' .mce-resizehandle:hover {' + 'background: #000' + '}' + rootClass + ' img[data-mce-selected],' + rootClass + ' hr[data-mce-selected] {' + 'outline: 1px solid black;' + 'resize: none' + '}' + rootClass + ' .mce-clonedresizable {' + 'position: absolute;' + (Env.gecko ? '' : 'outline: 1px dashed black;') + 'opacity: .5;' + 'filter: alpha(opacity=50);' + 'z-index: 10000' + '}' + rootClass + ' .mce-resize-helper {' + 'background: #555;' + 'background: rgba(0,0,0,0.75);' + 'border-radius: 3px;' + 'border: 1px;' + 'color: white;' + 'display: none;' + 'font-family: sans-serif;' + 'font-size: 12px;' + 'white-space: nowrap;' + 'line-height: 14px;' + 'margin: 5px 10px;' + 'padding: 5px;' + 'position: absolute;' + 'z-index: 10001' + '}');\n      var isImage = function (elm) {\n        return elm && (elm.nodeName === 'IMG' || editor.dom.is(elm, 'figure.image'));\n      };\n      var isEventOnImageOutsideRange = function (evt, range) {\n        return isImage(evt.target) && !RangePoint.isXYWithinRange(evt.clientX, evt.clientY, range);\n      };\n      var contextMenuSelectImage = function (evt) {\n        var target = evt.target;\n        if (isEventOnImageOutsideRange(evt, editor.selection.getRng()) && !evt.isDefaultPrevented()) {\n          editor.selection.select(target);\n        }\n      };\n      var getResizeTarget = function (elm) {\n        return editor.dom.is(elm, 'figure.image') ? elm.querySelector('img') : elm;\n      };\n      var isResizable = function (elm) {\n        var selector = editor.settings.object_resizing;\n        if (selector === false || Env.iOS) {\n          return false;\n        }\n        if (typeof selector !== 'string') {\n          selector = 'table,img,figure.image,div';\n        }\n        if (elm.getAttribute('data-mce-resize') === 'false') {\n          return false;\n        }\n        if (elm === editor.getBody()) {\n          return false;\n        }\n        return is$1(Element.fromDom(elm), selector);\n      };\n      var resizeGhostElement = function (e) {\n        var deltaX, deltaY, proportional;\n        var resizeHelperX, resizeHelperY;\n        deltaX = e.screenX - startX;\n        deltaY = e.screenY - startY;\n        width = deltaX * selectedHandle[2] + startW;\n        height = deltaY * selectedHandle[3] + startH;\n        width = width < 5 ? 5 : width;\n        height = height < 5 ? 5 : height;\n        if (isImage(selectedElm) && editor.settings.resize_img_proportional !== false) {\n          proportional = !VK.modifierPressed(e);\n        } else {\n          proportional = VK.modifierPressed(e) || isImage(selectedElm) && selectedHandle[2] * selectedHandle[3] !== 0;\n        }\n        if (proportional) {\n          if (abs(deltaX) > abs(deltaY)) {\n            height = round(width * ratio);\n            width = round(height / ratio);\n          } else {\n            width = round(height / ratio);\n            height = round(width * ratio);\n          }\n        }\n        dom.setStyles(getResizeTarget(selectedElmGhost), {\n          width: width,\n          height: height\n        });\n        resizeHelperX = selectedHandle.startPos.x + deltaX;\n        resizeHelperY = selectedHandle.startPos.y + deltaY;\n        resizeHelperX = resizeHelperX > 0 ? resizeHelperX : 0;\n        resizeHelperY = resizeHelperY > 0 ? resizeHelperY : 0;\n        dom.setStyles(resizeHelper, {\n          left: resizeHelperX,\n          top: resizeHelperY,\n          display: 'block'\n        });\n        resizeHelper.innerHTML = width + ' &times; ' + height;\n        if (selectedHandle[2] < 0 && selectedElmGhost.clientWidth <= width) {\n          dom.setStyle(selectedElmGhost, 'left', selectedElmX + (startW - width));\n        }\n        if (selectedHandle[3] < 0 && selectedElmGhost.clientHeight <= height) {\n          dom.setStyle(selectedElmGhost, 'top', selectedElmY + (startH - height));\n        }\n        deltaX = rootElement.scrollWidth - startScrollWidth;\n        deltaY = rootElement.scrollHeight - startScrollHeight;\n        if (deltaX + deltaY !== 0) {\n          dom.setStyles(resizeHelper, {\n            left: resizeHelperX - deltaX,\n            top: resizeHelperY - deltaY\n          });\n        }\n        if (!resizeStarted) {\n          Events.fireObjectResizeStart(editor, selectedElm, startW, startH);\n          resizeStarted = true;\n        }\n      };\n      var endGhostResize = function () {\n        resizeStarted = false;\n        var setSizeProp = function (name, value) {\n          if (value) {\n            if (selectedElm.style[name] || !editor.schema.isValid(selectedElm.nodeName.toLowerCase(), name)) {\n              dom.setStyle(getResizeTarget(selectedElm), name, value);\n            } else {\n              dom.setAttrib(getResizeTarget(selectedElm), name, value);\n            }\n          }\n        };\n        setSizeProp('width', width);\n        setSizeProp('height', height);\n        dom.unbind(editableDoc, 'mousemove', resizeGhostElement);\n        dom.unbind(editableDoc, 'mouseup', endGhostResize);\n        if (rootDocument !== editableDoc) {\n          dom.unbind(rootDocument, 'mousemove', resizeGhostElement);\n          dom.unbind(rootDocument, 'mouseup', endGhostResize);\n        }\n        dom.remove(selectedElmGhost);\n        dom.remove(resizeHelper);\n        showResizeRect(selectedElm);\n        Events.fireObjectResized(editor, selectedElm, width, height);\n        dom.setAttrib(selectedElm, 'style', dom.getAttrib(selectedElm, 'style'));\n        editor.nodeChanged();\n      };\n      var showResizeRect = function (targetElm) {\n        var position, targetWidth, targetHeight, e, rect;\n        hideResizeRect();\n        unbindResizeHandleEvents();\n        position = dom.getPos(targetElm, rootElement);\n        selectedElmX = position.x;\n        selectedElmY = position.y;\n        rect = targetElm.getBoundingClientRect();\n        targetWidth = rect.width || rect.right - rect.left;\n        targetHeight = rect.height || rect.bottom - rect.top;\n        if (selectedElm !== targetElm) {\n          selectedElm = targetElm;\n          width = height = 0;\n        }\n        e = editor.fire('ObjectSelected', { target: targetElm });\n        if (isResizable(targetElm) && !e.isDefaultPrevented()) {\n          each(resizeHandles, function (handle, name) {\n            var handleElm;\n            var startDrag = function (e) {\n              startX = e.screenX;\n              startY = e.screenY;\n              startW = getResizeTarget(selectedElm).clientWidth;\n              startH = getResizeTarget(selectedElm).clientHeight;\n              ratio = startH / startW;\n              selectedHandle = handle;\n              handle.startPos = {\n                x: targetWidth * handle[0] + selectedElmX,\n                y: targetHeight * handle[1] + selectedElmY\n              };\n              startScrollWidth = rootElement.scrollWidth;\n              startScrollHeight = rootElement.scrollHeight;\n              selectedElmGhost = selectedElm.cloneNode(true);\n              dom.addClass(selectedElmGhost, 'mce-clonedresizable');\n              dom.setAttrib(selectedElmGhost, 'data-mce-bogus', 'all');\n              selectedElmGhost.contentEditable = false;\n              selectedElmGhost.unSelectabe = true;\n              dom.setStyles(selectedElmGhost, {\n                left: selectedElmX,\n                top: selectedElmY,\n                margin: 0\n              });\n              selectedElmGhost.removeAttribute('data-mce-selected');\n              rootElement.appendChild(selectedElmGhost);\n              dom.bind(editableDoc, 'mousemove', resizeGhostElement);\n              dom.bind(editableDoc, 'mouseup', endGhostResize);\n              if (rootDocument !== editableDoc) {\n                dom.bind(rootDocument, 'mousemove', resizeGhostElement);\n                dom.bind(rootDocument, 'mouseup', endGhostResize);\n              }\n              resizeHelper = dom.add(rootElement, 'div', {\n                'class': 'mce-resize-helper',\n                'data-mce-bogus': 'all'\n              }, startW + ' &times; ' + startH);\n            };\n            handleElm = dom.get('mceResizeHandle' + name);\n            if (handleElm) {\n              dom.remove(handleElm);\n            }\n            handleElm = dom.add(rootElement, 'div', {\n              'id': 'mceResizeHandle' + name,\n              'data-mce-bogus': 'all',\n              'class': 'mce-resizehandle',\n              'unselectable': true,\n              'style': 'cursor:' + name + '-resize; margin:0; padding:0'\n            });\n            if (Env.ie === 11) {\n              handleElm.contentEditable = false;\n            }\n            dom.bind(handleElm, 'mousedown', function (e) {\n              e.stopImmediatePropagation();\n              e.preventDefault();\n              startDrag(e);\n            });\n            handle.elm = handleElm;\n            dom.setStyles(handleElm, {\n              left: targetWidth * handle[0] + selectedElmX - handleElm.offsetWidth / 2,\n              top: targetHeight * handle[1] + selectedElmY - handleElm.offsetHeight / 2\n            });\n          });\n        } else {\n          hideResizeRect();\n        }\n        selectedElm.setAttribute('data-mce-selected', '1');\n      };\n      var hideResizeRect = function () {\n        var name, handleElm;\n        unbindResizeHandleEvents();\n        if (selectedElm) {\n          selectedElm.removeAttribute('data-mce-selected');\n        }\n        for (name in resizeHandles) {\n          handleElm = dom.get('mceResizeHandle' + name);\n          if (handleElm) {\n            dom.unbind(handleElm);\n            dom.remove(handleElm);\n          }\n        }\n      };\n      var updateResizeRect = function (e) {\n        var startElm, controlElm;\n        var isChildOrEqual = function (node, parent) {\n          if (node) {\n            do {\n              if (node === parent) {\n                return true;\n              }\n            } while (node = node.parentNode);\n          }\n        };\n        if (resizeStarted || editor.removed) {\n          return;\n        }\n        each(dom.select('img[data-mce-selected],hr[data-mce-selected]'), function (img) {\n          img.removeAttribute('data-mce-selected');\n        });\n        controlElm = e.type === 'mousedown' ? e.target : selection.getNode();\n        controlElm = dom.$(controlElm).closest('table,img,figure.image,hr')[0];\n        if (isChildOrEqual(controlElm, rootElement)) {\n          disableGeckoResize();\n          startElm = selection.getStart(true);\n          if (isChildOrEqual(startElm, controlElm) && isChildOrEqual(selection.getEnd(true), controlElm)) {\n            showResizeRect(controlElm);\n            return;\n          }\n        }\n        hideResizeRect();\n      };\n      var isWithinContentEditableFalse = function (elm) {\n        return isContentEditableFalse$a(getContentEditableRoot$2(editor.getBody(), elm));\n      };\n      var unbindResizeHandleEvents = function () {\n        for (var name in resizeHandles) {\n          var handle = resizeHandles[name];\n          if (handle.elm) {\n            dom.unbind(handle.elm);\n            delete handle.elm;\n          }\n        }\n      };\n      var disableGeckoResize = function () {\n        try {\n          editor.getDoc().execCommand('enableObjectResizing', false, false);\n        } catch (ex) {\n        }\n      };\n      editor.on('init', function () {\n        disableGeckoResize();\n        if (Env.ie && Env.ie >= 11) {\n          editor.on('mousedown click', function (e) {\n            var target = e.target, nodeName = target.nodeName;\n            if (!resizeStarted && /^(TABLE|IMG|HR)$/.test(nodeName) && !isWithinContentEditableFalse(target)) {\n              if (e.button !== 2) {\n                editor.selection.select(target, nodeName === 'TABLE');\n              }\n              if (e.type === 'mousedown') {\n                editor.nodeChanged();\n              }\n            }\n          });\n          editor.dom.bind(rootElement, 'mscontrolselect', function (e) {\n            var delayedSelect = function (node) {\n              Delay.setEditorTimeout(editor, function () {\n                editor.selection.select(node);\n              });\n            };\n            if (isWithinContentEditableFalse(e.target)) {\n              e.preventDefault();\n              delayedSelect(e.target);\n              return;\n            }\n            if (/^(TABLE|IMG|HR)$/.test(e.target.nodeName)) {\n              e.preventDefault();\n              if (e.target.tagName === 'IMG') {\n                delayedSelect(e.target);\n              }\n            }\n          });\n        }\n        var throttledUpdateResizeRect = Delay.throttle(function (e) {\n          if (!editor.composing) {\n            updateResizeRect(e);\n          }\n        });\n        editor.on('nodechange ResizeEditor ResizeWindow drop FullscreenStateChanged', throttledUpdateResizeRect);\n        editor.on('keyup compositionend', function (e) {\n          if (selectedElm && selectedElm.nodeName === 'TABLE') {\n            throttledUpdateResizeRect(e);\n          }\n        });\n        editor.on('hide blur', hideResizeRect);\n        editor.on('contextmenu', contextMenuSelectImage);\n      });\n      editor.on('remove', unbindResizeHandleEvents);\n      var destroy = function () {\n        selectedElm = selectedElmGhost = null;\n      };\n      return {\n        isResizable: isResizable,\n        showResizeRect: showResizeRect,\n        hideResizeRect: hideResizeRect,\n        updateResizeRect: updateResizeRect,\n        destroy: destroy\n      };\n    };\n\n    var hasCeProperty = function (node) {\n      return NodeType.isContentEditableTrue(node) || NodeType.isContentEditableFalse(node);\n    };\n    var findParent$1 = function (node, rootNode, predicate) {\n      while (node && node !== rootNode) {\n        if (predicate(node)) {\n          return node;\n        }\n        node = node.parentNode;\n      }\n      return null;\n    };\n    var findClosestIeRange = function (clientX, clientY, doc) {\n      var element, rng, rects;\n      element = doc.elementFromPoint(clientX, clientY);\n      rng = doc.body.createTextRange();\n      if (!element || element.tagName === 'HTML') {\n        element = doc.body;\n      }\n      rng.moveToElementText(element);\n      rects = Tools.toArray(rng.getClientRects());\n      rects = rects.sort(function (a, b) {\n        a = Math.abs(Math.max(a.top - clientY, a.bottom - clientY));\n        b = Math.abs(Math.max(b.top - clientY, b.bottom - clientY));\n        return a - b;\n      });\n      if (rects.length > 0) {\n        clientY = (rects[0].bottom + rects[0].top) / 2;\n        try {\n          rng.moveToPoint(clientX, clientY);\n          rng.collapse(true);\n          return rng;\n        } catch (ex) {\n        }\n      }\n      return null;\n    };\n    var moveOutOfContentEditableFalse = function (rng, rootNode) {\n      var parentElement = rng && rng.parentElement ? rng.parentElement() : null;\n      return NodeType.isContentEditableFalse(findParent$1(parentElement, rootNode, hasCeProperty)) ? null : rng;\n    };\n    var fromPoint$1 = function (clientX, clientY, doc) {\n      var rng, point;\n      var pointDoc = doc;\n      if (pointDoc.caretPositionFromPoint) {\n        point = pointDoc.caretPositionFromPoint(clientX, clientY);\n        if (point) {\n          rng = doc.createRange();\n          rng.setStart(point.offsetNode, point.offset);\n          rng.collapse(true);\n        }\n      } else if (doc.caretRangeFromPoint) {\n        rng = doc.caretRangeFromPoint(clientX, clientY);\n      } else if (pointDoc.body.createTextRange) {\n        rng = pointDoc.body.createTextRange();\n        try {\n          rng.moveToPoint(clientX, clientY);\n          rng.collapse(true);\n        } catch (ex) {\n          rng = findClosestIeRange(clientX, clientY, doc);\n        }\n        return moveOutOfContentEditableFalse(rng, doc.body);\n      }\n      return rng;\n    };\n    var CaretRangeFromPoint = { fromPoint: fromPoint$1 };\n\n    var processRanges = function (editor, ranges) {\n      return map(ranges, function (range) {\n        var evt = editor.fire('GetSelectionRange', { range: range });\n        return evt.range !== range ? evt.range : range;\n      });\n    };\n    var EventProcessRanges = { processRanges: processRanges };\n\n    var fromElements = function (elements, scope) {\n      var doc = scope || domGlobals.document;\n      var fragment = doc.createDocumentFragment();\n      each(elements, function (element) {\n        fragment.appendChild(element.dom());\n      });\n      return Element.fromDom(fragment);\n    };\n\n    var tableModel = Immutable('element', 'width', 'rows');\n    var tableRow = Immutable('element', 'cells');\n    var cellPosition = Immutable('x', 'y');\n    var getSpan = function (td, key) {\n      var value = parseInt(get(td, key), 10);\n      return isNaN(value) ? 1 : value;\n    };\n    var fillout = function (table, x, y, tr, td) {\n      var rowspan = getSpan(td, 'rowspan');\n      var colspan = getSpan(td, 'colspan');\n      var rows = table.rows();\n      for (var y2 = y; y2 < y + rowspan; y2++) {\n        if (!rows[y2]) {\n          rows[y2] = tableRow(deep(tr), []);\n        }\n        for (var x2 = x; x2 < x + colspan; x2++) {\n          var cells = rows[y2].cells();\n          cells[x2] = y2 === y && x2 === x ? td : shallow(td);\n        }\n      }\n    };\n    var cellExists = function (table, x, y) {\n      var rows = table.rows();\n      var cells = rows[y] ? rows[y].cells() : [];\n      return !!cells[x];\n    };\n    var skipCellsX = function (table, x, y) {\n      while (cellExists(table, x, y)) {\n        x++;\n      }\n      return x;\n    };\n    var getWidth = function (rows) {\n      return foldl(rows, function (acc, row) {\n        return row.cells().length > acc ? row.cells().length : acc;\n      }, 0);\n    };\n    var findElementPos = function (table, element) {\n      var rows = table.rows();\n      for (var y = 0; y < rows.length; y++) {\n        var cells = rows[y].cells();\n        for (var x = 0; x < cells.length; x++) {\n          if (eq(cells[x], element)) {\n            return Option.some(cellPosition(x, y));\n          }\n        }\n      }\n      return Option.none();\n    };\n    var extractRows = function (table, sx, sy, ex, ey) {\n      var newRows = [];\n      var rows = table.rows();\n      for (var y = sy; y <= ey; y++) {\n        var cells = rows[y].cells();\n        var slice = sx < ex ? cells.slice(sx, ex + 1) : cells.slice(ex, sx + 1);\n        newRows.push(tableRow(rows[y].element(), slice));\n      }\n      return newRows;\n    };\n    var subTable = function (table, startPos, endPos) {\n      var sx = startPos.x(), sy = startPos.y();\n      var ex = endPos.x(), ey = endPos.y();\n      var newRows = sy < ey ? extractRows(table, sx, sy, ex, ey) : extractRows(table, sx, ey, ex, sy);\n      return tableModel(table.element(), getWidth(newRows), newRows);\n    };\n    var createDomTable = function (table, rows) {\n      var tableElement = shallow(table.element());\n      var tableBody = Element.fromTag('tbody');\n      append$1(tableBody, rows);\n      append(tableElement, tableBody);\n      return tableElement;\n    };\n    var modelRowsToDomRows = function (table) {\n      return map(table.rows(), function (row) {\n        var cells = map(row.cells(), function (cell) {\n          var td = deep(cell);\n          remove(td, 'colspan');\n          remove(td, 'rowspan');\n          return td;\n        });\n        var tr = shallow(row.element());\n        append$1(tr, cells);\n        return tr;\n      });\n    };\n    var fromDom$1 = function (tableElm) {\n      var table = tableModel(shallow(tableElm), 0, []);\n      each(descendants$1(tableElm, 'tr'), function (tr, y) {\n        each(descendants$1(tr, 'td,th'), function (td, x) {\n          fillout(table, skipCellsX(table, x, y), y, tr, td);\n        });\n      });\n      return tableModel(table.element(), getWidth(table.rows()), table.rows());\n    };\n    var toDom = function (table) {\n      return createDomTable(table, modelRowsToDomRows(table));\n    };\n    var subsection = function (table, startElement, endElement) {\n      return findElementPos(table, startElement).bind(function (startPos) {\n        return findElementPos(table, endElement).map(function (endPos) {\n          return subTable(table, startPos, endPos);\n        });\n      });\n    };\n    var SimpleTableModel = {\n      fromDom: fromDom$1,\n      toDom: toDom,\n      subsection: subsection\n    };\n\n    var findParentListContainer = function (parents) {\n      return find(parents, function (elm) {\n        return name(elm) === 'ul' || name(elm) === 'ol';\n      });\n    };\n    var getFullySelectedListWrappers = function (parents, rng) {\n      return find(parents, function (elm) {\n        return name(elm) === 'li' && hasAllContentsSelected(elm, rng);\n      }).fold(constant([]), function (li) {\n        return findParentListContainer(parents).map(function (listCont) {\n          return [\n            Element.fromTag('li'),\n            Element.fromTag(name(listCont))\n          ];\n        }).getOr([]);\n      });\n    };\n    var wrap$3 = function (innerElm, elms) {\n      var wrapped = foldl(elms, function (acc, elm) {\n        append(elm, acc);\n        return elm;\n      }, innerElm);\n      return elms.length > 0 ? fromElements([wrapped]) : wrapped;\n    };\n    var directListWrappers = function (commonAnchorContainer) {\n      if (isListItem(commonAnchorContainer)) {\n        return parent(commonAnchorContainer).filter(isList).fold(constant([]), function (listElm) {\n          return [\n            commonAnchorContainer,\n            listElm\n          ];\n        });\n      } else {\n        return isList(commonAnchorContainer) ? [commonAnchorContainer] : [];\n      }\n    };\n    var getWrapElements = function (rootNode, rng) {\n      var commonAnchorContainer = Element.fromDom(rng.commonAncestorContainer);\n      var parents = Parents.parentsAndSelf(commonAnchorContainer, rootNode);\n      var wrapElements = filter(parents, function (elm) {\n        return isInline(elm) || isHeading(elm);\n      });\n      var listWrappers = getFullySelectedListWrappers(parents, rng);\n      var allWrappers = wrapElements.concat(listWrappers.length ? listWrappers : directListWrappers(commonAnchorContainer));\n      return map(allWrappers, shallow);\n    };\n    var emptyFragment = function () {\n      return fromElements([]);\n    };\n    var getFragmentFromRange = function (rootNode, rng) {\n      return wrap$3(Element.fromDom(rng.cloneContents()), getWrapElements(rootNode, rng));\n    };\n    var getParentTable = function (rootElm, cell) {\n      return ancestor$1(cell, 'table', curry(eq, rootElm));\n    };\n    var getTableFragment = function (rootNode, selectedTableCells) {\n      return getParentTable(rootNode, selectedTableCells[0]).bind(function (tableElm) {\n        var firstCell = selectedTableCells[0];\n        var lastCell = selectedTableCells[selectedTableCells.length - 1];\n        var fullTableModel = SimpleTableModel.fromDom(tableElm);\n        return SimpleTableModel.subsection(fullTableModel, firstCell, lastCell).map(function (sectionedTableModel) {\n          return fromElements([SimpleTableModel.toDom(sectionedTableModel)]);\n        });\n      }).getOrThunk(emptyFragment);\n    };\n    var getSelectionFragment = function (rootNode, ranges) {\n      return ranges.length > 0 && ranges[0].collapsed ? emptyFragment() : getFragmentFromRange(rootNode, ranges[0]);\n    };\n    var read$4 = function (rootNode, ranges) {\n      var selectedCells = TableCellSelection.getCellsFromElementOrRanges(ranges, rootNode);\n      return selectedCells.length > 0 ? getTableFragment(rootNode, selectedCells) : getSelectionFragment(rootNode, ranges);\n    };\n    var FragmentReader = { read: read$4 };\n\n    var getTextContent = function (editor) {\n      return Option.from(editor.selection.getRng()).map(function (rng) {\n        var bin = editor.dom.add(editor.getBody(), 'div', {\n          'data-mce-bogus': 'all',\n          'style': 'overflow: hidden; opacity: 0;'\n        }, rng.cloneContents());\n        var text = Zwsp.trim(bin.innerText);\n        editor.dom.remove(bin);\n        return text;\n      }).getOr('');\n    };\n    var getHtmlContent = function (editor, args) {\n      var rng = editor.selection.getRng(), tmpElm = editor.dom.create('body');\n      var sel = editor.selection.getSel();\n      var fragment;\n      var ranges = EventProcessRanges.processRanges(editor, MultiRange.getRanges(sel));\n      fragment = args.contextual ? FragmentReader.read(Element.fromDom(editor.getBody()), ranges).dom() : rng.cloneContents();\n      if (fragment) {\n        tmpElm.appendChild(fragment);\n      }\n      return editor.selection.serializer.serialize(tmpElm, args);\n    };\n    var getContent = function (editor, args) {\n      if (args === void 0) {\n        args = {};\n      }\n      args.get = true;\n      args.format = args.format || 'html';\n      args.selection = true;\n      args = editor.fire('BeforeGetContent', args);\n      if (args.isDefaultPrevented()) {\n        editor.fire('GetContent', args);\n        return args.content;\n      }\n      if (args.format === 'text') {\n        return getTextContent(editor);\n      } else {\n        args.getInner = true;\n        var content = getHtmlContent(editor, args);\n        if (args.format === 'tree') {\n          return content;\n        } else {\n          args.content = editor.selection.isCollapsed() ? '' : content;\n          editor.fire('GetContent', args);\n          return args.content;\n        }\n      }\n    };\n    var GetSelectionContent = { getContent: getContent };\n\n    var setupArgs = function (args, content) {\n      return __assign(__assign({ format: 'html' }, args), {\n        set: true,\n        selection: true,\n        content: content\n      });\n    };\n    var cleanContent = function (editor, args) {\n      if (args.format !== 'raw') {\n        var node = editor.parser.parse(args.content, __assign({\n          isRootContent: true,\n          forced_root_block: false\n        }, args));\n        return HtmlSerializer({ validate: editor.validate }, editor.schema).serialize(node);\n      } else {\n        return args.content;\n      }\n    };\n    var setContent = function (editor, content, args) {\n      var contentArgs = setupArgs(args, content);\n      var rng = editor.selection.getRng(), caretNode;\n      var doc = editor.getDoc();\n      var frag, temp;\n      if (!contentArgs.no_events) {\n        contentArgs = editor.fire('BeforeSetContent', contentArgs);\n        if (contentArgs.isDefaultPrevented()) {\n          editor.fire('SetContent', contentArgs);\n          return;\n        }\n      }\n      content = cleanContent(editor, contentArgs);\n      if (rng.insertNode) {\n        content += '<span id=\"__caret\">_</span>';\n        if (rng.startContainer === doc && rng.endContainer === doc) {\n          doc.body.innerHTML = content;\n        } else {\n          rng.deleteContents();\n          if (doc.body.childNodes.length === 0) {\n            doc.body.innerHTML = content;\n          } else {\n            if (rng.createContextualFragment) {\n              rng.insertNode(rng.createContextualFragment(content));\n            } else {\n              frag = doc.createDocumentFragment();\n              temp = doc.createElement('div');\n              frag.appendChild(temp);\n              temp.outerHTML = content;\n              rng.insertNode(frag);\n            }\n          }\n        }\n        caretNode = editor.dom.get('__caret');\n        rng = doc.createRange();\n        rng.setStartBefore(caretNode);\n        rng.setEndBefore(caretNode);\n        editor.selection.setRng(rng);\n        editor.dom.remove('__caret');\n        try {\n          editor.selection.setRng(rng);\n        } catch (ex) {\n        }\n      } else {\n        var anyRng = rng;\n        if (anyRng.item) {\n          doc.execCommand('Delete', false, null);\n          anyRng = editor.selection.getRng();\n        }\n        if (/^\\s+/.test(content)) {\n          anyRng.pasteHTML('<span id=\"__mce_tmp\">_</span>' + content);\n          editor.dom.remove('__mce_tmp');\n        } else {\n          anyRng.pasteHTML(content);\n        }\n      }\n      if (!contentArgs.no_events) {\n        editor.fire('SetContent', contentArgs);\n      }\n    };\n    var SetSelectionContent = { setContent: setContent };\n\n    var getEndpointElement = function (root, rng, start, real, resolve) {\n      var container = start ? rng.startContainer : rng.endContainer;\n      var offset = start ? rng.startOffset : rng.endOffset;\n      return Option.from(container).map(Element.fromDom).map(function (elm) {\n        return !real || !rng.collapsed ? child(elm, resolve(elm, offset)).getOr(elm) : elm;\n      }).bind(function (elm) {\n        return isElement(elm) ? Option.some(elm) : parent(elm);\n      }).map(function (elm) {\n        return elm.dom();\n      }).getOr(root);\n    };\n    var getStart$2 = function (root, rng, real) {\n      return getEndpointElement(root, rng, true, real, function (elm, offset) {\n        return Math.min(childNodesCount(elm), offset);\n      });\n    };\n    var getEnd = function (root, rng, real) {\n      return getEndpointElement(root, rng, false, real, function (elm, offset) {\n        return offset > 0 ? offset - 1 : offset;\n      });\n    };\n    var skipEmptyTextNodes = function (node, forwards) {\n      var orig = node;\n      while (node && NodeType.isText(node) && node.length === 0) {\n        node = forwards ? node.nextSibling : node.previousSibling;\n      }\n      return node || orig;\n    };\n    var getNode$1 = function (root, rng) {\n      var elm, startContainer, endContainer, startOffset, endOffset;\n      if (!rng) {\n        return root;\n      }\n      startContainer = rng.startContainer;\n      endContainer = rng.endContainer;\n      startOffset = rng.startOffset;\n      endOffset = rng.endOffset;\n      elm = rng.commonAncestorContainer;\n      if (!rng.collapsed) {\n        if (startContainer === endContainer) {\n          if (endOffset - startOffset < 2) {\n            if (startContainer.hasChildNodes()) {\n              elm = startContainer.childNodes[startOffset];\n            }\n          }\n        }\n        if (startContainer.nodeType === 3 && endContainer.nodeType === 3) {\n          if (startContainer.length === startOffset) {\n            startContainer = skipEmptyTextNodes(startContainer.nextSibling, true);\n          } else {\n            startContainer = startContainer.parentNode;\n          }\n          if (endOffset === 0) {\n            endContainer = skipEmptyTextNodes(endContainer.previousSibling, false);\n          } else {\n            endContainer = endContainer.parentNode;\n          }\n          if (startContainer && startContainer === endContainer) {\n            return startContainer;\n          }\n        }\n      }\n      if (elm && elm.nodeType === 3) {\n        return elm.parentNode;\n      }\n      return elm;\n    };\n    var getSelectedBlocks = function (dom, rng, startElm, endElm) {\n      var node, root;\n      var selectedBlocks = [];\n      root = dom.getRoot();\n      startElm = dom.getParent(startElm || getStart$2(root, rng, rng.collapsed), dom.isBlock);\n      endElm = dom.getParent(endElm || getEnd(root, rng, rng.collapsed), dom.isBlock);\n      if (startElm && startElm !== root) {\n        selectedBlocks.push(startElm);\n      }\n      if (startElm && endElm && startElm !== endElm) {\n        node = startElm;\n        var walker = new TreeWalker(startElm, root);\n        while ((node = walker.next()) && node !== endElm) {\n          if (dom.isBlock(node)) {\n            selectedBlocks.push(node);\n          }\n        }\n      }\n      if (endElm && startElm !== endElm && endElm !== root) {\n        selectedBlocks.push(endElm);\n      }\n      return selectedBlocks;\n    };\n    var select$1 = function (dom, node, content) {\n      return Option.from(node).map(function (node) {\n        var idx = dom.nodeIndex(node);\n        var rng = dom.createRng();\n        rng.setStart(node.parentNode, idx);\n        rng.setEnd(node.parentNode, idx + 1);\n        if (content) {\n          moveEndPoint$1(dom, rng, node, true);\n          moveEndPoint$1(dom, rng, node, false);\n        }\n        return rng;\n      });\n    };\n\n    var each$j = Tools.each;\n    var isNativeIeSelection = function (rng) {\n      return !!rng.select;\n    };\n    var isAttachedToDom = function (node) {\n      return !!(node && node.ownerDocument) && contains$3(Element.fromDom(node.ownerDocument), Element.fromDom(node));\n    };\n    var isValidRange = function (rng) {\n      if (!rng) {\n        return false;\n      } else if (isNativeIeSelection(rng)) {\n        return true;\n      } else {\n        return isAttachedToDom(rng.startContainer) && isAttachedToDom(rng.endContainer);\n      }\n    };\n    var Selection$1 = function (dom, win, serializer, editor) {\n      var bookmarkManager, controlSelection;\n      var selectedRange, explicitRange, selectorChangedData;\n      var setCursorLocation = function (node, offset) {\n        var rng = dom.createRng();\n        if (!node) {\n          moveEndPoint$1(dom, rng, editor.getBody(), true);\n          setRng(rng);\n        } else {\n          rng.setStart(node, offset);\n          rng.setEnd(node, offset);\n          setRng(rng);\n          collapse(false);\n        }\n      };\n      var getContent = function (args) {\n        return GetSelectionContent.getContent(editor, args);\n      };\n      var setContent = function (content, args) {\n        return SetSelectionContent.setContent(editor, content, args);\n      };\n      var getStart = function (real) {\n        return getStart$2(editor.getBody(), getRng(), real);\n      };\n      var getEnd$1 = function (real) {\n        return getEnd(editor.getBody(), getRng(), real);\n      };\n      var getBookmark = function (type, normalized) {\n        return bookmarkManager.getBookmark(type, normalized);\n      };\n      var moveToBookmark = function (bookmark) {\n        return bookmarkManager.moveToBookmark(bookmark);\n      };\n      var select = function (node, content) {\n        select$1(dom, node, content).each(setRng);\n        return node;\n      };\n      var isCollapsed = function () {\n        var rng = getRng(), sel = getSel();\n        if (!rng || rng.item) {\n          return false;\n        }\n        if (rng.compareEndPoints) {\n          return rng.compareEndPoints('StartToEnd', rng) === 0;\n        }\n        return !sel || rng.collapsed;\n      };\n      var collapse = function (toStart) {\n        var rng = getRng();\n        rng.collapse(!!toStart);\n        setRng(rng);\n      };\n      var getSel = function () {\n        return win.getSelection ? win.getSelection() : win.document.selection;\n      };\n      var getRng = function () {\n        var selection, rng, elm, doc;\n        var tryCompareBoundaryPoints = function (how, sourceRange, destinationRange) {\n          try {\n            return sourceRange.compareBoundaryPoints(how, destinationRange);\n          } catch (ex) {\n            return -1;\n          }\n        };\n        if (!win) {\n          return null;\n        }\n        doc = win.document;\n        if (typeof doc === 'undefined' || doc === null) {\n          return null;\n        }\n        if (editor.bookmark !== undefined && EditorFocus.hasFocus(editor) === false) {\n          var bookmark = SelectionBookmark.getRng(editor);\n          if (bookmark.isSome()) {\n            return bookmark.map(function (r) {\n              return EventProcessRanges.processRanges(editor, [r])[0];\n            }).getOr(doc.createRange());\n          }\n        }\n        try {\n          if ((selection = getSel()) && !NodeType.isRestrictedNode(selection.anchorNode)) {\n            if (selection.rangeCount > 0) {\n              rng = selection.getRangeAt(0);\n            } else {\n              rng = selection.createRange ? selection.createRange() : doc.createRange();\n            }\n          }\n        } catch (ex) {\n        }\n        rng = EventProcessRanges.processRanges(editor, [rng])[0];\n        if (!rng) {\n          rng = doc.createRange ? doc.createRange() : doc.body.createTextRange();\n        }\n        if (rng.setStart && rng.startContainer.nodeType === 9 && rng.collapsed) {\n          elm = dom.getRoot();\n          rng.setStart(elm, 0);\n          rng.setEnd(elm, 0);\n        }\n        if (selectedRange && explicitRange) {\n          if (tryCompareBoundaryPoints(rng.START_TO_START, rng, selectedRange) === 0 && tryCompareBoundaryPoints(rng.END_TO_END, rng, selectedRange) === 0) {\n            rng = explicitRange;\n          } else {\n            selectedRange = null;\n            explicitRange = null;\n          }\n        }\n        return rng;\n      };\n      var setRng = function (rng, forward) {\n        var sel, node, evt;\n        if (!isValidRange(rng)) {\n          return;\n        }\n        var ieRange = isNativeIeSelection(rng) ? rng : null;\n        if (ieRange) {\n          explicitRange = null;\n          try {\n            ieRange.select();\n          } catch (ex) {\n          }\n          return;\n        }\n        sel = getSel();\n        evt = editor.fire('SetSelectionRange', {\n          range: rng,\n          forward: forward\n        });\n        rng = evt.range;\n        if (sel) {\n          explicitRange = rng;\n          try {\n            sel.removeAllRanges();\n            sel.addRange(rng);\n          } catch (ex) {\n          }\n          if (forward === false && sel.extend) {\n            sel.collapse(rng.endContainer, rng.endOffset);\n            sel.extend(rng.startContainer, rng.startOffset);\n          }\n          selectedRange = sel.rangeCount > 0 ? sel.getRangeAt(0) : null;\n        }\n        if (!rng.collapsed && rng.startContainer === rng.endContainer && sel.setBaseAndExtent && !Env.ie) {\n          if (rng.endOffset - rng.startOffset < 2) {\n            if (rng.startContainer.hasChildNodes()) {\n              node = rng.startContainer.childNodes[rng.startOffset];\n              if (node && node.tagName === 'IMG') {\n                sel.setBaseAndExtent(rng.startContainer, rng.startOffset, rng.endContainer, rng.endOffset);\n                if (sel.anchorNode !== rng.startContainer || sel.focusNode !== rng.endContainer) {\n                  sel.setBaseAndExtent(node, 0, node, 1);\n                }\n              }\n            }\n          }\n        }\n        editor.fire('AfterSetSelectionRange', {\n          range: rng,\n          forward: forward\n        });\n      };\n      var setNode = function (elm) {\n        setContent(dom.getOuterHTML(elm));\n        return elm;\n      };\n      var getNode = function () {\n        return getNode$1(editor.getBody(), getRng());\n      };\n      var getSelectedBlocks$1 = function (startElm, endElm) {\n        return getSelectedBlocks(dom, getRng(), startElm, endElm);\n      };\n      var isForward = function () {\n        var sel = getSel();\n        var anchorRange, focusRange;\n        if (!sel || !sel.anchorNode || !sel.focusNode) {\n          return true;\n        }\n        anchorRange = dom.createRng();\n        anchorRange.setStart(sel.anchorNode, sel.anchorOffset);\n        anchorRange.collapse(true);\n        focusRange = dom.createRng();\n        focusRange.setStart(sel.focusNode, sel.focusOffset);\n        focusRange.collapse(true);\n        return anchorRange.compareBoundaryPoints(anchorRange.START_TO_START, focusRange) <= 0;\n      };\n      var normalize = function () {\n        var rng = getRng();\n        var sel = getSel();\n        if (!MultiRange.hasMultipleRanges(sel) && hasAnyRanges(editor)) {\n          var normRng = NormalizeRange.normalize(dom, rng);\n          normRng.each(function (normRng) {\n            setRng(normRng, isForward());\n          });\n          return normRng.getOr(rng);\n        }\n        return rng;\n      };\n      var selectorChanged = function (selector, callback) {\n        var currentSelectors;\n        if (!selectorChangedData) {\n          selectorChangedData = {};\n          currentSelectors = {};\n          editor.on('NodeChange', function (e) {\n            var node = e.element, parents = dom.getParents(node, null, dom.getRoot()), matchedSelectors = {};\n            each$j(selectorChangedData, function (callbacks, selector) {\n              each$j(parents, function (node) {\n                if (dom.is(node, selector)) {\n                  if (!currentSelectors[selector]) {\n                    each$j(callbacks, function (callback) {\n                      callback(true, {\n                        node: node,\n                        selector: selector,\n                        parents: parents\n                      });\n                    });\n                    currentSelectors[selector] = callbacks;\n                  }\n                  matchedSelectors[selector] = callbacks;\n                  return false;\n                }\n              });\n            });\n            each$j(currentSelectors, function (callbacks, selector) {\n              if (!matchedSelectors[selector]) {\n                delete currentSelectors[selector];\n                each$j(callbacks, function (callback) {\n                  callback(false, {\n                    node: node,\n                    selector: selector,\n                    parents: parents\n                  });\n                });\n              }\n            });\n          });\n        }\n        if (!selectorChangedData[selector]) {\n          selectorChangedData[selector] = [];\n        }\n        selectorChangedData[selector].push(callback);\n        return exports;\n      };\n      var getScrollContainer = function () {\n        var scrollContainer;\n        var node = dom.getRoot();\n        while (node && node.nodeName !== 'BODY') {\n          if (node.scrollHeight > node.clientHeight) {\n            scrollContainer = node;\n            break;\n          }\n          node = node.parentNode;\n        }\n        return scrollContainer;\n      };\n      var scrollIntoView = function (elm, alignToTop) {\n        return ScrollIntoView.scrollElementIntoView(editor, elm, alignToTop);\n      };\n      var placeCaretAt = function (clientX, clientY) {\n        return setRng(CaretRangeFromPoint.fromPoint(clientX, clientY, editor.getDoc()));\n      };\n      var getBoundingClientRect = function () {\n        var rng = getRng();\n        return rng.collapsed ? CaretPosition$1.fromRangeStart(rng).getClientRects()[0] : rng.getBoundingClientRect();\n      };\n      var destroy = function () {\n        win = selectedRange = explicitRange = null;\n        controlSelection.destroy();\n      };\n      var exports = {\n        bookmarkManager: null,\n        controlSelection: null,\n        dom: dom,\n        win: win,\n        serializer: serializer,\n        editor: editor,\n        collapse: collapse,\n        setCursorLocation: setCursorLocation,\n        getContent: getContent,\n        setContent: setContent,\n        getBookmark: getBookmark,\n        moveToBookmark: moveToBookmark,\n        select: select,\n        isCollapsed: isCollapsed,\n        isForward: isForward,\n        setNode: setNode,\n        getNode: getNode,\n        getSel: getSel,\n        setRng: setRng,\n        getRng: getRng,\n        getStart: getStart,\n        getEnd: getEnd$1,\n        getSelectedBlocks: getSelectedBlocks$1,\n        normalize: normalize,\n        selectorChanged: selectorChanged,\n        getScrollContainer: getScrollContainer,\n        scrollIntoView: scrollIntoView,\n        placeCaretAt: placeCaretAt,\n        getBoundingClientRect: getBoundingClientRect,\n        destroy: destroy\n      };\n      bookmarkManager = BookmarkManager$1(exports);\n      controlSelection = ControlSelection(exports, editor);\n      exports.bookmarkManager = bookmarkManager;\n      exports.controlSelection = controlSelection;\n      return exports;\n    };\n\n    var BreakType;\n    (function (BreakType) {\n      BreakType[BreakType['Br'] = 0] = 'Br';\n      BreakType[BreakType['Block'] = 1] = 'Block';\n      BreakType[BreakType['Wrap'] = 2] = 'Wrap';\n      BreakType[BreakType['Eol'] = 3] = 'Eol';\n    }(BreakType || (BreakType = {})));\n    var flip = function (direction, positions) {\n      return direction === HDirection.Backwards ? positions.reverse() : positions;\n    };\n    var walk$3 = function (direction, caretWalker, pos) {\n      return direction === HDirection.Forwards ? caretWalker.next(pos) : caretWalker.prev(pos);\n    };\n    var getBreakType = function (scope, direction, currentPos, nextPos) {\n      if (NodeType.isBr(nextPos.getNode(direction === HDirection.Forwards))) {\n        return BreakType.Br;\n      } else if (isInSameBlock(currentPos, nextPos) === false) {\n        return BreakType.Block;\n      } else {\n        return BreakType.Wrap;\n      }\n    };\n    var getPositionsUntil = function (predicate, direction, scope, start) {\n      var caretWalker = CaretWalker(scope);\n      var currentPos = start, nextPos;\n      var positions = [];\n      while (currentPos) {\n        nextPos = walk$3(direction, caretWalker, currentPos);\n        if (!nextPos) {\n          break;\n        }\n        if (NodeType.isBr(nextPos.getNode(false))) {\n          if (direction === HDirection.Forwards) {\n            return {\n              positions: flip(direction, positions).concat([nextPos]),\n              breakType: BreakType.Br,\n              breakAt: Option.some(nextPos)\n            };\n          } else {\n            return {\n              positions: flip(direction, positions),\n              breakType: BreakType.Br,\n              breakAt: Option.some(nextPos)\n            };\n          }\n        }\n        if (!nextPos.isVisible()) {\n          currentPos = nextPos;\n          continue;\n        }\n        if (predicate(currentPos, nextPos)) {\n          var breakType = getBreakType(scope, direction, currentPos, nextPos);\n          return {\n            positions: flip(direction, positions),\n            breakType: breakType,\n            breakAt: Option.some(nextPos)\n          };\n        }\n        positions.push(nextPos);\n        currentPos = nextPos;\n      }\n      return {\n        positions: flip(direction, positions),\n        breakType: BreakType.Eol,\n        breakAt: Option.none()\n      };\n    };\n    var getAdjacentLinePositions = function (direction, getPositionsUntilBreak, scope, start) {\n      return getPositionsUntilBreak(scope, start).breakAt.map(function (pos) {\n        var positions = getPositionsUntilBreak(scope, pos).positions;\n        return direction === HDirection.Backwards ? positions.concat(pos) : [pos].concat(positions);\n      }).getOr([]);\n    };\n    var findClosestHorizontalPositionFromPoint = function (positions, x) {\n      return foldl(positions, function (acc, newPos) {\n        return acc.fold(function () {\n          return Option.some(newPos);\n        }, function (lastPos) {\n          return lift2(head(lastPos.getClientRects()), head(newPos.getClientRects()), function (lastRect, newRect) {\n            var lastDist = Math.abs(x - lastRect.left);\n            var newDist = Math.abs(x - newRect.left);\n            return newDist <= lastDist ? newPos : lastPos;\n          }).or(acc);\n        });\n      }, Option.none());\n    };\n    var findClosestHorizontalPosition = function (positions, pos) {\n      return head(pos.getClientRects()).bind(function (targetRect) {\n        return findClosestHorizontalPositionFromPoint(positions, targetRect.left);\n      });\n    };\n    var getPositionsUntilPreviousLine = curry(getPositionsUntil, CaretPosition.isAbove, -1);\n    var getPositionsUntilNextLine = curry(getPositionsUntil, CaretPosition.isBelow, 1);\n    var isAtFirstLine = function (scope, pos) {\n      return getPositionsUntilPreviousLine(scope, pos).breakAt.isNone();\n    };\n    var isAtLastLine = function (scope, pos) {\n      return getPositionsUntilNextLine(scope, pos).breakAt.isNone();\n    };\n    var getPositionsAbove = curry(getAdjacentLinePositions, -1, getPositionsUntilPreviousLine);\n    var getPositionsBelow = curry(getAdjacentLinePositions, 1, getPositionsUntilNextLine);\n    var getFirstLinePositions = function (scope) {\n      return CaretFinder.firstPositionIn(scope).map(function (pos) {\n        return [pos].concat(getPositionsUntilNextLine(scope, pos).positions);\n      }).getOr([]);\n    };\n    var getLastLinePositions = function (scope) {\n      return CaretFinder.lastPositionIn(scope).map(function (pos) {\n        return getPositionsUntilPreviousLine(scope, pos).positions.concat(pos);\n      }).getOr([]);\n    };\n\n    var isContentEditableFalse$b = NodeType.isContentEditableFalse;\n    var getSelectedNode$1 = getSelectedNode;\n    var moveToCeFalseHorizontally = function (direction, editor, getNextPosFn, range) {\n      var forwards = direction === HDirection.Forwards;\n      var isBeforeContentEditableFalseFn = forwards ? isBeforeContentEditableFalse : isAfterContentEditableFalse;\n      if (!range.collapsed) {\n        var node = getSelectedNode$1(range);\n        if (isContentEditableFalse$b(node)) {\n          return showCaret(direction, editor, node, direction === HDirection.Backwards, true);\n        }\n      }\n      var rangeIsInContainerBlock = isRangeInCaretContainerBlock(range);\n      var caretPosition = getNormalizedRangeEndPoint(direction, editor.getBody(), range);\n      if (isBeforeContentEditableFalseFn(caretPosition)) {\n        return selectNode(editor, caretPosition.getNode(!forwards));\n      }\n      var nextCaretPosition = InlineUtils.normalizePosition(forwards, getNextPosFn(caretPosition));\n      if (!nextCaretPosition) {\n        if (rangeIsInContainerBlock) {\n          return range;\n        }\n        return null;\n      }\n      if (isBeforeContentEditableFalseFn(nextCaretPosition)) {\n        return showCaret(direction, editor, nextCaretPosition.getNode(!forwards), forwards, true);\n      }\n      var peekCaretPosition = getNextPosFn(nextCaretPosition);\n      if (peekCaretPosition && isBeforeContentEditableFalseFn(peekCaretPosition)) {\n        if (isMoveInsideSameBlock(nextCaretPosition, peekCaretPosition)) {\n          return showCaret(direction, editor, peekCaretPosition.getNode(!forwards), forwards, true);\n        }\n      }\n      if (rangeIsInContainerBlock) {\n        return renderRangeCaret(editor, nextCaretPosition.toRange(), true);\n      }\n      return null;\n    };\n    var moveToCeFalseVertically = function (direction, editor, walkerFn, range) {\n      var caretPosition, linePositions, nextLinePositions;\n      var closestNextLineRect, caretClientRect, clientX;\n      var dist1, dist2, contentEditableFalseNode;\n      contentEditableFalseNode = getSelectedNode$1(range);\n      caretPosition = getNormalizedRangeEndPoint(direction, editor.getBody(), range);\n      linePositions = walkerFn(editor.getBody(), isAboveLine(1), caretPosition);\n      nextLinePositions = filter(linePositions, isLine(1));\n      caretClientRect = ArrUtils.last(caretPosition.getClientRects());\n      if (isBeforeContentEditableFalse(caretPosition) || isBeforeTable(caretPosition)) {\n        contentEditableFalseNode = caretPosition.getNode();\n      }\n      if (isAfterContentEditableFalse(caretPosition) || isAfterTable(caretPosition)) {\n        contentEditableFalseNode = caretPosition.getNode(true);\n      }\n      if (!caretClientRect) {\n        return null;\n      }\n      clientX = caretClientRect.left;\n      closestNextLineRect = findClosestClientRect(nextLinePositions, clientX);\n      if (closestNextLineRect) {\n        if (isContentEditableFalse$b(closestNextLineRect.node)) {\n          dist1 = Math.abs(clientX - closestNextLineRect.left);\n          dist2 = Math.abs(clientX - closestNextLineRect.right);\n          return showCaret(direction, editor, closestNextLineRect.node, dist1 < dist2, true);\n        }\n      }\n      if (contentEditableFalseNode) {\n        var caretPositions = positionsUntil(direction, editor.getBody(), isAboveLine(1), contentEditableFalseNode);\n        closestNextLineRect = findClosestClientRect(filter(caretPositions, isLine(1)), clientX);\n        if (closestNextLineRect) {\n          return renderRangeCaret(editor, closestNextLineRect.position.toRange(), true);\n        }\n        closestNextLineRect = ArrUtils.last(filter(caretPositions, isLine(0)));\n        if (closestNextLineRect) {\n          return renderRangeCaret(editor, closestNextLineRect.position.toRange(), true);\n        }\n      }\n    };\n    var createTextBlock = function (editor) {\n      var textBlock = editor.dom.create(Settings.getForcedRootBlock(editor));\n      if (!Env.ie || Env.ie >= 11) {\n        textBlock.innerHTML = '<br data-mce-bogus=\"1\">';\n      }\n      return textBlock;\n    };\n    var exitPreBlock = function (editor, direction, range) {\n      var pre, caretPos, newBlock;\n      var caretWalker = CaretWalker(editor.getBody());\n      var getNextVisualCaretPosition = curry(getVisualCaretPosition, caretWalker.next);\n      var getPrevVisualCaretPosition = curry(getVisualCaretPosition, caretWalker.prev);\n      if (range.collapsed && editor.settings.forced_root_block) {\n        pre = editor.dom.getParent(range.startContainer, 'PRE');\n        if (!pre) {\n          return;\n        }\n        if (direction === 1) {\n          caretPos = getNextVisualCaretPosition(CaretPosition$1.fromRangeStart(range));\n        } else {\n          caretPos = getPrevVisualCaretPosition(CaretPosition$1.fromRangeStart(range));\n        }\n        if (!caretPos) {\n          newBlock = createTextBlock(editor);\n          if (direction === 1) {\n            editor.$(pre).after(newBlock);\n          } else {\n            editor.$(pre).before(newBlock);\n          }\n          editor.selection.select(newBlock, true);\n          editor.selection.collapse();\n        }\n      }\n    };\n    var getHorizontalRange = function (editor, forward) {\n      var caretWalker = CaretWalker(editor.getBody());\n      var getNextVisualCaretPosition = curry(getVisualCaretPosition, caretWalker.next);\n      var getPrevVisualCaretPosition = curry(getVisualCaretPosition, caretWalker.prev);\n      var newRange;\n      var direction = forward ? HDirection.Forwards : HDirection.Backwards;\n      var getNextPosFn = forward ? getNextVisualCaretPosition : getPrevVisualCaretPosition;\n      var range = editor.selection.getRng();\n      newRange = moveToCeFalseHorizontally(direction, editor, getNextPosFn, range);\n      if (newRange) {\n        return newRange;\n      }\n      newRange = exitPreBlock(editor, direction, range);\n      if (newRange) {\n        return newRange;\n      }\n      return null;\n    };\n    var getVerticalRange = function (editor, down) {\n      var newRange;\n      var direction = down ? 1 : -1;\n      var walkerFn = down ? downUntil : upUntil;\n      var range = editor.selection.getRng();\n      newRange = moveToCeFalseVertically(direction, editor, walkerFn, range);\n      if (newRange) {\n        return newRange;\n      }\n      newRange = exitPreBlock(editor, direction, range);\n      if (newRange) {\n        return newRange;\n      }\n      return null;\n    };\n    var moveH = function (editor, forward) {\n      return function () {\n        var newRng = getHorizontalRange(editor, forward);\n        if (newRng) {\n          moveToRange(editor, newRng);\n          return true;\n        } else {\n          return false;\n        }\n      };\n    };\n    var moveV = function (editor, down) {\n      return function () {\n        var newRng = getVerticalRange(editor, down);\n        if (newRng) {\n          moveToRange(editor, newRng);\n          return true;\n        } else {\n          return false;\n        }\n      };\n    };\n    var isCefPosition = function (forward) {\n      return function (pos) {\n        return forward ? isAfterContentEditableFalse(pos) : isBeforeContentEditableFalse(pos);\n      };\n    };\n    var moveToLineEndPoint = function (editor, forward) {\n      return function () {\n        var from = forward ? CaretPosition$1.fromRangeEnd(editor.selection.getRng()) : CaretPosition$1.fromRangeStart(editor.selection.getRng());\n        var result = forward ? getPositionsUntilNextLine(editor.getBody(), from) : getPositionsUntilPreviousLine(editor.getBody(), from);\n        var to = forward ? last(result.positions) : head(result.positions);\n        return to.filter(isCefPosition(forward)).fold(constant(false), function (pos) {\n          editor.selection.setRng(pos.toRange());\n          return true;\n        });\n      };\n    };\n\n    var deflate = function (rect, delta) {\n      return {\n        left: rect.left - delta,\n        top: rect.top - delta,\n        right: rect.right + delta * 2,\n        bottom: rect.bottom + delta * 2,\n        width: rect.width + delta,\n        height: rect.height + delta\n      };\n    };\n    var getCorners = function (getYAxisValue, tds) {\n      return bind(tds, function (td) {\n        var rect = deflate(clone$1(td.getBoundingClientRect()), -1);\n        return [\n          {\n            x: rect.left,\n            y: getYAxisValue(rect),\n            cell: td\n          },\n          {\n            x: rect.right,\n            y: getYAxisValue(rect),\n            cell: td\n          }\n        ];\n      });\n    };\n    var findClosestCorner = function (corners, x, y) {\n      return foldl(corners, function (acc, newCorner) {\n        return acc.fold(function () {\n          return Option.some(newCorner);\n        }, function (oldCorner) {\n          var oldDist = Math.sqrt(Math.abs(oldCorner.x - x) + Math.abs(oldCorner.y - y));\n          var newDist = Math.sqrt(Math.abs(newCorner.x - x) + Math.abs(newCorner.y - y));\n          return Option.some(newDist < oldDist ? newCorner : oldCorner);\n        });\n      }, Option.none());\n    };\n    var getClosestCell$1 = function (getYAxisValue, isTargetCorner, table, x, y) {\n      var cells = descendants$1(Element.fromDom(table), 'td,th,caption').map(function (e) {\n        return e.dom();\n      });\n      var corners = filter(getCorners(getYAxisValue, cells), function (corner) {\n        return isTargetCorner(corner, y);\n      });\n      return findClosestCorner(corners, x, y).map(function (corner) {\n        return corner.cell;\n      });\n    };\n    var getBottomValue = function (rect) {\n      return rect.bottom;\n    };\n    var getTopValue = function (rect) {\n      return rect.top;\n    };\n    var isAbove$1 = function (corner, y) {\n      return corner.y < y;\n    };\n    var isBelow$1 = function (corner, y) {\n      return corner.y > y;\n    };\n    var getClosestCellAbove = curry(getClosestCell$1, getBottomValue, isAbove$1);\n    var getClosestCellBelow = curry(getClosestCell$1, getTopValue, isBelow$1);\n    var findClosestPositionInAboveCell = function (table, pos) {\n      return head(pos.getClientRects()).bind(function (rect) {\n        return getClosestCellAbove(table, rect.left, rect.top);\n      }).bind(function (cell) {\n        return findClosestHorizontalPosition(getLastLinePositions(cell), pos);\n      });\n    };\n    var findClosestPositionInBelowCell = function (table, pos) {\n      return last(pos.getClientRects()).bind(function (rect) {\n        return getClosestCellBelow(table, rect.left, rect.top);\n      }).bind(function (cell) {\n        return findClosestHorizontalPosition(getFirstLinePositions(cell), pos);\n      });\n    };\n\n    var hasNextBreak = function (getPositionsUntil, scope, lineInfo) {\n      return lineInfo.breakAt.map(function (breakPos) {\n        return getPositionsUntil(scope, breakPos).breakAt.isSome();\n      }).getOr(false);\n    };\n    var startsWithWrapBreak = function (lineInfo) {\n      return lineInfo.breakType === BreakType.Wrap && lineInfo.positions.length === 0;\n    };\n    var startsWithBrBreak = function (lineInfo) {\n      return lineInfo.breakType === BreakType.Br && lineInfo.positions.length === 1;\n    };\n    var isAtTableCellLine = function (getPositionsUntil, scope, pos) {\n      var lineInfo = getPositionsUntil(scope, pos);\n      if (startsWithWrapBreak(lineInfo) || !NodeType.isBr(pos.getNode()) && startsWithBrBreak(lineInfo)) {\n        return !hasNextBreak(getPositionsUntil, scope, lineInfo);\n      } else {\n        return lineInfo.breakAt.isNone();\n      }\n    };\n    var isAtFirstTableCellLine = curry(isAtTableCellLine, getPositionsUntilPreviousLine);\n    var isAtLastTableCellLine = curry(isAtTableCellLine, getPositionsUntilNextLine);\n    var isCaretAtStartOrEndOfTable = function (forward, rng, table) {\n      var caretPos = CaretPosition$1.fromRangeStart(rng);\n      return CaretFinder.positionIn(!forward, table).map(function (pos) {\n        return pos.isEqual(caretPos);\n      }).getOr(false);\n    };\n    var navigateHorizontally = function (editor, forward, table, td) {\n      var rng = editor.selection.getRng();\n      var direction = forward ? 1 : -1;\n      if (isFakeCaretTableBrowser() && isCaretAtStartOrEndOfTable(forward, rng, table)) {\n        var newRng = showCaret(direction, editor, table, !forward, true);\n        moveToRange(editor, newRng);\n        return true;\n      }\n      return false;\n    };\n    var getClosestAbovePosition = function (root, table, start) {\n      return findClosestPositionInAboveCell(table, start).orThunk(function () {\n        return head(start.getClientRects()).bind(function (rect) {\n          return findClosestHorizontalPositionFromPoint(getPositionsAbove(root, CaretPosition$1.before(table)), rect.left);\n        });\n      }).getOr(CaretPosition$1.before(table));\n    };\n    var getClosestBelowPosition = function (root, table, start) {\n      return findClosestPositionInBelowCell(table, start).orThunk(function () {\n        return head(start.getClientRects()).bind(function (rect) {\n          return findClosestHorizontalPositionFromPoint(getPositionsBelow(root, CaretPosition$1.after(table)), rect.left);\n        });\n      }).getOr(CaretPosition$1.after(table));\n    };\n    var getTable = function (previous, pos) {\n      var node = pos.getNode(previous);\n      return NodeType.isElement(node) && node.nodeName === 'TABLE' ? Option.some(node) : Option.none();\n    };\n    var renderBlock = function (down, editor, table, pos) {\n      var forcedRootBlock = Settings.getForcedRootBlock(editor);\n      if (forcedRootBlock) {\n        editor.undoManager.transact(function () {\n          var element = Element.fromTag(forcedRootBlock);\n          setAll(element, Settings.getForcedRootBlockAttrs(editor));\n          append(element, Element.fromTag('br'));\n          if (down) {\n            after(Element.fromDom(table), element);\n          } else {\n            before(Element.fromDom(table), element);\n          }\n          var rng = editor.dom.createRng();\n          rng.setStart(element.dom(), 0);\n          rng.setEnd(element.dom(), 0);\n          moveToRange(editor, rng);\n        });\n      } else {\n        moveToRange(editor, pos.toRange());\n      }\n    };\n    var moveCaret = function (editor, down, pos) {\n      var table = down ? getTable(true, pos) : getTable(false, pos);\n      var last = down === false;\n      table.fold(function () {\n        return moveToRange(editor, pos.toRange());\n      }, function (table) {\n        return CaretFinder.positionIn(last, editor.getBody()).filter(function (lastPos) {\n          return lastPos.isEqual(pos);\n        }).fold(function () {\n          return moveToRange(editor, pos.toRange());\n        }, function (_) {\n          return renderBlock(down, editor, table, pos);\n        });\n      });\n    };\n    var navigateVertically = function (editor, down, table, td) {\n      var rng = editor.selection.getRng();\n      var pos = CaretPosition$1.fromRangeStart(rng);\n      var root = editor.getBody();\n      if (!down && isAtFirstTableCellLine(td, pos)) {\n        var newPos = getClosestAbovePosition(root, table, pos);\n        moveCaret(editor, down, newPos);\n        return true;\n      } else if (down && isAtLastTableCellLine(td, pos)) {\n        var newPos = getClosestBelowPosition(root, table, pos);\n        moveCaret(editor, down, newPos);\n        return true;\n      } else {\n        return false;\n      }\n    };\n    var moveH$1 = function (editor, forward) {\n      return function () {\n        return Option.from(editor.dom.getParent(editor.selection.getNode(), 'td,th')).bind(function (td) {\n          return Option.from(editor.dom.getParent(td, 'table')).map(function (table) {\n            return navigateHorizontally(editor, forward, table);\n          });\n        }).getOr(false);\n      };\n    };\n    var moveV$1 = function (editor, forward) {\n      return function () {\n        return Option.from(editor.dom.getParent(editor.selection.getNode(), 'td,th')).bind(function (td) {\n          return Option.from(editor.dom.getParent(td, 'table')).map(function (table) {\n            return navigateVertically(editor, forward, table, td);\n          });\n        }).getOr(false);\n      };\n    };\n\n    var isTarget = function (node) {\n      return contains(['figcaption'], name(node));\n    };\n    var rangeBefore = function (target) {\n      var rng = domGlobals.document.createRange();\n      rng.setStartBefore(target.dom());\n      rng.setEndBefore(target.dom());\n      return rng;\n    };\n    var insertElement = function (root, elm, forward) {\n      if (forward) {\n        append(root, elm);\n      } else {\n        prepend(root, elm);\n      }\n    };\n    var insertBr = function (root, forward) {\n      var br = Element.fromTag('br');\n      insertElement(root, br, forward);\n      return rangeBefore(br);\n    };\n    var insertBlock$1 = function (root, forward, blockName, attrs) {\n      var block = Element.fromTag(blockName);\n      var br = Element.fromTag('br');\n      setAll(block, attrs);\n      append(block, br);\n      insertElement(root, block, forward);\n      return rangeBefore(br);\n    };\n    var insertEmptyLine = function (root, rootBlockName, attrs, forward) {\n      if (rootBlockName === '') {\n        return insertBr(root, forward);\n      } else {\n        return insertBlock$1(root, forward, rootBlockName, attrs);\n      }\n    };\n    var getClosestTargetBlock = function (pos, root) {\n      var isRoot = curry(eq, root);\n      return closest(Element.fromDom(pos.container()), isBlock, isRoot).filter(isTarget);\n    };\n    var isAtFirstOrLastLine = function (root, forward, pos) {\n      return forward ? isAtLastLine(root.dom(), pos) : isAtFirstLine(root.dom(), pos);\n    };\n    var moveCaretToNewEmptyLine = function (editor, forward) {\n      var root = Element.fromDom(editor.getBody());\n      var pos = CaretPosition$1.fromRangeStart(editor.selection.getRng());\n      var rootBlock = Settings.getForcedRootBlock(editor);\n      var rootBlockAttrs = Settings.getForcedRootBlockAttrs(editor);\n      return getClosestTargetBlock(pos, root).exists(function () {\n        if (isAtFirstOrLastLine(root, forward, pos)) {\n          var rng = insertEmptyLine(root, rootBlock, rootBlockAttrs, forward);\n          editor.selection.setRng(rng);\n          return true;\n        } else {\n          return false;\n        }\n      });\n    };\n    var moveV$2 = function (editor, forward) {\n      return function () {\n        if (editor.selection.isCollapsed()) {\n          return moveCaretToNewEmptyLine(editor, forward);\n        } else {\n          return false;\n        }\n      };\n    };\n\n    var defaultPatterns = function (patterns) {\n      return map(patterns, function (pattern) {\n        return merge({\n          shiftKey: false,\n          altKey: false,\n          ctrlKey: false,\n          metaKey: false,\n          keyCode: 0,\n          action: noop\n        }, pattern);\n      });\n    };\n    var matchesEvent = function (pattern, evt) {\n      return evt.keyCode === pattern.keyCode && evt.shiftKey === pattern.shiftKey && evt.altKey === pattern.altKey && evt.ctrlKey === pattern.ctrlKey && evt.metaKey === pattern.metaKey;\n    };\n    var match$1 = function (patterns, evt) {\n      return bind(defaultPatterns(patterns), function (pattern) {\n        return matchesEvent(pattern, evt) ? [pattern] : [];\n      });\n    };\n    var action = function (f) {\n      var x = [];\n      for (var _i = 1; _i < arguments.length; _i++) {\n        x[_i - 1] = arguments[_i];\n      }\n      var args = Array.prototype.slice.call(arguments, 1);\n      return function () {\n        return f.apply(null, args);\n      };\n    };\n    var execute = function (patterns, evt) {\n      return find(match$1(patterns, evt), function (pattern) {\n        return pattern.action();\n      });\n    };\n    var MatchKeys = {\n      match: match$1,\n      action: action,\n      execute: execute\n    };\n\n    var executeKeydownOverride = function (editor, caret, evt) {\n      var os = PlatformDetection$1.detect().os;\n      MatchKeys.execute([\n        {\n          keyCode: VK.RIGHT,\n          action: moveH(editor, true)\n        },\n        {\n          keyCode: VK.LEFT,\n          action: moveH(editor, false)\n        },\n        {\n          keyCode: VK.UP,\n          action: moveV(editor, false)\n        },\n        {\n          keyCode: VK.DOWN,\n          action: moveV(editor, true)\n        },\n        {\n          keyCode: VK.RIGHT,\n          action: moveH$1(editor, true)\n        },\n        {\n          keyCode: VK.LEFT,\n          action: moveH$1(editor, false)\n        },\n        {\n          keyCode: VK.UP,\n          action: moveV$1(editor, false)\n        },\n        {\n          keyCode: VK.DOWN,\n          action: moveV$1(editor, true)\n        },\n        {\n          keyCode: VK.RIGHT,\n          action: BoundarySelection.move(editor, caret, true)\n        },\n        {\n          keyCode: VK.LEFT,\n          action: BoundarySelection.move(editor, caret, false)\n        },\n        {\n          keyCode: VK.RIGHT,\n          ctrlKey: !os.isOSX(),\n          altKey: os.isOSX(),\n          action: BoundarySelection.moveNextWord(editor, caret)\n        },\n        {\n          keyCode: VK.LEFT,\n          ctrlKey: !os.isOSX(),\n          altKey: os.isOSX(),\n          action: BoundarySelection.movePrevWord(editor, caret)\n        },\n        {\n          keyCode: VK.UP,\n          action: moveV$2(editor, false)\n        },\n        {\n          keyCode: VK.DOWN,\n          action: moveV$2(editor, true)\n        }\n      ], evt).each(function (_) {\n        evt.preventDefault();\n      });\n    };\n    var setup$7 = function (editor, caret) {\n      editor.on('keydown', function (evt) {\n        if (evt.isDefaultPrevented() === false) {\n          executeKeydownOverride(editor, caret, evt);\n        }\n      });\n    };\n    var ArrowKeys = { setup: setup$7 };\n\n    var executeKeydownOverride$1 = function (editor, caret, evt) {\n      MatchKeys.execute([\n        {\n          keyCode: VK.BACKSPACE,\n          action: MatchKeys.action(CefDelete.backspaceDelete, editor, false)\n        },\n        {\n          keyCode: VK.DELETE,\n          action: MatchKeys.action(CefDelete.backspaceDelete, editor, true)\n        },\n        {\n          keyCode: VK.BACKSPACE,\n          action: MatchKeys.action(CefBoundaryDelete.backspaceDelete, editor, false)\n        },\n        {\n          keyCode: VK.DELETE,\n          action: MatchKeys.action(CefBoundaryDelete.backspaceDelete, editor, true)\n        },\n        {\n          keyCode: VK.BACKSPACE,\n          action: MatchKeys.action(InlineBoundaryDelete.backspaceDelete, editor, caret, false)\n        },\n        {\n          keyCode: VK.DELETE,\n          action: MatchKeys.action(InlineBoundaryDelete.backspaceDelete, editor, caret, true)\n        },\n        {\n          keyCode: VK.BACKSPACE,\n          action: MatchKeys.action(TableDelete.backspaceDelete, editor, false)\n        },\n        {\n          keyCode: VK.DELETE,\n          action: MatchKeys.action(TableDelete.backspaceDelete, editor, true)\n        },\n        {\n          keyCode: VK.BACKSPACE,\n          action: MatchKeys.action(BlockRangeDelete.backspaceDelete, editor, false)\n        },\n        {\n          keyCode: VK.DELETE,\n          action: MatchKeys.action(BlockRangeDelete.backspaceDelete, editor, true)\n        },\n        {\n          keyCode: VK.BACKSPACE,\n          action: MatchKeys.action(BlockBoundaryDelete.backspaceDelete, editor, false)\n        },\n        {\n          keyCode: VK.DELETE,\n          action: MatchKeys.action(BlockBoundaryDelete.backspaceDelete, editor, true)\n        },\n        {\n          keyCode: VK.BACKSPACE,\n          action: MatchKeys.action(InlineFormatDelete.backspaceDelete, editor, false)\n        },\n        {\n          keyCode: VK.DELETE,\n          action: MatchKeys.action(InlineFormatDelete.backspaceDelete, editor, true)\n        }\n      ], evt).each(function (_) {\n        evt.preventDefault();\n      });\n    };\n    var executeKeyupOverride = function (editor, evt) {\n      MatchKeys.execute([\n        {\n          keyCode: VK.BACKSPACE,\n          action: MatchKeys.action(CefDelete.paddEmptyElement, editor)\n        },\n        {\n          keyCode: VK.DELETE,\n          action: MatchKeys.action(CefDelete.paddEmptyElement, editor)\n        }\n      ], evt);\n    };\n    var setup$8 = function (editor, caret) {\n      editor.on('keydown', function (evt) {\n        if (evt.isDefaultPrevented() === false) {\n          executeKeydownOverride$1(editor, caret, evt);\n        }\n      });\n      editor.on('keyup', function (evt) {\n        if (evt.isDefaultPrevented() === false) {\n          executeKeyupOverride(editor, evt);\n        }\n      });\n    };\n    var DeleteBackspaceKeys = { setup: setup$8 };\n\n    var firstNonWhiteSpaceNodeSibling = function (node) {\n      while (node) {\n        if (node.nodeType === 1 || node.nodeType === 3 && node.data && /[\\r\\n\\s]/.test(node.data)) {\n          return node;\n        }\n        node = node.nextSibling;\n      }\n    };\n    var moveToCaretPosition = function (editor, root) {\n      var walker, node, rng, lastNode = root, tempElm;\n      var dom = editor.dom;\n      var moveCaretBeforeOnEnterElementsMap = editor.schema.getMoveCaretBeforeOnEnterElements();\n      if (!root) {\n        return;\n      }\n      if (/^(LI|DT|DD)$/.test(root.nodeName)) {\n        var firstChild = firstNonWhiteSpaceNodeSibling(root.firstChild);\n        if (firstChild && /^(UL|OL|DL)$/.test(firstChild.nodeName)) {\n          root.insertBefore(dom.doc.createTextNode('\\xA0'), root.firstChild);\n        }\n      }\n      rng = dom.createRng();\n      root.normalize();\n      if (root.hasChildNodes()) {\n        walker = new TreeWalker(root, root);\n        while (node = walker.current()) {\n          if (NodeType.isText(node)) {\n            rng.setStart(node, 0);\n            rng.setEnd(node, 0);\n            break;\n          }\n          if (moveCaretBeforeOnEnterElementsMap[node.nodeName.toLowerCase()]) {\n            rng.setStartBefore(node);\n            rng.setEndBefore(node);\n            break;\n          }\n          lastNode = node;\n          node = walker.next();\n        }\n        if (!node) {\n          rng.setStart(lastNode, 0);\n          rng.setEnd(lastNode, 0);\n        }\n      } else {\n        if (NodeType.isBr(root)) {\n          if (root.nextSibling && dom.isBlock(root.nextSibling)) {\n            rng.setStartBefore(root);\n            rng.setEndBefore(root);\n          } else {\n            rng.setStartAfter(root);\n            rng.setEndAfter(root);\n          }\n        } else {\n          rng.setStart(root, 0);\n          rng.setEnd(root, 0);\n        }\n      }\n      editor.selection.setRng(rng);\n      dom.remove(tempElm);\n      editor.selection.scrollIntoView(root);\n    };\n    var getEditableRoot = function (dom, node) {\n      var root = dom.getRoot();\n      var parent, editableRoot;\n      parent = node;\n      while (parent !== root && dom.getContentEditable(parent) !== 'false') {\n        if (dom.getContentEditable(parent) === 'true') {\n          editableRoot = parent;\n        }\n        parent = parent.parentNode;\n      }\n      return parent !== root ? editableRoot : root;\n    };\n    var getParentBlock$2 = function (editor) {\n      return Option.from(editor.dom.getParent(editor.selection.getStart(true), editor.dom.isBlock));\n    };\n    var getParentBlockName = function (editor) {\n      return getParentBlock$2(editor).fold(constant(''), function (parentBlock) {\n        return parentBlock.nodeName.toUpperCase();\n      });\n    };\n    var isListItemParentBlock = function (editor) {\n      return getParentBlock$2(editor).filter(function (elm) {\n        return isListItem(Element.fromDom(elm));\n      }).isSome();\n    };\n    var NewLineUtils = {\n      moveToCaretPosition: moveToCaretPosition,\n      getEditableRoot: getEditableRoot,\n      getParentBlock: getParentBlock$2,\n      getParentBlockName: getParentBlockName,\n      isListItemParentBlock: isListItemParentBlock\n    };\n\n    var hasFirstChild = function (elm, name) {\n      return elm.firstChild && elm.firstChild.nodeName === name;\n    };\n    var hasParent$1 = function (elm, parentName) {\n      return elm && elm.parentNode && elm.parentNode.nodeName === parentName;\n    };\n    var isListBlock = function (elm) {\n      return elm && /^(OL|UL|LI)$/.test(elm.nodeName);\n    };\n    var isNestedList = function (elm) {\n      return isListBlock(elm) && isListBlock(elm.parentNode);\n    };\n    var getContainerBlock = function (containerBlock) {\n      var containerBlockParent = containerBlock.parentNode;\n      if (/^(LI|DT|DD)$/.test(containerBlockParent.nodeName)) {\n        return containerBlockParent;\n      }\n      return containerBlock;\n    };\n    var isFirstOrLastLi = function (containerBlock, parentBlock, first) {\n      var node = containerBlock[first ? 'firstChild' : 'lastChild'];\n      while (node) {\n        if (NodeType.isElement(node)) {\n          break;\n        }\n        node = node[first ? 'nextSibling' : 'previousSibling'];\n      }\n      return node === parentBlock;\n    };\n    var insert$1 = function (editor, createNewBlock, containerBlock, parentBlock, newBlockName) {\n      var dom = editor.dom;\n      var rng = editor.selection.getRng();\n      if (containerBlock === editor.getBody()) {\n        return;\n      }\n      if (isNestedList(containerBlock)) {\n        newBlockName = 'LI';\n      }\n      var newBlock = newBlockName ? createNewBlock(newBlockName) : dom.create('BR');\n      if (isFirstOrLastLi(containerBlock, parentBlock, true) && isFirstOrLastLi(containerBlock, parentBlock, false)) {\n        if (hasParent$1(containerBlock, 'LI')) {\n          dom.insertAfter(newBlock, getContainerBlock(containerBlock));\n        } else {\n          dom.replace(newBlock, containerBlock);\n        }\n      } else if (isFirstOrLastLi(containerBlock, parentBlock, true)) {\n        if (hasParent$1(containerBlock, 'LI')) {\n          dom.insertAfter(newBlock, getContainerBlock(containerBlock));\n          newBlock.appendChild(dom.doc.createTextNode(' '));\n          newBlock.appendChild(containerBlock);\n        } else {\n          containerBlock.parentNode.insertBefore(newBlock, containerBlock);\n        }\n      } else if (isFirstOrLastLi(containerBlock, parentBlock, false)) {\n        dom.insertAfter(newBlock, getContainerBlock(containerBlock));\n      } else {\n        containerBlock = getContainerBlock(containerBlock);\n        var tmpRng = rng.cloneRange();\n        tmpRng.setStartAfter(parentBlock);\n        tmpRng.setEndAfter(containerBlock);\n        var fragment = tmpRng.extractContents();\n        if (newBlockName === 'LI' && hasFirstChild(fragment, 'LI')) {\n          newBlock = fragment.firstChild;\n          dom.insertAfter(fragment, containerBlock);\n        } else {\n          dom.insertAfter(fragment, containerBlock);\n          dom.insertAfter(newBlock, containerBlock);\n        }\n      }\n      dom.remove(parentBlock);\n      NewLineUtils.moveToCaretPosition(editor, newBlock);\n    };\n    var InsertLi = { insert: insert$1 };\n\n    var trimZwsp = function (fragment) {\n      each(descendants(Element.fromDom(fragment), isText), function (text) {\n        var rawNode = text.dom();\n        rawNode.nodeValue = Zwsp.trim(rawNode.nodeValue);\n      });\n    };\n    var isEmptyAnchor = function (dom, elm) {\n      return elm && elm.nodeName === 'A' && dom.isEmpty(elm);\n    };\n    var isTableCell$5 = function (node) {\n      return node && /^(TD|TH|CAPTION)$/.test(node.nodeName);\n    };\n    var emptyBlock = function (elm) {\n      elm.innerHTML = '<br data-mce-bogus=\"1\">';\n    };\n    var containerAndSiblingName = function (container, nodeName) {\n      return container.nodeName === nodeName || container.previousSibling && container.previousSibling.nodeName === nodeName;\n    };\n    var canSplitBlock = function (dom, node) {\n      return node && dom.isBlock(node) && !/^(TD|TH|CAPTION|FORM)$/.test(node.nodeName) && !/^(fixed|absolute)/i.test(node.style.position) && dom.getContentEditable(node) !== 'true';\n    };\n    var trimInlineElementsOnLeftSideOfBlock = function (dom, nonEmptyElementsMap, block) {\n      var node = block;\n      var firstChilds = [];\n      var i;\n      if (!node) {\n        return;\n      }\n      while (node = node.firstChild) {\n        if (dom.isBlock(node)) {\n          return;\n        }\n        if (NodeType.isElement(node) && !nonEmptyElementsMap[node.nodeName.toLowerCase()]) {\n          firstChilds.push(node);\n        }\n      }\n      i = firstChilds.length;\n      while (i--) {\n        node = firstChilds[i];\n        if (!node.hasChildNodes() || node.firstChild === node.lastChild && node.firstChild.nodeValue === '') {\n          dom.remove(node);\n        } else {\n          if (isEmptyAnchor(dom, node)) {\n            dom.remove(node);\n          }\n        }\n      }\n    };\n    var normalizeZwspOffset = function (start, container, offset) {\n      if (NodeType.isText(container) === false) {\n        return offset;\n      } else if (start) {\n        return offset === 1 && container.data.charAt(offset - 1) === Zwsp.ZWSP ? 0 : offset;\n      } else {\n        return offset === container.data.length - 1 && container.data.charAt(offset) === Zwsp.ZWSP ? container.data.length : offset;\n      }\n    };\n    var includeZwspInRange = function (rng) {\n      var newRng = rng.cloneRange();\n      newRng.setStart(rng.startContainer, normalizeZwspOffset(true, rng.startContainer, rng.startOffset));\n      newRng.setEnd(rng.endContainer, normalizeZwspOffset(false, rng.endContainer, rng.endOffset));\n      return newRng;\n    };\n    var trimLeadingLineBreaks = function (node) {\n      do {\n        if (NodeType.isText(node)) {\n          node.nodeValue = node.nodeValue.replace(/^[\\r\\n]+/, '');\n        }\n        node = node.firstChild;\n      } while (node);\n    };\n    var getEditableRoot$1 = function (dom, node) {\n      var root = dom.getRoot();\n      var parent, editableRoot;\n      parent = node;\n      while (parent !== root && dom.getContentEditable(parent) !== 'false') {\n        if (dom.getContentEditable(parent) === 'true') {\n          editableRoot = parent;\n        }\n        parent = parent.parentNode;\n      }\n      return parent !== root ? editableRoot : root;\n    };\n    var applyAttributes = function (editor, node, forcedRootBlockAttrs) {\n      Option.from(forcedRootBlockAttrs.style).map(editor.dom.parseStyle).each(function (attrStyles) {\n        var currentStyles = getAllRaw(Element.fromDom(node));\n        var newStyles = __assign(__assign({}, currentStyles), attrStyles);\n        editor.dom.setStyles(node, newStyles);\n      });\n      var attrClassesOpt = Option.from(forcedRootBlockAttrs.class).map(function (attrClasses) {\n        return attrClasses.split(/\\s+/);\n      });\n      var currentClassesOpt = Option.from(node.className).map(function (currentClasses) {\n        return filter(currentClasses.split(/\\s+/), function (clazz) {\n          return clazz !== '';\n        });\n      });\n      lift2(attrClassesOpt, currentClassesOpt, function (attrClasses, currentClasses) {\n        var filteredClasses = filter(currentClasses, function (clazz) {\n          return !contains(attrClasses, clazz);\n        });\n        var newClasses = __spreadArrays(attrClasses, filteredClasses);\n        editor.dom.setAttrib(node, 'class', newClasses.join(' '));\n      });\n      var appliedAttrs = [\n        'style',\n        'class'\n      ];\n      var remainingAttrs = bifilter(forcedRootBlockAttrs, function (_, attrs) {\n        return !contains(appliedAttrs, attrs);\n      }).t;\n      editor.dom.setAttribs(node, remainingAttrs);\n    };\n    var setForcedBlockAttrs = function (editor, node) {\n      var forcedRootBlockName = Settings.getForcedRootBlock(editor);\n      if (forcedRootBlockName && forcedRootBlockName.toLowerCase() === node.tagName.toLowerCase()) {\n        var forcedRootBlockAttrs = Settings.getForcedRootBlockAttrs(editor);\n        applyAttributes(editor, node, forcedRootBlockAttrs);\n      }\n    };\n    var wrapSelfAndSiblingsInDefaultBlock = function (editor, newBlockName, rng, container, offset) {\n      var newBlock, parentBlock, startNode, node, next, rootBlockName;\n      var blockName = newBlockName || 'P';\n      var dom = editor.dom, editableRoot = getEditableRoot$1(dom, container);\n      parentBlock = dom.getParent(container, dom.isBlock);\n      if (!parentBlock || !canSplitBlock(dom, parentBlock)) {\n        parentBlock = parentBlock || editableRoot;\n        if (parentBlock === editor.getBody() || isTableCell$5(parentBlock)) {\n          rootBlockName = parentBlock.nodeName.toLowerCase();\n        } else {\n          rootBlockName = parentBlock.parentNode.nodeName.toLowerCase();\n        }\n        if (!parentBlock.hasChildNodes()) {\n          newBlock = dom.create(blockName);\n          setForcedBlockAttrs(editor, newBlock);\n          parentBlock.appendChild(newBlock);\n          rng.setStart(newBlock, 0);\n          rng.setEnd(newBlock, 0);\n          return newBlock;\n        }\n        node = container;\n        while (node.parentNode !== parentBlock) {\n          node = node.parentNode;\n        }\n        while (node && !dom.isBlock(node)) {\n          startNode = node;\n          node = node.previousSibling;\n        }\n        if (startNode && editor.schema.isValidChild(rootBlockName, blockName.toLowerCase())) {\n          newBlock = dom.create(blockName);\n          setForcedBlockAttrs(editor, newBlock);\n          startNode.parentNode.insertBefore(newBlock, startNode);\n          node = startNode;\n          while (node && !dom.isBlock(node)) {\n            next = node.nextSibling;\n            newBlock.appendChild(node);\n            node = next;\n          }\n          rng.setStart(container, offset);\n          rng.setEnd(container, offset);\n        }\n      }\n      return container;\n    };\n    var addBrToBlockIfNeeded = function (dom, block) {\n      var lastChild;\n      block.normalize();\n      lastChild = block.lastChild;\n      if (!lastChild || /^(left|right)$/gi.test(dom.getStyle(lastChild, 'float', true))) {\n        dom.add(block, 'br');\n      }\n    };\n    var insert$2 = function (editor, evt) {\n      var tmpRng, editableRoot, container, offset, parentBlock, shiftKey;\n      var newBlock, fragment, containerBlock, parentBlockName, containerBlockName, newBlockName, isAfterLastNodeInContainer;\n      var dom = editor.dom;\n      var schema = editor.schema, nonEmptyElementsMap = schema.getNonEmptyElements();\n      var rng = editor.selection.getRng();\n      var createNewBlock = function (name) {\n        var node = container, block, clonedNode, caretNode;\n        var textInlineElements = schema.getTextInlineElements();\n        if (name || parentBlockName === 'TABLE' || parentBlockName === 'HR') {\n          block = dom.create(name || newBlockName);\n        } else {\n          block = parentBlock.cloneNode(false);\n        }\n        caretNode = block;\n        if (Settings.shouldKeepStyles(editor) === false) {\n          dom.setAttrib(block, 'style', null);\n          dom.setAttrib(block, 'class', null);\n        } else {\n          do {\n            if (textInlineElements[node.nodeName]) {\n              if (isCaretNode(node) || Bookmarks.isBookmarkNode(node)) {\n                continue;\n              }\n              clonedNode = node.cloneNode(false);\n              dom.setAttrib(clonedNode, 'id', '');\n              if (block.hasChildNodes()) {\n                clonedNode.appendChild(block.firstChild);\n                block.appendChild(clonedNode);\n              } else {\n                caretNode = clonedNode;\n                block.appendChild(clonedNode);\n              }\n            }\n          } while ((node = node.parentNode) && node !== editableRoot);\n        }\n        setForcedBlockAttrs(editor, block);\n        emptyBlock(caretNode);\n        return block;\n      };\n      var isCaretAtStartOrEndOfBlock = function (start) {\n        var walker, node, name, normalizedOffset;\n        normalizedOffset = normalizeZwspOffset(start, container, offset);\n        if (NodeType.isText(container) && (start ? normalizedOffset > 0 : normalizedOffset < container.nodeValue.length)) {\n          return false;\n        }\n        if (container.parentNode === parentBlock && isAfterLastNodeInContainer && !start) {\n          return true;\n        }\n        if (start && NodeType.isElement(container) && container === parentBlock.firstChild) {\n          return true;\n        }\n        if (containerAndSiblingName(container, 'TABLE') || containerAndSiblingName(container, 'HR')) {\n          return isAfterLastNodeInContainer && !start || !isAfterLastNodeInContainer && start;\n        }\n        walker = new TreeWalker(container, parentBlock);\n        if (NodeType.isText(container)) {\n          if (start && normalizedOffset === 0) {\n            walker.prev();\n          } else if (!start && normalizedOffset === container.nodeValue.length) {\n            walker.next();\n          }\n        }\n        while (node = walker.current()) {\n          if (NodeType.isElement(node)) {\n            if (!node.getAttribute('data-mce-bogus')) {\n              name = node.nodeName.toLowerCase();\n              if (nonEmptyElementsMap[name] && name !== 'br') {\n                return false;\n              }\n            }\n          } else if (NodeType.isText(node) && !/^[ \\t\\r\\n]*$/.test(node.nodeValue)) {\n            return false;\n          }\n          if (start) {\n            walker.prev();\n          } else {\n            walker.next();\n          }\n        }\n        return true;\n      };\n      var insertNewBlockAfter = function () {\n        if (/^(H[1-6]|PRE|FIGURE)$/.test(parentBlockName) && containerBlockName !== 'HGROUP') {\n          newBlock = createNewBlock(newBlockName);\n        } else {\n          newBlock = createNewBlock();\n        }\n        if (Settings.shouldEndContainerOnEmptyBlock(editor) && canSplitBlock(dom, containerBlock) && dom.isEmpty(parentBlock)) {\n          newBlock = dom.split(containerBlock, parentBlock);\n        } else {\n          dom.insertAfter(newBlock, parentBlock);\n        }\n        NewLineUtils.moveToCaretPosition(editor, newBlock);\n      };\n      NormalizeRange.normalize(dom, rng).each(function (normRng) {\n        rng.setStart(normRng.startContainer, normRng.startOffset);\n        rng.setEnd(normRng.endContainer, normRng.endOffset);\n      });\n      container = rng.startContainer;\n      offset = rng.startOffset;\n      newBlockName = Settings.getForcedRootBlock(editor);\n      shiftKey = evt.shiftKey;\n      if (NodeType.isElement(container) && container.hasChildNodes()) {\n        isAfterLastNodeInContainer = offset > container.childNodes.length - 1;\n        container = container.childNodes[Math.min(offset, container.childNodes.length - 1)] || container;\n        if (isAfterLastNodeInContainer && NodeType.isText(container)) {\n          offset = container.nodeValue.length;\n        } else {\n          offset = 0;\n        }\n      }\n      editableRoot = getEditableRoot$1(dom, container);\n      if (!editableRoot) {\n        return;\n      }\n      if (newBlockName && !shiftKey || !newBlockName && shiftKey) {\n        container = wrapSelfAndSiblingsInDefaultBlock(editor, newBlockName, rng, container, offset);\n      }\n      parentBlock = dom.getParent(container, dom.isBlock);\n      containerBlock = parentBlock ? dom.getParent(parentBlock.parentNode, dom.isBlock) : null;\n      parentBlockName = parentBlock ? parentBlock.nodeName.toUpperCase() : '';\n      containerBlockName = containerBlock ? containerBlock.nodeName.toUpperCase() : '';\n      if (containerBlockName === 'LI' && !evt.ctrlKey) {\n        parentBlock = containerBlock;\n        containerBlock = containerBlock.parentNode;\n        parentBlockName = containerBlockName;\n      }\n      if (/^(LI|DT|DD)$/.test(parentBlockName)) {\n        if (dom.isEmpty(parentBlock)) {\n          InsertLi.insert(editor, createNewBlock, containerBlock, parentBlock, newBlockName);\n          return;\n        }\n      }\n      if (newBlockName && parentBlock === editor.getBody()) {\n        return;\n      }\n      newBlockName = newBlockName || 'P';\n      if (isCaretContainerBlock(parentBlock)) {\n        newBlock = showCaretContainerBlock(parentBlock);\n        if (dom.isEmpty(parentBlock)) {\n          emptyBlock(parentBlock);\n        }\n        setForcedBlockAttrs(editor, newBlock);\n        NewLineUtils.moveToCaretPosition(editor, newBlock);\n      } else if (isCaretAtStartOrEndOfBlock()) {\n        insertNewBlockAfter();\n      } else if (isCaretAtStartOrEndOfBlock(true)) {\n        newBlock = parentBlock.parentNode.insertBefore(createNewBlock(), parentBlock);\n        NewLineUtils.moveToCaretPosition(editor, containerAndSiblingName(parentBlock, 'HR') ? newBlock : parentBlock);\n      } else {\n        tmpRng = includeZwspInRange(rng).cloneRange();\n        tmpRng.setEndAfter(parentBlock);\n        fragment = tmpRng.extractContents();\n        trimZwsp(fragment);\n        trimLeadingLineBreaks(fragment);\n        newBlock = fragment.firstChild;\n        dom.insertAfter(fragment, parentBlock);\n        trimInlineElementsOnLeftSideOfBlock(dom, nonEmptyElementsMap, newBlock);\n        addBrToBlockIfNeeded(dom, parentBlock);\n        if (dom.isEmpty(parentBlock)) {\n          emptyBlock(parentBlock);\n        }\n        newBlock.normalize();\n        if (dom.isEmpty(newBlock)) {\n          dom.remove(newBlock);\n          insertNewBlockAfter();\n        } else {\n          setForcedBlockAttrs(editor, newBlock);\n          NewLineUtils.moveToCaretPosition(editor, newBlock);\n        }\n      }\n      dom.setAttrib(newBlock, 'id', '');\n      editor.fire('NewBlock', { newBlock: newBlock });\n    };\n    var InsertBlock = { insert: insert$2 };\n\n    var matchesSelector = function (editor, selector) {\n      return NewLineUtils.getParentBlock(editor).filter(function (parentBlock) {\n        return selector.length > 0 && is$1(Element.fromDom(parentBlock), selector);\n      }).isSome();\n    };\n    var shouldInsertBr = function (editor) {\n      return matchesSelector(editor, Settings.getBrNewLineSelector(editor));\n    };\n    var shouldBlockNewLine = function (editor) {\n      return matchesSelector(editor, Settings.getNoNewLineSelector(editor));\n    };\n    var ContextSelectors = {\n      shouldInsertBr: shouldInsertBr,\n      shouldBlockNewLine: shouldBlockNewLine\n    };\n\n    var newLineAction = Adt.generate([\n      { br: [] },\n      { block: [] },\n      { none: [] }\n    ]);\n    var shouldBlockNewLine$1 = function (editor, shiftKey) {\n      return ContextSelectors.shouldBlockNewLine(editor);\n    };\n    var isBrMode = function (requiredState) {\n      return function (editor, shiftKey) {\n        var brMode = Settings.getForcedRootBlock(editor) === '';\n        return brMode === requiredState;\n      };\n    };\n    var inListBlock = function (requiredState) {\n      return function (editor, shiftKey) {\n        return NewLineUtils.isListItemParentBlock(editor) === requiredState;\n      };\n    };\n    var inBlock = function (blockName, requiredState) {\n      return function (editor, shiftKey) {\n        var state = NewLineUtils.getParentBlockName(editor) === blockName.toUpperCase();\n        return state === requiredState;\n      };\n    };\n    var inPreBlock = function (requiredState) {\n      return inBlock('pre', requiredState);\n    };\n    var inSummaryBlock = function () {\n      return inBlock('summary', true);\n    };\n    var shouldPutBrInPre$1 = function (requiredState) {\n      return function (editor, shiftKey) {\n        return Settings.shouldPutBrInPre(editor) === requiredState;\n      };\n    };\n    var inBrContext = function (editor, shiftKey) {\n      return ContextSelectors.shouldInsertBr(editor);\n    };\n    var hasShiftKey = function (editor, shiftKey) {\n      return shiftKey;\n    };\n    var canInsertIntoEditableRoot = function (editor) {\n      var forcedRootBlock = Settings.getForcedRootBlock(editor);\n      var rootEditable = NewLineUtils.getEditableRoot(editor.dom, editor.selection.getStart());\n      return rootEditable && editor.schema.isValidChild(rootEditable.nodeName, forcedRootBlock ? forcedRootBlock : 'P');\n    };\n    var match$2 = function (predicates, action) {\n      return function (editor, shiftKey) {\n        var isMatch = foldl(predicates, function (res, p) {\n          return res && p(editor, shiftKey);\n        }, true);\n        return isMatch ? Option.some(action) : Option.none();\n      };\n    };\n    var getAction$1 = function (editor, evt) {\n      return LazyEvaluator.evaluateUntil([\n        match$2([shouldBlockNewLine$1], newLineAction.none()),\n        match$2([inSummaryBlock()], newLineAction.br()),\n        match$2([\n          inPreBlock(true),\n          shouldPutBrInPre$1(false),\n          hasShiftKey\n        ], newLineAction.br()),\n        match$2([\n          inPreBlock(true),\n          shouldPutBrInPre$1(false)\n        ], newLineAction.block()),\n        match$2([\n          inPreBlock(true),\n          shouldPutBrInPre$1(true),\n          hasShiftKey\n        ], newLineAction.block()),\n        match$2([\n          inPreBlock(true),\n          shouldPutBrInPre$1(true)\n        ], newLineAction.br()),\n        match$2([\n          inListBlock(true),\n          hasShiftKey\n        ], newLineAction.br()),\n        match$2([inListBlock(true)], newLineAction.block()),\n        match$2([\n          isBrMode(true),\n          hasShiftKey,\n          canInsertIntoEditableRoot\n        ], newLineAction.block()),\n        match$2([isBrMode(true)], newLineAction.br()),\n        match$2([inBrContext], newLineAction.br()),\n        match$2([\n          isBrMode(false),\n          hasShiftKey\n        ], newLineAction.br()),\n        match$2([canInsertIntoEditableRoot], newLineAction.block())\n      ], [\n        editor,\n        evt.shiftKey\n      ]).getOr(newLineAction.none());\n    };\n    var NewLineAction = { getAction: getAction$1 };\n\n    var insert$3 = function (editor, evt) {\n      NewLineAction.getAction(editor, evt).fold(function () {\n        InsertBr.insert(editor, evt);\n      }, function () {\n        InsertBlock.insert(editor, evt);\n      }, noop);\n    };\n    var InsertNewLine = { insert: insert$3 };\n\n    var endTypingLevel = function (undoManager) {\n      if (undoManager.typing) {\n        undoManager.typing = false;\n        undoManager.add();\n      }\n    };\n    var handleEnterKeyEvent = function (editor, event) {\n      if (event.isDefaultPrevented()) {\n        return;\n      }\n      event.preventDefault();\n      endTypingLevel(editor.undoManager);\n      editor.undoManager.transact(function () {\n        if (editor.selection.isCollapsed() === false) {\n          editor.execCommand('Delete');\n        }\n        InsertNewLine.insert(editor, event);\n      });\n    };\n    var setup$9 = function (editor) {\n      editor.on('keydown', function (event) {\n        if (event.keyCode === VK.ENTER) {\n          handleEnterKeyEvent(editor, event);\n        }\n      });\n    };\n    var EnterKey = { setup: setup$9 };\n\n    var insertTextAtPosition = function (text, pos) {\n      var container = pos.container();\n      var offset = pos.offset();\n      if (NodeType.isText(container)) {\n        container.insertData(offset, text);\n        return Option.some(CaretPosition(container, offset + text.length));\n      } else {\n        return getElementFromPosition(pos).map(function (elm) {\n          var textNode = Element.fromText(text);\n          if (pos.isAtEnd()) {\n            after(elm, textNode);\n          } else {\n            before(elm, textNode);\n          }\n          return CaretPosition(textNode.dom(), text.length);\n        });\n      }\n    };\n    var insertNbspAtPosition = curry(insertTextAtPosition, '\\xA0');\n    var insertSpaceAtPosition = curry(insertTextAtPosition, ' ');\n\n    var navigateIgnoreEmptyTextNodes = function (forward, root, from) {\n      return CaretFinder.navigateIgnore(forward, root, from, isEmptyText);\n    };\n    var getClosestBlock = function (root, pos) {\n      return find(Parents.parentsAndSelf(Element.fromDom(pos.container()), root), isBlock);\n    };\n    var isAtBeforeAfterBlockBoundary = function (forward, root, pos) {\n      return navigateIgnoreEmptyTextNodes(forward, root.dom(), pos).forall(function (newPos) {\n        return getClosestBlock(root, pos).fold(function () {\n          return isInSameBlock(newPos, pos, root.dom()) === false;\n        }, function (fromBlock) {\n          return isInSameBlock(newPos, pos, root.dom()) === false && contains$3(fromBlock, Element.fromDom(newPos.container()));\n        });\n      });\n    };\n    var isAtBlockBoundary = function (forward, root, pos) {\n      return getClosestBlock(root, pos).fold(function () {\n        return navigateIgnoreEmptyTextNodes(forward, root.dom(), pos).forall(function (newPos) {\n          return isInSameBlock(newPos, pos, root.dom()) === false;\n        });\n      }, function (parent) {\n        return navigateIgnoreEmptyTextNodes(forward, parent.dom(), pos).isNone();\n      });\n    };\n    var isAtStartOfBlock = curry(isAtBlockBoundary, false);\n    var isAtEndOfBlock = curry(isAtBlockBoundary, true);\n    var isBeforeBlock = curry(isAtBeforeAfterBlockBoundary, false);\n    var isAfterBlock = curry(isAtBeforeAfterBlockBoundary, true);\n\n    var nbsp = '\\xA0';\n    var isInMiddleOfText = function (pos) {\n      return CaretPosition.isTextPosition(pos) && !pos.isAtStart() && !pos.isAtEnd();\n    };\n    var getClosestBlock$1 = function (root, pos) {\n      var parentBlocks = filter(Parents.parentsAndSelf(Element.fromDom(pos.container()), root), isBlock);\n      return head(parentBlocks).getOr(root);\n    };\n    var hasSpaceBefore = function (root, pos) {\n      if (isInMiddleOfText(pos)) {\n        return isAfterSpace(pos);\n      } else {\n        return isAfterSpace(pos) || CaretFinder.prevPosition(getClosestBlock$1(root, pos).dom(), pos).exists(isAfterSpace);\n      }\n    };\n    var hasSpaceAfter = function (root, pos) {\n      if (isInMiddleOfText(pos)) {\n        return isBeforeSpace(pos);\n      } else {\n        return isBeforeSpace(pos) || CaretFinder.nextPosition(getClosestBlock$1(root, pos).dom(), pos).exists(isBeforeSpace);\n      }\n    };\n    var isPreValue = function (value) {\n      return contains([\n        'pre',\n        'pre-wrap'\n      ], value);\n    };\n    var isInPre = function (pos) {\n      return getElementFromPosition(pos).bind(function (elm) {\n        return closest(elm, isElement);\n      }).exists(function (elm) {\n        return isPreValue(get$1(elm, 'white-space'));\n      });\n    };\n    var isAtBeginningOfBody = function (root, pos) {\n      return CaretFinder.prevPosition(root.dom(), pos).isNone();\n    };\n    var isAtEndOfBody = function (root, pos) {\n      return CaretFinder.nextPosition(root.dom(), pos).isNone();\n    };\n    var isAtLineBoundary = function (root, pos) {\n      return isAtBeginningOfBody(root, pos) || isAtEndOfBody(root, pos) || isAtStartOfBlock(root, pos) || isAtEndOfBlock(root, pos) || isAfterBr(root, pos) || isBeforeBr(root, pos);\n    };\n    var needsToHaveNbsp = function (root, pos) {\n      if (isInPre(pos)) {\n        return false;\n      } else {\n        return isAtLineBoundary(root, pos) || hasSpaceBefore(root, pos) || hasSpaceAfter(root, pos);\n      }\n    };\n    var needsToBeNbspLeft = function (root, pos) {\n      if (isInPre(pos)) {\n        return false;\n      } else {\n        return isAtStartOfBlock(root, pos) || isBeforeBlock(root, pos) || isAfterBr(root, pos) || hasSpaceBefore(root, pos);\n      }\n    };\n    var leanRight = function (pos) {\n      var container = pos.container();\n      var offset = pos.offset();\n      if (NodeType.isText(container) && offset < container.data.length) {\n        return CaretPosition(container, offset + 1);\n      } else {\n        return pos;\n      }\n    };\n    var needsToBeNbspRight = function (root, pos) {\n      var afterPos = leanRight(pos);\n      if (isInPre(afterPos)) {\n        return false;\n      } else {\n        return isAtEndOfBlock(root, afterPos) || isAfterBlock(root, afterPos) || isBeforeBr(root, afterPos) || hasSpaceAfter(root, afterPos);\n      }\n    };\n    var needsToBeNbsp = function (root, pos) {\n      return needsToBeNbspLeft(root, pos) || needsToBeNbspRight(root, pos);\n    };\n    var isNbspAt = function (text, offset) {\n      return isNbsp(text.charAt(offset));\n    };\n    var hasNbsp = function (pos) {\n      var container = pos.container();\n      return NodeType.isText(container) && contains$2(container.data, nbsp);\n    };\n    var normalizeNbspMiddle = function (text) {\n      var chars = text.split('');\n      return map(chars, function (chr, i) {\n        if (isNbsp(chr) && i > 0 && i < chars.length - 1 && isContent$1(chars[i - 1]) && isContent$1(chars[i + 1])) {\n          return ' ';\n        } else {\n          return chr;\n        }\n      }).join('');\n    };\n    var normalizeNbspAtStart = function (root, node) {\n      var text = node.data;\n      var firstPos = CaretPosition(node, 0);\n      if (isNbspAt(text, 0) && !needsToBeNbsp(root, firstPos)) {\n        node.data = ' ' + text.slice(1);\n        return true;\n      } else {\n        return false;\n      }\n    };\n    var normalizeNbspInMiddleOfTextNode = function (node) {\n      var text = node.data;\n      var newText = normalizeNbspMiddle(text);\n      if (newText !== text) {\n        node.data = newText;\n        return true;\n      } else {\n        return false;\n      }\n    };\n    var normalizeNbspAtEnd = function (root, node) {\n      var text = node.data;\n      var lastPos = CaretPosition(node, text.length - 1);\n      if (isNbspAt(text, text.length - 1) && !needsToBeNbsp(root, lastPos)) {\n        node.data = text.slice(0, -1) + ' ';\n        return true;\n      } else {\n        return false;\n      }\n    };\n    var normalizeNbsps = function (root, pos) {\n      return Option.some(pos).filter(hasNbsp).bind(function (pos) {\n        var container = pos.container();\n        var normalized = normalizeNbspAtStart(root, container) || normalizeNbspInMiddleOfTextNode(container) || normalizeNbspAtEnd(root, container);\n        return normalized ? Option.some(pos) : Option.none();\n      });\n    };\n    var normalizeNbspsInEditor = function (editor) {\n      var root = Element.fromDom(editor.getBody());\n      if (editor.selection.isCollapsed()) {\n        normalizeNbsps(root, CaretPosition.fromRangeStart(editor.selection.getRng())).each(function (pos) {\n          editor.selection.setRng(pos.toRange());\n        });\n      }\n    };\n\n    var locationToCaretPosition = function (root) {\n      return function (location) {\n        return location.fold(function (element) {\n          return CaretFinder.prevPosition(root.dom(), CaretPosition$1.before(element));\n        }, function (element) {\n          return CaretFinder.firstPositionIn(element);\n        }, function (element) {\n          return CaretFinder.lastPositionIn(element);\n        }, function (element) {\n          return CaretFinder.nextPosition(root.dom(), CaretPosition$1.after(element));\n        });\n      };\n    };\n    var insertInlineBoundarySpaceOrNbsp = function (root, pos) {\n      return function (checkPos) {\n        return needsToHaveNbsp(root, checkPos) ? insertNbspAtPosition(pos) : insertSpaceAtPosition(pos);\n      };\n    };\n    var setSelection$1 = function (editor) {\n      return function (pos) {\n        editor.selection.setRng(pos.toRange());\n        editor.nodeChanged();\n        return true;\n      };\n    };\n    var insertSpaceOrNbspAtSelection = function (editor) {\n      var pos = CaretPosition$1.fromRangeStart(editor.selection.getRng());\n      var root = Element.fromDom(editor.getBody());\n      if (editor.selection.isCollapsed()) {\n        var isInlineTarget = curry(InlineUtils.isInlineTarget, editor);\n        var caretPosition = CaretPosition$1.fromRangeStart(editor.selection.getRng());\n        return BoundaryLocation.readLocation(isInlineTarget, editor.getBody(), caretPosition).bind(locationToCaretPosition(root)).bind(insertInlineBoundarySpaceOrNbsp(root, pos)).exists(setSelection$1(editor));\n      } else {\n        return false;\n      }\n    };\n\n    var executeKeydownOverride$2 = function (editor, evt) {\n      MatchKeys.execute([{\n          keyCode: VK.SPACEBAR,\n          action: MatchKeys.action(insertSpaceOrNbspAtSelection, editor)\n        }], evt).each(function (_) {\n        evt.preventDefault();\n      });\n    };\n    var setup$a = function (editor) {\n      editor.on('keydown', function (evt) {\n        if (evt.isDefaultPrevented() === false) {\n          executeKeydownOverride$2(editor, evt);\n        }\n      });\n    };\n    var SpaceKey = { setup: setup$a };\n\n    var findBlockCaretContainer = function (editor) {\n      return descendant(Element.fromDom(editor.getBody()), '*[data-mce-caret]').fold(constant(null), function (elm) {\n        return elm.dom();\n      });\n    };\n    var removeIeControlRect = function (editor) {\n      editor.selection.setRng(editor.selection.getRng());\n    };\n    var showBlockCaretContainer = function (editor, blockCaretContainer) {\n      if (blockCaretContainer.hasAttribute('data-mce-caret')) {\n        showCaretContainerBlock(blockCaretContainer);\n        removeIeControlRect(editor);\n        editor.selection.scrollIntoView(blockCaretContainer);\n      }\n    };\n    var handleBlockContainer = function (editor, e) {\n      var blockCaretContainer = findBlockCaretContainer(editor);\n      if (!blockCaretContainer) {\n        return;\n      }\n      if (e.type === 'compositionstart') {\n        e.preventDefault();\n        e.stopPropagation();\n        showBlockCaretContainer(editor, blockCaretContainer);\n        return;\n      }\n      if (hasContent(blockCaretContainer)) {\n        showBlockCaretContainer(editor, blockCaretContainer);\n        editor.undoManager.add();\n      }\n    };\n    var setup$b = function (editor) {\n      editor.on('keyup compositionstart', curry(handleBlockContainer, editor));\n    };\n    var CaretContainerInput = { setup: setup$b };\n\n    var browser$4 = PlatformDetection$1.detect().browser;\n    var setupIeInput = function (editor) {\n      var keypressThrotter = first(function () {\n        if (!editor.composing) {\n          normalizeNbspsInEditor(editor);\n        }\n      }, 0);\n      if (browser$4.isIE()) {\n        editor.on('keypress', function (e) {\n          keypressThrotter.throttle();\n        });\n        editor.on('remove', function (e) {\n          keypressThrotter.cancel();\n        });\n      }\n    };\n    var setup$c = function (editor) {\n      setupIeInput(editor);\n      editor.on('input', function (e) {\n        if (e.isComposing === false) {\n          normalizeNbspsInEditor(editor);\n        }\n      });\n    };\n\n    var executeKeydownOverride$3 = function (editor, evt) {\n      MatchKeys.execute([\n        {\n          keyCode: VK.END,\n          action: moveToLineEndPoint(editor, true)\n        },\n        {\n          keyCode: VK.HOME,\n          action: moveToLineEndPoint(editor, false)\n        }\n      ], evt).each(function (_) {\n        evt.preventDefault();\n      });\n    };\n    var setup$d = function (editor) {\n      editor.on('keydown', function (evt) {\n        if (evt.isDefaultPrevented() === false) {\n          executeKeydownOverride$3(editor, evt);\n        }\n      });\n    };\n    var HomeEndKeys = { setup: setup$d };\n\n    var setup$e = function (editor) {\n      var caret = BoundarySelection.setupSelectedState(editor);\n      CaretContainerInput.setup(editor);\n      ArrowKeys.setup(editor, caret);\n      DeleteBackspaceKeys.setup(editor, caret);\n      EnterKey.setup(editor);\n      SpaceKey.setup(editor);\n      setup$c(editor);\n      HomeEndKeys.setup(editor);\n    };\n    var KeyboardOverrides = { setup: setup$e };\n\n    function Quirks (editor) {\n      var each = Tools.each;\n      var BACKSPACE = VK.BACKSPACE, DELETE = VK.DELETE, dom = editor.dom, selection = editor.selection, settings = editor.settings, parser = editor.parser;\n      var isGecko = Env.gecko, isIE = Env.ie, isWebKit = Env.webkit;\n      var mceInternalUrlPrefix = 'data:text/mce-internal,';\n      var mceInternalDataType = isIE ? 'Text' : 'URL';\n      var setEditorCommandState = function (cmd, state) {\n        try {\n          editor.getDoc().execCommand(cmd, false, state);\n        } catch (ex) {\n        }\n      };\n      var isDefaultPrevented = function (e) {\n        return e.isDefaultPrevented();\n      };\n      var setMceInternalContent = function (e) {\n        var selectionHtml, internalContent;\n        if (e.dataTransfer) {\n          if (editor.selection.isCollapsed() && e.target.tagName === 'IMG') {\n            selection.select(e.target);\n          }\n          selectionHtml = editor.selection.getContent();\n          if (selectionHtml.length > 0) {\n            internalContent = mceInternalUrlPrefix + escape(editor.id) + ',' + escape(selectionHtml);\n            e.dataTransfer.setData(mceInternalDataType, internalContent);\n          }\n        }\n      };\n      var getMceInternalContent = function (e) {\n        var internalContent;\n        if (e.dataTransfer) {\n          internalContent = e.dataTransfer.getData(mceInternalDataType);\n          if (internalContent && internalContent.indexOf(mceInternalUrlPrefix) >= 0) {\n            internalContent = internalContent.substr(mceInternalUrlPrefix.length).split(',');\n            return {\n              id: unescape(internalContent[0]),\n              html: unescape(internalContent[1])\n            };\n          }\n        }\n        return null;\n      };\n      var insertClipboardContents = function (content, internal) {\n        if (editor.queryCommandSupported('mceInsertClipboardContent')) {\n          editor.execCommand('mceInsertClipboardContent', false, {\n            content: content,\n            internal: internal\n          });\n        } else {\n          editor.execCommand('mceInsertContent', false, content);\n        }\n      };\n      var emptyEditorWhenDeleting = function () {\n        var serializeRng = function (rng) {\n          var body = dom.create('body');\n          var contents = rng.cloneContents();\n          body.appendChild(contents);\n          return selection.serializer.serialize(body, { format: 'html' });\n        };\n        var allContentsSelected = function (rng) {\n          var selection = serializeRng(rng);\n          var allRng = dom.createRng();\n          allRng.selectNode(editor.getBody());\n          var allSelection = serializeRng(allRng);\n          return selection === allSelection;\n        };\n        editor.on('keydown', function (e) {\n          var keyCode = e.keyCode;\n          var isCollapsed, body;\n          if (!isDefaultPrevented(e) && (keyCode === DELETE || keyCode === BACKSPACE)) {\n            isCollapsed = editor.selection.isCollapsed();\n            body = editor.getBody();\n            if (isCollapsed && !dom.isEmpty(body)) {\n              return;\n            }\n            if (!isCollapsed && !allContentsSelected(editor.selection.getRng())) {\n              return;\n            }\n            e.preventDefault();\n            editor.setContent('');\n            if (body.firstChild && dom.isBlock(body.firstChild)) {\n              editor.selection.setCursorLocation(body.firstChild, 0);\n            } else {\n              editor.selection.setCursorLocation(body, 0);\n            }\n            editor.nodeChanged();\n          }\n        });\n      };\n      var selectAll = function () {\n        editor.shortcuts.add('meta+a', null, 'SelectAll');\n      };\n      var inputMethodFocus = function () {\n        if (!editor.settings.content_editable) {\n          dom.bind(editor.getDoc(), 'mousedown mouseup', function (e) {\n            var rng;\n            if (e.target === editor.getDoc().documentElement) {\n              rng = selection.getRng();\n              editor.getBody().focus();\n              if (e.type === 'mousedown') {\n                if (isCaretContainer(rng.startContainer)) {\n                  return;\n                }\n                selection.placeCaretAt(e.clientX, e.clientY);\n              } else {\n                selection.setRng(rng);\n              }\n            }\n          });\n        }\n      };\n      var removeHrOnBackspace = function () {\n        editor.on('keydown', function (e) {\n          if (!isDefaultPrevented(e) && e.keyCode === BACKSPACE) {\n            if (!editor.getBody().getElementsByTagName('hr').length) {\n              return;\n            }\n            if (selection.isCollapsed() && selection.getRng().startOffset === 0) {\n              var node = selection.getNode();\n              var previousSibling = node.previousSibling;\n              if (node.nodeName === 'HR') {\n                dom.remove(node);\n                e.preventDefault();\n                return;\n              }\n              if (previousSibling && previousSibling.nodeName && previousSibling.nodeName.toLowerCase() === 'hr') {\n                dom.remove(previousSibling);\n                e.preventDefault();\n              }\n            }\n          }\n        });\n      };\n      var focusBody = function () {\n        if (!domGlobals.Range.prototype.getClientRects) {\n          editor.on('mousedown', function (e) {\n            if (!isDefaultPrevented(e) && e.target.nodeName === 'HTML') {\n              var body_1 = editor.getBody();\n              body_1.blur();\n              Delay.setEditorTimeout(editor, function () {\n                body_1.focus();\n              });\n            }\n          });\n        }\n      };\n      var selectControlElements = function () {\n        editor.on('click', function (e) {\n          var target = e.target;\n          if (/^(IMG|HR)$/.test(target.nodeName) && dom.getContentEditableParent(target) !== 'false') {\n            e.preventDefault();\n            editor.selection.select(target);\n            editor.nodeChanged();\n          }\n          if (target.nodeName === 'A' && dom.hasClass(target, 'mce-item-anchor')) {\n            e.preventDefault();\n            selection.select(target);\n          }\n        });\n      };\n      var removeStylesWhenDeletingAcrossBlockElements = function () {\n        var getAttributeApplyFunction = function () {\n          var template = dom.getAttribs(selection.getStart().cloneNode(false));\n          return function () {\n            var target = selection.getStart();\n            if (target !== editor.getBody()) {\n              dom.setAttrib(target, 'style', null);\n              each(template, function (attr) {\n                target.setAttributeNode(attr.cloneNode(true));\n              });\n            }\n          };\n        };\n        var isSelectionAcrossElements = function () {\n          return !selection.isCollapsed() && dom.getParent(selection.getStart(), dom.isBlock) !== dom.getParent(selection.getEnd(), dom.isBlock);\n        };\n        editor.on('keypress', function (e) {\n          var applyAttributes;\n          if (!isDefaultPrevented(e) && (e.keyCode === 8 || e.keyCode === 46) && isSelectionAcrossElements()) {\n            applyAttributes = getAttributeApplyFunction();\n            editor.getDoc().execCommand('delete', false, null);\n            applyAttributes();\n            e.preventDefault();\n            return false;\n          }\n        });\n        dom.bind(editor.getDoc(), 'cut', function (e) {\n          var applyAttributes;\n          if (!isDefaultPrevented(e) && isSelectionAcrossElements()) {\n            applyAttributes = getAttributeApplyFunction();\n            Delay.setEditorTimeout(editor, function () {\n              applyAttributes();\n            });\n          }\n        });\n      };\n      var disableBackspaceIntoATable = function () {\n        editor.on('keydown', function (e) {\n          if (!isDefaultPrevented(e) && e.keyCode === BACKSPACE) {\n            if (selection.isCollapsed() && selection.getRng().startOffset === 0) {\n              var previousSibling = selection.getNode().previousSibling;\n              if (previousSibling && previousSibling.nodeName && previousSibling.nodeName.toLowerCase() === 'table') {\n                e.preventDefault();\n                return false;\n              }\n            }\n          }\n        });\n      };\n      var removeBlockQuoteOnBackSpace = function () {\n        editor.on('keydown', function (e) {\n          var rng, container, offset, root, parent;\n          if (isDefaultPrevented(e) || e.keyCode !== VK.BACKSPACE) {\n            return;\n          }\n          rng = selection.getRng();\n          container = rng.startContainer;\n          offset = rng.startOffset;\n          root = dom.getRoot();\n          parent = container;\n          if (!rng.collapsed || offset !== 0) {\n            return;\n          }\n          while (parent && parent.parentNode && parent.parentNode.firstChild === parent && parent.parentNode !== root) {\n            parent = parent.parentNode;\n          }\n          if (parent.tagName === 'BLOCKQUOTE') {\n            editor.formatter.toggle('blockquote', null, parent);\n            rng = dom.createRng();\n            rng.setStart(container, 0);\n            rng.setEnd(container, 0);\n            selection.setRng(rng);\n          }\n        });\n      };\n      var setGeckoEditingOptions = function () {\n        var setOpts = function () {\n          setEditorCommandState('StyleWithCSS', false);\n          setEditorCommandState('enableInlineTableEditing', false);\n          if (!settings.object_resizing) {\n            setEditorCommandState('enableObjectResizing', false);\n          }\n        };\n        if (!settings.readonly) {\n          editor.on('BeforeExecCommand MouseDown', setOpts);\n        }\n      };\n      var addBrAfterLastLinks = function () {\n        var fixLinks = function () {\n          each(dom.select('a'), function (node) {\n            var parentNode = node.parentNode;\n            var root = dom.getRoot();\n            if (parentNode.lastChild === node) {\n              while (parentNode && !dom.isBlock(parentNode)) {\n                if (parentNode.parentNode.lastChild !== parentNode || parentNode === root) {\n                  return;\n                }\n                parentNode = parentNode.parentNode;\n              }\n              dom.add(parentNode, 'br', { 'data-mce-bogus': 1 });\n            }\n          });\n        };\n        editor.on('SetContent ExecCommand', function (e) {\n          if (e.type === 'setcontent' || e.command === 'mceInsertLink') {\n            fixLinks();\n          }\n        });\n      };\n      var setDefaultBlockType = function () {\n        if (settings.forced_root_block) {\n          editor.on('init', function () {\n            setEditorCommandState('DefaultParagraphSeparator', settings.forced_root_block);\n          });\n        }\n      };\n      var normalizeSelection = function () {\n        editor.on('keyup focusin mouseup', function (e) {\n          if (!VK.modifierPressed(e)) {\n            selection.normalize();\n          }\n        }, true);\n      };\n      var showBrokenImageIcon = function () {\n        editor.contentStyles.push('img:-moz-broken {' + '-moz-force-broken-image-icon:1;' + 'min-width:24px;' + 'min-height:24px' + '}');\n      };\n      var restoreFocusOnKeyDown = function () {\n        if (!editor.inline) {\n          editor.on('keydown', function () {\n            if (domGlobals.document.activeElement === domGlobals.document.body) {\n              editor.getWin().focus();\n            }\n          });\n        }\n      };\n      var bodyHeight = function () {\n        if (!editor.inline) {\n          editor.contentStyles.push('body {min-height: 150px}');\n          editor.on('click', function (e) {\n            var rng;\n            if (e.target.nodeName === 'HTML') {\n              if (Env.ie > 11) {\n                editor.getBody().focus();\n                return;\n              }\n              rng = editor.selection.getRng();\n              editor.getBody().focus();\n              editor.selection.setRng(rng);\n              editor.selection.normalize();\n              editor.nodeChanged();\n            }\n          });\n        }\n      };\n      var blockCmdArrowNavigation = function () {\n        if (Env.mac) {\n          editor.on('keydown', function (e) {\n            if (VK.metaKeyPressed(e) && !e.shiftKey && (e.keyCode === 37 || e.keyCode === 39)) {\n              e.preventDefault();\n              editor.selection.getSel().modify('move', e.keyCode === 37 ? 'backward' : 'forward', 'lineboundary');\n            }\n          });\n        }\n      };\n      var disableAutoUrlDetect = function () {\n        setEditorCommandState('AutoUrlDetect', false);\n      };\n      var tapLinksAndImages = function () {\n        editor.on('click', function (e) {\n          var elm = e.target;\n          do {\n            if (elm.tagName === 'A') {\n              e.preventDefault();\n              return;\n            }\n          } while (elm = elm.parentNode);\n        });\n        editor.contentStyles.push('.mce-content-body {-webkit-touch-callout: none}');\n      };\n      var blockFormSubmitInsideEditor = function () {\n        editor.on('init', function () {\n          editor.dom.bind(editor.getBody(), 'submit', function (e) {\n            e.preventDefault();\n          });\n        });\n      };\n      var removeAppleInterchangeBrs = function () {\n        parser.addNodeFilter('br', function (nodes) {\n          var i = nodes.length;\n          while (i--) {\n            if (nodes[i].attr('class') === 'Apple-interchange-newline') {\n              nodes[i].remove();\n            }\n          }\n        });\n      };\n      var ieInternalDragAndDrop = function () {\n        editor.on('dragstart', function (e) {\n          setMceInternalContent(e);\n        });\n        editor.on('drop', function (e) {\n          if (!isDefaultPrevented(e)) {\n            var internalContent = getMceInternalContent(e);\n            if (internalContent && internalContent.id !== editor.id) {\n              e.preventDefault();\n              var rng = CaretRangeFromPoint.fromPoint(e.x, e.y, editor.getDoc());\n              selection.setRng(rng);\n              insertClipboardContents(internalContent.html, true);\n            }\n          }\n        });\n      };\n      var refreshContentEditable = function () {\n      };\n      var isHidden = function () {\n        var sel;\n        if (!isGecko || editor.removed) {\n          return 0;\n        }\n        sel = editor.selection.getSel();\n        return !sel || !sel.rangeCount || sel.rangeCount === 0;\n      };\n      removeBlockQuoteOnBackSpace();\n      emptyEditorWhenDeleting();\n      if (!Env.windowsPhone) {\n        normalizeSelection();\n      }\n      if (isWebKit) {\n        inputMethodFocus();\n        selectControlElements();\n        setDefaultBlockType();\n        blockFormSubmitInsideEditor();\n        disableBackspaceIntoATable();\n        removeAppleInterchangeBrs();\n        if (Env.iOS) {\n          restoreFocusOnKeyDown();\n          bodyHeight();\n          tapLinksAndImages();\n        } else {\n          selectAll();\n        }\n      }\n      if (Env.ie >= 11) {\n        bodyHeight();\n        disableBackspaceIntoATable();\n      }\n      if (Env.ie) {\n        selectAll();\n        disableAutoUrlDetect();\n        ieInternalDragAndDrop();\n      }\n      if (isGecko) {\n        removeHrOnBackspace();\n        focusBody();\n        removeStylesWhenDeletingAcrossBlockElements();\n        setGeckoEditingOptions();\n        addBrAfterLastLinks();\n        showBrokenImageIcon();\n        blockCmdArrowNavigation();\n        disableBackspaceIntoATable();\n      }\n      return {\n        refreshContentEditable: refreshContentEditable,\n        isHidden: isHidden\n      };\n    }\n\n    var isTextBlockNode = function (node) {\n      return NodeType.isElement(node) && isTextBlock(Element.fromDom(node));\n    };\n    var normalizeSelection$1 = function (editor) {\n      var rng = editor.selection.getRng();\n      var startPos = CaretPosition.fromRangeStart(rng);\n      var endPos = CaretPosition.fromRangeEnd(rng);\n      if (CaretPosition.isElementPosition(startPos)) {\n        var container = startPos.container();\n        if (isTextBlockNode(container)) {\n          CaretFinder.firstPositionIn(container).each(function (pos) {\n            return rng.setStart(pos.container(), pos.offset());\n          });\n        }\n      }\n      if (CaretPosition.isElementPosition(endPos)) {\n        var container = startPos.container();\n        if (isTextBlockNode(container)) {\n          CaretFinder.lastPositionIn(container).each(function (pos) {\n            return rng.setEnd(pos.container(), pos.offset());\n          });\n        }\n      }\n      editor.selection.setRng(RangeNormalizer.normalize(rng));\n    };\n    var setup$f = function (editor) {\n      editor.on('click', function (e) {\n        if (e.detail >= 3) {\n          normalizeSelection$1(editor);\n        }\n      });\n    };\n\n    var preventSummaryToggle = function (editor) {\n      editor.on('click', function (e) {\n        if (editor.dom.getParent(e.target, 'details')) {\n          e.preventDefault();\n        }\n      });\n    };\n    var filterDetails = function (editor) {\n      editor.parser.addNodeFilter('details', function (elms) {\n        each(elms, function (details) {\n          details.attr('data-mce-open', details.attr('open'));\n          details.attr('open', 'open');\n        });\n      });\n      editor.serializer.addNodeFilter('details', function (elms) {\n        each(elms, function (details) {\n          var open = details.attr('data-mce-open');\n          details.attr('open', isString(open) ? open : null);\n          details.attr('data-mce-open', null);\n        });\n      });\n    };\n    var setup$g = function (editor) {\n      preventSummaryToggle(editor);\n      filterDetails(editor);\n    };\n\n    var DOM$2 = DOMUtils$1.DOM;\n    var appendStyle = function (editor, text) {\n      var head = Element.fromDom(editor.getDoc().head);\n      var tag = Element.fromTag('style');\n      set(tag, 'type', 'text/css');\n      append(tag, Element.fromText(text));\n      append(head, tag);\n    };\n    var createParser = function (editor) {\n      var parser = DomParser(editor.settings, editor.schema);\n      parser.addAttributeFilter('src,href,style,tabindex', function (nodes, name) {\n        var i = nodes.length, node;\n        var dom = editor.dom;\n        var value, internalName;\n        while (i--) {\n          node = nodes[i];\n          value = node.attr(name);\n          internalName = 'data-mce-' + name;\n          if (!node.attributes.map[internalName]) {\n            if (value.indexOf('data:') === 0 || value.indexOf('blob:') === 0) {\n              continue;\n            }\n            if (name === 'style') {\n              value = dom.serializeStyle(dom.parseStyle(value), node.name);\n              if (!value.length) {\n                value = null;\n              }\n              node.attr(internalName, value);\n              node.attr(name, value);\n            } else if (name === 'tabindex') {\n              node.attr(internalName, value);\n              node.attr(name, null);\n            } else {\n              node.attr(internalName, editor.convertURL(value, name, node.name));\n            }\n          }\n        }\n      });\n      parser.addNodeFilter('script', function (nodes) {\n        var i = nodes.length, node, type;\n        while (i--) {\n          node = nodes[i];\n          type = node.attr('type') || 'no/type';\n          if (type.indexOf('mce-') !== 0) {\n            node.attr('type', 'mce-' + type);\n          }\n        }\n      });\n      parser.addNodeFilter('#cdata', function (nodes) {\n        var i = nodes.length, node;\n        while (i--) {\n          node = nodes[i];\n          node.type = 8;\n          node.name = '#comment';\n          node.value = '[CDATA[' + node.value + ']]';\n        }\n      });\n      parser.addNodeFilter('p,h1,h2,h3,h4,h5,h6,div', function (nodes) {\n        var i = nodes.length, node;\n        var nonEmptyElements = editor.schema.getNonEmptyElements();\n        while (i--) {\n          node = nodes[i];\n          if (node.isEmpty(nonEmptyElements) && node.getAll('br').length === 0) {\n            node.append(new Node$1('br', 1)).shortEnded = true;\n          }\n        }\n      });\n      return parser;\n    };\n    var autoFocus = function (editor) {\n      if (editor.settings.auto_focus) {\n        Delay.setEditorTimeout(editor, function () {\n          var focusEditor;\n          if (editor.settings.auto_focus === true) {\n            focusEditor = editor;\n          } else {\n            focusEditor = editor.editorManager.get(editor.settings.auto_focus);\n          }\n          if (!focusEditor.destroyed) {\n            focusEditor.focus();\n          }\n        }, 100);\n      }\n    };\n    var initEditor = function (editor) {\n      editor.bindPendingEventDelegates();\n      editor.initialized = true;\n      editor.fire('init');\n      editor.focus(true);\n      editor.nodeChanged({ initial: true });\n      editor.execCallback('init_instance_callback', editor);\n      autoFocus(editor);\n    };\n    var getStyleSheetLoader = function (editor) {\n      return editor.inline ? DOM$2.styleSheetLoader : editor.dom.styleSheetLoader;\n    };\n    var initContentBody = function (editor, skipWrite) {\n      var settings = editor.settings;\n      var targetElm = editor.getElement();\n      var doc = editor.getDoc(), body, contentCssText;\n      if (!settings.inline) {\n        editor.getElement().style.visibility = editor.orgVisibility;\n      }\n      if (!skipWrite && !settings.content_editable) {\n        doc.open();\n        doc.write(editor.iframeHTML);\n        doc.close();\n      }\n      if (settings.content_editable) {\n        editor.on('remove', function () {\n          var bodyEl = this.getBody();\n          DOM$2.removeClass(bodyEl, 'mce-content-body');\n          DOM$2.removeClass(bodyEl, 'mce-edit-focus');\n          DOM$2.setAttrib(bodyEl, 'contentEditable', null);\n        });\n        DOM$2.addClass(targetElm, 'mce-content-body');\n        editor.contentDocument = doc = settings.content_document || domGlobals.document;\n        editor.contentWindow = settings.content_window || domGlobals.window;\n        editor.bodyElement = targetElm;\n        settings.content_document = settings.content_window = null;\n        settings.root_name = targetElm.nodeName.toLowerCase();\n      }\n      body = editor.getBody();\n      body.disabled = true;\n      editor.readonly = settings.readonly;\n      if (!editor.readonly) {\n        if (editor.inline && DOM$2.getStyle(body, 'position', true) === 'static') {\n          body.style.position = 'relative';\n        }\n        body.contentEditable = editor.getParam('content_editable_state', true);\n      }\n      body.disabled = false;\n      editor.editorUpload = EditorUpload(editor);\n      editor.schema = Schema(settings);\n      editor.dom = DOMUtils$1(doc, {\n        keep_values: true,\n        url_converter: editor.convertURL,\n        url_converter_scope: editor,\n        hex_colors: settings.force_hex_style_colors,\n        class_filter: settings.class_filter,\n        update_styles: true,\n        root_element: editor.inline ? editor.getBody() : null,\n        collect: settings.content_editable,\n        schema: editor.schema,\n        contentCssCors: Settings.shouldUseContentCssCors(editor),\n        onSetAttrib: function (e) {\n          editor.fire('SetAttrib', e);\n        }\n      });\n      editor.parser = createParser(editor);\n      editor.serializer = DomSerializer$1(settings, editor);\n      editor.selection = Selection$1(editor.dom, editor.getWin(), editor.serializer, editor);\n      editor.annotator = Annotator(editor);\n      editor.formatter = Formatter(editor);\n      editor.undoManager = UndoManager(editor);\n      editor._nodeChangeDispatcher = new NodeChange(editor);\n      editor._selectionOverrides = SelectionOverrides(editor);\n      setup$g(editor);\n      setup$f(editor);\n      KeyboardOverrides.setup(editor);\n      ForceBlocks.setup(editor);\n      editor.fire('PreInit');\n      if (!settings.browser_spellcheck && !settings.gecko_spellcheck) {\n        doc.body.spellcheck = false;\n        DOM$2.setAttrib(body, 'spellcheck', 'false');\n      }\n      editor.quirks = Quirks(editor);\n      editor.fire('PostRender');\n      if (settings.directionality) {\n        body.dir = settings.directionality;\n      }\n      if (settings.nowrap) {\n        body.style.whiteSpace = 'nowrap';\n      }\n      if (settings.protect) {\n        editor.on('BeforeSetContent', function (e) {\n          Tools.each(settings.protect, function (pattern) {\n            e.content = e.content.replace(pattern, function (str) {\n              return '<!--mce:protected ' + escape(str) + '-->';\n            });\n          });\n        });\n      }\n      editor.on('SetContent', function () {\n        editor.addVisual(editor.getBody());\n      });\n      editor.load({\n        initial: true,\n        format: 'html'\n      });\n      editor.startContent = editor.getContent({ format: 'raw' });\n      editor.on('compositionstart compositionend', function (e) {\n        editor.composing = e.type === 'compositionstart';\n      });\n      if (editor.contentStyles.length > 0) {\n        contentCssText = '';\n        Tools.each(editor.contentStyles, function (style) {\n          contentCssText += style + '\\r\\n';\n        });\n        editor.dom.addStyle(contentCssText);\n      }\n      getStyleSheetLoader(editor).loadAll(editor.contentCSS, function (_) {\n        initEditor(editor);\n      }, function (urls) {\n        initEditor(editor);\n      });\n      if (settings.content_style) {\n        appendStyle(editor, settings.content_style);\n      }\n    };\n    var InitContentBody = { initContentBody: initContentBody };\n\n    var DOM$3 = DOMUtils$1.DOM;\n    var relaxDomain = function (editor, ifr) {\n      if (domGlobals.document.domain !== domGlobals.window.location.hostname && Env.ie && Env.ie < 12) {\n        var bodyUuid = Uuid.uuid('mce');\n        editor[bodyUuid] = function () {\n          InitContentBody.initContentBody(editor);\n        };\n        var domainRelaxUrl = 'javascript:(function(){' + 'document.open();document.domain=\"' + domGlobals.document.domain + '\";' + 'var ed = window.parent.tinymce.get(\"' + editor.id + '\");document.write(ed.iframeHTML);' + 'document.close();ed.' + bodyUuid + '(true);})()';\n        DOM$3.setAttrib(ifr, 'src', domainRelaxUrl);\n        return true;\n      }\n      return false;\n    };\n    var normalizeHeight = function (height) {\n      var normalizedHeight = typeof height === 'number' ? height + 'px' : height;\n      return normalizedHeight ? normalizedHeight : '';\n    };\n    var createIframeElement = function (id, title, height, customAttrs) {\n      var iframe = Element.fromTag('iframe');\n      setAll(iframe, customAttrs);\n      setAll(iframe, {\n        id: id + '_ifr',\n        frameBorder: '0',\n        allowTransparency: 'true',\n        title: title\n      });\n      setAll$1(iframe, {\n        width: '100%',\n        height: normalizeHeight(height),\n        display: 'block'\n      });\n      return iframe;\n    };\n    var getIframeHtml = function (editor) {\n      var bodyId, bodyClass, iframeHTML;\n      iframeHTML = Settings.getDocType(editor) + '<html><head>';\n      if (Settings.getDocumentBaseUrl(editor) !== editor.documentBaseUrl) {\n        iframeHTML += '<base href=\"' + editor.documentBaseURI.getURI() + '\" />';\n      }\n      iframeHTML += '<meta http-equiv=\"Content-Type\" content=\"text/html; charset=UTF-8\" />';\n      bodyId = Settings.getBodyId(editor);\n      bodyClass = Settings.getBodyClass(editor);\n      if (Settings.getContentSecurityPolicy(editor)) {\n        iframeHTML += '<meta http-equiv=\"Content-Security-Policy\" content=\"' + Settings.getContentSecurityPolicy(editor) + '\" />';\n      }\n      iframeHTML += '</head><body id=\"' + bodyId + '\" class=\"mce-content-body ' + bodyClass + '\" data-id=\"' + editor.id + '\"><br></body></html>';\n      return iframeHTML;\n    };\n    var createIframe = function (editor, o) {\n      var title = editor.editorManager.translate('Rich Text Area. Press ALT-F9 for menu. ' + 'Press ALT-F10 for toolbar. Press ALT-0 for help');\n      var ifr = createIframeElement(editor.id, title, o.height, Settings.getIframeAttrs(editor)).dom();\n      ifr.onload = function () {\n        ifr.onload = null;\n        editor.fire('load');\n      };\n      var isDomainRelaxed = relaxDomain(editor, ifr);\n      editor.contentAreaContainer = o.iframeContainer;\n      editor.iframeElement = ifr;\n      editor.iframeHTML = getIframeHtml(editor);\n      DOM$3.add(o.iframeContainer, ifr);\n      return isDomainRelaxed;\n    };\n    var init$1 = function (editor, boxInfo) {\n      var isDomainRelaxed = createIframe(editor, boxInfo);\n      if (boxInfo.editorContainer) {\n        DOM$3.get(boxInfo.editorContainer).style.display = editor.orgDisplay;\n        editor.hidden = DOM$3.isHidden(boxInfo.editorContainer);\n      }\n      editor.getElement().style.display = 'none';\n      DOM$3.setAttrib(editor.id, 'aria-hidden', 'true');\n      if (!isDomainRelaxed) {\n        InitContentBody.initContentBody(editor);\n      }\n    };\n    var InitIframe = { init: init$1 };\n\n    var DOM$4 = DOMUtils$1.DOM;\n    var initPlugin = function (editor, initializedPlugins, plugin) {\n      var Plugin = PluginManager$1.get(plugin);\n      var pluginUrl = PluginManager$1.urls[plugin] || editor.documentBaseUrl.replace(/\\/$/, '');\n      plugin = Tools.trim(plugin);\n      if (Plugin && Tools.inArray(initializedPlugins, plugin) === -1) {\n        Tools.each(PluginManager$1.dependencies(plugin), function (dep) {\n          initPlugin(editor, initializedPlugins, dep);\n        });\n        if (editor.plugins[plugin]) {\n          return;\n        }\n        try {\n          var pluginInstance = new Plugin(editor, pluginUrl, editor.$);\n          editor.plugins[plugin] = pluginInstance;\n          if (pluginInstance.init) {\n            pluginInstance.init(editor, pluginUrl);\n            initializedPlugins.push(plugin);\n          }\n        } catch (e) {\n          ErrorReporter.pluginInitError(editor, plugin, e);\n        }\n      }\n    };\n    var trimLegacyPrefix = function (name) {\n      return name.replace(/^\\-/, '');\n    };\n    var initPlugins = function (editor) {\n      var initializedPlugins = [];\n      Tools.each(editor.settings.plugins.split(/[ ,]/), function (name) {\n        initPlugin(editor, initializedPlugins, trimLegacyPrefix(name));\n      });\n    };\n    var initTheme = function (editor) {\n      var Theme;\n      var theme = editor.settings.theme;\n      if (isString(theme)) {\n        editor.settings.theme = trimLegacyPrefix(theme);\n        Theme = ThemeManager.get(theme);\n        editor.theme = new Theme(editor, ThemeManager.urls[theme]);\n        if (editor.theme.init) {\n          editor.theme.init(editor, ThemeManager.urls[theme] || editor.documentBaseUrl.replace(/\\/$/, ''), editor.$);\n        }\n      } else {\n        editor.theme = {};\n      }\n    };\n    var renderFromLoadedTheme = function (editor) {\n      var w, h, minHeight, re, info;\n      var settings = editor.settings;\n      var elm = editor.getElement();\n      w = settings.width || DOM$4.getStyle(elm, 'width') || '100%';\n      h = settings.height || DOM$4.getStyle(elm, 'height') || elm.offsetHeight;\n      minHeight = settings.min_height || 100;\n      re = /^[0-9\\.]+(|px)$/i;\n      if (re.test('' + w)) {\n        w = Math.max(parseInt(w, 10), 100);\n      }\n      if (re.test('' + h)) {\n        h = Math.max(parseInt(h, 10), minHeight);\n      }\n      info = editor.theme.renderUI({\n        targetNode: elm,\n        width: w,\n        height: h,\n        deltaWidth: settings.delta_width,\n        deltaHeight: settings.delta_height\n      });\n      if (!settings.content_editable) {\n        h = (info.iframeHeight || h) + (typeof h === 'number' ? info.deltaHeight || 0 : '');\n        if (h < minHeight) {\n          h = minHeight;\n        }\n      }\n      info.height = h;\n      return info;\n    };\n    var renderFromThemeFunc = function (editor) {\n      var info;\n      var elm = editor.getElement();\n      info = editor.settings.theme(editor, elm);\n      if (info.editorContainer.nodeType) {\n        info.editorContainer.id = info.editorContainer.id || editor.id + '_parent';\n      }\n      if (info.iframeContainer && info.iframeContainer.nodeType) {\n        info.iframeContainer.id = info.iframeContainer.id || editor.id + '_iframecontainer';\n      }\n      info.height = info.iframeHeight ? info.iframeHeight : elm.offsetHeight;\n      return info;\n    };\n    var createThemeFalseResult = function (element) {\n      return {\n        editorContainer: element,\n        iframeContainer: element\n      };\n    };\n    var renderThemeFalseIframe = function (targetElement) {\n      var iframeContainer = DOM$4.create('div');\n      DOM$4.insertAfter(iframeContainer, targetElement);\n      return createThemeFalseResult(iframeContainer);\n    };\n    var renderThemeFalse = function (editor) {\n      var targetElement = editor.getElement();\n      return editor.inline ? createThemeFalseResult(null) : renderThemeFalseIframe(targetElement);\n    };\n    var renderThemeUi = function (editor) {\n      var settings = editor.settings, elm = editor.getElement();\n      editor.orgDisplay = elm.style.display;\n      if (isString(settings.theme)) {\n        return renderFromLoadedTheme(editor);\n      } else if (isFunction(settings.theme)) {\n        return renderFromThemeFunc(editor);\n      } else {\n        return renderThemeFalse(editor);\n      }\n    };\n    var init$2 = function (editor) {\n      var settings = editor.settings;\n      var elm = editor.getElement();\n      var boxInfo;\n      editor.rtl = settings.rtl_ui || editor.editorManager.i18n.rtl;\n      editor.editorManager.i18n.setCode(settings.language);\n      settings.aria_label = settings.aria_label || DOM$4.getAttrib(elm, 'aria-label', editor.getLang('aria.rich_text_area'));\n      editor.fire('ScriptsLoaded');\n      initTheme(editor);\n      initPlugins(editor);\n      boxInfo = renderThemeUi(editor);\n      editor.editorContainer = boxInfo.editorContainer ? boxInfo.editorContainer : null;\n      if (settings.content_css) {\n        Tools.each(Tools.explode(settings.content_css), function (u) {\n          editor.contentCSS.push(editor.documentBaseURI.toAbsolute(u));\n        });\n      }\n      if (settings.content_editable) {\n        return InitContentBody.initContentBody(editor);\n      } else {\n        return InitIframe.init(editor, boxInfo);\n      }\n    };\n    var Init = { init: init$2 };\n\n    var DOM$5 = DOMUtils$1.DOM;\n    var hasSkipLoadPrefix = function (name) {\n      return name.charAt(0) === '-';\n    };\n    var loadLanguage = function (scriptLoader, editor) {\n      var settings = editor.settings;\n      if (settings.language && settings.language !== 'en' && !settings.language_url) {\n        settings.language_url = editor.editorManager.baseURL + '/langs/' + settings.language + '.js';\n      }\n      if (settings.language_url && !editor.editorManager.i18n.data[settings.language]) {\n        scriptLoader.add(settings.language_url);\n      }\n    };\n    var loadTheme = function (scriptLoader, editor, suffix, callback) {\n      var settings = editor.settings, theme = settings.theme;\n      if (isString(theme)) {\n        if (!hasSkipLoadPrefix(theme) && !ThemeManager.urls.hasOwnProperty(theme)) {\n          var themeUrl = settings.theme_url;\n          if (themeUrl) {\n            ThemeManager.load(theme, editor.documentBaseURI.toAbsolute(themeUrl));\n          } else {\n            ThemeManager.load(theme, 'themes/' + theme + '/theme' + suffix + '.js');\n          }\n        }\n        scriptLoader.loadQueue(function () {\n          ThemeManager.waitFor(theme, callback);\n        });\n      } else {\n        callback();\n      }\n    };\n    var loadPlugins = function (settings, suffix) {\n      if (Tools.isArray(settings.plugins)) {\n        settings.plugins = settings.plugins.join(' ');\n      }\n      Tools.each(settings.external_plugins, function (url, name) {\n        PluginManager$1.load(name, url);\n        settings.plugins += ' ' + name;\n      });\n      Tools.each(settings.plugins.split(/[ ,]/), function (plugin) {\n        plugin = Tools.trim(plugin);\n        if (plugin && !PluginManager$1.urls[plugin]) {\n          if (hasSkipLoadPrefix(plugin)) {\n            plugin = plugin.substr(1, plugin.length);\n            var dependencies = PluginManager$1.dependencies(plugin);\n            Tools.each(dependencies, function (dep) {\n              var defaultSettings = {\n                prefix: 'plugins/',\n                resource: dep,\n                suffix: '/plugin' + suffix + '.js'\n              };\n              dep = PluginManager$1.createUrl(defaultSettings, dep);\n              PluginManager$1.load(dep.resource, dep);\n            });\n          } else {\n            PluginManager$1.load(plugin, {\n              prefix: 'plugins/',\n              resource: plugin,\n              suffix: '/plugin' + suffix + '.js'\n            });\n          }\n        }\n      });\n    };\n    var loadScripts = function (editor, suffix) {\n      var scriptLoader = ScriptLoader.ScriptLoader;\n      loadTheme(scriptLoader, editor, suffix, function () {\n        loadLanguage(scriptLoader, editor);\n        loadPlugins(editor.settings, suffix);\n        scriptLoader.loadQueue(function () {\n          if (!editor.removed) {\n            Init.init(editor);\n          }\n        }, editor, function (urls) {\n          ErrorReporter.pluginLoadError(editor, urls[0]);\n          if (!editor.removed) {\n            Init.init(editor);\n          }\n        });\n      });\n    };\n    var render = function (editor) {\n      var settings = editor.settings, id = editor.id;\n      var readyHandler = function () {\n        DOM$5.unbind(domGlobals.window, 'ready', readyHandler);\n        editor.render();\n      };\n      if (!EventUtils.Event.domLoaded) {\n        DOM$5.bind(domGlobals.window, 'ready', readyHandler);\n        return;\n      }\n      if (!editor.getElement()) {\n        return;\n      }\n      if (!Env.contentEditable) {\n        return;\n      }\n      if (!settings.inline) {\n        editor.orgVisibility = editor.getElement().style.visibility;\n        editor.getElement().style.visibility = 'hidden';\n      } else {\n        editor.inline = true;\n      }\n      var form = editor.getElement().form || DOM$5.getParent(id, 'form');\n      if (form) {\n        editor.formElement = form;\n        if (settings.hidden_input && !/TEXTAREA|INPUT/i.test(editor.getElement().nodeName)) {\n          DOM$5.insertAfter(DOM$5.create('input', {\n            type: 'hidden',\n            name: id\n          }), id);\n          editor.hasHiddenInput = true;\n        }\n        editor.formEventDelegate = function (e) {\n          editor.fire(e.type, e);\n        };\n        DOM$5.bind(form, 'submit reset', editor.formEventDelegate);\n        editor.on('reset', function () {\n          editor.setContent(editor.startContent, { format: 'raw' });\n        });\n        if (settings.submit_patch && !form.submit.nodeType && !form.submit.length && !form._mceOldSubmit) {\n          form._mceOldSubmit = form.submit;\n          form.submit = function () {\n            editor.editorManager.triggerSave();\n            editor.setDirty(false);\n            return form._mceOldSubmit(form);\n          };\n        }\n      }\n      editor.windowManager = WindowManager(editor);\n      editor.notificationManager = NotificationManager(editor);\n      if (settings.encoding === 'xml') {\n        editor.on('GetContent', function (e) {\n          if (e.save) {\n            e.content = DOM$5.encode(e.content);\n          }\n        });\n      }\n      if (settings.add_form_submit_trigger) {\n        editor.on('submit', function () {\n          if (editor.initialized) {\n            editor.save();\n          }\n        });\n      }\n      if (settings.add_unload_trigger) {\n        editor._beforeUnload = function () {\n          if (editor.initialized && !editor.destroyed && !editor.isHidden()) {\n            editor.save({\n              format: 'raw',\n              no_events: true,\n              set_dirty: false\n            });\n          }\n        };\n        editor.editorManager.on('BeforeUnload', editor._beforeUnload);\n      }\n      editor.editorManager.add(editor);\n      loadScripts(editor, editor.suffix);\n    };\n    var Render = { render: render };\n\n    var add$4 = function (editor, name, settings) {\n      var sidebars = editor.sidebars ? editor.sidebars : [];\n      sidebars.push({\n        name: name,\n        settings: settings\n      });\n      editor.sidebars = sidebars;\n    };\n    var Sidebar = { add: add$4 };\n\n    var each$k = Tools.each, trim$4 = Tools.trim;\n    var queryParts = 'source protocol authority userInfo user password host port relative path directory file query anchor'.split(' ');\n    var DEFAULT_PORTS = {\n      ftp: 21,\n      http: 80,\n      https: 443,\n      mailto: 25\n    };\n    var URI = function (url, settings) {\n      var self = this;\n      var baseUri, baseUrl;\n      url = trim$4(url);\n      settings = self.settings = settings || {};\n      baseUri = settings.base_uri;\n      if (/^([\\w\\-]+):([^\\/]{2})/i.test(url) || /^\\s*#/.test(url)) {\n        self.source = url;\n        return;\n      }\n      var isProtocolRelative = url.indexOf('//') === 0;\n      if (url.indexOf('/') === 0 && !isProtocolRelative) {\n        url = (baseUri ? baseUri.protocol || 'http' : 'http') + '://mce_host' + url;\n      }\n      if (!/^[\\w\\-]*:?\\/\\//.test(url)) {\n        baseUrl = settings.base_uri ? settings.base_uri.path : new URI(domGlobals.document.location.href).directory;\n        if (settings.base_uri.protocol == '') {\n          url = '//mce_host' + self.toAbsPath(baseUrl, url);\n        } else {\n          url = /([^#?]*)([#?]?.*)/.exec(url);\n          url = (baseUri && baseUri.protocol || 'http') + '://mce_host' + self.toAbsPath(baseUrl, url[1]) + url[2];\n        }\n      }\n      url = url.replace(/@@/g, '(mce_at)');\n      url = /^(?:(?![^:@]+:[^:@\\/]*@)([^:\\/?#.]+):)?(?:\\/\\/)?((?:(([^:@\\/]*):?([^:@\\/]*))?@)?([^:\\/?#]*)(?::(\\d*))?)(((\\/(?:[^?#](?![^?#\\/]*\\.[^?#\\/.]+(?:[?#]|$)))*\\/?)?([^?#\\/]*))(?:\\?([^#]*))?(?:#(.*))?)/.exec(url);\n      each$k(queryParts, function (v, i) {\n        var part = url[i];\n        if (part) {\n          part = part.replace(/\\(mce_at\\)/g, '@@');\n        }\n        self[v] = part;\n      });\n      if (baseUri) {\n        if (!self.protocol) {\n          self.protocol = baseUri.protocol;\n        }\n        if (!self.userInfo) {\n          self.userInfo = baseUri.userInfo;\n        }\n        if (!self.port && self.host === 'mce_host') {\n          self.port = baseUri.port;\n        }\n        if (!self.host || self.host === 'mce_host') {\n          self.host = baseUri.host;\n        }\n        self.source = '';\n      }\n      if (isProtocolRelative) {\n        self.protocol = '';\n      }\n    };\n    URI.prototype = {\n      setPath: function (path) {\n        var self = this;\n        path = /^(.*?)\\/?(\\w+)?$/.exec(path);\n        self.path = path[0];\n        self.directory = path[1];\n        self.file = path[2];\n        self.source = '';\n        self.getURI();\n      },\n      toRelative: function (uri) {\n        var self = this;\n        var output;\n        if (uri === './') {\n          return uri;\n        }\n        uri = new URI(uri, { base_uri: self });\n        if (uri.host !== 'mce_host' && self.host !== uri.host && uri.host || self.port !== uri.port || self.protocol !== uri.protocol && uri.protocol !== '') {\n          return uri.getURI();\n        }\n        var tu = self.getURI(), uu = uri.getURI();\n        if (tu === uu || tu.charAt(tu.length - 1) === '/' && tu.substr(0, tu.length - 1) === uu) {\n          return tu;\n        }\n        output = self.toRelPath(self.path, uri.path);\n        if (uri.query) {\n          output += '?' + uri.query;\n        }\n        if (uri.anchor) {\n          output += '#' + uri.anchor;\n        }\n        return output;\n      },\n      toAbsolute: function (uri, noHost) {\n        uri = new URI(uri, { base_uri: this });\n        return uri.getURI(noHost && this.isSameOrigin(uri));\n      },\n      isSameOrigin: function (uri) {\n        if (this.host == uri.host && this.protocol == uri.protocol) {\n          if (this.port == uri.port) {\n            return true;\n          }\n          var defaultPort = DEFAULT_PORTS[this.protocol];\n          if (defaultPort && (this.port || defaultPort) == (uri.port || defaultPort)) {\n            return true;\n          }\n        }\n        return false;\n      },\n      toRelPath: function (base, path) {\n        var items, breakPoint = 0, out = '', i, l;\n        base = base.substring(0, base.lastIndexOf('/'));\n        base = base.split('/');\n        items = path.split('/');\n        if (base.length >= items.length) {\n          for (i = 0, l = base.length; i < l; i++) {\n            if (i >= items.length || base[i] !== items[i]) {\n              breakPoint = i + 1;\n              break;\n            }\n          }\n        }\n        if (base.length < items.length) {\n          for (i = 0, l = items.length; i < l; i++) {\n            if (i >= base.length || base[i] !== items[i]) {\n              breakPoint = i + 1;\n              break;\n            }\n          }\n        }\n        if (breakPoint === 1) {\n          return path;\n        }\n        for (i = 0, l = base.length - (breakPoint - 1); i < l; i++) {\n          out += '../';\n        }\n        for (i = breakPoint - 1, l = items.length; i < l; i++) {\n          if (i !== breakPoint - 1) {\n            out += '/' + items[i];\n          } else {\n            out += items[i];\n          }\n        }\n        return out;\n      },\n      toAbsPath: function (base, path) {\n        var i, nb = 0, o = [], tr, outPath;\n        tr = /\\/$/.test(path) ? '/' : '';\n        base = base.split('/');\n        path = path.split('/');\n        each$k(base, function (k) {\n          if (k) {\n            o.push(k);\n          }\n        });\n        base = o;\n        for (i = path.length - 1, o = []; i >= 0; i--) {\n          if (path[i].length === 0 || path[i] === '.') {\n            continue;\n          }\n          if (path[i] === '..') {\n            nb++;\n            continue;\n          }\n          if (nb > 0) {\n            nb--;\n            continue;\n          }\n          o.push(path[i]);\n        }\n        i = base.length - nb;\n        if (i <= 0) {\n          outPath = o.reverse().join('/');\n        } else {\n          outPath = base.slice(0, i).join('/') + '/' + o.reverse().join('/');\n        }\n        if (outPath.indexOf('/') !== 0) {\n          outPath = '/' + outPath;\n        }\n        if (tr && outPath.lastIndexOf('/') !== outPath.length - 1) {\n          outPath += tr;\n        }\n        return outPath;\n      },\n      getURI: function (noProtoHost) {\n        var s;\n        var self = this;\n        if (!self.source || noProtoHost) {\n          s = '';\n          if (!noProtoHost) {\n            if (self.protocol) {\n              s += self.protocol + '://';\n            } else {\n              s += '//';\n            }\n            if (self.userInfo) {\n              s += self.userInfo + '@';\n            }\n            if (self.host) {\n              s += self.host;\n            }\n            if (self.port) {\n              s += ':' + self.port;\n            }\n          }\n          if (self.path) {\n            s += self.path;\n          }\n          if (self.query) {\n            s += '?' + self.query;\n          }\n          if (self.anchor) {\n            s += '#' + self.anchor;\n          }\n          self.source = s;\n        }\n        return self.source;\n      }\n    };\n    URI.parseDataUri = function (uri) {\n      var type, matches;\n      uri = decodeURIComponent(uri).split(',');\n      matches = /data:([^;]+)/.exec(uri[0]);\n      if (matches) {\n        type = matches[1];\n      }\n      return {\n        type: type,\n        data: uri[1]\n      };\n    };\n    URI.getDocumentBaseUrl = function (loc) {\n      var baseUrl;\n      if (loc.protocol.indexOf('http') !== 0 && loc.protocol !== 'file:') {\n        baseUrl = loc.href;\n      } else {\n        baseUrl = loc.protocol + '//' + loc.host + loc.pathname;\n      }\n      if (/^[^:]+:\\/\\/\\/?[^\\/]+\\//.test(baseUrl)) {\n        baseUrl = baseUrl.replace(/[\\?#].*$/, '').replace(/[\\/\\\\][^\\/]+$/, '');\n        if (!/[\\/\\\\]$/.test(baseUrl)) {\n          baseUrl += '/';\n        }\n      }\n      return baseUrl;\n    };\n\n    var defaultFormat = 'html';\n    var trimEmptyContents = function (editor, html) {\n      var blockName = Settings.getForcedRootBlock(editor);\n      var emptyRegExp = new RegExp('^(<' + blockName + '[^>]*>(&nbsp;|&#160;|\\\\s|\\xA0|<br \\\\/>|)<\\\\/' + blockName + '>[\\r\\n]*|<br \\\\/>[\\r\\n]*)$');\n      return html.replace(emptyRegExp, '');\n    };\n    var getContentFromBody = function (editor, args, body) {\n      var content;\n      args.format = args.format ? args.format : defaultFormat;\n      args.get = true;\n      args.getInner = true;\n      if (!args.no_events) {\n        editor.fire('BeforeGetContent', args);\n      }\n      if (args.format === 'raw') {\n        content = Tools.trim(TrimHtml.trimExternal(editor.serializer, body.innerHTML));\n      } else if (args.format === 'text') {\n        content = Zwsp.trim(body.innerText || body.textContent);\n      } else if (args.format === 'tree') {\n        return editor.serializer.serialize(body, args);\n      } else {\n        content = trimEmptyContents(editor, editor.serializer.serialize(body, args));\n      }\n      if (args.format !== 'text' && !isWsPreserveElement(Element.fromDom(body))) {\n        args.content = Tools.trim(content);\n      } else {\n        args.content = content;\n      }\n      if (!args.no_events) {\n        editor.fire('GetContent', args);\n      }\n      return args.content;\n    };\n    var getContent$1 = function (editor, args) {\n      if (args === void 0) {\n        args = {};\n      }\n      return Option.from(editor.getBody()).fold(constant(args.format === 'tree' ? new Node$1('body', 11) : ''), function (body) {\n        return getContentFromBody(editor, args, body);\n      });\n    };\n\n    var traverse = function (node, fn) {\n      fn(node);\n      if (node.firstChild) {\n        traverse(node.firstChild, fn);\n      }\n      if (node.next) {\n        traverse(node.next, fn);\n      }\n    };\n    var findMatchingNodes = function (nodeFilters, attributeFilters, node) {\n      var nodeMatches = {};\n      var attrMatches = {};\n      var matches = [];\n      if (node.firstChild) {\n        traverse(node.firstChild, function (node) {\n          each(nodeFilters, function (filter) {\n            if (filter.name === node.name) {\n              if (nodeMatches[filter.name]) {\n                nodeMatches[filter.name].nodes.push(node);\n              } else {\n                nodeMatches[filter.name] = {\n                  filter: filter,\n                  nodes: [node]\n                };\n              }\n            }\n          });\n          each(attributeFilters, function (filter) {\n            if (typeof node.attr(filter.name) === 'string') {\n              if (attrMatches[filter.name]) {\n                attrMatches[filter.name].nodes.push(node);\n              } else {\n                attrMatches[filter.name] = {\n                  filter: filter,\n                  nodes: [node]\n                };\n              }\n            }\n          });\n        });\n      }\n      for (var name in nodeMatches) {\n        if (nodeMatches.hasOwnProperty(name)) {\n          matches.push(nodeMatches[name]);\n        }\n      }\n      for (var name in attrMatches) {\n        if (attrMatches.hasOwnProperty(name)) {\n          matches.push(attrMatches[name]);\n        }\n      }\n      return matches;\n    };\n    var filter$3 = function (nodeFilters, attributeFilters, node) {\n      var matches = findMatchingNodes(nodeFilters, attributeFilters, node);\n      each(matches, function (match) {\n        each(match.filter.callbacks, function (callback) {\n          callback(match.nodes, match.filter.name, {});\n        });\n      });\n    };\n\n    var defaultFormat$1 = 'html';\n    var isTreeNode = function (content) {\n      return content instanceof Node$1;\n    };\n    var moveSelection = function (editor) {\n      if (EditorFocus.hasFocus(editor)) {\n        CaretFinder.firstPositionIn(editor.getBody()).each(function (pos) {\n          var node = pos.getNode();\n          var caretPos = NodeType.isTable(node) ? CaretFinder.firstPositionIn(node).getOr(pos) : pos;\n          editor.selection.setRng(caretPos.toRange());\n        });\n      }\n    };\n    var setEditorHtml = function (editor, html) {\n      editor.dom.setHTML(editor.getBody(), html);\n      moveSelection(editor);\n    };\n    var setContentString = function (editor, body, content, args) {\n      var forcedRootBlockName, padd;\n      if (content.length === 0 || /^\\s+$/.test(content)) {\n        padd = '<br data-mce-bogus=\"1\">';\n        if (body.nodeName === 'TABLE') {\n          content = '<tr><td>' + padd + '</td></tr>';\n        } else if (/^(UL|OL)$/.test(body.nodeName)) {\n          content = '<li>' + padd + '</li>';\n        }\n        forcedRootBlockName = Settings.getForcedRootBlock(editor);\n        if (forcedRootBlockName && editor.schema.isValidChild(body.nodeName.toLowerCase(), forcedRootBlockName.toLowerCase())) {\n          content = padd;\n          content = editor.dom.createHTML(forcedRootBlockName, editor.settings.forced_root_block_attrs, content);\n        } else if (!content) {\n          content = '<br data-mce-bogus=\"1\">';\n        }\n        setEditorHtml(editor, content);\n        editor.fire('SetContent', args);\n      } else {\n        if (args.format !== 'raw') {\n          content = HtmlSerializer({ validate: editor.validate }, editor.schema).serialize(editor.parser.parse(content, {\n            isRootContent: true,\n            insert: true\n          }));\n        }\n        args.content = isWsPreserveElement(Element.fromDom(body)) ? content : Tools.trim(content);\n        setEditorHtml(editor, args.content);\n        if (!args.no_events) {\n          editor.fire('SetContent', args);\n        }\n      }\n      return args.content;\n    };\n    var setContentTree = function (editor, body, content, args) {\n      filter$3(editor.parser.getNodeFilters(), editor.parser.getAttributeFilters(), content);\n      var html = HtmlSerializer({ validate: editor.validate }, editor.schema).serialize(content);\n      args.content = isWsPreserveElement(Element.fromDom(body)) ? html : Tools.trim(html);\n      setEditorHtml(editor, args.content);\n      if (!args.no_events) {\n        editor.fire('SetContent', args);\n      }\n      return content;\n    };\n    var setContent$1 = function (editor, content, args) {\n      if (args === void 0) {\n        args = {};\n      }\n      args.format = args.format ? args.format : defaultFormat$1;\n      args.set = true;\n      args.content = isTreeNode(content) ? '' : content;\n      if (!isTreeNode(content) && !args.no_events) {\n        editor.fire('BeforeSetContent', args);\n        content = args.content;\n      }\n      return Option.from(editor.getBody()).fold(constant(content), function (body) {\n        return isTreeNode(content) ? setContentTree(editor, body, content, args) : setContentString(editor, body, content, args);\n      });\n    };\n\n    var DOM$6 = DOMUtils$1.DOM;\n    var restoreOriginalStyles = function (editor) {\n      DOM$6.setStyle(editor.id, 'display', editor.orgDisplay);\n    };\n    var safeDestroy = function (x) {\n      return Option.from(x).each(function (x) {\n        return x.destroy();\n      });\n    };\n    var clearDomReferences = function (editor) {\n      editor.contentAreaContainer = editor.formElement = editor.container = editor.editorContainer = null;\n      editor.bodyElement = editor.contentDocument = editor.contentWindow = null;\n      editor.iframeElement = editor.targetElm = null;\n      if (editor.selection) {\n        editor.selection = editor.selection.win = editor.selection.dom = editor.selection.dom.doc = null;\n      }\n    };\n    var restoreForm = function (editor) {\n      var form = editor.formElement;\n      if (form) {\n        if (form._mceOldSubmit) {\n          form.submit = form._mceOldSubmit;\n          form._mceOldSubmit = null;\n        }\n        DOM$6.unbind(form, 'submit reset', editor.formEventDelegate);\n      }\n    };\n    var remove$7 = function (editor) {\n      if (!editor.removed) {\n        var _selectionOverrides = editor._selectionOverrides, editorUpload = editor.editorUpload;\n        var body = editor.getBody();\n        var element = editor.getElement();\n        if (body) {\n          editor.save({ is_removing: true });\n        }\n        editor.removed = true;\n        editor.unbindAllNativeEvents();\n        if (editor.hasHiddenInput && element) {\n          DOM$6.remove(element.nextSibling);\n        }\n        Events.fireRemove(editor);\n        editor.editorManager.remove(editor);\n        if (!editor.inline && body) {\n          restoreOriginalStyles(editor);\n        }\n        Events.fireDetach(editor);\n        DOM$6.remove(editor.getContainer());\n        safeDestroy(_selectionOverrides);\n        safeDestroy(editorUpload);\n        editor.destroy();\n      }\n    };\n    var destroy = function (editor, automatic) {\n      var selection = editor.selection, dom = editor.dom;\n      if (editor.destroyed) {\n        return;\n      }\n      if (!automatic && !editor.removed) {\n        editor.remove();\n        return;\n      }\n      if (!automatic) {\n        editor.editorManager.off('beforeunload', editor._beforeUnload);\n        if (editor.theme && editor.theme.destroy) {\n          editor.theme.destroy();\n        }\n        safeDestroy(selection);\n        safeDestroy(dom);\n      }\n      restoreForm(editor);\n      clearDomReferences(editor);\n      editor.destroyed = true;\n    };\n\n    var DOM$7 = DOMUtils$1.DOM;\n    var extend$4 = Tools.extend, each$l = Tools.each;\n    var resolve$4 = Tools.resolve;\n    var ie$2 = Env.ie;\n    var Editor = function (id, settings, editorManager) {\n      var self = this;\n      var documentBaseUrl = self.documentBaseUrl = editorManager.documentBaseURL;\n      var baseUri = editorManager.baseURI;\n      settings = getEditorSettings(self, id, documentBaseUrl, editorManager.defaultSettings, settings);\n      self.settings = settings;\n      AddOnManager.language = settings.language || 'en';\n      AddOnManager.languageLoad = settings.language_load;\n      AddOnManager.baseURL = editorManager.baseURL;\n      self.id = id;\n      self.setDirty(false);\n      self.plugins = {};\n      self.documentBaseURI = new URI(settings.document_base_url, { base_uri: baseUri });\n      self.baseURI = baseUri;\n      self.contentCSS = [];\n      self.contentStyles = [];\n      self.shortcuts = new Shortcuts(self);\n      self.loadedCSS = {};\n      self.editorCommands = new EditorCommands(self);\n      self.suffix = editorManager.suffix;\n      self.editorManager = editorManager;\n      self.inline = settings.inline;\n      self.buttons = {};\n      self.menuItems = {};\n      if (settings.cache_suffix) {\n        Env.cacheSuffix = settings.cache_suffix.replace(/^[\\?\\&]+/, '');\n      }\n      if (settings.override_viewport === false) {\n        Env.overrideViewPort = false;\n      }\n      editorManager.fire('SetupEditor', { editor: self });\n      self.execCallback('setup', self);\n      self.$ = DomQuery.overrideDefaults(function () {\n        return {\n          context: self.inline ? self.getBody() : self.getDoc(),\n          element: self.getBody()\n        };\n      });\n    };\n    Editor.prototype = {\n      render: function () {\n        Render.render(this);\n      },\n      focus: function (skipFocus) {\n        EditorFocus.focus(this, skipFocus);\n      },\n      hasFocus: function () {\n        return EditorFocus.hasFocus(this);\n      },\n      execCallback: function (name) {\n        var x = [];\n        for (var _i = 1; _i < arguments.length; _i++) {\n          x[_i - 1] = arguments[_i];\n        }\n        var self = this;\n        var callback = self.settings[name], scope;\n        if (!callback) {\n          return;\n        }\n        if (self.callbackLookup && (scope = self.callbackLookup[name])) {\n          callback = scope.func;\n          scope = scope.scope;\n        }\n        if (typeof callback === 'string') {\n          scope = callback.replace(/\\.\\w+$/, '');\n          scope = scope ? resolve$4(scope) : 0;\n          callback = resolve$4(callback);\n          self.callbackLookup = self.callbackLookup || {};\n          self.callbackLookup[name] = {\n            func: callback,\n            scope: scope\n          };\n        }\n        return callback.apply(scope || self, Array.prototype.slice.call(arguments, 1));\n      },\n      translate: function (text) {\n        if (text && Tools.is(text, 'string')) {\n          var lang_1 = this.settings.language || 'en', i18n_1 = this.editorManager.i18n;\n          text = i18n_1.data[lang_1 + '.' + text] || text.replace(/\\{\\#([^\\}]+)\\}/g, function (a, b) {\n            return i18n_1.data[lang_1 + '.' + b] || '{#' + b + '}';\n          });\n        }\n        return this.editorManager.translate(text);\n      },\n      getLang: function (name, defaultVal) {\n        return this.editorManager.i18n.data[(this.settings.language || 'en') + '.' + name] || (defaultVal !== undefined ? defaultVal : '{#' + name + '}');\n      },\n      getParam: function (name, defaultVal, type) {\n        return getParam(this, name, defaultVal, type);\n      },\n      nodeChanged: function (args) {\n        this._nodeChangeDispatcher.nodeChanged(args);\n      },\n      addButton: function (name, settings) {\n        var self = this;\n        if (settings.cmd) {\n          settings.onclick = function () {\n            self.execCommand(settings.cmd);\n          };\n        }\n        if (settings.stateSelector && typeof settings.active === 'undefined') {\n          settings.active = false;\n        }\n        if (!settings.text && !settings.icon) {\n          settings.icon = name;\n        }\n        settings.tooltip = settings.tooltip || settings.title;\n        self.buttons[name] = settings;\n      },\n      addSidebar: function (name, settings) {\n        return Sidebar.add(this, name, settings);\n      },\n      addMenuItem: function (name, settings) {\n        var self = this;\n        if (settings.cmd) {\n          settings.onclick = function () {\n            self.execCommand(settings.cmd);\n          };\n        }\n        self.menuItems[name] = settings;\n      },\n      addContextToolbar: function (predicate, items) {\n        var self = this;\n        var selector;\n        self.contextToolbars = self.contextToolbars || [];\n        if (typeof predicate === 'string') {\n          selector = predicate;\n          predicate = function (elm) {\n            return self.dom.is(elm, selector);\n          };\n        }\n        self.contextToolbars.push({\n          id: Uuid.uuid('mcet'),\n          predicate: predicate,\n          items: items\n        });\n      },\n      addCommand: function (name, callback, scope) {\n        this.editorCommands.addCommand(name, callback, scope);\n      },\n      addQueryStateHandler: function (name, callback, scope) {\n        this.editorCommands.addQueryStateHandler(name, callback, scope);\n      },\n      addQueryValueHandler: function (name, callback, scope) {\n        this.editorCommands.addQueryValueHandler(name, callback, scope);\n      },\n      addShortcut: function (pattern, desc, cmdFunc, scope) {\n        this.shortcuts.add(pattern, desc, cmdFunc, scope);\n      },\n      execCommand: function (cmd, ui, value, args) {\n        return this.editorCommands.execCommand(cmd, ui, value, args);\n      },\n      queryCommandState: function (cmd) {\n        return this.editorCommands.queryCommandState(cmd);\n      },\n      queryCommandValue: function (cmd) {\n        return this.editorCommands.queryCommandValue(cmd);\n      },\n      queryCommandSupported: function (cmd) {\n        return this.editorCommands.queryCommandSupported(cmd);\n      },\n      show: function () {\n        var self = this;\n        if (self.hidden) {\n          self.hidden = false;\n          if (self.inline) {\n            self.getBody().contentEditable = true;\n          } else {\n            DOM$7.show(self.getContainer());\n            DOM$7.hide(self.id);\n          }\n          self.load();\n          self.fire('show');\n        }\n      },\n      hide: function () {\n        var self = this, doc = self.getDoc();\n        if (!self.hidden) {\n          if (ie$2 && doc && !self.inline) {\n            doc.execCommand('SelectAll');\n          }\n          self.save();\n          if (self.inline) {\n            self.getBody().contentEditable = false;\n            if (self === self.editorManager.focusedEditor) {\n              self.editorManager.focusedEditor = null;\n            }\n          } else {\n            DOM$7.hide(self.getContainer());\n            DOM$7.setStyle(self.id, 'display', self.orgDisplay);\n          }\n          self.hidden = true;\n          self.fire('hide');\n        }\n      },\n      isHidden: function () {\n        return !!this.hidden;\n      },\n      setProgressState: function (state, time) {\n        this.fire('ProgressState', {\n          state: state,\n          time: time\n        });\n      },\n      load: function (args) {\n        var self = this;\n        var elm = self.getElement(), html;\n        if (self.removed) {\n          return '';\n        }\n        if (elm) {\n          args = args || {};\n          args.load = true;\n          html = self.setContent(elm.value !== undefined ? elm.value : elm.innerHTML, args);\n          args.element = elm;\n          if (!args.no_events) {\n            self.fire('LoadContent', args);\n          }\n          args.element = elm = null;\n          return html;\n        }\n      },\n      save: function (args) {\n        var self = this;\n        var elm = self.getElement(), html, form;\n        if (!elm || !self.initialized || self.removed) {\n          return;\n        }\n        args = args || {};\n        args.save = true;\n        args.element = elm;\n        html = args.content = self.getContent(args);\n        if (!args.no_events) {\n          self.fire('SaveContent', args);\n        }\n        if (args.format === 'raw') {\n          self.fire('RawSaveContent', args);\n        }\n        html = args.content;\n        if (!/TEXTAREA|INPUT/i.test(elm.nodeName)) {\n          if (args.is_removing || !self.inline) {\n            elm.innerHTML = html;\n          }\n          if (form = DOM$7.getParent(self.id, 'form')) {\n            each$l(form.elements, function (elm) {\n              if (elm.name === self.id) {\n                elm.value = html;\n                return false;\n              }\n            });\n          }\n        } else {\n          elm.value = html;\n        }\n        args.element = elm = null;\n        if (args.set_dirty !== false) {\n          self.setDirty(false);\n        }\n        return html;\n      },\n      setContent: function (content, args) {\n        return setContent$1(this, content, args);\n      },\n      getContent: function (args) {\n        return getContent$1(this, args);\n      },\n      insertContent: function (content, args) {\n        if (args) {\n          content = extend$4({ content: content }, args);\n        }\n        this.execCommand('mceInsertContent', false, content);\n      },\n      isDirty: function () {\n        return !this.isNotDirty;\n      },\n      setDirty: function (state) {\n        var oldState = !this.isNotDirty;\n        this.isNotDirty = !state;\n        if (state && state !== oldState) {\n          this.fire('dirty');\n        }\n      },\n      setMode: function (mode) {\n        setMode(this, mode);\n      },\n      getContainer: function () {\n        var self = this;\n        if (!self.container) {\n          self.container = DOM$7.get(self.editorContainer || self.id + '_parent');\n        }\n        return self.container;\n      },\n      getContentAreaContainer: function () {\n        return this.contentAreaContainer;\n      },\n      getElement: function () {\n        if (!this.targetElm) {\n          this.targetElm = DOM$7.get(this.id);\n        }\n        return this.targetElm;\n      },\n      getWin: function () {\n        var self = this;\n        var elm;\n        if (!self.contentWindow) {\n          elm = self.iframeElement;\n          if (elm) {\n            self.contentWindow = elm.contentWindow;\n          }\n        }\n        return self.contentWindow;\n      },\n      getDoc: function () {\n        var self = this;\n        var win;\n        if (!self.contentDocument) {\n          win = self.getWin();\n          if (win) {\n            self.contentDocument = win.document;\n          }\n        }\n        return self.contentDocument;\n      },\n      getBody: function () {\n        var doc = this.getDoc();\n        return this.bodyElement || (doc ? doc.body : null);\n      },\n      convertURL: function (url, name, elm) {\n        var self = this, settings = self.settings;\n        if (settings.urlconverter_callback) {\n          return self.execCallback('urlconverter_callback', url, elm, true, name);\n        }\n        if (!settings.convert_urls || elm && elm.nodeName === 'LINK' || url.indexOf('file:') === 0 || url.length === 0) {\n          return url;\n        }\n        if (settings.relative_urls) {\n          return self.documentBaseURI.toRelative(url);\n        }\n        url = self.documentBaseURI.toAbsolute(url, settings.remove_script_host);\n        return url;\n      },\n      addVisual: function (elm) {\n        var self = this;\n        var settings = self.settings;\n        var dom = self.dom;\n        var cls;\n        elm = elm || self.getBody();\n        if (self.hasVisual === undefined) {\n          self.hasVisual = settings.visual;\n        }\n        each$l(dom.select('table,a', elm), function (elm) {\n          var value;\n          switch (elm.nodeName) {\n          case 'TABLE':\n            cls = settings.visual_table_class || 'mce-item-table';\n            value = dom.getAttrib(elm, 'border');\n            if ((!value || value === '0') && self.hasVisual) {\n              dom.addClass(elm, cls);\n            } else {\n              dom.removeClass(elm, cls);\n            }\n            return;\n          case 'A':\n            if (!dom.getAttrib(elm, 'href')) {\n              value = dom.getAttrib(elm, 'name') || elm.id;\n              cls = settings.visual_anchor_class || 'mce-item-anchor';\n              if (value && self.hasVisual) {\n                dom.addClass(elm, cls);\n              } else {\n                dom.removeClass(elm, cls);\n              }\n            }\n            return;\n          }\n        });\n        self.fire('VisualAid', {\n          element: elm,\n          hasVisual: self.hasVisual\n        });\n      },\n      remove: function () {\n        remove$7(this);\n      },\n      destroy: function (automatic) {\n        destroy(this, automatic);\n      },\n      uploadImages: function (callback) {\n        return this.editorUpload.uploadImages(callback);\n      },\n      _scanForImages: function () {\n        return this.editorUpload.scanForImages();\n      }\n    };\n    extend$4(Editor.prototype, EditorObservable$1);\n\n    var isEditorUIElement = function (elm) {\n      return elm.className.toString().indexOf('mce-') !== -1;\n    };\n    var FocusManager = { isEditorUIElement: isEditorUIElement };\n\n    var isManualNodeChange = function (e) {\n      return e.type === 'nodechange' && e.selectionChange;\n    };\n    var registerPageMouseUp = function (editor, throttledStore) {\n      var mouseUpPage = function () {\n        throttledStore.throttle();\n      };\n      DOMUtils$1.DOM.bind(domGlobals.document, 'mouseup', mouseUpPage);\n      editor.on('remove', function () {\n        DOMUtils$1.DOM.unbind(domGlobals.document, 'mouseup', mouseUpPage);\n      });\n    };\n    var registerFocusOut = function (editor) {\n      editor.on('focusout', function () {\n        SelectionBookmark.store(editor);\n      });\n    };\n    var registerMouseUp = function (editor, throttledStore) {\n      editor.on('mouseup touchend', function (e) {\n        throttledStore.throttle();\n      });\n    };\n    var registerEditorEvents = function (editor, throttledStore) {\n      var browser = PlatformDetection$1.detect().browser;\n      if (browser.isIE()) {\n        registerFocusOut(editor);\n      } else {\n        registerMouseUp(editor, throttledStore);\n      }\n      editor.on('keyup nodechange', function (e) {\n        if (!isManualNodeChange(e)) {\n          SelectionBookmark.store(editor);\n        }\n      });\n    };\n    var register$3 = function (editor) {\n      var throttledStore = first(function () {\n        SelectionBookmark.store(editor);\n      }, 0);\n      if (editor.inline) {\n        registerPageMouseUp(editor, throttledStore);\n      }\n      editor.on('init', function () {\n        registerEditorEvents(editor, throttledStore);\n      });\n      editor.on('remove', function () {\n        throttledStore.cancel();\n      });\n    };\n    var SelectionRestore = { register: register$3 };\n\n    var documentFocusInHandler;\n    var DOM$8 = DOMUtils$1.DOM;\n    var isEditorUIElement$1 = function (elm) {\n      return FocusManager.isEditorUIElement(elm);\n    };\n    var isUIElement = function (editor, elm) {\n      var customSelector = editor ? editor.settings.custom_ui_selector : '';\n      var parent = DOM$8.getParent(elm, function (elm) {\n        return isEditorUIElement$1(elm) || (customSelector ? editor.dom.is(elm, customSelector) : false);\n      });\n      return parent !== null;\n    };\n    var getActiveElement = function () {\n      try {\n        return domGlobals.document.activeElement;\n      } catch (ex) {\n        return domGlobals.document.body;\n      }\n    };\n    var registerEvents = function (editorManager, e) {\n      var editor = e.editor;\n      SelectionRestore.register(editor);\n      editor.on('focusin', function () {\n        var self = this;\n        var focusedEditor = editorManager.focusedEditor;\n        if (focusedEditor !== self) {\n          if (focusedEditor) {\n            focusedEditor.fire('blur', { focusedEditor: self });\n          }\n          editorManager.setActive(self);\n          editorManager.focusedEditor = self;\n          self.fire('focus', { blurredEditor: focusedEditor });\n          self.focus(true);\n        }\n      });\n      editor.on('focusout', function () {\n        var self = this;\n        Delay.setEditorTimeout(self, function () {\n          var focusedEditor = editorManager.focusedEditor;\n          if (!isUIElement(self, getActiveElement()) && focusedEditor === self) {\n            self.fire('blur', { focusedEditor: null });\n            editorManager.focusedEditor = null;\n          }\n        });\n      });\n      if (!documentFocusInHandler) {\n        documentFocusInHandler = function (e) {\n          var activeEditor = editorManager.activeEditor;\n          var target;\n          target = e.target;\n          if (activeEditor && target.ownerDocument === domGlobals.document) {\n            if (target !== domGlobals.document.body && !isUIElement(activeEditor, target) && editorManager.focusedEditor === activeEditor) {\n              activeEditor.fire('blur', { focusedEditor: null });\n              editorManager.focusedEditor = null;\n            }\n          }\n        };\n        DOM$8.bind(domGlobals.document, 'focusin', documentFocusInHandler);\n      }\n    };\n    var unregisterDocumentEvents = function (editorManager, e) {\n      if (editorManager.focusedEditor === e.editor) {\n        editorManager.focusedEditor = null;\n      }\n      if (!editorManager.activeEditor) {\n        DOM$8.unbind(domGlobals.document, 'focusin', documentFocusInHandler);\n        documentFocusInHandler = null;\n      }\n    };\n    var setup$h = function (editorManager) {\n      editorManager.on('AddEditor', curry(registerEvents, editorManager));\n      editorManager.on('RemoveEditor', curry(unregisterDocumentEvents, editorManager));\n    };\n    var FocusController = {\n      setup: setup$h,\n      isEditorUIElement: isEditorUIElement$1,\n      isUIElement: isUIElement\n    };\n\n    var DOM$9 = DOMUtils$1.DOM;\n    var explode$4 = Tools.explode, each$m = Tools.each, extend$5 = Tools.extend;\n    var instanceCounter = 0, beforeUnloadDelegate, EditorManager, boundGlobalEvents = false;\n    var legacyEditors = [];\n    var editors = [];\n    var isValidLegacyKey = function (id) {\n      return id !== 'length';\n    };\n    var globalEventDelegate = function (e) {\n      var type = e.type;\n      each$m(EditorManager.get(), function (editor) {\n        switch (type) {\n        case 'scroll':\n          editor.fire('ScrollWindow', e);\n          break;\n        case 'resize':\n          editor.fire('ResizeWindow', e);\n          break;\n        }\n      });\n    };\n    var toggleGlobalEvents = function (state) {\n      if (state !== boundGlobalEvents) {\n        if (state) {\n          DomQuery(window).on('resize scroll', globalEventDelegate);\n        } else {\n          DomQuery(window).off('resize scroll', globalEventDelegate);\n        }\n        boundGlobalEvents = state;\n      }\n    };\n    var removeEditorFromList = function (targetEditor) {\n      var oldEditors = editors;\n      delete legacyEditors[targetEditor.id];\n      for (var i = 0; i < legacyEditors.length; i++) {\n        if (legacyEditors[i] === targetEditor) {\n          legacyEditors.splice(i, 1);\n          break;\n        }\n      }\n      editors = filter(editors, function (editor) {\n        return targetEditor !== editor;\n      });\n      if (EditorManager.activeEditor === targetEditor) {\n        EditorManager.activeEditor = editors.length > 0 ? editors[0] : null;\n      }\n      if (EditorManager.focusedEditor === targetEditor) {\n        EditorManager.focusedEditor = null;\n      }\n      return oldEditors.length !== editors.length;\n    };\n    var purgeDestroyedEditor = function (editor) {\n      if (editor && editor.initialized && !(editor.getContainer() || editor.getBody()).parentNode) {\n        removeEditorFromList(editor);\n        editor.unbindAllNativeEvents();\n        editor.destroy(true);\n        editor.removed = true;\n        editor = null;\n      }\n      return editor;\n    };\n    EditorManager = {\n      defaultSettings: {},\n      $: DomQuery,\n      majorVersion: '4',\n      minorVersion: '9.11',\n      releaseDate: '2020-07-13',\n      editors: legacyEditors,\n      i18n: I18n,\n      activeEditor: null,\n      settings: {},\n      setup: function () {\n        var self = this;\n        var baseURL, documentBaseURL, suffix = '';\n        documentBaseURL = URI.getDocumentBaseUrl(domGlobals.document.location);\n        if (/^[^:]+:\\/\\/\\/?[^\\/]+\\//.test(documentBaseURL)) {\n          documentBaseURL = documentBaseURL.replace(/[\\?#].*$/, '').replace(/[\\/\\\\][^\\/]+$/, '');\n          if (!/[\\/\\\\]$/.test(documentBaseURL)) {\n            documentBaseURL += '/';\n          }\n        }\n        var preInit = window.tinymce || window.tinyMCEPreInit;\n        if (preInit) {\n          baseURL = preInit.base || preInit.baseURL;\n          suffix = preInit.suffix;\n        } else {\n          var scripts = domGlobals.document.getElementsByTagName('script');\n          for (var i = 0; i < scripts.length; i++) {\n            var src = scripts[i].src || '';\n            if (src === '') {\n              continue;\n            }\n            var srcScript = src.substring(src.lastIndexOf('/'));\n            if (/tinymce(\\.full|\\.jquery|)(\\.min|\\.dev|)\\.js/.test(src)) {\n              if (srcScript.indexOf('.min') !== -1) {\n                suffix = '.min';\n              }\n              baseURL = src.substring(0, src.lastIndexOf('/'));\n              break;\n            }\n          }\n          if (!baseURL && domGlobals.document.currentScript) {\n            var src = domGlobals.document.currentScript.src;\n            if (src.indexOf('.min') !== -1) {\n              suffix = '.min';\n            }\n            baseURL = src.substring(0, src.lastIndexOf('/'));\n          }\n        }\n        self.baseURL = new URI(documentBaseURL).toAbsolute(baseURL);\n        self.documentBaseURL = documentBaseURL;\n        self.baseURI = new URI(self.baseURL);\n        self.suffix = suffix;\n        FocusController.setup(self);\n      },\n      overrideDefaults: function (defaultSettings) {\n        var baseUrl, suffix;\n        baseUrl = defaultSettings.base_url;\n        if (baseUrl) {\n          this.baseURL = new URI(this.documentBaseURL).toAbsolute(baseUrl.replace(/\\/+$/, ''));\n          this.baseURI = new URI(this.baseURL);\n        }\n        suffix = defaultSettings.suffix;\n        if (defaultSettings.suffix) {\n          this.suffix = suffix;\n        }\n        this.defaultSettings = defaultSettings;\n        var pluginBaseUrls = defaultSettings.plugin_base_urls;\n        for (var name in pluginBaseUrls) {\n          AddOnManager.PluginManager.urls[name] = pluginBaseUrls[name];\n        }\n      },\n      init: function (settings) {\n        var self = this;\n        var result, invalidInlineTargets;\n        invalidInlineTargets = Tools.makeMap('area base basefont br col frame hr img input isindex link meta param embed source wbr track ' + 'colgroup option tbody tfoot thead tr script noscript style textarea video audio iframe object menu', ' ');\n        var isInvalidInlineTarget = function (settings, elm) {\n          return settings.inline && elm.tagName.toLowerCase() in invalidInlineTargets;\n        };\n        var createId = function (elm) {\n          var id = elm.id;\n          if (!id) {\n            id = elm.name;\n            if (id && !DOM$9.get(id)) {\n              id = elm.name;\n            } else {\n              id = DOM$9.uniqueId();\n            }\n            elm.setAttribute('id', id);\n          }\n          return id;\n        };\n        var execCallback = function (name) {\n          var callback = settings[name];\n          if (!callback) {\n            return;\n          }\n          return callback.apply(self, Array.prototype.slice.call(arguments, 2));\n        };\n        var hasClass = function (elm, className) {\n          return className.constructor === RegExp ? className.test(elm.className) : DOM$9.hasClass(elm, className);\n        };\n        var findTargets = function (settings) {\n          var l, targets = [];\n          if (Env.ie && Env.ie < 11) {\n            ErrorReporter.initError('TinyMCE does not support the browser you are using. For a list of supported' + ' browsers please see: https://www.tinymce.com/docs/get-started/system-requirements/');\n            return [];\n          }\n          if (settings.types) {\n            each$m(settings.types, function (type) {\n              targets = targets.concat(DOM$9.select(type.selector));\n            });\n            return targets;\n          } else if (settings.selector) {\n            return DOM$9.select(settings.selector);\n          } else if (settings.target) {\n            return [settings.target];\n          }\n          switch (settings.mode) {\n          case 'exact':\n            l = settings.elements || '';\n            if (l.length > 0) {\n              each$m(explode$4(l), function (id) {\n                var elm;\n                if (elm = DOM$9.get(id)) {\n                  targets.push(elm);\n                } else {\n                  each$m(domGlobals.document.forms, function (f) {\n                    each$m(f.elements, function (e) {\n                      if (e.name === id) {\n                        id = 'mce_editor_' + instanceCounter++;\n                        DOM$9.setAttrib(e, 'id', id);\n                        targets.push(e);\n                      }\n                    });\n                  });\n                }\n              });\n            }\n            break;\n          case 'textareas':\n          case 'specific_textareas':\n            each$m(DOM$9.select('textarea'), function (elm) {\n              if (settings.editor_deselector && hasClass(elm, settings.editor_deselector)) {\n                return;\n              }\n              if (!settings.editor_selector || hasClass(elm, settings.editor_selector)) {\n                targets.push(elm);\n              }\n            });\n            break;\n          }\n          return targets;\n        };\n        var provideResults = function (editors) {\n          result = editors;\n        };\n        var initEditors = function () {\n          var initCount = 0;\n          var editors = [];\n          var targets;\n          var createEditor = function (id, settings, targetElm) {\n            var editor = new Editor(id, settings, self);\n            editors.push(editor);\n            editor.on('init', function () {\n              if (++initCount === targets.length) {\n                provideResults(editors);\n              }\n            });\n            editor.targetElm = editor.targetElm || targetElm;\n            editor.render();\n          };\n          DOM$9.unbind(window, 'ready', initEditors);\n          execCallback('onpageload');\n          targets = DomQuery.unique(findTargets(settings));\n          if (settings.types) {\n            each$m(settings.types, function (type) {\n              Tools.each(targets, function (elm) {\n                if (DOM$9.is(elm, type.selector)) {\n                  createEditor(createId(elm), extend$5({}, settings, type), elm);\n                  return false;\n                }\n                return true;\n              });\n            });\n            return;\n          }\n          Tools.each(targets, function (elm) {\n            purgeDestroyedEditor(self.get(elm.id));\n          });\n          targets = Tools.grep(targets, function (elm) {\n            return !self.get(elm.id);\n          });\n          if (targets.length === 0) {\n            provideResults([]);\n          } else {\n            each$m(targets, function (elm) {\n              if (isInvalidInlineTarget(settings, elm)) {\n                ErrorReporter.initError('Could not initialize inline editor on invalid inline target element', elm);\n              } else {\n                createEditor(createId(elm), settings, elm);\n              }\n            });\n          }\n        };\n        self.settings = settings;\n        DOM$9.bind(window, 'ready', initEditors);\n        return new promiseObj(function (resolve) {\n          if (result) {\n            resolve(result);\n          } else {\n            provideResults = function (editors) {\n              resolve(editors);\n            };\n          }\n        });\n      },\n      get: function (id) {\n        if (arguments.length === 0) {\n          return editors.slice(0);\n        } else if (isString(id)) {\n          return find(editors, function (editor) {\n            return editor.id === id;\n          }).getOr(null);\n        } else if (isNumber(id)) {\n          return editors[id] ? editors[id] : null;\n        } else {\n          return null;\n        }\n      },\n      add: function (editor) {\n        var self = this;\n        var existingEditor;\n        existingEditor = legacyEditors[editor.id];\n        if (existingEditor === editor) {\n          return editor;\n        }\n        if (self.get(editor.id) === null) {\n          if (isValidLegacyKey(editor.id)) {\n            legacyEditors[editor.id] = editor;\n          }\n          legacyEditors.push(editor);\n          editors.push(editor);\n        }\n        toggleGlobalEvents(true);\n        self.activeEditor = editor;\n        self.fire('AddEditor', { editor: editor });\n        if (!beforeUnloadDelegate) {\n          beforeUnloadDelegate = function () {\n            self.fire('BeforeUnload');\n          };\n          DOM$9.bind(window, 'beforeunload', beforeUnloadDelegate);\n        }\n        return editor;\n      },\n      createEditor: function (id, settings) {\n        return this.add(new Editor(id, settings, this));\n      },\n      remove: function (selector) {\n        var self = this;\n        var i, editor;\n        if (!selector) {\n          for (i = editors.length - 1; i >= 0; i--) {\n            self.remove(editors[i]);\n          }\n          return;\n        }\n        if (isString(selector)) {\n          each$m(DOM$9.select(selector), function (elm) {\n            editor = self.get(elm.id);\n            if (editor) {\n              self.remove(editor);\n            }\n          });\n          return;\n        }\n        editor = selector;\n        if (isNull(self.get(editor.id))) {\n          return null;\n        }\n        if (removeEditorFromList(editor)) {\n          self.fire('RemoveEditor', { editor: editor });\n        }\n        if (editors.length === 0) {\n          DOM$9.unbind(window, 'beforeunload', beforeUnloadDelegate);\n        }\n        editor.remove();\n        toggleGlobalEvents(editors.length > 0);\n        return editor;\n      },\n      execCommand: function (cmd, ui, value) {\n        var self = this, editor = self.get(value);\n        switch (cmd) {\n        case 'mceAddEditor':\n          if (!self.get(value)) {\n            new Editor(value, self.settings, self).render();\n          }\n          return true;\n        case 'mceRemoveEditor':\n          if (editor) {\n            editor.remove();\n          }\n          return true;\n        case 'mceToggleEditor':\n          if (!editor) {\n            self.execCommand('mceAddEditor', 0, value);\n            return true;\n          }\n          if (editor.isHidden()) {\n            editor.show();\n          } else {\n            editor.hide();\n          }\n          return true;\n        }\n        if (self.activeEditor) {\n          return self.activeEditor.execCommand(cmd, ui, value);\n        }\n        return false;\n      },\n      triggerSave: function () {\n        each$m(editors, function (editor) {\n          editor.save();\n        });\n      },\n      addI18n: function (code, items) {\n        I18n.add(code, items);\n      },\n      translate: function (text) {\n        return I18n.translate(text);\n      },\n      setActive: function (editor) {\n        var activeEditor = this.activeEditor;\n        if (this.activeEditor !== editor) {\n          if (activeEditor) {\n            activeEditor.fire('deactivate', { relatedTarget: editor });\n          }\n          editor.fire('activate', { relatedTarget: activeEditor });\n        }\n        this.activeEditor = editor;\n      }\n    };\n    extend$5(EditorManager, Observable);\n    EditorManager.setup();\n    var EditorManager$1 = EditorManager;\n\n    function RangeUtils(dom) {\n      var walk = function (rng, callback) {\n        return RangeWalk.walk(dom, rng, callback);\n      };\n      var split = SplitRange.split;\n      var normalize = function (rng) {\n        return NormalizeRange.normalize(dom, rng).fold(constant(false), function (normalizedRng) {\n          rng.setStart(normalizedRng.startContainer, normalizedRng.startOffset);\n          rng.setEnd(normalizedRng.endContainer, normalizedRng.endOffset);\n          return true;\n        });\n      };\n      return {\n        walk: walk,\n        split: split,\n        normalize: normalize\n      };\n    }\n    (function (RangeUtils) {\n      RangeUtils.compareRanges = RangeCompare.isEq;\n      RangeUtils.getCaretRangeFromPoint = CaretRangeFromPoint.fromPoint;\n      RangeUtils.getSelectedNode = getSelectedNode;\n      RangeUtils.getNode = getNode;\n    }(RangeUtils || (RangeUtils = {})));\n    var RangeUtils$1 = RangeUtils;\n\n    var min = Math.min, max = Math.max, round$2 = Math.round;\n    var relativePosition = function (rect, targetRect, rel) {\n      var x, y, w, h, targetW, targetH;\n      x = targetRect.x;\n      y = targetRect.y;\n      w = rect.w;\n      h = rect.h;\n      targetW = targetRect.w;\n      targetH = targetRect.h;\n      rel = (rel || '').split('');\n      if (rel[0] === 'b') {\n        y += targetH;\n      }\n      if (rel[1] === 'r') {\n        x += targetW;\n      }\n      if (rel[0] === 'c') {\n        y += round$2(targetH / 2);\n      }\n      if (rel[1] === 'c') {\n        x += round$2(targetW / 2);\n      }\n      if (rel[3] === 'b') {\n        y -= h;\n      }\n      if (rel[4] === 'r') {\n        x -= w;\n      }\n      if (rel[3] === 'c') {\n        y -= round$2(h / 2);\n      }\n      if (rel[4] === 'c') {\n        x -= round$2(w / 2);\n      }\n      return create$4(x, y, w, h);\n    };\n    var findBestRelativePosition = function (rect, targetRect, constrainRect, rels) {\n      var pos, i;\n      for (i = 0; i < rels.length; i++) {\n        pos = relativePosition(rect, targetRect, rels[i]);\n        if (pos.x >= constrainRect.x && pos.x + pos.w <= constrainRect.w + constrainRect.x && pos.y >= constrainRect.y && pos.y + pos.h <= constrainRect.h + constrainRect.y) {\n          return rels[i];\n        }\n      }\n      return null;\n    };\n    var inflate = function (rect, w, h) {\n      return create$4(rect.x - w, rect.y - h, rect.w + w * 2, rect.h + h * 2);\n    };\n    var intersect = function (rect, cropRect) {\n      var x1, y1, x2, y2;\n      x1 = max(rect.x, cropRect.x);\n      y1 = max(rect.y, cropRect.y);\n      x2 = min(rect.x + rect.w, cropRect.x + cropRect.w);\n      y2 = min(rect.y + rect.h, cropRect.y + cropRect.h);\n      if (x2 - x1 < 0 || y2 - y1 < 0) {\n        return null;\n      }\n      return create$4(x1, y1, x2 - x1, y2 - y1);\n    };\n    var clamp$1 = function (rect, clampRect, fixedSize) {\n      var underflowX1, underflowY1, overflowX2, overflowY2, x1, y1, x2, y2, cx2, cy2;\n      x1 = rect.x;\n      y1 = rect.y;\n      x2 = rect.x + rect.w;\n      y2 = rect.y + rect.h;\n      cx2 = clampRect.x + clampRect.w;\n      cy2 = clampRect.y + clampRect.h;\n      underflowX1 = max(0, clampRect.x - x1);\n      underflowY1 = max(0, clampRect.y - y1);\n      overflowX2 = max(0, x2 - cx2);\n      overflowY2 = max(0, y2 - cy2);\n      x1 += underflowX1;\n      y1 += underflowY1;\n      if (fixedSize) {\n        x2 += underflowX1;\n        y2 += underflowY1;\n        x1 -= overflowX2;\n        y1 -= overflowY2;\n      }\n      x2 -= overflowX2;\n      y2 -= overflowY2;\n      return create$4(x1, y1, x2 - x1, y2 - y1);\n    };\n    var create$4 = function (x, y, w, h) {\n      return {\n        x: x,\n        y: y,\n        w: w,\n        h: h\n      };\n    };\n    var fromClientRect = function (clientRect) {\n      return create$4(clientRect.left, clientRect.top, clientRect.width, clientRect.height);\n    };\n    var Rect = {\n      inflate: inflate,\n      relativePosition: relativePosition,\n      findBestRelativePosition: findBestRelativePosition,\n      intersect: intersect,\n      clamp: clamp$1,\n      create: create$4,\n      fromClientRect: fromClientRect\n    };\n\n    var types = {};\n    var Factory = {\n      add: function (type, typeClass) {\n        types[type.toLowerCase()] = typeClass;\n      },\n      has: function (type) {\n        return !!types[type.toLowerCase()];\n      },\n      get: function (type) {\n        var lctype = type.toLowerCase();\n        var controlType = types.hasOwnProperty(lctype) ? types[lctype] : null;\n        if (controlType === null) {\n          throw new Error('Could not find module for type: ' + type);\n        }\n        return controlType;\n      },\n      create: function (type, settings) {\n        var ControlType;\n        if (typeof type === 'string') {\n          settings = settings || {};\n          settings.type = type;\n        } else {\n          settings = type;\n          type = settings.type;\n        }\n        type = type.toLowerCase();\n        ControlType = types[type];\n        if (!ControlType) {\n          throw new Error('Could not find control by type: ' + type);\n        }\n        ControlType = new ControlType(settings);\n        ControlType.type = type;\n        return ControlType;\n      }\n    };\n\n    var each$n = Tools.each, extend$6 = Tools.extend;\n    var extendClass, initializing;\n    var Class = function () {\n    };\n    Class.extend = extendClass = function (prop) {\n      var self = this;\n      var _super = self.prototype;\n      var prototype, name, member;\n      var Class = function () {\n        var i, mixins, mixin;\n        var self = this;\n        if (!initializing) {\n          if (self.init) {\n            self.init.apply(self, arguments);\n          }\n          mixins = self.Mixins;\n          if (mixins) {\n            i = mixins.length;\n            while (i--) {\n              mixin = mixins[i];\n              if (mixin.init) {\n                mixin.init.apply(self, arguments);\n              }\n            }\n          }\n        }\n      };\n      var dummy = function () {\n        return this;\n      };\n      var createMethod = function (name, fn) {\n        return function () {\n          var self = this;\n          var tmp = self._super;\n          var ret;\n          self._super = _super[name];\n          ret = fn.apply(self, arguments);\n          self._super = tmp;\n          return ret;\n        };\n      };\n      initializing = true;\n      prototype = new self();\n      initializing = false;\n      if (prop.Mixins) {\n        each$n(prop.Mixins, function (mixin) {\n          for (var name_1 in mixin) {\n            if (name_1 !== 'init') {\n              prop[name_1] = mixin[name_1];\n            }\n          }\n        });\n        if (_super.Mixins) {\n          prop.Mixins = _super.Mixins.concat(prop.Mixins);\n        }\n      }\n      if (prop.Methods) {\n        each$n(prop.Methods.split(','), function (name) {\n          prop[name] = dummy;\n        });\n      }\n      if (prop.Properties) {\n        each$n(prop.Properties.split(','), function (name) {\n          var fieldName = '_' + name;\n          prop[name] = function (value) {\n            var self = this;\n            if (value !== undefined) {\n              self[fieldName] = value;\n              return self;\n            }\n            return self[fieldName];\n          };\n        });\n      }\n      if (prop.Statics) {\n        each$n(prop.Statics, function (func, name) {\n          Class[name] = func;\n        });\n      }\n      if (prop.Defaults && _super.Defaults) {\n        prop.Defaults = extend$6({}, _super.Defaults, prop.Defaults);\n      }\n      for (name in prop) {\n        member = prop[name];\n        if (typeof member === 'function' && _super[name]) {\n          prototype[name] = createMethod(name, member);\n        } else {\n          prototype[name] = member;\n        }\n      }\n      Class.prototype = prototype;\n      Class.constructor = Class;\n      Class.extend = extendClass;\n      return Class;\n    };\n\n    var min$1 = Math.min, max$1 = Math.max, round$3 = Math.round;\n    var Color = function (value) {\n      var self = {};\n      var r = 0, g = 0, b = 0;\n      var rgb2hsv = function (r, g, b) {\n        var h, s, v, d, minRGB, maxRGB;\n        h = 0;\n        s = 0;\n        v = 0;\n        r = r / 255;\n        g = g / 255;\n        b = b / 255;\n        minRGB = min$1(r, min$1(g, b));\n        maxRGB = max$1(r, max$1(g, b));\n        if (minRGB === maxRGB) {\n          v = minRGB;\n          return {\n            h: 0,\n            s: 0,\n            v: v * 100\n          };\n        }\n        d = r === minRGB ? g - b : b === minRGB ? r - g : b - r;\n        h = r === minRGB ? 3 : b === minRGB ? 1 : 5;\n        h = 60 * (h - d / (maxRGB - minRGB));\n        s = (maxRGB - minRGB) / maxRGB;\n        v = maxRGB;\n        return {\n          h: round$3(h),\n          s: round$3(s * 100),\n          v: round$3(v * 100)\n        };\n      };\n      var hsvToRgb = function (hue, saturation, brightness) {\n        var side, chroma, x, match;\n        hue = (parseInt(hue, 10) || 0) % 360;\n        saturation = parseInt(saturation, 10) / 100;\n        brightness = parseInt(brightness, 10) / 100;\n        saturation = max$1(0, min$1(saturation, 1));\n        brightness = max$1(0, min$1(brightness, 1));\n        if (saturation === 0) {\n          r = g = b = round$3(255 * brightness);\n          return;\n        }\n        side = hue / 60;\n        chroma = brightness * saturation;\n        x = chroma * (1 - Math.abs(side % 2 - 1));\n        match = brightness - chroma;\n        switch (Math.floor(side)) {\n        case 0:\n          r = chroma;\n          g = x;\n          b = 0;\n          break;\n        case 1:\n          r = x;\n          g = chroma;\n          b = 0;\n          break;\n        case 2:\n          r = 0;\n          g = chroma;\n          b = x;\n          break;\n        case 3:\n          r = 0;\n          g = x;\n          b = chroma;\n          break;\n        case 4:\n          r = x;\n          g = 0;\n          b = chroma;\n          break;\n        case 5:\n          r = chroma;\n          g = 0;\n          b = x;\n          break;\n        default:\n          r = g = b = 0;\n        }\n        r = round$3(255 * (r + match));\n        g = round$3(255 * (g + match));\n        b = round$3(255 * (b + match));\n      };\n      var toHex = function () {\n        var hex = function (val) {\n          val = parseInt(val, 10).toString(16);\n          return val.length > 1 ? val : '0' + val;\n        };\n        return '#' + hex(r) + hex(g) + hex(b);\n      };\n      var toRgb = function () {\n        return {\n          r: r,\n          g: g,\n          b: b\n        };\n      };\n      var toHsv = function () {\n        return rgb2hsv(r, g, b);\n      };\n      var parse = function (value) {\n        var matches;\n        if (typeof value === 'object') {\n          if ('r' in value) {\n            r = value.r;\n            g = value.g;\n            b = value.b;\n          } else if ('v' in value) {\n            hsvToRgb(value.h, value.s, value.v);\n          }\n        } else {\n          if (matches = /rgb\\s*\\(\\s*([0-9]+)\\s*,\\s*([0-9]+)\\s*,\\s*([0-9]+)[^\\)]*\\)/gi.exec(value)) {\n            r = parseInt(matches[1], 10);\n            g = parseInt(matches[2], 10);\n            b = parseInt(matches[3], 10);\n          } else if (matches = /#([0-F]{2})([0-F]{2})([0-F]{2})/gi.exec(value)) {\n            r = parseInt(matches[1], 16);\n            g = parseInt(matches[2], 16);\n            b = parseInt(matches[3], 16);\n          } else if (matches = /#([0-F])([0-F])([0-F])/gi.exec(value)) {\n            r = parseInt(matches[1] + matches[1], 16);\n            g = parseInt(matches[2] + matches[2], 16);\n            b = parseInt(matches[3] + matches[3], 16);\n          }\n        }\n        r = r < 0 ? 0 : r > 255 ? 255 : r;\n        g = g < 0 ? 0 : g > 255 ? 255 : g;\n        b = b < 0 ? 0 : b > 255 ? 255 : b;\n        return self;\n      };\n      if (value) {\n        parse(value);\n      }\n      self.toRgb = toRgb;\n      self.toHsv = toHsv;\n      self.toHex = toHex;\n      self.parse = parse;\n      return self;\n    };\n\n    var serialize = function (o, quote) {\n      var i, v, t, name;\n      quote = quote || '\"';\n      if (o === null) {\n        return 'null';\n      }\n      t = typeof o;\n      if (t === 'string') {\n        v = '\\bb\\tt\\nn\\ff\\rr\"\"\\'\\'\\\\\\\\';\n        return quote + o.replace(/([\\u0080-\\uFFFF\\x00-\\x1f\\\"\\'\\\\])/g, function (a, b) {\n          if (quote === '\"' && a === '\\'') {\n            return a;\n          }\n          i = v.indexOf(b);\n          if (i + 1) {\n            return '\\\\' + v.charAt(i + 1);\n          }\n          a = b.charCodeAt().toString(16);\n          return '\\\\u' + '0000'.substring(a.length) + a;\n        }) + quote;\n      }\n      if (t === 'object') {\n        if (o.hasOwnProperty && Object.prototype.toString.call(o) === '[object Array]') {\n          for (i = 0, v = '['; i < o.length; i++) {\n            v += (i > 0 ? ',' : '') + serialize(o[i], quote);\n          }\n          return v + ']';\n        }\n        v = '{';\n        for (name in o) {\n          if (o.hasOwnProperty(name)) {\n            v += typeof o[name] !== 'function' ? (v.length > 1 ? ',' + quote : quote) + name + quote + ':' + serialize(o[name], quote) : '';\n          }\n        }\n        return v + '}';\n      }\n      return '' + o;\n    };\n    var JSON$1 = {\n      serialize: serialize,\n      parse: function (text) {\n        try {\n          return JSON.parse(text);\n        } catch (ex) {\n        }\n      }\n    };\n\n    var JSONP = {\n      callbacks: {},\n      count: 0,\n      send: function (settings) {\n        var self = this, dom = DOMUtils$1.DOM, count = settings.count !== undefined ? settings.count : self.count;\n        var id = 'tinymce_jsonp_' + count;\n        self.callbacks[count] = function (json) {\n          dom.remove(id);\n          delete self.callbacks[count];\n          settings.callback(json);\n        };\n        dom.add(dom.doc.body, 'script', {\n          id: id,\n          src: settings.url,\n          type: 'text/javascript'\n        });\n        self.count++;\n      }\n    };\n\n    var XHR = {\n      send: function (settings) {\n        var xhr, count = 0;\n        var ready = function () {\n          if (!settings.async || xhr.readyState === 4 || count++ > 10000) {\n            if (settings.success && count < 10000 && xhr.status === 200) {\n              settings.success.call(settings.success_scope, '' + xhr.responseText, xhr, settings);\n            } else if (settings.error) {\n              settings.error.call(settings.error_scope, count > 10000 ? 'TIMED_OUT' : 'GENERAL', xhr, settings);\n            }\n            xhr = null;\n          } else {\n            setTimeout(ready, 10);\n          }\n        };\n        settings.scope = settings.scope || this;\n        settings.success_scope = settings.success_scope || settings.scope;\n        settings.error_scope = settings.error_scope || settings.scope;\n        settings.async = settings.async === false ? false : true;\n        settings.data = settings.data || '';\n        XHR.fire('beforeInitialize', { settings: settings });\n        xhr = XMLHttpRequest();\n        if (xhr) {\n          if (xhr.overrideMimeType) {\n            xhr.overrideMimeType(settings.content_type);\n          }\n          xhr.open(settings.type || (settings.data ? 'POST' : 'GET'), settings.url, settings.async);\n          if (settings.crossDomain) {\n            xhr.withCredentials = true;\n          }\n          if (settings.content_type) {\n            xhr.setRequestHeader('Content-Type', settings.content_type);\n          }\n          if (settings.requestheaders) {\n            Tools.each(settings.requestheaders, function (header) {\n              xhr.setRequestHeader(header.key, header.value);\n            });\n          }\n          xhr.setRequestHeader('X-Requested-With', 'XMLHttpRequest');\n          xhr = XHR.fire('beforeSend', {\n            xhr: xhr,\n            settings: settings\n          }).xhr;\n          xhr.send(settings.data);\n          if (!settings.async) {\n            return ready();\n          }\n          setTimeout(ready, 10);\n        }\n      }\n    };\n    Tools.extend(XHR, Observable);\n\n    var extend$7 = Tools.extend;\n    var JSONRequest = function (settings) {\n      this.settings = extend$7({}, settings);\n      this.count = 0;\n    };\n    JSONRequest.sendRPC = function (o) {\n      return new JSONRequest().send(o);\n    };\n    JSONRequest.prototype = {\n      send: function (args) {\n        var ecb = args.error, scb = args.success;\n        args = extend$7(this.settings, args);\n        args.success = function (c, x) {\n          c = JSON$1.parse(c);\n          if (typeof c === 'undefined') {\n            c = { error: 'JSON Parse error.' };\n          }\n          if (c.error) {\n            ecb.call(args.error_scope || args.scope, c.error, x);\n          } else {\n            scb.call(args.success_scope || args.scope, c.result);\n          }\n        };\n        args.error = function (ty, x) {\n          if (ecb) {\n            ecb.call(args.error_scope || args.scope, ty, x);\n          }\n        };\n        args.data = JSON$1.serialize({\n          id: args.id || 'c' + this.count++,\n          method: args.method,\n          params: args.params\n        });\n        args.content_type = 'application/json';\n        XHR.send(args);\n      }\n    };\n\n    var create$5 = function () {\n      return function () {\n        var data = {};\n        var keys = [];\n        var storage = {\n          getItem: function (key) {\n            var item = data[key];\n            return item ? item : null;\n          },\n          setItem: function (key, value) {\n            keys.push(key);\n            data[key] = String(value);\n          },\n          key: function (index) {\n            return keys[index];\n          },\n          removeItem: function (key) {\n            keys = keys.filter(function (k) {\n              return k === key;\n            });\n            delete data[key];\n          },\n          clear: function () {\n            keys = [];\n            data = {};\n          },\n          length: 0\n        };\n        Object.defineProperty(storage, 'length', {\n          get: function () {\n            return keys.length;\n          },\n          configurable: false,\n          enumerable: false\n        });\n        return storage;\n      }();\n    };\n\n    var localStorage;\n    try {\n      localStorage = domGlobals.window.localStorage;\n    } catch (e) {\n      localStorage = create$5();\n    }\n    var LocalStorage = localStorage;\n\n    var tinymce = EditorManager$1;\n    var publicApi = {\n      geom: { Rect: Rect },\n      util: {\n        Promise: promiseObj,\n        Delay: Delay,\n        Tools: Tools,\n        VK: VK,\n        URI: URI,\n        Class: Class,\n        EventDispatcher: Dispatcher,\n        Observable: Observable,\n        I18n: I18n,\n        XHR: XHR,\n        JSON: JSON$1,\n        JSONRequest: JSONRequest,\n        JSONP: JSONP,\n        LocalStorage: LocalStorage,\n        Color: Color\n      },\n      dom: {\n        EventUtils: EventUtils,\n        Sizzle: Sizzle,\n        DomQuery: DomQuery,\n        TreeWalker: TreeWalker,\n        DOMUtils: DOMUtils$1,\n        ScriptLoader: ScriptLoader,\n        RangeUtils: RangeUtils$1,\n        Serializer: DomSerializer$1,\n        ControlSelection: ControlSelection,\n        BookmarkManager: BookmarkManager$1,\n        Selection: Selection$1,\n        Event: EventUtils.Event\n      },\n      html: {\n        Styles: Styles,\n        Entities: Entities,\n        Node: Node$1,\n        Schema: Schema,\n        SaxParser: SaxParser$1,\n        DomParser: DomParser,\n        Writer: Writer,\n        Serializer: HtmlSerializer\n      },\n      ui: { Factory: Factory },\n      Env: Env,\n      AddOnManager: AddOnManager,\n      Annotator: Annotator,\n      Formatter: Formatter,\n      UndoManager: UndoManager,\n      EditorCommands: EditorCommands,\n      WindowManager: WindowManager,\n      NotificationManager: NotificationManager,\n      EditorObservable: EditorObservable$1,\n      Shortcuts: Shortcuts,\n      Editor: Editor,\n      FocusManager: FocusManager,\n      EditorManager: EditorManager$1,\n      DOM: DOMUtils$1.DOM,\n      ScriptLoader: ScriptLoader.ScriptLoader,\n      PluginManager: AddOnManager.PluginManager,\n      ThemeManager: AddOnManager.ThemeManager,\n      trim: Tools.trim,\n      isArray: Tools.isArray,\n      is: Tools.is,\n      toArray: Tools.toArray,\n      makeMap: Tools.makeMap,\n      each: Tools.each,\n      map: Tools.map,\n      grep: Tools.grep,\n      inArray: Tools.inArray,\n      extend: Tools.extend,\n      create: Tools.create,\n      walk: Tools.walk,\n      createNS: Tools.createNS,\n      resolve: Tools.resolve,\n      explode: Tools.explode,\n      _addCacheSuffix: Tools._addCacheSuffix,\n      isOpera: Env.opera,\n      isWebKit: Env.webkit,\n      isIE: Env.ie,\n      isGecko: Env.gecko,\n      isMac: Env.mac\n    };\n    tinymce = Tools.extend(tinymce, publicApi);\n    var Tinymce = tinymce;\n\n    var exportToModuleLoaders = function (tinymce) {\n      if (true) {\n        try {\n          module.exports = tinymce;\n        } catch (_) {\n        }\n      }\n    };\n    var exportToWindowGlobal = function (tinymce) {\n      window.tinymce = tinymce;\n      window.tinyMCE = tinymce;\n    };\n    exportToWindowGlobal(Tinymce);\n    exportToModuleLoaders(Tinymce);\n\n}(window));\n})();\n\n/* WEBPACK VAR INJECTION */}.call(exports, __webpack_require__(\"162o\").setImmediate, __webpack_require__(\"DuR2\")))\n\n/***/ })\n\n});\n\n\n// WEBPACK FOOTER //\n// static/js/44.0bd3a4442c3b9324a26e.js","// 4.9.11 (2020-07-13)\n(function () {\n(function (domGlobals) {\n    'use strict';\n\n    var noop = function () {\n    };\n    var compose = function (fa, fb) {\n      return function () {\n        var args = [];\n        for (var _i = 0; _i < arguments.length; _i++) {\n          args[_i] = arguments[_i];\n        }\n        return fa(fb.apply(null, args));\n      };\n    };\n    var constant = function (value) {\n      return function () {\n        return value;\n      };\n    };\n    var identity = function (x) {\n      return x;\n    };\n    function curry(fn) {\n      var initialArgs = [];\n      for (var _i = 1; _i < arguments.length; _i++) {\n        initialArgs[_i - 1] = arguments[_i];\n      }\n      return function () {\n        var restArgs = [];\n        for (var _i = 0; _i < arguments.length; _i++) {\n          restArgs[_i] = arguments[_i];\n        }\n        var all = initialArgs.concat(restArgs);\n        return fn.apply(null, all);\n      };\n    }\n    var not = function (f) {\n      return function () {\n        var args = [];\n        for (var _i = 0; _i < arguments.length; _i++) {\n          args[_i] = arguments[_i];\n        }\n        return !f.apply(null, args);\n      };\n    };\n    var die = function (msg) {\n      return function () {\n        throw new Error(msg);\n      };\n    };\n    var never = constant(false);\n    var always = constant(true);\n\n    var none = function () {\n      return NONE;\n    };\n    var NONE = function () {\n      var eq = function (o) {\n        return o.isNone();\n      };\n      var call = function (thunk) {\n        return thunk();\n      };\n      var id = function (n) {\n        return n;\n      };\n      var me = {\n        fold: function (n, s) {\n          return n();\n        },\n        is: never,\n        isSome: never,\n        isNone: always,\n        getOr: id,\n        getOrThunk: call,\n        getOrDie: function (msg) {\n          throw new Error(msg || 'error: getOrDie called on none.');\n        },\n        getOrNull: constant(null),\n        getOrUndefined: constant(undefined),\n        or: id,\n        orThunk: call,\n        map: none,\n        each: noop,\n        bind: none,\n        exists: never,\n        forall: always,\n        filter: none,\n        equals: eq,\n        equals_: eq,\n        toArray: function () {\n          return [];\n        },\n        toString: constant('none()')\n      };\n      if (Object.freeze) {\n        Object.freeze(me);\n      }\n      return me;\n    }();\n    var some = function (a) {\n      var constant_a = constant(a);\n      var self = function () {\n        return me;\n      };\n      var bind = function (f) {\n        return f(a);\n      };\n      var me = {\n        fold: function (n, s) {\n          return s(a);\n        },\n        is: function (v) {\n          return a === v;\n        },\n        isSome: always,\n        isNone: never,\n        getOr: constant_a,\n        getOrThunk: constant_a,\n        getOrDie: constant_a,\n        getOrNull: constant_a,\n        getOrUndefined: constant_a,\n        or: self,\n        orThunk: self,\n        map: function (f) {\n          return some(f(a));\n        },\n        each: function (f) {\n          f(a);\n        },\n        bind: bind,\n        exists: bind,\n        forall: bind,\n        filter: function (f) {\n          return f(a) ? me : NONE;\n        },\n        toArray: function () {\n          return [a];\n        },\n        toString: function () {\n          return 'some(' + a + ')';\n        },\n        equals: function (o) {\n          return o.is(a);\n        },\n        equals_: function (o, elementEq) {\n          return o.fold(never, function (b) {\n            return elementEq(a, b);\n          });\n        }\n      };\n      return me;\n    };\n    var from = function (value) {\n      return value === null || value === undefined ? NONE : some(value);\n    };\n    var Option = {\n      some: some,\n      none: none,\n      from: from\n    };\n\n    var typeOf = function (x) {\n      if (x === null) {\n        return 'null';\n      }\n      var t = typeof x;\n      if (t === 'object' && (Array.prototype.isPrototypeOf(x) || x.constructor && x.constructor.name === 'Array')) {\n        return 'array';\n      }\n      if (t === 'object' && (String.prototype.isPrototypeOf(x) || x.constructor && x.constructor.name === 'String')) {\n        return 'string';\n      }\n      return t;\n    };\n    var isType = function (type) {\n      return function (value) {\n        return typeOf(value) === type;\n      };\n    };\n    var isString = isType('string');\n    var isObject = isType('object');\n    var isArray = isType('array');\n    var isNull = isType('null');\n    var isBoolean = isType('boolean');\n    var isFunction = isType('function');\n    var isNumber = isType('number');\n\n    var nativeSlice = Array.prototype.slice;\n    var nativeIndexOf = Array.prototype.indexOf;\n    var nativePush = Array.prototype.push;\n    var rawIndexOf = function (ts, t) {\n      return nativeIndexOf.call(ts, t);\n    };\n    var indexOf = function (xs, x) {\n      var r = rawIndexOf(xs, x);\n      return r === -1 ? Option.none() : Option.some(r);\n    };\n    var contains = function (xs, x) {\n      return rawIndexOf(xs, x) > -1;\n    };\n    var exists = function (xs, pred) {\n      for (var i = 0, len = xs.length; i < len; i++) {\n        var x = xs[i];\n        if (pred(x, i)) {\n          return true;\n        }\n      }\n      return false;\n    };\n    var map = function (xs, f) {\n      var len = xs.length;\n      var r = new Array(len);\n      for (var i = 0; i < len; i++) {\n        var x = xs[i];\n        r[i] = f(x, i);\n      }\n      return r;\n    };\n    var each = function (xs, f) {\n      for (var i = 0, len = xs.length; i < len; i++) {\n        var x = xs[i];\n        f(x, i);\n      }\n    };\n    var eachr = function (xs, f) {\n      for (var i = xs.length - 1; i >= 0; i--) {\n        var x = xs[i];\n        f(x, i);\n      }\n    };\n    var partition = function (xs, pred) {\n      var pass = [];\n      var fail = [];\n      for (var i = 0, len = xs.length; i < len; i++) {\n        var x = xs[i];\n        var arr = pred(x, i) ? pass : fail;\n        arr.push(x);\n      }\n      return {\n        pass: pass,\n        fail: fail\n      };\n    };\n    var filter = function (xs, pred) {\n      var r = [];\n      for (var i = 0, len = xs.length; i < len; i++) {\n        var x = xs[i];\n        if (pred(x, i)) {\n          r.push(x);\n        }\n      }\n      return r;\n    };\n    var foldr = function (xs, f, acc) {\n      eachr(xs, function (x) {\n        acc = f(acc, x);\n      });\n      return acc;\n    };\n    var foldl = function (xs, f, acc) {\n      each(xs, function (x) {\n        acc = f(acc, x);\n      });\n      return acc;\n    };\n    var find = function (xs, pred) {\n      for (var i = 0, len = xs.length; i < len; i++) {\n        var x = xs[i];\n        if (pred(x, i)) {\n          return Option.some(x);\n        }\n      }\n      return Option.none();\n    };\n    var findIndex = function (xs, pred) {\n      for (var i = 0, len = xs.length; i < len; i++) {\n        var x = xs[i];\n        if (pred(x, i)) {\n          return Option.some(i);\n        }\n      }\n      return Option.none();\n    };\n    var flatten = function (xs) {\n      var r = [];\n      for (var i = 0, len = xs.length; i < len; ++i) {\n        if (!isArray(xs[i])) {\n          throw new Error('Arr.flatten item ' + i + ' was not an array, input: ' + xs);\n        }\n        nativePush.apply(r, xs[i]);\n      }\n      return r;\n    };\n    var bind = function (xs, f) {\n      var output = map(xs, f);\n      return flatten(output);\n    };\n    var forall = function (xs, pred) {\n      for (var i = 0, len = xs.length; i < len; ++i) {\n        var x = xs[i];\n        if (pred(x, i) !== true) {\n          return false;\n        }\n      }\n      return true;\n    };\n    var reverse = function (xs) {\n      var r = nativeSlice.call(xs, 0);\n      r.reverse();\n      return r;\n    };\n    var difference = function (a1, a2) {\n      return filter(a1, function (x) {\n        return !contains(a2, x);\n      });\n    };\n    var mapToObject = function (xs, f) {\n      var r = {};\n      for (var i = 0, len = xs.length; i < len; i++) {\n        var x = xs[i];\n        r[String(x)] = f(x, i);\n      }\n      return r;\n    };\n    var sort = function (xs, comparator) {\n      var copy = nativeSlice.call(xs, 0);\n      copy.sort(comparator);\n      return copy;\n    };\n    var head = function (xs) {\n      return xs.length === 0 ? Option.none() : Option.some(xs[0]);\n    };\n    var last = function (xs) {\n      return xs.length === 0 ? Option.none() : Option.some(xs[xs.length - 1]);\n    };\n    var from$1 = isFunction(Array.from) ? Array.from : function (x) {\n      return nativeSlice.call(x);\n    };\n\n    var Global = typeof domGlobals.window !== 'undefined' ? domGlobals.window : Function('return this;')();\n\n    var path = function (parts, scope) {\n      var o = scope !== undefined && scope !== null ? scope : Global;\n      for (var i = 0; i < parts.length && o !== undefined && o !== null; ++i) {\n        o = o[parts[i]];\n      }\n      return o;\n    };\n    var resolve = function (p, scope) {\n      var parts = p.split('.');\n      return path(parts, scope);\n    };\n\n    var unsafe = function (name, scope) {\n      return resolve(name, scope);\n    };\n    var getOrDie = function (name, scope) {\n      var actual = unsafe(name, scope);\n      if (actual === undefined || actual === null) {\n        throw new Error(name + ' not available on this browser');\n      }\n      return actual;\n    };\n    var Global$1 = { getOrDie: getOrDie };\n\n    var url = function () {\n      return Global$1.getOrDie('URL');\n    };\n    var createObjectURL = function (blob) {\n      return url().createObjectURL(blob);\n    };\n    var revokeObjectURL = function (u) {\n      url().revokeObjectURL(u);\n    };\n    var URL = {\n      createObjectURL: createObjectURL,\n      revokeObjectURL: revokeObjectURL\n    };\n\n    var nav = domGlobals.navigator, userAgent = nav.userAgent;\n    var opera, webkit, ie, ie11, ie12, gecko, mac, iDevice, android, fileApi, phone, tablet, windowsPhone;\n    var matchMediaQuery = function (query) {\n      return 'matchMedia' in domGlobals.window ? domGlobals.matchMedia(query).matches : false;\n    };\n    opera = false;\n    android = /Android/.test(userAgent);\n    webkit = /WebKit/.test(userAgent);\n    ie = !webkit && !opera && /MSIE/gi.test(userAgent) && /Explorer/gi.test(nav.appName);\n    ie = ie && /MSIE (\\w+)\\./.exec(userAgent)[1];\n    ie11 = userAgent.indexOf('Trident/') !== -1 && (userAgent.indexOf('rv:') !== -1 || nav.appName.indexOf('Netscape') !== -1) ? 11 : false;\n    ie12 = userAgent.indexOf('Edge/') !== -1 && !ie && !ie11 ? 12 : false;\n    ie = ie || ie11 || ie12;\n    gecko = !webkit && !ie11 && /Gecko/.test(userAgent);\n    mac = userAgent.indexOf('Mac') !== -1;\n    iDevice = /(iPad|iPhone)/.test(userAgent);\n    fileApi = 'FormData' in domGlobals.window && 'FileReader' in domGlobals.window && 'URL' in domGlobals.window && !!URL.createObjectURL;\n    phone = matchMediaQuery('only screen and (max-device-width: 480px)') && (android || iDevice);\n    tablet = matchMediaQuery('only screen and (min-width: 800px)') && (android || iDevice);\n    windowsPhone = userAgent.indexOf('Windows Phone') !== -1;\n    if (ie12) {\n      webkit = false;\n    }\n    var contentEditable = !iDevice || fileApi || parseInt(userAgent.match(/AppleWebKit\\/(\\d*)/)[1], 10) >= 534;\n    var Env = {\n      opera: opera,\n      webkit: webkit,\n      ie: ie,\n      gecko: gecko,\n      mac: mac,\n      iOS: iDevice,\n      android: android,\n      contentEditable: contentEditable,\n      transparentSrc: 'data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7',\n      caretAfter: ie !== 8,\n      range: domGlobals.window.getSelection && 'Range' in domGlobals.window,\n      documentMode: ie && !ie12 ? domGlobals.document.documentMode || 7 : 10,\n      fileApi: fileApi,\n      ceFalse: ie === false || ie > 8,\n      cacheSuffix: null,\n      container: null,\n      overrideViewPort: null,\n      experimentalShadowDom: false,\n      canHaveCSP: ie === false || ie > 11,\n      desktop: !phone && !tablet,\n      windowsPhone: windowsPhone\n    };\n\n    var promise = function () {\n      function bind(fn, thisArg) {\n        return function () {\n          fn.apply(thisArg, arguments);\n        };\n      }\n      var isArray = Array.isArray || function (value) {\n        return Object.prototype.toString.call(value) === '[object Array]';\n      };\n      var Promise = function (fn) {\n        if (typeof this !== 'object') {\n          throw new TypeError('Promises must be constructed via new');\n        }\n        if (typeof fn !== 'function') {\n          throw new TypeError('not a function');\n        }\n        this._state = null;\n        this._value = null;\n        this._deferreds = [];\n        doResolve(fn, bind(resolve, this), bind(reject, this));\n      };\n      var asap = Promise.immediateFn || typeof setImmediate === 'function' && setImmediate || function (fn) {\n        setTimeout(fn, 1);\n      };\n      function handle(deferred) {\n        var me = this;\n        if (this._state === null) {\n          this._deferreds.push(deferred);\n          return;\n        }\n        asap(function () {\n          var cb = me._state ? deferred.onFulfilled : deferred.onRejected;\n          if (cb === null) {\n            (me._state ? deferred.resolve : deferred.reject)(me._value);\n            return;\n          }\n          var ret;\n          try {\n            ret = cb(me._value);\n          } catch (e) {\n            deferred.reject(e);\n            return;\n          }\n          deferred.resolve(ret);\n        });\n      }\n      function resolve(newValue) {\n        try {\n          if (newValue === this) {\n            throw new TypeError('A promise cannot be resolved with itself.');\n          }\n          if (newValue && (typeof newValue === 'object' || typeof newValue === 'function')) {\n            var then = newValue.then;\n            if (typeof then === 'function') {\n              doResolve(bind(then, newValue), bind(resolve, this), bind(reject, this));\n              return;\n            }\n          }\n          this._state = true;\n          this._value = newValue;\n          finale.call(this);\n        } catch (e) {\n          reject.call(this, e);\n        }\n      }\n      function reject(newValue) {\n        this._state = false;\n        this._value = newValue;\n        finale.call(this);\n      }\n      function finale() {\n        for (var i = 0, len = this._deferreds.length; i < len; i++) {\n          handle.call(this, this._deferreds[i]);\n        }\n        this._deferreds = null;\n      }\n      function Handler(onFulfilled, onRejected, resolve, reject) {\n        this.onFulfilled = typeof onFulfilled === 'function' ? onFulfilled : null;\n        this.onRejected = typeof onRejected === 'function' ? onRejected : null;\n        this.resolve = resolve;\n        this.reject = reject;\n      }\n      function doResolve(fn, onFulfilled, onRejected) {\n        var done = false;\n        try {\n          fn(function (value) {\n            if (done) {\n              return;\n            }\n            done = true;\n            onFulfilled(value);\n          }, function (reason) {\n            if (done) {\n              return;\n            }\n            done = true;\n            onRejected(reason);\n          });\n        } catch (ex) {\n          if (done) {\n            return;\n          }\n          done = true;\n          onRejected(ex);\n        }\n      }\n      Promise.prototype.catch = function (onRejected) {\n        return this.then(null, onRejected);\n      };\n      Promise.prototype.then = function (onFulfilled, onRejected) {\n        var me = this;\n        return new Promise(function (resolve, reject) {\n          handle.call(me, new Handler(onFulfilled, onRejected, resolve, reject));\n        });\n      };\n      Promise.all = function () {\n        var args = Array.prototype.slice.call(arguments.length === 1 && isArray(arguments[0]) ? arguments[0] : arguments);\n        return new Promise(function (resolve, reject) {\n          if (args.length === 0) {\n            return resolve([]);\n          }\n          var remaining = args.length;\n          function res(i, val) {\n            try {\n              if (val && (typeof val === 'object' || typeof val === 'function')) {\n                var then = val.then;\n                if (typeof then === 'function') {\n                  then.call(val, function (val) {\n                    res(i, val);\n                  }, reject);\n                  return;\n                }\n              }\n              args[i] = val;\n              if (--remaining === 0) {\n                resolve(args);\n              }\n            } catch (ex) {\n              reject(ex);\n            }\n          }\n          for (var i = 0; i < args.length; i++) {\n            res(i, args[i]);\n          }\n        });\n      };\n      Promise.resolve = function (value) {\n        if (value && typeof value === 'object' && value.constructor === Promise) {\n          return value;\n        }\n        return new Promise(function (resolve) {\n          resolve(value);\n        });\n      };\n      Promise.reject = function (value) {\n        return new Promise(function (resolve, reject) {\n          reject(value);\n        });\n      };\n      Promise.race = function (values) {\n        return new Promise(function (resolve, reject) {\n          for (var i = 0, len = values.length; i < len; i++) {\n            values[i].then(resolve, reject);\n          }\n        });\n      };\n      return Promise;\n    };\n    var promiseObj = window.Promise ? window.Promise : promise();\n\n    var requestAnimationFramePromise;\n    var requestAnimationFrame = function (callback, element) {\n      var i, requestAnimationFrameFunc = domGlobals.window.requestAnimationFrame;\n      var vendors = [\n        'ms',\n        'moz',\n        'webkit'\n      ];\n      var featurefill = function (callback) {\n        domGlobals.window.setTimeout(callback, 0);\n      };\n      for (i = 0; i < vendors.length && !requestAnimationFrameFunc; i++) {\n        requestAnimationFrameFunc = domGlobals.window[vendors[i] + 'RequestAnimationFrame'];\n      }\n      if (!requestAnimationFrameFunc) {\n        requestAnimationFrameFunc = featurefill;\n      }\n      requestAnimationFrameFunc(callback, element);\n    };\n    var wrappedSetTimeout = function (callback, time) {\n      if (typeof time !== 'number') {\n        time = 0;\n      }\n      return setTimeout(callback, time);\n    };\n    var wrappedSetInterval = function (callback, time) {\n      if (typeof time !== 'number') {\n        time = 1;\n      }\n      return setInterval(callback, time);\n    };\n    var wrappedClearTimeout = function (id) {\n      return clearTimeout(id);\n    };\n    var wrappedClearInterval = function (id) {\n      return clearInterval(id);\n    };\n    var debounce = function (callback, time) {\n      var timer, func;\n      func = function () {\n        var args = arguments;\n        clearTimeout(timer);\n        timer = wrappedSetTimeout(function () {\n          callback.apply(this, args);\n        }, time);\n      };\n      func.stop = function () {\n        clearTimeout(timer);\n      };\n      return func;\n    };\n    var Delay = {\n      requestAnimationFrame: function (callback, element) {\n        if (requestAnimationFramePromise) {\n          requestAnimationFramePromise.then(callback);\n          return;\n        }\n        requestAnimationFramePromise = new promiseObj(function (resolve) {\n          if (!element) {\n            element = domGlobals.document.body;\n          }\n          requestAnimationFrame(resolve, element);\n        }).then(callback);\n      },\n      setTimeout: wrappedSetTimeout,\n      setInterval: wrappedSetInterval,\n      setEditorTimeout: function (editor, callback, time) {\n        return wrappedSetTimeout(function () {\n          if (!editor.removed) {\n            callback();\n          }\n        }, time);\n      },\n      setEditorInterval: function (editor, callback, time) {\n        var timer;\n        timer = wrappedSetInterval(function () {\n          if (!editor.removed) {\n            callback();\n          } else {\n            clearInterval(timer);\n          }\n        }, time);\n        return timer;\n      },\n      debounce: debounce,\n      throttle: debounce,\n      clearInterval: wrappedClearInterval,\n      clearTimeout: wrappedClearTimeout\n    };\n\n    var eventExpandoPrefix = 'mce-data-';\n    var mouseEventRe = /^(?:mouse|contextmenu)|click/;\n    var deprecated = {\n      keyLocation: 1,\n      layerX: 1,\n      layerY: 1,\n      returnValue: 1,\n      webkitMovementX: 1,\n      webkitMovementY: 1,\n      keyIdentifier: 1\n    };\n    var hasIsDefaultPrevented = function (event) {\n      return event.isDefaultPrevented === returnTrue || event.isDefaultPrevented === returnFalse;\n    };\n    var returnFalse = function () {\n      return false;\n    };\n    var returnTrue = function () {\n      return true;\n    };\n    var addEvent = function (target, name, callback, capture) {\n      if (target.addEventListener) {\n        target.addEventListener(name, callback, capture || false);\n      } else if (target.attachEvent) {\n        target.attachEvent('on' + name, callback);\n      }\n    };\n    var removeEvent = function (target, name, callback, capture) {\n      if (target.removeEventListener) {\n        target.removeEventListener(name, callback, capture || false);\n      } else if (target.detachEvent) {\n        target.detachEvent('on' + name, callback);\n      }\n    };\n    var getTargetFromShadowDom = function (event, defaultTarget) {\n      if (event.composedPath) {\n        var composedPath = event.composedPath();\n        if (composedPath && composedPath.length > 0) {\n          return composedPath[0];\n        }\n      }\n      return defaultTarget;\n    };\n    var fix = function (originalEvent, data) {\n      var name;\n      var event = data || {};\n      for (name in originalEvent) {\n        if (!deprecated[name]) {\n          event[name] = originalEvent[name];\n        }\n      }\n      if (!event.target) {\n        event.target = event.srcElement || domGlobals.document;\n      }\n      if (Env.experimentalShadowDom) {\n        event.target = getTargetFromShadowDom(originalEvent, event.target);\n      }\n      if (originalEvent && mouseEventRe.test(originalEvent.type) && originalEvent.pageX === undefined && originalEvent.clientX !== undefined) {\n        var eventDoc = event.target.ownerDocument || domGlobals.document;\n        var doc = eventDoc.documentElement;\n        var body = eventDoc.body;\n        event.pageX = originalEvent.clientX + (doc && doc.scrollLeft || body && body.scrollLeft || 0) - (doc && doc.clientLeft || body && body.clientLeft || 0);\n        event.pageY = originalEvent.clientY + (doc && doc.scrollTop || body && body.scrollTop || 0) - (doc && doc.clientTop || body && body.clientTop || 0);\n      }\n      event.preventDefault = function () {\n        event.isDefaultPrevented = returnTrue;\n        if (originalEvent) {\n          if (originalEvent.preventDefault) {\n            originalEvent.preventDefault();\n          } else {\n            originalEvent.returnValue = false;\n          }\n        }\n      };\n      event.stopPropagation = function () {\n        event.isPropagationStopped = returnTrue;\n        if (originalEvent) {\n          if (originalEvent.stopPropagation) {\n            originalEvent.stopPropagation();\n          } else {\n            originalEvent.cancelBubble = true;\n          }\n        }\n      };\n      event.stopImmediatePropagation = function () {\n        event.isImmediatePropagationStopped = returnTrue;\n        event.stopPropagation();\n      };\n      if (hasIsDefaultPrevented(event) === false) {\n        event.isDefaultPrevented = returnFalse;\n        event.isPropagationStopped = returnFalse;\n        event.isImmediatePropagationStopped = returnFalse;\n      }\n      if (typeof event.metaKey === 'undefined') {\n        event.metaKey = false;\n      }\n      return event;\n    };\n    var bindOnReady = function (win, callback, eventUtils) {\n      var doc = win.document, event = { type: 'ready' };\n      if (eventUtils.domLoaded) {\n        callback(event);\n        return;\n      }\n      var isDocReady = function () {\n        return doc.readyState === 'complete' || doc.readyState === 'interactive' && doc.body;\n      };\n      var readyHandler = function () {\n        if (!eventUtils.domLoaded) {\n          eventUtils.domLoaded = true;\n          callback(event);\n        }\n      };\n      var waitForDomLoaded = function () {\n        if (isDocReady()) {\n          removeEvent(doc, 'readystatechange', waitForDomLoaded);\n          readyHandler();\n        }\n      };\n      var tryScroll = function () {\n        try {\n          doc.documentElement.doScroll('left');\n        } catch (ex) {\n          Delay.setTimeout(tryScroll);\n          return;\n        }\n        readyHandler();\n      };\n      if (doc.addEventListener && !(Env.ie && Env.ie < 11)) {\n        if (isDocReady()) {\n          readyHandler();\n        } else {\n          addEvent(win, 'DOMContentLoaded', readyHandler);\n        }\n      } else {\n        addEvent(doc, 'readystatechange', waitForDomLoaded);\n        if (doc.documentElement.doScroll && win.self === win.top) {\n          tryScroll();\n        }\n      }\n      addEvent(win, 'load', readyHandler);\n    };\n    var EventUtils = function () {\n      var self = this;\n      var events = {}, count, expando, hasFocusIn, hasMouseEnterLeave, mouseEnterLeave;\n      expando = eventExpandoPrefix + (+new Date()).toString(32);\n      hasMouseEnterLeave = 'onmouseenter' in domGlobals.document.documentElement;\n      hasFocusIn = 'onfocusin' in domGlobals.document.documentElement;\n      mouseEnterLeave = {\n        mouseenter: 'mouseover',\n        mouseleave: 'mouseout'\n      };\n      count = 1;\n      self.domLoaded = false;\n      self.events = events;\n      var executeHandlers = function (evt, id) {\n        var callbackList, i, l, callback;\n        var container = events[id];\n        callbackList = container && container[evt.type];\n        if (callbackList) {\n          for (i = 0, l = callbackList.length; i < l; i++) {\n            callback = callbackList[i];\n            if (callback && callback.func.call(callback.scope, evt) === false) {\n              evt.preventDefault();\n            }\n            if (evt.isImmediatePropagationStopped()) {\n              return;\n            }\n          }\n        }\n      };\n      self.bind = function (target, names, callback, scope) {\n        var id, callbackList, i, name, fakeName, nativeHandler, capture;\n        var win = domGlobals.window;\n        var defaultNativeHandler = function (evt) {\n          executeHandlers(fix(evt || win.event), id);\n        };\n        if (!target || target.nodeType === 3 || target.nodeType === 8) {\n          return;\n        }\n        if (!target[expando]) {\n          id = count++;\n          target[expando] = id;\n          events[id] = {};\n        } else {\n          id = target[expando];\n        }\n        scope = scope || target;\n        names = names.split(' ');\n        i = names.length;\n        while (i--) {\n          name = names[i];\n          nativeHandler = defaultNativeHandler;\n          fakeName = capture = false;\n          if (name === 'DOMContentLoaded') {\n            name = 'ready';\n          }\n          if (self.domLoaded && name === 'ready' && target.readyState === 'complete') {\n            callback.call(scope, fix({ type: name }));\n            continue;\n          }\n          if (!hasMouseEnterLeave) {\n            fakeName = mouseEnterLeave[name];\n            if (fakeName) {\n              nativeHandler = function (evt) {\n                var current, related;\n                current = evt.currentTarget;\n                related = evt.relatedTarget;\n                if (related && current.contains) {\n                  related = current.contains(related);\n                } else {\n                  while (related && related !== current) {\n                    related = related.parentNode;\n                  }\n                }\n                if (!related) {\n                  evt = fix(evt || win.event);\n                  evt.type = evt.type === 'mouseout' ? 'mouseleave' : 'mouseenter';\n                  evt.target = current;\n                  executeHandlers(evt, id);\n                }\n              };\n            }\n          }\n          if (!hasFocusIn && (name === 'focusin' || name === 'focusout')) {\n            capture = true;\n            fakeName = name === 'focusin' ? 'focus' : 'blur';\n            nativeHandler = function (evt) {\n              evt = fix(evt || win.event);\n              evt.type = evt.type === 'focus' ? 'focusin' : 'focusout';\n              executeHandlers(evt, id);\n            };\n          }\n          callbackList = events[id][name];\n          if (!callbackList) {\n            events[id][name] = callbackList = [{\n                func: callback,\n                scope: scope\n              }];\n            callbackList.fakeName = fakeName;\n            callbackList.capture = capture;\n            callbackList.nativeHandler = nativeHandler;\n            if (name === 'ready') {\n              bindOnReady(target, nativeHandler, self);\n            } else {\n              addEvent(target, fakeName || name, nativeHandler, capture);\n            }\n          } else {\n            if (name === 'ready' && self.domLoaded) {\n              callback({ type: name });\n            } else {\n              callbackList.push({\n                func: callback,\n                scope: scope\n              });\n            }\n          }\n        }\n        target = callbackList = 0;\n        return callback;\n      };\n      self.unbind = function (target, names, callback) {\n        var id, callbackList, i, ci, name, eventMap;\n        if (!target || target.nodeType === 3 || target.nodeType === 8) {\n          return self;\n        }\n        id = target[expando];\n        if (id) {\n          eventMap = events[id];\n          if (names) {\n            names = names.split(' ');\n            i = names.length;\n            while (i--) {\n              name = names[i];\n              callbackList = eventMap[name];\n              if (callbackList) {\n                if (callback) {\n                  ci = callbackList.length;\n                  while (ci--) {\n                    if (callbackList[ci].func === callback) {\n                      var nativeHandler = callbackList.nativeHandler;\n                      var fakeName = callbackList.fakeName, capture = callbackList.capture;\n                      callbackList = callbackList.slice(0, ci).concat(callbackList.slice(ci + 1));\n                      callbackList.nativeHandler = nativeHandler;\n                      callbackList.fakeName = fakeName;\n                      callbackList.capture = capture;\n                      eventMap[name] = callbackList;\n                    }\n                  }\n                }\n                if (!callback || callbackList.length === 0) {\n                  delete eventMap[name];\n                  removeEvent(target, callbackList.fakeName || name, callbackList.nativeHandler, callbackList.capture);\n                }\n              }\n            }\n          } else {\n            for (name in eventMap) {\n              callbackList = eventMap[name];\n              removeEvent(target, callbackList.fakeName || name, callbackList.nativeHandler, callbackList.capture);\n            }\n            eventMap = {};\n          }\n          for (name in eventMap) {\n            return self;\n          }\n          delete events[id];\n          try {\n            delete target[expando];\n          } catch (ex) {\n            target[expando] = null;\n          }\n        }\n        return self;\n      };\n      self.fire = function (target, name, args) {\n        var id;\n        if (!target || target.nodeType === 3 || target.nodeType === 8) {\n          return self;\n        }\n        args = fix(null, args);\n        args.type = name;\n        args.target = target;\n        do {\n          id = target[expando];\n          if (id) {\n            executeHandlers(args, id);\n          }\n          target = target.parentNode || target.ownerDocument || target.defaultView || target.parentWindow;\n        } while (target && !args.isPropagationStopped());\n        return self;\n      };\n      self.clean = function (target) {\n        var i, children;\n        var unbind = self.unbind;\n        if (!target || target.nodeType === 3 || target.nodeType === 8) {\n          return self;\n        }\n        if (target[expando]) {\n          unbind(target);\n        }\n        if (!target.getElementsByTagName) {\n          target = target.document;\n        }\n        if (target && target.getElementsByTagName) {\n          unbind(target);\n          children = target.getElementsByTagName('*');\n          i = children.length;\n          while (i--) {\n            target = children[i];\n            if (target[expando]) {\n              unbind(target);\n            }\n          }\n        }\n        return self;\n      };\n      self.destroy = function () {\n        events = {};\n      };\n      self.cancel = function (e) {\n        if (e) {\n          e.preventDefault();\n          e.stopImmediatePropagation();\n        }\n        return false;\n      };\n    };\n    EventUtils.Event = new EventUtils();\n    EventUtils.Event.bind(domGlobals.window, 'ready', function () {\n    });\n\n    var i, support, Expr, getText, isXML, tokenize, compile, select, outermostContext, sortInput, hasDuplicate, setDocument, document, docElem, documentIsHTML, rbuggyQSA, rbuggyMatches, matches, contains$1, expando = 'sizzle' + -new Date(), preferredDoc = domGlobals.window.document, dirruns = 0, done = 0, classCache = createCache(), tokenCache = createCache(), compilerCache = createCache(), sortOrder = function (a, b) {\n        if (a === b) {\n          hasDuplicate = true;\n        }\n        return 0;\n      }, strundefined = typeof undefined, MAX_NEGATIVE = 1 << 31, hasOwn = {}.hasOwnProperty, arr = [], pop = arr.pop, push_native = arr.push, push = arr.push, slice = arr.slice, indexOf$1 = arr.indexOf || function (elem) {\n        var i = 0, len = this.length;\n        for (; i < len; i++) {\n          if (this[i] === elem) {\n            return i;\n          }\n        }\n        return -1;\n      }, booleans = 'checked|selected|async|autofocus|autoplay|controls|defer|disabled|hidden|ismap|loop|multiple|open|readonly|required|scoped', whitespace = '[\\\\x20\\\\t\\\\r\\\\n\\\\f]', identifier = '(?:\\\\\\\\.|[\\\\w-]|[^\\\\x00-\\\\xa0])+', attributes = '\\\\[' + whitespace + '*(' + identifier + ')(?:' + whitespace + '*([*^$|!~]?=)' + whitespace + '*(?:\\'((?:\\\\\\\\.|[^\\\\\\\\\\'])*)\\'|\"((?:\\\\\\\\.|[^\\\\\\\\\"])*)\"|(' + identifier + '))|)' + whitespace + '*\\\\]', pseudos = ':(' + identifier + ')(?:\\\\((' + '(\\'((?:\\\\\\\\.|[^\\\\\\\\\\'])*)\\'|\"((?:\\\\\\\\.|[^\\\\\\\\\"])*)\")|' + '((?:\\\\\\\\.|[^\\\\\\\\()[\\\\]]|' + attributes + ')*)|' + '.*' + ')\\\\)|)', rtrim = new RegExp('^' + whitespace + '+|((?:^|[^\\\\\\\\])(?:\\\\\\\\.)*)' + whitespace + '+$', 'g'), rcomma = new RegExp('^' + whitespace + '*,' + whitespace + '*'), rcombinators = new RegExp('^' + whitespace + '*([>+~]|' + whitespace + ')' + whitespace + '*'), rattributeQuotes = new RegExp('=' + whitespace + '*([^\\\\]\\'\"]*?)' + whitespace + '*\\\\]', 'g'), rpseudo = new RegExp(pseudos), ridentifier = new RegExp('^' + identifier + '$'), matchExpr = {\n        ID: new RegExp('^#(' + identifier + ')'),\n        CLASS: new RegExp('^\\\\.(' + identifier + ')'),\n        TAG: new RegExp('^(' + identifier + '|[*])'),\n        ATTR: new RegExp('^' + attributes),\n        PSEUDO: new RegExp('^' + pseudos),\n        CHILD: new RegExp('^:(only|first|last|nth|nth-last)-(child|of-type)(?:\\\\(' + whitespace + '*(even|odd|(([+-]|)(\\\\d*)n|)' + whitespace + '*(?:([+-]|)' + whitespace + '*(\\\\d+)|))' + whitespace + '*\\\\)|)', 'i'),\n        bool: new RegExp('^(?:' + booleans + ')$', 'i'),\n        needsContext: new RegExp('^' + whitespace + '*[>+~]|:(even|odd|eq|gt|lt|nth|first|last)(?:\\\\(' + whitespace + '*((?:-\\\\d)?\\\\d*)' + whitespace + '*\\\\)|)(?=[^-]|$)', 'i')\n      }, rinputs = /^(?:input|select|textarea|button)$/i, rheader = /^h\\d$/i, rnative = /^[^{]+\\{\\s*\\[native \\w/, rquickExpr = /^(?:#([\\w-]+)|(\\w+)|\\.([\\w-]+))$/, rsibling = /[+~]/, rescape = /'|\\\\/g, runescape = new RegExp('\\\\\\\\([\\\\da-f]{1,6}' + whitespace + '?|(' + whitespace + ')|.)', 'ig'), funescape = function (_, escaped, escapedWhitespace) {\n        var high = '0x' + escaped - 65536;\n        return high !== high || escapedWhitespace ? escaped : high < 0 ? String.fromCharCode(high + 65536) : String.fromCharCode(high >> 10 | 55296, high & 1023 | 56320);\n      };\n    try {\n      push.apply(arr = slice.call(preferredDoc.childNodes), preferredDoc.childNodes);\n      arr[preferredDoc.childNodes.length].nodeType;\n    } catch (e) {\n      push = {\n        apply: arr.length ? function (target, els) {\n          push_native.apply(target, slice.call(els));\n        } : function (target, els) {\n          var j = target.length, i = 0;\n          while (target[j++] = els[i++]) {\n          }\n          target.length = j - 1;\n        }\n      };\n    }\n    var Sizzle = function (selector, context, results, seed) {\n      var match, elem, m, nodeType, i, groups, old, nid, newContext, newSelector;\n      if ((context ? context.ownerDocument || context : preferredDoc) !== document) {\n        setDocument(context);\n      }\n      context = context || document;\n      results = results || [];\n      if (!selector || typeof selector !== 'string') {\n        return results;\n      }\n      if ((nodeType = context.nodeType) !== 1 && nodeType !== 9) {\n        return [];\n      }\n      if (documentIsHTML && !seed) {\n        if (match = rquickExpr.exec(selector)) {\n          if (m = match[1]) {\n            if (nodeType === 9) {\n              elem = context.getElementById(m);\n              if (elem && elem.parentNode) {\n                if (elem.id === m) {\n                  results.push(elem);\n                  return results;\n                }\n              } else {\n                return results;\n              }\n            } else {\n              if (context.ownerDocument && (elem = context.ownerDocument.getElementById(m)) && contains$1(context, elem) && elem.id === m) {\n                results.push(elem);\n                return results;\n              }\n            }\n          } else if (match[2]) {\n            push.apply(results, context.getElementsByTagName(selector));\n            return results;\n          } else if ((m = match[3]) && support.getElementsByClassName) {\n            push.apply(results, context.getElementsByClassName(m));\n            return results;\n          }\n        }\n        if (support.qsa && (!rbuggyQSA || !rbuggyQSA.test(selector))) {\n          nid = old = expando;\n          newContext = context;\n          newSelector = nodeType === 9 && selector;\n          if (nodeType === 1 && context.nodeName.toLowerCase() !== 'object') {\n            groups = tokenize(selector);\n            if (old = context.getAttribute('id')) {\n              nid = old.replace(rescape, '\\\\$&');\n            } else {\n              context.setAttribute('id', nid);\n            }\n            nid = '[id=\\'' + nid + '\\'] ';\n            i = groups.length;\n            while (i--) {\n              groups[i] = nid + toSelector(groups[i]);\n            }\n            newContext = rsibling.test(selector) && testContext(context.parentNode) || context;\n            newSelector = groups.join(',');\n          }\n          if (newSelector) {\n            try {\n              push.apply(results, newContext.querySelectorAll(newSelector));\n              return results;\n            } catch (qsaError) {\n            } finally {\n              if (!old) {\n                context.removeAttribute('id');\n              }\n            }\n          }\n        }\n      }\n      return select(selector.replace(rtrim, '$1'), context, results, seed);\n    };\n    function createCache() {\n      var keys = [];\n      function cache(key, value) {\n        if (keys.push(key + ' ') > Expr.cacheLength) {\n          delete cache[keys.shift()];\n        }\n        return cache[key + ' '] = value;\n      }\n      return cache;\n    }\n    function markFunction(fn) {\n      fn[expando] = true;\n      return fn;\n    }\n    function siblingCheck(a, b) {\n      var cur = b && a, diff = cur && a.nodeType === 1 && b.nodeType === 1 && (~b.sourceIndex || MAX_NEGATIVE) - (~a.sourceIndex || MAX_NEGATIVE);\n      if (diff) {\n        return diff;\n      }\n      if (cur) {\n        while (cur = cur.nextSibling) {\n          if (cur === b) {\n            return -1;\n          }\n        }\n      }\n      return a ? 1 : -1;\n    }\n    function createInputPseudo(type) {\n      return function (elem) {\n        var name = elem.nodeName.toLowerCase();\n        return name === 'input' && elem.type === type;\n      };\n    }\n    function createButtonPseudo(type) {\n      return function (elem) {\n        var name = elem.nodeName.toLowerCase();\n        return (name === 'input' || name === 'button') && elem.type === type;\n      };\n    }\n    function createPositionalPseudo(fn) {\n      return markFunction(function (argument) {\n        argument = +argument;\n        return markFunction(function (seed, matches) {\n          var j, matchIndexes = fn([], seed.length, argument), i = matchIndexes.length;\n          while (i--) {\n            if (seed[j = matchIndexes[i]]) {\n              seed[j] = !(matches[j] = seed[j]);\n            }\n          }\n        });\n      });\n    }\n    function testContext(context) {\n      return context && typeof context.getElementsByTagName !== strundefined && context;\n    }\n    support = Sizzle.support = {};\n    isXML = Sizzle.isXML = function (elem) {\n      var documentElement = elem && (elem.ownerDocument || elem).documentElement;\n      return documentElement ? documentElement.nodeName !== 'HTML' : false;\n    };\n    setDocument = Sizzle.setDocument = function (node) {\n      var hasCompare, doc = node ? node.ownerDocument || node : preferredDoc, parent = doc.defaultView;\n      function getTop(win) {\n        try {\n          return win.top;\n        } catch (ex) {\n        }\n        return null;\n      }\n      if (doc === document || doc.nodeType !== 9 || !doc.documentElement) {\n        return document;\n      }\n      document = doc;\n      docElem = doc.documentElement;\n      documentIsHTML = !isXML(doc);\n      if (parent && parent !== getTop(parent)) {\n        if (parent.addEventListener) {\n          parent.addEventListener('unload', function () {\n            setDocument();\n          }, false);\n        } else if (parent.attachEvent) {\n          parent.attachEvent('onunload', function () {\n            setDocument();\n          });\n        }\n      }\n      support.attributes = true;\n      support.getElementsByTagName = true;\n      support.getElementsByClassName = rnative.test(doc.getElementsByClassName);\n      support.getById = true;\n      Expr.find.ID = function (id, context) {\n        if (typeof context.getElementById !== strundefined && documentIsHTML) {\n          var m = context.getElementById(id);\n          return m && m.parentNode ? [m] : [];\n        }\n      };\n      Expr.filter.ID = function (id) {\n        var attrId = id.replace(runescape, funescape);\n        return function (elem) {\n          return elem.getAttribute('id') === attrId;\n        };\n      };\n      Expr.find.TAG = support.getElementsByTagName ? function (tag, context) {\n        if (typeof context.getElementsByTagName !== strundefined) {\n          return context.getElementsByTagName(tag);\n        }\n      } : function (tag, context) {\n        var elem, tmp = [], i = 0, results = context.getElementsByTagName(tag);\n        if (tag === '*') {\n          while (elem = results[i++]) {\n            if (elem.nodeType === 1) {\n              tmp.push(elem);\n            }\n          }\n          return tmp;\n        }\n        return results;\n      };\n      Expr.find.CLASS = support.getElementsByClassName && function (className, context) {\n        if (documentIsHTML) {\n          return context.getElementsByClassName(className);\n        }\n      };\n      rbuggyMatches = [];\n      rbuggyQSA = [];\n      support.disconnectedMatch = true;\n      rbuggyQSA = rbuggyQSA.length && new RegExp(rbuggyQSA.join('|'));\n      rbuggyMatches = rbuggyMatches.length && new RegExp(rbuggyMatches.join('|'));\n      hasCompare = rnative.test(docElem.compareDocumentPosition);\n      contains$1 = hasCompare || rnative.test(docElem.contains) ? function (a, b) {\n        var adown = a.nodeType === 9 ? a.documentElement : a, bup = b && b.parentNode;\n        return a === bup || !!(bup && bup.nodeType === 1 && (adown.contains ? adown.contains(bup) : a.compareDocumentPosition && a.compareDocumentPosition(bup) & 16));\n      } : function (a, b) {\n        if (b) {\n          while (b = b.parentNode) {\n            if (b === a) {\n              return true;\n            }\n          }\n        }\n        return false;\n      };\n      sortOrder = hasCompare ? function (a, b) {\n        if (a === b) {\n          hasDuplicate = true;\n          return 0;\n        }\n        var compare = !a.compareDocumentPosition - !b.compareDocumentPosition;\n        if (compare) {\n          return compare;\n        }\n        compare = (a.ownerDocument || a) === (b.ownerDocument || b) ? a.compareDocumentPosition(b) : 1;\n        if (compare & 1 || !support.sortDetached && b.compareDocumentPosition(a) === compare) {\n          if (a === doc || a.ownerDocument === preferredDoc && contains$1(preferredDoc, a)) {\n            return -1;\n          }\n          if (b === doc || b.ownerDocument === preferredDoc && contains$1(preferredDoc, b)) {\n            return 1;\n          }\n          return sortInput ? indexOf$1.call(sortInput, a) - indexOf$1.call(sortInput, b) : 0;\n        }\n        return compare & 4 ? -1 : 1;\n      } : function (a, b) {\n        if (a === b) {\n          hasDuplicate = true;\n          return 0;\n        }\n        var cur, i = 0, aup = a.parentNode, bup = b.parentNode, ap = [a], bp = [b];\n        if (!aup || !bup) {\n          return a === doc ? -1 : b === doc ? 1 : aup ? -1 : bup ? 1 : sortInput ? indexOf$1.call(sortInput, a) - indexOf$1.call(sortInput, b) : 0;\n        } else if (aup === bup) {\n          return siblingCheck(a, b);\n        }\n        cur = a;\n        while (cur = cur.parentNode) {\n          ap.unshift(cur);\n        }\n        cur = b;\n        while (cur = cur.parentNode) {\n          bp.unshift(cur);\n        }\n        while (ap[i] === bp[i]) {\n          i++;\n        }\n        return i ? siblingCheck(ap[i], bp[i]) : ap[i] === preferredDoc ? -1 : bp[i] === preferredDoc ? 1 : 0;\n      };\n      return doc;\n    };\n    Sizzle.matches = function (expr, elements) {\n      return Sizzle(expr, null, null, elements);\n    };\n    Sizzle.matchesSelector = function (elem, expr) {\n      if ((elem.ownerDocument || elem) !== document) {\n        setDocument(elem);\n      }\n      expr = expr.replace(rattributeQuotes, '=\\'$1\\']');\n      if (support.matchesSelector && documentIsHTML && (!rbuggyMatches || !rbuggyMatches.test(expr)) && (!rbuggyQSA || !rbuggyQSA.test(expr))) {\n        try {\n          var ret = matches.call(elem, expr);\n          if (ret || support.disconnectedMatch || elem.document && elem.document.nodeType !== 11) {\n            return ret;\n          }\n        } catch (e) {\n        }\n      }\n      return Sizzle(expr, document, null, [elem]).length > 0;\n    };\n    Sizzle.contains = function (context, elem) {\n      if ((context.ownerDocument || context) !== document) {\n        setDocument(context);\n      }\n      return contains$1(context, elem);\n    };\n    Sizzle.attr = function (elem, name) {\n      if ((elem.ownerDocument || elem) !== document) {\n        setDocument(elem);\n      }\n      var fn = Expr.attrHandle[name.toLowerCase()], val = fn && hasOwn.call(Expr.attrHandle, name.toLowerCase()) ? fn(elem, name, !documentIsHTML) : undefined;\n      return val !== undefined ? val : support.attributes || !documentIsHTML ? elem.getAttribute(name) : (val = elem.getAttributeNode(name)) && val.specified ? val.value : null;\n    };\n    Sizzle.error = function (msg) {\n      throw new Error('Syntax error, unrecognized expression: ' + msg);\n    };\n    Sizzle.uniqueSort = function (results) {\n      var elem, duplicates = [], j = 0, i = 0;\n      hasDuplicate = !support.detectDuplicates;\n      sortInput = !support.sortStable && results.slice(0);\n      results.sort(sortOrder);\n      if (hasDuplicate) {\n        while (elem = results[i++]) {\n          if (elem === results[i]) {\n            j = duplicates.push(i);\n          }\n        }\n        while (j--) {\n          results.splice(duplicates[j], 1);\n        }\n      }\n      sortInput = null;\n      return results;\n    };\n    getText = Sizzle.getText = function (elem) {\n      var node, ret = '', i = 0, nodeType = elem.nodeType;\n      if (!nodeType) {\n        while (node = elem[i++]) {\n          ret += getText(node);\n        }\n      } else if (nodeType === 1 || nodeType === 9 || nodeType === 11) {\n        if (typeof elem.textContent === 'string') {\n          return elem.textContent;\n        } else {\n          for (elem = elem.firstChild; elem; elem = elem.nextSibling) {\n            ret += getText(elem);\n          }\n        }\n      } else if (nodeType === 3 || nodeType === 4) {\n        return elem.nodeValue;\n      }\n      return ret;\n    };\n    Expr = Sizzle.selectors = {\n      cacheLength: 50,\n      createPseudo: markFunction,\n      match: matchExpr,\n      attrHandle: {},\n      find: {},\n      relative: {\n        '>': {\n          dir: 'parentNode',\n          first: true\n        },\n        ' ': { dir: 'parentNode' },\n        '+': {\n          dir: 'previousSibling',\n          first: true\n        },\n        '~': { dir: 'previousSibling' }\n      },\n      preFilter: {\n        ATTR: function (match) {\n          match[1] = match[1].replace(runescape, funescape);\n          match[3] = (match[3] || match[4] || match[5] || '').replace(runescape, funescape);\n          if (match[2] === '~=') {\n            match[3] = ' ' + match[3] + ' ';\n          }\n          return match.slice(0, 4);\n        },\n        CHILD: function (match) {\n          match[1] = match[1].toLowerCase();\n          if (match[1].slice(0, 3) === 'nth') {\n            if (!match[3]) {\n              Sizzle.error(match[0]);\n            }\n            match[4] = +(match[4] ? match[5] + (match[6] || 1) : 2 * (match[3] === 'even' || match[3] === 'odd'));\n            match[5] = +(match[7] + match[8] || match[3] === 'odd');\n          } else if (match[3]) {\n            Sizzle.error(match[0]);\n          }\n          return match;\n        },\n        PSEUDO: function (match) {\n          var excess, unquoted = !match[6] && match[2];\n          if (matchExpr.CHILD.test(match[0])) {\n            return null;\n          }\n          if (match[3]) {\n            match[2] = match[4] || match[5] || '';\n          } else if (unquoted && rpseudo.test(unquoted) && (excess = tokenize(unquoted, true)) && (excess = unquoted.indexOf(')', unquoted.length - excess) - unquoted.length)) {\n            match[0] = match[0].slice(0, excess);\n            match[2] = unquoted.slice(0, excess);\n          }\n          return match.slice(0, 3);\n        }\n      },\n      filter: {\n        TAG: function (nodeNameSelector) {\n          var nodeName = nodeNameSelector.replace(runescape, funescape).toLowerCase();\n          return nodeNameSelector === '*' ? function () {\n            return true;\n          } : function (elem) {\n            return elem.nodeName && elem.nodeName.toLowerCase() === nodeName;\n          };\n        },\n        CLASS: function (className) {\n          var pattern = classCache[className + ' '];\n          return pattern || (pattern = new RegExp('(^|' + whitespace + ')' + className + '(' + whitespace + '|$)')) && classCache(className, function (elem) {\n            return pattern.test(typeof elem.className === 'string' && elem.className || typeof elem.getAttribute !== strundefined && elem.getAttribute('class') || '');\n          });\n        },\n        ATTR: function (name, operator, check) {\n          return function (elem) {\n            var result = Sizzle.attr(elem, name);\n            if (result == null) {\n              return operator === '!=';\n            }\n            if (!operator) {\n              return true;\n            }\n            result += '';\n            return operator === '=' ? result === check : operator === '!=' ? result !== check : operator === '^=' ? check && result.indexOf(check) === 0 : operator === '*=' ? check && result.indexOf(check) > -1 : operator === '$=' ? check && result.slice(-check.length) === check : operator === '~=' ? (' ' + result + ' ').indexOf(check) > -1 : operator === '|=' ? result === check || result.slice(0, check.length + 1) === check + '-' : false;\n          };\n        },\n        CHILD: function (type, what, argument, first, last) {\n          var simple = type.slice(0, 3) !== 'nth', forward = type.slice(-4) !== 'last', ofType = what === 'of-type';\n          return first === 1 && last === 0 ? function (elem) {\n            return !!elem.parentNode;\n          } : function (elem, context, xml) {\n            var cache, outerCache, node, diff, nodeIndex, start, dir = simple !== forward ? 'nextSibling' : 'previousSibling', parent = elem.parentNode, name = ofType && elem.nodeName.toLowerCase(), useCache = !xml && !ofType;\n            if (parent) {\n              if (simple) {\n                while (dir) {\n                  node = elem;\n                  while (node = node[dir]) {\n                    if (ofType ? node.nodeName.toLowerCase() === name : node.nodeType === 1) {\n                      return false;\n                    }\n                  }\n                  start = dir = type === 'only' && !start && 'nextSibling';\n                }\n                return true;\n              }\n              start = [forward ? parent.firstChild : parent.lastChild];\n              if (forward && useCache) {\n                outerCache = parent[expando] || (parent[expando] = {});\n                cache = outerCache[type] || [];\n                nodeIndex = cache[0] === dirruns && cache[1];\n                diff = cache[0] === dirruns && cache[2];\n                node = nodeIndex && parent.childNodes[nodeIndex];\n                while (node = ++nodeIndex && node && node[dir] || (diff = nodeIndex = 0) || start.pop()) {\n                  if (node.nodeType === 1 && ++diff && node === elem) {\n                    outerCache[type] = [\n                      dirruns,\n                      nodeIndex,\n                      diff\n                    ];\n                    break;\n                  }\n                }\n              } else if (useCache && (cache = (elem[expando] || (elem[expando] = {}))[type]) && cache[0] === dirruns) {\n                diff = cache[1];\n              } else {\n                while (node = ++nodeIndex && node && node[dir] || (diff = nodeIndex = 0) || start.pop()) {\n                  if ((ofType ? node.nodeName.toLowerCase() === name : node.nodeType === 1) && ++diff) {\n                    if (useCache) {\n                      (node[expando] || (node[expando] = {}))[type] = [\n                        dirruns,\n                        diff\n                      ];\n                    }\n                    if (node === elem) {\n                      break;\n                    }\n                  }\n                }\n              }\n              diff -= last;\n              return diff === first || diff % first === 0 && diff / first >= 0;\n            }\n          };\n        },\n        PSEUDO: function (pseudo, argument) {\n          var args, fn = Expr.pseudos[pseudo] || Expr.setFilters[pseudo.toLowerCase()] || Sizzle.error('unsupported pseudo: ' + pseudo);\n          if (fn[expando]) {\n            return fn(argument);\n          }\n          if (fn.length > 1) {\n            args = [\n              pseudo,\n              pseudo,\n              '',\n              argument\n            ];\n            return Expr.setFilters.hasOwnProperty(pseudo.toLowerCase()) ? markFunction(function (seed, matches) {\n              var idx, matched = fn(seed, argument), i = matched.length;\n              while (i--) {\n                idx = indexOf$1.call(seed, matched[i]);\n                seed[idx] = !(matches[idx] = matched[i]);\n              }\n            }) : function (elem) {\n              return fn(elem, 0, args);\n            };\n          }\n          return fn;\n        }\n      },\n      pseudos: {\n        not: markFunction(function (selector) {\n          var input = [], results = [], matcher = compile(selector.replace(rtrim, '$1'));\n          return matcher[expando] ? markFunction(function (seed, matches, context, xml) {\n            var elem, unmatched = matcher(seed, null, xml, []), i = seed.length;\n            while (i--) {\n              if (elem = unmatched[i]) {\n                seed[i] = !(matches[i] = elem);\n              }\n            }\n          }) : function (elem, context, xml) {\n            input[0] = elem;\n            matcher(input, null, xml, results);\n            return !results.pop();\n          };\n        }),\n        has: markFunction(function (selector) {\n          return function (elem) {\n            return Sizzle(selector, elem).length > 0;\n          };\n        }),\n        contains: markFunction(function (text) {\n          text = text.replace(runescape, funescape);\n          return function (elem) {\n            return (elem.textContent || elem.innerText || getText(elem)).indexOf(text) > -1;\n          };\n        }),\n        lang: markFunction(function (lang) {\n          if (!ridentifier.test(lang || '')) {\n            Sizzle.error('unsupported lang: ' + lang);\n          }\n          lang = lang.replace(runescape, funescape).toLowerCase();\n          return function (elem) {\n            var elemLang;\n            do {\n              if (elemLang = documentIsHTML ? elem.lang : elem.getAttribute('xml:lang') || elem.getAttribute('lang')) {\n                elemLang = elemLang.toLowerCase();\n                return elemLang === lang || elemLang.indexOf(lang + '-') === 0;\n              }\n            } while ((elem = elem.parentNode) && elem.nodeType === 1);\n            return false;\n          };\n        }),\n        target: function (elem) {\n          var hash = domGlobals.window.location && domGlobals.window.location.hash;\n          return hash && hash.slice(1) === elem.id;\n        },\n        root: function (elem) {\n          return elem === docElem;\n        },\n        focus: function (elem) {\n          return elem === document.activeElement && (!document.hasFocus || document.hasFocus()) && !!(elem.type || elem.href || ~elem.tabIndex);\n        },\n        enabled: function (elem) {\n          return elem.disabled === false;\n        },\n        disabled: function (elem) {\n          return elem.disabled === true;\n        },\n        checked: function (elem) {\n          var nodeName = elem.nodeName.toLowerCase();\n          return nodeName === 'input' && !!elem.checked || nodeName === 'option' && !!elem.selected;\n        },\n        selected: function (elem) {\n          if (elem.parentNode) {\n            elem.parentNode.selectedIndex;\n          }\n          return elem.selected === true;\n        },\n        empty: function (elem) {\n          for (elem = elem.firstChild; elem; elem = elem.nextSibling) {\n            if (elem.nodeType < 6) {\n              return false;\n            }\n          }\n          return true;\n        },\n        parent: function (elem) {\n          return !Expr.pseudos.empty(elem);\n        },\n        header: function (elem) {\n          return rheader.test(elem.nodeName);\n        },\n        input: function (elem) {\n          return rinputs.test(elem.nodeName);\n        },\n        button: function (elem) {\n          var name = elem.nodeName.toLowerCase();\n          return name === 'input' && elem.type === 'button' || name === 'button';\n        },\n        text: function (elem) {\n          var attr;\n          return elem.nodeName.toLowerCase() === 'input' && elem.type === 'text' && ((attr = elem.getAttribute('type')) == null || attr.toLowerCase() === 'text');\n        },\n        first: createPositionalPseudo(function () {\n          return [0];\n        }),\n        last: createPositionalPseudo(function (matchIndexes, length) {\n          return [length - 1];\n        }),\n        eq: createPositionalPseudo(function (matchIndexes, length, argument) {\n          return [argument < 0 ? argument + length : argument];\n        }),\n        even: createPositionalPseudo(function (matchIndexes, length) {\n          var i = 0;\n          for (; i < length; i += 2) {\n            matchIndexes.push(i);\n          }\n          return matchIndexes;\n        }),\n        odd: createPositionalPseudo(function (matchIndexes, length) {\n          var i = 1;\n          for (; i < length; i += 2) {\n            matchIndexes.push(i);\n          }\n          return matchIndexes;\n        }),\n        lt: createPositionalPseudo(function (matchIndexes, length, argument) {\n          var i = argument < 0 ? argument + length : argument;\n          for (; --i >= 0;) {\n            matchIndexes.push(i);\n          }\n          return matchIndexes;\n        }),\n        gt: createPositionalPseudo(function (matchIndexes, length, argument) {\n          var i = argument < 0 ? argument + length : argument;\n          for (; ++i < length;) {\n            matchIndexes.push(i);\n          }\n          return matchIndexes;\n        })\n      }\n    };\n    Expr.pseudos.nth = Expr.pseudos.eq;\n    for (i in {\n        radio: true,\n        checkbox: true,\n        file: true,\n        password: true,\n        image: true\n      }) {\n      Expr.pseudos[i] = createInputPseudo(i);\n    }\n    for (i in {\n        submit: true,\n        reset: true\n      }) {\n      Expr.pseudos[i] = createButtonPseudo(i);\n    }\n    function setFilters() {\n    }\n    setFilters.prototype = Expr.filters = Expr.pseudos;\n    Expr.setFilters = new setFilters();\n    tokenize = Sizzle.tokenize = function (selector, parseOnly) {\n      var matched, match, tokens, type, soFar, groups, preFilters, cached = tokenCache[selector + ' '];\n      if (cached) {\n        return parseOnly ? 0 : cached.slice(0);\n      }\n      soFar = selector;\n      groups = [];\n      preFilters = Expr.preFilter;\n      while (soFar) {\n        if (!matched || (match = rcomma.exec(soFar))) {\n          if (match) {\n            soFar = soFar.slice(match[0].length) || soFar;\n          }\n          groups.push(tokens = []);\n        }\n        matched = false;\n        if (match = rcombinators.exec(soFar)) {\n          matched = match.shift();\n          tokens.push({\n            value: matched,\n            type: match[0].replace(rtrim, ' ')\n          });\n          soFar = soFar.slice(matched.length);\n        }\n        for (type in Expr.filter) {\n          if ((match = matchExpr[type].exec(soFar)) && (!preFilters[type] || (match = preFilters[type](match)))) {\n            matched = match.shift();\n            tokens.push({\n              value: matched,\n              type: type,\n              matches: match\n            });\n            soFar = soFar.slice(matched.length);\n          }\n        }\n        if (!matched) {\n          break;\n        }\n      }\n      return parseOnly ? soFar.length : soFar ? Sizzle.error(selector) : tokenCache(selector, groups).slice(0);\n    };\n    function toSelector(tokens) {\n      var i = 0, len = tokens.length, selector = '';\n      for (; i < len; i++) {\n        selector += tokens[i].value;\n      }\n      return selector;\n    }\n    function addCombinator(matcher, combinator, base) {\n      var dir = combinator.dir, checkNonElements = base && dir === 'parentNode', doneName = done++;\n      return combinator.first ? function (elem, context, xml) {\n        while (elem = elem[dir]) {\n          if (elem.nodeType === 1 || checkNonElements) {\n            return matcher(elem, context, xml);\n          }\n        }\n      } : function (elem, context, xml) {\n        var oldCache, outerCache, newCache = [\n            dirruns,\n            doneName\n          ];\n        if (xml) {\n          while (elem = elem[dir]) {\n            if (elem.nodeType === 1 || checkNonElements) {\n              if (matcher(elem, context, xml)) {\n                return true;\n              }\n            }\n          }\n        } else {\n          while (elem = elem[dir]) {\n            if (elem.nodeType === 1 || checkNonElements) {\n              outerCache = elem[expando] || (elem[expando] = {});\n              if ((oldCache = outerCache[dir]) && oldCache[0] === dirruns && oldCache[1] === doneName) {\n                return newCache[2] = oldCache[2];\n              } else {\n                outerCache[dir] = newCache;\n                if (newCache[2] = matcher(elem, context, xml)) {\n                  return true;\n                }\n              }\n            }\n          }\n        }\n      };\n    }\n    function elementMatcher(matchers) {\n      return matchers.length > 1 ? function (elem, context, xml) {\n        var i = matchers.length;\n        while (i--) {\n          if (!matchers[i](elem, context, xml)) {\n            return false;\n          }\n        }\n        return true;\n      } : matchers[0];\n    }\n    function multipleContexts(selector, contexts, results) {\n      var i = 0, len = contexts.length;\n      for (; i < len; i++) {\n        Sizzle(selector, contexts[i], results);\n      }\n      return results;\n    }\n    function condense(unmatched, map, filter, context, xml) {\n      var elem, newUnmatched = [], i = 0, len = unmatched.length, mapped = map != null;\n      for (; i < len; i++) {\n        if (elem = unmatched[i]) {\n          if (!filter || filter(elem, context, xml)) {\n            newUnmatched.push(elem);\n            if (mapped) {\n              map.push(i);\n            }\n          }\n        }\n      }\n      return newUnmatched;\n    }\n    function setMatcher(preFilter, selector, matcher, postFilter, postFinder, postSelector) {\n      if (postFilter && !postFilter[expando]) {\n        postFilter = setMatcher(postFilter);\n      }\n      if (postFinder && !postFinder[expando]) {\n        postFinder = setMatcher(postFinder, postSelector);\n      }\n      return markFunction(function (seed, results, context, xml) {\n        var temp, i, elem, preMap = [], postMap = [], preexisting = results.length, elems = seed || multipleContexts(selector || '*', context.nodeType ? [context] : context, []), matcherIn = preFilter && (seed || !selector) ? condense(elems, preMap, preFilter, context, xml) : elems, matcherOut = matcher ? postFinder || (seed ? preFilter : preexisting || postFilter) ? [] : results : matcherIn;\n        if (matcher) {\n          matcher(matcherIn, matcherOut, context, xml);\n        }\n        if (postFilter) {\n          temp = condense(matcherOut, postMap);\n          postFilter(temp, [], context, xml);\n          i = temp.length;\n          while (i--) {\n            if (elem = temp[i]) {\n              matcherOut[postMap[i]] = !(matcherIn[postMap[i]] = elem);\n            }\n          }\n        }\n        if (seed) {\n          if (postFinder || preFilter) {\n            if (postFinder) {\n              temp = [];\n              i = matcherOut.length;\n              while (i--) {\n                if (elem = matcherOut[i]) {\n                  temp.push(matcherIn[i] = elem);\n                }\n              }\n              postFinder(null, matcherOut = [], temp, xml);\n            }\n            i = matcherOut.length;\n            while (i--) {\n              if ((elem = matcherOut[i]) && (temp = postFinder ? indexOf$1.call(seed, elem) : preMap[i]) > -1) {\n                seed[temp] = !(results[temp] = elem);\n              }\n            }\n          }\n        } else {\n          matcherOut = condense(matcherOut === results ? matcherOut.splice(preexisting, matcherOut.length) : matcherOut);\n          if (postFinder) {\n            postFinder(null, results, matcherOut, xml);\n          } else {\n            push.apply(results, matcherOut);\n          }\n        }\n      });\n    }\n    function matcherFromTokens(tokens) {\n      var checkContext, matcher, j, len = tokens.length, leadingRelative = Expr.relative[tokens[0].type], implicitRelative = leadingRelative || Expr.relative[' '], i = leadingRelative ? 1 : 0, matchContext = addCombinator(function (elem) {\n          return elem === checkContext;\n        }, implicitRelative, true), matchAnyContext = addCombinator(function (elem) {\n          return indexOf$1.call(checkContext, elem) > -1;\n        }, implicitRelative, true), matchers = [function (elem, context, xml) {\n            return !leadingRelative && (xml || context !== outermostContext) || ((checkContext = context).nodeType ? matchContext(elem, context, xml) : matchAnyContext(elem, context, xml));\n          }];\n      for (; i < len; i++) {\n        if (matcher = Expr.relative[tokens[i].type]) {\n          matchers = [addCombinator(elementMatcher(matchers), matcher)];\n        } else {\n          matcher = Expr.filter[tokens[i].type].apply(null, tokens[i].matches);\n          if (matcher[expando]) {\n            j = ++i;\n            for (; j < len; j++) {\n              if (Expr.relative[tokens[j].type]) {\n                break;\n              }\n            }\n            return setMatcher(i > 1 && elementMatcher(matchers), i > 1 && toSelector(tokens.slice(0, i - 1).concat({ value: tokens[i - 2].type === ' ' ? '*' : '' })).replace(rtrim, '$1'), matcher, i < j && matcherFromTokens(tokens.slice(i, j)), j < len && matcherFromTokens(tokens = tokens.slice(j)), j < len && toSelector(tokens));\n          }\n          matchers.push(matcher);\n        }\n      }\n      return elementMatcher(matchers);\n    }\n    function matcherFromGroupMatchers(elementMatchers, setMatchers) {\n      var bySet = setMatchers.length > 0, byElement = elementMatchers.length > 0, superMatcher = function (seed, context, xml, results, outermost) {\n          var elem, j, matcher, matchedCount = 0, i = '0', unmatched = seed && [], setMatched = [], contextBackup = outermostContext, elems = seed || byElement && Expr.find.TAG('*', outermost), dirrunsUnique = dirruns += contextBackup == null ? 1 : Math.random() || 0.1, len = elems.length;\n          if (outermost) {\n            outermostContext = context !== document && context;\n          }\n          for (; i !== len && (elem = elems[i]) != null; i++) {\n            if (byElement && elem) {\n              j = 0;\n              while (matcher = elementMatchers[j++]) {\n                if (matcher(elem, context, xml)) {\n                  results.push(elem);\n                  break;\n                }\n              }\n              if (outermost) {\n                dirruns = dirrunsUnique;\n              }\n            }\n            if (bySet) {\n              if (elem = !matcher && elem) {\n                matchedCount--;\n              }\n              if (seed) {\n                unmatched.push(elem);\n              }\n            }\n          }\n          matchedCount += i;\n          if (bySet && i !== matchedCount) {\n            j = 0;\n            while (matcher = setMatchers[j++]) {\n              matcher(unmatched, setMatched, context, xml);\n            }\n            if (seed) {\n              if (matchedCount > 0) {\n                while (i--) {\n                  if (!(unmatched[i] || setMatched[i])) {\n                    setMatched[i] = pop.call(results);\n                  }\n                }\n              }\n              setMatched = condense(setMatched);\n            }\n            push.apply(results, setMatched);\n            if (outermost && !seed && setMatched.length > 0 && matchedCount + setMatchers.length > 1) {\n              Sizzle.uniqueSort(results);\n            }\n          }\n          if (outermost) {\n            dirruns = dirrunsUnique;\n            outermostContext = contextBackup;\n          }\n          return unmatched;\n        };\n      return bySet ? markFunction(superMatcher) : superMatcher;\n    }\n    compile = Sizzle.compile = function (selector, match) {\n      var i, setMatchers = [], elementMatchers = [], cached = compilerCache[selector + ' '];\n      if (!cached) {\n        if (!match) {\n          match = tokenize(selector);\n        }\n        i = match.length;\n        while (i--) {\n          cached = matcherFromTokens(match[i]);\n          if (cached[expando]) {\n            setMatchers.push(cached);\n          } else {\n            elementMatchers.push(cached);\n          }\n        }\n        cached = compilerCache(selector, matcherFromGroupMatchers(elementMatchers, setMatchers));\n        cached.selector = selector;\n      }\n      return cached;\n    };\n    select = Sizzle.select = function (selector, context, results, seed) {\n      var i, tokens, token, type, find, compiled = typeof selector === 'function' && selector, match = !seed && tokenize(selector = compiled.selector || selector);\n      results = results || [];\n      if (match.length === 1) {\n        tokens = match[0] = match[0].slice(0);\n        if (tokens.length > 2 && (token = tokens[0]).type === 'ID' && support.getById && context.nodeType === 9 && documentIsHTML && Expr.relative[tokens[1].type]) {\n          context = (Expr.find.ID(token.matches[0].replace(runescape, funescape), context) || [])[0];\n          if (!context) {\n            return results;\n          } else if (compiled) {\n            context = context.parentNode;\n          }\n          selector = selector.slice(tokens.shift().value.length);\n        }\n        i = matchExpr.needsContext.test(selector) ? 0 : tokens.length;\n        while (i--) {\n          token = tokens[i];\n          if (Expr.relative[type = token.type]) {\n            break;\n          }\n          if (find = Expr.find[type]) {\n            if (seed = find(token.matches[0].replace(runescape, funescape), rsibling.test(tokens[0].type) && testContext(context.parentNode) || context)) {\n              tokens.splice(i, 1);\n              selector = seed.length && toSelector(tokens);\n              if (!selector) {\n                push.apply(results, seed);\n                return results;\n              }\n              break;\n            }\n          }\n        }\n      }\n      (compiled || compile(selector, match))(seed, context, !documentIsHTML, results, rsibling.test(selector) && testContext(context.parentNode) || context);\n      return results;\n    };\n    support.sortStable = expando.split('').sort(sortOrder).join('') === expando;\n    support.detectDuplicates = !!hasDuplicate;\n    setDocument();\n    support.sortDetached = true;\n\n    var isArray$1 = Array.isArray;\n    var toArray = function (obj) {\n      var array = obj, i, l;\n      if (!isArray$1(obj)) {\n        array = [];\n        for (i = 0, l = obj.length; i < l; i++) {\n          array[i] = obj[i];\n        }\n      }\n      return array;\n    };\n    var each$1 = function (o, cb, s) {\n      var n, l;\n      if (!o) {\n        return 0;\n      }\n      s = s || o;\n      if (o.length !== undefined) {\n        for (n = 0, l = o.length; n < l; n++) {\n          if (cb.call(s, o[n], n, o) === false) {\n            return 0;\n          }\n        }\n      } else {\n        for (n in o) {\n          if (o.hasOwnProperty(n)) {\n            if (cb.call(s, o[n], n, o) === false) {\n              return 0;\n            }\n          }\n        }\n      }\n      return 1;\n    };\n    var map$1 = function (array, callback) {\n      var out = [];\n      each$1(array, function (item, index) {\n        out.push(callback(item, index, array));\n      });\n      return out;\n    };\n    var filter$1 = function (a, f) {\n      var o = [];\n      each$1(a, function (v, index) {\n        if (!f || f(v, index, a)) {\n          o.push(v);\n        }\n      });\n      return o;\n    };\n    var indexOf$2 = function (a, v) {\n      var i, l;\n      if (a) {\n        for (i = 0, l = a.length; i < l; i++) {\n          if (a[i] === v) {\n            return i;\n          }\n        }\n      }\n      return -1;\n    };\n    var reduce = function (collection, iteratee, accumulator, thisArg) {\n      var i = 0;\n      if (arguments.length < 3) {\n        accumulator = collection[0];\n      }\n      for (; i < collection.length; i++) {\n        accumulator = iteratee.call(thisArg, accumulator, collection[i], i);\n      }\n      return accumulator;\n    };\n    var findIndex$1 = function (array, predicate, thisArg) {\n      var i, l;\n      for (i = 0, l = array.length; i < l; i++) {\n        if (predicate.call(thisArg, array[i], i, array)) {\n          return i;\n        }\n      }\n      return -1;\n    };\n    var find$1 = function (array, predicate, thisArg) {\n      var idx = findIndex$1(array, predicate, thisArg);\n      if (idx !== -1) {\n        return array[idx];\n      }\n      return undefined;\n    };\n    var last$1 = function (collection) {\n      return collection[collection.length - 1];\n    };\n    var ArrUtils = {\n      isArray: isArray$1,\n      toArray: toArray,\n      each: each$1,\n      map: map$1,\n      filter: filter$1,\n      indexOf: indexOf$2,\n      reduce: reduce,\n      findIndex: findIndex$1,\n      find: find$1,\n      last: last$1\n    };\n\n    var whiteSpaceRegExp = /^\\s*|\\s*$/g;\n    var trim = function (str) {\n      return str === null || str === undefined ? '' : ('' + str).replace(whiteSpaceRegExp, '');\n    };\n    var is = function (obj, type) {\n      if (!type) {\n        return obj !== undefined;\n      }\n      if (type === 'array' && ArrUtils.isArray(obj)) {\n        return true;\n      }\n      return typeof obj === type;\n    };\n    var makeMap = function (items, delim, map) {\n      var i;\n      items = items || [];\n      delim = delim || ',';\n      if (typeof items === 'string') {\n        items = items.split(delim);\n      }\n      map = map || {};\n      i = items.length;\n      while (i--) {\n        map[items[i]] = {};\n      }\n      return map;\n    };\n    var hasOwnProperty = function (obj, prop) {\n      return Object.prototype.hasOwnProperty.call(obj, prop);\n    };\n    var create = function (s, p, root) {\n      var self = this;\n      var sp, ns, cn, scn, c, de = 0;\n      s = /^((static) )?([\\w.]+)(:([\\w.]+))?/.exec(s);\n      cn = s[3].match(/(^|\\.)(\\w+)$/i)[2];\n      ns = self.createNS(s[3].replace(/\\.\\w+$/, ''), root);\n      if (ns[cn]) {\n        return;\n      }\n      if (s[2] === 'static') {\n        ns[cn] = p;\n        if (this.onCreate) {\n          this.onCreate(s[2], s[3], ns[cn]);\n        }\n        return;\n      }\n      if (!p[cn]) {\n        p[cn] = function () {\n        };\n        de = 1;\n      }\n      ns[cn] = p[cn];\n      self.extend(ns[cn].prototype, p);\n      if (s[5]) {\n        sp = self.resolve(s[5]).prototype;\n        scn = s[5].match(/\\.(\\w+)$/i)[1];\n        c = ns[cn];\n        if (de) {\n          ns[cn] = function () {\n            return sp[scn].apply(this, arguments);\n          };\n        } else {\n          ns[cn] = function () {\n            this.parent = sp[scn];\n            return c.apply(this, arguments);\n          };\n        }\n        ns[cn].prototype[cn] = ns[cn];\n        self.each(sp, function (f, n) {\n          ns[cn].prototype[n] = sp[n];\n        });\n        self.each(p, function (f, n) {\n          if (sp[n]) {\n            ns[cn].prototype[n] = function () {\n              this.parent = sp[n];\n              return f.apply(this, arguments);\n            };\n          } else {\n            if (n !== cn) {\n              ns[cn].prototype[n] = f;\n            }\n          }\n        });\n      }\n      self.each(p.static, function (f, n) {\n        ns[cn][n] = f;\n      });\n    };\n    var extend = function (obj, ext) {\n      var x = [];\n      for (var _i = 2; _i < arguments.length; _i++) {\n        x[_i - 2] = arguments[_i];\n      }\n      var i, l, name;\n      var args = arguments;\n      var value;\n      for (i = 1, l = args.length; i < l; i++) {\n        ext = args[i];\n        for (name in ext) {\n          if (ext.hasOwnProperty(name)) {\n            value = ext[name];\n            if (value !== undefined) {\n              obj[name] = value;\n            }\n          }\n        }\n      }\n      return obj;\n    };\n    var walk = function (o, f, n, s) {\n      s = s || this;\n      if (o) {\n        if (n) {\n          o = o[n];\n        }\n        ArrUtils.each(o, function (o, i) {\n          if (f.call(s, o, i, n) === false) {\n            return false;\n          }\n          walk(o, f, n, s);\n        });\n      }\n    };\n    var createNS = function (n, o) {\n      var i, v;\n      o = o || domGlobals.window;\n      n = n.split('.');\n      for (i = 0; i < n.length; i++) {\n        v = n[i];\n        if (!o[v]) {\n          o[v] = {};\n        }\n        o = o[v];\n      }\n      return o;\n    };\n    var resolve$1 = function (n, o) {\n      var i, l;\n      o = o || domGlobals.window;\n      n = n.split('.');\n      for (i = 0, l = n.length; i < l; i++) {\n        o = o[n[i]];\n        if (!o) {\n          break;\n        }\n      }\n      return o;\n    };\n    var explode = function (s, d) {\n      if (!s || is(s, 'array')) {\n        return s;\n      }\n      return ArrUtils.map(s.split(d || ','), trim);\n    };\n    var _addCacheSuffix = function (url) {\n      var cacheSuffix = Env.cacheSuffix;\n      if (cacheSuffix) {\n        url += (url.indexOf('?') === -1 ? '?' : '&') + cacheSuffix;\n      }\n      return url;\n    };\n    var Tools = {\n      trim: trim,\n      isArray: ArrUtils.isArray,\n      is: is,\n      toArray: ArrUtils.toArray,\n      makeMap: makeMap,\n      each: ArrUtils.each,\n      map: ArrUtils.map,\n      grep: ArrUtils.filter,\n      inArray: ArrUtils.indexOf,\n      hasOwn: hasOwnProperty,\n      extend: extend,\n      create: create,\n      walk: walk,\n      createNS: createNS,\n      resolve: resolve$1,\n      explode: explode,\n      _addCacheSuffix: _addCacheSuffix\n    };\n\n    var doc = domGlobals.document, push$1 = Array.prototype.push, slice$1 = Array.prototype.slice;\n    var rquickExpr$1 = /^(?:[^#<]*(<[\\w\\W]+>)[^>]*$|#([\\w\\-]*)$)/;\n    var Event = EventUtils.Event;\n    var skipUniques = Tools.makeMap('children,contents,next,prev');\n    var isDefined = function (obj) {\n      return typeof obj !== 'undefined';\n    };\n    var isString$1 = function (obj) {\n      return typeof obj === 'string';\n    };\n    var isWindow = function (obj) {\n      return obj && obj === obj.window;\n    };\n    var createFragment = function (html, fragDoc) {\n      var frag, node, container;\n      fragDoc = fragDoc || doc;\n      container = fragDoc.createElement('div');\n      frag = fragDoc.createDocumentFragment();\n      container.innerHTML = html;\n      while (node = container.firstChild) {\n        frag.appendChild(node);\n      }\n      return frag;\n    };\n    var domManipulate = function (targetNodes, sourceItem, callback, reverse) {\n      var i;\n      if (isString$1(sourceItem)) {\n        sourceItem = createFragment(sourceItem, getElementDocument(targetNodes[0]));\n      } else if (sourceItem.length && !sourceItem.nodeType) {\n        sourceItem = DomQuery.makeArray(sourceItem);\n        if (reverse) {\n          for (i = sourceItem.length - 1; i >= 0; i--) {\n            domManipulate(targetNodes, sourceItem[i], callback, reverse);\n          }\n        } else {\n          for (i = 0; i < sourceItem.length; i++) {\n            domManipulate(targetNodes, sourceItem[i], callback, reverse);\n          }\n        }\n        return targetNodes;\n      }\n      if (sourceItem.nodeType) {\n        i = targetNodes.length;\n        while (i--) {\n          callback.call(targetNodes[i], sourceItem);\n        }\n      }\n      return targetNodes;\n    };\n    var hasClass = function (node, className) {\n      return node && className && (' ' + node.className + ' ').indexOf(' ' + className + ' ') !== -1;\n    };\n    var wrap = function (elements, wrapper, all) {\n      var lastParent, newWrapper;\n      wrapper = DomQuery(wrapper)[0];\n      elements.each(function () {\n        var self = this;\n        if (!all || lastParent !== self.parentNode) {\n          lastParent = self.parentNode;\n          newWrapper = wrapper.cloneNode(false);\n          self.parentNode.insertBefore(newWrapper, self);\n          newWrapper.appendChild(self);\n        } else {\n          newWrapper.appendChild(self);\n        }\n      });\n      return elements;\n    };\n    var numericCssMap = Tools.makeMap('fillOpacity fontWeight lineHeight opacity orphans widows zIndex zoom', ' ');\n    var booleanMap = Tools.makeMap('checked compact declare defer disabled ismap multiple nohref noshade nowrap readonly selected', ' ');\n    var propFix = {\n      for: 'htmlFor',\n      class: 'className',\n      readonly: 'readOnly'\n    };\n    var cssFix = { float: 'cssFloat' };\n    var attrHooks = {}, cssHooks = {};\n    var DomQuery = function (selector, context) {\n      return new DomQuery.fn.init(selector, context);\n    };\n    var inArray = function (item, array) {\n      var i;\n      if (array.indexOf) {\n        return array.indexOf(item);\n      }\n      i = array.length;\n      while (i--) {\n        if (array[i] === item) {\n          return i;\n        }\n      }\n      return -1;\n    };\n    var whiteSpaceRegExp$1 = /^\\s*|\\s*$/g;\n    var trim$1 = function (str) {\n      return str === null || str === undefined ? '' : ('' + str).replace(whiteSpaceRegExp$1, '');\n    };\n    var each$2 = function (obj, callback) {\n      var length, key, i, value;\n      if (obj) {\n        length = obj.length;\n        if (length === undefined) {\n          for (key in obj) {\n            if (obj.hasOwnProperty(key)) {\n              value = obj[key];\n              if (callback.call(value, key, value) === false) {\n                break;\n              }\n            }\n          }\n        } else {\n          for (i = 0; i < length; i++) {\n            value = obj[i];\n            if (callback.call(value, i, value) === false) {\n              break;\n            }\n          }\n        }\n      }\n      return obj;\n    };\n    var grep = function (array, callback) {\n      var out = [];\n      each$2(array, function (i, item) {\n        if (callback(item, i)) {\n          out.push(item);\n        }\n      });\n      return out;\n    };\n    var getElementDocument = function (element) {\n      if (!element) {\n        return doc;\n      }\n      if (element.nodeType === 9) {\n        return element;\n      }\n      return element.ownerDocument;\n    };\n    DomQuery.fn = DomQuery.prototype = {\n      constructor: DomQuery,\n      selector: '',\n      context: null,\n      length: 0,\n      init: function (selector, context) {\n        var self = this;\n        var match, node;\n        if (!selector) {\n          return self;\n        }\n        if (selector.nodeType) {\n          self.context = self[0] = selector;\n          self.length = 1;\n          return self;\n        }\n        if (context && context.nodeType) {\n          self.context = context;\n        } else {\n          if (context) {\n            return DomQuery(selector).attr(context);\n          }\n          self.context = context = domGlobals.document;\n        }\n        if (isString$1(selector)) {\n          self.selector = selector;\n          if (selector.charAt(0) === '<' && selector.charAt(selector.length - 1) === '>' && selector.length >= 3) {\n            match = [\n              null,\n              selector,\n              null\n            ];\n          } else {\n            match = rquickExpr$1.exec(selector);\n          }\n          if (match) {\n            if (match[1]) {\n              node = createFragment(selector, getElementDocument(context)).firstChild;\n              while (node) {\n                push$1.call(self, node);\n                node = node.nextSibling;\n              }\n            } else {\n              node = getElementDocument(context).getElementById(match[2]);\n              if (!node) {\n                return self;\n              }\n              if (node.id !== match[2]) {\n                return self.find(selector);\n              }\n              self.length = 1;\n              self[0] = node;\n            }\n          } else {\n            return DomQuery(context).find(selector);\n          }\n        } else {\n          this.add(selector, false);\n        }\n        return self;\n      },\n      toArray: function () {\n        return Tools.toArray(this);\n      },\n      add: function (items, sort) {\n        var self = this;\n        var nodes, i;\n        if (isString$1(items)) {\n          return self.add(DomQuery(items));\n        }\n        if (sort !== false) {\n          nodes = DomQuery.unique(self.toArray().concat(DomQuery.makeArray(items)));\n          self.length = nodes.length;\n          for (i = 0; i < nodes.length; i++) {\n            self[i] = nodes[i];\n          }\n        } else {\n          push$1.apply(self, DomQuery.makeArray(items));\n        }\n        return self;\n      },\n      attr: function (name, value) {\n        var self = this;\n        var hook;\n        if (typeof name === 'object') {\n          each$2(name, function (name, value) {\n            self.attr(name, value);\n          });\n        } else if (isDefined(value)) {\n          this.each(function () {\n            var hook;\n            if (this.nodeType === 1) {\n              hook = attrHooks[name];\n              if (hook && hook.set) {\n                hook.set(this, value);\n                return;\n              }\n              if (value === null) {\n                this.removeAttribute(name, 2);\n              } else {\n                this.setAttribute(name, value, 2);\n              }\n            }\n          });\n        } else {\n          if (self[0] && self[0].nodeType === 1) {\n            hook = attrHooks[name];\n            if (hook && hook.get) {\n              return hook.get(self[0], name);\n            }\n            if (booleanMap[name]) {\n              return self.prop(name) ? name : undefined;\n            }\n            value = self[0].getAttribute(name, 2);\n            if (value === null) {\n              value = undefined;\n            }\n          }\n          return value;\n        }\n        return self;\n      },\n      removeAttr: function (name) {\n        return this.attr(name, null);\n      },\n      prop: function (name, value) {\n        var self = this;\n        name = propFix[name] || name;\n        if (typeof name === 'object') {\n          each$2(name, function (name, value) {\n            self.prop(name, value);\n          });\n        } else if (isDefined(value)) {\n          this.each(function () {\n            if (this.nodeType === 1) {\n              this[name] = value;\n            }\n          });\n        } else {\n          if (self[0] && self[0].nodeType && name in self[0]) {\n            return self[0][name];\n          }\n          return value;\n        }\n        return self;\n      },\n      css: function (name, value) {\n        var self = this;\n        var elm, hook;\n        var camel = function (name) {\n          return name.replace(/-(\\D)/g, function (a, b) {\n            return b.toUpperCase();\n          });\n        };\n        var dashed = function (name) {\n          return name.replace(/[A-Z]/g, function (a) {\n            return '-' + a;\n          });\n        };\n        if (typeof name === 'object') {\n          each$2(name, function (name, value) {\n            self.css(name, value);\n          });\n        } else {\n          if (isDefined(value)) {\n            name = camel(name);\n            if (typeof value === 'number' && !numericCssMap[name]) {\n              value = value.toString() + 'px';\n            }\n            self.each(function () {\n              var style = this.style;\n              hook = cssHooks[name];\n              if (hook && hook.set) {\n                hook.set(this, value);\n                return;\n              }\n              try {\n                this.style[cssFix[name] || name] = value;\n              } catch (ex) {\n              }\n              if (value === null || value === '') {\n                if (style.removeProperty) {\n                  style.removeProperty(dashed(name));\n                } else {\n                  style.removeAttribute(name);\n                }\n              }\n            });\n          } else {\n            elm = self[0];\n            hook = cssHooks[name];\n            if (hook && hook.get) {\n              return hook.get(elm);\n            }\n            if (elm.ownerDocument.defaultView) {\n              try {\n                return elm.ownerDocument.defaultView.getComputedStyle(elm, null).getPropertyValue(dashed(name));\n              } catch (ex) {\n                return undefined;\n              }\n            } else if (elm.currentStyle) {\n              return elm.currentStyle[camel(name)];\n            } else {\n              return '';\n            }\n          }\n        }\n        return self;\n      },\n      remove: function () {\n        var self = this;\n        var node, i = this.length;\n        while (i--) {\n          node = self[i];\n          Event.clean(node);\n          if (node.parentNode) {\n            node.parentNode.removeChild(node);\n          }\n        }\n        return this;\n      },\n      empty: function () {\n        var self = this;\n        var node, i = this.length;\n        while (i--) {\n          node = self[i];\n          while (node.firstChild) {\n            node.removeChild(node.firstChild);\n          }\n        }\n        return this;\n      },\n      html: function (value) {\n        var self = this;\n        var i;\n        if (isDefined(value)) {\n          i = self.length;\n          try {\n            while (i--) {\n              self[i].innerHTML = value;\n            }\n          } catch (ex) {\n            DomQuery(self[i]).empty().append(value);\n          }\n          return self;\n        }\n        return self[0] ? self[0].innerHTML : '';\n      },\n      text: function (value) {\n        var self = this;\n        var i;\n        if (isDefined(value)) {\n          i = self.length;\n          while (i--) {\n            if ('innerText' in self[i]) {\n              self[i].innerText = value;\n            } else {\n              self[0].textContent = value;\n            }\n          }\n          return self;\n        }\n        return self[0] ? self[0].innerText || self[0].textContent : '';\n      },\n      append: function () {\n        return domManipulate(this, arguments, function (node) {\n          if (this.nodeType === 1 || this.host && this.host.nodeType === 1) {\n            this.appendChild(node);\n          }\n        });\n      },\n      prepend: function () {\n        return domManipulate(this, arguments, function (node) {\n          if (this.nodeType === 1 || this.host && this.host.nodeType === 1) {\n            this.insertBefore(node, this.firstChild);\n          }\n        }, true);\n      },\n      before: function () {\n        var self = this;\n        if (self[0] && self[0].parentNode) {\n          return domManipulate(self, arguments, function (node) {\n            this.parentNode.insertBefore(node, this);\n          });\n        }\n        return self;\n      },\n      after: function () {\n        var self = this;\n        if (self[0] && self[0].parentNode) {\n          return domManipulate(self, arguments, function (node) {\n            this.parentNode.insertBefore(node, this.nextSibling);\n          }, true);\n        }\n        return self;\n      },\n      appendTo: function (val) {\n        DomQuery(val).append(this);\n        return this;\n      },\n      prependTo: function (val) {\n        DomQuery(val).prepend(this);\n        return this;\n      },\n      replaceWith: function (content) {\n        return this.before(content).remove();\n      },\n      wrap: function (content) {\n        return wrap(this, content);\n      },\n      wrapAll: function (content) {\n        return wrap(this, content, true);\n      },\n      wrapInner: function (content) {\n        this.each(function () {\n          DomQuery(this).contents().wrapAll(content);\n        });\n        return this;\n      },\n      unwrap: function () {\n        return this.parent().each(function () {\n          DomQuery(this).replaceWith(this.childNodes);\n        });\n      },\n      clone: function () {\n        var result = [];\n        this.each(function () {\n          result.push(this.cloneNode(true));\n        });\n        return DomQuery(result);\n      },\n      addClass: function (className) {\n        return this.toggleClass(className, true);\n      },\n      removeClass: function (className) {\n        return this.toggleClass(className, false);\n      },\n      toggleClass: function (className, state) {\n        var self = this;\n        if (typeof className !== 'string') {\n          return self;\n        }\n        if (className.indexOf(' ') !== -1) {\n          each$2(className.split(' '), function () {\n            self.toggleClass(this, state);\n          });\n        } else {\n          self.each(function (index, node) {\n            var existingClassName, classState;\n            classState = hasClass(node, className);\n            if (classState !== state) {\n              existingClassName = node.className;\n              if (classState) {\n                node.className = trim$1((' ' + existingClassName + ' ').replace(' ' + className + ' ', ' '));\n              } else {\n                node.className += existingClassName ? ' ' + className : className;\n              }\n            }\n          });\n        }\n        return self;\n      },\n      hasClass: function (className) {\n        return hasClass(this[0], className);\n      },\n      each: function (callback) {\n        return each$2(this, callback);\n      },\n      on: function (name, callback) {\n        return this.each(function () {\n          Event.bind(this, name, callback);\n        });\n      },\n      off: function (name, callback) {\n        return this.each(function () {\n          Event.unbind(this, name, callback);\n        });\n      },\n      trigger: function (name) {\n        return this.each(function () {\n          if (typeof name === 'object') {\n            Event.fire(this, name.type, name);\n          } else {\n            Event.fire(this, name);\n          }\n        });\n      },\n      show: function () {\n        return this.css('display', '');\n      },\n      hide: function () {\n        return this.css('display', 'none');\n      },\n      slice: function () {\n        return new DomQuery(slice$1.apply(this, arguments));\n      },\n      eq: function (index) {\n        return index === -1 ? this.slice(index) : this.slice(index, +index + 1);\n      },\n      first: function () {\n        return this.eq(0);\n      },\n      last: function () {\n        return this.eq(-1);\n      },\n      find: function (selector) {\n        var i, l;\n        var ret = [];\n        for (i = 0, l = this.length; i < l; i++) {\n          DomQuery.find(selector, this[i], ret);\n        }\n        return DomQuery(ret);\n      },\n      filter: function (selector) {\n        if (typeof selector === 'function') {\n          return DomQuery(grep(this.toArray(), function (item, i) {\n            return selector(i, item);\n          }));\n        }\n        return DomQuery(DomQuery.filter(selector, this.toArray()));\n      },\n      closest: function (selector) {\n        var result = [];\n        if (selector instanceof DomQuery) {\n          selector = selector[0];\n        }\n        this.each(function (i, node) {\n          while (node) {\n            if (typeof selector === 'string' && DomQuery(node).is(selector)) {\n              result.push(node);\n              break;\n            } else if (node === selector) {\n              result.push(node);\n              break;\n            }\n            node = node.parentNode;\n          }\n        });\n        return DomQuery(result);\n      },\n      offset: function (offset) {\n        var elm, doc, docElm;\n        var x = 0, y = 0, pos;\n        if (!offset) {\n          elm = this[0];\n          if (elm) {\n            doc = elm.ownerDocument;\n            docElm = doc.documentElement;\n            if (elm.getBoundingClientRect) {\n              pos = elm.getBoundingClientRect();\n              x = pos.left + (docElm.scrollLeft || doc.body.scrollLeft) - docElm.clientLeft;\n              y = pos.top + (docElm.scrollTop || doc.body.scrollTop) - docElm.clientTop;\n            }\n          }\n          return {\n            left: x,\n            top: y\n          };\n        }\n        return this.css(offset);\n      },\n      push: push$1,\n      sort: [].sort,\n      splice: [].splice\n    };\n    Tools.extend(DomQuery, {\n      extend: Tools.extend,\n      makeArray: function (object) {\n        if (isWindow(object) || object.nodeType) {\n          return [object];\n        }\n        return Tools.toArray(object);\n      },\n      inArray: inArray,\n      isArray: Tools.isArray,\n      each: each$2,\n      trim: trim$1,\n      grep: grep,\n      find: Sizzle,\n      expr: Sizzle.selectors,\n      unique: Sizzle.uniqueSort,\n      text: Sizzle.getText,\n      contains: Sizzle.contains,\n      filter: function (expr, elems, not) {\n        var i = elems.length;\n        if (not) {\n          expr = ':not(' + expr + ')';\n        }\n        while (i--) {\n          if (elems[i].nodeType !== 1) {\n            elems.splice(i, 1);\n          }\n        }\n        if (elems.length === 1) {\n          elems = DomQuery.find.matchesSelector(elems[0], expr) ? [elems[0]] : [];\n        } else {\n          elems = DomQuery.find.matches(expr, elems);\n        }\n        return elems;\n      }\n    });\n    var dir = function (el, prop, until) {\n      var matched = [];\n      var cur = el[prop];\n      if (typeof until !== 'string' && until instanceof DomQuery) {\n        until = until[0];\n      }\n      while (cur && cur.nodeType !== 9) {\n        if (until !== undefined) {\n          if (cur === until) {\n            break;\n          }\n          if (typeof until === 'string' && DomQuery(cur).is(until)) {\n            break;\n          }\n        }\n        if (cur.nodeType === 1) {\n          matched.push(cur);\n        }\n        cur = cur[prop];\n      }\n      return matched;\n    };\n    var sibling = function (node, siblingName, nodeType, until) {\n      var result = [];\n      if (until instanceof DomQuery) {\n        until = until[0];\n      }\n      for (; node; node = node[siblingName]) {\n        if (nodeType && node.nodeType !== nodeType) {\n          continue;\n        }\n        if (until !== undefined) {\n          if (node === until) {\n            break;\n          }\n          if (typeof until === 'string' && DomQuery(node).is(until)) {\n            break;\n          }\n        }\n        result.push(node);\n      }\n      return result;\n    };\n    var firstSibling = function (node, siblingName, nodeType) {\n      for (node = node[siblingName]; node; node = node[siblingName]) {\n        if (node.nodeType === nodeType) {\n          return node;\n        }\n      }\n      return null;\n    };\n    each$2({\n      parent: function (node) {\n        var parent = node.parentNode;\n        return parent && parent.nodeType !== 11 ? parent : null;\n      },\n      parents: function (node) {\n        return dir(node, 'parentNode');\n      },\n      next: function (node) {\n        return firstSibling(node, 'nextSibling', 1);\n      },\n      prev: function (node) {\n        return firstSibling(node, 'previousSibling', 1);\n      },\n      children: function (node) {\n        return sibling(node.firstChild, 'nextSibling', 1);\n      },\n      contents: function (node) {\n        return Tools.toArray((node.nodeName === 'iframe' ? node.contentDocument || node.contentWindow.document : node).childNodes);\n      }\n    }, function (name, fn) {\n      DomQuery.fn[name] = function (selector) {\n        var self = this;\n        var result = [];\n        self.each(function () {\n          var nodes = fn.call(result, this, selector, result);\n          if (nodes) {\n            if (DomQuery.isArray(nodes)) {\n              result.push.apply(result, nodes);\n            } else {\n              result.push(nodes);\n            }\n          }\n        });\n        if (this.length > 1) {\n          if (!skipUniques[name]) {\n            result = DomQuery.unique(result);\n          }\n          if (name.indexOf('parents') === 0) {\n            result = result.reverse();\n          }\n        }\n        result = DomQuery(result);\n        if (selector) {\n          return result.filter(selector);\n        }\n        return result;\n      };\n    });\n    each$2({\n      parentsUntil: function (node, until) {\n        return dir(node, 'parentNode', until);\n      },\n      nextUntil: function (node, until) {\n        return sibling(node, 'nextSibling', 1, until).slice(1);\n      },\n      prevUntil: function (node, until) {\n        return sibling(node, 'previousSibling', 1, until).slice(1);\n      }\n    }, function (name, fn) {\n      DomQuery.fn[name] = function (selector, filter) {\n        var self = this;\n        var result = [];\n        self.each(function () {\n          var nodes = fn.call(result, this, selector, result);\n          if (nodes) {\n            if (DomQuery.isArray(nodes)) {\n              result.push.apply(result, nodes);\n            } else {\n              result.push(nodes);\n            }\n          }\n        });\n        if (this.length > 1) {\n          result = DomQuery.unique(result);\n          if (name.indexOf('parents') === 0 || name === 'prevUntil') {\n            result = result.reverse();\n          }\n        }\n        result = DomQuery(result);\n        if (filter) {\n          return result.filter(filter);\n        }\n        return result;\n      };\n    });\n    DomQuery.fn.is = function (selector) {\n      return !!selector && this.filter(selector).length > 0;\n    };\n    DomQuery.fn.init.prototype = DomQuery.fn;\n    DomQuery.overrideDefaults = function (callback) {\n      var defaults;\n      var sub = function (selector, context) {\n        defaults = defaults || callback();\n        if (arguments.length === 0) {\n          selector = defaults.element;\n        }\n        if (!context) {\n          context = defaults.context;\n        }\n        return new sub.fn.init(selector, context);\n      };\n      DomQuery.extend(sub, this);\n      return sub;\n    };\n    var appendHooks = function (targetHooks, prop, hooks) {\n      each$2(hooks, function (name, func) {\n        targetHooks[name] = targetHooks[name] || {};\n        targetHooks[name][prop] = func;\n      });\n    };\n    if (Env.ie && Env.ie < 8) {\n      appendHooks(attrHooks, 'get', {\n        maxlength: function (elm) {\n          var value = elm.maxLength;\n          if (value === 2147483647) {\n            return undefined;\n          }\n          return value;\n        },\n        size: function (elm) {\n          var value = elm.size;\n          if (value === 20) {\n            return undefined;\n          }\n          return value;\n        },\n        class: function (elm) {\n          return elm.className;\n        },\n        style: function (elm) {\n          var value = elm.style.cssText;\n          if (value.length === 0) {\n            return undefined;\n          }\n          return value;\n        }\n      });\n      appendHooks(attrHooks, 'set', {\n        class: function (elm, value) {\n          elm.className = value;\n        },\n        style: function (elm, value) {\n          elm.style.cssText = value;\n        }\n      });\n    }\n    if (Env.ie && Env.ie < 9) {\n      cssFix.float = 'styleFloat';\n      appendHooks(cssHooks, 'set', {\n        opacity: function (elm, value) {\n          var style = elm.style;\n          if (value === null || value === '') {\n            style.removeAttribute('filter');\n          } else {\n            style.zoom = 1;\n            style.filter = 'alpha(opacity=' + value * 100 + ')';\n          }\n        }\n      });\n    }\n    DomQuery.attrHooks = attrHooks;\n    DomQuery.cssHooks = cssHooks;\n\n    var cached = function (f) {\n      var called = false;\n      var r;\n      return function () {\n        var args = [];\n        for (var _i = 0; _i < arguments.length; _i++) {\n          args[_i] = arguments[_i];\n        }\n        if (!called) {\n          called = true;\n          r = f.apply(null, args);\n        }\n        return r;\n      };\n    };\n\n    var firstMatch = function (regexes, s) {\n      for (var i = 0; i < regexes.length; i++) {\n        var x = regexes[i];\n        if (x.test(s)) {\n          return x;\n        }\n      }\n      return undefined;\n    };\n    var find$2 = function (regexes, agent) {\n      var r = firstMatch(regexes, agent);\n      if (!r) {\n        return {\n          major: 0,\n          minor: 0\n        };\n      }\n      var group = function (i) {\n        return Number(agent.replace(r, '$' + i));\n      };\n      return nu(group(1), group(2));\n    };\n    var detect = function (versionRegexes, agent) {\n      var cleanedAgent = String(agent).toLowerCase();\n      if (versionRegexes.length === 0) {\n        return unknown();\n      }\n      return find$2(versionRegexes, cleanedAgent);\n    };\n    var unknown = function () {\n      return nu(0, 0);\n    };\n    var nu = function (major, minor) {\n      return {\n        major: major,\n        minor: minor\n      };\n    };\n    var Version = {\n      nu: nu,\n      detect: detect,\n      unknown: unknown\n    };\n\n    var edge = 'Edge';\n    var chrome = 'Chrome';\n    var ie$1 = 'IE';\n    var opera$1 = 'Opera';\n    var firefox = 'Firefox';\n    var safari = 'Safari';\n    var isBrowser = function (name, current) {\n      return function () {\n        return current === name;\n      };\n    };\n    var unknown$1 = function () {\n      return nu$1({\n        current: undefined,\n        version: Version.unknown()\n      });\n    };\n    var nu$1 = function (info) {\n      var current = info.current;\n      var version = info.version;\n      return {\n        current: current,\n        version: version,\n        isEdge: isBrowser(edge, current),\n        isChrome: isBrowser(chrome, current),\n        isIE: isBrowser(ie$1, current),\n        isOpera: isBrowser(opera$1, current),\n        isFirefox: isBrowser(firefox, current),\n        isSafari: isBrowser(safari, current)\n      };\n    };\n    var Browser = {\n      unknown: unknown$1,\n      nu: nu$1,\n      edge: constant(edge),\n      chrome: constant(chrome),\n      ie: constant(ie$1),\n      opera: constant(opera$1),\n      firefox: constant(firefox),\n      safari: constant(safari)\n    };\n\n    var windows = 'Windows';\n    var ios = 'iOS';\n    var android$1 = 'Android';\n    var linux = 'Linux';\n    var osx = 'OSX';\n    var solaris = 'Solaris';\n    var freebsd = 'FreeBSD';\n    var isOS = function (name, current) {\n      return function () {\n        return current === name;\n      };\n    };\n    var unknown$2 = function () {\n      return nu$2({\n        current: undefined,\n        version: Version.unknown()\n      });\n    };\n    var nu$2 = function (info) {\n      var current = info.current;\n      var version = info.version;\n      return {\n        current: current,\n        version: version,\n        isWindows: isOS(windows, current),\n        isiOS: isOS(ios, current),\n        isAndroid: isOS(android$1, current),\n        isOSX: isOS(osx, current),\n        isLinux: isOS(linux, current),\n        isSolaris: isOS(solaris, current),\n        isFreeBSD: isOS(freebsd, current)\n      };\n    };\n    var OperatingSystem = {\n      unknown: unknown$2,\n      nu: nu$2,\n      windows: constant(windows),\n      ios: constant(ios),\n      android: constant(android$1),\n      linux: constant(linux),\n      osx: constant(osx),\n      solaris: constant(solaris),\n      freebsd: constant(freebsd)\n    };\n\n    var DeviceType = function (os, browser, userAgent) {\n      var isiPad = os.isiOS() && /ipad/i.test(userAgent) === true;\n      var isiPhone = os.isiOS() && !isiPad;\n      var isAndroid3 = os.isAndroid() && os.version.major === 3;\n      var isAndroid4 = os.isAndroid() && os.version.major === 4;\n      var isTablet = isiPad || isAndroid3 || isAndroid4 && /mobile/i.test(userAgent) === true;\n      var isTouch = os.isiOS() || os.isAndroid();\n      var isPhone = isTouch && !isTablet;\n      var iOSwebview = browser.isSafari() && os.isiOS() && /safari/i.test(userAgent) === false;\n      return {\n        isiPad: constant(isiPad),\n        isiPhone: constant(isiPhone),\n        isTablet: constant(isTablet),\n        isPhone: constant(isPhone),\n        isTouch: constant(isTouch),\n        isAndroid: os.isAndroid,\n        isiOS: os.isiOS,\n        isWebView: constant(iOSwebview)\n      };\n    };\n\n    var detect$1 = function (candidates, userAgent) {\n      var agent = String(userAgent).toLowerCase();\n      return find(candidates, function (candidate) {\n        return candidate.search(agent);\n      });\n    };\n    var detectBrowser = function (browsers, userAgent) {\n      return detect$1(browsers, userAgent).map(function (browser) {\n        var version = Version.detect(browser.versionRegexes, userAgent);\n        return {\n          current: browser.name,\n          version: version\n        };\n      });\n    };\n    var detectOs = function (oses, userAgent) {\n      return detect$1(oses, userAgent).map(function (os) {\n        var version = Version.detect(os.versionRegexes, userAgent);\n        return {\n          current: os.name,\n          version: version\n        };\n      });\n    };\n    var UaString = {\n      detectBrowser: detectBrowser,\n      detectOs: detectOs\n    };\n\n    var contains$2 = function (str, substr) {\n      return str.indexOf(substr) !== -1;\n    };\n    var trim$2 = function (str) {\n      return str.replace(/^\\s+|\\s+$/g, '');\n    };\n    var lTrim = function (str) {\n      return str.replace(/^\\s+/g, '');\n    };\n    var rTrim = function (str) {\n      return str.replace(/\\s+$/g, '');\n    };\n\n    var normalVersionRegex = /.*?version\\/\\ ?([0-9]+)\\.([0-9]+).*/;\n    var checkContains = function (target) {\n      return function (uastring) {\n        return contains$2(uastring, target);\n      };\n    };\n    var browsers = [\n      {\n        name: 'Edge',\n        versionRegexes: [/.*?edge\\/ ?([0-9]+)\\.([0-9]+)$/],\n        search: function (uastring) {\n          return contains$2(uastring, 'edge/') && contains$2(uastring, 'chrome') && contains$2(uastring, 'safari') && contains$2(uastring, 'applewebkit');\n        }\n      },\n      {\n        name: 'Chrome',\n        versionRegexes: [\n          /.*?chrome\\/([0-9]+)\\.([0-9]+).*/,\n          normalVersionRegex\n        ],\n        search: function (uastring) {\n          return contains$2(uastring, 'chrome') && !contains$2(uastring, 'chromeframe');\n        }\n      },\n      {\n        name: 'IE',\n        versionRegexes: [\n          /.*?msie\\ ?([0-9]+)\\.([0-9]+).*/,\n          /.*?rv:([0-9]+)\\.([0-9]+).*/\n        ],\n        search: function (uastring) {\n          return contains$2(uastring, 'msie') || contains$2(uastring, 'trident');\n        }\n      },\n      {\n        name: 'Opera',\n        versionRegexes: [\n          normalVersionRegex,\n          /.*?opera\\/([0-9]+)\\.([0-9]+).*/\n        ],\n        search: checkContains('opera')\n      },\n      {\n        name: 'Firefox',\n        versionRegexes: [/.*?firefox\\/\\ ?([0-9]+)\\.([0-9]+).*/],\n        search: checkContains('firefox')\n      },\n      {\n        name: 'Safari',\n        versionRegexes: [\n          normalVersionRegex,\n          /.*?cpu os ([0-9]+)_([0-9]+).*/\n        ],\n        search: function (uastring) {\n          return (contains$2(uastring, 'safari') || contains$2(uastring, 'mobile/')) && contains$2(uastring, 'applewebkit');\n        }\n      }\n    ];\n    var oses = [\n      {\n        name: 'Windows',\n        search: checkContains('win'),\n        versionRegexes: [/.*?windows\\ nt\\ ?([0-9]+)\\.([0-9]+).*/]\n      },\n      {\n        name: 'iOS',\n        search: function (uastring) {\n          return contains$2(uastring, 'iphone') || contains$2(uastring, 'ipad');\n        },\n        versionRegexes: [\n          /.*?version\\/\\ ?([0-9]+)\\.([0-9]+).*/,\n          /.*cpu os ([0-9]+)_([0-9]+).*/,\n          /.*cpu iphone os ([0-9]+)_([0-9]+).*/\n        ]\n      },\n      {\n        name: 'Android',\n        search: checkContains('android'),\n        versionRegexes: [/.*?android\\ ?([0-9]+)\\.([0-9]+).*/]\n      },\n      {\n        name: 'OSX',\n        search: checkContains('os x'),\n        versionRegexes: [/.*?os\\ x\\ ?([0-9]+)_([0-9]+).*/]\n      },\n      {\n        name: 'Linux',\n        search: checkContains('linux'),\n        versionRegexes: []\n      },\n      {\n        name: 'Solaris',\n        search: checkContains('sunos'),\n        versionRegexes: []\n      },\n      {\n        name: 'FreeBSD',\n        search: checkContains('freebsd'),\n        versionRegexes: []\n      }\n    ];\n    var PlatformInfo = {\n      browsers: constant(browsers),\n      oses: constant(oses)\n    };\n\n    var detect$2 = function (userAgent) {\n      var browsers = PlatformInfo.browsers();\n      var oses = PlatformInfo.oses();\n      var browser = UaString.detectBrowser(browsers, userAgent).fold(Browser.unknown, Browser.nu);\n      var os = UaString.detectOs(oses, userAgent).fold(OperatingSystem.unknown, OperatingSystem.nu);\n      var deviceType = DeviceType(os, browser, userAgent);\n      return {\n        browser: browser,\n        os: os,\n        deviceType: deviceType\n      };\n    };\n    var PlatformDetection = { detect: detect$2 };\n\n    var detect$3 = cached(function () {\n      var userAgent = domGlobals.navigator.userAgent;\n      return PlatformDetection.detect(userAgent);\n    });\n    var PlatformDetection$1 = { detect: detect$3 };\n\n    var fromHtml = function (html, scope) {\n      var doc = scope || domGlobals.document;\n      var div = doc.createElement('div');\n      div.innerHTML = html;\n      if (!div.hasChildNodes() || div.childNodes.length > 1) {\n        domGlobals.console.error('HTML does not have a single root node', html);\n        throw new Error('HTML must have a single root node');\n      }\n      return fromDom(div.childNodes[0]);\n    };\n    var fromTag = function (tag, scope) {\n      var doc = scope || domGlobals.document;\n      var node = doc.createElement(tag);\n      return fromDom(node);\n    };\n    var fromText = function (text, scope) {\n      var doc = scope || domGlobals.document;\n      var node = doc.createTextNode(text);\n      return fromDom(node);\n    };\n    var fromDom = function (node) {\n      if (node === null || node === undefined) {\n        throw new Error('Node cannot be null or undefined');\n      }\n      return { dom: constant(node) };\n    };\n    var fromPoint = function (docElm, x, y) {\n      var doc = docElm.dom();\n      return Option.from(doc.elementFromPoint(x, y)).map(fromDom);\n    };\n    var Element = {\n      fromHtml: fromHtml,\n      fromTag: fromTag,\n      fromText: fromText,\n      fromDom: fromDom,\n      fromPoint: fromPoint\n    };\n\n    var ATTRIBUTE = domGlobals.Node.ATTRIBUTE_NODE;\n    var CDATA_SECTION = domGlobals.Node.CDATA_SECTION_NODE;\n    var COMMENT = domGlobals.Node.COMMENT_NODE;\n    var DOCUMENT = domGlobals.Node.DOCUMENT_NODE;\n    var DOCUMENT_TYPE = domGlobals.Node.DOCUMENT_TYPE_NODE;\n    var DOCUMENT_FRAGMENT = domGlobals.Node.DOCUMENT_FRAGMENT_NODE;\n    var ELEMENT = domGlobals.Node.ELEMENT_NODE;\n    var TEXT = domGlobals.Node.TEXT_NODE;\n    var PROCESSING_INSTRUCTION = domGlobals.Node.PROCESSING_INSTRUCTION_NODE;\n    var ENTITY_REFERENCE = domGlobals.Node.ENTITY_REFERENCE_NODE;\n    var ENTITY = domGlobals.Node.ENTITY_NODE;\n    var NOTATION = domGlobals.Node.NOTATION_NODE;\n\n    var name = function (element) {\n      var r = element.dom().nodeName;\n      return r.toLowerCase();\n    };\n    var type = function (element) {\n      return element.dom().nodeType;\n    };\n    var isType$1 = function (t) {\n      return function (element) {\n        return type(element) === t;\n      };\n    };\n    var isElement = isType$1(ELEMENT);\n    var isText = isType$1(TEXT);\n\n    var keys = Object.keys;\n    var hasOwnProperty$1 = Object.hasOwnProperty;\n    var each$3 = function (obj, f) {\n      var props = keys(obj);\n      for (var k = 0, len = props.length; k < len; k++) {\n        var i = props[k];\n        var x = obj[i];\n        f(x, i);\n      }\n    };\n    var map$2 = function (obj, f) {\n      return tupleMap(obj, function (x, i) {\n        return {\n          k: i,\n          v: f(x, i)\n        };\n      });\n    };\n    var tupleMap = function (obj, f) {\n      var r = {};\n      each$3(obj, function (x, i) {\n        var tuple = f(x, i);\n        r[tuple.k] = tuple.v;\n      });\n      return r;\n    };\n    var bifilter = function (obj, pred) {\n      var t = {};\n      var f = {};\n      each$3(obj, function (x, i) {\n        var branch = pred(x, i) ? t : f;\n        branch[i] = x;\n      });\n      return {\n        t: t,\n        f: f\n      };\n    };\n    var has = function (obj, key) {\n      return hasOwnProperty$1.call(obj, key);\n    };\n\n    var isSupported = function (dom) {\n      return dom.style !== undefined && isFunction(dom.style.getPropertyValue);\n    };\n\n    var inBody = function (element) {\n      var dom = isText(element) ? element.dom().parentNode : element.dom();\n      return dom !== undefined && dom !== null && dom.ownerDocument.body.contains(dom);\n    };\n\n    var rawSet = function (dom, key, value) {\n      if (isString(value) || isBoolean(value) || isNumber(value)) {\n        dom.setAttribute(key, value + '');\n      } else {\n        domGlobals.console.error('Invalid call to Attr.set. Key ', key, ':: Value ', value, ':: Element ', dom);\n        throw new Error('Attribute value was not simple');\n      }\n    };\n    var set = function (element, key, value) {\n      rawSet(element.dom(), key, value);\n    };\n    var setAll = function (element, attrs) {\n      var dom = element.dom();\n      each$3(attrs, function (v, k) {\n        rawSet(dom, k, v);\n      });\n    };\n    var get = function (element, key) {\n      var v = element.dom().getAttribute(key);\n      return v === null ? undefined : v;\n    };\n    var has$1 = function (element, key) {\n      var dom = element.dom();\n      return dom && dom.hasAttribute ? dom.hasAttribute(key) : false;\n    };\n    var remove = function (element, key) {\n      element.dom().removeAttribute(key);\n    };\n\n    var internalSet = function (dom, property, value) {\n      if (!isString(value)) {\n        domGlobals.console.error('Invalid call to CSS.set. Property ', property, ':: Value ', value, ':: Element ', dom);\n        throw new Error('CSS value must be a string: ' + value);\n      }\n      if (isSupported(dom)) {\n        dom.style.setProperty(property, value);\n      }\n    };\n    var setAll$1 = function (element, css) {\n      var dom = element.dom();\n      each$3(css, function (v, k) {\n        internalSet(dom, k, v);\n      });\n    };\n    var get$1 = function (element, property) {\n      var dom = element.dom();\n      var styles = domGlobals.window.getComputedStyle(dom);\n      var r = styles.getPropertyValue(property);\n      var v = r === '' && !inBody(element) ? getUnsafeProperty(dom, property) : r;\n      return v === null ? undefined : v;\n    };\n    var getUnsafeProperty = function (dom, property) {\n      return isSupported(dom) ? dom.style.getPropertyValue(property) : '';\n    };\n    var getRaw = function (element, property) {\n      var dom = element.dom();\n      var raw = getUnsafeProperty(dom, property);\n      return Option.from(raw).filter(function (r) {\n        return r.length > 0;\n      });\n    };\n    var getAllRaw = function (element) {\n      var css = {};\n      var dom = element.dom();\n      if (isSupported(dom)) {\n        for (var i = 0; i < dom.style.length; i++) {\n          var ruleName = dom.style.item(i);\n          css[ruleName] = dom.style[ruleName];\n        }\n      }\n      return css;\n    };\n\n    var Immutable = function () {\n      var fields = [];\n      for (var _i = 0; _i < arguments.length; _i++) {\n        fields[_i] = arguments[_i];\n      }\n      return function () {\n        var values = [];\n        for (var _i = 0; _i < arguments.length; _i++) {\n          values[_i] = arguments[_i];\n        }\n        if (fields.length !== values.length) {\n          throw new Error('Wrong number of arguments to struct. Expected \"[' + fields.length + ']\", got ' + values.length + ' arguments');\n        }\n        var struct = {};\n        each(fields, function (name, i) {\n          struct[name] = constant(values[i]);\n        });\n        return struct;\n      };\n    };\n\n    var toArray$1 = function (target, f) {\n      var r = [];\n      var recurse = function (e) {\n        r.push(e);\n        return f(e);\n      };\n      var cur = f(target);\n      do {\n        cur = cur.bind(recurse);\n      } while (cur.isSome());\n      return r;\n    };\n    var Recurse = { toArray: toArray$1 };\n\n    var node = function () {\n      var f = Global$1.getOrDie('Node');\n      return f;\n    };\n    var compareDocumentPosition = function (a, b, match) {\n      return (a.compareDocumentPosition(b) & match) !== 0;\n    };\n    var documentPositionPreceding = function (a, b) {\n      return compareDocumentPosition(a, b, node().DOCUMENT_POSITION_PRECEDING);\n    };\n    var documentPositionContainedBy = function (a, b) {\n      return compareDocumentPosition(a, b, node().DOCUMENT_POSITION_CONTAINED_BY);\n    };\n    var Node = {\n      documentPositionPreceding: documentPositionPreceding,\n      documentPositionContainedBy: documentPositionContainedBy\n    };\n\n    var ELEMENT$1 = ELEMENT;\n    var DOCUMENT$1 = DOCUMENT;\n    var is$1 = function (element, selector) {\n      var dom = element.dom();\n      if (dom.nodeType !== ELEMENT$1) {\n        return false;\n      } else {\n        var elem = dom;\n        if (elem.matches !== undefined) {\n          return elem.matches(selector);\n        } else if (elem.msMatchesSelector !== undefined) {\n          return elem.msMatchesSelector(selector);\n        } else if (elem.webkitMatchesSelector !== undefined) {\n          return elem.webkitMatchesSelector(selector);\n        } else if (elem.mozMatchesSelector !== undefined) {\n          return elem.mozMatchesSelector(selector);\n        } else {\n          throw new Error('Browser lacks native selectors');\n        }\n      }\n    };\n    var bypassSelector = function (dom) {\n      return dom.nodeType !== ELEMENT$1 && dom.nodeType !== DOCUMENT$1 || dom.childElementCount === 0;\n    };\n    var all = function (selector, scope) {\n      var base = scope === undefined ? domGlobals.document : scope.dom();\n      return bypassSelector(base) ? [] : map(base.querySelectorAll(selector), Element.fromDom);\n    };\n    var one = function (selector, scope) {\n      var base = scope === undefined ? domGlobals.document : scope.dom();\n      return bypassSelector(base) ? Option.none() : Option.from(base.querySelector(selector)).map(Element.fromDom);\n    };\n\n    var eq = function (e1, e2) {\n      return e1.dom() === e2.dom();\n    };\n    var regularContains = function (e1, e2) {\n      var d1 = e1.dom();\n      var d2 = e2.dom();\n      return d1 === d2 ? false : d1.contains(d2);\n    };\n    var ieContains = function (e1, e2) {\n      return Node.documentPositionContainedBy(e1.dom(), e2.dom());\n    };\n    var browser = PlatformDetection$1.detect().browser;\n    var contains$3 = browser.isIE() ? ieContains : regularContains;\n\n    var owner = function (element) {\n      return Element.fromDom(element.dom().ownerDocument);\n    };\n    var documentElement = function (element) {\n      return Element.fromDom(element.dom().ownerDocument.documentElement);\n    };\n    var defaultView = function (element) {\n      return Element.fromDom(element.dom().ownerDocument.defaultView);\n    };\n    var parent = function (element) {\n      return Option.from(element.dom().parentNode).map(Element.fromDom);\n    };\n    var parents = function (element, isRoot) {\n      var stop = isFunction(isRoot) ? isRoot : never;\n      var dom = element.dom();\n      var ret = [];\n      while (dom.parentNode !== null && dom.parentNode !== undefined) {\n        var rawParent = dom.parentNode;\n        var p = Element.fromDom(rawParent);\n        ret.push(p);\n        if (stop(p) === true) {\n          break;\n        } else {\n          dom = rawParent;\n        }\n      }\n      return ret;\n    };\n    var prevSibling = function (element) {\n      return Option.from(element.dom().previousSibling).map(Element.fromDom);\n    };\n    var nextSibling = function (element) {\n      return Option.from(element.dom().nextSibling).map(Element.fromDom);\n    };\n    var prevSiblings = function (element) {\n      return reverse(Recurse.toArray(element, prevSibling));\n    };\n    var nextSiblings = function (element) {\n      return Recurse.toArray(element, nextSibling);\n    };\n    var children = function (element) {\n      return map(element.dom().childNodes, Element.fromDom);\n    };\n    var child = function (element, index) {\n      var cs = element.dom().childNodes;\n      return Option.from(cs[index]).map(Element.fromDom);\n    };\n    var firstChild = function (element) {\n      return child(element, 0);\n    };\n    var lastChild = function (element) {\n      return child(element, element.dom().childNodes.length - 1);\n    };\n    var childNodesCount = function (element) {\n      return element.dom().childNodes.length;\n    };\n    var spot = Immutable('element', 'offset');\n\n    var browser$1 = PlatformDetection$1.detect().browser;\n    var firstElement = function (nodes) {\n      return find(nodes, isElement);\n    };\n    var getTableCaptionDeltaY = function (elm) {\n      if (browser$1.isFirefox() && name(elm) === 'table') {\n        return firstElement(children(elm)).filter(function (elm) {\n          return name(elm) === 'caption';\n        }).bind(function (caption) {\n          return firstElement(nextSiblings(caption)).map(function (body) {\n            var bodyTop = body.dom().offsetTop;\n            var captionTop = caption.dom().offsetTop;\n            var captionHeight = caption.dom().offsetHeight;\n            return bodyTop <= captionTop ? -captionHeight : 0;\n          });\n        }).getOr(0);\n      } else {\n        return 0;\n      }\n    };\n    var getPos = function (body, elm, rootElm) {\n      var x = 0, y = 0, offsetParent;\n      var doc = body.ownerDocument;\n      var pos;\n      rootElm = rootElm ? rootElm : body;\n      if (elm) {\n        if (rootElm === body && elm.getBoundingClientRect && get$1(Element.fromDom(body), 'position') === 'static') {\n          pos = elm.getBoundingClientRect();\n          x = pos.left + (doc.documentElement.scrollLeft || body.scrollLeft) - doc.documentElement.clientLeft;\n          y = pos.top + (doc.documentElement.scrollTop || body.scrollTop) - doc.documentElement.clientTop;\n          return {\n            x: x,\n            y: y\n          };\n        }\n        offsetParent = elm;\n        while (offsetParent && offsetParent !== rootElm && offsetParent.nodeType) {\n          x += offsetParent.offsetLeft || 0;\n          y += offsetParent.offsetTop || 0;\n          offsetParent = offsetParent.offsetParent;\n        }\n        offsetParent = elm.parentNode;\n        while (offsetParent && offsetParent !== rootElm && offsetParent.nodeType) {\n          x -= offsetParent.scrollLeft || 0;\n          y -= offsetParent.scrollTop || 0;\n          offsetParent = offsetParent.parentNode;\n        }\n        y += getTableCaptionDeltaY(Element.fromDom(elm));\n      }\n      return {\n        x: x,\n        y: y\n      };\n    };\n    var Position = { getPos: getPos };\n\n    var exports$1 = {}, module$1 = { exports: exports$1 };\n    (function (define, exports, module, require) {\n      (function (f) {\n        if (typeof exports === 'object' && typeof module !== 'undefined') {\n          module.exports = f();\n        } else if (typeof define === 'function' && define.amd) {\n          define([], f);\n        } else {\n          var g;\n          if (typeof window !== 'undefined') {\n            g = window;\n          } else if (typeof global !== 'undefined') {\n            g = global;\n          } else if (typeof self !== 'undefined') {\n            g = self;\n          } else {\n            g = this;\n          }\n          g.EphoxContactWrapper = f();\n        }\n      }(function () {\n        return function () {\n          function r(e, n, t) {\n            function o(i, f) {\n              if (!n[i]) {\n                if (!e[i]) {\n                  var c = 'function' == typeof require && require;\n                  if (!f && c)\n                    return c(i, !0);\n                  if (u)\n                    return u(i, !0);\n                  var a = new Error('Cannot find module \\'' + i + '\\'');\n                  throw a.code = 'MODULE_NOT_FOUND', a;\n                }\n                var p = n[i] = { exports: {} };\n                e[i][0].call(p.exports, function (r) {\n                  var n = e[i][1][r];\n                  return o(n || r);\n                }, p, p.exports, r, e, n, t);\n              }\n              return n[i].exports;\n            }\n            for (var u = 'function' == typeof require && require, i = 0; i < t.length; i++)\n              o(t[i]);\n            return o;\n          }\n          return r;\n        }()({\n          1: [\n            function (require, module, exports) {\n              var process = module.exports = {};\n              var cachedSetTimeout;\n              var cachedClearTimeout;\n              function defaultSetTimout() {\n                throw new Error('setTimeout has not been defined');\n              }\n              function defaultClearTimeout() {\n                throw new Error('clearTimeout has not been defined');\n              }\n              (function () {\n                try {\n                  if (typeof setTimeout === 'function') {\n                    cachedSetTimeout = setTimeout;\n                  } else {\n                    cachedSetTimeout = defaultSetTimout;\n                  }\n                } catch (e) {\n                  cachedSetTimeout = defaultSetTimout;\n                }\n                try {\n                  if (typeof clearTimeout === 'function') {\n                    cachedClearTimeout = clearTimeout;\n                  } else {\n                    cachedClearTimeout = defaultClearTimeout;\n                  }\n                } catch (e) {\n                  cachedClearTimeout = defaultClearTimeout;\n                }\n              }());\n              function runTimeout(fun) {\n                if (cachedSetTimeout === setTimeout) {\n                  return setTimeout(fun, 0);\n                }\n                if ((cachedSetTimeout === defaultSetTimout || !cachedSetTimeout) && setTimeout) {\n                  cachedSetTimeout = setTimeout;\n                  return setTimeout(fun, 0);\n                }\n                try {\n                  return cachedSetTimeout(fun, 0);\n                } catch (e) {\n                  try {\n                    return cachedSetTimeout.call(null, fun, 0);\n                  } catch (e) {\n                    return cachedSetTimeout.call(this, fun, 0);\n                  }\n                }\n              }\n              function runClearTimeout(marker) {\n                if (cachedClearTimeout === clearTimeout) {\n                  return clearTimeout(marker);\n                }\n                if ((cachedClearTimeout === defaultClearTimeout || !cachedClearTimeout) && clearTimeout) {\n                  cachedClearTimeout = clearTimeout;\n                  return clearTimeout(marker);\n                }\n                try {\n                  return cachedClearTimeout(marker);\n                } catch (e) {\n                  try {\n                    return cachedClearTimeout.call(null, marker);\n                  } catch (e) {\n                    return cachedClearTimeout.call(this, marker);\n                  }\n                }\n              }\n              var queue = [];\n              var draining = false;\n              var currentQueue;\n              var queueIndex = -1;\n              function cleanUpNextTick() {\n                if (!draining || !currentQueue) {\n                  return;\n                }\n                draining = false;\n                if (currentQueue.length) {\n                  queue = currentQueue.concat(queue);\n                } else {\n                  queueIndex = -1;\n                }\n                if (queue.length) {\n                  drainQueue();\n                }\n              }\n              function drainQueue() {\n                if (draining) {\n                  return;\n                }\n                var timeout = runTimeout(cleanUpNextTick);\n                draining = true;\n                var len = queue.length;\n                while (len) {\n                  currentQueue = queue;\n                  queue = [];\n                  while (++queueIndex < len) {\n                    if (currentQueue) {\n                      currentQueue[queueIndex].run();\n                    }\n                  }\n                  queueIndex = -1;\n                  len = queue.length;\n                }\n                currentQueue = null;\n                draining = false;\n                runClearTimeout(timeout);\n              }\n              process.nextTick = function (fun) {\n                var args = new Array(arguments.length - 1);\n                if (arguments.length > 1) {\n                  for (var i = 1; i < arguments.length; i++) {\n                    args[i - 1] = arguments[i];\n                  }\n                }\n                queue.push(new Item(fun, args));\n                if (queue.length === 1 && !draining) {\n                  runTimeout(drainQueue);\n                }\n              };\n              function Item(fun, array) {\n                this.fun = fun;\n                this.array = array;\n              }\n              Item.prototype.run = function () {\n                this.fun.apply(null, this.array);\n              };\n              process.title = 'browser';\n              process.browser = true;\n              process.env = {};\n              process.argv = [];\n              process.version = '';\n              process.versions = {};\n              function noop() {\n              }\n              process.on = noop;\n              process.addListener = noop;\n              process.once = noop;\n              process.off = noop;\n              process.removeListener = noop;\n              process.removeAllListeners = noop;\n              process.emit = noop;\n              process.prependListener = noop;\n              process.prependOnceListener = noop;\n              process.listeners = function (name) {\n                return [];\n              };\n              process.binding = function (name) {\n                throw new Error('process.binding is not supported');\n              };\n              process.cwd = function () {\n                return '/';\n              };\n              process.chdir = function (dir) {\n                throw new Error('process.chdir is not supported');\n              };\n              process.umask = function () {\n                return 0;\n              };\n            },\n            {}\n          ],\n          2: [\n            function (require, module, exports) {\n              (function (setImmediate) {\n                (function (root) {\n                  var setTimeoutFunc = setTimeout;\n                  function noop() {\n                  }\n                  function bind(fn, thisArg) {\n                    return function () {\n                      fn.apply(thisArg, arguments);\n                    };\n                  }\n                  function Promise(fn) {\n                    if (typeof this !== 'object')\n                      throw new TypeError('Promises must be constructed via new');\n                    if (typeof fn !== 'function')\n                      throw new TypeError('not a function');\n                    this._state = 0;\n                    this._handled = false;\n                    this._value = undefined;\n                    this._deferreds = [];\n                    doResolve(fn, this);\n                  }\n                  function handle(self, deferred) {\n                    while (self._state === 3) {\n                      self = self._value;\n                    }\n                    if (self._state === 0) {\n                      self._deferreds.push(deferred);\n                      return;\n                    }\n                    self._handled = true;\n                    Promise._immediateFn(function () {\n                      var cb = self._state === 1 ? deferred.onFulfilled : deferred.onRejected;\n                      if (cb === null) {\n                        (self._state === 1 ? resolve : reject)(deferred.promise, self._value);\n                        return;\n                      }\n                      var ret;\n                      try {\n                        ret = cb(self._value);\n                      } catch (e) {\n                        reject(deferred.promise, e);\n                        return;\n                      }\n                      resolve(deferred.promise, ret);\n                    });\n                  }\n                  function resolve(self, newValue) {\n                    try {\n                      if (newValue === self)\n                        throw new TypeError('A promise cannot be resolved with itself.');\n                      if (newValue && (typeof newValue === 'object' || typeof newValue === 'function')) {\n                        var then = newValue.then;\n                        if (newValue instanceof Promise) {\n                          self._state = 3;\n                          self._value = newValue;\n                          finale(self);\n                          return;\n                        } else if (typeof then === 'function') {\n                          doResolve(bind(then, newValue), self);\n                          return;\n                        }\n                      }\n                      self._state = 1;\n                      self._value = newValue;\n                      finale(self);\n                    } catch (e) {\n                      reject(self, e);\n                    }\n                  }\n                  function reject(self, newValue) {\n                    self._state = 2;\n                    self._value = newValue;\n                    finale(self);\n                  }\n                  function finale(self) {\n                    if (self._state === 2 && self._deferreds.length === 0) {\n                      Promise._immediateFn(function () {\n                        if (!self._handled) {\n                          Promise._unhandledRejectionFn(self._value);\n                        }\n                      });\n                    }\n                    for (var i = 0, len = self._deferreds.length; i < len; i++) {\n                      handle(self, self._deferreds[i]);\n                    }\n                    self._deferreds = null;\n                  }\n                  function Handler(onFulfilled, onRejected, promise) {\n                    this.onFulfilled = typeof onFulfilled === 'function' ? onFulfilled : null;\n                    this.onRejected = typeof onRejected === 'function' ? onRejected : null;\n                    this.promise = promise;\n                  }\n                  function doResolve(fn, self) {\n                    var done = false;\n                    try {\n                      fn(function (value) {\n                        if (done)\n                          return;\n                        done = true;\n                        resolve(self, value);\n                      }, function (reason) {\n                        if (done)\n                          return;\n                        done = true;\n                        reject(self, reason);\n                      });\n                    } catch (ex) {\n                      if (done)\n                        return;\n                      done = true;\n                      reject(self, ex);\n                    }\n                  }\n                  Promise.prototype['catch'] = function (onRejected) {\n                    return this.then(null, onRejected);\n                  };\n                  Promise.prototype.then = function (onFulfilled, onRejected) {\n                    var prom = new this.constructor(noop);\n                    handle(this, new Handler(onFulfilled, onRejected, prom));\n                    return prom;\n                  };\n                  Promise.all = function (arr) {\n                    var args = Array.prototype.slice.call(arr);\n                    return new Promise(function (resolve, reject) {\n                      if (args.length === 0)\n                        return resolve([]);\n                      var remaining = args.length;\n                      function res(i, val) {\n                        try {\n                          if (val && (typeof val === 'object' || typeof val === 'function')) {\n                            var then = val.then;\n                            if (typeof then === 'function') {\n                              then.call(val, function (val) {\n                                res(i, val);\n                              }, reject);\n                              return;\n                            }\n                          }\n                          args[i] = val;\n                          if (--remaining === 0) {\n                            resolve(args);\n                          }\n                        } catch (ex) {\n                          reject(ex);\n                        }\n                      }\n                      for (var i = 0; i < args.length; i++) {\n                        res(i, args[i]);\n                      }\n                    });\n                  };\n                  Promise.resolve = function (value) {\n                    if (value && typeof value === 'object' && value.constructor === Promise) {\n                      return value;\n                    }\n                    return new Promise(function (resolve) {\n                      resolve(value);\n                    });\n                  };\n                  Promise.reject = function (value) {\n                    return new Promise(function (resolve, reject) {\n                      reject(value);\n                    });\n                  };\n                  Promise.race = function (values) {\n                    return new Promise(function (resolve, reject) {\n                      for (var i = 0, len = values.length; i < len; i++) {\n                        values[i].then(resolve, reject);\n                      }\n                    });\n                  };\n                  Promise._immediateFn = typeof setImmediate === 'function' ? function (fn) {\n                    setImmediate(fn);\n                  } : function (fn) {\n                    setTimeoutFunc(fn, 0);\n                  };\n                  Promise._unhandledRejectionFn = function _unhandledRejectionFn(err) {\n                    if (typeof console !== 'undefined' && console) {\n                      console.warn('Possible Unhandled Promise Rejection:', err);\n                    }\n                  };\n                  Promise._setImmediateFn = function _setImmediateFn(fn) {\n                    Promise._immediateFn = fn;\n                  };\n                  Promise._setUnhandledRejectionFn = function _setUnhandledRejectionFn(fn) {\n                    Promise._unhandledRejectionFn = fn;\n                  };\n                  if (typeof module !== 'undefined' && module.exports) {\n                    module.exports = Promise;\n                  } else if (!root.Promise) {\n                    root.Promise = Promise;\n                  }\n                }(this));\n              }.call(this, require('timers').setImmediate));\n            },\n            { 'timers': 3 }\n          ],\n          3: [\n            function (require, module, exports) {\n              (function (setImmediate, clearImmediate) {\n                var nextTick = require('process/browser.js').nextTick;\n                var apply = Function.prototype.apply;\n                var slice = Array.prototype.slice;\n                var immediateIds = {};\n                var nextImmediateId = 0;\n                exports.setTimeout = function () {\n                  return new Timeout(apply.call(setTimeout, window, arguments), clearTimeout);\n                };\n                exports.setInterval = function () {\n                  return new Timeout(apply.call(setInterval, window, arguments), clearInterval);\n                };\n                exports.clearTimeout = exports.clearInterval = function (timeout) {\n                  timeout.close();\n                };\n                function Timeout(id, clearFn) {\n                  this._id = id;\n                  this._clearFn = clearFn;\n                }\n                Timeout.prototype.unref = Timeout.prototype.ref = function () {\n                };\n                Timeout.prototype.close = function () {\n                  this._clearFn.call(window, this._id);\n                };\n                exports.enroll = function (item, msecs) {\n                  clearTimeout(item._idleTimeoutId);\n                  item._idleTimeout = msecs;\n                };\n                exports.unenroll = function (item) {\n                  clearTimeout(item._idleTimeoutId);\n                  item._idleTimeout = -1;\n                };\n                exports._unrefActive = exports.active = function (item) {\n                  clearTimeout(item._idleTimeoutId);\n                  var msecs = item._idleTimeout;\n                  if (msecs >= 0) {\n                    item._idleTimeoutId = setTimeout(function onTimeout() {\n                      if (item._onTimeout)\n                        item._onTimeout();\n                    }, msecs);\n                  }\n                };\n                exports.setImmediate = typeof setImmediate === 'function' ? setImmediate : function (fn) {\n                  var id = nextImmediateId++;\n                  var args = arguments.length < 2 ? false : slice.call(arguments, 1);\n                  immediateIds[id] = true;\n                  nextTick(function onNextTick() {\n                    if (immediateIds[id]) {\n                      if (args) {\n                        fn.apply(null, args);\n                      } else {\n                        fn.call(null);\n                      }\n                      exports.clearImmediate(id);\n                    }\n                  });\n                  return id;\n                };\n                exports.clearImmediate = typeof clearImmediate === 'function' ? clearImmediate : function (id) {\n                  delete immediateIds[id];\n                };\n              }.call(this, require('timers').setImmediate, require('timers').clearImmediate));\n            },\n            {\n              'process/browser.js': 1,\n              'timers': 3\n            }\n          ],\n          4: [\n            function (require, module, exports) {\n              var promisePolyfill = require('promise-polyfill');\n              var Global = function () {\n                if (typeof window !== 'undefined') {\n                  return window;\n                } else {\n                  return Function('return this;')();\n                }\n              }();\n              module.exports = { boltExport: Global.Promise || promisePolyfill };\n            },\n            { 'promise-polyfill': 2 }\n          ]\n        }, {}, [4])(4);\n      }));\n    }(undefined, exports$1, module$1, undefined));\n    var Promise = module$1.exports.boltExport;\n\n    var nu$3 = function (baseFn) {\n      var data = Option.none();\n      var callbacks = [];\n      var map = function (f) {\n        return nu$3(function (nCallback) {\n          get(function (data) {\n            nCallback(f(data));\n          });\n        });\n      };\n      var get = function (nCallback) {\n        if (isReady()) {\n          call(nCallback);\n        } else {\n          callbacks.push(nCallback);\n        }\n      };\n      var set = function (x) {\n        data = Option.some(x);\n        run(callbacks);\n        callbacks = [];\n      };\n      var isReady = function () {\n        return data.isSome();\n      };\n      var run = function (cbs) {\n        each(cbs, call);\n      };\n      var call = function (cb) {\n        data.each(function (x) {\n          domGlobals.setTimeout(function () {\n            cb(x);\n          }, 0);\n        });\n      };\n      baseFn(set);\n      return {\n        get: get,\n        map: map,\n        isReady: isReady\n      };\n    };\n    var pure = function (a) {\n      return nu$3(function (callback) {\n        callback(a);\n      });\n    };\n    var LazyValue = {\n      nu: nu$3,\n      pure: pure\n    };\n\n    var errorReporter = function (err) {\n      domGlobals.setTimeout(function () {\n        throw err;\n      }, 0);\n    };\n    var make = function (run) {\n      var get = function (callback) {\n        run().then(callback, errorReporter);\n      };\n      var map = function (fab) {\n        return make(function () {\n          return run().then(fab);\n        });\n      };\n      var bind = function (aFutureB) {\n        return make(function () {\n          return run().then(function (v) {\n            return aFutureB(v).toPromise();\n          });\n        });\n      };\n      var anonBind = function (futureB) {\n        return make(function () {\n          return run().then(function () {\n            return futureB.toPromise();\n          });\n        });\n      };\n      var toLazy = function () {\n        return LazyValue.nu(get);\n      };\n      var toCached = function () {\n        var cache = null;\n        return make(function () {\n          if (cache === null) {\n            cache = run();\n          }\n          return cache;\n        });\n      };\n      var toPromise = run;\n      return {\n        map: map,\n        bind: bind,\n        anonBind: anonBind,\n        toLazy: toLazy,\n        toCached: toCached,\n        toPromise: toPromise,\n        get: get\n      };\n    };\n    var nu$4 = function (baseFn) {\n      return make(function () {\n        return new Promise(baseFn);\n      });\n    };\n    var pure$1 = function (a) {\n      return make(function () {\n        return Promise.resolve(a);\n      });\n    };\n    var Future = {\n      nu: nu$4,\n      pure: pure$1\n    };\n\n    var par = function (asyncValues, nu) {\n      return nu(function (callback) {\n        var r = [];\n        var count = 0;\n        var cb = function (i) {\n          return function (value) {\n            r[i] = value;\n            count++;\n            if (count >= asyncValues.length) {\n              callback(r);\n            }\n          };\n        };\n        if (asyncValues.length === 0) {\n          callback([]);\n        } else {\n          each(asyncValues, function (asyncValue, i) {\n            asyncValue.get(cb(i));\n          });\n        }\n      });\n    };\n\n    var par$1 = function (futures) {\n      return par(futures, Future.nu);\n    };\n\n    var value = function (o) {\n      var is = function (v) {\n        return o === v;\n      };\n      var or = function (opt) {\n        return value(o);\n      };\n      var orThunk = function (f) {\n        return value(o);\n      };\n      var map = function (f) {\n        return value(f(o));\n      };\n      var mapError = function (f) {\n        return value(o);\n      };\n      var each = function (f) {\n        f(o);\n      };\n      var bind = function (f) {\n        return f(o);\n      };\n      var fold = function (_, onValue) {\n        return onValue(o);\n      };\n      var exists = function (f) {\n        return f(o);\n      };\n      var forall = function (f) {\n        return f(o);\n      };\n      var toOption = function () {\n        return Option.some(o);\n      };\n      return {\n        is: is,\n        isValue: always,\n        isError: never,\n        getOr: constant(o),\n        getOrThunk: constant(o),\n        getOrDie: constant(o),\n        or: or,\n        orThunk: orThunk,\n        fold: fold,\n        map: map,\n        mapError: mapError,\n        each: each,\n        bind: bind,\n        exists: exists,\n        forall: forall,\n        toOption: toOption\n      };\n    };\n    var error = function (message) {\n      var getOrThunk = function (f) {\n        return f();\n      };\n      var getOrDie = function () {\n        return die(String(message))();\n      };\n      var or = function (opt) {\n        return opt;\n      };\n      var orThunk = function (f) {\n        return f();\n      };\n      var map = function (f) {\n        return error(message);\n      };\n      var mapError = function (f) {\n        return error(f(message));\n      };\n      var bind = function (f) {\n        return error(message);\n      };\n      var fold = function (onError, _) {\n        return onError(message);\n      };\n      return {\n        is: never,\n        isValue: never,\n        isError: always,\n        getOr: identity,\n        getOrThunk: getOrThunk,\n        getOrDie: getOrDie,\n        or: or,\n        orThunk: orThunk,\n        fold: fold,\n        map: map,\n        mapError: mapError,\n        each: noop,\n        bind: bind,\n        exists: never,\n        forall: always,\n        toOption: Option.none\n      };\n    };\n    var fromOption = function (opt, err) {\n      return opt.fold(function () {\n        return error(err);\n      }, value);\n    };\n    var Result = {\n      value: value,\n      error: error,\n      fromOption: fromOption\n    };\n\n    function StyleSheetLoader(document, settings) {\n      if (settings === void 0) {\n        settings = {};\n      }\n      var idCount = 0;\n      var loadedStates = {};\n      var maxLoadTime;\n      maxLoadTime = settings.maxLoadTime || 5000;\n      var appendToHead = function (node) {\n        document.getElementsByTagName('head')[0].appendChild(node);\n      };\n      var load = function (url, loadedCallback, errorCallback) {\n        var link, style, startTime, state;\n        var passed = function () {\n          var callbacks = state.passed;\n          var i = callbacks.length;\n          while (i--) {\n            callbacks[i]();\n          }\n          state.status = 2;\n          state.passed = [];\n          state.failed = [];\n        };\n        var failed = function () {\n          var callbacks = state.failed;\n          var i = callbacks.length;\n          while (i--) {\n            callbacks[i]();\n          }\n          state.status = 3;\n          state.passed = [];\n          state.failed = [];\n        };\n        var isOldWebKit = function () {\n          var webKitChunks = domGlobals.navigator.userAgent.match(/WebKit\\/(\\d*)/);\n          return !!(webKitChunks && parseInt(webKitChunks[1], 10) < 536);\n        };\n        var wait = function (testCallback, waitCallback) {\n          if (!testCallback()) {\n            if (new Date().getTime() - startTime < maxLoadTime) {\n              Delay.setTimeout(waitCallback);\n            } else {\n              failed();\n            }\n          }\n        };\n        var waitForWebKitLinkLoaded = function () {\n          wait(function () {\n            var styleSheets = document.styleSheets;\n            var styleSheet, i = styleSheets.length, owner;\n            while (i--) {\n              styleSheet = styleSheets[i];\n              owner = styleSheet.ownerNode ? styleSheet.ownerNode : styleSheet.owningElement;\n              if (owner && owner.id === link.id) {\n                passed();\n                return true;\n              }\n            }\n          }, waitForWebKitLinkLoaded);\n        };\n        var waitForGeckoLinkLoaded = function () {\n          wait(function () {\n            try {\n              var cssRules = style.sheet.cssRules;\n              passed();\n              return !!cssRules;\n            } catch (ex) {\n            }\n          }, waitForGeckoLinkLoaded);\n        };\n        url = Tools._addCacheSuffix(url);\n        if (!loadedStates[url]) {\n          state = {\n            passed: [],\n            failed: []\n          };\n          loadedStates[url] = state;\n        } else {\n          state = loadedStates[url];\n        }\n        if (loadedCallback) {\n          state.passed.push(loadedCallback);\n        }\n        if (errorCallback) {\n          state.failed.push(errorCallback);\n        }\n        if (state.status === 1) {\n          return;\n        }\n        if (state.status === 2) {\n          passed();\n          return;\n        }\n        if (state.status === 3) {\n          failed();\n          return;\n        }\n        state.status = 1;\n        link = document.createElement('link');\n        link.rel = 'stylesheet';\n        link.type = 'text/css';\n        link.id = 'u' + idCount++;\n        link.async = false;\n        link.defer = false;\n        startTime = new Date().getTime();\n        if (settings.contentCssCors) {\n          link.crossOrigin = 'anonymous';\n        }\n        if ('onload' in link && !isOldWebKit()) {\n          link.onload = waitForWebKitLinkLoaded;\n          link.onerror = failed;\n        } else {\n          if (domGlobals.navigator.userAgent.indexOf('Firefox') > 0) {\n            style = document.createElement('style');\n            style.textContent = '@import \"' + url + '\"';\n            waitForGeckoLinkLoaded();\n            appendToHead(style);\n            return;\n          }\n          waitForWebKitLinkLoaded();\n        }\n        appendToHead(link);\n        link.href = url;\n      };\n      var loadF = function (url) {\n        return Future.nu(function (resolve) {\n          load(url, compose(resolve, constant(Result.value(url))), compose(resolve, constant(Result.error(url))));\n        });\n      };\n      var unbox = function (result) {\n        return result.fold(identity, identity);\n      };\n      var loadAll = function (urls, success, failure) {\n        par$1(map(urls, loadF)).get(function (result) {\n          var parts = partition(result, function (r) {\n            return r.isValue();\n          });\n          if (parts.fail.length > 0) {\n            failure(parts.fail.map(unbox));\n          } else {\n            success(parts.pass.map(unbox));\n          }\n        });\n      };\n      return {\n        load: load,\n        loadAll: loadAll\n      };\n    }\n\n    function TreeWalker (startNode, rootNode) {\n      var node = startNode;\n      var findSibling = function (node, startName, siblingName, shallow) {\n        var sibling, parent;\n        if (node) {\n          if (!shallow && node[startName]) {\n            return node[startName];\n          }\n          if (node !== rootNode) {\n            sibling = node[siblingName];\n            if (sibling) {\n              return sibling;\n            }\n            for (parent = node.parentNode; parent && parent !== rootNode; parent = parent.parentNode) {\n              sibling = parent[siblingName];\n              if (sibling) {\n                return sibling;\n              }\n            }\n          }\n        }\n      };\n      var findPreviousNode = function (node, startName, siblingName, shallow) {\n        var sibling, parent, child;\n        if (node) {\n          sibling = node[siblingName];\n          if (rootNode && sibling === rootNode) {\n            return;\n          }\n          if (sibling) {\n            if (!shallow) {\n              for (child = sibling[startName]; child; child = child[startName]) {\n                if (!child[startName]) {\n                  return child;\n                }\n              }\n            }\n            return sibling;\n          }\n          parent = node.parentNode;\n          if (parent && parent !== rootNode) {\n            return parent;\n          }\n        }\n      };\n      this.current = function () {\n        return node;\n      };\n      this.next = function (shallow) {\n        node = findSibling(node, 'firstChild', 'nextSibling', shallow);\n        return node;\n      };\n      this.prev = function (shallow) {\n        node = findSibling(node, 'lastChild', 'previousSibling', shallow);\n        return node;\n      };\n      this.prev2 = function (shallow) {\n        node = findPreviousNode(node, 'lastChild', 'previousSibling', shallow);\n        return node;\n      };\n    }\n\n    var blocks = [\n      'article',\n      'aside',\n      'details',\n      'div',\n      'dt',\n      'figcaption',\n      'footer',\n      'form',\n      'fieldset',\n      'header',\n      'hgroup',\n      'html',\n      'main',\n      'nav',\n      'section',\n      'summary',\n      'body',\n      'p',\n      'dl',\n      'multicol',\n      'dd',\n      'figure',\n      'address',\n      'center',\n      'blockquote',\n      'h1',\n      'h2',\n      'h3',\n      'h4',\n      'h5',\n      'h6',\n      'listing',\n      'xmp',\n      'pre',\n      'plaintext',\n      'menu',\n      'dir',\n      'ul',\n      'ol',\n      'li',\n      'hr',\n      'table',\n      'tbody',\n      'thead',\n      'tfoot',\n      'th',\n      'tr',\n      'td',\n      'caption'\n    ];\n    var voids = [\n      'area',\n      'base',\n      'basefont',\n      'br',\n      'col',\n      'frame',\n      'hr',\n      'img',\n      'input',\n      'isindex',\n      'link',\n      'meta',\n      'param',\n      'embed',\n      'source',\n      'wbr',\n      'track'\n    ];\n    var tableCells = [\n      'td',\n      'th'\n    ];\n    var tableSections = [\n      'thead',\n      'tbody',\n      'tfoot'\n    ];\n    var textBlocks = [\n      'h1',\n      'h2',\n      'h3',\n      'h4',\n      'h5',\n      'h6',\n      'p',\n      'div',\n      'address',\n      'pre',\n      'form',\n      'blockquote',\n      'center',\n      'dir',\n      'fieldset',\n      'header',\n      'footer',\n      'article',\n      'section',\n      'hgroup',\n      'aside',\n      'nav',\n      'figure'\n    ];\n    var headings = [\n      'h1',\n      'h2',\n      'h3',\n      'h4',\n      'h5',\n      'h6'\n    ];\n    var listItems = [\n      'li',\n      'dd',\n      'dt'\n    ];\n    var lists = [\n      'ul',\n      'ol',\n      'dl'\n    ];\n    var wsElements = [\n      'pre',\n      'script',\n      'textarea',\n      'style'\n    ];\n    var lazyLookup = function (items) {\n      var lookup;\n      return function (node) {\n        lookup = lookup ? lookup : mapToObject(items, constant(true));\n        return lookup.hasOwnProperty(name(node));\n      };\n    };\n    var isHeading = lazyLookup(headings);\n    var isBlock = lazyLookup(blocks);\n    var isInline = function (node) {\n      return isElement(node) && !isBlock(node);\n    };\n    var isBr = function (node) {\n      return isElement(node) && name(node) === 'br';\n    };\n    var isTextBlock = lazyLookup(textBlocks);\n    var isList = lazyLookup(lists);\n    var isListItem = lazyLookup(listItems);\n    var isVoid = lazyLookup(voids);\n    var isTableSection = lazyLookup(tableSections);\n    var isTableCell = lazyLookup(tableCells);\n    var isWsPreserveElement = lazyLookup(wsElements);\n\n    var isNodeType = function (type) {\n      return function (node) {\n        return !!node && node.nodeType === type;\n      };\n    };\n    var isRestrictedNode = function (node) {\n      return !!node && !Object.getPrototypeOf(node);\n    };\n    var isElement$1 = isNodeType(1);\n    var matchNodeNames = function (names) {\n      var items = names.toLowerCase().split(' ');\n      return function (node) {\n        var i, name;\n        if (node && node.nodeType) {\n          name = node.nodeName.toLowerCase();\n          for (i = 0; i < items.length; i++) {\n            if (name === items[i]) {\n              return true;\n            }\n          }\n        }\n        return false;\n      };\n    };\n    var matchStyleValues = function (name, values) {\n      var items = values.toLowerCase().split(' ');\n      return function (node) {\n        var i, cssValue;\n        if (isElement$1(node)) {\n          for (i = 0; i < items.length; i++) {\n            var computed = node.ownerDocument.defaultView.getComputedStyle(node, null);\n            cssValue = computed ? computed.getPropertyValue(name) : null;\n            if (cssValue === items[i]) {\n              return true;\n            }\n          }\n        }\n        return false;\n      };\n    };\n    var hasPropValue = function (propName, propValue) {\n      return function (node) {\n        return isElement$1(node) && node[propName] === propValue;\n      };\n    };\n    var hasAttribute = function (attrName, attrValue) {\n      return function (node) {\n        return isElement$1(node) && node.hasAttribute(attrName);\n      };\n    };\n    var hasAttributeValue = function (attrName, attrValue) {\n      return function (node) {\n        return isElement$1(node) && node.getAttribute(attrName) === attrValue;\n      };\n    };\n    var isBogus = function (node) {\n      return isElement$1(node) && node.hasAttribute('data-mce-bogus');\n    };\n    var isBogusAll = function (node) {\n      return isElement$1(node) && node.getAttribute('data-mce-bogus') === 'all';\n    };\n    var isTable = function (node) {\n      return isElement$1(node) && node.tagName === 'TABLE';\n    };\n    var hasContentEditableState = function (value) {\n      return function (node) {\n        if (isElement$1(node)) {\n          if (node.contentEditable === value) {\n            return true;\n          }\n          if (node.getAttribute('data-mce-contenteditable') === value) {\n            return true;\n          }\n        }\n        return false;\n      };\n    };\n    var isText$1 = isNodeType(3);\n    var isComment = isNodeType(8);\n    var isDocument = isNodeType(9);\n    var isDocumentFragment = isNodeType(11);\n    var isBr$1 = matchNodeNames('br');\n    var isContentEditableTrue = hasContentEditableState('true');\n    var isContentEditableFalse = hasContentEditableState('false');\n    var NodeType = {\n      isText: isText$1,\n      isElement: isElement$1,\n      isComment: isComment,\n      isDocument: isDocument,\n      isDocumentFragment: isDocumentFragment,\n      isBr: isBr$1,\n      isContentEditableTrue: isContentEditableTrue,\n      isContentEditableFalse: isContentEditableFalse,\n      isRestrictedNode: isRestrictedNode,\n      matchNodeNames: matchNodeNames,\n      hasPropValue: hasPropValue,\n      hasAttribute: hasAttribute,\n      hasAttributeValue: hasAttributeValue,\n      matchStyleValues: matchStyleValues,\n      isBogus: isBogus,\n      isBogusAll: isBogusAll,\n      isTable: isTable\n    };\n\n    var surroundedBySpans = function (node) {\n      var previousIsSpan = node.previousSibling && node.previousSibling.nodeName === 'SPAN';\n      var nextIsSpan = node.nextSibling && node.nextSibling.nodeName === 'SPAN';\n      return previousIsSpan && nextIsSpan;\n    };\n    var isBookmarkNode = function (node) {\n      return node && node.tagName === 'SPAN' && node.getAttribute('data-mce-type') === 'bookmark';\n    };\n    var trimNode = function (dom, node) {\n      var i, children = node.childNodes;\n      if (NodeType.isElement(node) && isBookmarkNode(node)) {\n        return;\n      }\n      for (i = children.length - 1; i >= 0; i--) {\n        trimNode(dom, children[i]);\n      }\n      if (NodeType.isDocument(node) === false) {\n        if (NodeType.isText(node) && node.nodeValue.length > 0) {\n          var trimmedLength = Tools.trim(node.nodeValue).length;\n          if (dom.isBlock(node.parentNode) || trimmedLength > 0) {\n            return;\n          }\n          if (trimmedLength === 0 && surroundedBySpans(node)) {\n            return;\n          }\n        } else if (NodeType.isElement(node)) {\n          children = node.childNodes;\n          if (children.length === 1 && isBookmarkNode(children[0])) {\n            node.parentNode.insertBefore(children[0], node);\n          }\n          if (children.length || isVoid(Element.fromDom(node))) {\n            return;\n          }\n        }\n        dom.remove(node);\n      }\n      return node;\n    };\n    var TrimNode = { trimNode: trimNode };\n\n    var makeMap$1 = Tools.makeMap;\n    var namedEntities, baseEntities, reverseEntities;\n    var attrsCharsRegExp = /[&<>\\\"\\u0060\\u007E-\\uD7FF\\uE000-\\uFFEF]|[\\uD800-\\uDBFF][\\uDC00-\\uDFFF]/g;\n    var textCharsRegExp = /[<>&\\u007E-\\uD7FF\\uE000-\\uFFEF]|[\\uD800-\\uDBFF][\\uDC00-\\uDFFF]/g;\n    var rawCharsRegExp = /[<>&\\\"\\']/g;\n    var entityRegExp = /&#([a-z0-9]+);?|&([a-z0-9]+);/gi;\n    var asciiMap = {\n      128: '\\u20AC',\n      130: '\\u201A',\n      131: '\\u0192',\n      132: '\\u201E',\n      133: '\\u2026',\n      134: '\\u2020',\n      135: '\\u2021',\n      136: '\\u02c6',\n      137: '\\u2030',\n      138: '\\u0160',\n      139: '\\u2039',\n      140: '\\u0152',\n      142: '\\u017d',\n      145: '\\u2018',\n      146: '\\u2019',\n      147: '\\u201C',\n      148: '\\u201D',\n      149: '\\u2022',\n      150: '\\u2013',\n      151: '\\u2014',\n      152: '\\u02DC',\n      153: '\\u2122',\n      154: '\\u0161',\n      155: '\\u203A',\n      156: '\\u0153',\n      158: '\\u017e',\n      159: '\\u0178'\n    };\n    baseEntities = {\n      '\"': '&quot;',\n      '\\'': '&#39;',\n      '<': '&lt;',\n      '>': '&gt;',\n      '&': '&amp;',\n      '`': '&#96;'\n    };\n    reverseEntities = {\n      '&lt;': '<',\n      '&gt;': '>',\n      '&amp;': '&',\n      '&quot;': '\"',\n      '&apos;': '\\''\n    };\n    var nativeDecode = function (text) {\n      var elm;\n      elm = Element.fromTag('div').dom();\n      elm.innerHTML = text;\n      return elm.textContent || elm.innerText || text;\n    };\n    var buildEntitiesLookup = function (items, radix) {\n      var i, chr, entity;\n      var lookup = {};\n      if (items) {\n        items = items.split(',');\n        radix = radix || 10;\n        for (i = 0; i < items.length; i += 2) {\n          chr = String.fromCharCode(parseInt(items[i], radix));\n          if (!baseEntities[chr]) {\n            entity = '&' + items[i + 1] + ';';\n            lookup[chr] = entity;\n            lookup[entity] = chr;\n          }\n        }\n        return lookup;\n      }\n    };\n    namedEntities = buildEntitiesLookup('50,nbsp,51,iexcl,52,cent,53,pound,54,curren,55,yen,56,brvbar,57,sect,58,uml,59,copy,' + '5a,ordf,5b,laquo,5c,not,5d,shy,5e,reg,5f,macr,5g,deg,5h,plusmn,5i,sup2,5j,sup3,5k,acute,' + '5l,micro,5m,para,5n,middot,5o,cedil,5p,sup1,5q,ordm,5r,raquo,5s,frac14,5t,frac12,5u,frac34,' + '5v,iquest,60,Agrave,61,Aacute,62,Acirc,63,Atilde,64,Auml,65,Aring,66,AElig,67,Ccedil,' + '68,Egrave,69,Eacute,6a,Ecirc,6b,Euml,6c,Igrave,6d,Iacute,6e,Icirc,6f,Iuml,6g,ETH,6h,Ntilde,' + '6i,Ograve,6j,Oacute,6k,Ocirc,6l,Otilde,6m,Ouml,6n,times,6o,Oslash,6p,Ugrave,6q,Uacute,' + '6r,Ucirc,6s,Uuml,6t,Yacute,6u,THORN,6v,szlig,70,agrave,71,aacute,72,acirc,73,atilde,74,auml,' + '75,aring,76,aelig,77,ccedil,78,egrave,79,eacute,7a,ecirc,7b,euml,7c,igrave,7d,iacute,7e,icirc,' + '7f,iuml,7g,eth,7h,ntilde,7i,ograve,7j,oacute,7k,ocirc,7l,otilde,7m,ouml,7n,divide,7o,oslash,' + '7p,ugrave,7q,uacute,7r,ucirc,7s,uuml,7t,yacute,7u,thorn,7v,yuml,ci,fnof,sh,Alpha,si,Beta,' + 'sj,Gamma,sk,Delta,sl,Epsilon,sm,Zeta,sn,Eta,so,Theta,sp,Iota,sq,Kappa,sr,Lambda,ss,Mu,' + 'st,Nu,su,Xi,sv,Omicron,t0,Pi,t1,Rho,t3,Sigma,t4,Tau,t5,Upsilon,t6,Phi,t7,Chi,t8,Psi,' + 't9,Omega,th,alpha,ti,beta,tj,gamma,tk,delta,tl,epsilon,tm,zeta,tn,eta,to,theta,tp,iota,' + 'tq,kappa,tr,lambda,ts,mu,tt,nu,tu,xi,tv,omicron,u0,pi,u1,rho,u2,sigmaf,u3,sigma,u4,tau,' + 'u5,upsilon,u6,phi,u7,chi,u8,psi,u9,omega,uh,thetasym,ui,upsih,um,piv,812,bull,816,hellip,' + '81i,prime,81j,Prime,81u,oline,824,frasl,88o,weierp,88h,image,88s,real,892,trade,89l,alefsym,' + '8cg,larr,8ch,uarr,8ci,rarr,8cj,darr,8ck,harr,8dl,crarr,8eg,lArr,8eh,uArr,8ei,rArr,8ej,dArr,' + '8ek,hArr,8g0,forall,8g2,part,8g3,exist,8g5,empty,8g7,nabla,8g8,isin,8g9,notin,8gb,ni,8gf,prod,' + '8gh,sum,8gi,minus,8gn,lowast,8gq,radic,8gt,prop,8gu,infin,8h0,ang,8h7,and,8h8,or,8h9,cap,8ha,cup,' + '8hb,int,8hk,there4,8hs,sim,8i5,cong,8i8,asymp,8j0,ne,8j1,equiv,8j4,le,8j5,ge,8k2,sub,8k3,sup,8k4,' + 'nsub,8k6,sube,8k7,supe,8kl,oplus,8kn,otimes,8l5,perp,8m5,sdot,8o8,lceil,8o9,rceil,8oa,lfloor,8ob,' + 'rfloor,8p9,lang,8pa,rang,9ea,loz,9j0,spades,9j3,clubs,9j5,hearts,9j6,diams,ai,OElig,aj,oelig,b0,' + 'Scaron,b1,scaron,bo,Yuml,m6,circ,ms,tilde,802,ensp,803,emsp,809,thinsp,80c,zwnj,80d,zwj,80e,lrm,' + '80f,rlm,80j,ndash,80k,mdash,80o,lsquo,80p,rsquo,80q,sbquo,80s,ldquo,80t,rdquo,80u,bdquo,810,dagger,' + '811,Dagger,81g,permil,81p,lsaquo,81q,rsaquo,85c,euro', 32);\n    var encodeRaw = function (text, attr) {\n      return text.replace(attr ? attrsCharsRegExp : textCharsRegExp, function (chr) {\n        return baseEntities[chr] || chr;\n      });\n    };\n    var encodeAllRaw = function (text) {\n      return ('' + text).replace(rawCharsRegExp, function (chr) {\n        return baseEntities[chr] || chr;\n      });\n    };\n    var encodeNumeric = function (text, attr) {\n      return text.replace(attr ? attrsCharsRegExp : textCharsRegExp, function (chr) {\n        if (chr.length > 1) {\n          return '&#' + ((chr.charCodeAt(0) - 55296) * 1024 + (chr.charCodeAt(1) - 56320) + 65536) + ';';\n        }\n        return baseEntities[chr] || '&#' + chr.charCodeAt(0) + ';';\n      });\n    };\n    var encodeNamed = function (text, attr, entities) {\n      entities = entities || namedEntities;\n      return text.replace(attr ? attrsCharsRegExp : textCharsRegExp, function (chr) {\n        return baseEntities[chr] || entities[chr] || chr;\n      });\n    };\n    var getEncodeFunc = function (name, entities) {\n      var entitiesMap = buildEntitiesLookup(entities) || namedEntities;\n      var encodeNamedAndNumeric = function (text, attr) {\n        return text.replace(attr ? attrsCharsRegExp : textCharsRegExp, function (chr) {\n          if (baseEntities[chr] !== undefined) {\n            return baseEntities[chr];\n          }\n          if (entitiesMap[chr] !== undefined) {\n            return entitiesMap[chr];\n          }\n          if (chr.length > 1) {\n            return '&#' + ((chr.charCodeAt(0) - 55296) * 1024 + (chr.charCodeAt(1) - 56320) + 65536) + ';';\n          }\n          return '&#' + chr.charCodeAt(0) + ';';\n        });\n      };\n      var encodeCustomNamed = function (text, attr) {\n        return encodeNamed(text, attr, entitiesMap);\n      };\n      var nameMap = makeMap$1(name.replace(/\\+/g, ','));\n      if (nameMap.named && nameMap.numeric) {\n        return encodeNamedAndNumeric;\n      }\n      if (nameMap.named) {\n        if (entities) {\n          return encodeCustomNamed;\n        }\n        return encodeNamed;\n      }\n      if (nameMap.numeric) {\n        return encodeNumeric;\n      }\n      return encodeRaw;\n    };\n    var decode = function (text) {\n      return text.replace(entityRegExp, function (all, numeric) {\n        if (numeric) {\n          if (numeric.charAt(0).toLowerCase() === 'x') {\n            numeric = parseInt(numeric.substr(1), 16);\n          } else {\n            numeric = parseInt(numeric, 10);\n          }\n          if (numeric > 65535) {\n            numeric -= 65536;\n            return String.fromCharCode(55296 + (numeric >> 10), 56320 + (numeric & 1023));\n          }\n          return asciiMap[numeric] || String.fromCharCode(numeric);\n        }\n        return reverseEntities[all] || namedEntities[all] || nativeDecode(all);\n      });\n    };\n    var Entities = {\n      encodeRaw: encodeRaw,\n      encodeAllRaw: encodeAllRaw,\n      encodeNumeric: encodeNumeric,\n      encodeNamed: encodeNamed,\n      getEncodeFunc: getEncodeFunc,\n      decode: decode\n    };\n\n    var mapCache = {}, dummyObj = {};\n    var makeMap$2 = Tools.makeMap, each$4 = Tools.each, extend$1 = Tools.extend, explode$1 = Tools.explode, inArray$1 = Tools.inArray;\n    var split = function (items, delim) {\n      items = Tools.trim(items);\n      return items ? items.split(delim || ' ') : [];\n    };\n    var compileSchema = function (type) {\n      var schema = {};\n      var globalAttributes, blockContent;\n      var phrasingContent, flowContent, html4BlockContent, html4PhrasingContent;\n      var add = function (name, attributes, children) {\n        var ni, attributesOrder, element;\n        var arrayToMap = function (array, obj) {\n          var map = {};\n          var i, l;\n          for (i = 0, l = array.length; i < l; i++) {\n            map[array[i]] = obj || {};\n          }\n          return map;\n        };\n        children = children || [];\n        attributes = attributes || '';\n        if (typeof children === 'string') {\n          children = split(children);\n        }\n        name = split(name);\n        ni = name.length;\n        while (ni--) {\n          attributesOrder = split([\n            globalAttributes,\n            attributes\n          ].join(' '));\n          element = {\n            attributes: arrayToMap(attributesOrder),\n            attributesOrder: attributesOrder,\n            children: arrayToMap(children, dummyObj)\n          };\n          schema[name[ni]] = element;\n        }\n      };\n      var addAttrs = function (name, attributes) {\n        var ni, schemaItem, i, l;\n        name = split(name);\n        ni = name.length;\n        attributes = split(attributes);\n        while (ni--) {\n          schemaItem = schema[name[ni]];\n          for (i = 0, l = attributes.length; i < l; i++) {\n            schemaItem.attributes[attributes[i]] = {};\n            schemaItem.attributesOrder.push(attributes[i]);\n          }\n        }\n      };\n      if (mapCache[type]) {\n        return mapCache[type];\n      }\n      globalAttributes = 'id accesskey class dir lang style tabindex title role';\n      blockContent = 'address blockquote div dl fieldset form h1 h2 h3 h4 h5 h6 hr menu ol p pre table ul';\n      phrasingContent = 'a abbr b bdo br button cite code del dfn em embed i iframe img input ins kbd ' + 'label map noscript object q s samp script select small span strong sub sup ' + 'textarea u var #text #comment';\n      if (type !== 'html4') {\n        globalAttributes += ' contenteditable contextmenu draggable dropzone ' + 'hidden spellcheck translate';\n        blockContent += ' article aside details dialog figure main header footer hgroup section nav';\n        phrasingContent += ' audio canvas command datalist mark meter output picture ' + 'progress time wbr video ruby bdi keygen';\n      }\n      if (type !== 'html5-strict') {\n        globalAttributes += ' xml:lang';\n        html4PhrasingContent = 'acronym applet basefont big font strike tt';\n        phrasingContent = [\n          phrasingContent,\n          html4PhrasingContent\n        ].join(' ');\n        each$4(split(html4PhrasingContent), function (name) {\n          add(name, '', phrasingContent);\n        });\n        html4BlockContent = 'center dir isindex noframes';\n        blockContent = [\n          blockContent,\n          html4BlockContent\n        ].join(' ');\n        flowContent = [\n          blockContent,\n          phrasingContent\n        ].join(' ');\n        each$4(split(html4BlockContent), function (name) {\n          add(name, '', flowContent);\n        });\n      }\n      flowContent = flowContent || [\n        blockContent,\n        phrasingContent\n      ].join(' ');\n      add('html', 'manifest', 'head body');\n      add('head', '', 'base command link meta noscript script style title');\n      add('title hr noscript br');\n      add('base', 'href target');\n      add('link', 'href rel media hreflang type sizes hreflang');\n      add('meta', 'name http-equiv content charset');\n      add('style', 'media type scoped');\n      add('script', 'src async defer type charset');\n      add('body', 'onafterprint onbeforeprint onbeforeunload onblur onerror onfocus ' + 'onhashchange onload onmessage onoffline ononline onpagehide onpageshow ' + 'onpopstate onresize onscroll onstorage onunload', flowContent);\n      add('address dt dd div caption', '', flowContent);\n      add('h1 h2 h3 h4 h5 h6 pre p abbr code var samp kbd sub sup i b u bdo span legend em strong small s cite dfn', '', phrasingContent);\n      add('blockquote', 'cite', flowContent);\n      add('ol', 'reversed start type', 'li');\n      add('ul', '', 'li');\n      add('li', 'value', flowContent);\n      add('dl', '', 'dt dd');\n      add('a', 'href target rel media hreflang type', phrasingContent);\n      add('q', 'cite', phrasingContent);\n      add('ins del', 'cite datetime', flowContent);\n      add('img', 'src sizes srcset alt usemap ismap width height');\n      add('iframe', 'src name width height', flowContent);\n      add('embed', 'src type width height');\n      add('object', 'data type typemustmatch name usemap form width height', [\n        flowContent,\n        'param'\n      ].join(' '));\n      add('param', 'name value');\n      add('map', 'name', [\n        flowContent,\n        'area'\n      ].join(' '));\n      add('area', 'alt coords shape href target rel media hreflang type');\n      add('table', 'border', 'caption colgroup thead tfoot tbody tr' + (type === 'html4' ? ' col' : ''));\n      add('colgroup', 'span', 'col');\n      add('col', 'span');\n      add('tbody thead tfoot', '', 'tr');\n      add('tr', '', 'td th');\n      add('td', 'colspan rowspan headers', flowContent);\n      add('th', 'colspan rowspan headers scope abbr', flowContent);\n      add('form', 'accept-charset action autocomplete enctype method name novalidate target', flowContent);\n      add('fieldset', 'disabled form name', [\n        flowContent,\n        'legend'\n      ].join(' '));\n      add('label', 'form for', phrasingContent);\n      add('input', 'accept alt autocomplete checked dirname disabled form formaction formenctype formmethod formnovalidate ' + 'formtarget height list max maxlength min multiple name pattern readonly required size src step type value width');\n      add('button', 'disabled form formaction formenctype formmethod formnovalidate formtarget name type value', type === 'html4' ? flowContent : phrasingContent);\n      add('select', 'disabled form multiple name required size', 'option optgroup');\n      add('optgroup', 'disabled label', 'option');\n      add('option', 'disabled label selected value');\n      add('textarea', 'cols dirname disabled form maxlength name readonly required rows wrap');\n      add('menu', 'type label', [\n        flowContent,\n        'li'\n      ].join(' '));\n      add('noscript', '', flowContent);\n      if (type !== 'html4') {\n        add('wbr');\n        add('ruby', '', [\n          phrasingContent,\n          'rt rp'\n        ].join(' '));\n        add('figcaption', '', flowContent);\n        add('mark rt rp summary bdi', '', phrasingContent);\n        add('canvas', 'width height', flowContent);\n        add('video', 'src crossorigin poster preload autoplay mediagroup loop ' + 'muted controls width height buffered', [\n          flowContent,\n          'track source'\n        ].join(' '));\n        add('audio', 'src crossorigin preload autoplay mediagroup loop muted controls ' + 'buffered volume', [\n          flowContent,\n          'track source'\n        ].join(' '));\n        add('picture', '', 'img source');\n        add('source', 'src srcset type media sizes');\n        add('track', 'kind src srclang label default');\n        add('datalist', '', [\n          phrasingContent,\n          'option'\n        ].join(' '));\n        add('article section nav aside main header footer', '', flowContent);\n        add('hgroup', '', 'h1 h2 h3 h4 h5 h6');\n        add('figure', '', [\n          flowContent,\n          'figcaption'\n        ].join(' '));\n        add('time', 'datetime', phrasingContent);\n        add('dialog', 'open', flowContent);\n        add('command', 'type label icon disabled checked radiogroup command');\n        add('output', 'for form name', phrasingContent);\n        add('progress', 'value max', phrasingContent);\n        add('meter', 'value min max low high optimum', phrasingContent);\n        add('details', 'open', [\n          flowContent,\n          'summary'\n        ].join(' '));\n        add('keygen', 'autofocus challenge disabled form keytype name');\n      }\n      if (type !== 'html5-strict') {\n        addAttrs('script', 'language xml:space');\n        addAttrs('style', 'xml:space');\n        addAttrs('object', 'declare classid code codebase codetype archive standby align border hspace vspace');\n        addAttrs('embed', 'align name hspace vspace');\n        addAttrs('param', 'valuetype type');\n        addAttrs('a', 'charset name rev shape coords');\n        addAttrs('br', 'clear');\n        addAttrs('applet', 'codebase archive code object alt name width height align hspace vspace');\n        addAttrs('img', 'name longdesc align border hspace vspace');\n        addAttrs('iframe', 'longdesc frameborder marginwidth marginheight scrolling align');\n        addAttrs('font basefont', 'size color face');\n        addAttrs('input', 'usemap align');\n        addAttrs('select', 'onchange');\n        addAttrs('textarea');\n        addAttrs('h1 h2 h3 h4 h5 h6 div p legend caption', 'align');\n        addAttrs('ul', 'type compact');\n        addAttrs('li', 'type');\n        addAttrs('ol dl menu dir', 'compact');\n        addAttrs('pre', 'width xml:space');\n        addAttrs('hr', 'align noshade size width');\n        addAttrs('isindex', 'prompt');\n        addAttrs('table', 'summary width frame rules cellspacing cellpadding align bgcolor');\n        addAttrs('col', 'width align char charoff valign');\n        addAttrs('colgroup', 'width align char charoff valign');\n        addAttrs('thead', 'align char charoff valign');\n        addAttrs('tr', 'align char charoff valign bgcolor');\n        addAttrs('th', 'axis align char charoff valign nowrap bgcolor width height');\n        addAttrs('form', 'accept');\n        addAttrs('td', 'abbr axis scope align char charoff valign nowrap bgcolor width height');\n        addAttrs('tfoot', 'align char charoff valign');\n        addAttrs('tbody', 'align char charoff valign');\n        addAttrs('area', 'nohref');\n        addAttrs('body', 'background bgcolor text link vlink alink');\n      }\n      if (type !== 'html4') {\n        addAttrs('input button select textarea', 'autofocus');\n        addAttrs('input textarea', 'placeholder');\n        addAttrs('a', 'download');\n        addAttrs('link script img', 'crossorigin');\n        addAttrs('iframe', 'sandbox seamless allowfullscreen');\n      }\n      each$4(split('a form meter progress dfn'), function (name) {\n        if (schema[name]) {\n          delete schema[name].children[name];\n        }\n      });\n      delete schema.caption.children.table;\n      delete schema.script;\n      mapCache[type] = schema;\n      return schema;\n    };\n    var compileElementMap = function (value, mode) {\n      var styles;\n      if (value) {\n        styles = {};\n        if (typeof value === 'string') {\n          value = { '*': value };\n        }\n        each$4(value, function (value, key) {\n          styles[key] = styles[key.toUpperCase()] = mode === 'map' ? makeMap$2(value, /[, ]/) : explode$1(value, /[, ]/);\n        });\n      }\n      return styles;\n    };\n    function Schema(settings) {\n      var elements = {};\n      var children = {};\n      var patternElements = [];\n      var validStyles;\n      var invalidStyles;\n      var schemaItems;\n      var whiteSpaceElementsMap, selfClosingElementsMap, shortEndedElementsMap, boolAttrMap, validClasses;\n      var blockElementsMap, nonEmptyElementsMap, moveCaretBeforeOnEnterElementsMap, textBlockElementsMap, textInlineElementsMap;\n      var customElementsMap = {}, specialElements = {};\n      var createLookupTable = function (option, defaultValue, extendWith) {\n        var value = settings[option];\n        if (!value) {\n          value = mapCache[option];\n          if (!value) {\n            value = makeMap$2(defaultValue, ' ', makeMap$2(defaultValue.toUpperCase(), ' '));\n            value = extend$1(value, extendWith);\n            mapCache[option] = value;\n          }\n        } else {\n          value = makeMap$2(value, /[, ]/, makeMap$2(value.toUpperCase(), /[, ]/));\n        }\n        return value;\n      };\n      settings = settings || {};\n      schemaItems = compileSchema(settings.schema);\n      if (settings.verify_html === false) {\n        settings.valid_elements = '*[*]';\n      }\n      validStyles = compileElementMap(settings.valid_styles);\n      invalidStyles = compileElementMap(settings.invalid_styles, 'map');\n      validClasses = compileElementMap(settings.valid_classes, 'map');\n      whiteSpaceElementsMap = createLookupTable('whitespace_elements', 'pre script noscript style textarea video audio iframe object code');\n      selfClosingElementsMap = createLookupTable('self_closing_elements', 'colgroup dd dt li option p td tfoot th thead tr');\n      shortEndedElementsMap = createLookupTable('short_ended_elements', 'area base basefont br col frame hr img input isindex link ' + 'meta param embed source wbr track');\n      boolAttrMap = createLookupTable('boolean_attributes', 'checked compact declare defer disabled ismap multiple nohref noresize ' + 'noshade nowrap readonly selected autoplay loop controls');\n      nonEmptyElementsMap = createLookupTable('non_empty_elements', 'td th iframe video audio object ' + 'script pre code', shortEndedElementsMap);\n      moveCaretBeforeOnEnterElementsMap = createLookupTable('move_caret_before_on_enter_elements', 'table', nonEmptyElementsMap);\n      textBlockElementsMap = createLookupTable('text_block_elements', 'h1 h2 h3 h4 h5 h6 p div address pre form ' + 'blockquote center dir fieldset header footer article section hgroup aside main nav figure');\n      blockElementsMap = createLookupTable('block_elements', 'hr table tbody thead tfoot ' + 'th tr td li ol ul caption dl dt dd noscript menu isindex option ' + 'datalist select optgroup figcaption details summary', textBlockElementsMap);\n      textInlineElementsMap = createLookupTable('text_inline_elements', 'span strong b em i font strike u var cite ' + 'dfn code mark q sup sub samp');\n      each$4((settings.special || 'script noscript iframe noframes noembed title style textarea xmp').split(' '), function (name) {\n        specialElements[name] = new RegExp('</' + name + '[^>]*>', 'gi');\n      });\n      var patternToRegExp = function (str) {\n        return new RegExp('^' + str.replace(/([?+*])/g, '.$1') + '$');\n      };\n      var addValidElements = function (validElements) {\n        var ei, el, ai, al, matches, element, attr, attrData, elementName, attrName, attrType, attributes, attributesOrder, prefix, outputName, globalAttributes, globalAttributesOrder, key, value;\n        var elementRuleRegExp = /^([#+\\-])?([^\\[!\\/]+)(?:\\/([^\\[!]+))?(?:(!?)\\[([^\\]]+)\\])?$/, attrRuleRegExp = /^([!\\-])?(\\w+[\\\\:]:\\w+|[^=:<]+)?(?:([=:<])(.*))?$/, hasPatternsRegExp = /[*?+]/;\n        if (validElements) {\n          validElements = split(validElements, ',');\n          if (elements['@']) {\n            globalAttributes = elements['@'].attributes;\n            globalAttributesOrder = elements['@'].attributesOrder;\n          }\n          for (ei = 0, el = validElements.length; ei < el; ei++) {\n            matches = elementRuleRegExp.exec(validElements[ei]);\n            if (matches) {\n              prefix = matches[1];\n              elementName = matches[2];\n              outputName = matches[3];\n              attrData = matches[5];\n              attributes = {};\n              attributesOrder = [];\n              element = {\n                attributes: attributes,\n                attributesOrder: attributesOrder\n              };\n              if (prefix === '#') {\n                element.paddEmpty = true;\n              }\n              if (prefix === '-') {\n                element.removeEmpty = true;\n              }\n              if (matches[4] === '!') {\n                element.removeEmptyAttrs = true;\n              }\n              if (globalAttributes) {\n                for (key in globalAttributes) {\n                  attributes[key] = globalAttributes[key];\n                }\n                attributesOrder.push.apply(attributesOrder, globalAttributesOrder);\n              }\n              if (attrData) {\n                attrData = split(attrData, '|');\n                for (ai = 0, al = attrData.length; ai < al; ai++) {\n                  matches = attrRuleRegExp.exec(attrData[ai]);\n                  if (matches) {\n                    attr = {};\n                    attrType = matches[1];\n                    attrName = matches[2].replace(/[\\\\:]:/g, ':');\n                    prefix = matches[3];\n                    value = matches[4];\n                    if (attrType === '!') {\n                      element.attributesRequired = element.attributesRequired || [];\n                      element.attributesRequired.push(attrName);\n                      attr.required = true;\n                    }\n                    if (attrType === '-') {\n                      delete attributes[attrName];\n                      attributesOrder.splice(inArray$1(attributesOrder, attrName), 1);\n                      continue;\n                    }\n                    if (prefix) {\n                      if (prefix === '=') {\n                        element.attributesDefault = element.attributesDefault || [];\n                        element.attributesDefault.push({\n                          name: attrName,\n                          value: value\n                        });\n                        attr.defaultValue = value;\n                      }\n                      if (prefix === ':') {\n                        element.attributesForced = element.attributesForced || [];\n                        element.attributesForced.push({\n                          name: attrName,\n                          value: value\n                        });\n                        attr.forcedValue = value;\n                      }\n                      if (prefix === '<') {\n                        attr.validValues = makeMap$2(value, '?');\n                      }\n                    }\n                    if (hasPatternsRegExp.test(attrName)) {\n                      element.attributePatterns = element.attributePatterns || [];\n                      attr.pattern = patternToRegExp(attrName);\n                      element.attributePatterns.push(attr);\n                    } else {\n                      if (!attributes[attrName]) {\n                        attributesOrder.push(attrName);\n                      }\n                      attributes[attrName] = attr;\n                    }\n                  }\n                }\n              }\n              if (!globalAttributes && elementName === '@') {\n                globalAttributes = attributes;\n                globalAttributesOrder = attributesOrder;\n              }\n              if (outputName) {\n                element.outputName = elementName;\n                elements[outputName] = element;\n              }\n              if (hasPatternsRegExp.test(elementName)) {\n                element.pattern = patternToRegExp(elementName);\n                patternElements.push(element);\n              } else {\n                elements[elementName] = element;\n              }\n            }\n          }\n        }\n      };\n      var setValidElements = function (validElements) {\n        elements = {};\n        patternElements = [];\n        addValidElements(validElements);\n        each$4(schemaItems, function (element, name) {\n          children[name] = element.children;\n        });\n      };\n      var addCustomElements = function (customElements) {\n        var customElementRegExp = /^(~)?(.+)$/;\n        if (customElements) {\n          mapCache.text_block_elements = mapCache.block_elements = null;\n          each$4(split(customElements, ','), function (rule) {\n            var matches = customElementRegExp.exec(rule), inline = matches[1] === '~', cloneName = inline ? 'span' : 'div', name = matches[2];\n            children[name] = children[cloneName];\n            customElementsMap[name] = cloneName;\n            if (!inline) {\n              blockElementsMap[name.toUpperCase()] = {};\n              blockElementsMap[name] = {};\n            }\n            if (!elements[name]) {\n              var customRule = elements[cloneName];\n              customRule = extend$1({}, customRule);\n              delete customRule.removeEmptyAttrs;\n              delete customRule.removeEmpty;\n              elements[name] = customRule;\n            }\n            each$4(children, function (element, elmName) {\n              if (element[cloneName]) {\n                children[elmName] = element = extend$1({}, children[elmName]);\n                element[name] = element[cloneName];\n              }\n            });\n          });\n        }\n      };\n      var addValidChildren = function (validChildren) {\n        var childRuleRegExp = /^([+\\-]?)(\\w+)\\[([^\\]]+)\\]$/;\n        mapCache[settings.schema] = null;\n        if (validChildren) {\n          each$4(split(validChildren, ','), function (rule) {\n            var matches = childRuleRegExp.exec(rule);\n            var parent, prefix;\n            if (matches) {\n              prefix = matches[1];\n              if (prefix) {\n                parent = children[matches[2]];\n              } else {\n                parent = children[matches[2]] = { '#comment': {} };\n              }\n              parent = children[matches[2]];\n              each$4(split(matches[3], '|'), function (child) {\n                if (prefix === '-') {\n                  delete parent[child];\n                } else {\n                  parent[child] = {};\n                }\n              });\n            }\n          });\n        }\n      };\n      var getElementRule = function (name) {\n        var element = elements[name], i;\n        if (element) {\n          return element;\n        }\n        i = patternElements.length;\n        while (i--) {\n          element = patternElements[i];\n          if (element.pattern.test(name)) {\n            return element;\n          }\n        }\n      };\n      if (!settings.valid_elements) {\n        each$4(schemaItems, function (element, name) {\n          elements[name] = {\n            attributes: element.attributes,\n            attributesOrder: element.attributesOrder\n          };\n          children[name] = element.children;\n        });\n        if (settings.schema !== 'html5') {\n          each$4(split('strong/b em/i'), function (item) {\n            item = split(item, '/');\n            elements[item[1]].outputName = item[0];\n          });\n        }\n        each$4(split('ol ul sub sup blockquote span font a table tbody tr strong em b i'), function (name) {\n          if (elements[name]) {\n            elements[name].removeEmpty = true;\n          }\n        });\n        each$4(split('p h1 h2 h3 h4 h5 h6 th td pre div address caption li'), function (name) {\n          elements[name].paddEmpty = true;\n        });\n        each$4(split('span'), function (name) {\n          elements[name].removeEmptyAttrs = true;\n        });\n      } else {\n        setValidElements(settings.valid_elements);\n      }\n      addCustomElements(settings.custom_elements);\n      addValidChildren(settings.valid_children);\n      addValidElements(settings.extended_valid_elements);\n      addValidChildren('+ol[ul|ol],+ul[ul|ol]');\n      each$4({\n        dd: 'dl',\n        dt: 'dl',\n        li: 'ul ol',\n        td: 'tr',\n        th: 'tr',\n        tr: 'tbody thead tfoot',\n        tbody: 'table',\n        thead: 'table',\n        tfoot: 'table',\n        legend: 'fieldset',\n        area: 'map',\n        param: 'video audio object'\n      }, function (parents, item) {\n        if (elements[item]) {\n          elements[item].parentsRequired = split(parents);\n        }\n      });\n      if (settings.invalid_elements) {\n        each$4(explode$1(settings.invalid_elements), function (item) {\n          if (elements[item]) {\n            delete elements[item];\n          }\n        });\n      }\n      if (!getElementRule('span')) {\n        addValidElements('span[!data-mce-type|*]');\n      }\n      var getValidStyles = function () {\n        return validStyles;\n      };\n      var getInvalidStyles = function () {\n        return invalidStyles;\n      };\n      var getValidClasses = function () {\n        return validClasses;\n      };\n      var getBoolAttrs = function () {\n        return boolAttrMap;\n      };\n      var getBlockElements = function () {\n        return blockElementsMap;\n      };\n      var getTextBlockElements = function () {\n        return textBlockElementsMap;\n      };\n      var getTextInlineElements = function () {\n        return textInlineElementsMap;\n      };\n      var getShortEndedElements = function () {\n        return shortEndedElementsMap;\n      };\n      var getSelfClosingElements = function () {\n        return selfClosingElementsMap;\n      };\n      var getNonEmptyElements = function () {\n        return nonEmptyElementsMap;\n      };\n      var getMoveCaretBeforeOnEnterElements = function () {\n        return moveCaretBeforeOnEnterElementsMap;\n      };\n      var getWhiteSpaceElements = function () {\n        return whiteSpaceElementsMap;\n      };\n      var getSpecialElements = function () {\n        return specialElements;\n      };\n      var isValidChild = function (name, child) {\n        var parent = children[name.toLowerCase()];\n        return !!(parent && parent[child.toLowerCase()]);\n      };\n      var isValid = function (name, attr) {\n        var attrPatterns, i;\n        var rule = getElementRule(name);\n        if (rule) {\n          if (attr) {\n            if (rule.attributes[attr]) {\n              return true;\n            }\n            attrPatterns = rule.attributePatterns;\n            if (attrPatterns) {\n              i = attrPatterns.length;\n              while (i--) {\n                if (attrPatterns[i].pattern.test(name)) {\n                  return true;\n                }\n              }\n            }\n          } else {\n            return true;\n          }\n        }\n        return false;\n      };\n      var getCustomElements = function () {\n        return customElementsMap;\n      };\n      return {\n        children: children,\n        elements: elements,\n        getValidStyles: getValidStyles,\n        getValidClasses: getValidClasses,\n        getBlockElements: getBlockElements,\n        getInvalidStyles: getInvalidStyles,\n        getShortEndedElements: getShortEndedElements,\n        getTextBlockElements: getTextBlockElements,\n        getTextInlineElements: getTextInlineElements,\n        getBoolAttrs: getBoolAttrs,\n        getElementRule: getElementRule,\n        getSelfClosingElements: getSelfClosingElements,\n        getNonEmptyElements: getNonEmptyElements,\n        getMoveCaretBeforeOnEnterElements: getMoveCaretBeforeOnEnterElements,\n        getWhiteSpaceElements: getWhiteSpaceElements,\n        getSpecialElements: getSpecialElements,\n        isValidChild: isValidChild,\n        isValid: isValid,\n        getCustomElements: getCustomElements,\n        addValidElements: addValidElements,\n        setValidElements: setValidElements,\n        addCustomElements: addCustomElements,\n        addValidChildren: addValidChildren\n      };\n    }\n\n    var toHex = function (match, r, g, b) {\n      var hex = function (val) {\n        val = parseInt(val, 10).toString(16);\n        return val.length > 1 ? val : '0' + val;\n      };\n      return '#' + hex(r) + hex(g) + hex(b);\n    };\n    function Styles(settings, schema) {\n      var rgbRegExp = /rgb\\s*\\(\\s*([0-9]+)\\s*,\\s*([0-9]+)\\s*,\\s*([0-9]+)\\s*\\)/gi;\n      var urlOrStrRegExp = /(?:url(?:(?:\\(\\s*\\\"([^\\\"]+)\\\"\\s*\\))|(?:\\(\\s*\\'([^\\']+)\\'\\s*\\))|(?:\\(\\s*([^)\\s]+)\\s*\\))))|(?:\\'([^\\']+)\\')|(?:\\\"([^\\\"]+)\\\")/gi;\n      var styleRegExp = /\\s*([^:]+):\\s*([^;]+);?/g;\n      var trimRightRegExp = /\\s+$/;\n      var i;\n      var encodingLookup = {};\n      var encodingItems;\n      var validStyles;\n      var invalidStyles;\n      var invisibleChar = '\\uFEFF';\n      settings = settings || {};\n      if (schema) {\n        validStyles = schema.getValidStyles();\n        invalidStyles = schema.getInvalidStyles();\n      }\n      encodingItems = ('\\\\\" \\\\\\' \\\\; \\\\: ; : ' + invisibleChar).split(' ');\n      for (i = 0; i < encodingItems.length; i++) {\n        encodingLookup[encodingItems[i]] = invisibleChar + i;\n        encodingLookup[invisibleChar + i] = encodingItems[i];\n      }\n      return {\n        toHex: function (color) {\n          return color.replace(rgbRegExp, toHex);\n        },\n        parse: function (css) {\n          var styles = {};\n          var matches, name, value, isEncoded;\n          var urlConverter = settings.url_converter;\n          var urlConverterScope = settings.url_converter_scope || this;\n          var compress = function (prefix, suffix, noJoin) {\n            var top, right, bottom, left;\n            top = styles[prefix + '-top' + suffix];\n            if (!top) {\n              return;\n            }\n            right = styles[prefix + '-right' + suffix];\n            if (!right) {\n              return;\n            }\n            bottom = styles[prefix + '-bottom' + suffix];\n            if (!bottom) {\n              return;\n            }\n            left = styles[prefix + '-left' + suffix];\n            if (!left) {\n              return;\n            }\n            var box = [\n              top,\n              right,\n              bottom,\n              left\n            ];\n            i = box.length - 1;\n            while (i--) {\n              if (box[i] !== box[i + 1]) {\n                break;\n              }\n            }\n            if (i > -1 && noJoin) {\n              return;\n            }\n            styles[prefix + suffix] = i === -1 ? box[0] : box.join(' ');\n            delete styles[prefix + '-top' + suffix];\n            delete styles[prefix + '-right' + suffix];\n            delete styles[prefix + '-bottom' + suffix];\n            delete styles[prefix + '-left' + suffix];\n          };\n          var canCompress = function (key) {\n            var value = styles[key], i;\n            if (!value) {\n              return;\n            }\n            value = value.split(' ');\n            i = value.length;\n            while (i--) {\n              if (value[i] !== value[0]) {\n                return false;\n              }\n            }\n            styles[key] = value[0];\n            return true;\n          };\n          var compress2 = function (target, a, b, c) {\n            if (!canCompress(a)) {\n              return;\n            }\n            if (!canCompress(b)) {\n              return;\n            }\n            if (!canCompress(c)) {\n              return;\n            }\n            styles[target] = styles[a] + ' ' + styles[b] + ' ' + styles[c];\n            delete styles[a];\n            delete styles[b];\n            delete styles[c];\n          };\n          var encode = function (str) {\n            isEncoded = true;\n            return encodingLookup[str];\n          };\n          var decode = function (str, keepSlashes) {\n            if (isEncoded) {\n              str = str.replace(/\\uFEFF[0-9]/g, function (str) {\n                return encodingLookup[str];\n              });\n            }\n            if (!keepSlashes) {\n              str = str.replace(/\\\\([\\'\\\";:])/g, '$1');\n            }\n            return str;\n          };\n          var decodeSingleHexSequence = function (escSeq) {\n            return String.fromCharCode(parseInt(escSeq.slice(1), 16));\n          };\n          var decodeHexSequences = function (value) {\n            return value.replace(/\\\\[0-9a-f]+/gi, decodeSingleHexSequence);\n          };\n          var processUrl = function (match, url, url2, url3, str, str2) {\n            str = str || str2;\n            if (str) {\n              str = decode(str);\n              return '\\'' + str.replace(/\\'/g, '\\\\\\'') + '\\'';\n            }\n            url = decode(url || url2 || url3);\n            if (!settings.allow_script_urls) {\n              var scriptUrl = url.replace(/[\\s\\r\\n]+/g, '');\n              if (/(java|vb)script:/i.test(scriptUrl)) {\n                return '';\n              }\n              if (!settings.allow_svg_data_urls && /^data:image\\/svg/i.test(scriptUrl)) {\n                return '';\n              }\n            }\n            if (urlConverter) {\n              url = urlConverter.call(urlConverterScope, url, 'style');\n            }\n            return 'url(\\'' + url.replace(/\\'/g, '\\\\\\'') + '\\')';\n          };\n          if (css) {\n            css = css.replace(/[\\u0000-\\u001F]/g, '');\n            css = css.replace(/\\\\[\\\"\\';:\\uFEFF]/g, encode).replace(/\\\"[^\\\"]+\\\"|\\'[^\\']+\\'/g, function (str) {\n              return str.replace(/[;:]/g, encode);\n            });\n            while (matches = styleRegExp.exec(css)) {\n              styleRegExp.lastIndex = matches.index + matches[0].length;\n              name = matches[1].replace(trimRightRegExp, '').toLowerCase();\n              value = matches[2].replace(trimRightRegExp, '');\n              if (name && value) {\n                name = decodeHexSequences(name);\n                value = decodeHexSequences(value);\n                if (name.indexOf(invisibleChar) !== -1 || name.indexOf('\"') !== -1) {\n                  continue;\n                }\n                if (!settings.allow_script_urls && (name === 'behavior' || /expression\\s*\\(|\\/\\*|\\*\\//.test(value))) {\n                  continue;\n                }\n                if (name === 'font-weight' && value === '700') {\n                  value = 'bold';\n                } else if (name === 'color' || name === 'background-color') {\n                  value = value.toLowerCase();\n                }\n                value = value.replace(rgbRegExp, toHex);\n                value = value.replace(urlOrStrRegExp, processUrl);\n                styles[name] = isEncoded ? decode(value, true) : value;\n              }\n            }\n            compress('border', '', true);\n            compress('border', '-width');\n            compress('border', '-color');\n            compress('border', '-style');\n            compress('padding', '');\n            compress('margin', '');\n            compress2('border', 'border-width', 'border-style', 'border-color');\n            if (styles.border === 'medium none') {\n              delete styles.border;\n            }\n            if (styles['border-image'] === 'none') {\n              delete styles['border-image'];\n            }\n          }\n          return styles;\n        },\n        serialize: function (styles, elementName) {\n          var css = '', name, value;\n          var serializeStyles = function (name) {\n            var styleList, i, l, value;\n            styleList = validStyles[name];\n            if (styleList) {\n              for (i = 0, l = styleList.length; i < l; i++) {\n                name = styleList[i];\n                value = styles[name];\n                if (value) {\n                  css += (css.length > 0 ? ' ' : '') + name + ': ' + value + ';';\n                }\n              }\n            }\n          };\n          var isValid = function (name, elementName) {\n            var styleMap;\n            styleMap = invalidStyles['*'];\n            if (styleMap && styleMap[name]) {\n              return false;\n            }\n            styleMap = invalidStyles[elementName];\n            if (styleMap && styleMap[name]) {\n              return false;\n            }\n            return true;\n          };\n          if (elementName && validStyles) {\n            serializeStyles('*');\n            serializeStyles(elementName);\n          } else {\n            for (name in styles) {\n              value = styles[name];\n              if (value && (!invalidStyles || isValid(name, elementName))) {\n                css += (css.length > 0 ? ' ' : '') + name + ': ' + value + ';';\n              }\n            }\n          }\n          return css;\n        }\n      };\n    }\n\n    var each$5 = Tools.each;\n    var grep$1 = Tools.grep;\n    var isIE = Env.ie;\n    var simpleSelectorRe = /^([a-z0-9],?)+$/i;\n    var whiteSpaceRegExp$2 = /^[ \\t\\r\\n]*$/;\n    var setupAttrHooks = function (styles, settings, getContext) {\n      var attrHooks = {};\n      var keepValues = settings.keep_values;\n      var keepUrlHook = {\n        set: function ($elm, value, name) {\n          if (settings.url_converter) {\n            value = settings.url_converter.call(settings.url_converter_scope || getContext(), value, name, $elm[0]);\n          }\n          $elm.attr('data-mce-' + name, value).attr(name, value);\n        },\n        get: function ($elm, name) {\n          return $elm.attr('data-mce-' + name) || $elm.attr(name);\n        }\n      };\n      attrHooks = {\n        style: {\n          set: function ($elm, value) {\n            if (value !== null && typeof value === 'object') {\n              $elm.css(value);\n              return;\n            }\n            if (keepValues) {\n              $elm.attr('data-mce-style', value);\n            }\n            $elm.attr('style', value);\n          },\n          get: function ($elm) {\n            var value = $elm.attr('data-mce-style') || $elm.attr('style');\n            value = styles.serialize(styles.parse(value), $elm[0].nodeName);\n            return value;\n          }\n        }\n      };\n      if (keepValues) {\n        attrHooks.href = attrHooks.src = keepUrlHook;\n      }\n      return attrHooks;\n    };\n    var updateInternalStyleAttr = function (styles, $elm) {\n      var rawValue = $elm.attr('style');\n      var value = styles.serialize(styles.parse(rawValue), $elm[0].nodeName);\n      if (!value) {\n        value = null;\n      }\n      $elm.attr('data-mce-style', value);\n    };\n    var findNodeIndex = function (node, normalized) {\n      var idx = 0, lastNodeType, nodeType;\n      if (node) {\n        for (lastNodeType = node.nodeType, node = node.previousSibling; node; node = node.previousSibling) {\n          nodeType = node.nodeType;\n          if (normalized && nodeType === 3) {\n            if (nodeType === lastNodeType || !node.nodeValue.length) {\n              continue;\n            }\n          }\n          idx++;\n          lastNodeType = nodeType;\n        }\n      }\n      return idx;\n    };\n    function DOMUtils(doc, settings) {\n      var _this = this;\n      if (settings === void 0) {\n        settings = {};\n      }\n      var attrHooks;\n      var addedStyles = {};\n      var win = domGlobals.window;\n      var files = {};\n      var counter = 0;\n      var stdMode = true;\n      var boxModel = true;\n      var styleSheetLoader = StyleSheetLoader(doc, { contentCssCors: settings.contentCssCors });\n      var boundEvents = [];\n      var schema = settings.schema ? settings.schema : Schema({});\n      var styles = Styles({\n        url_converter: settings.url_converter,\n        url_converter_scope: settings.url_converter_scope\n      }, settings.schema);\n      var events = settings.ownEvents ? new EventUtils(settings.proxy) : EventUtils.Event;\n      var blockElementsMap = schema.getBlockElements();\n      var $ = DomQuery.overrideDefaults(function () {\n        return {\n          context: doc,\n          element: self.getRoot()\n        };\n      });\n      var isBlock = function (node) {\n        if (typeof node === 'string') {\n          return !!blockElementsMap[node];\n        } else if (node) {\n          var type = node.nodeType;\n          if (type) {\n            return !!(type === 1 && blockElementsMap[node.nodeName]);\n          }\n        }\n        return false;\n      };\n      var get = function (elm) {\n        if (elm && doc && typeof elm === 'string') {\n          var node = doc.getElementById(elm);\n          if (node && node.id !== elm) {\n            return doc.getElementsByName(elm)[1];\n          } else {\n            return node;\n          }\n        }\n        return elm;\n      };\n      var $$ = function (elm) {\n        if (typeof elm === 'string') {\n          elm = get(elm);\n        }\n        return $(elm);\n      };\n      var getAttrib = function (elm, name, defaultVal) {\n        var hook, value;\n        var $elm = $$(elm);\n        if ($elm.length) {\n          hook = attrHooks[name];\n          if (hook && hook.get) {\n            value = hook.get($elm, name);\n          } else {\n            value = $elm.attr(name);\n          }\n        }\n        if (typeof value === 'undefined') {\n          value = defaultVal || '';\n        }\n        return value;\n      };\n      var getAttribs = function (elm) {\n        var node = get(elm);\n        if (!node) {\n          return [];\n        }\n        return node.attributes;\n      };\n      var setAttrib = function (elm, name, value) {\n        var originalValue, hook;\n        if (value === '') {\n          value = null;\n        }\n        var $elm = $$(elm);\n        originalValue = $elm.attr(name);\n        if (!$elm.length) {\n          return;\n        }\n        hook = attrHooks[name];\n        if (hook && hook.set) {\n          hook.set($elm, value, name);\n        } else {\n          $elm.attr(name, value);\n        }\n        if (originalValue !== value && settings.onSetAttrib) {\n          settings.onSetAttrib({\n            attrElm: $elm,\n            attrName: name,\n            attrValue: value\n          });\n        }\n      };\n      var clone = function (node, deep) {\n        if (!isIE || node.nodeType !== 1 || deep) {\n          return node.cloneNode(deep);\n        }\n        if (!deep) {\n          var clone_1 = doc.createElement(node.nodeName);\n          each$5(getAttribs(node), function (attr) {\n            setAttrib(clone_1, attr.nodeName, getAttrib(node, attr.nodeName));\n          });\n          return clone_1;\n        }\n        return null;\n      };\n      var getRoot = function () {\n        return settings.root_element || doc.body;\n      };\n      var getViewPort = function (argWin) {\n        var actWin = !argWin ? win : argWin;\n        var doc = actWin.document;\n        var rootElm =  doc.documentElement ;\n        return {\n          x: actWin.pageXOffset || rootElm.scrollLeft,\n          y: actWin.pageYOffset || rootElm.scrollTop,\n          w: actWin.innerWidth || rootElm.clientWidth,\n          h: actWin.innerHeight || rootElm.clientHeight\n        };\n      };\n      var getPos = function (elm, rootElm) {\n        return Position.getPos(doc.body, get(elm), rootElm);\n      };\n      var setStyle = function (elm, name, value) {\n        var $elm = $$(elm).css(name, value);\n        if (settings.update_styles) {\n          updateInternalStyleAttr(styles, $elm);\n        }\n      };\n      var setStyles = function (elm, stylesArg) {\n        var $elm = $$(elm).css(stylesArg);\n        if (settings.update_styles) {\n          updateInternalStyleAttr(styles, $elm);\n        }\n      };\n      var getStyle = function (elm, name, computed) {\n        var $elm = $$(elm);\n        if (computed) {\n          return $elm.css(name);\n        }\n        name = name.replace(/-(\\D)/g, function (a, b) {\n          return b.toUpperCase();\n        });\n        if (name === 'float') {\n          name = Env.ie && Env.ie < 12 ? 'styleFloat' : 'cssFloat';\n        }\n        return $elm[0] && $elm[0].style ? $elm[0].style[name] : undefined;\n      };\n      var getSize = function (elm) {\n        var w, h;\n        elm = get(elm);\n        w = getStyle(elm, 'width');\n        h = getStyle(elm, 'height');\n        if (w.indexOf('px') === -1) {\n          w = 0;\n        }\n        if (h.indexOf('px') === -1) {\n          h = 0;\n        }\n        return {\n          w: parseInt(w, 10) || elm.offsetWidth || elm.clientWidth,\n          h: parseInt(h, 10) || elm.offsetHeight || elm.clientHeight\n        };\n      };\n      var getRect = function (elm) {\n        var pos, size;\n        elm = get(elm);\n        pos = getPos(elm);\n        size = getSize(elm);\n        return {\n          x: pos.x,\n          y: pos.y,\n          w: size.w,\n          h: size.h\n        };\n      };\n      var is = function (elm, selector) {\n        var i;\n        if (!elm) {\n          return false;\n        }\n        if (!Array.isArray(elm)) {\n          if (selector === '*') {\n            return elm.nodeType === 1;\n          }\n          if (simpleSelectorRe.test(selector)) {\n            var selectors = selector.toLowerCase().split(/,/);\n            var elmName = elm.nodeName.toLowerCase();\n            for (i = selectors.length - 1; i >= 0; i--) {\n              if (selectors[i] === elmName) {\n                return true;\n              }\n            }\n            return false;\n          }\n          if (elm.nodeType && elm.nodeType !== 1) {\n            return false;\n          }\n        }\n        var elms = !Array.isArray(elm) ? [elm] : elm;\n        return Sizzle(selector, elms[0].ownerDocument || elms[0], null, elms).length > 0;\n      };\n      var getParents = function (elm, selector, root, collect) {\n        var result = [];\n        var selectorVal;\n        var node = get(elm);\n        collect = collect === undefined;\n        root = root || (getRoot().nodeName !== 'BODY' ? getRoot().parentNode : null);\n        if (Tools.is(selector, 'string')) {\n          selectorVal = selector;\n          if (selector === '*') {\n            selector = function (node) {\n              return node.nodeType === 1;\n            };\n          } else {\n            selector = function (node) {\n              return is(node, selectorVal);\n            };\n          }\n        }\n        while (node) {\n          if (node === root || !node.nodeType || node.nodeType === 9) {\n            break;\n          }\n          if (!selector || typeof selector === 'function' && selector(node)) {\n            if (collect) {\n              result.push(node);\n            } else {\n              return [node];\n            }\n          }\n          node = node.parentNode;\n        }\n        return collect ? result : null;\n      };\n      var getParent = function (node, selector, root) {\n        var parents = getParents(node, selector, root, false);\n        return parents && parents.length > 0 ? parents[0] : null;\n      };\n      var _findSib = function (node, selector, name) {\n        var func = selector;\n        if (node) {\n          if (typeof selector === 'string') {\n            func = function (node) {\n              return is(node, selector);\n            };\n          }\n          for (node = node[name]; node; node = node[name]) {\n            if (typeof func === 'function' && func(node)) {\n              return node;\n            }\n          }\n        }\n        return null;\n      };\n      var getNext = function (node, selector) {\n        return _findSib(node, selector, 'nextSibling');\n      };\n      var getPrev = function (node, selector) {\n        return _findSib(node, selector, 'previousSibling');\n      };\n      var select = function (selector, scope) {\n        return Sizzle(selector, get(scope) || settings.root_element || doc, []);\n      };\n      var run = function (elm, func, scope) {\n        var result;\n        var node = typeof elm === 'string' ? get(elm) : elm;\n        if (!node) {\n          return false;\n        }\n        if (Tools.isArray(node) && (node.length || node.length === 0)) {\n          result = [];\n          each$5(node, function (elm, i) {\n            if (elm) {\n              if (typeof elm === 'string') {\n                elm = get(elm);\n              }\n              result.push(func.call(scope, elm, i));\n            }\n          });\n          return result;\n        }\n        var context = scope ? scope : _this;\n        return func.call(context, node);\n      };\n      var setAttribs = function (elm, attrs) {\n        $$(elm).each(function (i, node) {\n          each$5(attrs, function (value, name) {\n            setAttrib(node, name, value);\n          });\n        });\n      };\n      var setHTML = function (elm, html) {\n        var $elm = $$(elm);\n        if (isIE) {\n          $elm.each(function (i, target) {\n            if (target.canHaveHTML === false) {\n              return;\n            }\n            while (target.firstChild) {\n              target.removeChild(target.firstChild);\n            }\n            try {\n              target.innerHTML = '<br>' + html;\n              target.removeChild(target.firstChild);\n            } catch (ex) {\n              DomQuery('<div></div>').html('<br>' + html).contents().slice(1).appendTo(target);\n            }\n            return html;\n          });\n        } else {\n          $elm.html(html);\n        }\n      };\n      var add = function (parentElm, name, attrs, html, create) {\n        return run(parentElm, function (parentElm) {\n          var newElm = typeof name === 'string' ? doc.createElement(name) : name;\n          setAttribs(newElm, attrs);\n          if (html) {\n            if (typeof html !== 'string' && html.nodeType) {\n              newElm.appendChild(html);\n            } else if (typeof html === 'string') {\n              setHTML(newElm, html);\n            }\n          }\n          return !create ? parentElm.appendChild(newElm) : newElm;\n        });\n      };\n      var create = function (name, attrs, html) {\n        return add(doc.createElement(name), name, attrs, html, true);\n      };\n      var decode = Entities.decode;\n      var encode = Entities.encodeAllRaw;\n      var createHTML = function (name, attrs, html) {\n        var outHtml = '', key;\n        outHtml += '<' + name;\n        for (key in attrs) {\n          if (attrs.hasOwnProperty(key) && attrs[key] !== null && typeof attrs[key] !== 'undefined') {\n            outHtml += ' ' + key + '=\"' + encode(attrs[key]) + '\"';\n          }\n        }\n        if (typeof html !== 'undefined') {\n          return outHtml + '>' + html + '</' + name + '>';\n        }\n        return outHtml + ' />';\n      };\n      var createFragment = function (html) {\n        var node;\n        var container = doc.createElement('div');\n        var frag = doc.createDocumentFragment();\n        frag.appendChild(container);\n        if (html) {\n          container.innerHTML = html;\n        }\n        while (node = container.firstChild) {\n          frag.appendChild(node);\n        }\n        frag.removeChild(container);\n        return frag;\n      };\n      var remove = function (node, keepChildren) {\n        var $node = $$(node);\n        if (keepChildren) {\n          $node.each(function () {\n            var child;\n            while (child = this.firstChild) {\n              if (child.nodeType === 3 && child.data.length === 0) {\n                this.removeChild(child);\n              } else {\n                this.parentNode.insertBefore(child, this);\n              }\n            }\n          }).remove();\n        } else {\n          $node.remove();\n        }\n        return $node.length > 1 ? $node.toArray() : $node[0];\n      };\n      var removeAllAttribs = function (e) {\n        return run(e, function (e) {\n          var i;\n          var attrs = e.attributes;\n          for (i = attrs.length - 1; i >= 0; i--) {\n            e.removeAttributeNode(attrs.item(i));\n          }\n        });\n      };\n      var parseStyle = function (cssText) {\n        return styles.parse(cssText);\n      };\n      var serializeStyle = function (stylesArg, name) {\n        return styles.serialize(stylesArg, name);\n      };\n      var addStyle = function (cssText) {\n        var head, styleElm;\n        if (self !== DOMUtils.DOM && doc === domGlobals.document) {\n          if (addedStyles[cssText]) {\n            return;\n          }\n          addedStyles[cssText] = true;\n        }\n        styleElm = doc.getElementById('mceDefaultStyles');\n        if (!styleElm) {\n          styleElm = doc.createElement('style');\n          styleElm.id = 'mceDefaultStyles';\n          styleElm.type = 'text/css';\n          head = doc.getElementsByTagName('head')[0];\n          if (head.firstChild) {\n            head.insertBefore(styleElm, head.firstChild);\n          } else {\n            head.appendChild(styleElm);\n          }\n        }\n        if (styleElm.styleSheet) {\n          styleElm.styleSheet.cssText += cssText;\n        } else {\n          styleElm.appendChild(doc.createTextNode(cssText));\n        }\n      };\n      var loadCSS = function (url) {\n        var head;\n        if (self !== DOMUtils.DOM && doc === domGlobals.document) {\n          DOMUtils.DOM.loadCSS(url);\n          return;\n        }\n        if (!url) {\n          url = '';\n        }\n        head = doc.getElementsByTagName('head')[0];\n        each$5(url.split(','), function (url) {\n          var link;\n          url = Tools._addCacheSuffix(url);\n          if (files[url]) {\n            return;\n          }\n          files[url] = true;\n          link = create('link', {\n            rel: 'stylesheet',\n            href: url\n          });\n          head.appendChild(link);\n        });\n      };\n      var toggleClass = function (elm, cls, state) {\n        $$(elm).toggleClass(cls, state).each(function () {\n          if (this.className === '') {\n            DomQuery(this).attr('class', null);\n          }\n        });\n      };\n      var addClass = function (elm, cls) {\n        $$(elm).addClass(cls);\n      };\n      var removeClass = function (elm, cls) {\n        toggleClass(elm, cls, false);\n      };\n      var hasClass = function (elm, cls) {\n        return $$(elm).hasClass(cls);\n      };\n      var show = function (elm) {\n        $$(elm).show();\n      };\n      var hide = function (elm) {\n        $$(elm).hide();\n      };\n      var isHidden = function (elm) {\n        return $$(elm).css('display') === 'none';\n      };\n      var uniqueId = function (prefix) {\n        return (!prefix ? 'mce_' : prefix) + counter++;\n      };\n      var getOuterHTML = function (elm) {\n        var node = typeof elm === 'string' ? get(elm) : elm;\n        return NodeType.isElement(node) ? node.outerHTML : DomQuery('<div></div>').append(DomQuery(node).clone()).html();\n      };\n      var setOuterHTML = function (elm, html) {\n        $$(elm).each(function () {\n          try {\n            if ('outerHTML' in this) {\n              this.outerHTML = html;\n              return;\n            }\n          } catch (ex) {\n          }\n          remove(DomQuery(this).html(html), true);\n        });\n      };\n      var insertAfter = function (node, reference) {\n        var referenceNode = get(reference);\n        return run(node, function (node) {\n          var parent, nextSibling;\n          parent = referenceNode.parentNode;\n          nextSibling = referenceNode.nextSibling;\n          if (nextSibling) {\n            parent.insertBefore(node, nextSibling);\n          } else {\n            parent.appendChild(node);\n          }\n          return node;\n        });\n      };\n      var replace = function (newElm, oldElm, keepChildren) {\n        return run(oldElm, function (oldElm) {\n          if (Tools.is(oldElm, 'array')) {\n            newElm = newElm.cloneNode(true);\n          }\n          if (keepChildren) {\n            each$5(grep$1(oldElm.childNodes), function (node) {\n              newElm.appendChild(node);\n            });\n          }\n          return oldElm.parentNode.replaceChild(newElm, oldElm);\n        });\n      };\n      var rename = function (elm, name) {\n        var newElm;\n        if (elm.nodeName !== name.toUpperCase()) {\n          newElm = create(name);\n          each$5(getAttribs(elm), function (attrNode) {\n            setAttrib(newElm, attrNode.nodeName, getAttrib(elm, attrNode.nodeName));\n          });\n          replace(newElm, elm, true);\n        }\n        return newElm || elm;\n      };\n      var findCommonAncestor = function (a, b) {\n        var ps = a, pe;\n        while (ps) {\n          pe = b;\n          while (pe && ps !== pe) {\n            pe = pe.parentNode;\n          }\n          if (ps === pe) {\n            break;\n          }\n          ps = ps.parentNode;\n        }\n        if (!ps && a.ownerDocument) {\n          return a.ownerDocument.documentElement;\n        }\n        return ps;\n      };\n      var toHex = function (rgbVal) {\n        return styles.toHex(Tools.trim(rgbVal));\n      };\n      var isEmpty = function (node, elements) {\n        var i, attributes, type, whitespace, walker, name, brCount = 0;\n        node = node.firstChild;\n        if (node) {\n          walker = new TreeWalker(node, node.parentNode);\n          elements = elements || (schema ? schema.getNonEmptyElements() : null);\n          whitespace = schema ? schema.getWhiteSpaceElements() : {};\n          do {\n            type = node.nodeType;\n            if (NodeType.isElement(node)) {\n              var bogusVal = node.getAttribute('data-mce-bogus');\n              if (bogusVal) {\n                node = walker.next(bogusVal === 'all');\n                continue;\n              }\n              name = node.nodeName.toLowerCase();\n              if (elements && elements[name]) {\n                if (name === 'br') {\n                  brCount++;\n                  node = walker.next();\n                  continue;\n                }\n                return false;\n              }\n              attributes = getAttribs(node);\n              i = attributes.length;\n              while (i--) {\n                name = attributes[i].nodeName;\n                if (name === 'name' || name === 'data-mce-bookmark') {\n                  return false;\n                }\n              }\n            }\n            if (type === 8) {\n              return false;\n            }\n            if (type === 3 && !whiteSpaceRegExp$2.test(node.nodeValue)) {\n              return false;\n            }\n            if (type === 3 && node.parentNode && whitespace[node.parentNode.nodeName] && whiteSpaceRegExp$2.test(node.nodeValue)) {\n              return false;\n            }\n            node = walker.next();\n          } while (node);\n        }\n        return brCount <= 1;\n      };\n      var createRng = function () {\n        return doc.createRange();\n      };\n      var split = function (parentElm, splitElm, replacementElm) {\n        var r = createRng(), bef, aft, pa;\n        if (parentElm && splitElm) {\n          r.setStart(parentElm.parentNode, findNodeIndex(parentElm));\n          r.setEnd(splitElm.parentNode, findNodeIndex(splitElm));\n          bef = r.extractContents();\n          r = createRng();\n          r.setStart(splitElm.parentNode, findNodeIndex(splitElm) + 1);\n          r.setEnd(parentElm.parentNode, findNodeIndex(parentElm) + 1);\n          aft = r.extractContents();\n          pa = parentElm.parentNode;\n          pa.insertBefore(TrimNode.trimNode(self, bef), parentElm);\n          if (replacementElm) {\n            pa.insertBefore(replacementElm, parentElm);\n          } else {\n            pa.insertBefore(splitElm, parentElm);\n          }\n          pa.insertBefore(TrimNode.trimNode(self, aft), parentElm);\n          remove(parentElm);\n          return replacementElm || splitElm;\n        }\n      };\n      var bind = function (target, name, func, scope) {\n        if (Tools.isArray(target)) {\n          var i = target.length;\n          while (i--) {\n            target[i] = bind(target[i], name, func, scope);\n          }\n          return target;\n        }\n        if (settings.collect && (target === doc || target === win)) {\n          boundEvents.push([\n            target,\n            name,\n            func,\n            scope\n          ]);\n        }\n        return events.bind(target, name, func, scope || self);\n      };\n      var unbind = function (target, name, func) {\n        var i;\n        if (Tools.isArray(target)) {\n          i = target.length;\n          while (i--) {\n            target[i] = unbind(target[i], name, func);\n          }\n          return target;\n        }\n        if (boundEvents && (target === doc || target === win)) {\n          i = boundEvents.length;\n          while (i--) {\n            var item = boundEvents[i];\n            if (target === item[0] && (!name || name === item[1]) && (!func || func === item[2])) {\n              events.unbind(item[0], item[1], item[2]);\n            }\n          }\n        }\n        return events.unbind(target, name, func);\n      };\n      var fire = function (target, name, evt) {\n        return events.fire(target, name, evt);\n      };\n      var getContentEditable = function (node) {\n        if (node && NodeType.isElement(node)) {\n          var contentEditable = node.getAttribute('data-mce-contenteditable');\n          if (contentEditable && contentEditable !== 'inherit') {\n            return contentEditable;\n          }\n          return node.contentEditable !== 'inherit' ? node.contentEditable : null;\n        } else {\n          return null;\n        }\n      };\n      var getContentEditableParent = function (node) {\n        var root = getRoot();\n        var state = null;\n        for (; node && node !== root; node = node.parentNode) {\n          state = getContentEditable(node);\n          if (state !== null) {\n            break;\n          }\n        }\n        return state;\n      };\n      var destroy = function () {\n        if (boundEvents) {\n          var i = boundEvents.length;\n          while (i--) {\n            var item = boundEvents[i];\n            events.unbind(item[0], item[1], item[2]);\n          }\n        }\n        if (Sizzle.setDocument) {\n          Sizzle.setDocument();\n        }\n      };\n      var isChildOf = function (node, parent) {\n        while (node) {\n          if (parent === node) {\n            return true;\n          }\n          node = node.parentNode;\n        }\n        return false;\n      };\n      var dumpRng = function (r) {\n        return 'startContainer: ' + r.startContainer.nodeName + ', startOffset: ' + r.startOffset + ', endContainer: ' + r.endContainer.nodeName + ', endOffset: ' + r.endOffset;\n      };\n      var self = {\n        doc: doc,\n        settings: settings,\n        win: win,\n        files: files,\n        stdMode: stdMode,\n        boxModel: boxModel,\n        styleSheetLoader: styleSheetLoader,\n        boundEvents: boundEvents,\n        styles: styles,\n        schema: schema,\n        events: events,\n        isBlock: isBlock,\n        $: $,\n        $$: $$,\n        root: null,\n        clone: clone,\n        getRoot: getRoot,\n        getViewPort: getViewPort,\n        getRect: getRect,\n        getSize: getSize,\n        getParent: getParent,\n        getParents: getParents,\n        get: get,\n        getNext: getNext,\n        getPrev: getPrev,\n        select: select,\n        is: is,\n        add: add,\n        create: create,\n        createHTML: createHTML,\n        createFragment: createFragment,\n        remove: remove,\n        setStyle: setStyle,\n        getStyle: getStyle,\n        setStyles: setStyles,\n        removeAllAttribs: removeAllAttribs,\n        setAttrib: setAttrib,\n        setAttribs: setAttribs,\n        getAttrib: getAttrib,\n        getPos: getPos,\n        parseStyle: parseStyle,\n        serializeStyle: serializeStyle,\n        addStyle: addStyle,\n        loadCSS: loadCSS,\n        addClass: addClass,\n        removeClass: removeClass,\n        hasClass: hasClass,\n        toggleClass: toggleClass,\n        show: show,\n        hide: hide,\n        isHidden: isHidden,\n        uniqueId: uniqueId,\n        setHTML: setHTML,\n        getOuterHTML: getOuterHTML,\n        setOuterHTML: setOuterHTML,\n        decode: decode,\n        encode: encode,\n        insertAfter: insertAfter,\n        replace: replace,\n        rename: rename,\n        findCommonAncestor: findCommonAncestor,\n        toHex: toHex,\n        run: run,\n        getAttribs: getAttribs,\n        isEmpty: isEmpty,\n        createRng: createRng,\n        nodeIndex: findNodeIndex,\n        split: split,\n        bind: bind,\n        unbind: unbind,\n        fire: fire,\n        getContentEditable: getContentEditable,\n        getContentEditableParent: getContentEditableParent,\n        destroy: destroy,\n        isChildOf: isChildOf,\n        dumpRng: dumpRng\n      };\n      attrHooks = setupAttrHooks(styles, settings, function () {\n        return self;\n      });\n      return self;\n    }\n    (function (DOMUtils) {\n      DOMUtils.DOM = DOMUtils(domGlobals.document);\n      DOMUtils.nodeIndex = findNodeIndex;\n    }(DOMUtils || (DOMUtils = {})));\n    var DOMUtils$1 = DOMUtils;\n\n    var DOM = DOMUtils$1.DOM;\n    var each$6 = Tools.each, grep$2 = Tools.grep;\n    var isFunction$1 = function (f) {\n      return typeof f === 'function';\n    };\n    var ScriptLoader = function () {\n      var QUEUED = 0;\n      var LOADING = 1;\n      var LOADED = 2;\n      var FAILED = 3;\n      var states = {};\n      var queue = [];\n      var scriptLoadedCallbacks = {};\n      var queueLoadedCallbacks = [];\n      var loading = 0;\n      var loadScript = function (url, success, failure) {\n        var dom = DOM;\n        var elm, id;\n        var done = function () {\n          dom.remove(id);\n          if (elm) {\n            elm.onreadystatechange = elm.onload = elm = null;\n          }\n          success();\n        };\n        var error = function () {\n          if (isFunction$1(failure)) {\n            failure();\n          } else {\n            if (typeof console !== 'undefined' && console.log) {\n              console.log('Failed to load script: ' + url);\n            }\n          }\n        };\n        id = dom.uniqueId();\n        elm = domGlobals.document.createElement('script');\n        elm.id = id;\n        elm.type = 'text/javascript';\n        elm.src = Tools._addCacheSuffix(url);\n        elm.onload = done;\n        elm.onerror = error;\n        (domGlobals.document.getElementsByTagName('head')[0] || domGlobals.document.body).appendChild(elm);\n      };\n      this.isDone = function (url) {\n        return states[url] === LOADED;\n      };\n      this.markDone = function (url) {\n        states[url] = LOADED;\n      };\n      this.add = this.load = function (url, success, scope, failure) {\n        var state = states[url];\n        if (state === undefined) {\n          queue.push(url);\n          states[url] = QUEUED;\n        }\n        if (success) {\n          if (!scriptLoadedCallbacks[url]) {\n            scriptLoadedCallbacks[url] = [];\n          }\n          scriptLoadedCallbacks[url].push({\n            success: success,\n            failure: failure,\n            scope: scope || this\n          });\n        }\n      };\n      this.remove = function (url) {\n        delete states[url];\n        delete scriptLoadedCallbacks[url];\n      };\n      this.loadQueue = function (success, scope, failure) {\n        this.loadScripts(queue, success, scope, failure);\n      };\n      this.loadScripts = function (scripts, success, scope, failure) {\n        var loadScripts;\n        var failures = [];\n        var execCallbacks = function (name, url) {\n          each$6(scriptLoadedCallbacks[url], function (callback) {\n            if (isFunction$1(callback[name])) {\n              callback[name].call(callback.scope);\n            }\n          });\n          scriptLoadedCallbacks[url] = undefined;\n        };\n        queueLoadedCallbacks.push({\n          success: success,\n          failure: failure,\n          scope: scope || this\n        });\n        loadScripts = function () {\n          var loadingScripts = grep$2(scripts);\n          scripts.length = 0;\n          each$6(loadingScripts, function (url) {\n            if (states[url] === LOADED) {\n              execCallbacks('success', url);\n              return;\n            }\n            if (states[url] === FAILED) {\n              execCallbacks('failure', url);\n              return;\n            }\n            if (states[url] !== LOADING) {\n              states[url] = LOADING;\n              loading++;\n              loadScript(url, function () {\n                states[url] = LOADED;\n                loading--;\n                execCallbacks('success', url);\n                loadScripts();\n              }, function () {\n                states[url] = FAILED;\n                loading--;\n                failures.push(url);\n                execCallbacks('failure', url);\n                loadScripts();\n              });\n            }\n          });\n          if (!loading) {\n            var notifyCallbacks = queueLoadedCallbacks.slice(0);\n            queueLoadedCallbacks.length = 0;\n            each$6(notifyCallbacks, function (callback) {\n              if (failures.length === 0) {\n                if (isFunction$1(callback.success)) {\n                  callback.success.call(callback.scope);\n                }\n              } else {\n                if (isFunction$1(callback.failure)) {\n                  callback.failure.call(callback.scope, failures);\n                }\n              }\n            });\n          }\n        };\n        loadScripts();\n      };\n    };\n    ScriptLoader.ScriptLoader = new ScriptLoader();\n\n    var each$7 = Tools.each;\n    function AddOnManager() {\n      var _this = this;\n      var items = [];\n      var urls = {};\n      var lookup = {};\n      var _listeners = [];\n      var get = function (name) {\n        if (lookup[name]) {\n          return lookup[name].instance;\n        }\n        return undefined;\n      };\n      var dependencies = function (name) {\n        var result;\n        if (lookup[name]) {\n          result = lookup[name].dependencies;\n        }\n        return result || [];\n      };\n      var requireLangPack = function (name, languages) {\n        var language = AddOnManager.language;\n        if (language && AddOnManager.languageLoad !== false) {\n          if (languages) {\n            languages = ',' + languages + ',';\n            if (languages.indexOf(',' + language.substr(0, 2) + ',') !== -1) {\n              language = language.substr(0, 2);\n            } else if (languages.indexOf(',' + language + ',') === -1) {\n              return;\n            }\n          }\n          ScriptLoader.ScriptLoader.add(urls[name] + '/langs/' + language + '.js');\n        }\n      };\n      var add = function (id, addOn, dependencies) {\n        items.push(addOn);\n        lookup[id] = {\n          instance: addOn,\n          dependencies: dependencies\n        };\n        var result = partition(_listeners, function (listener) {\n          return listener.name === id;\n        });\n        _listeners = result.fail;\n        each$7(result.pass, function (listener) {\n          listener.callback();\n        });\n        return addOn;\n      };\n      var remove = function (name) {\n        delete urls[name];\n        delete lookup[name];\n      };\n      var createUrl = function (baseUrl, dep) {\n        if (typeof dep === 'object') {\n          return dep;\n        }\n        return typeof baseUrl === 'string' ? {\n          prefix: '',\n          resource: dep,\n          suffix: ''\n        } : {\n          prefix: baseUrl.prefix,\n          resource: dep,\n          suffix: baseUrl.suffix\n        };\n      };\n      var addComponents = function (pluginName, scripts) {\n        var pluginUrl = _this.urls[pluginName];\n        each$7(scripts, function (script) {\n          ScriptLoader.ScriptLoader.add(pluginUrl + '/' + script);\n        });\n      };\n      var loadDependencies = function (name, addOnUrl, success, scope) {\n        var deps = dependencies(name);\n        each$7(deps, function (dep) {\n          var newUrl = createUrl(addOnUrl, dep);\n          load(newUrl.resource, newUrl, undefined, undefined);\n        });\n        if (success) {\n          if (scope) {\n            success.call(scope);\n          } else {\n            success.call(ScriptLoader);\n          }\n        }\n      };\n      var load = function (name, addOnUrl, success, scope, failure) {\n        if (urls[name]) {\n          return;\n        }\n        var urlString = typeof addOnUrl === 'string' ? addOnUrl : addOnUrl.prefix + addOnUrl.resource + addOnUrl.suffix;\n        if (urlString.indexOf('/') !== 0 && urlString.indexOf('://') === -1) {\n          urlString = AddOnManager.baseURL + '/' + urlString;\n        }\n        urls[name] = urlString.substring(0, urlString.lastIndexOf('/'));\n        if (lookup[name]) {\n          loadDependencies(name, addOnUrl, success, scope);\n        } else {\n          ScriptLoader.ScriptLoader.add(urlString, function () {\n            return loadDependencies(name, addOnUrl, success, scope);\n          }, scope, failure);\n        }\n      };\n      var waitFor = function (name, callback) {\n        if (lookup.hasOwnProperty(name)) {\n          callback();\n        } else {\n          _listeners.push({\n            name: name,\n            callback: callback\n          });\n        }\n      };\n      return {\n        items: items,\n        urls: urls,\n        lookup: lookup,\n        _listeners: _listeners,\n        get: get,\n        dependencies: dependencies,\n        requireLangPack: requireLangPack,\n        add: add,\n        remove: remove,\n        createUrl: createUrl,\n        addComponents: addComponents,\n        load: load,\n        waitFor: waitFor\n      };\n    }\n    (function (AddOnManager) {\n      AddOnManager.PluginManager = AddOnManager();\n      AddOnManager.ThemeManager = AddOnManager();\n    }(AddOnManager || (AddOnManager = {})));\n\n    var before = function (marker, element) {\n      var parent$1 = parent(marker);\n      parent$1.each(function (v) {\n        v.dom().insertBefore(element.dom(), marker.dom());\n      });\n    };\n    var after = function (marker, element) {\n      var sibling = nextSibling(marker);\n      sibling.fold(function () {\n        var parent$1 = parent(marker);\n        parent$1.each(function (v) {\n          append(v, element);\n        });\n      }, function (v) {\n        before(v, element);\n      });\n    };\n    var prepend = function (parent, element) {\n      var firstChild$1 = firstChild(parent);\n      firstChild$1.fold(function () {\n        append(parent, element);\n      }, function (v) {\n        parent.dom().insertBefore(element.dom(), v.dom());\n      });\n    };\n    var append = function (parent, element) {\n      parent.dom().appendChild(element.dom());\n    };\n    var wrap$1 = function (element, wrapper) {\n      before(element, wrapper);\n      append(wrapper, element);\n    };\n\n    var before$1 = function (marker, elements) {\n      each(elements, function (x) {\n        before(marker, x);\n      });\n    };\n    var append$1 = function (parent, elements) {\n      each(elements, function (x) {\n        append(parent, x);\n      });\n    };\n\n    var empty = function (element) {\n      element.dom().textContent = '';\n      each(children(element), function (rogue) {\n        remove$1(rogue);\n      });\n    };\n    var remove$1 = function (element) {\n      var dom = element.dom();\n      if (dom.parentNode !== null) {\n        dom.parentNode.removeChild(dom);\n      }\n    };\n    var unwrap = function (wrapper) {\n      var children$1 = children(wrapper);\n      if (children$1.length > 0) {\n        before$1(wrapper, children$1);\n      }\n      remove$1(wrapper);\n    };\n\n    var first = function (fn, rate) {\n      var timer = null;\n      var cancel = function () {\n        if (timer !== null) {\n          domGlobals.clearTimeout(timer);\n          timer = null;\n        }\n      };\n      var throttle = function () {\n        var args = [];\n        for (var _i = 0; _i < arguments.length; _i++) {\n          args[_i] = arguments[_i];\n        }\n        if (timer === null) {\n          timer = domGlobals.setTimeout(function () {\n            fn.apply(null, args);\n            timer = null;\n          }, rate);\n        }\n      };\n      return {\n        cancel: cancel,\n        throttle: throttle\n      };\n    };\n    var last$2 = function (fn, rate) {\n      var timer = null;\n      var cancel = function () {\n        if (timer !== null) {\n          domGlobals.clearTimeout(timer);\n          timer = null;\n        }\n      };\n      var throttle = function () {\n        var args = [];\n        for (var _i = 0; _i < arguments.length; _i++) {\n          args[_i] = arguments[_i];\n        }\n        if (timer !== null) {\n          domGlobals.clearTimeout(timer);\n        }\n        timer = domGlobals.setTimeout(function () {\n          fn.apply(null, args);\n          timer = null;\n        }, rate);\n      };\n      return {\n        cancel: cancel,\n        throttle: throttle\n      };\n    };\n\n    var Cell = function (initial) {\n      var value = initial;\n      var get = function () {\n        return value;\n      };\n      var set = function (v) {\n        value = v;\n      };\n      var clone = function () {\n        return Cell(get());\n      };\n      return {\n        get: get,\n        set: set,\n        clone: clone\n      };\n    };\n\n    var read = function (element, attr) {\n      var value = get(element, attr);\n      return value === undefined || value === '' ? [] : value.split(' ');\n    };\n    var add = function (element, attr, id) {\n      var old = read(element, attr);\n      var nu = old.concat([id]);\n      set(element, attr, nu.join(' '));\n      return true;\n    };\n    var remove$2 = function (element, attr, id) {\n      var nu = filter(read(element, attr), function (v) {\n        return v !== id;\n      });\n      if (nu.length > 0) {\n        set(element, attr, nu.join(' '));\n      } else {\n        remove(element, attr);\n      }\n      return false;\n    };\n\n    var supports = function (element) {\n      return element.dom().classList !== undefined;\n    };\n    var get$2 = function (element) {\n      return read(element, 'class');\n    };\n    var add$1 = function (element, clazz) {\n      return add(element, 'class', clazz);\n    };\n    var remove$3 = function (element, clazz) {\n      return remove$2(element, 'class', clazz);\n    };\n\n    var add$2 = function (element, clazz) {\n      if (supports(element)) {\n        element.dom().classList.add(clazz);\n      } else {\n        add$1(element, clazz);\n      }\n    };\n    var cleanClass = function (element) {\n      var classList = supports(element) ? element.dom().classList : get$2(element);\n      if (classList.length === 0) {\n        remove(element, 'class');\n      }\n    };\n    var remove$4 = function (element, clazz) {\n      if (supports(element)) {\n        var classList = element.dom().classList;\n        classList.remove(clazz);\n      } else {\n        remove$3(element, clazz);\n      }\n      cleanClass(element);\n    };\n    var has$2 = function (element, clazz) {\n      return supports(element) && element.dom().classList.contains(clazz);\n    };\n\n    var descendants = function (scope, predicate) {\n      var result = [];\n      each(children(scope), function (x) {\n        if (predicate(x)) {\n          result = result.concat([x]);\n        }\n        result = result.concat(descendants(x, predicate));\n      });\n      return result;\n    };\n\n    var descendants$1 = function (scope, selector) {\n      return all(selector, scope);\n    };\n\n    function ClosestOrAncestor (is, ancestor, scope, a, isRoot) {\n      return is(scope, a) ? Option.some(scope) : isFunction(isRoot) && isRoot(scope) ? Option.none() : ancestor(scope, a, isRoot);\n    }\n\n    var ancestor = function (scope, predicate, isRoot) {\n      var element = scope.dom();\n      var stop = isFunction(isRoot) ? isRoot : constant(false);\n      while (element.parentNode) {\n        element = element.parentNode;\n        var el = Element.fromDom(element);\n        if (predicate(el)) {\n          return Option.some(el);\n        } else if (stop(el)) {\n          break;\n        }\n      }\n      return Option.none();\n    };\n    var closest = function (scope, predicate, isRoot) {\n      var is = function (s, test) {\n        return test(s);\n      };\n      return ClosestOrAncestor(is, ancestor, scope, predicate, isRoot);\n    };\n\n    var ancestor$1 = function (scope, selector, isRoot) {\n      return ancestor(scope, function (e) {\n        return is$1(e, selector);\n      }, isRoot);\n    };\n    var descendant = function (scope, selector) {\n      return one(selector, scope);\n    };\n    var closest$1 = function (scope, selector, isRoot) {\n      return ClosestOrAncestor(is$1, ancestor$1, scope, selector, isRoot);\n    };\n\n    var annotation = constant('mce-annotation');\n    var dataAnnotation = constant('data-mce-annotation');\n    var dataAnnotationId = constant('data-mce-annotation-uid');\n\n    var identify = function (editor, annotationName) {\n      var rng = editor.selection.getRng();\n      var start = Element.fromDom(rng.startContainer);\n      var root = Element.fromDom(editor.getBody());\n      var selector = annotationName.fold(function () {\n        return '.' + annotation();\n      }, function (an) {\n        return '[' + dataAnnotation() + '=\"' + an + '\"]';\n      });\n      var newStart = child(start, rng.startOffset).getOr(start);\n      var closest = closest$1(newStart, selector, function (n) {\n        return eq(n, root);\n      });\n      var getAttr = function (c, property) {\n        if (has$1(c, property)) {\n          return Option.some(get(c, property));\n        } else {\n          return Option.none();\n        }\n      };\n      return closest.bind(function (c) {\n        return getAttr(c, '' + dataAnnotationId()).bind(function (uid) {\n          return getAttr(c, '' + dataAnnotation()).map(function (name) {\n            var elements = findMarkers(editor, uid);\n            return {\n              uid: uid,\n              name: name,\n              elements: elements\n            };\n          });\n        });\n      });\n    };\n    var isAnnotation = function (elem) {\n      return isElement(elem) && has$2(elem, annotation());\n    };\n    var findMarkers = function (editor, uid) {\n      var body = Element.fromDom(editor.getBody());\n      return descendants$1(body, '[' + dataAnnotationId() + '=\"' + uid + '\"]');\n    };\n    var findAll = function (editor, name) {\n      var body = Element.fromDom(editor.getBody());\n      var markers = descendants$1(body, '[' + dataAnnotation() + '=\"' + name + '\"]');\n      var directory = {};\n      each(markers, function (m) {\n        var uid = get(m, dataAnnotationId());\n        var nodesAlready = directory.hasOwnProperty(uid) ? directory[uid] : [];\n        directory[uid] = nodesAlready.concat([m]);\n      });\n      return directory;\n    };\n\n    var setup = function (editor, registry) {\n      var changeCallbacks = Cell({});\n      var initData = function () {\n        return {\n          listeners: [],\n          previous: Cell(Option.none())\n        };\n      };\n      var withCallbacks = function (name, f) {\n        updateCallbacks(name, function (data) {\n          f(data);\n          return data;\n        });\n      };\n      var updateCallbacks = function (name, f) {\n        var callbackMap = changeCallbacks.get();\n        var data = callbackMap.hasOwnProperty(name) ? callbackMap[name] : initData();\n        var outputData = f(data);\n        callbackMap[name] = outputData;\n        changeCallbacks.set(callbackMap);\n      };\n      var fireCallbacks = function (name, uid, elements) {\n        withCallbacks(name, function (data) {\n          each(data.listeners, function (f) {\n            return f(true, name, {\n              uid: uid,\n              nodes: map(elements, function (elem) {\n                return elem.dom();\n              })\n            });\n          });\n        });\n      };\n      var fireNoAnnotation = function (name) {\n        withCallbacks(name, function (data) {\n          each(data.listeners, function (f) {\n            return f(false, name);\n          });\n        });\n      };\n      var onNodeChange = last$2(function () {\n        var callbackMap = changeCallbacks.get();\n        var annotations = sort(keys(callbackMap));\n        each(annotations, function (name) {\n          updateCallbacks(name, function (data) {\n            var prev = data.previous.get();\n            identify(editor, Option.some(name)).fold(function () {\n              if (prev.isSome()) {\n                fireNoAnnotation(name);\n                data.previous.set(Option.none());\n              }\n            }, function (_a) {\n              var uid = _a.uid, name = _a.name, elements = _a.elements;\n              if (!prev.is(uid)) {\n                fireCallbacks(name, uid, elements);\n                data.previous.set(Option.some(uid));\n              }\n            });\n            return {\n              previous: data.previous,\n              listeners: data.listeners\n            };\n          });\n        });\n      }, 30);\n      editor.on('remove', function () {\n        onNodeChange.cancel();\n      });\n      editor.on('nodeChange', function () {\n        onNodeChange.throttle();\n      });\n      var addListener = function (name, f) {\n        updateCallbacks(name, function (data) {\n          return {\n            previous: data.previous,\n            listeners: data.listeners.concat([f])\n          };\n        });\n      };\n      return { addListener: addListener };\n    };\n\n    var setup$1 = function (editor, registry) {\n      var identifyParserNode = function (span) {\n        var optAnnotation = Option.from(span.attributes.map[dataAnnotation()]);\n        return optAnnotation.bind(registry.lookup);\n      };\n      editor.on('init', function () {\n        editor.serializer.addNodeFilter('span', function (spans) {\n          each(spans, function (span) {\n            identifyParserNode(span).each(function (settings) {\n              if (settings.persistent === false) {\n                span.unwrap();\n              }\n            });\n          });\n        });\n      });\n    };\n\n    var create$1 = function () {\n      var annotations = {};\n      var register = function (name, settings) {\n        annotations[name] = {\n          name: name,\n          settings: settings\n        };\n      };\n      var lookup = function (name) {\n        return annotations.hasOwnProperty(name) ? Option.from(annotations[name]).map(function (a) {\n          return a.settings;\n        }) : Option.none();\n      };\n      return {\n        register: register,\n        lookup: lookup\n      };\n    };\n\n    var __assign = function () {\n      __assign = Object.assign || function __assign(t) {\n        for (var s, i = 1, n = arguments.length; i < n; i++) {\n          s = arguments[i];\n          for (var p in s)\n            if (Object.prototype.hasOwnProperty.call(s, p))\n              t[p] = s[p];\n        }\n        return t;\n      };\n      return __assign.apply(this, arguments);\n    };\n    function __rest(s, e) {\n      var t = {};\n      for (var p in s)\n        if (Object.prototype.hasOwnProperty.call(s, p) && e.indexOf(p) < 0)\n          t[p] = s[p];\n      if (s != null && typeof Object.getOwnPropertySymbols === 'function')\n        for (var i = 0, p = Object.getOwnPropertySymbols(s); i < p.length; i++) {\n          if (e.indexOf(p[i]) < 0 && Object.prototype.propertyIsEnumerable.call(s, p[i]))\n            t[p[i]] = s[p[i]];\n        }\n      return t;\n    }\n    function __spreadArrays() {\n      for (var s = 0, i = 0, il = arguments.length; i < il; i++)\n        s += arguments[i].length;\n      for (var r = Array(s), k = 0, i = 0; i < il; i++)\n        for (var a = arguments[i], j = 0, jl = a.length; j < jl; j++, k++)\n          r[k] = a[j];\n      return r;\n    }\n\n    var unique = 0;\n    var generate = function (prefix) {\n      var date = new Date();\n      var time = date.getTime();\n      var random = Math.floor(Math.random() * 1000000000);\n      unique++;\n      return prefix + '_' + random + unique + String(time);\n    };\n\n    var add$3 = function (element, classes) {\n      each(classes, function (x) {\n        add$2(element, x);\n      });\n    };\n\n    var clone = function (original, isDeep) {\n      return Element.fromDom(original.dom().cloneNode(isDeep));\n    };\n    var shallow = function (original) {\n      return clone(original, false);\n    };\n    var deep = function (original) {\n      return clone(original, true);\n    };\n\n    var fromHtml$1 = function (html, scope) {\n      var doc = scope || domGlobals.document;\n      var div = doc.createElement('div');\n      div.innerHTML = html;\n      return children(Element.fromDom(div));\n    };\n\n    var get$3 = function (element) {\n      return element.dom().innerHTML;\n    };\n    var set$1 = function (element, content) {\n      var owner$1 = owner(element);\n      var docDom = owner$1.dom();\n      var fragment = Element.fromDom(docDom.createDocumentFragment());\n      var contentElements = fromHtml$1(content, docDom);\n      append$1(fragment, contentElements);\n      empty(element);\n      append(element, fragment);\n    };\n\n    var ZWSP = '\\uFEFF';\n    var isZwsp = function (chr) {\n      return chr === ZWSP;\n    };\n    var trim$3 = function (text) {\n      return text.replace(new RegExp(ZWSP, 'g'), '');\n    };\n    var Zwsp = {\n      isZwsp: isZwsp,\n      ZWSP: ZWSP,\n      trim: trim$3\n    };\n\n    var isElement$2 = NodeType.isElement;\n    var isText$2 = NodeType.isText;\n    var isCaretContainerBlock = function (node) {\n      if (isText$2(node)) {\n        node = node.parentNode;\n      }\n      return isElement$2(node) && node.hasAttribute('data-mce-caret');\n    };\n    var isCaretContainerInline = function (node) {\n      return isText$2(node) && Zwsp.isZwsp(node.data);\n    };\n    var isCaretContainer = function (node) {\n      return isCaretContainerBlock(node) || isCaretContainerInline(node);\n    };\n    var hasContent = function (node) {\n      return node.firstChild !== node.lastChild || !NodeType.isBr(node.firstChild);\n    };\n    var insertInline = function (node, before) {\n      var doc, sibling, textNode, parentNode;\n      doc = node.ownerDocument;\n      textNode = doc.createTextNode(Zwsp.ZWSP);\n      parentNode = node.parentNode;\n      if (!before) {\n        sibling = node.nextSibling;\n        if (isText$2(sibling)) {\n          if (isCaretContainer(sibling)) {\n            return sibling;\n          }\n          if (startsWithCaretContainer(sibling)) {\n            sibling.splitText(1);\n            return sibling;\n          }\n        }\n        if (node.nextSibling) {\n          parentNode.insertBefore(textNode, node.nextSibling);\n        } else {\n          parentNode.appendChild(textNode);\n        }\n      } else {\n        sibling = node.previousSibling;\n        if (isText$2(sibling)) {\n          if (isCaretContainer(sibling)) {\n            return sibling;\n          }\n          if (endsWithCaretContainer(sibling)) {\n            return sibling.splitText(sibling.data.length - 1);\n          }\n        }\n        parentNode.insertBefore(textNode, node);\n      }\n      return textNode;\n    };\n    var isBeforeInline = function (pos) {\n      var container = pos.container();\n      if (!pos || !NodeType.isText(container)) {\n        return false;\n      }\n      return container.data.charAt(pos.offset()) === Zwsp.ZWSP || pos.isAtStart() && isCaretContainerInline(container.previousSibling);\n    };\n    var isAfterInline = function (pos) {\n      var container = pos.container();\n      if (!pos || !NodeType.isText(container)) {\n        return false;\n      }\n      return container.data.charAt(pos.offset() - 1) === Zwsp.ZWSP || pos.isAtEnd() && isCaretContainerInline(container.nextSibling);\n    };\n    var createBogusBr = function () {\n      var br = domGlobals.document.createElement('br');\n      br.setAttribute('data-mce-bogus', '1');\n      return br;\n    };\n    var insertBlock = function (blockName, node, before) {\n      var doc, blockNode, parentNode;\n      doc = node.ownerDocument;\n      blockNode = doc.createElement(blockName);\n      blockNode.setAttribute('data-mce-caret', before ? 'before' : 'after');\n      blockNode.setAttribute('data-mce-bogus', 'all');\n      blockNode.appendChild(createBogusBr());\n      parentNode = node.parentNode;\n      if (!before) {\n        if (node.nextSibling) {\n          parentNode.insertBefore(blockNode, node.nextSibling);\n        } else {\n          parentNode.appendChild(blockNode);\n        }\n      } else {\n        parentNode.insertBefore(blockNode, node);\n      }\n      return blockNode;\n    };\n    var startsWithCaretContainer = function (node) {\n      return isText$2(node) && node.data[0] === Zwsp.ZWSP;\n    };\n    var endsWithCaretContainer = function (node) {\n      return isText$2(node) && node.data[node.data.length - 1] === Zwsp.ZWSP;\n    };\n    var trimBogusBr = function (elm) {\n      var brs = elm.getElementsByTagName('br');\n      var lastBr = brs[brs.length - 1];\n      if (NodeType.isBogus(lastBr)) {\n        lastBr.parentNode.removeChild(lastBr);\n      }\n    };\n    var showCaretContainerBlock = function (caretContainer) {\n      if (caretContainer && caretContainer.hasAttribute('data-mce-caret')) {\n        trimBogusBr(caretContainer);\n        caretContainer.removeAttribute('data-mce-caret');\n        caretContainer.removeAttribute('data-mce-bogus');\n        caretContainer.removeAttribute('style');\n        caretContainer.removeAttribute('_moz_abspos');\n        return caretContainer;\n      }\n      return null;\n    };\n    var isRangeInCaretContainerBlock = function (range) {\n      return isCaretContainerBlock(range.startContainer);\n    };\n\n    var isContentEditableTrue$1 = NodeType.isContentEditableTrue;\n    var isContentEditableFalse$1 = NodeType.isContentEditableFalse;\n    var isBr$2 = NodeType.isBr;\n    var isText$3 = NodeType.isText;\n    var isInvalidTextElement = NodeType.matchNodeNames('script style textarea');\n    var isAtomicInline = NodeType.matchNodeNames('img input textarea hr iframe video audio object');\n    var isTable$1 = NodeType.matchNodeNames('table');\n    var isCaretContainer$1 = isCaretContainer;\n    var isCaretCandidate = function (node) {\n      if (isCaretContainer$1(node)) {\n        return false;\n      }\n      if (isText$3(node)) {\n        if (isInvalidTextElement(node.parentNode)) {\n          return false;\n        }\n        return true;\n      }\n      return isAtomicInline(node) || isBr$2(node) || isTable$1(node) || isNonUiContentEditableFalse(node);\n    };\n    var isUnselectable = function (node) {\n      return NodeType.isElement(node) && node.getAttribute('unselectable') === 'true';\n    };\n    var isNonUiContentEditableFalse = function (node) {\n      return isUnselectable(node) === false && isContentEditableFalse$1(node);\n    };\n    var isInEditable = function (node, root) {\n      for (node = node.parentNode; node && node !== root; node = node.parentNode) {\n        if (isNonUiContentEditableFalse(node)) {\n          return false;\n        }\n        if (isContentEditableTrue$1(node)) {\n          return true;\n        }\n      }\n      return true;\n    };\n    var isAtomicContentEditableFalse = function (node) {\n      if (!isNonUiContentEditableFalse(node)) {\n        return false;\n      }\n      return foldl(from$1(node.getElementsByTagName('*')), function (result, elm) {\n        return result || isContentEditableTrue$1(elm);\n      }, false) !== true;\n    };\n    var isAtomic = function (node) {\n      return isAtomicInline(node) || isAtomicContentEditableFalse(node);\n    };\n    var isEditableCaretCandidate = function (node, root) {\n      return isCaretCandidate(node) && isInEditable(node, root);\n    };\n\n    var round = Math.round;\n    var clone$1 = function (rect) {\n      if (!rect) {\n        return {\n          left: 0,\n          top: 0,\n          bottom: 0,\n          right: 0,\n          width: 0,\n          height: 0\n        };\n      }\n      return {\n        left: round(rect.left),\n        top: round(rect.top),\n        bottom: round(rect.bottom),\n        right: round(rect.right),\n        width: round(rect.width),\n        height: round(rect.height)\n      };\n    };\n    var collapse = function (rect, toStart) {\n      rect = clone$1(rect);\n      if (toStart) {\n        rect.right = rect.left;\n      } else {\n        rect.left = rect.left + rect.width;\n        rect.right = rect.left;\n      }\n      rect.width = 0;\n      return rect;\n    };\n    var isEqual = function (rect1, rect2) {\n      return rect1.left === rect2.left && rect1.top === rect2.top && rect1.bottom === rect2.bottom && rect1.right === rect2.right;\n    };\n    var isValidOverflow = function (overflowY, rect1, rect2) {\n      return overflowY >= 0 && overflowY <= Math.min(rect1.height, rect2.height) / 2;\n    };\n    var isAbove = function (rect1, rect2) {\n      var halfHeight = Math.min(rect2.height / 2, rect1.height / 2);\n      if (rect1.bottom - halfHeight < rect2.top) {\n        return true;\n      }\n      if (rect1.top > rect2.bottom) {\n        return false;\n      }\n      return isValidOverflow(rect2.top - rect1.bottom, rect1, rect2);\n    };\n    var isBelow = function (rect1, rect2) {\n      if (rect1.top > rect2.bottom) {\n        return true;\n      }\n      if (rect1.bottom < rect2.top) {\n        return false;\n      }\n      return isValidOverflow(rect2.bottom - rect1.top, rect1, rect2);\n    };\n    var containsXY = function (rect, clientX, clientY) {\n      return clientX >= rect.left && clientX <= rect.right && clientY >= rect.top && clientY <= rect.bottom;\n    };\n    var overflowX = function (outer, inner) {\n      if (inner.left > outer.left && inner.right < outer.right) {\n        return 0;\n      } else {\n        return inner.left < outer.left ? inner.left - outer.left : inner.right - outer.right;\n      }\n    };\n    var overflowY = function (outer, inner) {\n      if (inner.top > outer.top && inner.bottom < outer.bottom) {\n        return 0;\n      } else {\n        return inner.top < outer.top ? inner.top - outer.top : inner.bottom - outer.bottom;\n      }\n    };\n    var getOverflow = function (outer, inner) {\n      return {\n        x: overflowX(outer, inner),\n        y: overflowY(outer, inner)\n      };\n    };\n\n    var getSelectedNode = function (range) {\n      var startContainer = range.startContainer, startOffset = range.startOffset;\n      if (startContainer.hasChildNodes() && range.endOffset === startOffset + 1) {\n        return startContainer.childNodes[startOffset];\n      }\n      return null;\n    };\n    var getNode = function (container, offset) {\n      if (container.nodeType === 1 && container.hasChildNodes()) {\n        if (offset >= container.childNodes.length) {\n          offset = container.childNodes.length - 1;\n        }\n        container = container.childNodes[offset];\n      }\n      return container;\n    };\n\n    var extendingChars = new RegExp('[\\u0300-\\u036f\\u0483-\\u0487\\u0488-\\u0489\\u0591-\\u05bd\\u05bf\\u05c1-\\u05c2\\u05c4-\\u05c5\\u05c7\\u0610-\\u061a' + '\\u064b-\\u065f\\u0670\\u06d6-\\u06dc\\u06df-\\u06e4\\u06e7-\\u06e8\\u06ea-\\u06ed\\u0711\\u0730-\\u074a\\u07a6-\\u07b0' + '\\u07eb-\\u07f3\\u0816-\\u0819\\u081b-\\u0823\\u0825-\\u0827\\u0829-\\u082d\\u0859-\\u085b\\u08e3-\\u0902\\u093a\\u093c' + '\\u0941-\\u0948\\u094d\\u0951-\\u0957\\u0962-\\u0963\\u0981\\u09bc\\u09be\\u09c1-\\u09c4\\u09cd\\u09d7\\u09e2-\\u09e3' + '\\u0a01-\\u0a02\\u0a3c\\u0a41-\\u0a42\\u0a47-\\u0a48\\u0a4b-\\u0a4d\\u0a51\\u0a70-\\u0a71\\u0a75\\u0a81-\\u0a82\\u0abc' + '\\u0ac1-\\u0ac5\\u0ac7-\\u0ac8\\u0acd\\u0ae2-\\u0ae3\\u0b01\\u0b3c\\u0b3e\\u0b3f\\u0b41-\\u0b44\\u0b4d\\u0b56\\u0b57' + '\\u0b62-\\u0b63\\u0b82\\u0bbe\\u0bc0\\u0bcd\\u0bd7\\u0c00\\u0c3e-\\u0c40\\u0c46-\\u0c48\\u0c4a-\\u0c4d\\u0c55-\\u0c56' + '\\u0c62-\\u0c63\\u0c81\\u0cbc\\u0cbf\\u0cc2\\u0cc6\\u0ccc-\\u0ccd\\u0cd5-\\u0cd6\\u0ce2-\\u0ce3\\u0d01\\u0d3e\\u0d41-\\u0d44' + '\\u0d4d\\u0d57\\u0d62-\\u0d63\\u0dca\\u0dcf\\u0dd2-\\u0dd4\\u0dd6\\u0ddf\\u0e31\\u0e34-\\u0e3a\\u0e47-\\u0e4e\\u0eb1\\u0eb4-\\u0eb9' + '\\u0ebb-\\u0ebc\\u0ec8-\\u0ecd\\u0f18-\\u0f19\\u0f35\\u0f37\\u0f39\\u0f71-\\u0f7e\\u0f80-\\u0f84\\u0f86-\\u0f87\\u0f8d-\\u0f97' + '\\u0f99-\\u0fbc\\u0fc6\\u102d-\\u1030\\u1032-\\u1037\\u1039-\\u103a\\u103d-\\u103e\\u1058-\\u1059\\u105e-\\u1060\\u1071-\\u1074' + '\\u1082\\u1085-\\u1086\\u108d\\u109d\\u135d-\\u135f\\u1712-\\u1714\\u1732-\\u1734\\u1752-\\u1753\\u1772-\\u1773\\u17b4-\\u17b5' + '\\u17b7-\\u17bd\\u17c6\\u17c9-\\u17d3\\u17dd\\u180b-\\u180d\\u18a9\\u1920-\\u1922\\u1927-\\u1928\\u1932\\u1939-\\u193b\\u1a17-\\u1a18' + '\\u1a1b\\u1a56\\u1a58-\\u1a5e\\u1a60\\u1a62\\u1a65-\\u1a6c\\u1a73-\\u1a7c\\u1a7f\\u1ab0-\\u1abd\\u1ABE\\u1b00-\\u1b03\\u1b34' + '\\u1b36-\\u1b3a\\u1b3c\\u1b42\\u1b6b-\\u1b73\\u1b80-\\u1b81\\u1ba2-\\u1ba5\\u1ba8-\\u1ba9\\u1bab-\\u1bad\\u1be6\\u1be8-\\u1be9' + '\\u1bed\\u1bef-\\u1bf1\\u1c2c-\\u1c33\\u1c36-\\u1c37\\u1cd0-\\u1cd2\\u1cd4-\\u1ce0\\u1ce2-\\u1ce8\\u1ced\\u1cf4\\u1cf8-\\u1cf9' + '\\u1dc0-\\u1df5\\u1dfc-\\u1dff\\u200c-\\u200d\\u20d0-\\u20dc\\u20DD-\\u20E0\\u20e1\\u20E2-\\u20E4\\u20e5-\\u20f0\\u2cef-\\u2cf1' + '\\u2d7f\\u2de0-\\u2dff\\u302a-\\u302d\\u302e-\\u302f\\u3099-\\u309a\\ua66f\\uA670-\\uA672\\ua674-\\ua67d\\ua69e-\\ua69f\\ua6f0-\\ua6f1' + '\\ua802\\ua806\\ua80b\\ua825-\\ua826\\ua8c4\\ua8e0-\\ua8f1\\ua926-\\ua92d\\ua947-\\ua951\\ua980-\\ua982\\ua9b3\\ua9b6-\\ua9b9\\ua9bc' + '\\ua9e5\\uaa29-\\uaa2e\\uaa31-\\uaa32\\uaa35-\\uaa36\\uaa43\\uaa4c\\uaa7c\\uaab0\\uaab2-\\uaab4\\uaab7-\\uaab8\\uaabe-\\uaabf\\uaac1' + '\\uaaec-\\uaaed\\uaaf6\\uabe5\\uabe8\\uabed\\ufb1e\\ufe00-\\ufe0f\\ufe20-\\ufe2f\\uff9e-\\uff9f]');\n    var isExtendingChar = function (ch) {\n      return typeof ch === 'string' && ch.charCodeAt(0) >= 768 && extendingChars.test(ch);\n    };\n\n    var lift2 = function (oa, ob, f) {\n      return oa.isSome() && ob.isSome() ? Option.some(f(oa.getOrDie(), ob.getOrDie())) : Option.none();\n    };\n    var lift3 = function (oa, ob, oc, f) {\n      return oa.isSome() && ob.isSome() && oc.isSome() ? Option.some(f(oa.getOrDie(), ob.getOrDie(), oc.getOrDie())) : Option.none();\n    };\n\n    var slice$2 = [].slice;\n    var or = function () {\n      var x = [];\n      for (var _i = 0; _i < arguments.length; _i++) {\n        x[_i] = arguments[_i];\n      }\n      var args = slice$2.call(arguments);\n      return function (x) {\n        for (var i = 0; i < args.length; i++) {\n          if (args[i](x)) {\n            return true;\n          }\n        }\n        return false;\n      };\n    };\n    var and = function () {\n      var x = [];\n      for (var _i = 0; _i < arguments.length; _i++) {\n        x[_i] = arguments[_i];\n      }\n      var args = slice$2.call(arguments);\n      return function (x) {\n        for (var i = 0; i < args.length; i++) {\n          if (!args[i](x)) {\n            return false;\n          }\n        }\n        return true;\n      };\n    };\n    var Predicate = {\n      and: and,\n      or: or\n    };\n\n    var isElement$3 = NodeType.isElement;\n    var isCaretCandidate$1 = isCaretCandidate;\n    var isBlock$1 = NodeType.matchStyleValues('display', 'block table');\n    var isFloated = NodeType.matchStyleValues('float', 'left right');\n    var isValidElementCaretCandidate = Predicate.and(isElement$3, isCaretCandidate$1, not(isFloated));\n    var isNotPre = not(NodeType.matchStyleValues('white-space', 'pre pre-line pre-wrap'));\n    var isText$4 = NodeType.isText;\n    var isBr$3 = NodeType.isBr;\n    var nodeIndex = DOMUtils$1.nodeIndex;\n    var resolveIndex = getNode;\n    var createRange = function (doc) {\n      return 'createRange' in doc ? doc.createRange() : DOMUtils$1.DOM.createRng();\n    };\n    var isWhiteSpace = function (chr) {\n      return chr && /[\\r\\n\\t ]/.test(chr);\n    };\n    var isRange = function (rng) {\n      return !!rng.setStart && !!rng.setEnd;\n    };\n    var isHiddenWhiteSpaceRange = function (range) {\n      var container = range.startContainer;\n      var offset = range.startOffset;\n      var text;\n      if (isWhiteSpace(range.toString()) && isNotPre(container.parentNode) && NodeType.isText(container)) {\n        text = container.data;\n        if (isWhiteSpace(text[offset - 1]) || isWhiteSpace(text[offset + 1])) {\n          return true;\n        }\n      }\n      return false;\n    };\n    var getBrClientRect = function (brNode) {\n      var doc = brNode.ownerDocument;\n      var rng = createRange(doc);\n      var nbsp = doc.createTextNode('\\xA0');\n      var parentNode = brNode.parentNode;\n      var clientRect;\n      parentNode.insertBefore(nbsp, brNode);\n      rng.setStart(nbsp, 0);\n      rng.setEnd(nbsp, 1);\n      clientRect = clone$1(rng.getBoundingClientRect());\n      parentNode.removeChild(nbsp);\n      return clientRect;\n    };\n    var getBoundingClientRectWebKitText = function (rng) {\n      var sc = rng.startContainer;\n      var ec = rng.endContainer;\n      var so = rng.startOffset;\n      var eo = rng.endOffset;\n      if (sc === ec && NodeType.isText(ec) && so === 0 && eo === 1) {\n        var newRng = rng.cloneRange();\n        newRng.setEndAfter(ec);\n        return getBoundingClientRect(newRng);\n      } else {\n        return null;\n      }\n    };\n    var isZeroRect = function (r) {\n      return r.left === 0 && r.right === 0 && r.top === 0 && r.bottom === 0;\n    };\n    var getBoundingClientRect = function (item) {\n      var clientRect, clientRects;\n      clientRects = item.getClientRects();\n      if (clientRects.length > 0) {\n        clientRect = clone$1(clientRects[0]);\n      } else {\n        clientRect = clone$1(item.getBoundingClientRect());\n      }\n      if (!isRange(item) && isBr$3(item) && isZeroRect(clientRect)) {\n        return getBrClientRect(item);\n      }\n      if (isZeroRect(clientRect) && isRange(item)) {\n        return getBoundingClientRectWebKitText(item);\n      }\n      return clientRect;\n    };\n    var collapseAndInflateWidth = function (clientRect, toStart) {\n      var newClientRect = collapse(clientRect, toStart);\n      newClientRect.width = 1;\n      newClientRect.right = newClientRect.left + 1;\n      return newClientRect;\n    };\n    var getCaretPositionClientRects = function (caretPosition) {\n      var clientRects = [];\n      var beforeNode, node;\n      var addUniqueAndValidRect = function (clientRect) {\n        if (clientRect.height === 0) {\n          return;\n        }\n        if (clientRects.length > 0) {\n          if (isEqual(clientRect, clientRects[clientRects.length - 1])) {\n            return;\n          }\n        }\n        clientRects.push(clientRect);\n      };\n      var addCharacterOffset = function (container, offset) {\n        var range = createRange(container.ownerDocument);\n        if (offset < container.data.length) {\n          if (isExtendingChar(container.data[offset])) {\n            return clientRects;\n          }\n          if (isExtendingChar(container.data[offset - 1])) {\n            range.setStart(container, offset);\n            range.setEnd(container, offset + 1);\n            if (!isHiddenWhiteSpaceRange(range)) {\n              addUniqueAndValidRect(collapseAndInflateWidth(getBoundingClientRect(range), false));\n              return clientRects;\n            }\n          }\n        }\n        if (offset > 0) {\n          range.setStart(container, offset - 1);\n          range.setEnd(container, offset);\n          if (!isHiddenWhiteSpaceRange(range)) {\n            addUniqueAndValidRect(collapseAndInflateWidth(getBoundingClientRect(range), false));\n          }\n        }\n        if (offset < container.data.length) {\n          range.setStart(container, offset);\n          range.setEnd(container, offset + 1);\n          if (!isHiddenWhiteSpaceRange(range)) {\n            addUniqueAndValidRect(collapseAndInflateWidth(getBoundingClientRect(range), true));\n          }\n        }\n      };\n      if (isText$4(caretPosition.container())) {\n        addCharacterOffset(caretPosition.container(), caretPosition.offset());\n        return clientRects;\n      }\n      if (isElement$3(caretPosition.container())) {\n        if (caretPosition.isAtEnd()) {\n          node = resolveIndex(caretPosition.container(), caretPosition.offset());\n          if (isText$4(node)) {\n            addCharacterOffset(node, node.data.length);\n          }\n          if (isValidElementCaretCandidate(node) && !isBr$3(node)) {\n            addUniqueAndValidRect(collapseAndInflateWidth(getBoundingClientRect(node), false));\n          }\n        } else {\n          node = resolveIndex(caretPosition.container(), caretPosition.offset());\n          if (isText$4(node)) {\n            addCharacterOffset(node, 0);\n          }\n          if (isValidElementCaretCandidate(node) && caretPosition.isAtEnd()) {\n            addUniqueAndValidRect(collapseAndInflateWidth(getBoundingClientRect(node), false));\n            return clientRects;\n          }\n          beforeNode = resolveIndex(caretPosition.container(), caretPosition.offset() - 1);\n          if (isValidElementCaretCandidate(beforeNode) && !isBr$3(beforeNode)) {\n            if (isBlock$1(beforeNode) || isBlock$1(node) || !isValidElementCaretCandidate(node)) {\n              addUniqueAndValidRect(collapseAndInflateWidth(getBoundingClientRect(beforeNode), false));\n            }\n          }\n          if (isValidElementCaretCandidate(node)) {\n            addUniqueAndValidRect(collapseAndInflateWidth(getBoundingClientRect(node), true));\n          }\n        }\n      }\n      return clientRects;\n    };\n    function CaretPosition(container, offset, clientRects) {\n      var isAtStart = function () {\n        if (isText$4(container)) {\n          return offset === 0;\n        }\n        return offset === 0;\n      };\n      var isAtEnd = function () {\n        if (isText$4(container)) {\n          return offset >= container.data.length;\n        }\n        return offset >= container.childNodes.length;\n      };\n      var toRange = function () {\n        var range;\n        range = createRange(container.ownerDocument);\n        range.setStart(container, offset);\n        range.setEnd(container, offset);\n        return range;\n      };\n      var getClientRects = function () {\n        if (!clientRects) {\n          clientRects = getCaretPositionClientRects(CaretPosition(container, offset));\n        }\n        return clientRects;\n      };\n      var isVisible = function () {\n        return getClientRects().length > 0;\n      };\n      var isEqual = function (caretPosition) {\n        return caretPosition && container === caretPosition.container() && offset === caretPosition.offset();\n      };\n      var getNode = function (before) {\n        return resolveIndex(container, before ? offset - 1 : offset);\n      };\n      return {\n        container: constant(container),\n        offset: constant(offset),\n        toRange: toRange,\n        getClientRects: getClientRects,\n        isVisible: isVisible,\n        isAtStart: isAtStart,\n        isAtEnd: isAtEnd,\n        isEqual: isEqual,\n        getNode: getNode\n      };\n    }\n    (function (CaretPosition) {\n      CaretPosition.fromRangeStart = function (range) {\n        return CaretPosition(range.startContainer, range.startOffset);\n      };\n      CaretPosition.fromRangeEnd = function (range) {\n        return CaretPosition(range.endContainer, range.endOffset);\n      };\n      CaretPosition.after = function (node) {\n        return CaretPosition(node.parentNode, nodeIndex(node) + 1);\n      };\n      CaretPosition.before = function (node) {\n        return CaretPosition(node.parentNode, nodeIndex(node));\n      };\n      CaretPosition.isAbove = function (pos1, pos2) {\n        return lift2(head(pos2.getClientRects()), last(pos1.getClientRects()), isAbove).getOr(false);\n      };\n      CaretPosition.isBelow = function (pos1, pos2) {\n        return lift2(last(pos2.getClientRects()), head(pos1.getClientRects()), isBelow).getOr(false);\n      };\n      CaretPosition.isAtStart = function (pos) {\n        return pos ? pos.isAtStart() : false;\n      };\n      CaretPosition.isAtEnd = function (pos) {\n        return pos ? pos.isAtEnd() : false;\n      };\n      CaretPosition.isTextPosition = function (pos) {\n        return pos ? NodeType.isText(pos.container()) : false;\n      };\n      CaretPosition.isElementPosition = function (pos) {\n        return CaretPosition.isTextPosition(pos) === false;\n      };\n    }(CaretPosition || (CaretPosition = {})));\n    var CaretPosition$1 = CaretPosition;\n\n    var isText$5 = NodeType.isText;\n    var isBogus$1 = NodeType.isBogus;\n    var nodeIndex$1 = DOMUtils$1.nodeIndex;\n    var normalizedParent = function (node) {\n      var parentNode = node.parentNode;\n      if (isBogus$1(parentNode)) {\n        return normalizedParent(parentNode);\n      }\n      return parentNode;\n    };\n    var getChildNodes = function (node) {\n      if (!node) {\n        return [];\n      }\n      return ArrUtils.reduce(node.childNodes, function (result, node) {\n        if (isBogus$1(node) && node.nodeName !== 'BR') {\n          result = result.concat(getChildNodes(node));\n        } else {\n          result.push(node);\n        }\n        return result;\n      }, []);\n    };\n    var normalizedTextOffset = function (node, offset) {\n      while (node = node.previousSibling) {\n        if (!isText$5(node)) {\n          break;\n        }\n        offset += node.data.length;\n      }\n      return offset;\n    };\n    var equal = function (a) {\n      return function (b) {\n        return a === b;\n      };\n    };\n    var normalizedNodeIndex = function (node) {\n      var nodes, index, numTextFragments;\n      nodes = getChildNodes(normalizedParent(node));\n      index = ArrUtils.findIndex(nodes, equal(node), node);\n      nodes = nodes.slice(0, index + 1);\n      numTextFragments = ArrUtils.reduce(nodes, function (result, node, i) {\n        if (isText$5(node) && isText$5(nodes[i - 1])) {\n          result++;\n        }\n        return result;\n      }, 0);\n      nodes = ArrUtils.filter(nodes, NodeType.matchNodeNames(node.nodeName));\n      index = ArrUtils.findIndex(nodes, equal(node), node);\n      return index - numTextFragments;\n    };\n    var createPathItem = function (node) {\n      var name;\n      if (isText$5(node)) {\n        name = 'text()';\n      } else {\n        name = node.nodeName.toLowerCase();\n      }\n      return name + '[' + normalizedNodeIndex(node) + ']';\n    };\n    var parentsUntil = function (root, node, predicate) {\n      var parents = [];\n      for (node = node.parentNode; node !== root; node = node.parentNode) {\n        if (predicate && predicate(node)) {\n          break;\n        }\n        parents.push(node);\n      }\n      return parents;\n    };\n    var create$2 = function (root, caretPosition) {\n      var container, offset, path = [], outputOffset, childNodes, parents;\n      container = caretPosition.container();\n      offset = caretPosition.offset();\n      if (isText$5(container)) {\n        outputOffset = normalizedTextOffset(container, offset);\n      } else {\n        childNodes = container.childNodes;\n        if (offset >= childNodes.length) {\n          outputOffset = 'after';\n          offset = childNodes.length - 1;\n        } else {\n          outputOffset = 'before';\n        }\n        container = childNodes[offset];\n      }\n      path.push(createPathItem(container));\n      parents = parentsUntil(root, container);\n      parents = ArrUtils.filter(parents, not(NodeType.isBogus));\n      path = path.concat(ArrUtils.map(parents, function (node) {\n        return createPathItem(node);\n      }));\n      return path.reverse().join('/') + ',' + outputOffset;\n    };\n    var resolvePathItem = function (node, name, index) {\n      var nodes = getChildNodes(node);\n      nodes = ArrUtils.filter(nodes, function (node, index) {\n        return !isText$5(node) || !isText$5(nodes[index - 1]);\n      });\n      nodes = ArrUtils.filter(nodes, NodeType.matchNodeNames(name));\n      return nodes[index];\n    };\n    var findTextPosition = function (container, offset) {\n      var node = container, targetOffset = 0, dataLen;\n      while (isText$5(node)) {\n        dataLen = node.data.length;\n        if (offset >= targetOffset && offset <= targetOffset + dataLen) {\n          container = node;\n          offset = offset - targetOffset;\n          break;\n        }\n        if (!isText$5(node.nextSibling)) {\n          container = node;\n          offset = dataLen;\n          break;\n        }\n        targetOffset += dataLen;\n        node = node.nextSibling;\n      }\n      if (isText$5(container) && offset > container.data.length) {\n        offset = container.data.length;\n      }\n      return CaretPosition$1(container, offset);\n    };\n    var resolve$2 = function (root, path) {\n      var parts, container, offset;\n      if (!path) {\n        return null;\n      }\n      parts = path.split(',');\n      path = parts[0].split('/');\n      offset = parts.length > 1 ? parts[1] : 'before';\n      container = ArrUtils.reduce(path, function (result, value) {\n        value = /([\\w\\-\\(\\)]+)\\[([0-9]+)\\]/.exec(value);\n        if (!value) {\n          return null;\n        }\n        if (value[1] === 'text()') {\n          value[1] = '#text';\n        }\n        return resolvePathItem(result, value[1], parseInt(value[2], 10));\n      }, root);\n      if (!container) {\n        return null;\n      }\n      if (!isText$5(container)) {\n        if (offset === 'after') {\n          offset = nodeIndex$1(container) + 1;\n        } else {\n          offset = nodeIndex$1(container);\n        }\n        return CaretPosition$1(container.parentNode, offset);\n      }\n      return findTextPosition(container, parseInt(offset, 10));\n    };\n\n    var trimEmptyTextNode = function (dom, node) {\n      if (NodeType.isText(node) && node.data.length === 0) {\n        dom.remove(node);\n      }\n    };\n    var insertNode = function (dom, rng, node) {\n      rng.insertNode(node);\n      trimEmptyTextNode(dom, node.previousSibling);\n      trimEmptyTextNode(dom, node.nextSibling);\n    };\n    var insertFragment = function (dom, rng, frag) {\n      var firstChild = Option.from(frag.firstChild);\n      var lastChild = Option.from(frag.lastChild);\n      rng.insertNode(frag);\n      firstChild.each(function (child) {\n        return trimEmptyTextNode(dom, child.previousSibling);\n      });\n      lastChild.each(function (child) {\n        return trimEmptyTextNode(dom, child.nextSibling);\n      });\n    };\n    var rangeInsertNode = function (dom, rng, node) {\n      if (NodeType.isDocumentFragment(node)) {\n        insertFragment(dom, rng, node);\n      } else {\n        insertNode(dom, rng, node);\n      }\n    };\n\n    var isContentEditableFalse$2 = NodeType.isContentEditableFalse;\n    var getNormalizedTextOffset = function (trim, container, offset) {\n      var node, trimmedOffset;\n      trimmedOffset = trim(container.data.slice(0, offset)).length;\n      for (node = container.previousSibling; node && NodeType.isText(node); node = node.previousSibling) {\n        trimmedOffset += trim(node.data).length;\n      }\n      return trimmedOffset;\n    };\n    var getPoint = function (dom, trim, normalized, rng, start) {\n      var container = rng[start ? 'startContainer' : 'endContainer'];\n      var offset = rng[start ? 'startOffset' : 'endOffset'];\n      var point = [];\n      var childNodes, after = 0;\n      var root = dom.getRoot();\n      if (NodeType.isText(container)) {\n        point.push(normalized ? getNormalizedTextOffset(trim, container, offset) : offset);\n      } else {\n        childNodes = container.childNodes;\n        if (offset >= childNodes.length && childNodes.length) {\n          after = 1;\n          offset = Math.max(0, childNodes.length - 1);\n        }\n        point.push(dom.nodeIndex(childNodes[offset], normalized) + after);\n      }\n      for (; container && container !== root; container = container.parentNode) {\n        point.push(dom.nodeIndex(container, normalized));\n      }\n      return point;\n    };\n    var getLocation = function (trim, selection, normalized, rng) {\n      var dom = selection.dom, bookmark = {};\n      bookmark.start = getPoint(dom, trim, normalized, rng, true);\n      if (!selection.isCollapsed()) {\n        bookmark.end = getPoint(dom, trim, normalized, rng, false);\n      }\n      return bookmark;\n    };\n    var findIndex$2 = function (dom, name, element) {\n      var count = 0;\n      Tools.each(dom.select(name), function (node) {\n        if (node.getAttribute('data-mce-bogus') === 'all') {\n          return;\n        }\n        if (node === element) {\n          return false;\n        }\n        count++;\n      });\n      return count;\n    };\n    var moveEndPoint = function (rng, start) {\n      var container, offset, childNodes;\n      var prefix = start ? 'start' : 'end';\n      container = rng[prefix + 'Container'];\n      offset = rng[prefix + 'Offset'];\n      if (NodeType.isElement(container) && container.nodeName === 'TR') {\n        childNodes = container.childNodes;\n        container = childNodes[Math.min(start ? offset : offset - 1, childNodes.length - 1)];\n        if (container) {\n          offset = start ? 0 : container.childNodes.length;\n          rng['set' + (start ? 'Start' : 'End')](container, offset);\n        }\n      }\n    };\n    var normalizeTableCellSelection = function (rng) {\n      moveEndPoint(rng, true);\n      moveEndPoint(rng, false);\n      return rng;\n    };\n    var findSibling = function (node, offset) {\n      var sibling;\n      if (NodeType.isElement(node)) {\n        node = getNode(node, offset);\n        if (isContentEditableFalse$2(node)) {\n          return node;\n        }\n      }\n      if (isCaretContainer(node)) {\n        if (NodeType.isText(node) && isCaretContainerBlock(node)) {\n          node = node.parentNode;\n        }\n        sibling = node.previousSibling;\n        if (isContentEditableFalse$2(sibling)) {\n          return sibling;\n        }\n        sibling = node.nextSibling;\n        if (isContentEditableFalse$2(sibling)) {\n          return sibling;\n        }\n      }\n    };\n    var findAdjacentContentEditableFalseElm = function (rng) {\n      return findSibling(rng.startContainer, rng.startOffset) || findSibling(rng.endContainer, rng.endOffset);\n    };\n    var getOffsetBookmark = function (trim, normalized, selection) {\n      var element = selection.getNode();\n      var name = element ? element.nodeName : null;\n      var rng = selection.getRng();\n      if (isContentEditableFalse$2(element) || name === 'IMG') {\n        return {\n          name: name,\n          index: findIndex$2(selection.dom, name, element)\n        };\n      }\n      var sibling = findAdjacentContentEditableFalseElm(rng);\n      if (sibling) {\n        name = sibling.tagName;\n        return {\n          name: name,\n          index: findIndex$2(selection.dom, name, sibling)\n        };\n      }\n      return getLocation(trim, selection, normalized, rng);\n    };\n    var getCaretBookmark = function (selection) {\n      var rng = selection.getRng();\n      return {\n        start: create$2(selection.dom.getRoot(), CaretPosition$1.fromRangeStart(rng)),\n        end: create$2(selection.dom.getRoot(), CaretPosition$1.fromRangeEnd(rng))\n      };\n    };\n    var getRangeBookmark = function (selection) {\n      return { rng: selection.getRng() };\n    };\n    var createBookmarkSpan = function (dom, id, filled) {\n      var args = {\n        'data-mce-type': 'bookmark',\n        'id': id,\n        'style': 'overflow:hidden;line-height:0px'\n      };\n      return filled ? dom.create('span', args, '&#xFEFF;') : dom.create('span', args);\n    };\n    var getPersistentBookmark = function (selection, filled) {\n      var dom = selection.dom;\n      var rng = selection.getRng();\n      var id = dom.uniqueId();\n      var collapsed = selection.isCollapsed();\n      var element = selection.getNode();\n      var name = element.nodeName;\n      if (name === 'IMG') {\n        return {\n          name: name,\n          index: findIndex$2(dom, name, element)\n        };\n      }\n      var rng2 = normalizeTableCellSelection(rng.cloneRange());\n      if (!collapsed) {\n        rng2.collapse(false);\n        var endBookmarkNode = createBookmarkSpan(dom, id + '_end', filled);\n        rangeInsertNode(dom, rng2, endBookmarkNode);\n      }\n      rng = normalizeTableCellSelection(rng);\n      rng.collapse(true);\n      var startBookmarkNode = createBookmarkSpan(dom, id + '_start', filled);\n      rangeInsertNode(dom, rng, startBookmarkNode);\n      selection.moveToBookmark({\n        id: id,\n        keep: 1\n      });\n      return { id: id };\n    };\n    var getBookmark = function (selection, type, normalized) {\n      if (type === 2) {\n        return getOffsetBookmark(Zwsp.trim, normalized, selection);\n      } else if (type === 3) {\n        return getCaretBookmark(selection);\n      } else if (type) {\n        return getRangeBookmark(selection);\n      } else {\n        return getPersistentBookmark(selection, false);\n      }\n    };\n    var GetBookmark = {\n      getBookmark: getBookmark,\n      getUndoBookmark: curry(getOffsetBookmark, identity, true),\n      getPersistentBookmark: getPersistentBookmark\n    };\n\n    var CARET_ID = '_mce_caret';\n    var isCaretNode = function (node) {\n      return NodeType.isElement(node) && node.id === CARET_ID;\n    };\n    var getParentCaretContainer = function (body, node) {\n      while (node && node !== body) {\n        if (node.id === CARET_ID) {\n          return node;\n        }\n        node = node.parentNode;\n      }\n      return null;\n    };\n\n    var isElement$4 = NodeType.isElement;\n    var isText$6 = NodeType.isText;\n    var removeNode = function (node) {\n      var parentNode = node.parentNode;\n      if (parentNode) {\n        parentNode.removeChild(node);\n      }\n    };\n    var getNodeValue = function (node) {\n      try {\n        return node.nodeValue;\n      } catch (ex) {\n        return '';\n      }\n    };\n    var setNodeValue = function (node, text) {\n      if (text.length === 0) {\n        removeNode(node);\n      } else {\n        node.nodeValue = text;\n      }\n    };\n    var trimCount = function (text) {\n      var trimmedText = Zwsp.trim(text);\n      return {\n        count: text.length - trimmedText.length,\n        text: trimmedText\n      };\n    };\n    var removeUnchanged = function (caretContainer, pos) {\n      remove$5(caretContainer);\n      return pos;\n    };\n    var removeTextAndReposition = function (caretContainer, pos) {\n      var before = trimCount(caretContainer.data.substr(0, pos.offset()));\n      var after = trimCount(caretContainer.data.substr(pos.offset()));\n      var text = before.text + after.text;\n      if (text.length > 0) {\n        setNodeValue(caretContainer, text);\n        return CaretPosition$1(caretContainer, pos.offset() - before.count);\n      } else {\n        return pos;\n      }\n    };\n    var removeElementAndReposition = function (caretContainer, pos) {\n      var parentNode = pos.container();\n      var newPosition = indexOf(from$1(parentNode.childNodes), caretContainer).map(function (index) {\n        return index < pos.offset() ? CaretPosition$1(parentNode, pos.offset() - 1) : pos;\n      }).getOr(pos);\n      remove$5(caretContainer);\n      return newPosition;\n    };\n    var removeTextCaretContainer = function (caretContainer, pos) {\n      return isText$6(caretContainer) && pos.container() === caretContainer ? removeTextAndReposition(caretContainer, pos) : removeUnchanged(caretContainer, pos);\n    };\n    var removeElementCaretContainer = function (caretContainer, pos) {\n      return pos.container() === caretContainer.parentNode ? removeElementAndReposition(caretContainer, pos) : removeUnchanged(caretContainer, pos);\n    };\n    var removeAndReposition = function (container, pos) {\n      return CaretPosition$1.isTextPosition(pos) ? removeTextCaretContainer(container, pos) : removeElementCaretContainer(container, pos);\n    };\n    var remove$5 = function (caretContainerNode) {\n      if (isElement$4(caretContainerNode) && isCaretContainer(caretContainerNode)) {\n        if (hasContent(caretContainerNode)) {\n          caretContainerNode.removeAttribute('data-mce-caret');\n        } else {\n          removeNode(caretContainerNode);\n        }\n      }\n      if (isText$6(caretContainerNode)) {\n        var text = Zwsp.trim(getNodeValue(caretContainerNode));\n        setNodeValue(caretContainerNode, text);\n      }\n    };\n    var CaretContainerRemove = {\n      removeAndReposition: removeAndReposition,\n      remove: remove$5\n    };\n\n    var browser$2 = PlatformDetection$1.detect().browser;\n    var isContentEditableFalse$3 = NodeType.isContentEditableFalse;\n    var isTableCell$1 = function (node) {\n      return NodeType.isElement(node) && /^(TD|TH)$/i.test(node.tagName);\n    };\n    var getAbsoluteClientRect = function (root, element, before) {\n      var clientRect = collapse(element.getBoundingClientRect(), before);\n      var docElm, scrollX, scrollY, margin, rootRect;\n      if (root.tagName === 'BODY') {\n        docElm = root.ownerDocument.documentElement;\n        scrollX = root.scrollLeft || docElm.scrollLeft;\n        scrollY = root.scrollTop || docElm.scrollTop;\n      } else {\n        rootRect = root.getBoundingClientRect();\n        scrollX = root.scrollLeft - rootRect.left;\n        scrollY = root.scrollTop - rootRect.top;\n      }\n      clientRect.left += scrollX;\n      clientRect.right += scrollX;\n      clientRect.top += scrollY;\n      clientRect.bottom += scrollY;\n      clientRect.width = 1;\n      margin = element.offsetWidth - element.clientWidth;\n      if (margin > 0) {\n        if (before) {\n          margin *= -1;\n        }\n        clientRect.left += margin;\n        clientRect.right += margin;\n      }\n      return clientRect;\n    };\n    var trimInlineCaretContainers = function (root) {\n      var contentEditableFalseNodes, node, sibling, i, data;\n      contentEditableFalseNodes = DomQuery('*[contentEditable=false]', root);\n      for (i = 0; i < contentEditableFalseNodes.length; i++) {\n        node = contentEditableFalseNodes[i];\n        sibling = node.previousSibling;\n        if (endsWithCaretContainer(sibling)) {\n          data = sibling.data;\n          if (data.length === 1) {\n            sibling.parentNode.removeChild(sibling);\n          } else {\n            sibling.deleteData(data.length - 1, 1);\n          }\n        }\n        sibling = node.nextSibling;\n        if (startsWithCaretContainer(sibling)) {\n          data = sibling.data;\n          if (data.length === 1) {\n            sibling.parentNode.removeChild(sibling);\n          } else {\n            sibling.deleteData(0, 1);\n          }\n        }\n      }\n    };\n    var FakeCaret = function (root, isBlock, hasFocus) {\n      var lastVisualCaret = Cell(Option.none());\n      var cursorInterval, caretContainerNode;\n      var show = function (before, element) {\n        var clientRect, rng;\n        hide();\n        if (isTableCell$1(element)) {\n          return null;\n        }\n        if (isBlock(element)) {\n          caretContainerNode = insertBlock('p', element, before);\n          clientRect = getAbsoluteClientRect(root, element, before);\n          DomQuery(caretContainerNode).css('top', clientRect.top);\n          var caret = DomQuery('<div class=\"mce-visual-caret\" data-mce-bogus=\"all\"></div>').css(clientRect).appendTo(root)[0];\n          lastVisualCaret.set(Option.some({\n            caret: caret,\n            element: element,\n            before: before\n          }));\n          lastVisualCaret.get().each(function (caretState) {\n            if (before) {\n              DomQuery(caretState.caret).addClass('mce-visual-caret-before');\n            }\n          });\n          startBlink();\n          rng = element.ownerDocument.createRange();\n          rng.setStart(caretContainerNode, 0);\n          rng.setEnd(caretContainerNode, 0);\n        } else {\n          caretContainerNode = insertInline(element, before);\n          rng = element.ownerDocument.createRange();\n          if (isContentEditableFalse$3(caretContainerNode.nextSibling)) {\n            rng.setStart(caretContainerNode, 0);\n            rng.setEnd(caretContainerNode, 0);\n          } else {\n            rng.setStart(caretContainerNode, 1);\n            rng.setEnd(caretContainerNode, 1);\n          }\n          return rng;\n        }\n        return rng;\n      };\n      var hide = function () {\n        trimInlineCaretContainers(root);\n        if (caretContainerNode) {\n          CaretContainerRemove.remove(caretContainerNode);\n          caretContainerNode = null;\n        }\n        lastVisualCaret.get().each(function (caretState) {\n          DomQuery(caretState.caret).remove();\n          lastVisualCaret.set(Option.none());\n        });\n        clearInterval(cursorInterval);\n      };\n      var startBlink = function () {\n        cursorInterval = Delay.setInterval(function () {\n          if (hasFocus()) {\n            DomQuery('div.mce-visual-caret', root).toggleClass('mce-visual-caret-hidden');\n          } else {\n            DomQuery('div.mce-visual-caret', root).addClass('mce-visual-caret-hidden');\n          }\n        }, 500);\n      };\n      var reposition = function () {\n        lastVisualCaret.get().each(function (caretState) {\n          var clientRect = getAbsoluteClientRect(root, caretState.element, caretState.before);\n          DomQuery(caretState.caret).css(clientRect);\n        });\n      };\n      var destroy = function () {\n        return Delay.clearInterval(cursorInterval);\n      };\n      var getCss = function () {\n        return '.mce-visual-caret {' + 'position: absolute;' + 'background-color: black;' + 'background-color: currentcolor;' + '}' + '.mce-visual-caret-hidden {' + 'display: none;' + '}' + '*[data-mce-caret] {' + 'position: absolute;' + 'left: -1000px;' + 'right: auto;' + 'top: 0;' + 'margin: 0;' + 'padding: 0;' + '}';\n      };\n      return {\n        show: show,\n        hide: hide,\n        getCss: getCss,\n        reposition: reposition,\n        destroy: destroy\n      };\n    };\n    var isFakeCaretTableBrowser = function () {\n      return browser$2.isIE() || browser$2.isEdge() || browser$2.isFirefox();\n    };\n    var isFakeCaretTarget = function (node) {\n      return isContentEditableFalse$3(node) || NodeType.isTable(node) && isFakeCaretTableBrowser();\n    };\n\n    var isContentEditableFalse$4 = NodeType.isContentEditableFalse;\n    var isBlockLike = NodeType.matchStyleValues('display', 'block table table-cell table-caption list-item');\n    var isCaretContainer$2 = isCaretContainer;\n    var isCaretContainerBlock$1 = isCaretContainerBlock;\n    var isElement$5 = NodeType.isElement;\n    var isCaretCandidate$2 = isCaretCandidate;\n    var isForwards = function (direction) {\n      return direction > 0;\n    };\n    var isBackwards = function (direction) {\n      return direction < 0;\n    };\n    var skipCaretContainers = function (walk, shallow) {\n      var node;\n      while (node = walk(shallow)) {\n        if (!isCaretContainerBlock$1(node)) {\n          return node;\n        }\n      }\n      return null;\n    };\n    var findNode = function (node, direction, predicateFn, rootNode, shallow) {\n      var walker = new TreeWalker(node, rootNode);\n      if (isBackwards(direction)) {\n        if (isContentEditableFalse$4(node) || isCaretContainerBlock$1(node)) {\n          node = skipCaretContainers(walker.prev, true);\n          if (predicateFn(node)) {\n            return node;\n          }\n        }\n        while (node = skipCaretContainers(walker.prev, shallow)) {\n          if (predicateFn(node)) {\n            return node;\n          }\n        }\n      }\n      if (isForwards(direction)) {\n        if (isContentEditableFalse$4(node) || isCaretContainerBlock$1(node)) {\n          node = skipCaretContainers(walker.next, true);\n          if (predicateFn(node)) {\n            return node;\n          }\n        }\n        while (node = skipCaretContainers(walker.next, shallow)) {\n          if (predicateFn(node)) {\n            return node;\n          }\n        }\n      }\n      return null;\n    };\n    var getParentBlock = function (node, rootNode) {\n      while (node && node !== rootNode) {\n        if (isBlockLike(node)) {\n          return node;\n        }\n        node = node.parentNode;\n      }\n      return null;\n    };\n    var isInSameBlock = function (caretPosition1, caretPosition2, rootNode) {\n      return getParentBlock(caretPosition1.container(), rootNode) === getParentBlock(caretPosition2.container(), rootNode);\n    };\n    var getChildNodeAtRelativeOffset = function (relativeOffset, caretPosition) {\n      var container, offset;\n      if (!caretPosition) {\n        return null;\n      }\n      container = caretPosition.container();\n      offset = caretPosition.offset();\n      if (!isElement$5(container)) {\n        return null;\n      }\n      return container.childNodes[offset + relativeOffset];\n    };\n    var beforeAfter = function (before, node) {\n      var range = node.ownerDocument.createRange();\n      if (before) {\n        range.setStartBefore(node);\n        range.setEndBefore(node);\n      } else {\n        range.setStartAfter(node);\n        range.setEndAfter(node);\n      }\n      return range;\n    };\n    var isNodesInSameBlock = function (root, node1, node2) {\n      return getParentBlock(node1, root) === getParentBlock(node2, root);\n    };\n    var lean = function (left, root, node) {\n      var sibling, siblingName;\n      if (left) {\n        siblingName = 'previousSibling';\n      } else {\n        siblingName = 'nextSibling';\n      }\n      while (node && node !== root) {\n        sibling = node[siblingName];\n        if (isCaretContainer$2(sibling)) {\n          sibling = sibling[siblingName];\n        }\n        if (isContentEditableFalse$4(sibling)) {\n          if (isNodesInSameBlock(root, sibling, node)) {\n            return sibling;\n          }\n          break;\n        }\n        if (isCaretCandidate$2(sibling)) {\n          break;\n        }\n        node = node.parentNode;\n      }\n      return null;\n    };\n    var before$2 = curry(beforeAfter, true);\n    var after$1 = curry(beforeAfter, false);\n    var normalizeRange = function (direction, root, range) {\n      var node, container, offset, location;\n      var leanLeft = curry(lean, true, root);\n      var leanRight = curry(lean, false, root);\n      container = range.startContainer;\n      offset = range.startOffset;\n      if (isCaretContainerBlock(container)) {\n        if (!isElement$5(container)) {\n          container = container.parentNode;\n        }\n        location = container.getAttribute('data-mce-caret');\n        if (location === 'before') {\n          node = container.nextSibling;\n          if (isFakeCaretTarget(node)) {\n            return before$2(node);\n          }\n        }\n        if (location === 'after') {\n          node = container.previousSibling;\n          if (isFakeCaretTarget(node)) {\n            return after$1(node);\n          }\n        }\n      }\n      if (!range.collapsed) {\n        return range;\n      }\n      if (NodeType.isText(container)) {\n        if (isCaretContainer$2(container)) {\n          if (direction === 1) {\n            node = leanRight(container);\n            if (node) {\n              return before$2(node);\n            }\n            node = leanLeft(container);\n            if (node) {\n              return after$1(node);\n            }\n          }\n          if (direction === -1) {\n            node = leanLeft(container);\n            if (node) {\n              return after$1(node);\n            }\n            node = leanRight(container);\n            if (node) {\n              return before$2(node);\n            }\n          }\n          return range;\n        }\n        if (endsWithCaretContainer(container) && offset >= container.data.length - 1) {\n          if (direction === 1) {\n            node = leanRight(container);\n            if (node) {\n              return before$2(node);\n            }\n          }\n          return range;\n        }\n        if (startsWithCaretContainer(container) && offset <= 1) {\n          if (direction === -1) {\n            node = leanLeft(container);\n            if (node) {\n              return after$1(node);\n            }\n          }\n          return range;\n        }\n        if (offset === container.data.length) {\n          node = leanRight(container);\n          if (node) {\n            return before$2(node);\n          }\n          return range;\n        }\n        if (offset === 0) {\n          node = leanLeft(container);\n          if (node) {\n            return after$1(node);\n          }\n          return range;\n        }\n      }\n      return range;\n    };\n    var getRelativeCefElm = function (forward, caretPosition) {\n      return Option.from(getChildNodeAtRelativeOffset(forward ? 0 : -1, caretPosition)).filter(isContentEditableFalse$4);\n    };\n    var getNormalizedRangeEndPoint = function (direction, root, range) {\n      var normalizedRange = normalizeRange(direction, root, range);\n      if (direction === -1) {\n        return CaretPosition.fromRangeStart(normalizedRange);\n      }\n      return CaretPosition.fromRangeEnd(normalizedRange);\n    };\n    var getElementFromPosition = function (pos) {\n      return Option.from(pos.getNode()).map(Element.fromDom);\n    };\n    var getElementFromPrevPosition = function (pos) {\n      return Option.from(pos.getNode(true)).map(Element.fromDom);\n    };\n    var getVisualCaretPosition = function (walkFn, caretPosition) {\n      while (caretPosition = walkFn(caretPosition)) {\n        if (caretPosition.isVisible()) {\n          return caretPosition;\n        }\n      }\n      return caretPosition;\n    };\n    var isMoveInsideSameBlock = function (from, to) {\n      var inSameBlock = isInSameBlock(from, to);\n      if (!inSameBlock && NodeType.isBr(from.getNode())) {\n        return true;\n      }\n      return inSameBlock;\n    };\n\n    var HDirection;\n    (function (HDirection) {\n      HDirection[HDirection['Backwards'] = -1] = 'Backwards';\n      HDirection[HDirection['Forwards'] = 1] = 'Forwards';\n    }(HDirection || (HDirection = {})));\n    var isContentEditableFalse$5 = NodeType.isContentEditableFalse;\n    var isText$7 = NodeType.isText;\n    var isElement$6 = NodeType.isElement;\n    var isBr$4 = NodeType.isBr;\n    var isCaretCandidate$3 = isCaretCandidate;\n    var isAtomic$1 = isAtomic;\n    var isEditableCaretCandidate$1 = isEditableCaretCandidate;\n    var getParents = function (node, root) {\n      var parents = [];\n      while (node && node !== root) {\n        parents.push(node);\n        node = node.parentNode;\n      }\n      return parents;\n    };\n    var nodeAtIndex = function (container, offset) {\n      if (container.hasChildNodes() && offset < container.childNodes.length) {\n        return container.childNodes[offset];\n      }\n      return null;\n    };\n    var getCaretCandidatePosition = function (direction, node) {\n      if (isForwards(direction)) {\n        if (isCaretCandidate$3(node.previousSibling) && !isText$7(node.previousSibling)) {\n          return CaretPosition$1.before(node);\n        }\n        if (isText$7(node)) {\n          return CaretPosition$1(node, 0);\n        }\n      }\n      if (isBackwards(direction)) {\n        if (isCaretCandidate$3(node.nextSibling) && !isText$7(node.nextSibling)) {\n          return CaretPosition$1.after(node);\n        }\n        if (isText$7(node)) {\n          return CaretPosition$1(node, node.data.length);\n        }\n      }\n      if (isBackwards(direction)) {\n        if (isBr$4(node)) {\n          return CaretPosition$1.before(node);\n        }\n        return CaretPosition$1.after(node);\n      }\n      return CaretPosition$1.before(node);\n    };\n    var moveForwardFromBr = function (root, nextNode) {\n      var nextSibling = nextNode.nextSibling;\n      if (nextSibling && isCaretCandidate$3(nextSibling)) {\n        if (isText$7(nextSibling)) {\n          return CaretPosition$1(nextSibling, 0);\n        } else {\n          return CaretPosition$1.before(nextSibling);\n        }\n      } else {\n        return findCaretPosition(HDirection.Forwards, CaretPosition$1.after(nextNode), root);\n      }\n    };\n    var findCaretPosition = function (direction, startPos, root) {\n      var node, nextNode, innerNode;\n      var rootContentEditableFalseElm, caretPosition;\n      if (!isElement$6(root) || !startPos) {\n        return null;\n      }\n      if (startPos.isEqual(CaretPosition$1.after(root)) && root.lastChild) {\n        caretPosition = CaretPosition$1.after(root.lastChild);\n        if (isBackwards(direction) && isCaretCandidate$3(root.lastChild) && isElement$6(root.lastChild)) {\n          return isBr$4(root.lastChild) ? CaretPosition$1.before(root.lastChild) : caretPosition;\n        }\n      } else {\n        caretPosition = startPos;\n      }\n      var container = caretPosition.container();\n      var offset = caretPosition.offset();\n      if (isText$7(container)) {\n        if (isBackwards(direction) && offset > 0) {\n          return CaretPosition$1(container, --offset);\n        }\n        if (isForwards(direction) && offset < container.length) {\n          return CaretPosition$1(container, ++offset);\n        }\n        node = container;\n      } else {\n        if (isBackwards(direction) && offset > 0) {\n          nextNode = nodeAtIndex(container, offset - 1);\n          if (isCaretCandidate$3(nextNode)) {\n            if (!isAtomic$1(nextNode)) {\n              innerNode = findNode(nextNode, direction, isEditableCaretCandidate$1, nextNode);\n              if (innerNode) {\n                if (isText$7(innerNode)) {\n                  return CaretPosition$1(innerNode, innerNode.data.length);\n                }\n                return CaretPosition$1.after(innerNode);\n              }\n            }\n            if (isText$7(nextNode)) {\n              return CaretPosition$1(nextNode, nextNode.data.length);\n            }\n            return CaretPosition$1.before(nextNode);\n          }\n        }\n        if (isForwards(direction) && offset < container.childNodes.length) {\n          nextNode = nodeAtIndex(container, offset);\n          if (isCaretCandidate$3(nextNode)) {\n            if (isBr$4(nextNode)) {\n              return moveForwardFromBr(root, nextNode);\n            }\n            if (!isAtomic$1(nextNode)) {\n              innerNode = findNode(nextNode, direction, isEditableCaretCandidate$1, nextNode);\n              if (innerNode) {\n                if (isText$7(innerNode)) {\n                  return CaretPosition$1(innerNode, 0);\n                }\n                return CaretPosition$1.before(innerNode);\n              }\n            }\n            if (isText$7(nextNode)) {\n              return CaretPosition$1(nextNode, 0);\n            }\n            return CaretPosition$1.after(nextNode);\n          }\n        }\n        node = nextNode ? nextNode : caretPosition.getNode();\n      }\n      if (isForwards(direction) && caretPosition.isAtEnd() || isBackwards(direction) && caretPosition.isAtStart()) {\n        node = findNode(node, direction, constant(true), root, true);\n        if (isEditableCaretCandidate$1(node, root)) {\n          return getCaretCandidatePosition(direction, node);\n        }\n      }\n      nextNode = findNode(node, direction, isEditableCaretCandidate$1, root);\n      rootContentEditableFalseElm = ArrUtils.last(filter(getParents(container, root), isContentEditableFalse$5));\n      if (rootContentEditableFalseElm && (!nextNode || !rootContentEditableFalseElm.contains(nextNode))) {\n        if (isForwards(direction)) {\n          caretPosition = CaretPosition$1.after(rootContentEditableFalseElm);\n        } else {\n          caretPosition = CaretPosition$1.before(rootContentEditableFalseElm);\n        }\n        return caretPosition;\n      }\n      if (nextNode) {\n        return getCaretCandidatePosition(direction, nextNode);\n      }\n      return null;\n    };\n    var CaretWalker = function (root) {\n      return {\n        next: function (caretPosition) {\n          return findCaretPosition(HDirection.Forwards, caretPosition, root);\n        },\n        prev: function (caretPosition) {\n          return findCaretPosition(HDirection.Backwards, caretPosition, root);\n        }\n      };\n    };\n\n    var walkToPositionIn = function (forward, root, start) {\n      var position = forward ? CaretPosition$1.before(start) : CaretPosition$1.after(start);\n      return fromPosition(forward, root, position);\n    };\n    var afterElement = function (node) {\n      return NodeType.isBr(node) ? CaretPosition$1.before(node) : CaretPosition$1.after(node);\n    };\n    var isBeforeOrStart = function (position) {\n      if (CaretPosition$1.isTextPosition(position)) {\n        return position.offset() === 0;\n      } else {\n        return isCaretCandidate(position.getNode());\n      }\n    };\n    var isAfterOrEnd = function (position) {\n      if (CaretPosition$1.isTextPosition(position)) {\n        var container = position.container();\n        return position.offset() === container.data.length;\n      } else {\n        return isCaretCandidate(position.getNode(true));\n      }\n    };\n    var isBeforeAfterSameElement = function (from, to) {\n      return !CaretPosition$1.isTextPosition(from) && !CaretPosition$1.isTextPosition(to) && from.getNode() === to.getNode(true);\n    };\n    var isAtBr = function (position) {\n      return !CaretPosition$1.isTextPosition(position) && NodeType.isBr(position.getNode());\n    };\n    var shouldSkipPosition = function (forward, from, to) {\n      if (forward) {\n        return !isBeforeAfterSameElement(from, to) && !isAtBr(from) && isAfterOrEnd(from) && isBeforeOrStart(to);\n      } else {\n        return !isBeforeAfterSameElement(to, from) && isBeforeOrStart(from) && isAfterOrEnd(to);\n      }\n    };\n    var fromPosition = function (forward, root, pos) {\n      var walker = CaretWalker(root);\n      return Option.from(forward ? walker.next(pos) : walker.prev(pos));\n    };\n    var navigate = function (forward, root, from) {\n      return fromPosition(forward, root, from).bind(function (to) {\n        if (isInSameBlock(from, to, root) && shouldSkipPosition(forward, from, to)) {\n          return fromPosition(forward, root, to);\n        } else {\n          return Option.some(to);\n        }\n      });\n    };\n    var navigateIgnore = function (forward, root, from, ignoreFilter) {\n      return navigate(forward, root, from).bind(function (pos) {\n        return ignoreFilter(pos) ? navigateIgnore(forward, root, pos, ignoreFilter) : Option.some(pos);\n      });\n    };\n    var positionIn = function (forward, element) {\n      var startNode = forward ? element.firstChild : element.lastChild;\n      if (NodeType.isText(startNode)) {\n        return Option.some(CaretPosition$1(startNode, forward ? 0 : startNode.data.length));\n      } else if (startNode) {\n        if (isCaretCandidate(startNode)) {\n          return Option.some(forward ? CaretPosition$1.before(startNode) : afterElement(startNode));\n        } else {\n          return walkToPositionIn(forward, element, startNode);\n        }\n      } else {\n        return Option.none();\n      }\n    };\n    var nextPosition = curry(fromPosition, true);\n    var prevPosition = curry(fromPosition, false);\n    var CaretFinder = {\n      fromPosition: fromPosition,\n      nextPosition: nextPosition,\n      prevPosition: prevPosition,\n      navigate: navigate,\n      navigateIgnore: navigateIgnore,\n      positionIn: positionIn,\n      firstPositionIn: curry(positionIn, true),\n      lastPositionIn: curry(positionIn, false)\n    };\n\n    var isStringPathBookmark = function (bookmark) {\n      return typeof bookmark.start === 'string';\n    };\n    var isRangeBookmark = function (bookmark) {\n      return bookmark.hasOwnProperty('rng');\n    };\n    var isIdBookmark = function (bookmark) {\n      return bookmark.hasOwnProperty('id');\n    };\n    var isIndexBookmark = function (bookmark) {\n      return bookmark.hasOwnProperty('name');\n    };\n    var isPathBookmark = function (bookmark) {\n      return Tools.isArray(bookmark.start);\n    };\n\n    var addBogus = function (dom, node) {\n      if (NodeType.isElement(node) && dom.isBlock(node) && !node.innerHTML && !Env.ie) {\n        node.innerHTML = '<br data-mce-bogus=\"1\" />';\n      }\n      return node;\n    };\n    var resolveCaretPositionBookmark = function (dom, bookmark) {\n      var rng, pos;\n      rng = dom.createRng();\n      pos = resolve$2(dom.getRoot(), bookmark.start);\n      rng.setStart(pos.container(), pos.offset());\n      pos = resolve$2(dom.getRoot(), bookmark.end);\n      rng.setEnd(pos.container(), pos.offset());\n      return rng;\n    };\n    var insertZwsp = function (node, rng) {\n      var textNode = node.ownerDocument.createTextNode(Zwsp.ZWSP);\n      node.appendChild(textNode);\n      rng.setStart(textNode, 0);\n      rng.setEnd(textNode, 0);\n    };\n    var isEmpty = function (node) {\n      return node.hasChildNodes() === false;\n    };\n    var tryFindRangePosition = function (node, rng) {\n      return CaretFinder.lastPositionIn(node).fold(function () {\n        return false;\n      }, function (pos) {\n        rng.setStart(pos.container(), pos.offset());\n        rng.setEnd(pos.container(), pos.offset());\n        return true;\n      });\n    };\n    var padEmptyCaretContainer = function (root, node, rng) {\n      if (isEmpty(node) && getParentCaretContainer(root, node)) {\n        insertZwsp(node, rng);\n        return true;\n      } else {\n        return false;\n      }\n    };\n    var setEndPoint = function (dom, start, bookmark, rng) {\n      var point = bookmark[start ? 'start' : 'end'];\n      var i, node, offset, children;\n      var root = dom.getRoot();\n      if (point) {\n        offset = point[0];\n        for (node = root, i = point.length - 1; i >= 1; i--) {\n          children = node.childNodes;\n          if (padEmptyCaretContainer(root, node, rng)) {\n            return true;\n          }\n          if (point[i] > children.length - 1) {\n            if (padEmptyCaretContainer(root, node, rng)) {\n              return true;\n            }\n            return tryFindRangePosition(node, rng);\n          }\n          node = children[point[i]];\n        }\n        if (node.nodeType === 3) {\n          offset = Math.min(point[0], node.nodeValue.length);\n        }\n        if (node.nodeType === 1) {\n          offset = Math.min(point[0], node.childNodes.length);\n        }\n        if (start) {\n          rng.setStart(node, offset);\n        } else {\n          rng.setEnd(node, offset);\n        }\n      }\n      return true;\n    };\n    var isValidTextNode = function (node) {\n      return NodeType.isText(node) && node.data.length > 0;\n    };\n    var restoreEndPoint = function (dom, suffix, bookmark) {\n      var marker = dom.get(bookmark.id + '_' + suffix), node, idx, next, prev;\n      var keep = bookmark.keep;\n      var container, offset;\n      if (marker) {\n        node = marker.parentNode;\n        if (suffix === 'start') {\n          if (!keep) {\n            idx = dom.nodeIndex(marker);\n          } else {\n            if (marker.hasChildNodes()) {\n              node = marker.firstChild;\n              idx = 1;\n            } else if (isValidTextNode(marker.nextSibling)) {\n              node = marker.nextSibling;\n              idx = 0;\n            } else if (isValidTextNode(marker.previousSibling)) {\n              node = marker.previousSibling;\n              idx = marker.previousSibling.data.length;\n            } else {\n              node = marker.parentNode;\n              idx = dom.nodeIndex(marker) + 1;\n            }\n          }\n          container = node;\n          offset = idx;\n        } else {\n          if (!keep) {\n            idx = dom.nodeIndex(marker);\n          } else {\n            if (marker.hasChildNodes()) {\n              node = marker.firstChild;\n              idx = 1;\n            } else if (isValidTextNode(marker.previousSibling)) {\n              node = marker.previousSibling;\n              idx = marker.previousSibling.data.length;\n            } else {\n              node = marker.parentNode;\n              idx = dom.nodeIndex(marker);\n            }\n          }\n          container = node;\n          offset = idx;\n        }\n        if (!keep) {\n          prev = marker.previousSibling;\n          next = marker.nextSibling;\n          Tools.each(Tools.grep(marker.childNodes), function (node) {\n            if (NodeType.isText(node)) {\n              node.nodeValue = node.nodeValue.replace(/\\uFEFF/g, '');\n            }\n          });\n          while (marker = dom.get(bookmark.id + '_' + suffix)) {\n            dom.remove(marker, true);\n          }\n          if (prev && next && prev.nodeType === next.nodeType && NodeType.isText(prev) && !Env.opera) {\n            idx = prev.nodeValue.length;\n            prev.appendData(next.nodeValue);\n            dom.remove(next);\n            if (suffix === 'start') {\n              container = prev;\n              offset = idx;\n            } else {\n              container = prev;\n              offset = idx;\n            }\n          }\n        }\n        return Option.some(CaretPosition$1(container, offset));\n      } else {\n        return Option.none();\n      }\n    };\n    var alt = function (o1, o2) {\n      return o1.isSome() ? o1 : o2;\n    };\n    var resolvePaths = function (dom, bookmark) {\n      var rng = dom.createRng();\n      if (setEndPoint(dom, true, bookmark, rng) && setEndPoint(dom, false, bookmark, rng)) {\n        return Option.some(rng);\n      } else {\n        return Option.none();\n      }\n    };\n    var resolveId = function (dom, bookmark) {\n      var startPos = restoreEndPoint(dom, 'start', bookmark);\n      var endPos = restoreEndPoint(dom, 'end', bookmark);\n      return lift2(startPos, alt(endPos, startPos), function (spos, epos) {\n        var rng = dom.createRng();\n        rng.setStart(addBogus(dom, spos.container()), spos.offset());\n        rng.setEnd(addBogus(dom, epos.container()), epos.offset());\n        return rng;\n      });\n    };\n    var resolveIndex$1 = function (dom, bookmark) {\n      return Option.from(dom.select(bookmark.name)[bookmark.index]).map(function (elm) {\n        var rng = dom.createRng();\n        rng.selectNode(elm);\n        return rng;\n      });\n    };\n    var resolve$3 = function (selection, bookmark) {\n      var dom = selection.dom;\n      if (bookmark) {\n        if (isPathBookmark(bookmark)) {\n          return resolvePaths(dom, bookmark);\n        } else if (isStringPathBookmark(bookmark)) {\n          return Option.some(resolveCaretPositionBookmark(dom, bookmark));\n        } else if (isIdBookmark(bookmark)) {\n          return resolveId(dom, bookmark);\n        } else if (isIndexBookmark(bookmark)) {\n          return resolveIndex$1(dom, bookmark);\n        } else if (isRangeBookmark(bookmark)) {\n          return Option.some(bookmark.rng);\n        }\n      }\n      return Option.none();\n    };\n    var ResolveBookmark = { resolve: resolve$3 };\n\n    var getBookmark$1 = function (selection, type, normalized) {\n      return GetBookmark.getBookmark(selection, type, normalized);\n    };\n    var moveToBookmark = function (selection, bookmark) {\n      ResolveBookmark.resolve(selection, bookmark).each(function (rng) {\n        selection.setRng(rng);\n      });\n    };\n    var isBookmarkNode$1 = function (node) {\n      return NodeType.isElement(node) && node.tagName === 'SPAN' && node.getAttribute('data-mce-type') === 'bookmark';\n    };\n    var Bookmarks = {\n      getBookmark: getBookmark$1,\n      moveToBookmark: moveToBookmark,\n      isBookmarkNode: isBookmarkNode$1\n    };\n\n    var isInlineBlock = function (node) {\n      return node && /^(IMG)$/.test(node.nodeName);\n    };\n    var moveStart = function (dom, selection, rng) {\n      var offset = rng.startOffset;\n      var container = rng.startContainer, walker, node, nodes;\n      if (rng.startContainer === rng.endContainer) {\n        if (isInlineBlock(rng.startContainer.childNodes[rng.startOffset])) {\n          return;\n        }\n      }\n      if (container.nodeType === 1) {\n        nodes = container.childNodes;\n        if (offset < nodes.length) {\n          container = nodes[offset];\n          walker = new TreeWalker(container, dom.getParent(container, dom.isBlock));\n        } else {\n          container = nodes[nodes.length - 1];\n          walker = new TreeWalker(container, dom.getParent(container, dom.isBlock));\n          walker.next(true);\n        }\n        for (node = walker.current(); node; node = walker.next()) {\n          if (node.nodeType === 3 && !isWhiteSpaceNode(node)) {\n            rng.setStart(node, 0);\n            selection.setRng(rng);\n            return;\n          }\n        }\n      }\n    };\n    var getNonWhiteSpaceSibling = function (node, next, inc) {\n      if (node) {\n        next = next ? 'nextSibling' : 'previousSibling';\n        for (node = inc ? node : node[next]; node; node = node[next]) {\n          if (node.nodeType === 1 || !isWhiteSpaceNode(node)) {\n            return node;\n          }\n        }\n      }\n    };\n    var isTextBlock$1 = function (editor, name) {\n      if (name.nodeType) {\n        name = name.nodeName;\n      }\n      return !!editor.schema.getTextBlockElements()[name.toLowerCase()];\n    };\n    var isValid = function (ed, parent, child) {\n      return ed.schema.isValidChild(parent, child);\n    };\n    var isWhiteSpaceNode = function (node) {\n      return node && node.nodeType === 3 && /^([\\t \\r\\n]+|)$/.test(node.nodeValue);\n    };\n    var replaceVars = function (value, vars) {\n      if (typeof value !== 'string') {\n        value = value(vars);\n      } else if (vars) {\n        value = value.replace(/%(\\w+)/g, function (str, name) {\n          return vars[name] || str;\n        });\n      }\n      return value;\n    };\n    var isEq = function (str1, str2) {\n      str1 = str1 || '';\n      str2 = str2 || '';\n      str1 = '' + (str1.nodeName || str1);\n      str2 = '' + (str2.nodeName || str2);\n      return str1.toLowerCase() === str2.toLowerCase();\n    };\n    var normalizeStyleValue = function (dom, value, name) {\n      if (name === 'color' || name === 'backgroundColor') {\n        value = dom.toHex(value);\n      }\n      if (name === 'fontWeight' && value === 700) {\n        value = 'bold';\n      }\n      if (name === 'fontFamily') {\n        value = value.replace(/[\\'\\\"]/g, '').replace(/,\\s+/g, ',');\n      }\n      return '' + value;\n    };\n    var getStyle = function (dom, node, name) {\n      return normalizeStyleValue(dom, dom.getStyle(node, name), name);\n    };\n    var getTextDecoration = function (dom, node) {\n      var decoration;\n      dom.getParent(node, function (n) {\n        decoration = dom.getStyle(n, 'text-decoration');\n        return decoration && decoration !== 'none';\n      });\n      return decoration;\n    };\n    var getParents$1 = function (dom, node, selector) {\n      return dom.getParents(node, selector, dom.getRoot());\n    };\n    var FormatUtils = {\n      isInlineBlock: isInlineBlock,\n      moveStart: moveStart,\n      getNonWhiteSpaceSibling: getNonWhiteSpaceSibling,\n      isTextBlock: isTextBlock$1,\n      isValid: isValid,\n      isWhiteSpaceNode: isWhiteSpaceNode,\n      replaceVars: replaceVars,\n      isEq: isEq,\n      normalizeStyleValue: normalizeStyleValue,\n      getStyle: getStyle,\n      getTextDecoration: getTextDecoration,\n      getParents: getParents$1\n    };\n\n    var isBookmarkNode$2 = Bookmarks.isBookmarkNode;\n    var getParents$2 = FormatUtils.getParents, isWhiteSpaceNode$1 = FormatUtils.isWhiteSpaceNode, isTextBlock$2 = FormatUtils.isTextBlock;\n    var findLeaf = function (node, offset) {\n      if (typeof offset === 'undefined') {\n        offset = node.nodeType === 3 ? node.length : node.childNodes.length;\n      }\n      while (node && node.hasChildNodes()) {\n        node = node.childNodes[offset];\n        if (node) {\n          offset = node.nodeType === 3 ? node.length : node.childNodes.length;\n        }\n      }\n      return {\n        node: node,\n        offset: offset\n      };\n    };\n    var excludeTrailingWhitespace = function (endContainer, endOffset) {\n      var leaf = findLeaf(endContainer, endOffset);\n      if (leaf.node) {\n        while (leaf.node && leaf.offset === 0 && leaf.node.previousSibling) {\n          leaf = findLeaf(leaf.node.previousSibling);\n        }\n        if (leaf.node && leaf.offset > 0 && leaf.node.nodeType === 3 && leaf.node.nodeValue.charAt(leaf.offset - 1) === ' ') {\n          if (leaf.offset > 1) {\n            endContainer = leaf.node;\n            endContainer.splitText(leaf.offset - 1);\n          }\n        }\n      }\n      return endContainer;\n    };\n    var isBogusBr = function (node) {\n      return node.nodeName === 'BR' && node.getAttribute('data-mce-bogus') && !node.nextSibling;\n    };\n    var findParentContentEditable = function (dom, node) {\n      var parent = node;\n      while (parent) {\n        if (parent.nodeType === 1 && dom.getContentEditable(parent)) {\n          return dom.getContentEditable(parent) === 'false' ? parent : node;\n        }\n        parent = parent.parentNode;\n      }\n      return node;\n    };\n    var findSpace = function (start, remove, node, offset) {\n      var pos, pos2;\n      var str = node.nodeValue;\n      if (typeof offset === 'undefined') {\n        offset = start ? str.length : 0;\n      }\n      if (start) {\n        pos = str.lastIndexOf(' ', offset);\n        pos2 = str.lastIndexOf('\\xA0', offset);\n        pos = pos > pos2 ? pos : pos2;\n        if (pos !== -1 && !remove && (pos < offset || !start) && pos <= str.length) {\n          pos++;\n        }\n      } else {\n        pos = str.indexOf(' ', offset);\n        pos2 = str.indexOf('\\xA0', offset);\n        pos = pos !== -1 && (pos2 === -1 || pos < pos2) ? pos : pos2;\n      }\n      return pos;\n    };\n    var findWordEndPoint = function (dom, body, container, offset, start, remove) {\n      var walker, node, pos, lastTextNode;\n      if (container.nodeType === 3) {\n        pos = findSpace(start, remove, container, offset);\n        if (pos !== -1) {\n          return {\n            container: container,\n            offset: pos\n          };\n        }\n        lastTextNode = container;\n      }\n      walker = new TreeWalker(container, dom.getParent(container, dom.isBlock) || body);\n      while (node = walker[start ? 'prev' : 'next']()) {\n        if (node.nodeType === 3 && !isBookmarkNode$2(node.parentNode)) {\n          lastTextNode = node;\n          pos = findSpace(start, remove, node);\n          if (pos !== -1) {\n            return {\n              container: node,\n              offset: pos\n            };\n          }\n        } else if (dom.isBlock(node) || FormatUtils.isEq(node, 'BR')) {\n          break;\n        }\n      }\n      if (lastTextNode) {\n        if (start) {\n          offset = 0;\n        } else {\n          offset = lastTextNode.length;\n        }\n        return {\n          container: lastTextNode,\n          offset: offset\n        };\n      }\n    };\n    var findSelectorEndPoint = function (dom, format, rng, container, siblingName) {\n      var parents, i, y, curFormat;\n      if (container.nodeType === 3 && container.nodeValue.length === 0 && container[siblingName]) {\n        container = container[siblingName];\n      }\n      parents = getParents$2(dom, container);\n      for (i = 0; i < parents.length; i++) {\n        for (y = 0; y < format.length; y++) {\n          curFormat = format[y];\n          if ('collapsed' in curFormat && curFormat.collapsed !== rng.collapsed) {\n            continue;\n          }\n          if (dom.is(parents[i], curFormat.selector)) {\n            return parents[i];\n          }\n        }\n      }\n      return container;\n    };\n    var findBlockEndPoint = function (editor, format, container, siblingName) {\n      var node;\n      var dom = editor.dom;\n      var root = dom.getRoot();\n      if (!format[0].wrapper) {\n        node = dom.getParent(container, format[0].block, root);\n      }\n      if (!node) {\n        var scopeRoot = dom.getParent(container, 'LI,TD,TH');\n        node = dom.getParent(container.nodeType === 3 ? container.parentNode : container, function (node) {\n          return node !== root && isTextBlock$2(editor, node);\n        }, scopeRoot);\n      }\n      if (node && format[0].wrapper) {\n        node = getParents$2(dom, node, 'ul,ol').reverse()[0] || node;\n      }\n      if (!node) {\n        node = container;\n        while (node[siblingName] && !dom.isBlock(node[siblingName])) {\n          node = node[siblingName];\n          if (FormatUtils.isEq(node, 'br')) {\n            break;\n          }\n        }\n      }\n      return node || container;\n    };\n    var findParentContainer = function (dom, format, startContainer, startOffset, endContainer, endOffset, start) {\n      var container, parent, sibling, siblingName, root;\n      container = parent = start ? startContainer : endContainer;\n      siblingName = start ? 'previousSibling' : 'nextSibling';\n      root = dom.getRoot();\n      if (container.nodeType === 3 && !isWhiteSpaceNode$1(container)) {\n        if (start ? startOffset > 0 : endOffset < container.nodeValue.length) {\n          return container;\n        }\n      }\n      while (true) {\n        if (!format[0].block_expand && dom.isBlock(parent)) {\n          return parent;\n        }\n        for (sibling = parent[siblingName]; sibling; sibling = sibling[siblingName]) {\n          if (!isBookmarkNode$2(sibling) && !isWhiteSpaceNode$1(sibling) && !isBogusBr(sibling)) {\n            return parent;\n          }\n        }\n        if (parent === root || parent.parentNode === root) {\n          container = parent;\n          break;\n        }\n        parent = parent.parentNode;\n      }\n      return container;\n    };\n    var expandRng = function (editor, rng, format, remove) {\n      var endPoint, startContainer = rng.startContainer, startOffset = rng.startOffset, endContainer = rng.endContainer, endOffset = rng.endOffset;\n      var dom = editor.dom;\n      if (startContainer.nodeType === 1 && startContainer.hasChildNodes()) {\n        startContainer = getNode(startContainer, startOffset);\n        if (startContainer.nodeType === 3) {\n          startOffset = 0;\n        }\n      }\n      if (endContainer.nodeType === 1 && endContainer.hasChildNodes()) {\n        endContainer = getNode(endContainer, rng.collapsed ? endOffset : endOffset - 1);\n        if (endContainer.nodeType === 3) {\n          endOffset = endContainer.nodeValue.length;\n        }\n      }\n      startContainer = findParentContentEditable(dom, startContainer);\n      endContainer = findParentContentEditable(dom, endContainer);\n      if (isBookmarkNode$2(startContainer.parentNode) || isBookmarkNode$2(startContainer)) {\n        startContainer = isBookmarkNode$2(startContainer) ? startContainer : startContainer.parentNode;\n        if (rng.collapsed) {\n          startContainer = startContainer.previousSibling || startContainer;\n        } else {\n          startContainer = startContainer.nextSibling || startContainer;\n        }\n        if (startContainer.nodeType === 3) {\n          startOffset = rng.collapsed ? startContainer.length : 0;\n        }\n      }\n      if (isBookmarkNode$2(endContainer.parentNode) || isBookmarkNode$2(endContainer)) {\n        endContainer = isBookmarkNode$2(endContainer) ? endContainer : endContainer.parentNode;\n        if (rng.collapsed) {\n          endContainer = endContainer.nextSibling || endContainer;\n        } else {\n          endContainer = endContainer.previousSibling || endContainer;\n        }\n        if (endContainer.nodeType === 3) {\n          endOffset = rng.collapsed ? 0 : endContainer.length;\n        }\n      }\n      if (rng.collapsed) {\n        endPoint = findWordEndPoint(dom, editor.getBody(), startContainer, startOffset, true, remove);\n        if (endPoint) {\n          startContainer = endPoint.container;\n          startOffset = endPoint.offset;\n        }\n        endPoint = findWordEndPoint(dom, editor.getBody(), endContainer, endOffset, false, remove);\n        if (endPoint) {\n          endContainer = endPoint.container;\n          endOffset = endPoint.offset;\n        }\n      }\n      if (format[0].inline) {\n        endContainer = remove ? endContainer : excludeTrailingWhitespace(endContainer, endOffset);\n      }\n      if (format[0].inline || format[0].block_expand) {\n        if (!format[0].inline || (startContainer.nodeType !== 3 || startOffset === 0)) {\n          startContainer = findParentContainer(dom, format, startContainer, startOffset, endContainer, endOffset, true);\n        }\n        if (!format[0].inline || (endContainer.nodeType !== 3 || endOffset === endContainer.nodeValue.length)) {\n          endContainer = findParentContainer(dom, format, startContainer, startOffset, endContainer, endOffset, false);\n        }\n      }\n      if (format[0].selector && format[0].expand !== false && !format[0].inline) {\n        startContainer = findSelectorEndPoint(dom, format, rng, startContainer, 'previousSibling');\n        endContainer = findSelectorEndPoint(dom, format, rng, endContainer, 'nextSibling');\n      }\n      if (format[0].block || format[0].selector) {\n        startContainer = findBlockEndPoint(editor, format, startContainer, 'previousSibling');\n        endContainer = findBlockEndPoint(editor, format, endContainer, 'nextSibling');\n        if (format[0].block) {\n          if (!dom.isBlock(startContainer)) {\n            startContainer = findParentContainer(dom, format, startContainer, startOffset, endContainer, endOffset, true);\n          }\n          if (!dom.isBlock(endContainer)) {\n            endContainer = findParentContainer(dom, format, startContainer, startOffset, endContainer, endOffset, false);\n          }\n        }\n      }\n      if (startContainer.nodeType === 1) {\n        startOffset = dom.nodeIndex(startContainer);\n        startContainer = startContainer.parentNode;\n      }\n      if (endContainer.nodeType === 1) {\n        endOffset = dom.nodeIndex(endContainer) + 1;\n        endContainer = endContainer.parentNode;\n      }\n      return {\n        startContainer: startContainer,\n        startOffset: startOffset,\n        endContainer: endContainer,\n        endOffset: endOffset\n      };\n    };\n    var ExpandRange = { expandRng: expandRng };\n\n    var each$8 = Tools.each;\n    var getEndChild = function (container, index) {\n      var childNodes = container.childNodes;\n      index--;\n      if (index > childNodes.length - 1) {\n        index = childNodes.length - 1;\n      } else if (index < 0) {\n        index = 0;\n      }\n      return childNodes[index] || container;\n    };\n    var walk$1 = function (dom, rng, callback) {\n      var startContainer = rng.startContainer;\n      var startOffset = rng.startOffset;\n      var endContainer = rng.endContainer;\n      var endOffset = rng.endOffset;\n      var ancestor;\n      var startPoint;\n      var endPoint;\n      var node;\n      var parent;\n      var siblings;\n      var nodes;\n      nodes = dom.select('td[data-mce-selected],th[data-mce-selected]');\n      if (nodes.length > 0) {\n        each$8(nodes, function (node) {\n          callback([node]);\n        });\n        return;\n      }\n      var exclude = function (nodes) {\n        var node;\n        node = nodes[0];\n        if (node.nodeType === 3 && node === startContainer && startOffset >= node.nodeValue.length) {\n          nodes.splice(0, 1);\n        }\n        node = nodes[nodes.length - 1];\n        if (endOffset === 0 && nodes.length > 0 && node === endContainer && node.nodeType === 3) {\n          nodes.splice(nodes.length - 1, 1);\n        }\n        return nodes;\n      };\n      var collectSiblings = function (node, name, endNode) {\n        var siblings = [];\n        for (; node && node !== endNode; node = node[name]) {\n          siblings.push(node);\n        }\n        return siblings;\n      };\n      var findEndPoint = function (node, root) {\n        do {\n          if (node.parentNode === root) {\n            return node;\n          }\n          node = node.parentNode;\n        } while (node);\n      };\n      var walkBoundary = function (startNode, endNode, next) {\n        var siblingName = next ? 'nextSibling' : 'previousSibling';\n        for (node = startNode, parent = node.parentNode; node && node !== endNode; node = parent) {\n          parent = node.parentNode;\n          siblings = collectSiblings(node === startNode ? node : node[siblingName], siblingName);\n          if (siblings.length) {\n            if (!next) {\n              siblings.reverse();\n            }\n            callback(exclude(siblings));\n          }\n        }\n      };\n      if (startContainer.nodeType === 1 && startContainer.hasChildNodes()) {\n        startContainer = startContainer.childNodes[startOffset];\n      }\n      if (endContainer.nodeType === 1 && endContainer.hasChildNodes()) {\n        endContainer = getEndChild(endContainer, endOffset);\n      }\n      if (startContainer === endContainer) {\n        return callback(exclude([startContainer]));\n      }\n      ancestor = dom.findCommonAncestor(startContainer, endContainer);\n      for (node = startContainer; node; node = node.parentNode) {\n        if (node === endContainer) {\n          return walkBoundary(startContainer, ancestor, true);\n        }\n        if (node === ancestor) {\n          break;\n        }\n      }\n      for (node = endContainer; node; node = node.parentNode) {\n        if (node === startContainer) {\n          return walkBoundary(endContainer, ancestor);\n        }\n        if (node === ancestor) {\n          break;\n        }\n      }\n      startPoint = findEndPoint(startContainer, ancestor) || startContainer;\n      endPoint = findEndPoint(endContainer, ancestor) || endContainer;\n      walkBoundary(startContainer, startPoint, true);\n      siblings = collectSiblings(startPoint === startContainer ? startPoint : startPoint.nextSibling, 'nextSibling', endPoint === endContainer ? endPoint.nextSibling : endPoint);\n      if (siblings.length) {\n        callback(exclude(siblings));\n      }\n      walkBoundary(endContainer, endPoint);\n    };\n    var RangeWalk = { walk: walk$1 };\n\n    var zeroWidth = function () {\n      return '\\uFEFF';\n    };\n\n    function NodeValue (is, name) {\n      var get = function (element) {\n        if (!is(element)) {\n          throw new Error('Can only get ' + name + ' value of a ' + name + ' node');\n        }\n        return getOption(element).getOr('');\n      };\n      var getOption = function (element) {\n        return is(element) ? Option.from(element.dom().nodeValue) : Option.none();\n      };\n      var set = function (element, value) {\n        if (!is(element)) {\n          throw new Error('Can only set raw ' + name + ' value of a ' + name + ' node');\n        }\n        element.dom().nodeValue = value;\n      };\n      return {\n        get: get,\n        getOption: getOption,\n        set: set\n      };\n    }\n\n    var api = NodeValue(isText, 'text');\n    var get$4 = function (element) {\n      return api.get(element);\n    };\n\n    var isZeroWidth = function (elem) {\n      return isText(elem) && get$4(elem) === zeroWidth();\n    };\n    var context = function (editor, elem, wrapName, nodeName) {\n      return parent(elem).fold(function () {\n        return 'skipping';\n      }, function (parent) {\n        if (nodeName === 'br' || isZeroWidth(elem)) {\n          return 'valid';\n        } else if (isAnnotation(elem)) {\n          return 'existing';\n        } else if (isCaretNode(elem)) {\n          return 'caret';\n        } else if (!FormatUtils.isValid(editor, wrapName, nodeName) || !FormatUtils.isValid(editor, name(parent), wrapName)) {\n          return 'invalid-child';\n        } else {\n          return 'valid';\n        }\n      });\n    };\n\n    var shouldApplyToTrailingSpaces = function (rng) {\n      return rng.startContainer.nodeType === 3 && rng.startContainer.nodeValue.length >= rng.startOffset && rng.startContainer.nodeValue[rng.startOffset] === '\\xA0';\n    };\n    var applyWordGrab = function (editor, rng) {\n      var r = ExpandRange.expandRng(editor, rng, [{ inline: true }], shouldApplyToTrailingSpaces(rng));\n      rng.setStart(r.startContainer, r.startOffset);\n      rng.setEnd(r.endContainer, r.endOffset);\n      editor.selection.setRng(rng);\n    };\n    var makeAnnotation = function (eDoc, _a, annotationName, decorate) {\n      var _b = _a.uid, uid = _b === void 0 ? generate('mce-annotation') : _b, data = __rest(_a, ['uid']);\n      var master = Element.fromTag('span', eDoc);\n      add$2(master, annotation());\n      set(master, '' + dataAnnotationId(), uid);\n      set(master, '' + dataAnnotation(), annotationName);\n      var _c = decorate(uid, data), _d = _c.attributes, attributes = _d === void 0 ? {} : _d, _e = _c.classes, classes = _e === void 0 ? [] : _e;\n      setAll(master, attributes);\n      add$3(master, classes);\n      return master;\n    };\n    var annotate = function (editor, rng, annotationName, decorate, data) {\n      var newWrappers = [];\n      var master = makeAnnotation(editor.getDoc(), data, annotationName, decorate);\n      var wrapper = Cell(Option.none());\n      var finishWrapper = function () {\n        wrapper.set(Option.none());\n      };\n      var getOrOpenWrapper = function () {\n        return wrapper.get().getOrThunk(function () {\n          var nu = shallow(master);\n          newWrappers.push(nu);\n          wrapper.set(Option.some(nu));\n          return nu;\n        });\n      };\n      var processElements = function (elems) {\n        each(elems, processElement);\n      };\n      var processElement = function (elem) {\n        var ctx = context(editor, elem, 'span', name(elem));\n        switch (ctx) {\n        case 'invalid-child': {\n            finishWrapper();\n            var children$1 = children(elem);\n            processElements(children$1);\n            finishWrapper();\n            break;\n          }\n        case 'valid': {\n            var w = getOrOpenWrapper();\n            wrap$1(elem, w);\n            break;\n          }\n        case 'skipping':\n        case 'existing':\n        case 'caret':\n        }\n      };\n      var processNodes = function (nodes) {\n        var elems = map(nodes, Element.fromDom);\n        processElements(elems);\n      };\n      RangeWalk.walk(editor.dom, rng, function (nodes) {\n        finishWrapper();\n        processNodes(nodes);\n      });\n      return newWrappers;\n    };\n    var annotateWithBookmark = function (editor, name, settings, data) {\n      editor.undoManager.transact(function () {\n        var initialRng = editor.selection.getRng();\n        if (initialRng.collapsed) {\n          applyWordGrab(editor, initialRng);\n        }\n        if (editor.selection.getRng().collapsed) {\n          var wrapper = makeAnnotation(editor.getDoc(), data, name, settings.decorate);\n          set$1(wrapper, '\\xA0');\n          editor.selection.getRng().insertNode(wrapper.dom());\n          editor.selection.select(wrapper.dom());\n        } else {\n          var bookmark = GetBookmark.getPersistentBookmark(editor.selection, false);\n          var rng = editor.selection.getRng();\n          annotate(editor, rng, name, settings.decorate, data);\n          editor.selection.moveToBookmark(bookmark);\n        }\n      });\n    };\n\n    function Annotator (editor) {\n      var registry = create$1();\n      setup$1(editor, registry);\n      var changes = setup(editor);\n      return {\n        register: function (name, settings) {\n          registry.register(name, settings);\n        },\n        annotate: function (name, data) {\n          registry.lookup(name).each(function (settings) {\n            annotateWithBookmark(editor, name, settings, data);\n          });\n        },\n        annotationChanged: function (name, callback) {\n          changes.addListener(name, callback);\n        },\n        remove: function (name) {\n          identify(editor, Option.some(name)).each(function (_a) {\n            var elements = _a.elements;\n            each(elements, unwrap);\n          });\n        },\n        getAll: function (name) {\n          var directory = findAll(editor, name);\n          return map$2(directory, function (elems) {\n            return map(elems, function (elem) {\n              return elem.dom();\n            });\n          });\n        }\n      };\n    }\n\n    var hasOnlyOneChild = function (node) {\n      return node.firstChild && node.firstChild === node.lastChild;\n    };\n    var isPaddingNode = function (node) {\n      return node.name === 'br' || node.value === '\\xA0';\n    };\n    var isPaddedEmptyBlock = function (schema, node) {\n      var blockElements = schema.getBlockElements();\n      return blockElements[node.name] && hasOnlyOneChild(node) && isPaddingNode(node.firstChild);\n    };\n    var isEmptyFragmentElement = function (schema, node) {\n      var nonEmptyElements = schema.getNonEmptyElements();\n      return node && (node.isEmpty(nonEmptyElements) || isPaddedEmptyBlock(schema, node));\n    };\n    var isListFragment = function (schema, fragment) {\n      var firstChild = fragment.firstChild;\n      var lastChild = fragment.lastChild;\n      if (firstChild && firstChild.name === 'meta') {\n        firstChild = firstChild.next;\n      }\n      if (lastChild && lastChild.attr('id') === 'mce_marker') {\n        lastChild = lastChild.prev;\n      }\n      if (isEmptyFragmentElement(schema, lastChild)) {\n        lastChild = lastChild.prev;\n      }\n      if (!firstChild || firstChild !== lastChild) {\n        return false;\n      }\n      return firstChild.name === 'ul' || firstChild.name === 'ol';\n    };\n    var cleanupDomFragment = function (domFragment) {\n      var firstChild = domFragment.firstChild;\n      var lastChild = domFragment.lastChild;\n      if (firstChild && firstChild.nodeName === 'META') {\n        firstChild.parentNode.removeChild(firstChild);\n      }\n      if (lastChild && lastChild.id === 'mce_marker') {\n        lastChild.parentNode.removeChild(lastChild);\n      }\n      return domFragment;\n    };\n    var toDomFragment = function (dom, serializer, fragment) {\n      var html = serializer.serialize(fragment);\n      var domFragment = dom.createFragment(html);\n      return cleanupDomFragment(domFragment);\n    };\n    var listItems$1 = function (elm) {\n      return Tools.grep(elm.childNodes, function (child) {\n        return child.nodeName === 'LI';\n      });\n    };\n    var isPadding = function (node) {\n      return node.data === '\\xA0' || NodeType.isBr(node);\n    };\n    var isListItemPadded = function (node) {\n      return node && node.firstChild && node.firstChild === node.lastChild && isPadding(node.firstChild);\n    };\n    var isEmptyOrPadded = function (elm) {\n      return !elm.firstChild || isListItemPadded(elm);\n    };\n    var trimListItems = function (elms) {\n      return elms.length > 0 && isEmptyOrPadded(elms[elms.length - 1]) ? elms.slice(0, -1) : elms;\n    };\n    var getParentLi = function (dom, node) {\n      var parentBlock = dom.getParent(node, dom.isBlock);\n      return parentBlock && parentBlock.nodeName === 'LI' ? parentBlock : null;\n    };\n    var isParentBlockLi = function (dom, node) {\n      return !!getParentLi(dom, node);\n    };\n    var getSplit = function (parentNode, rng) {\n      var beforeRng = rng.cloneRange();\n      var afterRng = rng.cloneRange();\n      beforeRng.setStartBefore(parentNode);\n      afterRng.setEndAfter(parentNode);\n      return [\n        beforeRng.cloneContents(),\n        afterRng.cloneContents()\n      ];\n    };\n    var findFirstIn = function (node, rootNode) {\n      var caretPos = CaretPosition$1.before(node);\n      var caretWalker = CaretWalker(rootNode);\n      var newCaretPos = caretWalker.next(caretPos);\n      return newCaretPos ? newCaretPos.toRange() : null;\n    };\n    var findLastOf = function (node, rootNode) {\n      var caretPos = CaretPosition$1.after(node);\n      var caretWalker = CaretWalker(rootNode);\n      var newCaretPos = caretWalker.prev(caretPos);\n      return newCaretPos ? newCaretPos.toRange() : null;\n    };\n    var insertMiddle = function (target, elms, rootNode, rng) {\n      var parts = getSplit(target, rng);\n      var parentElm = target.parentNode;\n      parentElm.insertBefore(parts[0], target);\n      Tools.each(elms, function (li) {\n        parentElm.insertBefore(li, target);\n      });\n      parentElm.insertBefore(parts[1], target);\n      parentElm.removeChild(target);\n      return findLastOf(elms[elms.length - 1], rootNode);\n    };\n    var insertBefore = function (target, elms, rootNode) {\n      var parentElm = target.parentNode;\n      Tools.each(elms, function (elm) {\n        parentElm.insertBefore(elm, target);\n      });\n      return findFirstIn(target, rootNode);\n    };\n    var insertAfter = function (target, elms, rootNode, dom) {\n      dom.insertAfter(elms.reverse(), target);\n      return findLastOf(elms[0], rootNode);\n    };\n    var insertAtCaret = function (serializer, dom, rng, fragment) {\n      var domFragment = toDomFragment(dom, serializer, fragment);\n      var liTarget = getParentLi(dom, rng.startContainer);\n      var liElms = trimListItems(listItems$1(domFragment.firstChild));\n      var BEGINNING = 1, END = 2;\n      var rootNode = dom.getRoot();\n      var isAt = function (location) {\n        var caretPos = CaretPosition$1.fromRangeStart(rng);\n        var caretWalker = CaretWalker(dom.getRoot());\n        var newPos = location === BEGINNING ? caretWalker.prev(caretPos) : caretWalker.next(caretPos);\n        return newPos ? getParentLi(dom, newPos.getNode()) !== liTarget : true;\n      };\n      if (isAt(BEGINNING)) {\n        return insertBefore(liTarget, liElms, rootNode);\n      } else if (isAt(END)) {\n        return insertAfter(liTarget, liElms, rootNode, dom);\n      }\n      return insertMiddle(liTarget, liElms, rootNode, rng);\n    };\n    var InsertList = {\n      isListFragment: isListFragment,\n      insertAtCaret: insertAtCaret,\n      isParentBlockLi: isParentBlockLi,\n      trimListItems: trimListItems,\n      listItems: listItems$1\n    };\n\n    var each$9 = Tools.each;\n    var ElementUtils = function (dom) {\n      this.compare = function (node1, node2) {\n        if (node1.nodeName !== node2.nodeName) {\n          return false;\n        }\n        var getAttribs = function (node) {\n          var attribs = {};\n          each$9(dom.getAttribs(node), function (attr) {\n            var name = attr.nodeName.toLowerCase();\n            if (name.indexOf('_') !== 0 && name !== 'style' && name.indexOf('data-') !== 0) {\n              attribs[name] = dom.getAttrib(node, name);\n            }\n          });\n          return attribs;\n        };\n        var compareObjects = function (obj1, obj2) {\n          var value, name;\n          for (name in obj1) {\n            if (obj1.hasOwnProperty(name)) {\n              value = obj2[name];\n              if (typeof value === 'undefined') {\n                return false;\n              }\n              if (obj1[name] !== value) {\n                return false;\n              }\n              delete obj2[name];\n            }\n          }\n          for (name in obj2) {\n            if (obj2.hasOwnProperty(name)) {\n              return false;\n            }\n          }\n          return true;\n        };\n        if (!compareObjects(getAttribs(node1), getAttribs(node2))) {\n          return false;\n        }\n        if (!compareObjects(dom.parseStyle(dom.getAttrib(node1, 'style')), dom.parseStyle(dom.getAttrib(node2, 'style')))) {\n          return false;\n        }\n        return !Bookmarks.isBookmarkNode(node1) && !Bookmarks.isBookmarkNode(node2);\n      };\n    };\n\n    var getLastChildren = function (elm) {\n      var children = [];\n      var rawNode = elm.dom();\n      while (rawNode) {\n        children.push(Element.fromDom(rawNode));\n        rawNode = rawNode.lastChild;\n      }\n      return children;\n    };\n    var removeTrailingBr = function (elm) {\n      var allBrs = descendants$1(elm, 'br');\n      var brs = filter(getLastChildren(elm).slice(-1), isBr);\n      if (allBrs.length === brs.length) {\n        each(brs, remove$1);\n      }\n    };\n    var fillWithPaddingBr = function (elm) {\n      empty(elm);\n      append(elm, Element.fromHtml('<br data-mce-bogus=\"1\">'));\n    };\n    var isPaddingContents = function (elm) {\n      return isText(elm) ? get$4(elm) === '\\xA0' : isBr(elm);\n    };\n    var isPaddedElement = function (elm) {\n      return filter(children(elm), isPaddingContents).length === 1;\n    };\n    var trimBlockTrailingBr = function (elm) {\n      lastChild(elm).each(function (lastChild) {\n        prevSibling(lastChild).each(function (lastChildPrevSibling) {\n          if (isBlock(elm) && isBr(lastChild) && isBlock(lastChildPrevSibling)) {\n            remove$1(lastChild);\n          }\n        });\n      });\n    };\n    var PaddingBr = {\n      removeTrailingBr: removeTrailingBr,\n      fillWithPaddingBr: fillWithPaddingBr,\n      isPaddedElement: isPaddedElement,\n      trimBlockTrailingBr: trimBlockTrailingBr\n    };\n\n    var makeMap$3 = Tools.makeMap;\n    function Writer (settings) {\n      var html = [];\n      var indent, indentBefore, indentAfter, encode, htmlOutput;\n      settings = settings || {};\n      indent = settings.indent;\n      indentBefore = makeMap$3(settings.indent_before || '');\n      indentAfter = makeMap$3(settings.indent_after || '');\n      encode = Entities.getEncodeFunc(settings.entity_encoding || 'raw', settings.entities);\n      htmlOutput = settings.element_format === 'html';\n      return {\n        start: function (name, attrs, empty) {\n          var i, l, attr, value;\n          if (indent && indentBefore[name] && html.length > 0) {\n            value = html[html.length - 1];\n            if (value.length > 0 && value !== '\\n') {\n              html.push('\\n');\n            }\n          }\n          html.push('<', name);\n          if (attrs) {\n            for (i = 0, l = attrs.length; i < l; i++) {\n              attr = attrs[i];\n              html.push(' ', attr.name, '=\"', encode(attr.value, true), '\"');\n            }\n          }\n          if (!empty || htmlOutput) {\n            html[html.length] = '>';\n          } else {\n            html[html.length] = ' />';\n          }\n          if (empty && indent && indentAfter[name] && html.length > 0) {\n            value = html[html.length - 1];\n            if (value.length > 0 && value !== '\\n') {\n              html.push('\\n');\n            }\n          }\n        },\n        end: function (name) {\n          var value;\n          html.push('</', name, '>');\n          if (indent && indentAfter[name] && html.length > 0) {\n            value = html[html.length - 1];\n            if (value.length > 0 && value !== '\\n') {\n              html.push('\\n');\n            }\n          }\n        },\n        text: function (text, raw) {\n          if (text.length > 0) {\n            html[html.length] = raw ? text : encode(text);\n          }\n        },\n        cdata: function (text) {\n          html.push('<![CDATA[', text, ']]>');\n        },\n        comment: function (text) {\n          html.push('<!--', text, '-->');\n        },\n        pi: function (name, text) {\n          if (text) {\n            html.push('<?', name, ' ', encode(text), '?>');\n          } else {\n            html.push('<?', name, '?>');\n          }\n          if (indent) {\n            html.push('\\n');\n          }\n        },\n        doctype: function (text) {\n          html.push('<!DOCTYPE', text, '>', indent ? '\\n' : '');\n        },\n        reset: function () {\n          html.length = 0;\n        },\n        getContent: function () {\n          return html.join('').replace(/\\n$/, '');\n        }\n      };\n    }\n\n    function HtmlSerializer (settings, schema) {\n      if (schema === void 0) {\n        schema = Schema();\n      }\n      var writer = Writer(settings);\n      settings = settings || {};\n      settings.validate = 'validate' in settings ? settings.validate : true;\n      var serialize = function (node) {\n        var handlers, validate;\n        validate = settings.validate;\n        handlers = {\n          3: function (node) {\n            writer.text(node.value, node.raw);\n          },\n          8: function (node) {\n            writer.comment(node.value);\n          },\n          7: function (node) {\n            writer.pi(node.name, node.value);\n          },\n          10: function (node) {\n            writer.doctype(node.value);\n          },\n          4: function (node) {\n            writer.cdata(node.value);\n          },\n          11: function (node) {\n            if (node = node.firstChild) {\n              do {\n                walk(node);\n              } while (node = node.next);\n            }\n          }\n        };\n        writer.reset();\n        var walk = function (node) {\n          var handler = handlers[node.type];\n          var name, isEmpty, attrs, attrName, attrValue, sortedAttrs, i, l, elementRule;\n          if (!handler) {\n            name = node.name;\n            isEmpty = node.shortEnded;\n            attrs = node.attributes;\n            if (validate && attrs && attrs.length > 1) {\n              sortedAttrs = [];\n              sortedAttrs.map = {};\n              elementRule = schema.getElementRule(node.name);\n              if (elementRule) {\n                for (i = 0, l = elementRule.attributesOrder.length; i < l; i++) {\n                  attrName = elementRule.attributesOrder[i];\n                  if (attrName in attrs.map) {\n                    attrValue = attrs.map[attrName];\n                    sortedAttrs.map[attrName] = attrValue;\n                    sortedAttrs.push({\n                      name: attrName,\n                      value: attrValue\n                    });\n                  }\n                }\n                for (i = 0, l = attrs.length; i < l; i++) {\n                  attrName = attrs[i].name;\n                  if (!(attrName in sortedAttrs.map)) {\n                    attrValue = attrs.map[attrName];\n                    sortedAttrs.map[attrName] = attrValue;\n                    sortedAttrs.push({\n                      name: attrName,\n                      value: attrValue\n                    });\n                  }\n                }\n                attrs = sortedAttrs;\n              }\n            }\n            writer.start(node.name, attrs, isEmpty);\n            if (!isEmpty) {\n              if (node = node.firstChild) {\n                do {\n                  walk(node);\n                } while (node = node.next);\n              }\n              writer.end(name);\n            }\n          } else {\n            handler(node);\n          }\n        };\n        if (node.type === 1 && !settings.inner) {\n          walk(node);\n        } else {\n          handlers[11](node);\n        }\n        return writer.getContent();\n      };\n      return { serialize: serialize };\n    }\n\n    var createRange$1 = function (sc, so, ec, eo) {\n      var rng = domGlobals.document.createRange();\n      rng.setStart(sc, so);\n      rng.setEnd(ec, eo);\n      return rng;\n    };\n    var normalizeBlockSelectionRange = function (rng) {\n      var startPos = CaretPosition$1.fromRangeStart(rng);\n      var endPos = CaretPosition$1.fromRangeEnd(rng);\n      var rootNode = rng.commonAncestorContainer;\n      return CaretFinder.fromPosition(false, rootNode, endPos).map(function (newEndPos) {\n        if (!isInSameBlock(startPos, endPos, rootNode) && isInSameBlock(startPos, newEndPos, rootNode)) {\n          return createRange$1(startPos.container(), startPos.offset(), newEndPos.container(), newEndPos.offset());\n        } else {\n          return rng;\n        }\n      }).getOr(rng);\n    };\n    var normalize = function (rng) {\n      return rng.collapsed ? rng : normalizeBlockSelectionRange(rng);\n    };\n    var RangeNormalizer = { normalize: normalize };\n\n    var isAfterNbsp = function (container, offset) {\n      return NodeType.isText(container) && container.nodeValue[offset - 1] === '\\xA0';\n    };\n    var trimOrPadLeftRight = function (rng, html) {\n      var container, offset;\n      container = rng.startContainer;\n      offset = rng.startOffset;\n      var hasSiblingText = function (siblingName) {\n        return container[siblingName] && container[siblingName].nodeType === 3;\n      };\n      if (container.nodeType === 3) {\n        if (offset > 0) {\n          html = html.replace(/^&nbsp;/, ' ');\n        } else if (!hasSiblingText('previousSibling')) {\n          html = html.replace(/^ /, '&nbsp;');\n        }\n        if (offset < container.length) {\n          html = html.replace(/&nbsp;(<br>|)$/, ' ');\n        } else if (!hasSiblingText('nextSibling')) {\n          html = html.replace(/(&nbsp;| )(<br>|)$/, '&nbsp;');\n        }\n      }\n      return html;\n    };\n    var trimNbspAfterDeleteAndPadValue = function (rng, value) {\n      var container, offset;\n      container = rng.startContainer;\n      offset = rng.startOffset;\n      if (container.nodeType === 3 && rng.collapsed) {\n        if (container.data[offset] === '\\xA0') {\n          container.deleteData(offset, 1);\n          if (!/[\\u00a0| ]$/.test(value)) {\n            value += ' ';\n          }\n        } else if (container.data[offset - 1] === '\\xA0') {\n          container.deleteData(offset - 1, 1);\n          if (!/[\\u00a0| ]$/.test(value)) {\n            value = ' ' + value;\n          }\n        }\n      }\n      return value;\n    };\n\n    var isTableCell$2 = NodeType.matchNodeNames('td th');\n    var selectionSetContent = function (editor, content) {\n      var rng = editor.selection.getRng();\n      var container = rng.startContainer;\n      var offset = rng.startOffset;\n      if (rng.collapsed && isAfterNbsp(container, offset) && NodeType.isText(container)) {\n        container.insertData(offset - 1, ' ');\n        container.deleteData(offset, 1);\n        rng.setStart(container, offset);\n        rng.setEnd(container, offset);\n        editor.selection.setRng(rng);\n      }\n      editor.selection.setContent(content);\n    };\n    var validInsertion = function (editor, value, parentNode) {\n      if (parentNode.getAttribute('data-mce-bogus') === 'all') {\n        parentNode.parentNode.insertBefore(editor.dom.createFragment(value), parentNode);\n      } else {\n        var node = parentNode.firstChild;\n        var node2 = parentNode.lastChild;\n        if (!node || node === node2 && node.nodeName === 'BR') {\n          editor.dom.setHTML(parentNode, value);\n        } else {\n          selectionSetContent(editor, value);\n        }\n      }\n    };\n    var trimBrsFromTableCell = function (dom, elm) {\n      Option.from(dom.getParent(elm, 'td,th')).map(Element.fromDom).each(PaddingBr.trimBlockTrailingBr);\n    };\n    var reduceInlineTextElements = function (editor, merge) {\n      var textInlineElements = editor.schema.getTextInlineElements();\n      var dom = editor.dom;\n      if (merge) {\n        var root_1 = editor.getBody(), elementUtils_1 = new ElementUtils(dom);\n        Tools.each(dom.select('*[data-mce-fragment]'), function (node) {\n          for (var testNode = node.parentNode; testNode && testNode !== root_1; testNode = testNode.parentNode) {\n            if (textInlineElements[node.nodeName.toLowerCase()] && elementUtils_1.compare(testNode, node)) {\n              dom.remove(node, true);\n            }\n          }\n        });\n      }\n    };\n    var markFragmentElements = function (fragment) {\n      var node = fragment;\n      while (node = node.walk()) {\n        if (node.type === 1) {\n          node.attr('data-mce-fragment', '1');\n        }\n      }\n    };\n    var umarkFragmentElements = function (elm) {\n      Tools.each(elm.getElementsByTagName('*'), function (elm) {\n        elm.removeAttribute('data-mce-fragment');\n      });\n    };\n    var isPartOfFragment = function (node) {\n      return !!node.getAttribute('data-mce-fragment');\n    };\n    var canHaveChildren = function (editor, node) {\n      return node && !editor.schema.getShortEndedElements()[node.nodeName];\n    };\n    var moveSelectionToMarker = function (editor, marker) {\n      var parentEditableFalseElm, parentBlock, nextRng;\n      var dom = editor.dom, selection = editor.selection;\n      var node, node2;\n      var getContentEditableFalseParent = function (node) {\n        var root = editor.getBody();\n        for (; node && node !== root; node = node.parentNode) {\n          if (editor.dom.getContentEditable(node) === 'false') {\n            return node;\n          }\n        }\n        return null;\n      };\n      if (!marker) {\n        return;\n      }\n      editor.selection.scrollIntoView(marker);\n      parentEditableFalseElm = getContentEditableFalseParent(marker);\n      if (parentEditableFalseElm) {\n        dom.remove(marker);\n        selection.select(parentEditableFalseElm);\n        return;\n      }\n      var rng = dom.createRng();\n      node = marker.previousSibling;\n      if (node && node.nodeType === 3) {\n        rng.setStart(node, node.nodeValue.length);\n        if (!Env.ie) {\n          node2 = marker.nextSibling;\n          if (node2 && node2.nodeType === 3) {\n            node.appendData(node2.data);\n            node2.parentNode.removeChild(node2);\n          }\n        }\n      } else {\n        rng.setStartBefore(marker);\n        rng.setEndBefore(marker);\n      }\n      var findNextCaretRng = function (rng) {\n        var caretPos = CaretPosition$1.fromRangeStart(rng);\n        var caretWalker = CaretWalker(editor.getBody());\n        caretPos = caretWalker.next(caretPos);\n        if (caretPos) {\n          return caretPos.toRange();\n        }\n      };\n      parentBlock = dom.getParent(marker, dom.isBlock);\n      dom.remove(marker);\n      if (parentBlock && dom.isEmpty(parentBlock)) {\n        editor.$(parentBlock).empty();\n        rng.setStart(parentBlock, 0);\n        rng.setEnd(parentBlock, 0);\n        if (!isTableCell$2(parentBlock) && !isPartOfFragment(parentBlock) && (nextRng = findNextCaretRng(rng))) {\n          rng = nextRng;\n          dom.remove(parentBlock);\n        } else {\n          dom.add(parentBlock, dom.create('br', { 'data-mce-bogus': '1' }));\n        }\n      }\n      selection.setRng(rng);\n    };\n    var insertHtmlAtCaret = function (editor, value, details) {\n      var parser, serializer, parentNode, rootNode, fragment, args;\n      var marker, rng, node, bookmarkHtml, merge;\n      var selection = editor.selection, dom = editor.dom;\n      if (/^ | $/.test(value)) {\n        value = trimOrPadLeftRight(selection.getRng(), value);\n      }\n      parser = editor.parser;\n      merge = details.merge;\n      serializer = HtmlSerializer({ validate: editor.settings.validate }, editor.schema);\n      bookmarkHtml = '<span id=\"mce_marker\" data-mce-type=\"bookmark\">&#xFEFF;&#x200B;</span>';\n      args = {\n        content: value,\n        format: 'html',\n        selection: true,\n        paste: details.paste\n      };\n      args = editor.fire('BeforeSetContent', args);\n      if (args.isDefaultPrevented()) {\n        editor.fire('SetContent', {\n          content: args.content,\n          format: 'html',\n          selection: true,\n          paste: details.paste\n        });\n        return;\n      }\n      value = args.content;\n      if (value.indexOf('{$caret}') === -1) {\n        value += '{$caret}';\n      }\n      value = value.replace(/\\{\\$caret\\}/, bookmarkHtml);\n      rng = selection.getRng();\n      var caretElement = rng.startContainer || (rng.parentElement ? rng.parentElement() : null);\n      var body = editor.getBody();\n      if (caretElement === body && selection.isCollapsed()) {\n        if (dom.isBlock(body.firstChild) && canHaveChildren(editor, body.firstChild) && dom.isEmpty(body.firstChild)) {\n          rng = dom.createRng();\n          rng.setStart(body.firstChild, 0);\n          rng.setEnd(body.firstChild, 0);\n          selection.setRng(rng);\n        }\n      }\n      if (!selection.isCollapsed()) {\n        editor.selection.setRng(RangeNormalizer.normalize(editor.selection.getRng()));\n        editor.getDoc().execCommand('Delete', false, null);\n        value = trimNbspAfterDeleteAndPadValue(editor.selection.getRng(), value);\n      }\n      parentNode = selection.getNode();\n      var parserArgs = {\n        context: parentNode.nodeName.toLowerCase(),\n        data: details.data,\n        insert: true\n      };\n      fragment = parser.parse(value, parserArgs);\n      if (details.paste === true && InsertList.isListFragment(editor.schema, fragment) && InsertList.isParentBlockLi(dom, parentNode)) {\n        rng = InsertList.insertAtCaret(serializer, dom, editor.selection.getRng(), fragment);\n        editor.selection.setRng(rng);\n        editor.fire('SetContent', args);\n        return;\n      }\n      markFragmentElements(fragment);\n      node = fragment.lastChild;\n      if (node.attr('id') === 'mce_marker') {\n        marker = node;\n        for (node = node.prev; node; node = node.walk(true)) {\n          if (node.type === 3 || !dom.isBlock(node.name)) {\n            if (editor.schema.isValidChild(node.parent.name, 'span')) {\n              node.parent.insert(marker, node, node.name === 'br');\n            }\n            break;\n          }\n        }\n      }\n      editor._selectionOverrides.showBlockCaretContainer(parentNode);\n      if (!parserArgs.invalid) {\n        value = serializer.serialize(fragment);\n        validInsertion(editor, value, parentNode);\n      } else {\n        selectionSetContent(editor, bookmarkHtml);\n        parentNode = selection.getNode();\n        rootNode = editor.getBody();\n        if (parentNode.nodeType === 9) {\n          parentNode = node = rootNode;\n        } else {\n          node = parentNode;\n        }\n        while (node !== rootNode) {\n          parentNode = node;\n          node = node.parentNode;\n        }\n        value = parentNode === rootNode ? rootNode.innerHTML : dom.getOuterHTML(parentNode);\n        value = serializer.serialize(parser.parse(value.replace(/<span (id=\"mce_marker\"|id=mce_marker).+?<\\/span>/i, function () {\n          return serializer.serialize(fragment);\n        })));\n        if (parentNode === rootNode) {\n          dom.setHTML(rootNode, value);\n        } else {\n          dom.setOuterHTML(parentNode, value);\n        }\n      }\n      reduceInlineTextElements(editor, merge);\n      moveSelectionToMarker(editor, dom.get('mce_marker'));\n      umarkFragmentElements(editor.getBody());\n      trimBrsFromTableCell(editor.dom, editor.selection.getStart());\n      editor.fire('SetContent', args);\n      editor.addVisual();\n    };\n    var processValue = function (value) {\n      var details;\n      if (typeof value !== 'string') {\n        details = Tools.extend({\n          paste: value.paste,\n          data: { paste: value.paste }\n        }, value);\n        return {\n          content: value.content,\n          details: details\n        };\n      }\n      return {\n        content: value,\n        details: {}\n      };\n    };\n    var insertAtCaret$1 = function (editor, value) {\n      var result = processValue(value);\n      insertHtmlAtCaret(editor, result.content, result.details);\n    };\n    var InsertContent = { insertAtCaret: insertAtCaret$1 };\n\n    var strongRtl = /[\\u0591-\\u07FF\\uFB1D-\\uFDFF\\uFE70-\\uFEFC]/;\n    var hasStrongRtl = function (text) {\n      return strongRtl.test(text);\n    };\n\n    var getBodySetting = function (editor, name, defaultValue) {\n      var value = editor.getParam(name, defaultValue);\n      if (value.indexOf('=') !== -1) {\n        var bodyObj = editor.getParam(name, '', 'hash');\n        return bodyObj.hasOwnProperty(editor.id) ? bodyObj[editor.id] : defaultValue;\n      } else {\n        return value;\n      }\n    };\n    var getIframeAttrs = function (editor) {\n      return editor.getParam('iframe_attrs', {});\n    };\n    var getDocType = function (editor) {\n      return editor.getParam('doctype', '<!DOCTYPE html>');\n    };\n    var getDocumentBaseUrl = function (editor) {\n      return editor.getParam('document_base_url', '');\n    };\n    var getBodyId = function (editor) {\n      return getBodySetting(editor, 'body_id', 'tinymce');\n    };\n    var getBodyClass = function (editor) {\n      return getBodySetting(editor, 'body_class', '');\n    };\n    var getContentSecurityPolicy = function (editor) {\n      return editor.getParam('content_security_policy', '');\n    };\n    var shouldPutBrInPre = function (editor) {\n      return editor.getParam('br_in_pre', true);\n    };\n    var getForcedRootBlock = function (editor) {\n      if (editor.getParam('force_p_newlines', false)) {\n        return 'p';\n      }\n      var block = editor.getParam('forced_root_block', 'p');\n      return block === false ? '' : block;\n    };\n    var getForcedRootBlockAttrs = function (editor) {\n      return editor.getParam('forced_root_block_attrs', {});\n    };\n    var getBrNewLineSelector = function (editor) {\n      return editor.getParam('br_newline_selector', '.mce-toc h2,figcaption,caption');\n    };\n    var getNoNewLineSelector = function (editor) {\n      return editor.getParam('no_newline_selector', '');\n    };\n    var shouldKeepStyles = function (editor) {\n      return editor.getParam('keep_styles', true);\n    };\n    var shouldEndContainerOnEmptyBlock = function (editor) {\n      return editor.getParam('end_container_on_empty_block', false);\n    };\n    var getFontStyleValues = function (editor) {\n      return Tools.explode(editor.getParam('font_size_style_values', ''));\n    };\n    var getFontSizeClasses = function (editor) {\n      return Tools.explode(editor.getParam('font_size_classes', ''));\n    };\n    var getImagesDataImgFilter = function (editor) {\n      return editor.getParam('images_dataimg_filter', constant(true), 'function');\n    };\n    var isAutomaticUploadsEnabled = function (editor) {\n      return editor.getParam('automatic_uploads', true, 'boolean');\n    };\n    var shouldReuseFileName = function (editor) {\n      return editor.getParam('images_reuse_filename', false, 'boolean');\n    };\n    var shouldReplaceBlobUris = function (editor) {\n      return editor.getParam('images_replace_blob_uris', true, 'boolean');\n    };\n    var getImageUploadUrl = function (editor) {\n      return editor.getParam('images_upload_url', '', 'string');\n    };\n    var getImageUploadBasePath = function (editor) {\n      return editor.getParam('images_upload_base_path', '', 'string');\n    };\n    var getImagesUploadCredentials = function (editor) {\n      return editor.getParam('images_upload_credentials', false, 'boolean');\n    };\n    var getImagesUploadHandler = function (editor) {\n      return editor.getParam('images_upload_handler', null, 'function');\n    };\n    var shouldUseContentCssCors = function (editor) {\n      return editor.getParam('content_css_cors', false, 'boolean');\n    };\n    var getInlineBoundarySelector = function (editor) {\n      return editor.getParam('inline_boundaries_selector', 'a[href],code,.mce-annotation', 'string');\n    };\n    var Settings = {\n      getIframeAttrs: getIframeAttrs,\n      getDocType: getDocType,\n      getDocumentBaseUrl: getDocumentBaseUrl,\n      getBodyId: getBodyId,\n      getBodyClass: getBodyClass,\n      getContentSecurityPolicy: getContentSecurityPolicy,\n      shouldPutBrInPre: shouldPutBrInPre,\n      getForcedRootBlock: getForcedRootBlock,\n      getForcedRootBlockAttrs: getForcedRootBlockAttrs,\n      getBrNewLineSelector: getBrNewLineSelector,\n      getNoNewLineSelector: getNoNewLineSelector,\n      shouldKeepStyles: shouldKeepStyles,\n      shouldEndContainerOnEmptyBlock: shouldEndContainerOnEmptyBlock,\n      getFontStyleValues: getFontStyleValues,\n      getFontSizeClasses: getFontSizeClasses,\n      getImagesDataImgFilter: getImagesDataImgFilter,\n      isAutomaticUploadsEnabled: isAutomaticUploadsEnabled,\n      shouldReuseFileName: shouldReuseFileName,\n      shouldReplaceBlobUris: shouldReplaceBlobUris,\n      getImageUploadUrl: getImageUploadUrl,\n      getImageUploadBasePath: getImageUploadBasePath,\n      getImagesUploadCredentials: getImagesUploadCredentials,\n      getImagesUploadHandler: getImagesUploadHandler,\n      shouldUseContentCssCors: shouldUseContentCssCors,\n      getInlineBoundarySelector: getInlineBoundarySelector\n    };\n\n    var isInlineTarget = function (editor, elm) {\n      return is$1(Element.fromDom(elm), Settings.getInlineBoundarySelector(editor));\n    };\n    var isRtl = function (element) {\n      return DOMUtils$1.DOM.getStyle(element, 'direction', true) === 'rtl' || hasStrongRtl(element.textContent);\n    };\n    var findInlineParents = function (isInlineTarget, rootNode, pos) {\n      return filter(DOMUtils$1.DOM.getParents(pos.container(), '*', rootNode), isInlineTarget);\n    };\n    var findRootInline = function (isInlineTarget, rootNode, pos) {\n      var parents = findInlineParents(isInlineTarget, rootNode, pos);\n      return Option.from(parents[parents.length - 1]);\n    };\n    var hasSameParentBlock = function (rootNode, node1, node2) {\n      var block1 = getParentBlock(node1, rootNode);\n      var block2 = getParentBlock(node2, rootNode);\n      return block1 && block1 === block2;\n    };\n    var isAtZwsp = function (pos) {\n      return isBeforeInline(pos) || isAfterInline(pos);\n    };\n    var normalizePosition = function (forward, pos) {\n      if (!pos) {\n        return pos;\n      }\n      var container = pos.container(), offset = pos.offset();\n      if (forward) {\n        if (isCaretContainerInline(container)) {\n          if (NodeType.isText(container.nextSibling)) {\n            return CaretPosition$1(container.nextSibling, 0);\n          } else {\n            return CaretPosition$1.after(container);\n          }\n        } else {\n          return isBeforeInline(pos) ? CaretPosition$1(container, offset + 1) : pos;\n        }\n      } else {\n        if (isCaretContainerInline(container)) {\n          if (NodeType.isText(container.previousSibling)) {\n            return CaretPosition$1(container.previousSibling, container.previousSibling.data.length);\n          } else {\n            return CaretPosition$1.before(container);\n          }\n        } else {\n          return isAfterInline(pos) ? CaretPosition$1(container, offset - 1) : pos;\n        }\n      }\n    };\n    var normalizeForwards = curry(normalizePosition, true);\n    var normalizeBackwards = curry(normalizePosition, false);\n    var InlineUtils = {\n      isInlineTarget: isInlineTarget,\n      findRootInline: findRootInline,\n      isRtl: isRtl,\n      isAtZwsp: isAtZwsp,\n      normalizePosition: normalizePosition,\n      normalizeForwards: normalizeForwards,\n      normalizeBackwards: normalizeBackwards,\n      hasSameParentBlock: hasSameParentBlock\n    };\n\n    var isBeforeRoot = function (rootNode) {\n      return function (elm) {\n        return eq(rootNode, Element.fromDom(elm.dom().parentNode));\n      };\n    };\n    var getParentBlock$1 = function (rootNode, elm) {\n      return contains$3(rootNode, elm) ? closest(elm, function (element) {\n        return isTextBlock(element) || isListItem(element);\n      }, isBeforeRoot(rootNode)) : Option.none();\n    };\n    var placeCaretInEmptyBody = function (editor) {\n      var body = editor.getBody();\n      var node = body.firstChild && editor.dom.isBlock(body.firstChild) ? body.firstChild : body;\n      editor.selection.setCursorLocation(node, 0);\n    };\n    var paddEmptyBody = function (editor) {\n      if (editor.dom.isEmpty(editor.getBody())) {\n        editor.setContent('');\n        placeCaretInEmptyBody(editor);\n      }\n    };\n    var willDeleteLastPositionInElement = function (forward, fromPos, elm) {\n      return lift2(CaretFinder.firstPositionIn(elm), CaretFinder.lastPositionIn(elm), function (firstPos, lastPos) {\n        var normalizedFirstPos = InlineUtils.normalizePosition(true, firstPos);\n        var normalizedLastPos = InlineUtils.normalizePosition(false, lastPos);\n        var normalizedFromPos = InlineUtils.normalizePosition(false, fromPos);\n        if (forward) {\n          return CaretFinder.nextPosition(elm, normalizedFromPos).map(function (nextPos) {\n            return nextPos.isEqual(normalizedLastPos) && fromPos.isEqual(normalizedFirstPos);\n          }).getOr(false);\n        } else {\n          return CaretFinder.prevPosition(elm, normalizedFromPos).map(function (prevPos) {\n            return prevPos.isEqual(normalizedFirstPos) && fromPos.isEqual(normalizedLastPos);\n          }).getOr(false);\n        }\n      }).getOr(true);\n    };\n    var DeleteUtils = {\n      getParentBlock: getParentBlock$1,\n      paddEmptyBody: paddEmptyBody,\n      willDeleteLastPositionInElement: willDeleteLastPositionInElement\n    };\n\n    var ancestor$2 = function (scope, selector, isRoot) {\n      return ancestor$1(scope, selector, isRoot).isSome();\n    };\n\n    var hasWhitespacePreserveParent = function (rootNode, node) {\n      var rootElement = Element.fromDom(rootNode);\n      var startNode = Element.fromDom(node);\n      return ancestor$2(startNode, 'pre,code', curry(eq, rootElement));\n    };\n    var isWhitespace = function (rootNode, node) {\n      return NodeType.isText(node) && /^[ \\t\\r\\n]*$/.test(node.data) && hasWhitespacePreserveParent(rootNode, node) === false;\n    };\n    var isNamedAnchor = function (node) {\n      return NodeType.isElement(node) && node.nodeName === 'A' && node.hasAttribute('name');\n    };\n    var isContent = function (rootNode, node) {\n      return isCaretCandidate(node) && isWhitespace(rootNode, node) === false || isNamedAnchor(node) || isBookmark(node);\n    };\n    var isBookmark = NodeType.hasAttribute('data-mce-bookmark');\n    var isBogus$2 = NodeType.hasAttribute('data-mce-bogus');\n    var isBogusAll$1 = NodeType.hasAttributeValue('data-mce-bogus', 'all');\n    var isEmptyNode = function (targetNode) {\n      var walker, node, brCount = 0;\n      if (isContent(targetNode, targetNode)) {\n        return false;\n      } else {\n        node = targetNode.firstChild;\n        if (!node) {\n          return true;\n        }\n        walker = new TreeWalker(node, targetNode);\n        do {\n          if (isBogusAll$1(node)) {\n            node = walker.next(true);\n            continue;\n          }\n          if (isBogus$2(node)) {\n            node = walker.next();\n            continue;\n          }\n          if (NodeType.isBr(node)) {\n            brCount++;\n            node = walker.next();\n            continue;\n          }\n          if (isContent(targetNode, node)) {\n            return false;\n          }\n          node = walker.next();\n        } while (node);\n        return brCount <= 1;\n      }\n    };\n    var isEmpty$1 = function (elm) {\n      return isEmptyNode(elm.dom());\n    };\n    var Empty = { isEmpty: isEmpty$1 };\n\n    var BlockPosition = Immutable('block', 'position');\n    var BlockBoundary = Immutable('from', 'to');\n    var getBlockPosition = function (rootNode, pos) {\n      var rootElm = Element.fromDom(rootNode);\n      var containerElm = Element.fromDom(pos.container());\n      return DeleteUtils.getParentBlock(rootElm, containerElm).map(function (block) {\n        return BlockPosition(block, pos);\n      });\n    };\n    var isDifferentBlocks = function (blockBoundary) {\n      return eq(blockBoundary.from().block(), blockBoundary.to().block()) === false;\n    };\n    var hasSameParent = function (blockBoundary) {\n      return parent(blockBoundary.from().block()).bind(function (parent1) {\n        return parent(blockBoundary.to().block()).filter(function (parent2) {\n          return eq(parent1, parent2);\n        });\n      }).isSome();\n    };\n    var isEditable = function (blockBoundary) {\n      return NodeType.isContentEditableFalse(blockBoundary.from().block().dom()) === false && NodeType.isContentEditableFalse(blockBoundary.to().block().dom()) === false;\n    };\n    var skipLastBr = function (rootNode, forward, blockPosition) {\n      if (NodeType.isBr(blockPosition.position().getNode()) && Empty.isEmpty(blockPosition.block()) === false) {\n        return CaretFinder.positionIn(false, blockPosition.block().dom()).bind(function (lastPositionInBlock) {\n          if (lastPositionInBlock.isEqual(blockPosition.position())) {\n            return CaretFinder.fromPosition(forward, rootNode, lastPositionInBlock).bind(function (to) {\n              return getBlockPosition(rootNode, to);\n            });\n          } else {\n            return Option.some(blockPosition);\n          }\n        }).getOr(blockPosition);\n      } else {\n        return blockPosition;\n      }\n    };\n    var readFromRange = function (rootNode, forward, rng) {\n      var fromBlockPos = getBlockPosition(rootNode, CaretPosition$1.fromRangeStart(rng));\n      var toBlockPos = fromBlockPos.bind(function (blockPos) {\n        return CaretFinder.fromPosition(forward, rootNode, blockPos.position()).bind(function (to) {\n          return getBlockPosition(rootNode, to).map(function (blockPos) {\n            return skipLastBr(rootNode, forward, blockPos);\n          });\n        });\n      });\n      return lift2(fromBlockPos, toBlockPos, BlockBoundary).filter(function (blockBoundary) {\n        return isDifferentBlocks(blockBoundary) && hasSameParent(blockBoundary) && isEditable(blockBoundary);\n      });\n    };\n    var read$1 = function (rootNode, forward, rng) {\n      return rng.collapsed ? readFromRange(rootNode, forward, rng) : Option.none();\n    };\n    var BlockMergeBoundary = { read: read$1 };\n\n    var dropLast = function (xs) {\n      return xs.slice(0, -1);\n    };\n    var parentsUntil$1 = function (start, root, predicate) {\n      if (contains$3(root, start)) {\n        return dropLast(parents(start, function (elm) {\n          return predicate(elm) || eq(elm, root);\n        }));\n      } else {\n        return [];\n      }\n    };\n    var parents$1 = function (start, root) {\n      return parentsUntil$1(start, root, constant(false));\n    };\n    var parentsAndSelf = function (start, root) {\n      return [start].concat(parents$1(start, root));\n    };\n    var Parents = {\n      parentsUntil: parentsUntil$1,\n      parents: parents$1,\n      parentsAndSelf: parentsAndSelf\n    };\n\n    var getChildrenUntilBlockBoundary = function (block) {\n      var children$1 = children(block);\n      return findIndex(children$1, isBlock).fold(function () {\n        return children$1;\n      }, function (index) {\n        return children$1.slice(0, index);\n      });\n    };\n    var extractChildren = function (block) {\n      var children = getChildrenUntilBlockBoundary(block);\n      each(children, remove$1);\n      return children;\n    };\n    var removeEmptyRoot = function (rootNode, block) {\n      var parents = Parents.parentsAndSelf(block, rootNode);\n      return find(parents.reverse(), Empty.isEmpty).each(remove$1);\n    };\n    var isEmptyBefore = function (el) {\n      return filter(prevSiblings(el), function (el) {\n        return !Empty.isEmpty(el);\n      }).length === 0;\n    };\n    var nestedBlockMerge = function (rootNode, fromBlock, toBlock, insertionPoint) {\n      if (Empty.isEmpty(toBlock)) {\n        PaddingBr.fillWithPaddingBr(toBlock);\n        return CaretFinder.firstPositionIn(toBlock.dom());\n      }\n      if (isEmptyBefore(insertionPoint) && Empty.isEmpty(fromBlock)) {\n        before(insertionPoint, Element.fromTag('br'));\n      }\n      var position = CaretFinder.prevPosition(toBlock.dom(), CaretPosition$1.before(insertionPoint.dom()));\n      each(extractChildren(fromBlock), function (child) {\n        before(insertionPoint, child);\n      });\n      removeEmptyRoot(rootNode, fromBlock);\n      return position;\n    };\n    var sidelongBlockMerge = function (rootNode, fromBlock, toBlock) {\n      if (Empty.isEmpty(toBlock)) {\n        remove$1(toBlock);\n        if (Empty.isEmpty(fromBlock)) {\n          PaddingBr.fillWithPaddingBr(fromBlock);\n        }\n        return CaretFinder.firstPositionIn(fromBlock.dom());\n      }\n      var position = CaretFinder.lastPositionIn(toBlock.dom());\n      each(extractChildren(fromBlock), function (child) {\n        append(toBlock, child);\n      });\n      removeEmptyRoot(rootNode, fromBlock);\n      return position;\n    };\n    var findInsertionPoint = function (toBlock, block) {\n      var parentsAndSelf = Parents.parentsAndSelf(block, toBlock);\n      return Option.from(parentsAndSelf[parentsAndSelf.length - 1]);\n    };\n    var getInsertionPoint = function (fromBlock, toBlock) {\n      return contains$3(toBlock, fromBlock) ? findInsertionPoint(toBlock, fromBlock) : Option.none();\n    };\n    var trimBr = function (first, block) {\n      CaretFinder.positionIn(first, block.dom()).map(function (position) {\n        return position.getNode();\n      }).map(Element.fromDom).filter(isBr).each(remove$1);\n    };\n    var mergeBlockInto = function (rootNode, fromBlock, toBlock) {\n      trimBr(true, fromBlock);\n      trimBr(false, toBlock);\n      return getInsertionPoint(fromBlock, toBlock).fold(curry(sidelongBlockMerge, rootNode, fromBlock, toBlock), curry(nestedBlockMerge, rootNode, fromBlock, toBlock));\n    };\n    var mergeBlocks = function (rootNode, forward, block1, block2) {\n      return forward ? mergeBlockInto(rootNode, block2, block1) : mergeBlockInto(rootNode, block1, block2);\n    };\n    var MergeBlocks = { mergeBlocks: mergeBlocks };\n\n    var backspaceDelete = function (editor, forward) {\n      var position;\n      var rootNode = Element.fromDom(editor.getBody());\n      position = BlockMergeBoundary.read(rootNode.dom(), forward, editor.selection.getRng()).bind(function (blockBoundary) {\n        return MergeBlocks.mergeBlocks(rootNode, forward, blockBoundary.from().block(), blockBoundary.to().block());\n      });\n      position.each(function (pos) {\n        editor.selection.setRng(pos.toRange());\n      });\n      return position.isSome();\n    };\n    var BlockBoundaryDelete = { backspaceDelete: backspaceDelete };\n\n    var deleteRangeMergeBlocks = function (rootNode, selection) {\n      var rng = selection.getRng();\n      return lift2(DeleteUtils.getParentBlock(rootNode, Element.fromDom(rng.startContainer)), DeleteUtils.getParentBlock(rootNode, Element.fromDom(rng.endContainer)), function (block1, block2) {\n        if (eq(block1, block2) === false) {\n          rng.deleteContents();\n          MergeBlocks.mergeBlocks(rootNode, true, block1, block2).each(function (pos) {\n            selection.setRng(pos.toRange());\n          });\n          return true;\n        } else {\n          return false;\n        }\n      }).getOr(false);\n    };\n    var isRawNodeInTable = function (root, rawNode) {\n      var node = Element.fromDom(rawNode);\n      var isRoot = curry(eq, root);\n      return ancestor(node, isTableCell, isRoot).isSome();\n    };\n    var isSelectionInTable = function (root, rng) {\n      return isRawNodeInTable(root, rng.startContainer) || isRawNodeInTable(root, rng.endContainer);\n    };\n    var isEverythingSelected = function (root, rng) {\n      var noPrevious = CaretFinder.prevPosition(root.dom(), CaretPosition$1.fromRangeStart(rng)).isNone();\n      var noNext = CaretFinder.nextPosition(root.dom(), CaretPosition$1.fromRangeEnd(rng)).isNone();\n      return !isSelectionInTable(root, rng) && noPrevious && noNext;\n    };\n    var emptyEditor = function (editor) {\n      editor.setContent('');\n      editor.selection.setCursorLocation();\n      return true;\n    };\n    var deleteRange = function (editor) {\n      var rootNode = Element.fromDom(editor.getBody());\n      var rng = editor.selection.getRng();\n      return isEverythingSelected(rootNode, rng) ? emptyEditor(editor) : deleteRangeMergeBlocks(rootNode, editor.selection);\n    };\n    var backspaceDelete$1 = function (editor, forward) {\n      return editor.selection.isCollapsed() ? false : deleteRange(editor);\n    };\n    var BlockRangeDelete = { backspaceDelete: backspaceDelete$1 };\n\n    var generate$1 = function (cases) {\n      if (!isArray(cases)) {\n        throw new Error('cases must be an array');\n      }\n      if (cases.length === 0) {\n        throw new Error('there must be at least one case');\n      }\n      var constructors = [];\n      var adt = {};\n      each(cases, function (acase, count) {\n        var keys$1 = keys(acase);\n        if (keys$1.length !== 1) {\n          throw new Error('one and only one name per case');\n        }\n        var key = keys$1[0];\n        var value = acase[key];\n        if (adt[key] !== undefined) {\n          throw new Error('duplicate key detected:' + key);\n        } else if (key === 'cata') {\n          throw new Error('cannot have a case named cata (sorry)');\n        } else if (!isArray(value)) {\n          throw new Error('case arguments must be an array');\n        }\n        constructors.push(key);\n        adt[key] = function () {\n          var argLength = arguments.length;\n          if (argLength !== value.length) {\n            throw new Error('Wrong number of arguments to case ' + key + '. Expected ' + value.length + ' (' + value + '), got ' + argLength);\n          }\n          var args = new Array(argLength);\n          for (var i = 0; i < args.length; i++) {\n            args[i] = arguments[i];\n          }\n          var match = function (branches) {\n            var branchKeys = keys(branches);\n            if (constructors.length !== branchKeys.length) {\n              throw new Error('Wrong number of arguments to match. Expected: ' + constructors.join(',') + '\\nActual: ' + branchKeys.join(','));\n            }\n            var allReqd = forall(constructors, function (reqKey) {\n              return contains(branchKeys, reqKey);\n            });\n            if (!allReqd) {\n              throw new Error('Not all branches were specified when using match. Specified: ' + branchKeys.join(', ') + '\\nRequired: ' + constructors.join(', '));\n            }\n            return branches[key].apply(null, args);\n          };\n          return {\n            fold: function () {\n              if (arguments.length !== cases.length) {\n                throw new Error('Wrong number of arguments to fold. Expected ' + cases.length + ', got ' + arguments.length);\n              }\n              var target = arguments[count];\n              return target.apply(null, args);\n            },\n            match: match,\n            log: function (label) {\n              domGlobals.console.log(label, {\n                constructors: constructors,\n                constructor: key,\n                params: args\n              });\n            }\n          };\n        };\n      });\n      return adt;\n    };\n    var Adt = { generate: generate$1 };\n\n    var isBr$5 = function (pos) {\n      return getElementFromPosition(pos).exists(isBr);\n    };\n    var findBr = function (forward, root, pos) {\n      var parentBlocks = filter(Parents.parentsAndSelf(Element.fromDom(pos.container()), root), isBlock);\n      var scope = head(parentBlocks).getOr(root);\n      return CaretFinder.fromPosition(forward, scope.dom(), pos).filter(isBr$5);\n    };\n    var isBeforeBr = function (root, pos) {\n      return getElementFromPosition(pos).exists(isBr) || findBr(true, root, pos).isSome();\n    };\n    var isAfterBr = function (root, pos) {\n      return getElementFromPrevPosition(pos).exists(isBr) || findBr(false, root, pos).isSome();\n    };\n    var findPreviousBr = curry(findBr, false);\n    var findNextBr = curry(findBr, true);\n\n    var is$2 = function (expected) {\n      return function (actual) {\n        return expected === actual;\n      };\n    };\n    var isNbsp = is$2('\\xA0');\n    var isWhiteSpace$1 = function (chr) {\n      return /^[\\r\\n\\t ]$/.test(chr);\n    };\n    var isContent$1 = function (chr) {\n      return !isWhiteSpace$1(chr) && !isNbsp(chr);\n    };\n\n    var isChar = function (forward, predicate, pos) {\n      return Option.from(pos.container()).filter(NodeType.isText).exists(function (text) {\n        var delta = forward ? 0 : -1;\n        return predicate(text.data.charAt(pos.offset() + delta));\n      });\n    };\n    var isBeforeSpace = curry(isChar, true, isWhiteSpace$1);\n    var isAfterSpace = curry(isChar, false, isWhiteSpace$1);\n    var isEmptyText = function (pos) {\n      var container = pos.container();\n      return NodeType.isText(container) && container.data.length === 0;\n    };\n    var isNextToContentEditableFalse = function (relativeOffset, caretPosition) {\n      var node = getChildNodeAtRelativeOffset(relativeOffset, caretPosition);\n      return NodeType.isContentEditableFalse(node) && !NodeType.isBogusAll(node);\n    };\n    var isBeforeContentEditableFalse = curry(isNextToContentEditableFalse, 0);\n    var isAfterContentEditableFalse = curry(isNextToContentEditableFalse, -1);\n    var isNextToTable = function (relativeOffset, caretPosition) {\n      return NodeType.isTable(getChildNodeAtRelativeOffset(relativeOffset, caretPosition));\n    };\n    var isBeforeTable = curry(isNextToTable, 0);\n    var isAfterTable = curry(isNextToTable, -1);\n\n    var isCompoundElement = function (node) {\n      return isTableCell(Element.fromDom(node)) || isListItem(Element.fromDom(node));\n    };\n    var DeleteAction = Adt.generate([\n      { remove: ['element'] },\n      { moveToElement: ['element'] },\n      { moveToPosition: ['position'] }\n    ]);\n    var isAtContentEditableBlockCaret = function (forward, from) {\n      var elm = from.getNode(forward === false);\n      var caretLocation = forward ? 'after' : 'before';\n      return NodeType.isElement(elm) && elm.getAttribute('data-mce-caret') === caretLocation;\n    };\n    var isDeleteFromCefDifferentBlocks = function (root, forward, from, to) {\n      var inSameBlock = function (elm) {\n        return isInline(Element.fromDom(elm)) && !isInSameBlock(from, to, root);\n      };\n      return getRelativeCefElm(!forward, from).fold(function () {\n        return getRelativeCefElm(forward, to).fold(constant(false), inSameBlock);\n      }, inSameBlock);\n    };\n    var deleteEmptyBlockOrMoveToCef = function (root, forward, from, to) {\n      var toCefElm = to.getNode(forward === false);\n      return DeleteUtils.getParentBlock(Element.fromDom(root), Element.fromDom(from.getNode())).map(function (blockElm) {\n        return Empty.isEmpty(blockElm) ? DeleteAction.remove(blockElm.dom()) : DeleteAction.moveToElement(toCefElm);\n      }).orThunk(function () {\n        return Option.some(DeleteAction.moveToElement(toCefElm));\n      });\n    };\n    var findCefPosition = function (root, forward, from) {\n      return CaretFinder.fromPosition(forward, root, from).bind(function (to) {\n        if (isCompoundElement(to.getNode())) {\n          return Option.none();\n        } else if (isDeleteFromCefDifferentBlocks(root, forward, from, to)) {\n          return Option.none();\n        } else if (forward && NodeType.isContentEditableFalse(to.getNode())) {\n          return deleteEmptyBlockOrMoveToCef(root, forward, from, to);\n        } else if (forward === false && NodeType.isContentEditableFalse(to.getNode(true))) {\n          return deleteEmptyBlockOrMoveToCef(root, forward, from, to);\n        } else if (forward && isAfterContentEditableFalse(from)) {\n          return Option.some(DeleteAction.moveToPosition(to));\n        } else if (forward === false && isBeforeContentEditableFalse(from)) {\n          return Option.some(DeleteAction.moveToPosition(to));\n        } else {\n          return Option.none();\n        }\n      });\n    };\n    var getContentEditableBlockAction = function (forward, elm) {\n      if (forward && NodeType.isContentEditableFalse(elm.nextSibling)) {\n        return Option.some(DeleteAction.moveToElement(elm.nextSibling));\n      } else if (forward === false && NodeType.isContentEditableFalse(elm.previousSibling)) {\n        return Option.some(DeleteAction.moveToElement(elm.previousSibling));\n      } else {\n        return Option.none();\n      }\n    };\n    var skipMoveToActionFromInlineCefToContent = function (root, from, deleteAction) {\n      return deleteAction.fold(function (elm) {\n        return Option.some(DeleteAction.remove(elm));\n      }, function (elm) {\n        return Option.some(DeleteAction.moveToElement(elm));\n      }, function (to) {\n        if (isInSameBlock(from, to, root)) {\n          return Option.none();\n        } else {\n          return Option.some(DeleteAction.moveToPosition(to));\n        }\n      });\n    };\n    var getContentEditableAction = function (root, forward, from) {\n      if (isAtContentEditableBlockCaret(forward, from)) {\n        return getContentEditableBlockAction(forward, from.getNode(forward === false)).fold(function () {\n          return findCefPosition(root, forward, from);\n        }, Option.some);\n      } else {\n        return findCefPosition(root, forward, from).bind(function (deleteAction) {\n          return skipMoveToActionFromInlineCefToContent(root, from, deleteAction);\n        });\n      }\n    };\n    var read$2 = function (root, forward, rng) {\n      var normalizedRange = normalizeRange(forward ? 1 : -1, root, rng);\n      var from = CaretPosition$1.fromRangeStart(normalizedRange);\n      var rootElement = Element.fromDom(root);\n      if (forward === false && isAfterContentEditableFalse(from)) {\n        return Option.some(DeleteAction.remove(from.getNode(true)));\n      } else if (forward && isBeforeContentEditableFalse(from)) {\n        return Option.some(DeleteAction.remove(from.getNode()));\n      } else if (forward === false && isBeforeContentEditableFalse(from) && isAfterBr(rootElement, from)) {\n        return findPreviousBr(rootElement, from).map(function (br) {\n          return DeleteAction.remove(br.getNode());\n        });\n      } else if (forward && isAfterContentEditableFalse(from) && isBeforeBr(rootElement, from)) {\n        return findNextBr(rootElement, from).map(function (br) {\n          return DeleteAction.remove(br.getNode());\n        });\n      } else {\n        return getContentEditableAction(root, forward, from);\n      }\n    };\n\n    var isCollapsibleWhitespace = function (c) {\n      return ' \\f\\n\\r\\t\\x0B'.indexOf(c) !== -1;\n    };\n    var normalizeContent = function (content, isStartOfContent, isEndOfContent) {\n      var result = foldl(content.split(''), function (acc, c) {\n        if (isCollapsibleWhitespace(c) || c === '\\xA0') {\n          if (acc.previousCharIsSpace || acc.str === '' && isStartOfContent || acc.str.length === content.length - 1 && isEndOfContent) {\n            return {\n              previousCharIsSpace: false,\n              str: acc.str + '\\xA0'\n            };\n          } else {\n            return {\n              previousCharIsSpace: true,\n              str: acc.str + ' '\n            };\n          }\n        } else {\n          return {\n            previousCharIsSpace: false,\n            str: acc.str + c\n          };\n        }\n      }, {\n        previousCharIsSpace: false,\n        str: ''\n      });\n      return result.str;\n    };\n    var normalize$1 = function (node, offset, count) {\n      if (count === 0) {\n        return;\n      }\n      var whitespace = node.data.slice(offset, offset + count);\n      var isEndOfContent = offset + count >= node.data.length;\n      var isStartOfContent = offset === 0;\n      node.replaceData(offset, count, normalizeContent(whitespace, isStartOfContent, isEndOfContent));\n    };\n    var normalizeWhitespaceAfter = function (node, offset) {\n      var content = node.data.slice(offset);\n      var whitespaceCount = content.length - lTrim(content).length;\n      return normalize$1(node, offset, whitespaceCount);\n    };\n    var normalizeWhitespaceBefore = function (node, offset) {\n      var content = node.data.slice(0, offset);\n      var whitespaceCount = content.length - rTrim(content).length;\n      return normalize$1(node, offset - whitespaceCount, whitespaceCount);\n    };\n    var mergeTextNodes = function (prevNode, nextNode, normalizeWhitespace) {\n      var whitespaceOffset = rTrim(prevNode.data).length;\n      prevNode.appendData(nextNode.data);\n      remove$1(Element.fromDom(nextNode));\n      if (normalizeWhitespace) {\n        normalizeWhitespaceAfter(prevNode, whitespaceOffset);\n      }\n      return prevNode;\n    };\n\n    var needsReposition = function (pos, elm) {\n      var container = pos.container();\n      var offset = pos.offset();\n      return CaretPosition$1.isTextPosition(pos) === false && container === elm.parentNode && offset > CaretPosition$1.before(elm).offset();\n    };\n    var reposition = function (elm, pos) {\n      return needsReposition(pos, elm) ? CaretPosition$1(pos.container(), pos.offset() - 1) : pos;\n    };\n    var beforeOrStartOf = function (node) {\n      return NodeType.isText(node) ? CaretPosition$1(node, 0) : CaretPosition$1.before(node);\n    };\n    var afterOrEndOf = function (node) {\n      return NodeType.isText(node) ? CaretPosition$1(node, node.data.length) : CaretPosition$1.after(node);\n    };\n    var getPreviousSiblingCaretPosition = function (elm) {\n      if (isCaretCandidate(elm.previousSibling)) {\n        return Option.some(afterOrEndOf(elm.previousSibling));\n      } else {\n        return elm.previousSibling ? CaretFinder.lastPositionIn(elm.previousSibling) : Option.none();\n      }\n    };\n    var getNextSiblingCaretPosition = function (elm) {\n      if (isCaretCandidate(elm.nextSibling)) {\n        return Option.some(beforeOrStartOf(elm.nextSibling));\n      } else {\n        return elm.nextSibling ? CaretFinder.firstPositionIn(elm.nextSibling) : Option.none();\n      }\n    };\n    var findCaretPositionBackwardsFromElm = function (rootElement, elm) {\n      var startPosition = CaretPosition$1.before(elm.previousSibling ? elm.previousSibling : elm.parentNode);\n      return CaretFinder.prevPosition(rootElement, startPosition).fold(function () {\n        return CaretFinder.nextPosition(rootElement, CaretPosition$1.after(elm));\n      }, Option.some);\n    };\n    var findCaretPositionForwardsFromElm = function (rootElement, elm) {\n      return CaretFinder.nextPosition(rootElement, CaretPosition$1.after(elm)).fold(function () {\n        return CaretFinder.prevPosition(rootElement, CaretPosition$1.before(elm));\n      }, Option.some);\n    };\n    var findCaretPositionBackwards = function (rootElement, elm) {\n      return getPreviousSiblingCaretPosition(elm).orThunk(function () {\n        return getNextSiblingCaretPosition(elm);\n      }).orThunk(function () {\n        return findCaretPositionBackwardsFromElm(rootElement, elm);\n      });\n    };\n    var findCaretPositionForward = function (rootElement, elm) {\n      return getNextSiblingCaretPosition(elm).orThunk(function () {\n        return getPreviousSiblingCaretPosition(elm);\n      }).orThunk(function () {\n        return findCaretPositionForwardsFromElm(rootElement, elm);\n      });\n    };\n    var findCaretPosition$1 = function (forward, rootElement, elm) {\n      return forward ? findCaretPositionForward(rootElement, elm) : findCaretPositionBackwards(rootElement, elm);\n    };\n    var findCaretPosOutsideElmAfterDelete = function (forward, rootElement, elm) {\n      return findCaretPosition$1(forward, rootElement, elm).map(curry(reposition, elm));\n    };\n    var setSelection = function (editor, forward, pos) {\n      pos.fold(function () {\n        editor.focus();\n      }, function (pos) {\n        editor.selection.setRng(pos.toRange(), forward);\n      });\n    };\n    var eqRawNode = function (rawNode) {\n      return function (elm) {\n        return elm.dom() === rawNode;\n      };\n    };\n    var isBlock$2 = function (editor, elm) {\n      return elm && editor.schema.getBlockElements().hasOwnProperty(name(elm));\n    };\n    var paddEmptyBlock = function (elm) {\n      if (Empty.isEmpty(elm)) {\n        var br = Element.fromHtml('<br data-mce-bogus=\"1\">');\n        empty(elm);\n        append(elm, br);\n        return Option.some(CaretPosition$1.before(br.dom()));\n      } else {\n        return Option.none();\n      }\n    };\n    var deleteNormalized = function (elm, afterDeletePosOpt, normalizeWhitespace) {\n      var prevTextOpt = prevSibling(elm).filter(isText);\n      var nextTextOpt = nextSibling(elm).filter(isText);\n      remove$1(elm);\n      return lift3(prevTextOpt, nextTextOpt, afterDeletePosOpt, function (prev, next, pos) {\n        var prevNode = prev.dom(), nextNode = next.dom();\n        var offset = prevNode.data.length;\n        mergeTextNodes(prevNode, nextNode, normalizeWhitespace);\n        return pos.container() === nextNode ? CaretPosition$1(prevNode, offset) : pos;\n      }).orThunk(function () {\n        if (normalizeWhitespace) {\n          prevTextOpt.each(function (elm) {\n            return normalizeWhitespaceBefore(elm.dom(), elm.dom().length);\n          });\n          nextTextOpt.each(function (elm) {\n            return normalizeWhitespaceAfter(elm.dom(), 0);\n          });\n        }\n        return afterDeletePosOpt;\n      });\n    };\n    var isInlineElement = function (editor, element) {\n      return has(editor.schema.getTextInlineElements(), name(element));\n    };\n    var deleteElement = function (editor, forward, elm, moveCaret) {\n      if (moveCaret === void 0) {\n        moveCaret = true;\n      }\n      var afterDeletePos = findCaretPosOutsideElmAfterDelete(forward, editor.getBody(), elm.dom());\n      var parentBlock = ancestor(elm, curry(isBlock$2, editor), eqRawNode(editor.getBody()));\n      var normalizedAfterDeletePos = deleteNormalized(elm, afterDeletePos, isInlineElement(editor, elm));\n      if (editor.dom.isEmpty(editor.getBody())) {\n        editor.setContent('');\n        editor.selection.setCursorLocation();\n      } else {\n        parentBlock.bind(paddEmptyBlock).fold(function () {\n          if (moveCaret) {\n            setSelection(editor, forward, normalizedAfterDeletePos);\n          }\n        }, function (paddPos) {\n          if (moveCaret) {\n            setSelection(editor, forward, Option.some(paddPos));\n          }\n        });\n      }\n    };\n    var DeleteElement = { deleteElement: deleteElement };\n\n    var deleteElement$1 = function (editor, forward) {\n      return function (element) {\n        editor._selectionOverrides.hideFakeCaret();\n        DeleteElement.deleteElement(editor, forward, Element.fromDom(element));\n        return true;\n      };\n    };\n    var moveToElement = function (editor, forward) {\n      return function (element) {\n        var pos = forward ? CaretPosition$1.before(element) : CaretPosition$1.after(element);\n        editor.selection.setRng(pos.toRange());\n        return true;\n      };\n    };\n    var moveToPosition = function (editor) {\n      return function (pos) {\n        editor.selection.setRng(pos.toRange());\n        return true;\n      };\n    };\n    var backspaceDeleteCaret = function (editor, forward) {\n      var result = read$2(editor.getBody(), forward, editor.selection.getRng()).map(function (deleteAction) {\n        return deleteAction.fold(deleteElement$1(editor, forward), moveToElement(editor, forward), moveToPosition(editor));\n      });\n      return result.getOr(false);\n    };\n    var deleteOffscreenSelection = function (rootElement) {\n      each(descendants$1(rootElement, '.mce-offscreen-selection'), remove$1);\n    };\n    var backspaceDeleteRange = function (editor, forward) {\n      var selectedElement = editor.selection.getNode();\n      if (NodeType.isContentEditableFalse(selectedElement)) {\n        deleteOffscreenSelection(Element.fromDom(editor.getBody()));\n        DeleteElement.deleteElement(editor, forward, Element.fromDom(editor.selection.getNode()));\n        DeleteUtils.paddEmptyBody(editor);\n        return true;\n      } else {\n        return false;\n      }\n    };\n    var getContentEditableRoot = function (root, node) {\n      while (node && node !== root) {\n        if (NodeType.isContentEditableTrue(node) || NodeType.isContentEditableFalse(node)) {\n          return node;\n        }\n        node = node.parentNode;\n      }\n      return null;\n    };\n    var paddEmptyElement = function (editor) {\n      var br;\n      var ceRoot = getContentEditableRoot(editor.getBody(), editor.selection.getNode());\n      if (NodeType.isContentEditableTrue(ceRoot) && editor.dom.isBlock(ceRoot) && editor.dom.isEmpty(ceRoot)) {\n        br = editor.dom.create('br', { 'data-mce-bogus': '1' });\n        editor.dom.setHTML(ceRoot, '');\n        ceRoot.appendChild(br);\n        editor.selection.setRng(CaretPosition$1.before(br).toRange());\n      }\n      return true;\n    };\n    var backspaceDelete$2 = function (editor, forward) {\n      if (editor.selection.isCollapsed()) {\n        return backspaceDeleteCaret(editor, forward);\n      } else {\n        return backspaceDeleteRange(editor, forward);\n      }\n    };\n    var CefDelete = {\n      backspaceDelete: backspaceDelete$2,\n      paddEmptyElement: paddEmptyElement\n    };\n\n    var isText$8 = NodeType.isText;\n    var startsWithCaretContainer$1 = function (node) {\n      return isText$8(node) && node.data[0] === Zwsp.ZWSP;\n    };\n    var endsWithCaretContainer$1 = function (node) {\n      return isText$8(node) && node.data[node.data.length - 1] === Zwsp.ZWSP;\n    };\n    var createZwsp = function (node) {\n      return node.ownerDocument.createTextNode(Zwsp.ZWSP);\n    };\n    var insertBefore$1 = function (node) {\n      if (isText$8(node.previousSibling)) {\n        if (endsWithCaretContainer$1(node.previousSibling)) {\n          return node.previousSibling;\n        } else {\n          node.previousSibling.appendData(Zwsp.ZWSP);\n          return node.previousSibling;\n        }\n      } else if (isText$8(node)) {\n        if (startsWithCaretContainer$1(node)) {\n          return node;\n        } else {\n          node.insertData(0, Zwsp.ZWSP);\n          return node;\n        }\n      } else {\n        var newNode = createZwsp(node);\n        node.parentNode.insertBefore(newNode, node);\n        return newNode;\n      }\n    };\n    var insertAfter$1 = function (node) {\n      if (isText$8(node.nextSibling)) {\n        if (startsWithCaretContainer$1(node.nextSibling)) {\n          return node.nextSibling;\n        } else {\n          node.nextSibling.insertData(0, Zwsp.ZWSP);\n          return node.nextSibling;\n        }\n      } else if (isText$8(node)) {\n        if (endsWithCaretContainer$1(node)) {\n          return node;\n        } else {\n          node.appendData(Zwsp.ZWSP);\n          return node;\n        }\n      } else {\n        var newNode = createZwsp(node);\n        if (node.nextSibling) {\n          node.parentNode.insertBefore(newNode, node.nextSibling);\n        } else {\n          node.parentNode.appendChild(newNode);\n        }\n        return newNode;\n      }\n    };\n    var insertInline$1 = function (before, node) {\n      return before ? insertBefore$1(node) : insertAfter$1(node);\n    };\n    var insertInlineBefore = curry(insertInline$1, true);\n    var insertInlineAfter = curry(insertInline$1, false);\n\n    var insertInlinePos = function (pos, before) {\n      if (NodeType.isText(pos.container())) {\n        return insertInline$1(before, pos.container());\n      } else {\n        return insertInline$1(before, pos.getNode());\n      }\n    };\n    var isPosCaretContainer = function (pos, caret) {\n      var caretNode = caret.get();\n      return caretNode && pos.container() === caretNode && isCaretContainerInline(caretNode);\n    };\n    var renderCaret = function (caret, location) {\n      return location.fold(function (element) {\n        CaretContainerRemove.remove(caret.get());\n        var text = insertInlineBefore(element);\n        caret.set(text);\n        return Option.some(CaretPosition$1(text, text.length - 1));\n      }, function (element) {\n        return CaretFinder.firstPositionIn(element).map(function (pos) {\n          if (!isPosCaretContainer(pos, caret)) {\n            CaretContainerRemove.remove(caret.get());\n            var text = insertInlinePos(pos, true);\n            caret.set(text);\n            return CaretPosition$1(text, 1);\n          } else {\n            return CaretPosition$1(caret.get(), 1);\n          }\n        });\n      }, function (element) {\n        return CaretFinder.lastPositionIn(element).map(function (pos) {\n          if (!isPosCaretContainer(pos, caret)) {\n            CaretContainerRemove.remove(caret.get());\n            var text = insertInlinePos(pos, false);\n            caret.set(text);\n            return CaretPosition$1(text, text.length - 1);\n          } else {\n            return CaretPosition$1(caret.get(), caret.get().length - 1);\n          }\n        });\n      }, function (element) {\n        CaretContainerRemove.remove(caret.get());\n        var text = insertInlineAfter(element);\n        caret.set(text);\n        return Option.some(CaretPosition$1(text, 1));\n      });\n    };\n    var BoundaryCaret = { renderCaret: renderCaret };\n\n    var evaluateUntil = function (fns, args) {\n      for (var i = 0; i < fns.length; i++) {\n        var result = fns[i].apply(null, args);\n        if (result.isSome()) {\n          return result;\n        }\n      }\n      return Option.none();\n    };\n    var LazyEvaluator = { evaluateUntil: evaluateUntil };\n\n    var Location = Adt.generate([\n      { before: ['element'] },\n      { start: ['element'] },\n      { end: ['element'] },\n      { after: ['element'] }\n    ]);\n    var rescope = function (rootNode, node) {\n      var parentBlock = getParentBlock(node, rootNode);\n      return parentBlock ? parentBlock : rootNode;\n    };\n    var before$3 = function (isInlineTarget, rootNode, pos) {\n      var nPos = InlineUtils.normalizeForwards(pos);\n      var scope = rescope(rootNode, nPos.container());\n      return InlineUtils.findRootInline(isInlineTarget, scope, nPos).fold(function () {\n        return CaretFinder.nextPosition(scope, nPos).bind(curry(InlineUtils.findRootInline, isInlineTarget, scope)).map(function (inline) {\n          return Location.before(inline);\n        });\n      }, Option.none);\n    };\n    var isNotInsideFormatCaretContainer = function (rootNode, elm) {\n      return getParentCaretContainer(rootNode, elm) === null;\n    };\n    var findInsideRootInline = function (isInlineTarget, rootNode, pos) {\n      return InlineUtils.findRootInline(isInlineTarget, rootNode, pos).filter(curry(isNotInsideFormatCaretContainer, rootNode));\n    };\n    var start = function (isInlineTarget, rootNode, pos) {\n      var nPos = InlineUtils.normalizeBackwards(pos);\n      return findInsideRootInline(isInlineTarget, rootNode, nPos).bind(function (inline) {\n        var prevPos = CaretFinder.prevPosition(inline, nPos);\n        return prevPos.isNone() ? Option.some(Location.start(inline)) : Option.none();\n      });\n    };\n    var end = function (isInlineTarget, rootNode, pos) {\n      var nPos = InlineUtils.normalizeForwards(pos);\n      return findInsideRootInline(isInlineTarget, rootNode, nPos).bind(function (inline) {\n        var nextPos = CaretFinder.nextPosition(inline, nPos);\n        return nextPos.isNone() ? Option.some(Location.end(inline)) : Option.none();\n      });\n    };\n    var after$2 = function (isInlineTarget, rootNode, pos) {\n      var nPos = InlineUtils.normalizeBackwards(pos);\n      var scope = rescope(rootNode, nPos.container());\n      return InlineUtils.findRootInline(isInlineTarget, scope, nPos).fold(function () {\n        return CaretFinder.prevPosition(scope, nPos).bind(curry(InlineUtils.findRootInline, isInlineTarget, scope)).map(function (inline) {\n          return Location.after(inline);\n        });\n      }, Option.none);\n    };\n    var isValidLocation = function (location) {\n      return InlineUtils.isRtl(getElement(location)) === false;\n    };\n    var readLocation = function (isInlineTarget, rootNode, pos) {\n      var location = LazyEvaluator.evaluateUntil([\n        before$3,\n        start,\n        end,\n        after$2\n      ], [\n        isInlineTarget,\n        rootNode,\n        pos\n      ]);\n      return location.filter(isValidLocation);\n    };\n    var getElement = function (location) {\n      return location.fold(identity, identity, identity, identity);\n    };\n    var getName = function (location) {\n      return location.fold(constant('before'), constant('start'), constant('end'), constant('after'));\n    };\n    var outside = function (location) {\n      return location.fold(Location.before, Location.before, Location.after, Location.after);\n    };\n    var inside = function (location) {\n      return location.fold(Location.start, Location.start, Location.end, Location.end);\n    };\n    var isEq$1 = function (location1, location2) {\n      return getName(location1) === getName(location2) && getElement(location1) === getElement(location2);\n    };\n    var betweenInlines = function (forward, isInlineTarget, rootNode, from, to, location) {\n      return lift2(InlineUtils.findRootInline(isInlineTarget, rootNode, from), InlineUtils.findRootInline(isInlineTarget, rootNode, to), function (fromInline, toInline) {\n        if (fromInline !== toInline && InlineUtils.hasSameParentBlock(rootNode, fromInline, toInline)) {\n          return Location.after(forward ? fromInline : toInline);\n        } else {\n          return location;\n        }\n      }).getOr(location);\n    };\n    var skipNoMovement = function (fromLocation, toLocation) {\n      return fromLocation.fold(constant(true), function (fromLocation) {\n        return !isEq$1(fromLocation, toLocation);\n      });\n    };\n    var findLocationTraverse = function (forward, isInlineTarget, rootNode, fromLocation, pos) {\n      var from = InlineUtils.normalizePosition(forward, pos);\n      var to = CaretFinder.fromPosition(forward, rootNode, from).map(curry(InlineUtils.normalizePosition, forward));\n      var location = to.fold(function () {\n        return fromLocation.map(outside);\n      }, function (to) {\n        return readLocation(isInlineTarget, rootNode, to).map(curry(betweenInlines, forward, isInlineTarget, rootNode, from, to)).filter(curry(skipNoMovement, fromLocation));\n      });\n      return location.filter(isValidLocation);\n    };\n    var findLocationSimple = function (forward, location) {\n      if (forward) {\n        return location.fold(compose(Option.some, Location.start), Option.none, compose(Option.some, Location.after), Option.none);\n      } else {\n        return location.fold(Option.none, compose(Option.some, Location.before), Option.none, compose(Option.some, Location.end));\n      }\n    };\n    var findLocation = function (forward, isInlineTarget, rootNode, pos) {\n      var from = InlineUtils.normalizePosition(forward, pos);\n      var fromLocation = readLocation(isInlineTarget, rootNode, from);\n      return readLocation(isInlineTarget, rootNode, from).bind(curry(findLocationSimple, forward)).orThunk(function () {\n        return findLocationTraverse(forward, isInlineTarget, rootNode, fromLocation, pos);\n      });\n    };\n    var BoundaryLocation = {\n      readLocation: readLocation,\n      findLocation: findLocation,\n      prevLocation: curry(findLocation, false),\n      nextLocation: curry(findLocation, true),\n      getElement: getElement,\n      outside: outside,\n      inside: inside\n    };\n\n    var hasSelectionModifyApi = function (editor) {\n      return isFunction(editor.selection.getSel().modify);\n    };\n    var moveRel = function (forward, selection, pos) {\n      var delta = forward ? 1 : -1;\n      selection.setRng(CaretPosition$1(pos.container(), pos.offset() + delta).toRange());\n      selection.getSel().modify('move', forward ? 'forward' : 'backward', 'word');\n      return true;\n    };\n    var moveByWord = function (forward, editor) {\n      var rng = editor.selection.getRng();\n      var pos = forward ? CaretPosition$1.fromRangeEnd(rng) : CaretPosition$1.fromRangeStart(rng);\n      if (!hasSelectionModifyApi(editor)) {\n        return false;\n      } else if (forward && isBeforeInline(pos)) {\n        return moveRel(true, editor.selection, pos);\n      } else if (!forward && isAfterInline(pos)) {\n        return moveRel(false, editor.selection, pos);\n      } else {\n        return false;\n      }\n    };\n    var WordSelection = {\n      hasSelectionModifyApi: hasSelectionModifyApi,\n      moveByWord: moveByWord\n    };\n\n    var setCaretPosition = function (editor, pos) {\n      var rng = editor.dom.createRng();\n      rng.setStart(pos.container(), pos.offset());\n      rng.setEnd(pos.container(), pos.offset());\n      editor.selection.setRng(rng);\n    };\n    var isFeatureEnabled = function (editor) {\n      return editor.settings.inline_boundaries !== false;\n    };\n    var setSelected = function (state, elm) {\n      if (state) {\n        elm.setAttribute('data-mce-selected', 'inline-boundary');\n      } else {\n        elm.removeAttribute('data-mce-selected');\n      }\n    };\n    var renderCaretLocation = function (editor, caret, location) {\n      return BoundaryCaret.renderCaret(caret, location).map(function (pos) {\n        setCaretPosition(editor, pos);\n        return location;\n      });\n    };\n    var findLocation$1 = function (editor, caret, forward) {\n      var rootNode = editor.getBody();\n      var from = CaretPosition$1.fromRangeStart(editor.selection.getRng());\n      var isInlineTarget = curry(InlineUtils.isInlineTarget, editor);\n      var location = BoundaryLocation.findLocation(forward, isInlineTarget, rootNode, from);\n      return location.bind(function (location) {\n        return renderCaretLocation(editor, caret, location);\n      });\n    };\n    var toggleInlines = function (isInlineTarget, dom, elms) {\n      var selectedInlines = filter(dom.select('*[data-mce-selected=\"inline-boundary\"]'), isInlineTarget);\n      var targetInlines = filter(elms, isInlineTarget);\n      each(difference(selectedInlines, targetInlines), curry(setSelected, false));\n      each(difference(targetInlines, selectedInlines), curry(setSelected, true));\n    };\n    var safeRemoveCaretContainer = function (editor, caret) {\n      if (editor.selection.isCollapsed() && editor.composing !== true && caret.get()) {\n        var pos = CaretPosition$1.fromRangeStart(editor.selection.getRng());\n        if (CaretPosition$1.isTextPosition(pos) && InlineUtils.isAtZwsp(pos) === false) {\n          setCaretPosition(editor, CaretContainerRemove.removeAndReposition(caret.get(), pos));\n          caret.set(null);\n        }\n      }\n    };\n    var renderInsideInlineCaret = function (isInlineTarget, editor, caret, elms) {\n      if (editor.selection.isCollapsed()) {\n        var inlines = filter(elms, isInlineTarget);\n        each(inlines, function (inline) {\n          var pos = CaretPosition$1.fromRangeStart(editor.selection.getRng());\n          BoundaryLocation.readLocation(isInlineTarget, editor.getBody(), pos).bind(function (location) {\n            return renderCaretLocation(editor, caret, location);\n          });\n        });\n      }\n    };\n    var move = function (editor, caret, forward) {\n      return function () {\n        return isFeatureEnabled(editor) ? findLocation$1(editor, caret, forward).isSome() : false;\n      };\n    };\n    var moveWord = function (forward, editor, caret) {\n      return function () {\n        return isFeatureEnabled(editor) ? WordSelection.moveByWord(forward, editor) : false;\n      };\n    };\n    var setupSelectedState = function (editor) {\n      var caret = Cell(null);\n      var isInlineTarget = curry(InlineUtils.isInlineTarget, editor);\n      editor.on('NodeChange', function (e) {\n        if (isFeatureEnabled(editor)) {\n          toggleInlines(isInlineTarget, editor.dom, e.parents);\n          safeRemoveCaretContainer(editor, caret);\n          renderInsideInlineCaret(isInlineTarget, editor, caret, e.parents);\n        }\n      });\n      return caret;\n    };\n    var moveNextWord = curry(moveWord, true);\n    var movePrevWord = curry(moveWord, false);\n    var BoundarySelection = {\n      move: move,\n      moveNextWord: moveNextWord,\n      movePrevWord: movePrevWord,\n      setupSelectedState: setupSelectedState,\n      setCaretPosition: setCaretPosition\n    };\n\n    var isFeatureEnabled$1 = function (editor) {\n      return editor.settings.inline_boundaries !== false;\n    };\n    var rangeFromPositions = function (from, to) {\n      var range = domGlobals.document.createRange();\n      range.setStart(from.container(), from.offset());\n      range.setEnd(to.container(), to.offset());\n      return range;\n    };\n    var hasOnlyTwoOrLessPositionsLeft = function (elm) {\n      return lift2(CaretFinder.firstPositionIn(elm), CaretFinder.lastPositionIn(elm), function (firstPos, lastPos) {\n        var normalizedFirstPos = InlineUtils.normalizePosition(true, firstPos);\n        var normalizedLastPos = InlineUtils.normalizePosition(false, lastPos);\n        return CaretFinder.nextPosition(elm, normalizedFirstPos).map(function (pos) {\n          return pos.isEqual(normalizedLastPos);\n        }).getOr(true);\n      }).getOr(true);\n    };\n    var setCaretLocation = function (editor, caret) {\n      return function (location) {\n        return BoundaryCaret.renderCaret(caret, location).map(function (pos) {\n          BoundarySelection.setCaretPosition(editor, pos);\n          return true;\n        }).getOr(false);\n      };\n    };\n    var deleteFromTo = function (editor, caret, from, to) {\n      var rootNode = editor.getBody();\n      var isInlineTarget = curry(InlineUtils.isInlineTarget, editor);\n      editor.undoManager.ignore(function () {\n        editor.selection.setRng(rangeFromPositions(from, to));\n        editor.execCommand('Delete');\n        BoundaryLocation.readLocation(isInlineTarget, rootNode, CaretPosition$1.fromRangeStart(editor.selection.getRng())).map(BoundaryLocation.inside).map(setCaretLocation(editor, caret));\n      });\n      editor.nodeChanged();\n    };\n    var rescope$1 = function (rootNode, node) {\n      var parentBlock = getParentBlock(node, rootNode);\n      return parentBlock ? parentBlock : rootNode;\n    };\n    var backspaceDeleteCollapsed = function (editor, caret, forward, from) {\n      var rootNode = rescope$1(editor.getBody(), from.container());\n      var isInlineTarget = curry(InlineUtils.isInlineTarget, editor);\n      var fromLocation = BoundaryLocation.readLocation(isInlineTarget, rootNode, from);\n      return fromLocation.bind(function (location) {\n        if (forward) {\n          return location.fold(constant(Option.some(BoundaryLocation.inside(location))), Option.none, constant(Option.some(BoundaryLocation.outside(location))), Option.none);\n        } else {\n          return location.fold(Option.none, constant(Option.some(BoundaryLocation.outside(location))), Option.none, constant(Option.some(BoundaryLocation.inside(location))));\n        }\n      }).map(setCaretLocation(editor, caret)).getOrThunk(function () {\n        var toPosition = CaretFinder.navigate(forward, rootNode, from);\n        var toLocation = toPosition.bind(function (pos) {\n          return BoundaryLocation.readLocation(isInlineTarget, rootNode, pos);\n        });\n        if (fromLocation.isSome() && toLocation.isSome()) {\n          return InlineUtils.findRootInline(isInlineTarget, rootNode, from).map(function (elm) {\n            if (hasOnlyTwoOrLessPositionsLeft(elm)) {\n              DeleteElement.deleteElement(editor, forward, Element.fromDom(elm));\n              return true;\n            } else {\n              return false;\n            }\n          }).getOr(false);\n        } else {\n          return toLocation.bind(function (_) {\n            return toPosition.map(function (to) {\n              if (forward) {\n                deleteFromTo(editor, caret, from, to);\n              } else {\n                deleteFromTo(editor, caret, to, from);\n              }\n              return true;\n            });\n          }).getOr(false);\n        }\n      });\n    };\n    var backspaceDelete$3 = function (editor, caret, forward) {\n      if (editor.selection.isCollapsed() && isFeatureEnabled$1(editor)) {\n        var from = CaretPosition$1.fromRangeStart(editor.selection.getRng());\n        return backspaceDeleteCollapsed(editor, caret, forward, from);\n      }\n      return false;\n    };\n    var InlineBoundaryDelete = { backspaceDelete: backspaceDelete$3 };\n\n    var tableCellRng = Immutable('start', 'end');\n    var tableSelection = Immutable('rng', 'table', 'cells');\n    var deleteAction = Adt.generate([\n      { removeTable: ['element'] },\n      { emptyCells: ['cells'] }\n    ]);\n    var isRootFromElement = function (root) {\n      return curry(eq, root);\n    };\n    var getClosestCell = function (container, isRoot) {\n      return closest$1(Element.fromDom(container), 'td,th', isRoot);\n    };\n    var getClosestTable = function (cell, isRoot) {\n      return ancestor$1(cell, 'table', isRoot);\n    };\n    var isExpandedCellRng = function (cellRng) {\n      return eq(cellRng.start(), cellRng.end()) === false;\n    };\n    var getTableFromCellRng = function (cellRng, isRoot) {\n      return getClosestTable(cellRng.start(), isRoot).bind(function (startParentTable) {\n        return getClosestTable(cellRng.end(), isRoot).bind(function (endParentTable) {\n          return eq(startParentTable, endParentTable) ? Option.some(startParentTable) : Option.none();\n        });\n      });\n    };\n    var getTableCells = function (table) {\n      return descendants$1(table, 'td,th');\n    };\n    var getCellRangeFromStartTable = function (cellRng, isRoot) {\n      return getClosestTable(cellRng.start(), isRoot).bind(function (table) {\n        return last(getTableCells(table)).map(function (endCell) {\n          return tableCellRng(cellRng.start(), endCell);\n        });\n      });\n    };\n    var partialSelection = function (isRoot, rng) {\n      var startCell = getClosestCell(rng.startContainer, isRoot);\n      var endCell = getClosestCell(rng.endContainer, isRoot);\n      return rng.collapsed ? Option.none() : lift2(startCell, endCell, tableCellRng).fold(function () {\n        return startCell.fold(function () {\n          return endCell.bind(function (endCell) {\n            return getClosestTable(endCell, isRoot).bind(function (table) {\n              return head(getTableCells(table)).map(function (startCell) {\n                return tableCellRng(startCell, endCell);\n              });\n            });\n          });\n        }, function (startCell) {\n          return getClosestTable(startCell, isRoot).bind(function (table) {\n            return last(getTableCells(table)).map(function (endCell) {\n              return tableCellRng(startCell, endCell);\n            });\n          });\n        });\n      }, function (cellRng) {\n        return isWithinSameTable(isRoot, cellRng) ? Option.none() : getCellRangeFromStartTable(cellRng, isRoot);\n      });\n    };\n    var isWithinSameTable = function (isRoot, cellRng) {\n      return getTableFromCellRng(cellRng, isRoot).isSome();\n    };\n    var getCellRng = function (rng, isRoot) {\n      var startCell = getClosestCell(rng.startContainer, isRoot);\n      var endCell = getClosestCell(rng.endContainer, isRoot);\n      return lift2(startCell, endCell, tableCellRng).filter(isExpandedCellRng).filter(function (cellRng) {\n        return isWithinSameTable(isRoot, cellRng);\n      }).orThunk(function () {\n        return partialSelection(isRoot, rng);\n      });\n    };\n    var getTableSelectionFromCellRng = function (cellRng, isRoot) {\n      return getTableFromCellRng(cellRng, isRoot).map(function (table) {\n        return tableSelection(cellRng, table, getTableCells(table));\n      });\n    };\n    var getTableSelectionFromRng = function (root, rng) {\n      var isRoot = isRootFromElement(root);\n      return getCellRng(rng, isRoot).bind(function (cellRng) {\n        return getTableSelectionFromCellRng(cellRng, isRoot);\n      });\n    };\n    var getCellIndex = function (cells, cell) {\n      return findIndex(cells, function (x) {\n        return eq(x, cell);\n      });\n    };\n    var getSelectedCells = function (tableSelection) {\n      return lift2(getCellIndex(tableSelection.cells(), tableSelection.rng().start()), getCellIndex(tableSelection.cells(), tableSelection.rng().end()), function (startIndex, endIndex) {\n        return tableSelection.cells().slice(startIndex, endIndex + 1);\n      });\n    };\n    var getAction = function (tableSelection) {\n      return getSelectedCells(tableSelection).map(function (selected) {\n        var cells = tableSelection.cells();\n        return selected.length === cells.length ? deleteAction.removeTable(tableSelection.table()) : deleteAction.emptyCells(selected);\n      });\n    };\n    var getActionFromCells = function (cells) {\n      return deleteAction.emptyCells(cells);\n    };\n    var getActionFromRange = function (root, rng) {\n      return getTableSelectionFromRng(root, rng).bind(getAction);\n    };\n    var TableDeleteAction = {\n      getActionFromRange: getActionFromRange,\n      getActionFromCells: getActionFromCells\n    };\n\n    var getRanges = function (selection) {\n      var ranges = [];\n      if (selection) {\n        for (var i = 0; i < selection.rangeCount; i++) {\n          ranges.push(selection.getRangeAt(i));\n        }\n      }\n      return ranges;\n    };\n    var getSelectedNodes = function (ranges) {\n      return bind(ranges, function (range) {\n        var node = getSelectedNode(range);\n        return node ? [Element.fromDom(node)] : [];\n      });\n    };\n    var hasMultipleRanges = function (selection) {\n      return getRanges(selection).length > 1;\n    };\n    var MultiRange = {\n      getRanges: getRanges,\n      getSelectedNodes: getSelectedNodes,\n      hasMultipleRanges: hasMultipleRanges\n    };\n\n    var getCellsFromRanges = function (ranges) {\n      return filter(MultiRange.getSelectedNodes(ranges), isTableCell);\n    };\n    var getCellsFromElement = function (elm) {\n      var selectedCells = descendants$1(elm, 'td[data-mce-selected],th[data-mce-selected]');\n      return selectedCells;\n    };\n    var getCellsFromElementOrRanges = function (ranges, element) {\n      var selectedCells = getCellsFromElement(element);\n      var rangeCells = getCellsFromRanges(ranges);\n      return selectedCells.length > 0 ? selectedCells : rangeCells;\n    };\n    var getCellsFromEditor = function (editor) {\n      return getCellsFromElementOrRanges(MultiRange.getRanges(editor.selection.getSel()), Element.fromDom(editor.getBody()));\n    };\n    var TableCellSelection = {\n      getCellsFromRanges: getCellsFromRanges,\n      getCellsFromElement: getCellsFromElement,\n      getCellsFromElementOrRanges: getCellsFromElementOrRanges,\n      getCellsFromEditor: getCellsFromEditor\n    };\n\n    var emptyCells = function (editor, cells) {\n      each(cells, PaddingBr.fillWithPaddingBr);\n      editor.selection.setCursorLocation(cells[0].dom(), 0);\n      return true;\n    };\n    var deleteTableElement = function (editor, table) {\n      DeleteElement.deleteElement(editor, false, table);\n      return true;\n    };\n    var deleteCellRange = function (editor, rootElm, rng) {\n      return TableDeleteAction.getActionFromRange(rootElm, rng).map(function (action) {\n        return action.fold(curry(deleteTableElement, editor), curry(emptyCells, editor));\n      });\n    };\n    var deleteCaptionRange = function (editor, caption) {\n      return emptyElement(editor, caption);\n    };\n    var deleteTableRange = function (editor, rootElm, rng, startElm) {\n      return getParentCaption(rootElm, startElm).fold(function () {\n        return deleteCellRange(editor, rootElm, rng);\n      }, function (caption) {\n        return deleteCaptionRange(editor, caption);\n      }).getOr(false);\n    };\n    var deleteRange$1 = function (editor, startElm) {\n      var rootNode = Element.fromDom(editor.getBody());\n      var rng = editor.selection.getRng();\n      var selectedCells = TableCellSelection.getCellsFromEditor(editor);\n      return selectedCells.length !== 0 ? emptyCells(editor, selectedCells) : deleteTableRange(editor, rootNode, rng, startElm);\n    };\n    var getParentCell = function (rootElm, elm) {\n      return find(Parents.parentsAndSelf(elm, rootElm), isTableCell);\n    };\n    var getParentCaption = function (rootElm, elm) {\n      return find(Parents.parentsAndSelf(elm, rootElm), function (elm) {\n        return name(elm) === 'caption';\n      });\n    };\n    var deleteBetweenCells = function (editor, rootElm, forward, fromCell, from) {\n      return CaretFinder.navigate(forward, editor.getBody(), from).bind(function (to) {\n        return getParentCell(rootElm, Element.fromDom(to.getNode())).map(function (toCell) {\n          return eq(toCell, fromCell) === false;\n        });\n      });\n    };\n    var emptyElement = function (editor, elm) {\n      PaddingBr.fillWithPaddingBr(elm);\n      editor.selection.setCursorLocation(elm.dom(), 0);\n      return Option.some(true);\n    };\n    var isDeleteOfLastCharPos = function (fromCaption, forward, from, to) {\n      return CaretFinder.firstPositionIn(fromCaption.dom()).bind(function (first) {\n        return CaretFinder.lastPositionIn(fromCaption.dom()).map(function (last) {\n          return forward ? from.isEqual(first) && to.isEqual(last) : from.isEqual(last) && to.isEqual(first);\n        });\n      }).getOr(true);\n    };\n    var emptyCaretCaption = function (editor, elm) {\n      return emptyElement(editor, elm);\n    };\n    var validateCaretCaption = function (rootElm, fromCaption, to) {\n      return getParentCaption(rootElm, Element.fromDom(to.getNode())).map(function (toCaption) {\n        return eq(toCaption, fromCaption) === false;\n      });\n    };\n    var deleteCaretInsideCaption = function (editor, rootElm, forward, fromCaption, from) {\n      return CaretFinder.navigate(forward, editor.getBody(), from).bind(function (to) {\n        return isDeleteOfLastCharPos(fromCaption, forward, from, to) ? emptyCaretCaption(editor, fromCaption) : validateCaretCaption(rootElm, fromCaption, to);\n      }).or(Option.some(true));\n    };\n    var deleteCaretCells = function (editor, forward, rootElm, startElm) {\n      var from = CaretPosition$1.fromRangeStart(editor.selection.getRng());\n      return getParentCell(rootElm, startElm).bind(function (fromCell) {\n        return Empty.isEmpty(fromCell) ? emptyElement(editor, fromCell) : deleteBetweenCells(editor, rootElm, forward, fromCell, from);\n      });\n    };\n    var deleteCaretCaption = function (editor, forward, rootElm, fromCaption) {\n      var from = CaretPosition$1.fromRangeStart(editor.selection.getRng());\n      return Empty.isEmpty(fromCaption) ? emptyElement(editor, fromCaption) : deleteCaretInsideCaption(editor, rootElm, forward, fromCaption, from);\n    };\n    var deleteCaret = function (editor, forward, startElm) {\n      var rootElm = Element.fromDom(editor.getBody());\n      return getParentCaption(rootElm, startElm).fold(function () {\n        return deleteCaretCells(editor, forward, rootElm, startElm);\n      }, function (fromCaption) {\n        return deleteCaretCaption(editor, forward, rootElm, fromCaption);\n      }).getOr(false);\n    };\n    var backspaceDelete$4 = function (editor, forward) {\n      var startElm = Element.fromDom(editor.selection.getStart(true));\n      var cells = TableCellSelection.getCellsFromEditor(editor);\n      return editor.selection.isCollapsed() && cells.length === 0 ? deleteCaret(editor, forward, startElm) : deleteRange$1(editor, startElm);\n    };\n    var TableDelete = { backspaceDelete: backspaceDelete$4 };\n\n    var isEq$2 = FormatUtils.isEq;\n    var matchesUnInheritedFormatSelector = function (ed, node, name) {\n      var formatList = ed.formatter.get(name);\n      if (formatList) {\n        for (var i = 0; i < formatList.length; i++) {\n          if (formatList[i].inherit === false && ed.dom.is(node, formatList[i].selector)) {\n            return true;\n          }\n        }\n      }\n      return false;\n    };\n    var matchParents = function (editor, node, name, vars) {\n      var root = editor.dom.getRoot();\n      if (node === root) {\n        return false;\n      }\n      node = editor.dom.getParent(node, function (node) {\n        if (matchesUnInheritedFormatSelector(editor, node, name)) {\n          return true;\n        }\n        return node.parentNode === root || !!matchNode(editor, node, name, vars, true);\n      });\n      return matchNode(editor, node, name, vars);\n    };\n    var matchName = function (dom, node, format) {\n      if (isEq$2(node, format.inline)) {\n        return true;\n      }\n      if (isEq$2(node, format.block)) {\n        return true;\n      }\n      if (format.selector) {\n        return node.nodeType === 1 && dom.is(node, format.selector);\n      }\n    };\n    var matchItems = function (dom, node, format, itemName, similar, vars) {\n      var key, value;\n      var items = format[itemName];\n      var i;\n      if (format.onmatch) {\n        return format.onmatch(node, format, itemName);\n      }\n      if (items) {\n        if (typeof items.length === 'undefined') {\n          for (key in items) {\n            if (items.hasOwnProperty(key)) {\n              if (itemName === 'attributes') {\n                value = dom.getAttrib(node, key);\n              } else {\n                value = FormatUtils.getStyle(dom, node, key);\n              }\n              if (similar && !value && !format.exact) {\n                return;\n              }\n              if ((!similar || format.exact) && !isEq$2(value, FormatUtils.normalizeStyleValue(dom, FormatUtils.replaceVars(items[key], vars), key))) {\n                return;\n              }\n            }\n          }\n        } else {\n          for (i = 0; i < items.length; i++) {\n            if (itemName === 'attributes' ? dom.getAttrib(node, items[i]) : FormatUtils.getStyle(dom, node, items[i])) {\n              return format;\n            }\n          }\n        }\n      }\n      return format;\n    };\n    var matchNode = function (ed, node, name, vars, similar) {\n      var formatList = ed.formatter.get(name);\n      var format, i, x, classes;\n      var dom = ed.dom;\n      if (formatList && node) {\n        for (i = 0; i < formatList.length; i++) {\n          format = formatList[i];\n          if (matchName(ed.dom, node, format) && matchItems(dom, node, format, 'attributes', similar, vars) && matchItems(dom, node, format, 'styles', similar, vars)) {\n            if (classes = format.classes) {\n              for (x = 0; x < classes.length; x++) {\n                if (!ed.dom.hasClass(node, classes[x])) {\n                  return;\n                }\n              }\n            }\n            return format;\n          }\n        }\n      }\n    };\n    var match = function (editor, name, vars, node) {\n      var startNode;\n      if (node) {\n        return matchParents(editor, node, name, vars);\n      }\n      node = editor.selection.getNode();\n      if (matchParents(editor, node, name, vars)) {\n        return true;\n      }\n      startNode = editor.selection.getStart();\n      if (startNode !== node) {\n        if (matchParents(editor, startNode, name, vars)) {\n          return true;\n        }\n      }\n      return false;\n    };\n    var matchAll = function (editor, names, vars) {\n      var startElement;\n      var matchedFormatNames = [];\n      var checkedMap = {};\n      startElement = editor.selection.getStart();\n      editor.dom.getParent(startElement, function (node) {\n        var i, name;\n        for (i = 0; i < names.length; i++) {\n          name = names[i];\n          if (!checkedMap[name] && matchNode(editor, node, name, vars)) {\n            checkedMap[name] = true;\n            matchedFormatNames.push(name);\n          }\n        }\n      }, editor.dom.getRoot());\n      return matchedFormatNames;\n    };\n    var canApply = function (editor, name) {\n      var formatList = editor.formatter.get(name);\n      var startNode, parents, i, x, selector;\n      var dom = editor.dom;\n      if (formatList) {\n        startNode = editor.selection.getStart();\n        parents = FormatUtils.getParents(dom, startNode);\n        for (x = formatList.length - 1; x >= 0; x--) {\n          selector = formatList[x].selector;\n          if (!selector || formatList[x].defaultBlock) {\n            return true;\n          }\n          for (i = parents.length - 1; i >= 0; i--) {\n            if (dom.is(parents[i], selector)) {\n              return true;\n            }\n          }\n        }\n      }\n      return false;\n    };\n    var MatchFormat = {\n      matchNode: matchNode,\n      matchName: matchName,\n      match: match,\n      matchAll: matchAll,\n      canApply: canApply,\n      matchesUnInheritedFormatSelector: matchesUnInheritedFormatSelector\n    };\n\n    var splitText = function (node, offset) {\n      return node.splitText(offset);\n    };\n    var split$1 = function (rng) {\n      var startContainer = rng.startContainer, startOffset = rng.startOffset, endContainer = rng.endContainer, endOffset = rng.endOffset;\n      if (startContainer === endContainer && NodeType.isText(startContainer)) {\n        if (startOffset > 0 && startOffset < startContainer.nodeValue.length) {\n          endContainer = splitText(startContainer, startOffset);\n          startContainer = endContainer.previousSibling;\n          if (endOffset > startOffset) {\n            endOffset = endOffset - startOffset;\n            startContainer = endContainer = splitText(endContainer, endOffset).previousSibling;\n            endOffset = endContainer.nodeValue.length;\n            startOffset = 0;\n          } else {\n            endOffset = 0;\n          }\n        }\n      } else {\n        if (NodeType.isText(startContainer) && startOffset > 0 && startOffset < startContainer.nodeValue.length) {\n          startContainer = splitText(startContainer, startOffset);\n          startOffset = 0;\n        }\n        if (NodeType.isText(endContainer) && endOffset > 0 && endOffset < endContainer.nodeValue.length) {\n          endContainer = splitText(endContainer, endOffset).previousSibling;\n          endOffset = endContainer.nodeValue.length;\n        }\n      }\n      return {\n        startContainer: startContainer,\n        startOffset: startOffset,\n        endContainer: endContainer,\n        endOffset: endOffset\n      };\n    };\n    var SplitRange = { split: split$1 };\n\n    var ZWSP$1 = Zwsp.ZWSP, CARET_ID$1 = '_mce_caret';\n    var importNode = function (ownerDocument, node) {\n      return ownerDocument.importNode(node, true);\n    };\n    var getEmptyCaretContainers = function (node) {\n      var nodes = [];\n      while (node) {\n        if (node.nodeType === 3 && node.nodeValue !== ZWSP$1 || node.childNodes.length > 1) {\n          return [];\n        }\n        if (node.nodeType === 1) {\n          nodes.push(node);\n        }\n        node = node.firstChild;\n      }\n      return nodes;\n    };\n    var isCaretContainerEmpty = function (node) {\n      return getEmptyCaretContainers(node).length > 0;\n    };\n    var findFirstTextNode = function (node) {\n      var walker;\n      if (node) {\n        walker = new TreeWalker(node, node);\n        for (node = walker.current(); node; node = walker.next()) {\n          if (node.nodeType === 3) {\n            return node;\n          }\n        }\n      }\n      return null;\n    };\n    var createCaretContainer = function (fill) {\n      var caretContainer = Element.fromTag('span');\n      setAll(caretContainer, {\n        'id': CARET_ID$1,\n        'data-mce-bogus': '1',\n        'data-mce-type': 'format-caret'\n      });\n      if (fill) {\n        append(caretContainer, Element.fromText(ZWSP$1));\n      }\n      return caretContainer;\n    };\n    var trimZwspFromCaretContainer = function (caretContainerNode) {\n      var textNode = findFirstTextNode(caretContainerNode);\n      if (textNode && textNode.nodeValue.charAt(0) === ZWSP$1) {\n        textNode.deleteData(0, 1);\n      }\n      return textNode;\n    };\n    var removeCaretContainerNode = function (editor, node, moveCaret) {\n      if (moveCaret === void 0) {\n        moveCaret = true;\n      }\n      var dom = editor.dom, selection = editor.selection;\n      if (isCaretContainerEmpty(node)) {\n        DeleteElement.deleteElement(editor, false, Element.fromDom(node), moveCaret);\n      } else {\n        var rng = selection.getRng();\n        var block = dom.getParent(node, dom.isBlock);\n        var textNode = trimZwspFromCaretContainer(node);\n        if (rng.startContainer === textNode && rng.startOffset > 0) {\n          rng.setStart(textNode, rng.startOffset - 1);\n        }\n        if (rng.endContainer === textNode && rng.endOffset > 0) {\n          rng.setEnd(textNode, rng.endOffset - 1);\n        }\n        dom.remove(node, true);\n        if (block && dom.isEmpty(block)) {\n          PaddingBr.fillWithPaddingBr(Element.fromDom(block));\n        }\n        selection.setRng(rng);\n      }\n    };\n    var removeCaretContainer = function (editor, node, moveCaret) {\n      if (moveCaret === void 0) {\n        moveCaret = true;\n      }\n      var dom = editor.dom, selection = editor.selection;\n      if (!node) {\n        node = getParentCaretContainer(editor.getBody(), selection.getStart());\n        if (!node) {\n          while (node = dom.get(CARET_ID$1)) {\n            removeCaretContainerNode(editor, node, false);\n          }\n        }\n      } else {\n        removeCaretContainerNode(editor, node, moveCaret);\n      }\n    };\n    var insertCaretContainerNode = function (editor, caretContainer, formatNode) {\n      var dom = editor.dom, block = dom.getParent(formatNode, curry(FormatUtils.isTextBlock, editor));\n      if (block && dom.isEmpty(block)) {\n        formatNode.parentNode.replaceChild(caretContainer, formatNode);\n      } else {\n        PaddingBr.removeTrailingBr(Element.fromDom(formatNode));\n        if (dom.isEmpty(formatNode)) {\n          formatNode.parentNode.replaceChild(caretContainer, formatNode);\n        } else {\n          dom.insertAfter(caretContainer, formatNode);\n        }\n      }\n    };\n    var appendNode = function (parentNode, node) {\n      parentNode.appendChild(node);\n      return node;\n    };\n    var insertFormatNodesIntoCaretContainer = function (formatNodes, caretContainer) {\n      var innerMostFormatNode = foldr(formatNodes, function (parentNode, formatNode) {\n        return appendNode(parentNode, formatNode.cloneNode(false));\n      }, caretContainer);\n      return appendNode(innerMostFormatNode, innerMostFormatNode.ownerDocument.createTextNode(ZWSP$1));\n    };\n    var applyCaretFormat = function (editor, name, vars) {\n      var rng, caretContainer, textNode, offset, bookmark, container, text;\n      var selection = editor.selection;\n      rng = selection.getRng(true);\n      offset = rng.startOffset;\n      container = rng.startContainer;\n      text = container.nodeValue;\n      caretContainer = getParentCaretContainer(editor.getBody(), selection.getStart());\n      if (caretContainer) {\n        textNode = findFirstTextNode(caretContainer);\n      }\n      var wordcharRegex = /[^\\s\\u00a0\\u00ad\\u200b\\ufeff]/;\n      if (text && offset > 0 && offset < text.length && wordcharRegex.test(text.charAt(offset)) && wordcharRegex.test(text.charAt(offset - 1))) {\n        bookmark = selection.getBookmark();\n        rng.collapse(true);\n        rng = ExpandRange.expandRng(editor, rng, editor.formatter.get(name));\n        rng = SplitRange.split(rng);\n        editor.formatter.apply(name, vars, rng);\n        selection.moveToBookmark(bookmark);\n      } else {\n        if (!caretContainer || textNode.nodeValue !== ZWSP$1) {\n          caretContainer = importNode(editor.getDoc(), createCaretContainer(true).dom());\n          textNode = caretContainer.firstChild;\n          rng.insertNode(caretContainer);\n          offset = 1;\n          editor.formatter.apply(name, vars, caretContainer);\n        } else {\n          editor.formatter.apply(name, vars, caretContainer);\n        }\n        selection.setCursorLocation(textNode, offset);\n      }\n    };\n    var removeCaretFormat = function (editor, name, vars, similar) {\n      var dom = editor.dom, selection = editor.selection;\n      var container, offset, bookmark;\n      var hasContentAfter, node, formatNode;\n      var parents = [], rng = selection.getRng();\n      var caretContainer;\n      container = rng.startContainer;\n      offset = rng.startOffset;\n      node = container;\n      if (container.nodeType === 3) {\n        if (offset !== container.nodeValue.length) {\n          hasContentAfter = true;\n        }\n        node = node.parentNode;\n      }\n      while (node) {\n        if (MatchFormat.matchNode(editor, node, name, vars, similar)) {\n          formatNode = node;\n          break;\n        }\n        if (node.nextSibling) {\n          hasContentAfter = true;\n        }\n        parents.push(node);\n        node = node.parentNode;\n      }\n      if (!formatNode) {\n        return;\n      }\n      if (hasContentAfter) {\n        bookmark = selection.getBookmark();\n        rng.collapse(true);\n        var expandedRng = ExpandRange.expandRng(editor, rng, editor.formatter.get(name), true);\n        expandedRng = SplitRange.split(expandedRng);\n        editor.formatter.remove(name, vars, expandedRng);\n        selection.moveToBookmark(bookmark);\n      } else {\n        caretContainer = getParentCaretContainer(editor.getBody(), formatNode);\n        var newCaretContainer = createCaretContainer(false).dom();\n        var caretNode = insertFormatNodesIntoCaretContainer(parents, newCaretContainer);\n        if (caretContainer) {\n          insertCaretContainerNode(editor, newCaretContainer, caretContainer);\n        } else {\n          insertCaretContainerNode(editor, newCaretContainer, formatNode);\n        }\n        removeCaretContainerNode(editor, caretContainer, false);\n        selection.setCursorLocation(caretNode, 1);\n        if (dom.isEmpty(formatNode)) {\n          dom.remove(formatNode);\n        }\n      }\n    };\n    var disableCaretContainer = function (editor, keyCode) {\n      var selection = editor.selection, body = editor.getBody();\n      removeCaretContainer(editor, null, false);\n      if ((keyCode === 8 || keyCode === 46) && selection.isCollapsed() && selection.getStart().innerHTML === ZWSP$1) {\n        removeCaretContainer(editor, getParentCaretContainer(body, selection.getStart()));\n      }\n      if (keyCode === 37 || keyCode === 39) {\n        removeCaretContainer(editor, getParentCaretContainer(body, selection.getStart()));\n      }\n    };\n    var setup$2 = function (editor) {\n      editor.on('mouseup keydown', function (e) {\n        disableCaretContainer(editor, e.keyCode);\n      });\n    };\n    var replaceWithCaretFormat = function (targetNode, formatNodes) {\n      var caretContainer = createCaretContainer(false);\n      var innerMost = insertFormatNodesIntoCaretContainer(formatNodes, caretContainer.dom());\n      before(Element.fromDom(targetNode), caretContainer);\n      remove$1(Element.fromDom(targetNode));\n      return CaretPosition$1(innerMost, 0);\n    };\n    var isFormatElement = function (editor, element) {\n      var inlineElements = editor.schema.getTextInlineElements();\n      return inlineElements.hasOwnProperty(name(element)) && !isCaretNode(element.dom()) && !NodeType.isBogus(element.dom());\n    };\n    var isEmptyCaretFormatElement = function (element) {\n      return isCaretNode(element.dom()) && isCaretContainerEmpty(element.dom());\n    };\n\n    var getParentInlines = function (rootElm, startElm) {\n      var parents = Parents.parentsAndSelf(startElm, rootElm);\n      return findIndex(parents, isBlock).fold(constant(parents), function (index) {\n        return parents.slice(0, index);\n      });\n    };\n    var hasOnlyOneChild$1 = function (elm) {\n      return children(elm).length === 1;\n    };\n    var deleteLastPosition = function (forward, editor, target, parentInlines) {\n      var isFormatElement$1 = curry(isFormatElement, editor);\n      var formatNodes = map(filter(parentInlines, isFormatElement$1), function (elm) {\n        return elm.dom();\n      });\n      if (formatNodes.length === 0) {\n        DeleteElement.deleteElement(editor, forward, target);\n      } else {\n        var pos = replaceWithCaretFormat(target.dom(), formatNodes);\n        editor.selection.setRng(pos.toRange());\n      }\n    };\n    var deleteCaret$1 = function (editor, forward) {\n      var rootElm = Element.fromDom(editor.getBody());\n      var startElm = Element.fromDom(editor.selection.getStart());\n      var parentInlines = filter(getParentInlines(rootElm, startElm), hasOnlyOneChild$1);\n      return last(parentInlines).map(function (target) {\n        var fromPos = CaretPosition$1.fromRangeStart(editor.selection.getRng());\n        if (DeleteUtils.willDeleteLastPositionInElement(forward, fromPos, target.dom()) && !isEmptyCaretFormatElement(target)) {\n          deleteLastPosition(forward, editor, target, parentInlines);\n          return true;\n        } else {\n          return false;\n        }\n      }).getOr(false);\n    };\n    var backspaceDelete$5 = function (editor, forward) {\n      return editor.selection.isCollapsed() ? deleteCaret$1(editor, forward) : false;\n    };\n    var InlineFormatDelete = { backspaceDelete: backspaceDelete$5 };\n\n    var getPos$1 = function (elm) {\n      var x = 0, y = 0;\n      var offsetParent = elm;\n      while (offsetParent && offsetParent.nodeType) {\n        x += offsetParent.offsetLeft || 0;\n        y += offsetParent.offsetTop || 0;\n        offsetParent = offsetParent.offsetParent;\n      }\n      return {\n        x: x,\n        y: y\n      };\n    };\n    var fireScrollIntoViewEvent = function (editor, elm, alignToTop) {\n      var scrollEvent = {\n        elm: elm,\n        alignToTop: alignToTop\n      };\n      editor.fire('scrollIntoView', scrollEvent);\n      return scrollEvent.isDefaultPrevented();\n    };\n    var scrollElementIntoView = function (editor, elm, alignToTop) {\n      var y, viewPort;\n      var dom = editor.dom;\n      var root = dom.getRoot();\n      var viewPortY, viewPortH, offsetY = 0;\n      if (fireScrollIntoViewEvent(editor, elm, alignToTop)) {\n        return;\n      }\n      if (!NodeType.isElement(elm)) {\n        return;\n      }\n      if (alignToTop === false) {\n        offsetY = elm.offsetHeight;\n      }\n      if (root.nodeName !== 'BODY') {\n        var scrollContainer = editor.selection.getScrollContainer();\n        if (scrollContainer) {\n          y = getPos$1(elm).y - getPos$1(scrollContainer).y + offsetY;\n          viewPortH = scrollContainer.clientHeight;\n          viewPortY = scrollContainer.scrollTop;\n          if (y < viewPortY || y + 25 > viewPortY + viewPortH) {\n            scrollContainer.scrollTop = y < viewPortY ? y : y - viewPortH + 25;\n          }\n          return;\n        }\n      }\n      viewPort = dom.getViewPort(editor.getWin());\n      y = dom.getPos(elm).y + offsetY;\n      viewPortY = viewPort.y;\n      viewPortH = viewPort.h;\n      if (y < viewPort.y || y + 25 > viewPortY + viewPortH) {\n        editor.getWin().scrollTo(0, y < viewPortY ? y : y - viewPortH + 25);\n      }\n    };\n    var getViewPortRect = function (editor) {\n      if (editor.inline) {\n        return editor.getBody().getBoundingClientRect();\n      } else {\n        var win = editor.getWin();\n        return {\n          left: 0,\n          right: win.innerWidth,\n          top: 0,\n          bottom: win.innerHeight,\n          width: win.innerWidth,\n          height: win.innerHeight\n        };\n      }\n    };\n    var scrollBy = function (editor, dx, dy) {\n      if (editor.inline) {\n        editor.getBody().scrollLeft += dx;\n        editor.getBody().scrollTop += dy;\n      } else {\n        editor.getWin().scrollBy(dx, dy);\n      }\n    };\n    var scrollRangeIntoView = function (editor, rng) {\n      head(CaretPosition.fromRangeStart(rng).getClientRects()).each(function (rngRect) {\n        var bodyRect = getViewPortRect(editor);\n        var overflow = getOverflow(bodyRect, rngRect);\n        var margin = 4;\n        var dx = overflow.x > 0 ? overflow.x + margin : overflow.x - margin;\n        var dy = overflow.y > 0 ? overflow.y + margin : overflow.y - margin;\n        scrollBy(editor, overflow.x !== 0 ? dx : 0, overflow.y !== 0 ? dy : 0);\n      });\n    };\n    var ScrollIntoView = {\n      scrollElementIntoView: scrollElementIntoView,\n      scrollRangeIntoView: scrollRangeIntoView\n    };\n\n    var isContentEditableTrue$2 = NodeType.isContentEditableTrue;\n    var isContentEditableFalse$6 = NodeType.isContentEditableFalse;\n    var showCaret = function (direction, editor, node, before, scrollIntoView) {\n      return editor._selectionOverrides.showCaret(direction, node, before, scrollIntoView);\n    };\n    var getNodeRange = function (node) {\n      var rng = node.ownerDocument.createRange();\n      rng.selectNode(node);\n      return rng;\n    };\n    var selectNode = function (editor, node) {\n      var e = editor.fire('BeforeObjectSelected', { target: node });\n      if (e.isDefaultPrevented()) {\n        return null;\n      }\n      return getNodeRange(node);\n    };\n    var renderCaretAtRange = function (editor, range, scrollIntoView) {\n      var normalizedRange = normalizeRange(1, editor.getBody(), range);\n      var caretPosition = CaretPosition$1.fromRangeStart(normalizedRange);\n      var caretPositionNode = caretPosition.getNode();\n      if (isContentEditableFalse$6(caretPositionNode)) {\n        return showCaret(1, editor, caretPositionNode, !caretPosition.isAtEnd(), false);\n      }\n      var caretPositionBeforeNode = caretPosition.getNode(true);\n      if (isContentEditableFalse$6(caretPositionBeforeNode)) {\n        return showCaret(1, editor, caretPositionBeforeNode, false, false);\n      }\n      var ceRoot = editor.dom.getParent(caretPosition.getNode(), function (node) {\n        return isContentEditableFalse$6(node) || isContentEditableTrue$2(node);\n      });\n      if (isContentEditableFalse$6(ceRoot)) {\n        return showCaret(1, editor, ceRoot, false, scrollIntoView);\n      }\n      return null;\n    };\n    var renderRangeCaret = function (editor, range, scrollIntoView) {\n      if (!range || !range.collapsed) {\n        return range;\n      }\n      var caretRange = renderCaretAtRange(editor, range, scrollIntoView);\n      if (caretRange) {\n        return caretRange;\n      }\n      return range;\n    };\n    var moveToRange = function (editor, rng) {\n      editor.selection.setRng(rng);\n      ScrollIntoView.scrollRangeIntoView(editor, editor.selection.getRng());\n    };\n\n    var trimEmptyTextNode$1 = function (dom, node) {\n      if (NodeType.isText(node) && node.data.length === 0) {\n        dom.remove(node);\n      }\n    };\n    var deleteContentAndShowCaret = function (editor, range, node, direction, forward, peekCaretPosition) {\n      var caretRange = showCaret(direction, editor, peekCaretPosition.getNode(!forward), forward, true);\n      if (range.collapsed) {\n        var deleteRange = range.cloneRange();\n        if (forward) {\n          deleteRange.setEnd(caretRange.startContainer, caretRange.startOffset);\n        } else {\n          deleteRange.setStart(caretRange.endContainer, caretRange.endOffset);\n        }\n        deleteRange.deleteContents();\n      } else {\n        range.deleteContents();\n      }\n      editor.selection.setRng(caretRange);\n      trimEmptyTextNode$1(editor.dom, node);\n      return true;\n    };\n    var deleteCefBoundaryText = function (editor, forward) {\n      var range = editor.selection.getRng();\n      if (!NodeType.isText(range.commonAncestorContainer)) {\n        return false;\n      }\n      var direction = forward ? HDirection.Forwards : HDirection.Backwards;\n      var caretWalker = CaretWalker(editor.getBody());\n      var getNextVisualCaretPosition = curry(getVisualCaretPosition, caretWalker.next);\n      var getPrevVisualCaretPosition = curry(getVisualCaretPosition, caretWalker.prev);\n      var getNextPosFn = forward ? getNextVisualCaretPosition : getPrevVisualCaretPosition;\n      var isBeforeContentEditableFalseFn = forward ? isBeforeContentEditableFalse : isAfterContentEditableFalse;\n      var caretPosition = getNormalizedRangeEndPoint(direction, editor.getBody(), range);\n      var nextCaretPosition = InlineUtils.normalizePosition(forward, getNextPosFn(caretPosition));\n      if (!nextCaretPosition) {\n        return false;\n      } else if (isBeforeContentEditableFalseFn(nextCaretPosition)) {\n        return deleteContentAndShowCaret(editor, range, caretPosition.getNode(), direction, forward, nextCaretPosition);\n      }\n      var peekCaretPosition = getNextPosFn(nextCaretPosition);\n      if (peekCaretPosition && isBeforeContentEditableFalseFn(peekCaretPosition)) {\n        if (isMoveInsideSameBlock(nextCaretPosition, peekCaretPosition)) {\n          return deleteContentAndShowCaret(editor, range, caretPosition.getNode(), direction, forward, peekCaretPosition);\n        }\n      }\n      return false;\n    };\n    var backspaceDelete$6 = function (editor, forward) {\n      return deleteCefBoundaryText(editor, forward);\n    };\n    var CefBoundaryDelete = { backspaceDelete: backspaceDelete$6 };\n\n    var nativeCommand = function (editor, command) {\n      editor.getDoc().execCommand(command, false, null);\n    };\n    var deleteCommand = function (editor) {\n      if (CefDelete.backspaceDelete(editor, false)) {\n        return;\n      } else if (CefBoundaryDelete.backspaceDelete(editor, false)) {\n        return;\n      } else if (InlineBoundaryDelete.backspaceDelete(editor, false)) {\n        return;\n      } else if (BlockBoundaryDelete.backspaceDelete(editor, false)) {\n        return;\n      } else if (TableDelete.backspaceDelete(editor)) {\n        return;\n      } else if (BlockRangeDelete.backspaceDelete(editor, false)) {\n        return;\n      } else if (InlineFormatDelete.backspaceDelete(editor, false)) {\n        return;\n      } else {\n        nativeCommand(editor, 'Delete');\n        DeleteUtils.paddEmptyBody(editor);\n      }\n    };\n    var forwardDeleteCommand = function (editor) {\n      if (CefDelete.backspaceDelete(editor, true)) {\n        return;\n      } else if (CefBoundaryDelete.backspaceDelete(editor, true)) {\n        return;\n      } else if (InlineBoundaryDelete.backspaceDelete(editor, true)) {\n        return;\n      } else if (BlockBoundaryDelete.backspaceDelete(editor, true)) {\n        return;\n      } else if (TableDelete.backspaceDelete(editor)) {\n        return;\n      } else if (BlockRangeDelete.backspaceDelete(editor, true)) {\n        return;\n      } else if (InlineFormatDelete.backspaceDelete(editor, true)) {\n        return;\n      } else {\n        nativeCommand(editor, 'ForwardDelete');\n      }\n    };\n    var DeleteCommands = {\n      deleteCommand: deleteCommand,\n      forwardDeleteCommand: forwardDeleteCommand\n    };\n\n    var getSpecifiedFontProp = function (propName, rootElm, elm) {\n      var getProperty = function (elm) {\n        return getRaw(elm, propName);\n      };\n      var isRoot = function (elm) {\n        return eq(Element.fromDom(rootElm), elm);\n      };\n      return closest(Element.fromDom(elm), function (elm) {\n        return getProperty(elm).isSome();\n      }, isRoot).bind(getProperty);\n    };\n    var round$1 = function (number, precision) {\n      var factor = Math.pow(10, precision);\n      return Math.round(number * factor) / factor;\n    };\n    var toPt = function (fontSize, precision) {\n      if (/[0-9.]+px$/.test(fontSize)) {\n        return round$1(parseInt(fontSize, 10) * 72 / 96, precision || 0) + 'pt';\n      }\n      return fontSize;\n    };\n    var normalizeFontFamily = function (fontFamily) {\n      return fontFamily.replace(/[\\'\\\"\\\\]/g, '').replace(/,\\s+/g, ',');\n    };\n    var getComputedFontProp = function (propName, elm) {\n      return Option.from(DOMUtils$1.DOM.getStyle(elm, propName, true));\n    };\n    var getFontProp = function (propName) {\n      return function (rootElm, elm) {\n        return Option.from(elm).map(Element.fromDom).filter(isElement).bind(function (element) {\n          return getSpecifiedFontProp(propName, rootElm, element.dom()).or(getComputedFontProp(propName, element.dom()));\n        }).getOr('');\n      };\n    };\n    var FontInfo = {\n      getFontSize: getFontProp('font-size'),\n      getFontFamily: compose(normalizeFontFamily, getFontProp('font-family')),\n      toPt: toPt\n    };\n\n    var findFirstCaretElement = function (editor) {\n      return CaretFinder.firstPositionIn(editor.getBody()).map(function (caret) {\n        var container = caret.container();\n        return NodeType.isText(container) ? container.parentNode : container;\n      });\n    };\n    var isRangeAtStartOfNode = function (rng, root) {\n      return rng.startContainer === root && rng.startOffset === 0;\n    };\n    var getCaretElement = function (editor) {\n      return Option.from(editor.selection.getRng()).bind(function (rng) {\n        var root = editor.getBody();\n        return isRangeAtStartOfNode(rng, root) ? Option.none() : Option.from(editor.selection.getStart(true));\n      });\n    };\n    var fromFontSizeNumber = function (editor, value) {\n      if (/^[0-9\\.]+$/.test(value)) {\n        var fontSizeNumber = parseInt(value, 10);\n        if (fontSizeNumber >= 1 && fontSizeNumber <= 7) {\n          var fontSizes = Settings.getFontStyleValues(editor);\n          var fontClasses = Settings.getFontSizeClasses(editor);\n          if (fontClasses) {\n            return fontClasses[fontSizeNumber - 1] || value;\n          } else {\n            return fontSizes[fontSizeNumber - 1] || value;\n          }\n        } else {\n          return value;\n        }\n      } else {\n        return value;\n      }\n    };\n    var fontNameAction = function (editor, value) {\n      editor.formatter.toggle('fontname', { value: fromFontSizeNumber(editor, value) });\n      editor.nodeChanged();\n    };\n    var fontNameQuery = function (editor) {\n      return getCaretElement(editor).fold(function () {\n        return findFirstCaretElement(editor).map(function (caretElement) {\n          return FontInfo.getFontFamily(editor.getBody(), caretElement);\n        }).getOr('');\n      }, function (caretElement) {\n        return FontInfo.getFontFamily(editor.getBody(), caretElement);\n      });\n    };\n    var fontSizeAction = function (editor, value) {\n      editor.formatter.toggle('fontsize', { value: fromFontSizeNumber(editor, value) });\n      editor.nodeChanged();\n    };\n    var fontSizeQuery = function (editor) {\n      return getCaretElement(editor).fold(function () {\n        return findFirstCaretElement(editor).map(function (caretElement) {\n          return FontInfo.getFontSize(editor.getBody(), caretElement);\n        }).getOr('');\n      }, function (caretElement) {\n        return FontInfo.getFontSize(editor.getBody(), caretElement);\n      });\n    };\n\n    var isEq$3 = function (rng1, rng2) {\n      return rng1 && rng2 && (rng1.startContainer === rng2.startContainer && rng1.startOffset === rng2.startOffset) && (rng1.endContainer === rng2.endContainer && rng1.endOffset === rng2.endOffset);\n    };\n    var RangeCompare = { isEq: isEq$3 };\n\n    var findParent = function (node, rootNode, predicate) {\n      while (node && node !== rootNode) {\n        if (predicate(node)) {\n          return node;\n        }\n        node = node.parentNode;\n      }\n      return null;\n    };\n    var hasParent = function (node, rootNode, predicate) {\n      return findParent(node, rootNode, predicate) !== null;\n    };\n    var hasParentWithName = function (node, rootNode, name) {\n      return hasParent(node, rootNode, function (node) {\n        return node.nodeName === name;\n      });\n    };\n    var isTable$2 = function (node) {\n      return node && node.nodeName === 'TABLE';\n    };\n    var isTableCell$3 = function (node) {\n      return node && /^(TD|TH|CAPTION)$/.test(node.nodeName);\n    };\n    var isCeFalseCaretContainer = function (node, rootNode) {\n      return isCaretContainer(node) && hasParent(node, rootNode, isCaretNode) === false;\n    };\n    var hasBrBeforeAfter = function (dom, node, left) {\n      var walker = new TreeWalker(node, dom.getParent(node.parentNode, dom.isBlock) || dom.getRoot());\n      while (node = walker[left ? 'prev' : 'next']()) {\n        if (NodeType.isBr(node)) {\n          return true;\n        }\n      }\n    };\n    var isPrevNode = function (node, name) {\n      return node.previousSibling && node.previousSibling.nodeName === name;\n    };\n    var hasContentEditableFalseParent = function (body, node) {\n      while (node && node !== body) {\n        if (NodeType.isContentEditableFalse(node)) {\n          return true;\n        }\n        node = node.parentNode;\n      }\n      return false;\n    };\n    var findTextNodeRelative = function (dom, isAfterNode, collapsed, left, startNode) {\n      var walker, lastInlineElement, parentBlockContainer;\n      var body = dom.getRoot();\n      var node;\n      var nonEmptyElementsMap = dom.schema.getNonEmptyElements();\n      parentBlockContainer = dom.getParent(startNode.parentNode, dom.isBlock) || body;\n      if (left && NodeType.isBr(startNode) && isAfterNode && dom.isEmpty(parentBlockContainer)) {\n        return Option.some(CaretPosition(startNode.parentNode, dom.nodeIndex(startNode)));\n      }\n      walker = new TreeWalker(startNode, parentBlockContainer);\n      while (node = walker[left ? 'prev' : 'next']()) {\n        if (dom.getContentEditableParent(node) === 'false' || isCeFalseCaretContainer(node, body)) {\n          return Option.none();\n        }\n        if (NodeType.isText(node) && node.nodeValue.length > 0) {\n          if (hasParentWithName(node, body, 'A') === false) {\n            return Option.some(CaretPosition(node, left ? node.nodeValue.length : 0));\n          }\n          return Option.none();\n        }\n        if (dom.isBlock(node) || nonEmptyElementsMap[node.nodeName.toLowerCase()]) {\n          return Option.none();\n        }\n        lastInlineElement = node;\n      }\n      if (collapsed && lastInlineElement) {\n        return Option.some(CaretPosition(lastInlineElement, 0));\n      }\n      return Option.none();\n    };\n    var normalizeEndPoint = function (dom, collapsed, start, rng) {\n      var container, offset, walker;\n      var body = dom.getRoot();\n      var node, nonEmptyElementsMap;\n      var directionLeft, isAfterNode, normalized = false;\n      container = rng[(start ? 'start' : 'end') + 'Container'];\n      offset = rng[(start ? 'start' : 'end') + 'Offset'];\n      isAfterNode = NodeType.isElement(container) && offset === container.childNodes.length;\n      nonEmptyElementsMap = dom.schema.getNonEmptyElements();\n      directionLeft = start;\n      if (isCaretContainer(container)) {\n        return Option.none();\n      }\n      if (NodeType.isElement(container) && offset > container.childNodes.length - 1) {\n        directionLeft = false;\n      }\n      if (NodeType.isDocument(container)) {\n        container = body;\n        offset = 0;\n      }\n      if (container === body) {\n        if (directionLeft) {\n          node = container.childNodes[offset > 0 ? offset - 1 : 0];\n          if (node) {\n            if (isCaretContainer(node)) {\n              return Option.none();\n            }\n            if (nonEmptyElementsMap[node.nodeName] || isTable$2(node)) {\n              return Option.none();\n            }\n          }\n        }\n        if (container.hasChildNodes()) {\n          offset = Math.min(!directionLeft && offset > 0 ? offset - 1 : offset, container.childNodes.length - 1);\n          container = container.childNodes[offset];\n          offset = NodeType.isText(container) && isAfterNode ? container.data.length : 0;\n          if (!collapsed && container === body.lastChild && isTable$2(container)) {\n            return Option.none();\n          }\n          if (hasContentEditableFalseParent(body, container) || isCaretContainer(container)) {\n            return Option.none();\n          }\n          if (container.hasChildNodes() && isTable$2(container) === false) {\n            node = container;\n            walker = new TreeWalker(container, body);\n            do {\n              if (NodeType.isContentEditableFalse(node) || isCaretContainer(node)) {\n                normalized = false;\n                break;\n              }\n              if (NodeType.isText(node) && node.nodeValue.length > 0) {\n                offset = directionLeft ? 0 : node.nodeValue.length;\n                container = node;\n                normalized = true;\n                break;\n              }\n              if (nonEmptyElementsMap[node.nodeName.toLowerCase()] && !isTableCell$3(node)) {\n                offset = dom.nodeIndex(node);\n                container = node.parentNode;\n                if (!directionLeft) {\n                  offset++;\n                }\n                normalized = true;\n                break;\n              }\n            } while (node = directionLeft ? walker.next() : walker.prev());\n          }\n        }\n      }\n      if (collapsed) {\n        if (NodeType.isText(container) && offset === 0) {\n          findTextNodeRelative(dom, isAfterNode, collapsed, true, container).each(function (pos) {\n            container = pos.container();\n            offset = pos.offset();\n            normalized = true;\n          });\n        }\n        if (NodeType.isElement(container)) {\n          node = container.childNodes[offset];\n          if (!node) {\n            node = container.childNodes[offset - 1];\n          }\n          if (node && NodeType.isBr(node) && !isPrevNode(node, 'A') && !hasBrBeforeAfter(dom, node, false) && !hasBrBeforeAfter(dom, node, true)) {\n            findTextNodeRelative(dom, isAfterNode, collapsed, true, node).each(function (pos) {\n              container = pos.container();\n              offset = pos.offset();\n              normalized = true;\n            });\n          }\n        }\n      }\n      if (directionLeft && !collapsed && NodeType.isText(container) && offset === container.nodeValue.length) {\n        findTextNodeRelative(dom, isAfterNode, collapsed, false, container).each(function (pos) {\n          container = pos.container();\n          offset = pos.offset();\n          normalized = true;\n        });\n      }\n      return normalized ? Option.some(CaretPosition(container, offset)) : Option.none();\n    };\n    var normalize$2 = function (dom, rng) {\n      var collapsed = rng.collapsed, normRng = rng.cloneRange();\n      var startPos = CaretPosition.fromRangeStart(rng);\n      normalizeEndPoint(dom, collapsed, true, normRng).each(function (pos) {\n        if (!collapsed || !CaretPosition.isAbove(startPos, pos)) {\n          normRng.setStart(pos.container(), pos.offset());\n        }\n      });\n      if (!collapsed) {\n        normalizeEndPoint(dom, collapsed, false, normRng).each(function (pos) {\n          normRng.setEnd(pos.container(), pos.offset());\n        });\n      }\n      if (collapsed) {\n        normRng.collapse(true);\n      }\n      return RangeCompare.isEq(rng, normRng) ? Option.none() : Option.some(normRng);\n    };\n    var NormalizeRange = { normalize: normalize$2 };\n\n    var hasRightSideContent = function (schema, container, parentBlock) {\n      var walker = new TreeWalker(container, parentBlock);\n      var node;\n      var nonEmptyElementsMap = schema.getNonEmptyElements();\n      while (node = walker.next()) {\n        if (nonEmptyElementsMap[node.nodeName.toLowerCase()] || node.length > 0) {\n          return true;\n        }\n      }\n    };\n    var scrollToBr = function (dom, selection, brElm) {\n      var marker = dom.create('span', {}, '&nbsp;');\n      brElm.parentNode.insertBefore(marker, brElm);\n      selection.scrollIntoView(marker);\n      dom.remove(marker);\n    };\n    var moveSelectionToBr = function (dom, selection, brElm, extraBr) {\n      var rng = dom.createRng();\n      if (!extraBr) {\n        rng.setStartAfter(brElm);\n        rng.setEndAfter(brElm);\n      } else {\n        rng.setStartBefore(brElm);\n        rng.setEndBefore(brElm);\n      }\n      selection.setRng(rng);\n    };\n    var insertBrAtCaret = function (editor, evt) {\n      var selection = editor.selection;\n      var dom = editor.dom;\n      var rng = selection.getRng();\n      var brElm;\n      var extraBr;\n      NormalizeRange.normalize(dom, rng).each(function (normRng) {\n        rng.setStart(normRng.startContainer, normRng.startOffset);\n        rng.setEnd(normRng.endContainer, normRng.endOffset);\n      });\n      var offset = rng.startOffset;\n      var container = rng.startContainer;\n      if (container.nodeType === 1 && container.hasChildNodes()) {\n        var isAfterLastNodeInContainer = offset > container.childNodes.length - 1;\n        container = container.childNodes[Math.min(offset, container.childNodes.length - 1)] || container;\n        if (isAfterLastNodeInContainer && container.nodeType === 3) {\n          offset = container.nodeValue.length;\n        } else {\n          offset = 0;\n        }\n      }\n      var parentBlock = dom.getParent(container, dom.isBlock);\n      var containerBlock = parentBlock ? dom.getParent(parentBlock.parentNode, dom.isBlock) : null;\n      var containerBlockName = containerBlock ? containerBlock.nodeName.toUpperCase() : '';\n      var isControlKey = evt && evt.ctrlKey;\n      if (containerBlockName === 'LI' && !isControlKey) {\n        parentBlock = containerBlock;\n      }\n      if (container && container.nodeType === 3 && offset >= container.nodeValue.length) {\n        if (!hasRightSideContent(editor.schema, container, parentBlock)) {\n          brElm = dom.create('br');\n          rng.insertNode(brElm);\n          rng.setStartAfter(brElm);\n          rng.setEndAfter(brElm);\n          extraBr = true;\n        }\n      }\n      brElm = dom.create('br');\n      rangeInsertNode(dom, rng, brElm);\n      scrollToBr(dom, selection, brElm);\n      moveSelectionToBr(dom, selection, brElm, extraBr);\n      editor.undoManager.add();\n    };\n    var insertBrBefore = function (editor, inline) {\n      var br = Element.fromTag('br');\n      before(Element.fromDom(inline), br);\n      editor.undoManager.add();\n    };\n    var insertBrAfter = function (editor, inline) {\n      if (!hasBrAfter(editor.getBody(), inline)) {\n        after(Element.fromDom(inline), Element.fromTag('br'));\n      }\n      var br = Element.fromTag('br');\n      after(Element.fromDom(inline), br);\n      scrollToBr(editor.dom, editor.selection, br.dom());\n      moveSelectionToBr(editor.dom, editor.selection, br.dom(), false);\n      editor.undoManager.add();\n    };\n    var isBeforeBr$1 = function (pos) {\n      return NodeType.isBr(pos.getNode());\n    };\n    var hasBrAfter = function (rootNode, startNode) {\n      if (isBeforeBr$1(CaretPosition$1.after(startNode))) {\n        return true;\n      } else {\n        return CaretFinder.nextPosition(rootNode, CaretPosition$1.after(startNode)).map(function (pos) {\n          return NodeType.isBr(pos.getNode());\n        }).getOr(false);\n      }\n    };\n    var isAnchorLink = function (elm) {\n      return elm && elm.nodeName === 'A' && 'href' in elm;\n    };\n    var isInsideAnchor = function (location) {\n      return location.fold(constant(false), isAnchorLink, isAnchorLink, constant(false));\n    };\n    var readInlineAnchorLocation = function (editor) {\n      var isInlineTarget = curry(InlineUtils.isInlineTarget, editor);\n      var position = CaretPosition$1.fromRangeStart(editor.selection.getRng());\n      return BoundaryLocation.readLocation(isInlineTarget, editor.getBody(), position).filter(isInsideAnchor);\n    };\n    var insertBrOutsideAnchor = function (editor, location) {\n      location.fold(noop, curry(insertBrBefore, editor), curry(insertBrAfter, editor), noop);\n    };\n    var insert = function (editor, evt) {\n      var anchorLocation = readInlineAnchorLocation(editor);\n      if (anchorLocation.isSome()) {\n        anchorLocation.each(curry(insertBrOutsideAnchor, editor));\n      } else {\n        insertBrAtCaret(editor, evt);\n      }\n    };\n    var InsertBr = { insert: insert };\n\n    var create$3 = Immutable('start', 'soffset', 'finish', 'foffset');\n    var SimRange = { create: create$3 };\n\n    var adt = Adt.generate([\n      { before: ['element'] },\n      {\n        on: [\n          'element',\n          'offset'\n        ]\n      },\n      { after: ['element'] }\n    ]);\n    var cata = function (subject, onBefore, onOn, onAfter) {\n      return subject.fold(onBefore, onOn, onAfter);\n    };\n    var getStart = function (situ) {\n      return situ.fold(identity, identity, identity);\n    };\n    var before$4 = adt.before;\n    var on = adt.on;\n    var after$3 = adt.after;\n    var Situ = {\n      before: before$4,\n      on: on,\n      after: after$3,\n      cata: cata,\n      getStart: getStart\n    };\n\n    var adt$1 = Adt.generate([\n      { domRange: ['rng'] },\n      {\n        relative: [\n          'startSitu',\n          'finishSitu'\n        ]\n      },\n      {\n        exact: [\n          'start',\n          'soffset',\n          'finish',\n          'foffset'\n        ]\n      }\n    ]);\n    var exactFromRange = function (simRange) {\n      return adt$1.exact(simRange.start(), simRange.soffset(), simRange.finish(), simRange.foffset());\n    };\n    var getStart$1 = function (selection) {\n      return selection.match({\n        domRange: function (rng) {\n          return Element.fromDom(rng.startContainer);\n        },\n        relative: function (startSitu, finishSitu) {\n          return Situ.getStart(startSitu);\n        },\n        exact: function (start, soffset, finish, foffset) {\n          return start;\n        }\n      });\n    };\n    var domRange = adt$1.domRange;\n    var relative = adt$1.relative;\n    var exact = adt$1.exact;\n    var getWin = function (selection) {\n      var start = getStart$1(selection);\n      return defaultView(start);\n    };\n    var range = SimRange.create;\n    var Selection = {\n      domRange: domRange,\n      relative: relative,\n      exact: exact,\n      exactFromRange: exactFromRange,\n      getWin: getWin,\n      range: range\n    };\n\n    var browser$3 = PlatformDetection$1.detect().browser;\n    var clamp = function (offset, element) {\n      var max = isText(element) ? get$4(element).length : children(element).length + 1;\n      if (offset > max) {\n        return max;\n      } else if (offset < 0) {\n        return 0;\n      }\n      return offset;\n    };\n    var normalizeRng = function (rng) {\n      return Selection.range(rng.start(), clamp(rng.soffset(), rng.start()), rng.finish(), clamp(rng.foffset(), rng.finish()));\n    };\n    var isOrContains = function (root, elm) {\n      return !NodeType.isRestrictedNode(elm.dom()) && (contains$3(root, elm) || eq(root, elm));\n    };\n    var isRngInRoot = function (root) {\n      return function (rng) {\n        return isOrContains(root, rng.start()) && isOrContains(root, rng.finish());\n      };\n    };\n    var shouldStore = function (editor) {\n      return editor.inline === true || browser$3.isIE();\n    };\n    var nativeRangeToSelectionRange = function (r) {\n      return Selection.range(Element.fromDom(r.startContainer), r.startOffset, Element.fromDom(r.endContainer), r.endOffset);\n    };\n    var readRange = function (win) {\n      var selection = win.getSelection();\n      var rng = !selection || selection.rangeCount === 0 ? Option.none() : Option.from(selection.getRangeAt(0));\n      return rng.map(nativeRangeToSelectionRange);\n    };\n    var getBookmark$2 = function (root) {\n      var win = defaultView(root);\n      return readRange(win.dom()).filter(isRngInRoot(root));\n    };\n    var validate = function (root, bookmark) {\n      return Option.from(bookmark).filter(isRngInRoot(root)).map(normalizeRng);\n    };\n    var bookmarkToNativeRng = function (bookmark) {\n      var rng = domGlobals.document.createRange();\n      try {\n        rng.setStart(bookmark.start().dom(), bookmark.soffset());\n        rng.setEnd(bookmark.finish().dom(), bookmark.foffset());\n        return Option.some(rng);\n      } catch (_) {\n        return Option.none();\n      }\n    };\n    var store = function (editor) {\n      var newBookmark = shouldStore(editor) ? getBookmark$2(Element.fromDom(editor.getBody())) : Option.none();\n      editor.bookmark = newBookmark.isSome() ? newBookmark : editor.bookmark;\n    };\n    var storeNative = function (editor, rng) {\n      var root = Element.fromDom(editor.getBody());\n      var range = shouldStore(editor) ? Option.from(rng) : Option.none();\n      var newBookmark = range.map(nativeRangeToSelectionRange).filter(isRngInRoot(root));\n      editor.bookmark = newBookmark.isSome() ? newBookmark : editor.bookmark;\n    };\n    var getRng = function (editor) {\n      var bookmark = editor.bookmark ? editor.bookmark : Option.none();\n      return bookmark.bind(curry(validate, Element.fromDom(editor.getBody()))).bind(bookmarkToNativeRng);\n    };\n    var restore = function (editor) {\n      getRng(editor).each(function (rng) {\n        editor.selection.setRng(rng);\n      });\n    };\n    var SelectionBookmark = {\n      store: store,\n      storeNative: storeNative,\n      readRange: readRange,\n      restore: restore,\n      getRng: getRng,\n      getBookmark: getBookmark$2,\n      validate: validate\n    };\n\n    var indentElement = function (dom, command, useMargin, value, unit, element) {\n      if (dom.getContentEditable(element) === 'false') {\n        return;\n      }\n      var indentStyleName = useMargin ? 'margin' : 'padding';\n      indentStyleName = element.nodeName === 'TABLE' ? 'margin' : indentStyleName;\n      indentStyleName += dom.getStyle(element, 'direction', true) === 'rtl' ? 'Right' : 'Left';\n      if (command === 'outdent') {\n        var styleValue = Math.max(0, parseInt(element.style[indentStyleName] || 0, 10) - value);\n        dom.setStyle(element, indentStyleName, styleValue ? styleValue + unit : '');\n      } else {\n        var styleValue = parseInt(element.style[indentStyleName] || 0, 10) + value + unit;\n        dom.setStyle(element, indentStyleName, styleValue);\n      }\n    };\n    var isListComponent = function (el) {\n      return isList(el) || isListItem(el);\n    };\n    var parentIsListComponent = function (el) {\n      return parent(el).map(isListComponent).getOr(false);\n    };\n    var getBlocksToIndent = function (editor) {\n      return filter(map(editor.selection.getSelectedBlocks(), Element.fromDom), function (el) {\n        return !isListComponent(el) && !parentIsListComponent(el);\n      });\n    };\n    var handle = function (editor, command) {\n      var settings = editor.settings, dom = editor.dom, selection = editor.selection, formatter = editor.formatter;\n      var indentUnit = /[a-z%]+$/i.exec(settings.indentation)[0];\n      var indentValue = parseInt(settings.indentation, 10);\n      var useMargin = editor.getParam('indent_use_margin', false);\n      if (!editor.queryCommandState('InsertUnorderedList') && !editor.queryCommandState('InsertOrderedList')) {\n        if (!settings.forced_root_block && !dom.getParent(selection.getNode(), dom.isBlock)) {\n          formatter.apply('div');\n        }\n      }\n      each(getBlocksToIndent(editor), function (block) {\n        indentElement(dom, command, useMargin, indentValue, indentUnit, block.dom());\n      });\n    };\n\n    var each$a = Tools.each, extend$2 = Tools.extend;\n    var map$3 = Tools.map, inArray$2 = Tools.inArray;\n    function EditorCommands (editor) {\n      var dom, selection, formatter;\n      var commands = {\n        state: {},\n        exec: {},\n        value: {}\n      };\n      var settings = editor.settings, bookmark;\n      editor.on('PreInit', function () {\n        dom = editor.dom;\n        selection = editor.selection;\n        settings = editor.settings;\n        formatter = editor.formatter;\n      });\n      var execCommand = function (command, ui, value, args) {\n        var func, customCommand, state = false;\n        if (editor.removed) {\n          return;\n        }\n        if (!/^(mceAddUndoLevel|mceEndUndoLevel|mceBeginUndoLevel|mceRepaint)$/.test(command) && (!args || !args.skip_focus)) {\n          editor.focus();\n        } else {\n          SelectionBookmark.restore(editor);\n        }\n        args = editor.fire('BeforeExecCommand', {\n          command: command,\n          ui: ui,\n          value: value\n        });\n        if (args.isDefaultPrevented()) {\n          return false;\n        }\n        customCommand = command.toLowerCase();\n        if (func = commands.exec[customCommand]) {\n          func(customCommand, ui, value);\n          editor.fire('ExecCommand', {\n            command: command,\n            ui: ui,\n            value: value\n          });\n          return true;\n        }\n        each$a(editor.plugins, function (p) {\n          if (p.execCommand && p.execCommand(command, ui, value)) {\n            editor.fire('ExecCommand', {\n              command: command,\n              ui: ui,\n              value: value\n            });\n            state = true;\n            return false;\n          }\n        });\n        if (state) {\n          return state;\n        }\n        if (editor.theme && editor.theme.execCommand && editor.theme.execCommand(command, ui, value)) {\n          editor.fire('ExecCommand', {\n            command: command,\n            ui: ui,\n            value: value\n          });\n          return true;\n        }\n        try {\n          state = editor.getDoc().execCommand(command, ui, value);\n        } catch (ex) {\n        }\n        if (state) {\n          editor.fire('ExecCommand', {\n            command: command,\n            ui: ui,\n            value: value\n          });\n          return true;\n        }\n        return false;\n      };\n      var queryCommandState = function (command) {\n        var func;\n        if (editor.quirks.isHidden() || editor.removed) {\n          return;\n        }\n        command = command.toLowerCase();\n        if (func = commands.state[command]) {\n          return func(command);\n        }\n        try {\n          return editor.getDoc().queryCommandState(command);\n        } catch (ex) {\n        }\n        return false;\n      };\n      var queryCommandValue = function (command) {\n        var func;\n        if (editor.quirks.isHidden() || editor.removed) {\n          return;\n        }\n        command = command.toLowerCase();\n        if (func = commands.value[command]) {\n          return func(command);\n        }\n        try {\n          return editor.getDoc().queryCommandValue(command);\n        } catch (ex) {\n        }\n      };\n      var addCommands = function (commandList, type) {\n        type = type || 'exec';\n        each$a(commandList, function (callback, command) {\n          each$a(command.toLowerCase().split(','), function (command) {\n            commands[type][command] = callback;\n          });\n        });\n      };\n      var addCommand = function (command, callback, scope) {\n        command = command.toLowerCase();\n        commands.exec[command] = function (command, ui, value, args) {\n          return callback.call(scope || editor, ui, value, args);\n        };\n      };\n      var queryCommandSupported = function (command) {\n        command = command.toLowerCase();\n        if (commands.exec[command]) {\n          return true;\n        }\n        try {\n          return editor.getDoc().queryCommandSupported(command);\n        } catch (ex) {\n        }\n        return false;\n      };\n      var addQueryStateHandler = function (command, callback, scope) {\n        command = command.toLowerCase();\n        commands.state[command] = function () {\n          return callback.call(scope || editor);\n        };\n      };\n      var addQueryValueHandler = function (command, callback, scope) {\n        command = command.toLowerCase();\n        commands.value[command] = function () {\n          return callback.call(scope || editor);\n        };\n      };\n      var hasCustomCommand = function (command) {\n        command = command.toLowerCase();\n        return !!commands.exec[command];\n      };\n      extend$2(this, {\n        execCommand: execCommand,\n        queryCommandState: queryCommandState,\n        queryCommandValue: queryCommandValue,\n        queryCommandSupported: queryCommandSupported,\n        addCommands: addCommands,\n        addCommand: addCommand,\n        addQueryStateHandler: addQueryStateHandler,\n        addQueryValueHandler: addQueryValueHandler,\n        hasCustomCommand: hasCustomCommand\n      });\n      var execNativeCommand = function (command, ui, value) {\n        if (ui === undefined) {\n          ui = false;\n        }\n        if (value === undefined) {\n          value = null;\n        }\n        return editor.getDoc().execCommand(command, ui, value);\n      };\n      var isFormatMatch = function (name) {\n        return formatter.match(name);\n      };\n      var toggleFormat = function (name, value) {\n        formatter.toggle(name, value ? { value: value } : undefined);\n        editor.nodeChanged();\n      };\n      var storeSelection = function (type) {\n        bookmark = selection.getBookmark(type);\n      };\n      var restoreSelection = function () {\n        selection.moveToBookmark(bookmark);\n      };\n      addCommands({\n        'mceResetDesignMode,mceBeginUndoLevel': function () {\n        },\n        'mceEndUndoLevel,mceAddUndoLevel': function () {\n          editor.undoManager.add();\n        },\n        'Cut,Copy,Paste': function (command) {\n          var doc = editor.getDoc();\n          var failed;\n          try {\n            execNativeCommand(command);\n          } catch (ex) {\n            failed = true;\n          }\n          if (command === 'paste' && !doc.queryCommandEnabled(command)) {\n            failed = true;\n          }\n          if (failed || !doc.queryCommandSupported(command)) {\n            var msg = editor.translate('Your browser doesn\\'t support direct access to the clipboard. ' + 'Please use the Ctrl+X/C/V keyboard shortcuts instead.');\n            if (Env.mac) {\n              msg = msg.replace(/Ctrl\\+/g, '\\u2318+');\n            }\n            editor.notificationManager.open({\n              text: msg,\n              type: 'error'\n            });\n          }\n        },\n        'unlink': function () {\n          if (selection.isCollapsed()) {\n            var elm = editor.dom.getParent(editor.selection.getStart(), 'a');\n            if (elm) {\n              editor.dom.remove(elm, true);\n            }\n            return;\n          }\n          formatter.remove('link');\n        },\n        'JustifyLeft,JustifyCenter,JustifyRight,JustifyFull,JustifyNone': function (command) {\n          var align = command.substring(7);\n          if (align === 'full') {\n            align = 'justify';\n          }\n          each$a('left,center,right,justify'.split(','), function (name) {\n            if (align !== name) {\n              formatter.remove('align' + name);\n            }\n          });\n          if (align !== 'none') {\n            toggleFormat('align' + align);\n          }\n        },\n        'InsertUnorderedList,InsertOrderedList': function (command) {\n          var listElm, listParent;\n          execNativeCommand(command);\n          listElm = dom.getParent(selection.getNode(), 'ol,ul');\n          if (listElm) {\n            listParent = listElm.parentNode;\n            if (/^(H[1-6]|P|ADDRESS|PRE)$/.test(listParent.nodeName)) {\n              storeSelection();\n              dom.split(listParent, listElm);\n              restoreSelection();\n            }\n          }\n        },\n        'Bold,Italic,Underline,Strikethrough,Superscript,Subscript': function (command) {\n          toggleFormat(command);\n        },\n        'ForeColor,HiliteColor': function (command, ui, value) {\n          toggleFormat(command, value);\n        },\n        'FontName': function (command, ui, value) {\n          fontNameAction(editor, value);\n        },\n        'FontSize': function (command, ui, value) {\n          fontSizeAction(editor, value);\n        },\n        'RemoveFormat': function (command) {\n          formatter.remove(command);\n        },\n        'mceBlockQuote': function () {\n          toggleFormat('blockquote');\n        },\n        'FormatBlock': function (command, ui, value) {\n          return toggleFormat(value || 'p');\n        },\n        'mceCleanup': function () {\n          var bookmark = selection.getBookmark();\n          editor.setContent(editor.getContent());\n          selection.moveToBookmark(bookmark);\n        },\n        'mceRemoveNode': function (command, ui, value) {\n          var node = value || selection.getNode();\n          if (node !== editor.getBody()) {\n            storeSelection();\n            editor.dom.remove(node, true);\n            restoreSelection();\n          }\n        },\n        'mceSelectNodeDepth': function (command, ui, value) {\n          var counter = 0;\n          dom.getParent(selection.getNode(), function (node) {\n            if (node.nodeType === 1 && counter++ === value) {\n              selection.select(node);\n              return false;\n            }\n          }, editor.getBody());\n        },\n        'mceSelectNode': function (command, ui, value) {\n          selection.select(value);\n        },\n        'mceInsertContent': function (command, ui, value) {\n          InsertContent.insertAtCaret(editor, value);\n        },\n        'mceInsertRawHTML': function (command, ui, value) {\n          selection.setContent('tiny_mce_marker');\n          var content = editor.getContent();\n          editor.setContent(content.replace(/tiny_mce_marker/g, function () {\n            return value;\n          }));\n        },\n        'mceToggleFormat': function (command, ui, value) {\n          toggleFormat(value);\n        },\n        'mceSetContent': function (command, ui, value) {\n          editor.setContent(value);\n        },\n        'Indent,Outdent': function (command) {\n          handle(editor, command);\n        },\n        'mceRepaint': function () {\n        },\n        'InsertHorizontalRule': function () {\n          editor.execCommand('mceInsertContent', false, '<hr />');\n        },\n        'mceToggleVisualAid': function () {\n          editor.hasVisual = !editor.hasVisual;\n          editor.addVisual();\n        },\n        'mceReplaceContent': function (command, ui, value) {\n          editor.execCommand('mceInsertContent', false, value.replace(/\\{\\$selection\\}/g, selection.getContent({ format: 'text' })));\n        },\n        'mceInsertLink': function (command, ui, value) {\n          var anchor;\n          if (typeof value === 'string') {\n            value = { href: value };\n          }\n          anchor = dom.getParent(selection.getNode(), 'a');\n          value.href = value.href.replace(' ', '%20');\n          if (!anchor || !value.href) {\n            formatter.remove('link');\n          }\n          if (value.href) {\n            formatter.apply('link', value, anchor);\n          }\n        },\n        'selectAll': function () {\n          var editingHost = dom.getParent(selection.getStart(), NodeType.isContentEditableTrue);\n          if (editingHost) {\n            var rng = dom.createRng();\n            rng.selectNodeContents(editingHost);\n            selection.setRng(rng);\n          }\n        },\n        'delete': function () {\n          DeleteCommands.deleteCommand(editor);\n        },\n        'forwardDelete': function () {\n          DeleteCommands.forwardDeleteCommand(editor);\n        },\n        'mceNewDocument': function () {\n          editor.setContent('');\n        },\n        'InsertLineBreak': function (command, ui, value) {\n          InsertBr.insert(editor, value);\n          return true;\n        }\n      });\n      var alignStates = function (name) {\n        return function () {\n          var nodes = selection.isCollapsed() ? [dom.getParent(selection.getNode(), dom.isBlock)] : selection.getSelectedBlocks();\n          var matches = map$3(nodes, function (node) {\n            return !!formatter.matchNode(node, name);\n          });\n          return inArray$2(matches, true) !== -1;\n        };\n      };\n      addCommands({\n        'JustifyLeft': alignStates('alignleft'),\n        'JustifyCenter': alignStates('aligncenter'),\n        'JustifyRight': alignStates('alignright'),\n        'JustifyFull': alignStates('alignjustify'),\n        'Bold,Italic,Underline,Strikethrough,Superscript,Subscript': function (command) {\n          return isFormatMatch(command);\n        },\n        'mceBlockQuote': function () {\n          return isFormatMatch('blockquote');\n        },\n        'Outdent': function () {\n          var node;\n          if (settings.inline_styles) {\n            if ((node = dom.getParent(selection.getStart(), dom.isBlock)) && parseInt(node.style.paddingLeft, 10) > 0) {\n              return true;\n            }\n            if ((node = dom.getParent(selection.getEnd(), dom.isBlock)) && parseInt(node.style.paddingLeft, 10) > 0) {\n              return true;\n            }\n          }\n          return queryCommandState('InsertUnorderedList') || queryCommandState('InsertOrderedList') || !settings.inline_styles && !!dom.getParent(selection.getNode(), 'BLOCKQUOTE');\n        },\n        'InsertUnorderedList,InsertOrderedList': function (command) {\n          var list = dom.getParent(selection.getNode(), 'ul,ol');\n          return list && (command === 'insertunorderedlist' && list.tagName === 'UL' || command === 'insertorderedlist' && list.tagName === 'OL');\n        }\n      }, 'state');\n      addCommands({\n        Undo: function () {\n          editor.undoManager.undo();\n        },\n        Redo: function () {\n          editor.undoManager.redo();\n        }\n      });\n      addQueryValueHandler('FontName', function () {\n        return fontNameQuery(editor);\n      }, this);\n      addQueryValueHandler('FontSize', function () {\n        return fontSizeQuery(editor);\n      }, this);\n    }\n\n    var nativeEvents = Tools.makeMap('focus blur focusin focusout click dblclick mousedown mouseup mousemove mouseover beforepaste paste cut copy selectionchange ' + 'mouseout mouseenter mouseleave wheel keydown keypress keyup input contextmenu dragstart dragend dragover ' + 'draggesture dragdrop drop drag submit ' + 'compositionstart compositionend compositionupdate touchstart touchmove touchend', ' ');\n    var Dispatcher = function (settings) {\n      var self = this;\n      var scope, bindings = {}, toggleEvent;\n      var returnFalse = function () {\n        return false;\n      };\n      var returnTrue = function () {\n        return true;\n      };\n      settings = settings || {};\n      scope = settings.scope || self;\n      toggleEvent = settings.toggleEvent || returnFalse;\n      var fire = function (name, args) {\n        var handlers, i, l, callback;\n        name = name.toLowerCase();\n        args = args || {};\n        args.type = name;\n        if (!args.target) {\n          args.target = scope;\n        }\n        if (!args.preventDefault) {\n          args.preventDefault = function () {\n            args.isDefaultPrevented = returnTrue;\n          };\n          args.stopPropagation = function () {\n            args.isPropagationStopped = returnTrue;\n          };\n          args.stopImmediatePropagation = function () {\n            args.isImmediatePropagationStopped = returnTrue;\n          };\n          args.isDefaultPrevented = returnFalse;\n          args.isPropagationStopped = returnFalse;\n          args.isImmediatePropagationStopped = returnFalse;\n        }\n        if (settings.beforeFire) {\n          settings.beforeFire(args);\n        }\n        handlers = bindings[name];\n        if (handlers) {\n          for (i = 0, l = handlers.length; i < l; i++) {\n            callback = handlers[i];\n            if (callback.once) {\n              off(name, callback.func);\n            }\n            if (args.isImmediatePropagationStopped()) {\n              args.stopPropagation();\n              return args;\n            }\n            if (callback.func.call(scope, args) === false) {\n              args.preventDefault();\n              return args;\n            }\n          }\n        }\n        return args;\n      };\n      var on = function (name, callback, prepend, extra) {\n        var handlers, names, i;\n        if (callback === false) {\n          callback = returnFalse;\n        }\n        if (callback) {\n          callback = { func: callback };\n          if (extra) {\n            Tools.extend(callback, extra);\n          }\n          names = name.toLowerCase().split(' ');\n          i = names.length;\n          while (i--) {\n            name = names[i];\n            handlers = bindings[name];\n            if (!handlers) {\n              handlers = bindings[name] = [];\n              toggleEvent(name, true);\n            }\n            if (prepend) {\n              handlers.unshift(callback);\n            } else {\n              handlers.push(callback);\n            }\n          }\n        }\n        return self;\n      };\n      var off = function (name, callback) {\n        var i, handlers, bindingName, names, hi;\n        if (name) {\n          names = name.toLowerCase().split(' ');\n          i = names.length;\n          while (i--) {\n            name = names[i];\n            handlers = bindings[name];\n            if (!name) {\n              for (bindingName in bindings) {\n                toggleEvent(bindingName, false);\n                delete bindings[bindingName];\n              }\n              return self;\n            }\n            if (handlers) {\n              if (!callback) {\n                handlers.length = 0;\n              } else {\n                hi = handlers.length;\n                while (hi--) {\n                  if (handlers[hi].func === callback) {\n                    handlers = handlers.slice(0, hi).concat(handlers.slice(hi + 1));\n                    bindings[name] = handlers;\n                  }\n                }\n              }\n              if (!handlers.length) {\n                toggleEvent(name, false);\n                delete bindings[name];\n              }\n            }\n          }\n        } else {\n          for (name in bindings) {\n            toggleEvent(name, false);\n          }\n          bindings = {};\n        }\n        return self;\n      };\n      var once = function (name, callback, prepend) {\n        return on(name, callback, prepend, { once: true });\n      };\n      var has = function (name) {\n        name = name.toLowerCase();\n        return !(!bindings[name] || bindings[name].length === 0);\n      };\n      self.fire = fire;\n      self.on = on;\n      self.off = off;\n      self.once = once;\n      self.has = has;\n    };\n    Dispatcher.isNative = function (name) {\n      return !!nativeEvents[name.toLowerCase()];\n    };\n\n    var getEventDispatcher = function (obj) {\n      if (!obj._eventDispatcher) {\n        obj._eventDispatcher = new Dispatcher({\n          scope: obj,\n          toggleEvent: function (name, state) {\n            if (Dispatcher.isNative(name) && obj.toggleNativeEvent) {\n              obj.toggleNativeEvent(name, state);\n            }\n          }\n        });\n      }\n      return obj._eventDispatcher;\n    };\n    var Observable = {\n      fire: function (name, args, bubble) {\n        var self = this;\n        if (self.removed && name !== 'remove' && name !== 'detach') {\n          return args;\n        }\n        args = getEventDispatcher(self).fire(name, args, bubble);\n        if (bubble !== false && self.parent) {\n          var parent = self.parent();\n          while (parent && !args.isPropagationStopped()) {\n            parent.fire(name, args, false);\n            parent = parent.parent();\n          }\n        }\n        return args;\n      },\n      on: function (name, callback, prepend) {\n        return getEventDispatcher(this).on(name, callback, prepend);\n      },\n      off: function (name, callback) {\n        return getEventDispatcher(this).off(name, callback);\n      },\n      once: function (name, callback) {\n        return getEventDispatcher(this).once(name, callback);\n      },\n      hasEventListeners: function (name) {\n        return getEventDispatcher(this).has(name);\n      }\n    };\n\n    var firePreProcess = function (editor, args) {\n      return editor.fire('PreProcess', args);\n    };\n    var firePostProcess = function (editor, args) {\n      return editor.fire('PostProcess', args);\n    };\n    var fireRemove = function (editor) {\n      return editor.fire('remove');\n    };\n    var fireDetach = function (editor) {\n      return editor.fire('detach');\n    };\n    var fireSwitchMode = function (editor, mode) {\n      return editor.fire('SwitchMode', { mode: mode });\n    };\n    var fireObjectResizeStart = function (editor, target, width, height) {\n      editor.fire('ObjectResizeStart', {\n        target: target,\n        width: width,\n        height: height\n      });\n    };\n    var fireObjectResized = function (editor, target, width, height) {\n      editor.fire('ObjectResized', {\n        target: target,\n        width: width,\n        height: height\n      });\n    };\n    var Events = {\n      firePreProcess: firePreProcess,\n      firePostProcess: firePostProcess,\n      fireRemove: fireRemove,\n      fireDetach: fireDetach,\n      fireSwitchMode: fireSwitchMode,\n      fireObjectResizeStart: fireObjectResizeStart,\n      fireObjectResized: fireObjectResized\n    };\n\n    var setEditorCommandState = function (editor, cmd, state) {\n      try {\n        editor.getDoc().execCommand(cmd, false, state);\n      } catch (ex) {\n      }\n    };\n    var toggleClass = function (elm, cls, state) {\n      if (has$2(elm, cls) && state === false) {\n        remove$4(elm, cls);\n      } else if (state) {\n        add$2(elm, cls);\n      }\n    };\n    var toggleReadOnly = function (editor, state) {\n      toggleClass(Element.fromDom(editor.getBody()), 'mce-content-readonly', state);\n      if (state) {\n        editor.selection.controlSelection.hideResizeRect();\n        editor.readonly = true;\n        editor.getBody().contentEditable = 'false';\n      } else {\n        editor.readonly = false;\n        editor.getBody().contentEditable = 'true';\n        setEditorCommandState(editor, 'StyleWithCSS', false);\n        setEditorCommandState(editor, 'enableInlineTableEditing', false);\n        setEditorCommandState(editor, 'enableObjectResizing', false);\n        editor.focus();\n        editor.nodeChanged();\n      }\n    };\n    var setMode = function (editor, mode) {\n      if (mode === getMode(editor)) {\n        return;\n      }\n      if (editor.initialized) {\n        toggleReadOnly(editor, mode === 'readonly');\n      } else {\n        editor.on('init', function () {\n          toggleReadOnly(editor, mode === 'readonly');\n        });\n      }\n      Events.fireSwitchMode(editor, mode);\n    };\n    var getMode = function (editor) {\n      return editor.readonly ? 'readonly' : 'design';\n    };\n    var isReadOnly = function (editor) {\n      return editor.readonly === true;\n    };\n\n    var DOM$1 = DOMUtils$1.DOM;\n    var customEventRootDelegates;\n    var getEventTarget = function (editor, eventName) {\n      if (eventName === 'selectionchange') {\n        return editor.getDoc();\n      }\n      if (!editor.inline && /^mouse|touch|click|contextmenu|drop|dragover|dragend/.test(eventName)) {\n        return editor.getDoc().documentElement;\n      }\n      if (editor.settings.event_root) {\n        if (!editor.eventRoot) {\n          editor.eventRoot = DOM$1.select(editor.settings.event_root)[0];\n        }\n        return editor.eventRoot;\n      }\n      return editor.getBody();\n    };\n    var isListening = function (editor) {\n      return !editor.hidden && !editor.readonly;\n    };\n    var fireEvent = function (editor, eventName, e) {\n      if (isListening(editor)) {\n        editor.fire(eventName, e);\n      } else if (isReadOnly(editor)) {\n        e.preventDefault();\n      }\n    };\n    var bindEventDelegate = function (editor, eventName) {\n      var eventRootElm, delegate;\n      if (!editor.delegates) {\n        editor.delegates = {};\n      }\n      if (editor.delegates[eventName] || editor.removed) {\n        return;\n      }\n      eventRootElm = getEventTarget(editor, eventName);\n      if (editor.settings.event_root) {\n        if (!customEventRootDelegates) {\n          customEventRootDelegates = {};\n          editor.editorManager.on('removeEditor', function () {\n            var name;\n            if (!editor.editorManager.activeEditor) {\n              if (customEventRootDelegates) {\n                for (name in customEventRootDelegates) {\n                  editor.dom.unbind(getEventTarget(editor, name));\n                }\n                customEventRootDelegates = null;\n              }\n            }\n          });\n        }\n        if (customEventRootDelegates[eventName]) {\n          return;\n        }\n        delegate = function (e) {\n          var target = e.target;\n          var editors = editor.editorManager.get();\n          var i = editors.length;\n          while (i--) {\n            var body = editors[i].getBody();\n            if (body === target || DOM$1.isChildOf(target, body)) {\n              fireEvent(editors[i], eventName, e);\n            }\n          }\n        };\n        customEventRootDelegates[eventName] = delegate;\n        DOM$1.bind(eventRootElm, eventName, delegate);\n      } else {\n        delegate = function (e) {\n          fireEvent(editor, eventName, e);\n        };\n        DOM$1.bind(eventRootElm, eventName, delegate);\n        editor.delegates[eventName] = delegate;\n      }\n    };\n    var EditorObservable = {\n      bindPendingEventDelegates: function () {\n        var self = this;\n        Tools.each(self._pendingNativeEvents, function (name) {\n          bindEventDelegate(self, name);\n        });\n      },\n      toggleNativeEvent: function (name, state) {\n        var self = this;\n        if (name === 'focus' || name === 'blur') {\n          return;\n        }\n        if (state) {\n          if (self.initialized) {\n            bindEventDelegate(self, name);\n          } else {\n            if (!self._pendingNativeEvents) {\n              self._pendingNativeEvents = [name];\n            } else {\n              self._pendingNativeEvents.push(name);\n            }\n          }\n        } else if (self.initialized) {\n          self.dom.unbind(getEventTarget(self, name), name, self.delegates[name]);\n          delete self.delegates[name];\n        }\n      },\n      unbindAllNativeEvents: function () {\n        var self = this;\n        var body = self.getBody();\n        var dom = self.dom;\n        var name;\n        if (self.delegates) {\n          for (name in self.delegates) {\n            self.dom.unbind(getEventTarget(self, name), name, self.delegates[name]);\n          }\n          delete self.delegates;\n        }\n        if (!self.inline && body && dom) {\n          body.onload = null;\n          dom.unbind(self.getWin());\n          dom.unbind(self.getDoc());\n        }\n        if (dom) {\n          dom.unbind(body);\n          dom.unbind(self.getContainer());\n        }\n      }\n    };\n    EditorObservable = Tools.extend({}, Observable, EditorObservable);\n    var EditorObservable$1 = EditorObservable;\n\n    var sectionResult = Immutable('sections', 'settings');\n    var detection = PlatformDetection$1.detect();\n    var isTouch = detection.deviceType.isTouch();\n    var mobilePlugins = [\n      'lists',\n      'autolink',\n      'autosave'\n    ];\n    var defaultMobileSettings = { theme: 'mobile' };\n    var normalizePlugins = function (plugins) {\n      var pluginNames = isArray(plugins) ? plugins.join(' ') : plugins;\n      var trimmedPlugins = map(isString(pluginNames) ? pluginNames.split(' ') : [], trim$2);\n      return filter(trimmedPlugins, function (item) {\n        return item.length > 0;\n      });\n    };\n    var filterMobilePlugins = function (plugins) {\n      return filter(plugins, curry(contains, mobilePlugins));\n    };\n    var extractSections = function (keys, settings) {\n      var result = bifilter(settings, function (value, key) {\n        return contains(keys, key);\n      });\n      return sectionResult(result.t, result.f);\n    };\n    var getSection = function (sectionResult, name, defaults) {\n      var sections = sectionResult.sections();\n      var sectionSettings = sections.hasOwnProperty(name) ? sections[name] : {};\n      return Tools.extend({}, defaults, sectionSettings);\n    };\n    var hasSection = function (sectionResult, name) {\n      return sectionResult.sections().hasOwnProperty(name);\n    };\n    var getDefaultSettings = function (id, documentBaseUrl, editor) {\n      return {\n        id: id,\n        theme: 'modern',\n        delta_width: 0,\n        delta_height: 0,\n        popup_css: '',\n        plugins: '',\n        document_base_url: documentBaseUrl,\n        add_form_submit_trigger: true,\n        submit_patch: true,\n        add_unload_trigger: true,\n        convert_urls: true,\n        relative_urls: true,\n        remove_script_host: true,\n        object_resizing: true,\n        doctype: '<!DOCTYPE html>',\n        visual: true,\n        font_size_style_values: 'xx-small,x-small,small,medium,large,x-large,xx-large',\n        font_size_legacy_values: 'xx-small,small,medium,large,x-large,xx-large,300%',\n        forced_root_block: 'p',\n        hidden_input: true,\n        render_ui: true,\n        indentation: '40px',\n        inline_styles: true,\n        convert_fonts_to_spans: true,\n        indent: 'simple',\n        indent_before: 'p,h1,h2,h3,h4,h5,h6,blockquote,div,title,style,pre,script,td,th,ul,ol,li,dl,dt,dd,area,table,thead,' + 'tfoot,tbody,tr,section,summary,article,hgroup,aside,figure,figcaption,option,optgroup,datalist',\n        indent_after: 'p,h1,h2,h3,h4,h5,h6,blockquote,div,title,style,pre,script,td,th,ul,ol,li,dl,dt,dd,area,table,thead,' + 'tfoot,tbody,tr,section,summary,article,hgroup,aside,figure,figcaption,option,optgroup,datalist',\n        entity_encoding: 'named',\n        url_converter: editor.convertURL,\n        url_converter_scope: editor,\n        ie7_compat: true\n      };\n    };\n    var getExternalPlugins = function (overrideSettings, settings) {\n      var userDefinedExternalPlugins = settings.external_plugins ? settings.external_plugins : {};\n      if (overrideSettings && overrideSettings.external_plugins) {\n        return Tools.extend({}, overrideSettings.external_plugins, userDefinedExternalPlugins);\n      } else {\n        return userDefinedExternalPlugins;\n      }\n    };\n    var combinePlugins = function (forcedPlugins, plugins) {\n      return [].concat(normalizePlugins(forcedPlugins)).concat(normalizePlugins(plugins));\n    };\n    var processPlugins = function (isTouchDevice, sectionResult, defaultOverrideSettings, settings) {\n      var forcedPlugins = normalizePlugins(defaultOverrideSettings.forced_plugins);\n      var plugins = normalizePlugins(settings.plugins);\n      var platformPlugins = isTouchDevice && hasSection(sectionResult, 'mobile') ? filterMobilePlugins(plugins) : plugins;\n      var combinedPlugins = combinePlugins(forcedPlugins, platformPlugins);\n      return Tools.extend(settings, { plugins: combinedPlugins.join(' ') });\n    };\n    var isOnMobile = function (isTouchDevice, sectionResult) {\n      var isInline = sectionResult.settings().inline;\n      return isTouchDevice && hasSection(sectionResult, 'mobile') && !isInline;\n    };\n    var combineSettings = function (isTouchDevice, defaultSettings, defaultOverrideSettings, settings) {\n      var sectionResult = extractSections(['mobile'], settings);\n      var extendedSettings = Tools.extend(defaultSettings, defaultOverrideSettings, sectionResult.settings(), isOnMobile(isTouchDevice, sectionResult) ? getSection(sectionResult, 'mobile', defaultMobileSettings) : {}, {\n        validate: true,\n        content_editable: sectionResult.settings().inline,\n        external_plugins: getExternalPlugins(defaultOverrideSettings, sectionResult.settings())\n      });\n      return processPlugins(isTouchDevice, sectionResult, defaultOverrideSettings, extendedSettings);\n    };\n    var getEditorSettings = function (editor, id, documentBaseUrl, defaultOverrideSettings, settings) {\n      var defaultSettings = getDefaultSettings(id, documentBaseUrl, editor);\n      return combineSettings(isTouch, defaultSettings, defaultOverrideSettings, settings);\n    };\n    var getFiltered = function (predicate, editor, name) {\n      return Option.from(editor.settings[name]).filter(predicate);\n    };\n    var getParamObject = function (value) {\n      var output = {};\n      if (typeof value === 'string') {\n        each(value.indexOf('=') > 0 ? value.split(/[;,](?![^=;,]*(?:[;,]|$))/) : value.split(','), function (val) {\n          var arr = val.split('=');\n          if (arr.length > 1) {\n            output[Tools.trim(arr[0])] = Tools.trim(arr[1]);\n          } else {\n            output[Tools.trim(arr[0])] = Tools.trim(arr);\n          }\n        });\n      } else {\n        output = value;\n      }\n      return output;\n    };\n    var isArrayOf = function (p) {\n      return function (a) {\n        return isArray(a) && forall(a, p);\n      };\n    };\n    var getParam = function (editor, name, defaultVal, type) {\n      var value = name in editor.settings ? editor.settings[name] : defaultVal;\n      if (type === 'hash') {\n        return getParamObject(value);\n      } else if (type === 'string') {\n        return getFiltered(isString, editor, name).getOr(defaultVal);\n      } else if (type === 'number') {\n        return getFiltered(isNumber, editor, name).getOr(defaultVal);\n      } else if (type === 'boolean') {\n        return getFiltered(isBoolean, editor, name).getOr(defaultVal);\n      } else if (type === 'object') {\n        return getFiltered(isObject, editor, name).getOr(defaultVal);\n      } else if (type === 'array') {\n        return getFiltered(isArray, editor, name).getOr(defaultVal);\n      } else if (type === 'string[]') {\n        return getFiltered(isArrayOf(isString), editor, name).getOr(defaultVal);\n      } else if (type === 'function') {\n        return getFiltered(isFunction, editor, name).getOr(defaultVal);\n      } else {\n        return value;\n      }\n    };\n\n    var each$b = Tools.each, explode$2 = Tools.explode;\n    var keyCodeLookup = {\n      f1: 112,\n      f2: 113,\n      f3: 114,\n      f4: 115,\n      f5: 116,\n      f6: 117,\n      f7: 118,\n      f8: 119,\n      f9: 120,\n      f10: 121,\n      f11: 122,\n      f12: 123\n    };\n    var modifierNames = Tools.makeMap('alt,ctrl,shift,meta,access');\n    function Shortcuts (editor) {\n      var self = this;\n      var shortcuts = {};\n      var pendingPatterns = [];\n      var parseShortcut = function (pattern) {\n        var id, key;\n        var shortcut = {};\n        each$b(explode$2(pattern, '+'), function (value) {\n          if (value in modifierNames) {\n            shortcut[value] = true;\n          } else {\n            if (/^[0-9]{2,}$/.test(value)) {\n              shortcut.keyCode = parseInt(value, 10);\n            } else {\n              shortcut.charCode = value.charCodeAt(0);\n              shortcut.keyCode = keyCodeLookup[value] || value.toUpperCase().charCodeAt(0);\n            }\n          }\n        });\n        id = [shortcut.keyCode];\n        for (key in modifierNames) {\n          if (shortcut[key]) {\n            id.push(key);\n          } else {\n            shortcut[key] = false;\n          }\n        }\n        shortcut.id = id.join(',');\n        if (shortcut.access) {\n          shortcut.alt = true;\n          if (Env.mac) {\n            shortcut.ctrl = true;\n          } else {\n            shortcut.shift = true;\n          }\n        }\n        if (shortcut.meta) {\n          if (Env.mac) {\n            shortcut.meta = true;\n          } else {\n            shortcut.ctrl = true;\n            shortcut.meta = false;\n          }\n        }\n        return shortcut;\n      };\n      var createShortcut = function (pattern, desc, cmdFunc, scope) {\n        var shortcuts;\n        shortcuts = Tools.map(explode$2(pattern, '>'), parseShortcut);\n        shortcuts[shortcuts.length - 1] = Tools.extend(shortcuts[shortcuts.length - 1], {\n          func: cmdFunc,\n          scope: scope || editor\n        });\n        return Tools.extend(shortcuts[0], {\n          desc: editor.translate(desc),\n          subpatterns: shortcuts.slice(1)\n        });\n      };\n      var hasModifier = function (e) {\n        return e.altKey || e.ctrlKey || e.metaKey;\n      };\n      var isFunctionKey = function (e) {\n        return e.type === 'keydown' && e.keyCode >= 112 && e.keyCode <= 123;\n      };\n      var matchShortcut = function (e, shortcut) {\n        if (!shortcut) {\n          return false;\n        }\n        if (shortcut.ctrl !== e.ctrlKey || shortcut.meta !== e.metaKey) {\n          return false;\n        }\n        if (shortcut.alt !== e.altKey || shortcut.shift !== e.shiftKey) {\n          return false;\n        }\n        if (e.keyCode === shortcut.keyCode || e.charCode && e.charCode === shortcut.charCode) {\n          e.preventDefault();\n          return true;\n        }\n        return false;\n      };\n      var executeShortcutAction = function (shortcut) {\n        return shortcut.func ? shortcut.func.call(shortcut.scope) : null;\n      };\n      editor.on('keyup keypress keydown', function (e) {\n        if ((hasModifier(e) || isFunctionKey(e)) && !e.isDefaultPrevented()) {\n          each$b(shortcuts, function (shortcut) {\n            if (matchShortcut(e, shortcut)) {\n              pendingPatterns = shortcut.subpatterns.slice(0);\n              if (e.type === 'keydown') {\n                executeShortcutAction(shortcut);\n              }\n              return true;\n            }\n          });\n          if (matchShortcut(e, pendingPatterns[0])) {\n            if (pendingPatterns.length === 1) {\n              if (e.type === 'keydown') {\n                executeShortcutAction(pendingPatterns[0]);\n              }\n            }\n            pendingPatterns.shift();\n          }\n        }\n      });\n      self.add = function (pattern, desc, cmdFunc, scope) {\n        var cmd;\n        cmd = cmdFunc;\n        if (typeof cmdFunc === 'string') {\n          cmdFunc = function () {\n            editor.execCommand(cmd, false, null);\n          };\n        } else if (Tools.isArray(cmd)) {\n          cmdFunc = function () {\n            editor.execCommand(cmd[0], cmd[1], cmd[2]);\n          };\n        }\n        each$b(explode$2(Tools.trim(pattern.toLowerCase())), function (pattern) {\n          var shortcut = createShortcut(pattern, desc, cmdFunc, scope);\n          shortcuts[shortcut.id] = shortcut;\n        });\n        return true;\n      };\n      self.remove = function (pattern) {\n        var shortcut = createShortcut(pattern);\n        if (shortcuts[shortcut.id]) {\n          delete shortcuts[shortcut.id];\n          return true;\n        }\n        return false;\n      };\n    }\n\n    var hasFocus = function (element) {\n      var doc = owner(element).dom();\n      return element.dom() === doc.activeElement;\n    };\n    var active = function (_doc) {\n      var doc = _doc !== undefined ? _doc.dom() : domGlobals.document;\n      return Option.from(doc.activeElement).map(Element.fromDom);\n    };\n    var search = function (element) {\n      return active(owner(element)).filter(function (e) {\n        return element.dom().contains(e.dom());\n      });\n    };\n\n    var getContentEditableHost = function (editor, node) {\n      return editor.dom.getParent(node, function (node) {\n        return editor.dom.getContentEditable(node) === 'true';\n      });\n    };\n    var getCollapsedNode = function (rng) {\n      return rng.collapsed ? Option.from(getNode(rng.startContainer, rng.startOffset)).map(Element.fromDom) : Option.none();\n    };\n    var getFocusInElement = function (root, rng) {\n      return getCollapsedNode(rng).bind(function (node) {\n        if (isTableSection(node)) {\n          return Option.some(node);\n        } else if (contains$3(root, node) === false) {\n          return Option.some(root);\n        } else {\n          return Option.none();\n        }\n      });\n    };\n    var normalizeSelection = function (editor, rng) {\n      getFocusInElement(Element.fromDom(editor.getBody()), rng).bind(function (elm) {\n        return CaretFinder.firstPositionIn(elm.dom());\n      }).fold(function () {\n        editor.selection.normalize();\n        return;\n      }, function (caretPos) {\n        return editor.selection.setRng(caretPos.toRange());\n      });\n    };\n    var focusBody = function (body) {\n      if (body.setActive) {\n        try {\n          body.setActive();\n        } catch (ex) {\n          body.focus();\n        }\n      } else {\n        body.focus();\n      }\n    };\n    var hasElementFocus = function (elm) {\n      return hasFocus(elm) || search(elm).isSome();\n    };\n    var hasIframeFocus = function (editor) {\n      return editor.iframeElement && hasFocus(Element.fromDom(editor.iframeElement));\n    };\n    var hasInlineFocus = function (editor) {\n      var rawBody = editor.getBody();\n      return rawBody && hasElementFocus(Element.fromDom(rawBody));\n    };\n    var hasFocus$1 = function (editor) {\n      return editor.inline ? hasInlineFocus(editor) : hasIframeFocus(editor);\n    };\n    var focusEditor = function (editor) {\n      var selection = editor.selection, contentEditable = editor.settings.content_editable;\n      var body = editor.getBody();\n      var rng = selection.getRng();\n      editor.quirks.refreshContentEditable();\n      var contentEditableHost = getContentEditableHost(editor, selection.getNode());\n      if (editor.$.contains(body, contentEditableHost)) {\n        focusBody(contentEditableHost);\n        normalizeSelection(editor, rng);\n        activateEditor(editor);\n        return;\n      }\n      if (editor.bookmark !== undefined && hasFocus$1(editor) === false) {\n        SelectionBookmark.getRng(editor).each(function (bookmarkRng) {\n          editor.selection.setRng(bookmarkRng);\n          rng = bookmarkRng;\n        });\n      }\n      if (!contentEditable) {\n        if (!Env.opera) {\n          focusBody(body);\n        }\n        editor.getWin().focus();\n      }\n      if (Env.gecko || contentEditable) {\n        focusBody(body);\n        normalizeSelection(editor, rng);\n      }\n      activateEditor(editor);\n    };\n    var activateEditor = function (editor) {\n      return editor.editorManager.setActive(editor);\n    };\n    var focus = function (editor, skipFocus) {\n      if (editor.removed) {\n        return;\n      }\n      skipFocus ? activateEditor(editor) : focusEditor(editor);\n    };\n    var EditorFocus = {\n      focus: focus,\n      hasFocus: hasFocus$1\n    };\n\n    var getProp = function (propName, elm) {\n      var rawElm = elm.dom();\n      return rawElm[propName];\n    };\n    var getComputedSizeProp = function (propName, elm) {\n      return parseInt(get$1(elm, propName), 10);\n    };\n    var getClientWidth = curry(getProp, 'clientWidth');\n    var getClientHeight = curry(getProp, 'clientHeight');\n    var getMarginTop = curry(getComputedSizeProp, 'margin-top');\n    var getMarginLeft = curry(getComputedSizeProp, 'margin-left');\n    var getBoundingClientRect$1 = function (elm) {\n      return elm.dom().getBoundingClientRect();\n    };\n    var isInsideElementContentArea = function (bodyElm, clientX, clientY) {\n      var clientWidth = getClientWidth(bodyElm);\n      var clientHeight = getClientHeight(bodyElm);\n      return clientX >= 0 && clientY >= 0 && clientX <= clientWidth && clientY <= clientHeight;\n    };\n    var transpose = function (inline, elm, clientX, clientY) {\n      var clientRect = getBoundingClientRect$1(elm);\n      var deltaX = inline ? clientRect.left + elm.dom().clientLeft + getMarginLeft(elm) : 0;\n      var deltaY = inline ? clientRect.top + elm.dom().clientTop + getMarginTop(elm) : 0;\n      var x = clientX - deltaX;\n      var y = clientY - deltaY;\n      return {\n        x: x,\n        y: y\n      };\n    };\n    var isXYInContentArea = function (editor, clientX, clientY) {\n      var bodyElm = Element.fromDom(editor.getBody());\n      var targetElm = editor.inline ? bodyElm : documentElement(bodyElm);\n      var transposedPoint = transpose(editor.inline, targetElm, clientX, clientY);\n      return isInsideElementContentArea(targetElm, transposedPoint.x, transposedPoint.y);\n    };\n    var fromDomSafe = function (node) {\n      return Option.from(node).map(Element.fromDom);\n    };\n    var isEditorAttachedToDom = function (editor) {\n      var rawContainer = editor.inline ? editor.getBody() : editor.getContentAreaContainer();\n      return fromDomSafe(rawContainer).map(function (container) {\n        return contains$3(owner(container), container);\n      }).getOr(false);\n    };\n    var EditorView = {\n      isXYInContentArea: isXYInContentArea,\n      isEditorAttachedToDom: isEditorAttachedToDom\n    };\n\n    function NotificationManagerImpl () {\n      var unimplemented = function () {\n        throw new Error('Theme did not provide a NotificationManager implementation.');\n      };\n      return {\n        open: unimplemented,\n        close: unimplemented,\n        reposition: unimplemented,\n        getArgs: unimplemented\n      };\n    }\n\n    function NotificationManager (editor) {\n      var notifications = [];\n      var getImplementation = function () {\n        var theme = editor.theme;\n        return theme && theme.getNotificationManagerImpl ? theme.getNotificationManagerImpl() : NotificationManagerImpl();\n      };\n      var getTopNotification = function () {\n        return Option.from(notifications[0]);\n      };\n      var isEqual = function (a, b) {\n        return a.type === b.type && a.text === b.text && !a.progressBar && !a.timeout && !b.progressBar && !b.timeout;\n      };\n      var reposition = function () {\n        if (notifications.length > 0) {\n          getImplementation().reposition(notifications);\n        }\n      };\n      var addNotification = function (notification) {\n        notifications.push(notification);\n      };\n      var closeNotification = function (notification) {\n        findIndex(notifications, function (otherNotification) {\n          return otherNotification === notification;\n        }).each(function (index) {\n          notifications.splice(index, 1);\n        });\n      };\n      var open = function (args) {\n        if (editor.removed || !EditorView.isEditorAttachedToDom(editor)) {\n          return;\n        }\n        return find(notifications, function (notification) {\n          return isEqual(getImplementation().getArgs(notification), args);\n        }).getOrThunk(function () {\n          editor.editorManager.setActive(editor);\n          var notification = getImplementation().open(args, function () {\n            closeNotification(notification);\n            reposition();\n          });\n          addNotification(notification);\n          reposition();\n          return notification;\n        });\n      };\n      var close = function () {\n        getTopNotification().each(function (notification) {\n          getImplementation().close(notification);\n          closeNotification(notification);\n          reposition();\n        });\n      };\n      var getNotifications = function () {\n        return notifications;\n      };\n      var registerEvents = function (editor) {\n        editor.on('SkinLoaded', function () {\n          var serviceMessage = editor.settings.service_message;\n          if (serviceMessage) {\n            open({\n              text: serviceMessage,\n              type: 'warning',\n              timeout: 0,\n              icon: ''\n            });\n          }\n        });\n        editor.on('ResizeEditor ResizeWindow', function () {\n          Delay.requestAnimationFrame(reposition);\n        });\n        editor.on('remove', function () {\n          each(notifications.slice(), function (notification) {\n            getImplementation().close(notification);\n          });\n        });\n      };\n      registerEvents(editor);\n      return {\n        open: open,\n        close: close,\n        getNotifications: getNotifications\n      };\n    }\n\n    function WindowManagerImpl () {\n      var unimplemented = function () {\n        throw new Error('Theme did not provide a WindowManager implementation.');\n      };\n      return {\n        open: unimplemented,\n        alert: unimplemented,\n        confirm: unimplemented,\n        close: unimplemented,\n        getParams: unimplemented,\n        setParams: unimplemented\n      };\n    }\n\n    function WindowManager (editor) {\n      var windows = [];\n      var getImplementation = function () {\n        var theme = editor.theme;\n        return theme && theme.getWindowManagerImpl ? theme.getWindowManagerImpl() : WindowManagerImpl();\n      };\n      var funcBind = function (scope, f) {\n        return function () {\n          return f ? f.apply(scope, arguments) : undefined;\n        };\n      };\n      var fireOpenEvent = function (win) {\n        editor.fire('OpenWindow', { win: win });\n      };\n      var fireCloseEvent = function (win) {\n        editor.fire('CloseWindow', { win: win });\n      };\n      var addWindow = function (win) {\n        windows.push(win);\n        fireOpenEvent(win);\n      };\n      var closeWindow = function (win) {\n        findIndex(windows, function (otherWindow) {\n          return otherWindow === win;\n        }).each(function (index) {\n          windows.splice(index, 1);\n          fireCloseEvent(win);\n          if (windows.length === 0) {\n            editor.focus();\n          }\n        });\n      };\n      var getTopWindow = function () {\n        return Option.from(windows[windows.length - 1]);\n      };\n      var open = function (args, params) {\n        editor.editorManager.setActive(editor);\n        SelectionBookmark.store(editor);\n        var win = getImplementation().open(args, params, closeWindow);\n        addWindow(win);\n        return win;\n      };\n      var alert = function (message, callback, scope) {\n        var win = getImplementation().alert(message, funcBind(scope ? scope : this, callback), closeWindow);\n        addWindow(win);\n      };\n      var confirm = function (message, callback, scope) {\n        var win = getImplementation().confirm(message, funcBind(scope ? scope : this, callback), closeWindow);\n        addWindow(win);\n      };\n      var close = function () {\n        getTopWindow().each(function (win) {\n          getImplementation().close(win);\n          closeWindow(win);\n        });\n      };\n      var getParams = function () {\n        return getTopWindow().map(getImplementation().getParams).getOr(null);\n      };\n      var setParams = function (params) {\n        getTopWindow().each(function (win) {\n          getImplementation().setParams(win, params);\n        });\n      };\n      var getWindows = function () {\n        return windows;\n      };\n      editor.on('remove', function () {\n        each(windows.slice(0), function (win) {\n          getImplementation().close(win);\n        });\n      });\n      return {\n        windows: windows,\n        open: open,\n        alert: alert,\n        confirm: confirm,\n        close: close,\n        getParams: getParams,\n        setParams: setParams,\n        getWindows: getWindows\n      };\n    }\n\n    var data = {};\n    var code = 'en';\n    var I18n = {\n      setCode: function (newCode) {\n        if (newCode) {\n          code = newCode;\n          this.rtl = this.data[newCode] ? this.data[newCode]._dir === 'rtl' : false;\n        }\n      },\n      getCode: function () {\n        return code;\n      },\n      rtl: false,\n      add: function (code, items) {\n        var langData = data[code];\n        if (!langData) {\n          data[code] = langData = {};\n        }\n        for (var name in items) {\n          langData[name] = items[name];\n        }\n        this.setCode(code);\n      },\n      translate: function (text) {\n        var langData = data[code] || {};\n        var toString = function (obj) {\n          if (Tools.is(obj, 'function')) {\n            return Object.prototype.toString.call(obj);\n          }\n          return !isEmpty(obj) ? '' + obj : '';\n        };\n        var isEmpty = function (text) {\n          return text === '' || text === null || Tools.is(text, 'undefined');\n        };\n        var getLangData = function (text) {\n          text = toString(text);\n          return Tools.hasOwn(langData, text) ? toString(langData[text]) : text;\n        };\n        if (isEmpty(text)) {\n          return '';\n        }\n        if (Tools.is(text, 'object') && Tools.hasOwn(text, 'raw')) {\n          return toString(text.raw);\n        }\n        if (Tools.is(text, 'array')) {\n          var values_1 = text.slice(1);\n          text = getLangData(text[0]).replace(/\\{([0-9]+)\\}/g, function ($1, $2) {\n            return Tools.hasOwn(values_1, $2) ? toString(values_1[$2]) : $1;\n          });\n        }\n        return getLangData(text).replace(/{context:\\w+}$/, '');\n      },\n      data: data\n    };\n\n    var PluginManager = AddOnManager.PluginManager;\n    var resolvePluginName = function (targetUrl, suffix) {\n      for (var name in PluginManager.urls) {\n        var matchUrl = PluginManager.urls[name] + '/plugin' + suffix + '.js';\n        if (matchUrl === targetUrl) {\n          return name;\n        }\n      }\n      return null;\n    };\n    var pluginUrlToMessage = function (editor, url) {\n      var plugin = resolvePluginName(url, editor.suffix);\n      return plugin ? I18n.translate([\n        'Failed to load plugin: {0} from url {1}',\n        plugin,\n        url\n      ]) : I18n.translate([\n        'Failed to load plugin url: {0}',\n        url\n      ]);\n    };\n    var displayNotification = function (editor, message) {\n      editor.notificationManager.open({\n        type: 'error',\n        text: message\n      });\n    };\n    var displayError = function (editor, message) {\n      if (editor._skinLoaded) {\n        displayNotification(editor, message);\n      } else {\n        editor.on('SkinLoaded', function () {\n          displayNotification(editor, message);\n        });\n      }\n    };\n    var uploadError = function (editor, message) {\n      displayError(editor, I18n.translate([\n        'Failed to upload image: {0}',\n        message\n      ]));\n    };\n    var pluginLoadError = function (editor, url) {\n      displayError(editor, pluginUrlToMessage(editor, url));\n    };\n    var pluginInitError = function (editor, name, err) {\n      var message = I18n.translate([\n        'Failed to initialize plugin: {0}',\n        name\n      ]);\n      initError(message, err);\n      displayError(editor, message);\n    };\n    var initError = function (message) {\n      var x = [];\n      for (var _i = 1; _i < arguments.length; _i++) {\n        x[_i - 1] = arguments[_i];\n      }\n      var console = domGlobals.window.console;\n      if (console) {\n        if (console.error) {\n          console.error.apply(console, arguments);\n        } else {\n          console.log.apply(console, arguments);\n        }\n      }\n    };\n    var ErrorReporter = {\n      pluginLoadError: pluginLoadError,\n      pluginInitError: pluginInitError,\n      uploadError: uploadError,\n      displayError: displayError,\n      initError: initError\n    };\n\n    var PluginManager$1 = AddOnManager.PluginManager;\n\n    var ThemeManager = AddOnManager.ThemeManager;\n\n    function XMLHttpRequest () {\n      var f = Global$1.getOrDie('XMLHttpRequest');\n      return new f();\n    }\n\n    function Uploader (uploadStatus, settings) {\n      var pendingPromises = {};\n      var pathJoin = function (path1, path2) {\n        if (path1) {\n          return path1.replace(/\\/$/, '') + '/' + path2.replace(/^\\//, '');\n        }\n        return path2;\n      };\n      var defaultHandler = function (blobInfo, success, failure, progress) {\n        var xhr, formData;\n        xhr = XMLHttpRequest();\n        xhr.open('POST', settings.url);\n        xhr.withCredentials = settings.credentials;\n        xhr.upload.onprogress = function (e) {\n          progress(e.loaded / e.total * 100);\n        };\n        xhr.onerror = function () {\n          failure('Image upload failed due to a XHR Transport error. Code: ' + xhr.status);\n        };\n        xhr.onload = function () {\n          var json;\n          if (xhr.status < 200 || xhr.status >= 300) {\n            failure('HTTP Error: ' + xhr.status);\n            return;\n          }\n          json = JSON.parse(xhr.responseText);\n          if (!json || typeof json.location !== 'string') {\n            failure('Invalid JSON: ' + xhr.responseText);\n            return;\n          }\n          success(pathJoin(settings.basePath, json.location));\n        };\n        formData = new domGlobals.FormData();\n        formData.append('file', blobInfo.blob(), blobInfo.filename());\n        xhr.send(formData);\n      };\n      var noUpload = function () {\n        return new promiseObj(function (resolve) {\n          resolve([]);\n        });\n      };\n      var handlerSuccess = function (blobInfo, url) {\n        return {\n          url: url,\n          blobInfo: blobInfo,\n          status: true\n        };\n      };\n      var handlerFailure = function (blobInfo, error) {\n        return {\n          url: '',\n          blobInfo: blobInfo,\n          status: false,\n          error: error\n        };\n      };\n      var resolvePending = function (blobUri, result) {\n        Tools.each(pendingPromises[blobUri], function (resolve) {\n          resolve(result);\n        });\n        delete pendingPromises[blobUri];\n      };\n      var uploadBlobInfo = function (blobInfo, handler, openNotification) {\n        uploadStatus.markPending(blobInfo.blobUri());\n        return new promiseObj(function (resolve) {\n          var notification, progress;\n          var noop = function () {\n          };\n          try {\n            var closeNotification_1 = function () {\n              if (notification) {\n                notification.close();\n                progress = noop;\n              }\n            };\n            var success = function (url) {\n              closeNotification_1();\n              uploadStatus.markUploaded(blobInfo.blobUri(), url);\n              resolvePending(blobInfo.blobUri(), handlerSuccess(blobInfo, url));\n              resolve(handlerSuccess(blobInfo, url));\n            };\n            var failure = function (error) {\n              closeNotification_1();\n              uploadStatus.removeFailed(blobInfo.blobUri());\n              resolvePending(blobInfo.blobUri(), handlerFailure(blobInfo, error));\n              resolve(handlerFailure(blobInfo, error));\n            };\n            progress = function (percent) {\n              if (percent < 0 || percent > 100) {\n                return;\n              }\n              if (!notification) {\n                notification = openNotification();\n              }\n              notification.progressBar.value(percent);\n            };\n            handler(blobInfo, success, failure, progress);\n          } catch (ex) {\n            resolve(handlerFailure(blobInfo, ex.message));\n          }\n        });\n      };\n      var isDefaultHandler = function (handler) {\n        return handler === defaultHandler;\n      };\n      var pendingUploadBlobInfo = function (blobInfo) {\n        var blobUri = blobInfo.blobUri();\n        return new promiseObj(function (resolve) {\n          pendingPromises[blobUri] = pendingPromises[blobUri] || [];\n          pendingPromises[blobUri].push(resolve);\n        });\n      };\n      var uploadBlobs = function (blobInfos, openNotification) {\n        blobInfos = Tools.grep(blobInfos, function (blobInfo) {\n          return !uploadStatus.isUploaded(blobInfo.blobUri());\n        });\n        return promiseObj.all(Tools.map(blobInfos, function (blobInfo) {\n          return uploadStatus.isPending(blobInfo.blobUri()) ? pendingUploadBlobInfo(blobInfo) : uploadBlobInfo(blobInfo, settings.handler, openNotification);\n        }));\n      };\n      var upload = function (blobInfos, openNotification) {\n        return !settings.url && isDefaultHandler(settings.handler) ? noUpload() : uploadBlobs(blobInfos, openNotification);\n      };\n      if (isFunction(settings.handler) === false) {\n        settings.handler = defaultHandler;\n      }\n      return { upload: upload };\n    }\n\n    function FileReader () {\n      var f = Global$1.getOrDie('FileReader');\n      return new f();\n    }\n\n    function Uint8Array (arr) {\n      var f = Global$1.getOrDie('Uint8Array');\n      return new f(arr);\n    }\n\n    var requestAnimationFrame$1 = function (callback) {\n      var f = Global$1.getOrDie('requestAnimationFrame');\n      f(callback);\n    };\n    var atob = function (base64) {\n      var f = Global$1.getOrDie('atob');\n      return f(base64);\n    };\n    var Window = {\n      atob: atob,\n      requestAnimationFrame: requestAnimationFrame$1\n    };\n\n    var blobUriToBlob = function (url) {\n      return new promiseObj(function (resolve, reject) {\n        var rejectWithError = function () {\n          reject('Cannot convert ' + url + ' to Blob. Resource might not exist or is inaccessible.');\n        };\n        try {\n          var xhr = XMLHttpRequest();\n          xhr.open('GET', url, true);\n          xhr.responseType = 'blob';\n          xhr.onload = function () {\n            if (this.status === 200) {\n              resolve(this.response);\n            } else {\n              rejectWithError();\n            }\n          };\n          xhr.onerror = rejectWithError;\n          xhr.send();\n        } catch (ex) {\n          rejectWithError();\n        }\n      });\n    };\n    var parseDataUri = function (uri) {\n      var type, matches;\n      var uriParts = decodeURIComponent(uri).split(',');\n      matches = /data:([^;]+)/.exec(uriParts[0]);\n      if (matches) {\n        type = matches[1];\n      }\n      return {\n        type: type,\n        data: uriParts[1]\n      };\n    };\n    var dataUriToBlob = function (uri) {\n      return new promiseObj(function (resolve) {\n        var str, arr, i;\n        var uriParts = parseDataUri(uri);\n        try {\n          str = Window.atob(uriParts.data);\n        } catch (e) {\n          resolve(new domGlobals.Blob([]));\n          return;\n        }\n        arr = Uint8Array(str.length);\n        for (i = 0; i < arr.length; i++) {\n          arr[i] = str.charCodeAt(i);\n        }\n        resolve(new domGlobals.Blob([arr], { type: uriParts.type }));\n      });\n    };\n    var uriToBlob = function (url) {\n      if (url.indexOf('blob:') === 0) {\n        return blobUriToBlob(url);\n      }\n      if (url.indexOf('data:') === 0) {\n        return dataUriToBlob(url);\n      }\n      return null;\n    };\n    var blobToDataUri = function (blob) {\n      return new promiseObj(function (resolve) {\n        var reader = FileReader();\n        reader.onloadend = function () {\n          resolve(reader.result);\n        };\n        reader.readAsDataURL(blob);\n      });\n    };\n    var Conversions = {\n      uriToBlob: uriToBlob,\n      blobToDataUri: blobToDataUri,\n      parseDataUri: parseDataUri\n    };\n\n    var count = 0;\n    var uniqueId = function (prefix) {\n      return (prefix || 'blobid') + count++;\n    };\n    var imageToBlobInfo = function (blobCache, img, resolve, reject) {\n      var base64, blobInfo;\n      if (img.src.indexOf('blob:') === 0) {\n        blobInfo = blobCache.getByUri(img.src);\n        if (blobInfo) {\n          resolve({\n            image: img,\n            blobInfo: blobInfo\n          });\n        } else {\n          Conversions.uriToBlob(img.src).then(function (blob) {\n            Conversions.blobToDataUri(blob).then(function (dataUri) {\n              base64 = Conversions.parseDataUri(dataUri).data;\n              blobInfo = blobCache.create(uniqueId(), blob, base64);\n              blobCache.add(blobInfo);\n              resolve({\n                image: img,\n                blobInfo: blobInfo\n              });\n            });\n          }, function (err) {\n            reject(err);\n          });\n        }\n        return;\n      }\n      base64 = Conversions.parseDataUri(img.src).data;\n      blobInfo = blobCache.findFirst(function (cachedBlobInfo) {\n        return cachedBlobInfo.base64() === base64;\n      });\n      if (blobInfo) {\n        resolve({\n          image: img,\n          blobInfo: blobInfo\n        });\n      } else {\n        Conversions.uriToBlob(img.src).then(function (blob) {\n          blobInfo = blobCache.create(uniqueId(), blob, base64);\n          blobCache.add(blobInfo);\n          resolve({\n            image: img,\n            blobInfo: blobInfo\n          });\n        }, function (err) {\n          reject(err);\n        });\n      }\n    };\n    var getAllImages = function (elm) {\n      return elm ? from$1(elm.getElementsByTagName('img')) : [];\n    };\n    function ImageScanner (uploadStatus, blobCache) {\n      var cachedPromises = {};\n      var findAll = function (elm, predicate) {\n        var images;\n        if (!predicate) {\n          predicate = constant(true);\n        }\n        images = filter(getAllImages(elm), function (img) {\n          var src = img.src;\n          if (!Env.fileApi) {\n            return false;\n          }\n          if (img.hasAttribute('data-mce-bogus')) {\n            return false;\n          }\n          if (img.hasAttribute('data-mce-placeholder')) {\n            return false;\n          }\n          if (!src || src === Env.transparentSrc) {\n            return false;\n          }\n          if (src.indexOf('blob:') === 0) {\n            return !uploadStatus.isUploaded(src) && predicate(img);\n          }\n          if (src.indexOf('data:') === 0) {\n            return predicate(img);\n          }\n          return false;\n        });\n        var promises = map(images, function (img) {\n          if (cachedPromises[img.src]) {\n            return new promiseObj(function (resolve) {\n              cachedPromises[img.src].then(function (imageInfo) {\n                if (typeof imageInfo === 'string') {\n                  return imageInfo;\n                }\n                resolve({\n                  image: img,\n                  blobInfo: imageInfo.blobInfo\n                });\n              });\n            });\n          }\n          var newPromise = new promiseObj(function (resolve, reject) {\n            imageToBlobInfo(blobCache, img, resolve, reject);\n          }).then(function (result) {\n            delete cachedPromises[result.image.src];\n            return result;\n          }).catch(function (error) {\n            delete cachedPromises[img.src];\n            return error;\n          });\n          cachedPromises[img.src] = newPromise;\n          return newPromise;\n        });\n        return promiseObj.all(promises);\n      };\n      return { findAll: findAll };\n    }\n\n    var count$1 = 0;\n    var seed = function () {\n      var rnd = function () {\n        return Math.round(Math.random() * 4294967295).toString(36);\n      };\n      var now = new Date().getTime();\n      return 's' + now.toString(36) + rnd() + rnd() + rnd();\n    };\n    var uuid = function (prefix) {\n      return prefix + count$1++ + seed();\n    };\n    var Uuid = { uuid: uuid };\n\n    function BlobCache () {\n      var cache = [];\n      var mimeToExt = function (mime) {\n        var mimes = {\n          'image/jpeg': 'jpg',\n          'image/jpg': 'jpg',\n          'image/gif': 'gif',\n          'image/png': 'png'\n        };\n        return mimes[mime.toLowerCase()] || 'dat';\n      };\n      var create = function (o, blob, base64, filename) {\n        if (isString(o)) {\n          var id = o;\n          return toBlobInfo({\n            id: id,\n            name: filename,\n            blob: blob,\n            base64: base64\n          });\n        } else if (isObject(o)) {\n          return toBlobInfo(o);\n        } else {\n          throw new Error('Unknown input type');\n        }\n      };\n      var toBlobInfo = function (o) {\n        var id, name;\n        if (!o.blob || !o.base64) {\n          throw new Error('blob and base64 representations of the image are required for BlobInfo to be created');\n        }\n        id = o.id || Uuid.uuid('blobid');\n        name = o.name || id;\n        return {\n          id: constant(id),\n          name: constant(name),\n          filename: constant(name + '.' + mimeToExt(o.blob.type)),\n          blob: constant(o.blob),\n          base64: constant(o.base64),\n          blobUri: constant(o.blobUri || URL.createObjectURL(o.blob)),\n          uri: constant(o.uri)\n        };\n      };\n      var add = function (blobInfo) {\n        if (!get(blobInfo.id())) {\n          cache.push(blobInfo);\n        }\n      };\n      var get = function (id) {\n        return findFirst(function (cachedBlobInfo) {\n          return cachedBlobInfo.id() === id;\n        });\n      };\n      var findFirst = function (predicate) {\n        return filter(cache, predicate)[0];\n      };\n      var getByUri = function (blobUri) {\n        return findFirst(function (blobInfo) {\n          return blobInfo.blobUri() === blobUri;\n        });\n      };\n      var removeByUri = function (blobUri) {\n        cache = filter(cache, function (blobInfo) {\n          if (blobInfo.blobUri() === blobUri) {\n            URL.revokeObjectURL(blobInfo.blobUri());\n            return false;\n          }\n          return true;\n        });\n      };\n      var destroy = function () {\n        each(cache, function (cachedBlobInfo) {\n          URL.revokeObjectURL(cachedBlobInfo.blobUri());\n        });\n        cache = [];\n      };\n      return {\n        create: create,\n        add: add,\n        get: get,\n        getByUri: getByUri,\n        findFirst: findFirst,\n        removeByUri: removeByUri,\n        destroy: destroy\n      };\n    }\n\n    function UploadStatus () {\n      var PENDING = 1, UPLOADED = 2;\n      var blobUriStatuses = {};\n      var createStatus = function (status, resultUri) {\n        return {\n          status: status,\n          resultUri: resultUri\n        };\n      };\n      var hasBlobUri = function (blobUri) {\n        return blobUri in blobUriStatuses;\n      };\n      var getResultUri = function (blobUri) {\n        var result = blobUriStatuses[blobUri];\n        return result ? result.resultUri : null;\n      };\n      var isPending = function (blobUri) {\n        return hasBlobUri(blobUri) ? blobUriStatuses[blobUri].status === PENDING : false;\n      };\n      var isUploaded = function (blobUri) {\n        return hasBlobUri(blobUri) ? blobUriStatuses[blobUri].status === UPLOADED : false;\n      };\n      var markPending = function (blobUri) {\n        blobUriStatuses[blobUri] = createStatus(PENDING, null);\n      };\n      var markUploaded = function (blobUri, resultUri) {\n        blobUriStatuses[blobUri] = createStatus(UPLOADED, resultUri);\n      };\n      var removeFailed = function (blobUri) {\n        delete blobUriStatuses[blobUri];\n      };\n      var destroy = function () {\n        blobUriStatuses = {};\n      };\n      return {\n        hasBlobUri: hasBlobUri,\n        getResultUri: getResultUri,\n        isPending: isPending,\n        isUploaded: isUploaded,\n        markPending: markPending,\n        markUploaded: markUploaded,\n        removeFailed: removeFailed,\n        destroy: destroy\n      };\n    }\n\n    function EditorUpload (editor) {\n      var blobCache = BlobCache();\n      var uploader, imageScanner;\n      var uploadStatus = UploadStatus();\n      var urlFilters = [];\n      var aliveGuard = function (callback) {\n        return function (result) {\n          if (editor.selection) {\n            return callback(result);\n          }\n          return [];\n        };\n      };\n      var cacheInvalidator = function () {\n        return '?' + new Date().getTime();\n      };\n      var replaceString = function (content, search, replace) {\n        var index = 0;\n        do {\n          index = content.indexOf(search, index);\n          if (index !== -1) {\n            content = content.substring(0, index) + replace + content.substr(index + search.length);\n            index += replace.length - search.length + 1;\n          }\n        } while (index !== -1);\n        return content;\n      };\n      var replaceImageUrl = function (content, targetUrl, replacementUrl) {\n        content = replaceString(content, 'src=\"' + targetUrl + '\"', 'src=\"' + replacementUrl + '\"');\n        content = replaceString(content, 'data-mce-src=\"' + targetUrl + '\"', 'data-mce-src=\"' + replacementUrl + '\"');\n        return content;\n      };\n      var replaceUrlInUndoStack = function (targetUrl, replacementUrl) {\n        each(editor.undoManager.data, function (level) {\n          if (level.type === 'fragmented') {\n            level.fragments = map(level.fragments, function (fragment) {\n              return replaceImageUrl(fragment, targetUrl, replacementUrl);\n            });\n          } else {\n            level.content = replaceImageUrl(level.content, targetUrl, replacementUrl);\n          }\n        });\n      };\n      var openNotification = function () {\n        return editor.notificationManager.open({\n          text: editor.translate('Image uploading...'),\n          type: 'info',\n          timeout: -1,\n          progressBar: true\n        });\n      };\n      var replaceImageUri = function (image, resultUri) {\n        blobCache.removeByUri(image.src);\n        replaceUrlInUndoStack(image.src, resultUri);\n        editor.$(image).attr({\n          'src': Settings.shouldReuseFileName(editor) ? resultUri + cacheInvalidator() : resultUri,\n          'data-mce-src': editor.convertURL(resultUri, 'src')\n        });\n      };\n      var uploadImages = function (callback) {\n        if (!uploader) {\n          uploader = Uploader(uploadStatus, {\n            url: Settings.getImageUploadUrl(editor),\n            basePath: Settings.getImageUploadBasePath(editor),\n            credentials: Settings.getImagesUploadCredentials(editor),\n            handler: Settings.getImagesUploadHandler(editor)\n          });\n        }\n        return scanForImages().then(aliveGuard(function (imageInfos) {\n          var blobInfos;\n          blobInfos = map(imageInfos, function (imageInfo) {\n            return imageInfo.blobInfo;\n          });\n          return uploader.upload(blobInfos, openNotification).then(aliveGuard(function (result) {\n            var filteredResult = map(result, function (uploadInfo, index) {\n              var image = imageInfos[index].image;\n              if (uploadInfo.status && Settings.shouldReplaceBlobUris(editor)) {\n                replaceImageUri(image, uploadInfo.url);\n              } else if (uploadInfo.error) {\n                ErrorReporter.uploadError(editor, uploadInfo.error);\n              }\n              return {\n                element: image,\n                status: uploadInfo.status\n              };\n            });\n            if (callback) {\n              callback(filteredResult);\n            }\n            return filteredResult;\n          }));\n        }));\n      };\n      var uploadImagesAuto = function (callback) {\n        if (Settings.isAutomaticUploadsEnabled(editor)) {\n          return uploadImages(callback);\n        }\n      };\n      var isValidDataUriImage = function (imgElm) {\n        if (forall(urlFilters, function (filter) {\n            return filter(imgElm);\n          }) === false) {\n          return false;\n        }\n        if (imgElm.getAttribute('src').indexOf('data:') === 0) {\n          var dataImgFilter = Settings.getImagesDataImgFilter(editor);\n          return dataImgFilter(imgElm);\n        }\n        return true;\n      };\n      var addFilter = function (filter) {\n        urlFilters.push(filter);\n      };\n      var scanForImages = function () {\n        if (!imageScanner) {\n          imageScanner = ImageScanner(uploadStatus, blobCache);\n        }\n        return imageScanner.findAll(editor.getBody(), isValidDataUriImage).then(aliveGuard(function (result) {\n          result = filter(result, function (resultItem) {\n            if (typeof resultItem === 'string') {\n              ErrorReporter.displayError(editor, resultItem);\n              return false;\n            }\n            return true;\n          });\n          each(result, function (resultItem) {\n            replaceUrlInUndoStack(resultItem.image.src, resultItem.blobInfo.blobUri());\n            resultItem.image.src = resultItem.blobInfo.blobUri();\n            resultItem.image.removeAttribute('data-mce-src');\n          });\n          return result;\n        }));\n      };\n      var destroy = function () {\n        blobCache.destroy();\n        uploadStatus.destroy();\n        imageScanner = uploader = null;\n      };\n      var replaceBlobUris = function (content) {\n        return content.replace(/src=\"(blob:[^\"]+)\"/g, function (match, blobUri) {\n          var resultUri = uploadStatus.getResultUri(blobUri);\n          if (resultUri) {\n            return 'src=\"' + resultUri + '\"';\n          }\n          var blobInfo = blobCache.getByUri(blobUri);\n          if (!blobInfo) {\n            blobInfo = foldl(editor.editorManager.get(), function (result, editor) {\n              return result || editor.editorUpload && editor.editorUpload.blobCache.getByUri(blobUri);\n            }, null);\n          }\n          if (blobInfo) {\n            var blob = blobInfo.blob();\n            return 'src=\"data:' + blob.type + ';base64,' + blobInfo.base64() + '\"';\n          }\n          return match;\n        });\n      };\n      editor.on('setContent', function () {\n        if (Settings.isAutomaticUploadsEnabled(editor)) {\n          uploadImagesAuto();\n        } else {\n          scanForImages();\n        }\n      });\n      editor.on('RawSaveContent', function (e) {\n        e.content = replaceBlobUris(e.content);\n      });\n      editor.on('getContent', function (e) {\n        if (e.source_view || e.format === 'raw') {\n          return;\n        }\n        e.content = replaceBlobUris(e.content);\n      });\n      editor.on('PostRender', function () {\n        editor.parser.addNodeFilter('img', function (images) {\n          each(images, function (img) {\n            var src = img.attr('src');\n            if (blobCache.getByUri(src)) {\n              return;\n            }\n            var resultUri = uploadStatus.getResultUri(src);\n            if (resultUri) {\n              img.attr('src', resultUri);\n            }\n          });\n        });\n      });\n      return {\n        blobCache: blobCache,\n        addFilter: addFilter,\n        uploadImages: uploadImages,\n        uploadImagesAuto: uploadImagesAuto,\n        scanForImages: scanForImages,\n        destroy: destroy\n      };\n    }\n\n    var isBlockElement = function (blockElements, node) {\n      return blockElements.hasOwnProperty(node.nodeName);\n    };\n    var isValidTarget = function (blockElements, node) {\n      if (NodeType.isText(node)) {\n        return true;\n      } else if (NodeType.isElement(node)) {\n        return !isBlockElement(blockElements, node) && !Bookmarks.isBookmarkNode(node);\n      } else {\n        return false;\n      }\n    };\n    var hasBlockParent = function (blockElements, root, node) {\n      return exists(Parents.parents(Element.fromDom(node), Element.fromDom(root)), function (elm) {\n        return isBlockElement(blockElements, elm.dom());\n      });\n    };\n    var shouldRemoveTextNode = function (blockElements, node) {\n      if (NodeType.isText(node)) {\n        if (node.nodeValue.length === 0) {\n          return true;\n        } else if (/^\\s+$/.test(node.nodeValue) && (!node.nextSibling || isBlockElement(blockElements, node.nextSibling))) {\n          return true;\n        }\n      }\n      return false;\n    };\n    var addRootBlocks = function (editor) {\n      var settings = editor.settings, dom = editor.dom, selection = editor.selection;\n      var schema = editor.schema, blockElements = schema.getBlockElements();\n      var node = selection.getStart();\n      var rootNode = editor.getBody();\n      var rng;\n      var startContainer, startOffset, endContainer, endOffset, rootBlockNode;\n      var tempNode, wrapped, restoreSelection;\n      var rootNodeName, forcedRootBlock;\n      forcedRootBlock = settings.forced_root_block;\n      if (!node || !NodeType.isElement(node) || !forcedRootBlock) {\n        return;\n      }\n      rootNodeName = rootNode.nodeName.toLowerCase();\n      if (!schema.isValidChild(rootNodeName, forcedRootBlock.toLowerCase()) || hasBlockParent(blockElements, rootNode, node)) {\n        return;\n      }\n      rng = selection.getRng();\n      startContainer = rng.startContainer;\n      startOffset = rng.startOffset;\n      endContainer = rng.endContainer;\n      endOffset = rng.endOffset;\n      restoreSelection = EditorFocus.hasFocus(editor);\n      node = rootNode.firstChild;\n      while (node) {\n        if (isValidTarget(blockElements, node)) {\n          if (shouldRemoveTextNode(blockElements, node)) {\n            tempNode = node;\n            node = node.nextSibling;\n            dom.remove(tempNode);\n            continue;\n          }\n          if (!rootBlockNode) {\n            rootBlockNode = dom.create(forcedRootBlock, editor.settings.forced_root_block_attrs);\n            node.parentNode.insertBefore(rootBlockNode, node);\n            wrapped = true;\n          }\n          tempNode = node;\n          node = node.nextSibling;\n          rootBlockNode.appendChild(tempNode);\n        } else {\n          rootBlockNode = null;\n          node = node.nextSibling;\n        }\n      }\n      if (wrapped && restoreSelection) {\n        rng.setStart(startContainer, startOffset);\n        rng.setEnd(endContainer, endOffset);\n        selection.setRng(rng);\n        editor.nodeChanged();\n      }\n    };\n    var setup$3 = function (editor) {\n      if (editor.settings.forced_root_block) {\n        editor.on('NodeChange', curry(addRootBlocks, editor));\n      }\n    };\n    var ForceBlocks = { setup: setup$3 };\n\n    var getStartNode = function (rng) {\n      var sc = rng.startContainer, so = rng.startOffset;\n      if (NodeType.isText(sc)) {\n        return so === 0 ? Option.some(Element.fromDom(sc)) : Option.none();\n      } else {\n        return Option.from(sc.childNodes[so]).map(Element.fromDom);\n      }\n    };\n    var getEndNode = function (rng) {\n      var ec = rng.endContainer, eo = rng.endOffset;\n      if (NodeType.isText(ec)) {\n        return eo === ec.data.length ? Option.some(Element.fromDom(ec)) : Option.none();\n      } else {\n        return Option.from(ec.childNodes[eo - 1]).map(Element.fromDom);\n      }\n    };\n    var getFirstChildren = function (node) {\n      return firstChild(node).fold(constant([node]), function (child) {\n        return [node].concat(getFirstChildren(child));\n      });\n    };\n    var getLastChildren$1 = function (node) {\n      return lastChild(node).fold(constant([node]), function (child) {\n        if (name(child) === 'br') {\n          return prevSibling(child).map(function (sibling) {\n            return [node].concat(getLastChildren$1(sibling));\n          }).getOr([]);\n        } else {\n          return [node].concat(getLastChildren$1(child));\n        }\n      });\n    };\n    var hasAllContentsSelected = function (elm, rng) {\n      return lift2(getStartNode(rng), getEndNode(rng), function (startNode, endNode) {\n        var start = find(getFirstChildren(elm), curry(eq, startNode));\n        var end = find(getLastChildren$1(elm), curry(eq, endNode));\n        return start.isSome() && end.isSome();\n      }).getOr(false);\n    };\n    var moveEndPoint$1 = function (dom, rng, node, start) {\n      var root = node, walker = new TreeWalker(node, root);\n      var nonEmptyElementsMap = dom.schema.getNonEmptyElements();\n      do {\n        if (node.nodeType === 3 && Tools.trim(node.nodeValue).length !== 0) {\n          if (start) {\n            rng.setStart(node, 0);\n          } else {\n            rng.setEnd(node, node.nodeValue.length);\n          }\n          return;\n        }\n        if (nonEmptyElementsMap[node.nodeName] && !/^(TD|TH)$/.test(node.nodeName)) {\n          if (start) {\n            rng.setStartBefore(node);\n          } else {\n            if (node.nodeName === 'BR') {\n              rng.setEndBefore(node);\n            } else {\n              rng.setEndAfter(node);\n            }\n          }\n          return;\n        }\n        if (Env.ie && Env.ie < 11 && dom.isBlock(node) && dom.isEmpty(node)) {\n          if (start) {\n            rng.setStart(node, 0);\n          } else {\n            rng.setEnd(node, 0);\n          }\n          return;\n        }\n      } while (node = start ? walker.next() : walker.prev());\n      if (root.nodeName === 'BODY') {\n        if (start) {\n          rng.setStart(root, 0);\n        } else {\n          rng.setEnd(root, root.childNodes.length);\n        }\n      }\n    };\n    var hasAnyRanges = function (editor) {\n      var sel = editor.selection.getSel();\n      return sel && sel.rangeCount > 0;\n    };\n\n    function NodeChange (editor) {\n      var lastRng, lastPath = [];\n      var isSameElementPath = function (startElm) {\n        var i, currentPath;\n        currentPath = editor.$(startElm).parentsUntil(editor.getBody()).add(startElm);\n        if (currentPath.length === lastPath.length) {\n          for (i = currentPath.length; i >= 0; i--) {\n            if (currentPath[i] !== lastPath[i]) {\n              break;\n            }\n          }\n          if (i === -1) {\n            lastPath = currentPath;\n            return true;\n          }\n        }\n        lastPath = currentPath;\n        return false;\n      };\n      if (!('onselectionchange' in editor.getDoc())) {\n        editor.on('NodeChange Click MouseUp KeyUp Focus', function (e) {\n          var nativeRng, fakeRng;\n          nativeRng = editor.selection.getRng();\n          fakeRng = {\n            startContainer: nativeRng.startContainer,\n            startOffset: nativeRng.startOffset,\n            endContainer: nativeRng.endContainer,\n            endOffset: nativeRng.endOffset\n          };\n          if (e.type === 'nodechange' || !RangeCompare.isEq(fakeRng, lastRng)) {\n            editor.fire('SelectionChange');\n          }\n          lastRng = fakeRng;\n        });\n      }\n      editor.on('contextmenu', function () {\n        editor.fire('SelectionChange');\n      });\n      editor.on('SelectionChange', function () {\n        var startElm = editor.selection.getStart(true);\n        if (!startElm || !Env.range && editor.selection.isCollapsed()) {\n          return;\n        }\n        if (hasAnyRanges(editor) && !isSameElementPath(startElm) && editor.dom.isChildOf(startElm, editor.getBody())) {\n          editor.nodeChanged({ selectionChange: true });\n        }\n      });\n      editor.on('MouseUp', function (e) {\n        if (!e.isDefaultPrevented() && hasAnyRanges(editor)) {\n          if (editor.selection.getNode().nodeName === 'IMG') {\n            Delay.setEditorTimeout(editor, function () {\n              editor.nodeChanged();\n            });\n          } else {\n            editor.nodeChanged();\n          }\n        }\n      });\n      this.nodeChanged = function (args) {\n        var selection = editor.selection;\n        var node, parents, root;\n        if (editor.initialized && selection && !editor.settings.disable_nodechange && !editor.readonly) {\n          root = editor.getBody();\n          node = selection.getStart(true) || root;\n          if (node.ownerDocument !== editor.getDoc() || !editor.dom.isChildOf(node, root)) {\n            node = root;\n          }\n          parents = [];\n          editor.dom.getParent(node, function (node) {\n            if (node === root) {\n              return true;\n            }\n            parents.push(node);\n          });\n          args = args || {};\n          args.element = node;\n          args.parents = parents;\n          editor.fire('NodeChange', args);\n        }\n      };\n    }\n\n    var VK = {\n      BACKSPACE: 8,\n      DELETE: 46,\n      DOWN: 40,\n      ENTER: 13,\n      LEFT: 37,\n      RIGHT: 39,\n      SPACEBAR: 32,\n      TAB: 9,\n      UP: 38,\n      END: 35,\n      HOME: 36,\n      modifierPressed: function (e) {\n        return e.shiftKey || e.ctrlKey || e.altKey || this.metaKeyPressed(e);\n      },\n      metaKeyPressed: function (e) {\n        return Env.mac ? e.metaKey : e.ctrlKey && !e.altKey;\n      }\n    };\n\n    var getNodeClientRects = function (node) {\n      var toArrayWithNode = function (clientRects) {\n        return map(clientRects, function (clientRect) {\n          clientRect = clone$1(clientRect);\n          clientRect.node = node;\n          return clientRect;\n        });\n      };\n      if (NodeType.isElement(node)) {\n        return toArrayWithNode(node.getClientRects());\n      }\n      if (NodeType.isText(node)) {\n        var rng = node.ownerDocument.createRange();\n        rng.setStart(node, 0);\n        rng.setEnd(node, node.data.length);\n        return toArrayWithNode(rng.getClientRects());\n      }\n    };\n    var getClientRects = function (node) {\n      return foldl(node, function (result, node) {\n        return result.concat(getNodeClientRects(node));\n      }, []);\n    };\n\n    var VDirection;\n    (function (VDirection) {\n      VDirection[VDirection['Up'] = -1] = 'Up';\n      VDirection[VDirection['Down'] = 1] = 'Down';\n    }(VDirection || (VDirection = {})));\n    var findUntil = function (direction, root, predicateFn, node) {\n      while (node = findNode(node, direction, isEditableCaretCandidate, root)) {\n        if (predicateFn(node)) {\n          return;\n        }\n      }\n    };\n    var walkUntil = function (direction, isAboveFn, isBeflowFn, root, predicateFn, caretPosition) {\n      var line = 0, node;\n      var result = [];\n      var targetClientRect;\n      var add = function (node) {\n        var i, clientRect, clientRects;\n        clientRects = getClientRects([node]);\n        if (direction === -1) {\n          clientRects = clientRects.reverse();\n        }\n        for (i = 0; i < clientRects.length; i++) {\n          clientRect = clientRects[i];\n          if (isBeflowFn(clientRect, targetClientRect)) {\n            continue;\n          }\n          if (result.length > 0 && isAboveFn(clientRect, ArrUtils.last(result))) {\n            line++;\n          }\n          clientRect.line = line;\n          if (predicateFn(clientRect)) {\n            return true;\n          }\n          result.push(clientRect);\n        }\n      };\n      targetClientRect = ArrUtils.last(caretPosition.getClientRects());\n      if (!targetClientRect) {\n        return result;\n      }\n      node = caretPosition.getNode();\n      add(node);\n      findUntil(direction, root, add, node);\n      return result;\n    };\n    var aboveLineNumber = function (lineNumber, clientRect) {\n      return clientRect.line > lineNumber;\n    };\n    var isLineNumber = function (lineNumber, clientRect) {\n      return clientRect.line === lineNumber;\n    };\n    var upUntil = curry(walkUntil, VDirection.Up, isAbove, isBelow);\n    var downUntil = curry(walkUntil, VDirection.Down, isBelow, isAbove);\n    var positionsUntil = function (direction, root, predicateFn, node) {\n      var caretWalker = CaretWalker(root);\n      var walkFn, isBelowFn, isAboveFn, caretPosition;\n      var result = [];\n      var line = 0, clientRect, targetClientRect;\n      var getClientRect = function (caretPosition) {\n        if (direction === 1) {\n          return ArrUtils.last(caretPosition.getClientRects());\n        }\n        return ArrUtils.last(caretPosition.getClientRects());\n      };\n      if (direction === 1) {\n        walkFn = caretWalker.next;\n        isBelowFn = isBelow;\n        isAboveFn = isAbove;\n        caretPosition = CaretPosition$1.after(node);\n      } else {\n        walkFn = caretWalker.prev;\n        isBelowFn = isAbove;\n        isAboveFn = isBelow;\n        caretPosition = CaretPosition$1.before(node);\n      }\n      targetClientRect = getClientRect(caretPosition);\n      do {\n        if (!caretPosition.isVisible()) {\n          continue;\n        }\n        clientRect = getClientRect(caretPosition);\n        if (isAboveFn(clientRect, targetClientRect)) {\n          continue;\n        }\n        if (result.length > 0 && isBelowFn(clientRect, ArrUtils.last(result))) {\n          line++;\n        }\n        clientRect = clone$1(clientRect);\n        clientRect.position = caretPosition;\n        clientRect.line = line;\n        if (predicateFn(clientRect)) {\n          return result;\n        }\n        result.push(clientRect);\n      } while (caretPosition = walkFn(caretPosition));\n      return result;\n    };\n    var isAboveLine = function (lineNumber) {\n      return function (clientRect) {\n        return aboveLineNumber(lineNumber, clientRect);\n      };\n    };\n    var isLine = function (lineNumber) {\n      return function (clientRect) {\n        return isLineNumber(lineNumber, clientRect);\n      };\n    };\n\n    var isContentEditableFalse$7 = NodeType.isContentEditableFalse;\n    var findNode$1 = findNode;\n    var distanceToRectLeft = function (clientRect, clientX) {\n      return Math.abs(clientRect.left - clientX);\n    };\n    var distanceToRectRight = function (clientRect, clientX) {\n      return Math.abs(clientRect.right - clientX);\n    };\n    var isInside = function (clientX, clientRect) {\n      return clientX >= clientRect.left && clientX <= clientRect.right;\n    };\n    var findClosestClientRect = function (clientRects, clientX) {\n      return ArrUtils.reduce(clientRects, function (oldClientRect, clientRect) {\n        var oldDistance, newDistance;\n        oldDistance = Math.min(distanceToRectLeft(oldClientRect, clientX), distanceToRectRight(oldClientRect, clientX));\n        newDistance = Math.min(distanceToRectLeft(clientRect, clientX), distanceToRectRight(clientRect, clientX));\n        if (isInside(clientX, clientRect)) {\n          return clientRect;\n        }\n        if (isInside(clientX, oldClientRect)) {\n          return oldClientRect;\n        }\n        if (newDistance === oldDistance && isContentEditableFalse$7(clientRect.node)) {\n          return clientRect;\n        }\n        if (newDistance < oldDistance) {\n          return clientRect;\n        }\n        return oldClientRect;\n      });\n    };\n    var walkUntil$1 = function (direction, root, predicateFn, node) {\n      while (node = findNode$1(node, direction, isEditableCaretCandidate, root)) {\n        if (predicateFn(node)) {\n          return;\n        }\n      }\n    };\n    var findLineNodeRects = function (root, targetNodeRect) {\n      var clientRects = [];\n      var collect = function (checkPosFn, node) {\n        var lineRects;\n        lineRects = filter(getClientRects([node]), function (clientRect) {\n          return !checkPosFn(clientRect, targetNodeRect);\n        });\n        clientRects = clientRects.concat(lineRects);\n        return lineRects.length === 0;\n      };\n      clientRects.push(targetNodeRect);\n      walkUntil$1(VDirection.Up, root, curry(collect, isAbove), targetNodeRect.node);\n      walkUntil$1(VDirection.Down, root, curry(collect, isBelow), targetNodeRect.node);\n      return clientRects;\n    };\n    var getFakeCaretTargets = function (root) {\n      return filter(from$1(root.getElementsByTagName('*')), isFakeCaretTarget);\n    };\n    var caretInfo = function (clientRect, clientX) {\n      return {\n        node: clientRect.node,\n        before: distanceToRectLeft(clientRect, clientX) < distanceToRectRight(clientRect, clientX)\n      };\n    };\n    var closestCaret = function (root, clientX, clientY) {\n      var closestNodeRect;\n      var contentEditableFalseNodeRects = getClientRects(getFakeCaretTargets(root));\n      var targetNodeRects = filter(contentEditableFalseNodeRects, function (rect) {\n        return clientY >= rect.top && clientY <= rect.bottom;\n      });\n      closestNodeRect = findClosestClientRect(targetNodeRects, clientX);\n      if (closestNodeRect) {\n        closestNodeRect = findClosestClientRect(findLineNodeRects(root, closestNodeRect), clientX);\n        if (closestNodeRect && isFakeCaretTarget(closestNodeRect.node)) {\n          return caretInfo(closestNodeRect, clientX);\n        }\n      }\n      return null;\n    };\n\n    var isXYWithinRange = function (clientX, clientY, range) {\n      if (range.collapsed) {\n        return false;\n      }\n      if (Env.ie && Env.ie <= 11 && range.startOffset === range.endOffset - 1 && range.startContainer === range.endContainer) {\n        var elm = range.startContainer.childNodes[range.startOffset];\n        if (NodeType.isElement(elm)) {\n          return exists(elm.getClientRects(), function (rect) {\n            return containsXY(rect, clientX, clientY);\n          });\n        }\n      }\n      return exists(range.getClientRects(), function (rect) {\n        return containsXY(rect, clientX, clientY);\n      });\n    };\n    var RangePoint = { isXYWithinRange: isXYWithinRange };\n\n    var getAbsolutePosition = function (elm) {\n      var doc, docElem, win, clientRect;\n      clientRect = elm.getBoundingClientRect();\n      doc = elm.ownerDocument;\n      docElem = doc.documentElement;\n      win = doc.defaultView;\n      return {\n        top: clientRect.top + win.pageYOffset - docElem.clientTop,\n        left: clientRect.left + win.pageXOffset - docElem.clientLeft\n      };\n    };\n    var getBodyPosition = function (editor) {\n      return editor.inline ? getAbsolutePosition(editor.getBody()) : {\n        left: 0,\n        top: 0\n      };\n    };\n    var getScrollPosition = function (editor) {\n      var body = editor.getBody();\n      return editor.inline ? {\n        left: body.scrollLeft,\n        top: body.scrollTop\n      } : {\n        left: 0,\n        top: 0\n      };\n    };\n    var getBodyScroll = function (editor) {\n      var body = editor.getBody(), docElm = editor.getDoc().documentElement;\n      var inlineScroll = {\n        left: body.scrollLeft,\n        top: body.scrollTop\n      };\n      var iframeScroll = {\n        left: body.scrollLeft || docElm.scrollLeft,\n        top: body.scrollTop || docElm.scrollTop\n      };\n      return editor.inline ? inlineScroll : iframeScroll;\n    };\n    var getMousePosition = function (editor, event) {\n      if (event.target.ownerDocument !== editor.getDoc()) {\n        var iframePosition = getAbsolutePosition(editor.getContentAreaContainer());\n        var scrollPosition = getBodyScroll(editor);\n        return {\n          left: event.pageX - iframePosition.left + scrollPosition.left,\n          top: event.pageY - iframePosition.top + scrollPosition.top\n        };\n      }\n      return {\n        left: event.pageX,\n        top: event.pageY\n      };\n    };\n    var calculatePosition = function (bodyPosition, scrollPosition, mousePosition) {\n      return {\n        pageX: mousePosition.left - bodyPosition.left + scrollPosition.left,\n        pageY: mousePosition.top - bodyPosition.top + scrollPosition.top\n      };\n    };\n    var calc = function (editor, event) {\n      return calculatePosition(getBodyPosition(editor), getScrollPosition(editor), getMousePosition(editor, event));\n    };\n    var MousePosition = { calc: calc };\n\n    var isContentEditableFalse$8 = NodeType.isContentEditableFalse, isContentEditableTrue$3 = NodeType.isContentEditableTrue;\n    var isDraggable = function (rootElm, elm) {\n      return isContentEditableFalse$8(elm) && elm !== rootElm;\n    };\n    var isValidDropTarget = function (editor, targetElement, dragElement) {\n      if (targetElement === dragElement || editor.dom.isChildOf(targetElement, dragElement)) {\n        return false;\n      }\n      if (isContentEditableFalse$8(targetElement)) {\n        return false;\n      }\n      return true;\n    };\n    var cloneElement = function (elm) {\n      var cloneElm = elm.cloneNode(true);\n      cloneElm.removeAttribute('data-mce-selected');\n      return cloneElm;\n    };\n    var createGhost = function (editor, elm, width, height) {\n      var clonedElm = elm.cloneNode(true);\n      editor.dom.setStyles(clonedElm, {\n        width: width,\n        height: height\n      });\n      editor.dom.setAttrib(clonedElm, 'data-mce-selected', null);\n      var ghostElm = editor.dom.create('div', {\n        'class': 'mce-drag-container',\n        'data-mce-bogus': 'all',\n        'unselectable': 'on',\n        'contenteditable': 'false'\n      });\n      editor.dom.setStyles(ghostElm, {\n        position: 'absolute',\n        opacity: 0.5,\n        overflow: 'hidden',\n        border: 0,\n        padding: 0,\n        margin: 0,\n        width: width,\n        height: height\n      });\n      editor.dom.setStyles(clonedElm, {\n        margin: 0,\n        boxSizing: 'border-box'\n      });\n      ghostElm.appendChild(clonedElm);\n      return ghostElm;\n    };\n    var appendGhostToBody = function (ghostElm, bodyElm) {\n      if (ghostElm.parentNode !== bodyElm) {\n        bodyElm.appendChild(ghostElm);\n      }\n    };\n    var moveGhost = function (ghostElm, position, width, height, maxX, maxY) {\n      var overflowX = 0, overflowY = 0;\n      ghostElm.style.left = position.pageX + 'px';\n      ghostElm.style.top = position.pageY + 'px';\n      if (position.pageX + width > maxX) {\n        overflowX = position.pageX + width - maxX;\n      }\n      if (position.pageY + height > maxY) {\n        overflowY = position.pageY + height - maxY;\n      }\n      ghostElm.style.width = width - overflowX + 'px';\n      ghostElm.style.height = height - overflowY + 'px';\n    };\n    var removeElement = function (elm) {\n      if (elm && elm.parentNode) {\n        elm.parentNode.removeChild(elm);\n      }\n    };\n    var isLeftMouseButtonPressed = function (e) {\n      return e.button === 0;\n    };\n    var hasDraggableElement = function (state) {\n      return state.element;\n    };\n    var applyRelPos = function (state, position) {\n      return {\n        pageX: position.pageX - state.relX,\n        pageY: position.pageY + 5\n      };\n    };\n    var start$1 = function (state, editor) {\n      return function (e) {\n        if (isLeftMouseButtonPressed(e)) {\n          var ceElm = find(editor.dom.getParents(e.target), Predicate.or(isContentEditableFalse$8, isContentEditableTrue$3)).getOr(null);\n          if (isDraggable(editor.getBody(), ceElm)) {\n            var elmPos = editor.dom.getPos(ceElm);\n            var bodyElm = editor.getBody();\n            var docElm = editor.getDoc().documentElement;\n            state.element = ceElm;\n            state.screenX = e.screenX;\n            state.screenY = e.screenY;\n            state.maxX = (editor.inline ? bodyElm.scrollWidth : docElm.offsetWidth) - 2;\n            state.maxY = (editor.inline ? bodyElm.scrollHeight : docElm.offsetHeight) - 2;\n            state.relX = e.pageX - elmPos.x;\n            state.relY = e.pageY - elmPos.y;\n            state.width = ceElm.offsetWidth;\n            state.height = ceElm.offsetHeight;\n            state.ghost = createGhost(editor, ceElm, state.width, state.height);\n          }\n        }\n      };\n    };\n    var move$1 = function (state, editor) {\n      var throttledPlaceCaretAt = Delay.throttle(function (clientX, clientY) {\n        editor._selectionOverrides.hideFakeCaret();\n        editor.selection.placeCaretAt(clientX, clientY);\n      }, 0);\n      return function (e) {\n        var movement = Math.max(Math.abs(e.screenX - state.screenX), Math.abs(e.screenY - state.screenY));\n        if (hasDraggableElement(state) && !state.dragging && movement > 10) {\n          var args = editor.fire('dragstart', { target: state.element });\n          if (args.isDefaultPrevented()) {\n            return;\n          }\n          state.dragging = true;\n          editor.focus();\n        }\n        if (state.dragging) {\n          var targetPos = applyRelPos(state, MousePosition.calc(editor, e));\n          appendGhostToBody(state.ghost, editor.getBody());\n          moveGhost(state.ghost, targetPos, state.width, state.height, state.maxX, state.maxY);\n          throttledPlaceCaretAt(e.clientX, e.clientY);\n        }\n      };\n    };\n    var getRawTarget = function (selection) {\n      var rng = selection.getSel().getRangeAt(0);\n      var startContainer = rng.startContainer;\n      return startContainer.nodeType === 3 ? startContainer.parentNode : startContainer;\n    };\n    var drop = function (state, editor) {\n      return function (e) {\n        if (state.dragging) {\n          if (isValidDropTarget(editor, getRawTarget(editor.selection), state.element)) {\n            var targetClone_1 = cloneElement(state.element);\n            var args = editor.fire('drop', {\n              targetClone: targetClone_1,\n              clientX: e.clientX,\n              clientY: e.clientY\n            });\n            if (!args.isDefaultPrevented()) {\n              targetClone_1 = args.targetClone;\n              editor.undoManager.transact(function () {\n                removeElement(state.element);\n                editor.insertContent(editor.dom.getOuterHTML(targetClone_1));\n                editor._selectionOverrides.hideFakeCaret();\n              });\n            }\n          }\n        }\n        removeDragState(state);\n      };\n    };\n    var stop = function (state, editor) {\n      return function () {\n        if (state.dragging) {\n          editor.fire('dragend');\n        }\n        removeDragState(state);\n      };\n    };\n    var removeDragState = function (state) {\n      state.dragging = false;\n      state.element = null;\n      removeElement(state.ghost);\n    };\n    var bindFakeDragEvents = function (editor) {\n      var state = {};\n      var pageDom, dragStartHandler, dragHandler, dropHandler, dragEndHandler, rootDocument;\n      pageDom = DOMUtils$1.DOM;\n      rootDocument = domGlobals.document;\n      dragStartHandler = start$1(state, editor);\n      dragHandler = move$1(state, editor);\n      dropHandler = drop(state, editor);\n      dragEndHandler = stop(state, editor);\n      editor.on('mousedown', dragStartHandler);\n      editor.on('mousemove', dragHandler);\n      editor.on('mouseup', dropHandler);\n      pageDom.bind(rootDocument, 'mousemove', dragHandler);\n      pageDom.bind(rootDocument, 'mouseup', dragEndHandler);\n      editor.on('remove', function () {\n        pageDom.unbind(rootDocument, 'mousemove', dragHandler);\n        pageDom.unbind(rootDocument, 'mouseup', dragEndHandler);\n      });\n    };\n    var blockIeDrop = function (editor) {\n      editor.on('drop', function (e) {\n        var realTarget = typeof e.clientX !== 'undefined' ? editor.getDoc().elementFromPoint(e.clientX, e.clientY) : null;\n        if (isContentEditableFalse$8(realTarget) || isContentEditableFalse$8(editor.dom.getContentEditableParent(realTarget))) {\n          e.preventDefault();\n        }\n      });\n    };\n    var init = function (editor) {\n      bindFakeDragEvents(editor);\n      blockIeDrop(editor);\n    };\n    var DragDropOverrides = { init: init };\n\n    var setup$4 = function (editor) {\n      var renderFocusCaret = first(function () {\n        if (!editor.removed) {\n          var rng = editor.selection.getRng();\n          if (rng.collapsed) {\n            var caretRange = renderRangeCaret(editor, editor.selection.getRng(), false);\n            editor.selection.setRng(caretRange);\n          }\n        }\n      }, 0);\n      editor.on('focus', function () {\n        renderFocusCaret.throttle();\n      });\n      editor.on('blur', function () {\n        renderFocusCaret.cancel();\n      });\n    };\n    var CefFocus = { setup: setup$4 };\n\n    var isContentEditableTrue$4 = NodeType.isContentEditableTrue;\n    var isContentEditableFalse$9 = NodeType.isContentEditableFalse;\n    var getContentEditableRoot$1 = function (editor, node) {\n      var root = editor.getBody();\n      while (node && node !== root) {\n        if (isContentEditableTrue$4(node) || isContentEditableFalse$9(node)) {\n          return node;\n        }\n        node = node.parentNode;\n      }\n      return null;\n    };\n    var SelectionOverrides = function (editor) {\n      var isBlock = function (node) {\n        return editor.dom.isBlock(node);\n      };\n      var rootNode = editor.getBody();\n      var fakeCaret = FakeCaret(editor.getBody(), isBlock, function () {\n        return EditorFocus.hasFocus(editor);\n      });\n      var realSelectionId = 'sel-' + editor.dom.uniqueId();\n      var selectedContentEditableNode;\n      var isFakeSelectionElement = function (elm) {\n        return editor.dom.hasClass(elm, 'mce-offscreen-selection');\n      };\n      var getRealSelectionElement = function () {\n        var container = editor.dom.get(realSelectionId);\n        return container ? container.getElementsByTagName('*')[0] : container;\n      };\n      var setRange = function (range) {\n        if (range) {\n          editor.selection.setRng(range);\n        }\n      };\n      var getRange = function () {\n        return editor.selection.getRng();\n      };\n      var showCaret = function (direction, node, before, scrollIntoView) {\n        if (scrollIntoView === void 0) {\n          scrollIntoView = true;\n        }\n        var e;\n        e = editor.fire('ShowCaret', {\n          target: node,\n          direction: direction,\n          before: before\n        });\n        if (e.isDefaultPrevented()) {\n          return null;\n        }\n        if (scrollIntoView) {\n          editor.selection.scrollIntoView(node, direction === -1);\n        }\n        return fakeCaret.show(before, node);\n      };\n      var getNormalizedRangeEndPoint = function (direction, range) {\n        range = normalizeRange(direction, rootNode, range);\n        if (direction === -1) {\n          return CaretPosition$1.fromRangeStart(range);\n        }\n        return CaretPosition$1.fromRangeEnd(range);\n      };\n      var showBlockCaretContainer = function (blockCaretContainer) {\n        if (blockCaretContainer.hasAttribute('data-mce-caret')) {\n          showCaretContainerBlock(blockCaretContainer);\n          setRange(getRange());\n          editor.selection.scrollIntoView(blockCaretContainer[0]);\n        }\n      };\n      var registerEvents = function () {\n        editor.on('mouseup', function (e) {\n          var range = getRange();\n          if (range.collapsed && EditorView.isXYInContentArea(editor, e.clientX, e.clientY)) {\n            setRange(renderCaretAtRange(editor, range, false));\n          }\n        });\n        editor.on('click', function (e) {\n          var contentEditableRoot;\n          contentEditableRoot = getContentEditableRoot$1(editor, e.target);\n          if (contentEditableRoot) {\n            if (isContentEditableFalse$9(contentEditableRoot)) {\n              e.preventDefault();\n              editor.focus();\n            }\n            if (isContentEditableTrue$4(contentEditableRoot)) {\n              if (editor.dom.isChildOf(contentEditableRoot, editor.selection.getNode())) {\n                removeContentEditableSelection();\n              }\n            }\n          }\n        });\n        editor.on('blur NewBlock', function () {\n          removeContentEditableSelection();\n        });\n        editor.on('ResizeWindow FullscreenStateChanged', function () {\n          return fakeCaret.reposition();\n        });\n        var handleTouchSelect = function (editor) {\n          var moved = false;\n          editor.on('touchstart', function () {\n            moved = false;\n          });\n          editor.on('touchmove', function () {\n            moved = true;\n          });\n          editor.on('touchend', function (e) {\n            var contentEditableRoot = getContentEditableRoot$1(editor, e.target);\n            if (isContentEditableFalse$9(contentEditableRoot)) {\n              if (!moved) {\n                e.preventDefault();\n                setContentEditableSelection(selectNode(editor, contentEditableRoot));\n              }\n            }\n          });\n        };\n        var hasNormalCaretPosition = function (elm) {\n          var caretWalker = CaretWalker(elm);\n          if (!elm.firstChild) {\n            return false;\n          }\n          var startPos = CaretPosition$1.before(elm.firstChild);\n          var newPos = caretWalker.next(startPos);\n          return newPos && !isBeforeContentEditableFalse(newPos) && !isAfterContentEditableFalse(newPos);\n        };\n        var isInSameBlock = function (node1, node2) {\n          var block1 = editor.dom.getParent(node1, editor.dom.isBlock);\n          var block2 = editor.dom.getParent(node2, editor.dom.isBlock);\n          return block1 === block2;\n        };\n        var hasBetterMouseTarget = function (targetNode, caretNode) {\n          var targetBlock = editor.dom.getParent(targetNode, editor.dom.isBlock);\n          var caretBlock = editor.dom.getParent(caretNode, editor.dom.isBlock);\n          if (targetBlock && editor.dom.isChildOf(targetBlock, caretBlock) && isContentEditableFalse$9(getContentEditableRoot$1(editor, targetBlock)) === false) {\n            return true;\n          }\n          return targetBlock && !isInSameBlock(targetBlock, caretBlock) && hasNormalCaretPosition(targetBlock);\n        };\n        handleTouchSelect(editor);\n        editor.on('mousedown', function (e) {\n          var contentEditableRoot;\n          var targetElm = e.target;\n          if (targetElm !== rootNode && targetElm.nodeName !== 'HTML' && !editor.dom.isChildOf(targetElm, rootNode)) {\n            return;\n          }\n          if (EditorView.isXYInContentArea(editor, e.clientX, e.clientY) === false) {\n            return;\n          }\n          contentEditableRoot = getContentEditableRoot$1(editor, targetElm);\n          if (contentEditableRoot) {\n            if (isContentEditableFalse$9(contentEditableRoot)) {\n              e.preventDefault();\n              setContentEditableSelection(selectNode(editor, contentEditableRoot));\n            } else {\n              removeContentEditableSelection();\n              if (!(isContentEditableTrue$4(contentEditableRoot) && e.shiftKey) && !RangePoint.isXYWithinRange(e.clientX, e.clientY, editor.selection.getRng())) {\n                hideFakeCaret();\n                editor.selection.placeCaretAt(e.clientX, e.clientY);\n              }\n            }\n          } else if (isFakeCaretTarget(targetElm) === false) {\n            removeContentEditableSelection();\n            hideFakeCaret();\n            var caretInfo = closestCaret(rootNode, e.clientX, e.clientY);\n            if (caretInfo) {\n              if (!hasBetterMouseTarget(e.target, caretInfo.node)) {\n                e.preventDefault();\n                var range = showCaret(1, caretInfo.node, caretInfo.before, false);\n                editor.getBody().focus();\n                setRange(range);\n              }\n            }\n          }\n        });\n        editor.on('keypress', function (e) {\n          if (VK.modifierPressed(e)) {\n            return;\n          }\n          switch (e.keyCode) {\n          default:\n            if (isContentEditableFalse$9(editor.selection.getNode())) {\n              e.preventDefault();\n            }\n            break;\n          }\n        });\n        editor.on('getSelectionRange', function (e) {\n          var rng = e.range;\n          if (selectedContentEditableNode) {\n            if (!selectedContentEditableNode.parentNode) {\n              selectedContentEditableNode = null;\n              return;\n            }\n            rng = rng.cloneRange();\n            rng.selectNode(selectedContentEditableNode);\n            e.range = rng;\n          }\n        });\n        editor.on('setSelectionRange', function (e) {\n          e.range = normalizeShortEndedElementSelection(e.range);\n          var rng = setContentEditableSelection(e.range, e.forward);\n          if (rng) {\n            e.range = rng;\n          }\n        });\n        var isPasteBin = function (node) {\n          return node.id === 'mcepastebin';\n        };\n        editor.on('AfterSetSelectionRange', function (e) {\n          var rng = e.range;\n          if (!isRangeInCaretContainer(rng) && !isPasteBin(rng.startContainer.parentNode)) {\n            hideFakeCaret();\n          }\n          if (!isFakeSelectionElement(rng.startContainer.parentNode)) {\n            removeContentEditableSelection();\n          }\n        });\n        editor.on('copy', function (e) {\n          var clipboardData = e.clipboardData;\n          if (!e.isDefaultPrevented() && e.clipboardData && !Env.ie) {\n            var realSelectionElement = getRealSelectionElement();\n            if (realSelectionElement) {\n              e.preventDefault();\n              clipboardData.clearData();\n              clipboardData.setData('text/html', realSelectionElement.outerHTML);\n              clipboardData.setData('text/plain', realSelectionElement.outerText);\n            }\n          }\n        });\n        DragDropOverrides.init(editor);\n        CefFocus.setup(editor);\n      };\n      var addCss = function () {\n        var styles = editor.contentStyles, rootClass = '.mce-content-body';\n        styles.push(fakeCaret.getCss());\n        styles.push(rootClass + ' .mce-offscreen-selection {' + 'position: absolute;' + 'left: -9999999999px;' + 'max-width: 1000000px;' + '}' + rootClass + ' *[contentEditable=false] {' + 'cursor: default;' + '}' + rootClass + ' *[contentEditable=true] {' + 'cursor: text;' + '}');\n      };\n      var isWithinCaretContainer = function (node) {\n        return isCaretContainer(node) || startsWithCaretContainer(node) || endsWithCaretContainer(node);\n      };\n      var isRangeInCaretContainer = function (rng) {\n        return isWithinCaretContainer(rng.startContainer) || isWithinCaretContainer(rng.endContainer);\n      };\n      var normalizeShortEndedElementSelection = function (rng) {\n        var shortEndedElements = editor.schema.getShortEndedElements();\n        var newRng = editor.dom.createRng();\n        var startContainer = rng.startContainer;\n        var startOffset = rng.startOffset;\n        var endContainer = rng.endContainer;\n        var endOffset = rng.endOffset;\n        if (has(shortEndedElements, startContainer.nodeName.toLowerCase())) {\n          if (startOffset === 0) {\n            newRng.setStartBefore(startContainer);\n          } else {\n            newRng.setStartAfter(startContainer);\n          }\n        } else {\n          newRng.setStart(startContainer, startOffset);\n        }\n        if (has(shortEndedElements, endContainer.nodeName.toLowerCase())) {\n          if (endOffset === 0) {\n            newRng.setEndBefore(endContainer);\n          } else {\n            newRng.setEndAfter(endContainer);\n          }\n        } else {\n          newRng.setEnd(endContainer, endOffset);\n        }\n        return newRng;\n      };\n      var setContentEditableSelection = function (range, forward) {\n        var node;\n        var $ = editor.$;\n        var dom = editor.dom;\n        var $realSelectionContainer, sel, startContainer, startOffset, endOffset, e, caretPosition, targetClone, origTargetClone;\n        if (!range) {\n          return null;\n        }\n        if (range.collapsed) {\n          if (!isRangeInCaretContainer(range)) {\n            if (forward === false) {\n              caretPosition = getNormalizedRangeEndPoint(-1, range);\n              if (isFakeCaretTarget(caretPosition.getNode(true))) {\n                return showCaret(-1, caretPosition.getNode(true), false, false);\n              }\n              if (isFakeCaretTarget(caretPosition.getNode())) {\n                return showCaret(-1, caretPosition.getNode(), !caretPosition.isAtEnd(), false);\n              }\n            } else {\n              caretPosition = getNormalizedRangeEndPoint(1, range);\n              if (isFakeCaretTarget(caretPosition.getNode())) {\n                return showCaret(1, caretPosition.getNode(), !caretPosition.isAtEnd(), false);\n              }\n              if (isFakeCaretTarget(caretPosition.getNode(true))) {\n                return showCaret(1, caretPosition.getNode(true), false, false);\n              }\n            }\n          }\n          return null;\n        }\n        startContainer = range.startContainer;\n        startOffset = range.startOffset;\n        endOffset = range.endOffset;\n        if (startContainer.nodeType === 3 && startOffset === 0 && isContentEditableFalse$9(startContainer.parentNode)) {\n          startContainer = startContainer.parentNode;\n          startOffset = dom.nodeIndex(startContainer);\n          startContainer = startContainer.parentNode;\n        }\n        if (startContainer.nodeType !== 1) {\n          return null;\n        }\n        if (endOffset === startOffset + 1 && startContainer === range.endContainer) {\n          node = startContainer.childNodes[startOffset];\n        }\n        if (!isContentEditableFalse$9(node)) {\n          return null;\n        }\n        targetClone = origTargetClone = node.cloneNode(true);\n        e = editor.fire('ObjectSelected', {\n          target: node,\n          targetClone: targetClone\n        });\n        if (e.isDefaultPrevented()) {\n          return null;\n        }\n        $realSelectionContainer = descendant(Element.fromDom(editor.getBody()), '#' + realSelectionId).fold(function () {\n          return $([]);\n        }, function (elm) {\n          return $([elm.dom()]);\n        });\n        targetClone = e.targetClone;\n        if ($realSelectionContainer.length === 0) {\n          $realSelectionContainer = $('<div data-mce-bogus=\"all\" class=\"mce-offscreen-selection\"></div>').attr('id', realSelectionId);\n          $realSelectionContainer.appendTo(editor.getBody());\n        }\n        range = editor.dom.createRng();\n        if (targetClone === origTargetClone && Env.ie) {\n          $realSelectionContainer.empty().append('<p style=\"font-size: 0\" data-mce-bogus=\"all\">\\xA0</p>').append(targetClone);\n          range.setStartAfter($realSelectionContainer[0].firstChild.firstChild);\n          range.setEndAfter(targetClone);\n        } else {\n          $realSelectionContainer.empty().append('\\xA0').append(targetClone).append('\\xA0');\n          range.setStart($realSelectionContainer[0].firstChild, 1);\n          range.setEnd($realSelectionContainer[0].lastChild, 0);\n        }\n        $realSelectionContainer.css({ top: dom.getPos(node, editor.getBody()).y });\n        $realSelectionContainer[0].focus();\n        sel = editor.selection.getSel();\n        sel.removeAllRanges();\n        sel.addRange(range);\n        each(descendants$1(Element.fromDom(editor.getBody()), '*[data-mce-selected]'), function (elm) {\n          remove(elm, 'data-mce-selected');\n        });\n        node.setAttribute('data-mce-selected', '1');\n        selectedContentEditableNode = node;\n        hideFakeCaret();\n        return range;\n      };\n      var removeContentEditableSelection = function () {\n        if (selectedContentEditableNode) {\n          selectedContentEditableNode.removeAttribute('data-mce-selected');\n          descendant(Element.fromDom(editor.getBody()), '#' + realSelectionId).each(remove$1);\n          selectedContentEditableNode = null;\n        }\n        descendant(Element.fromDom(editor.getBody()), '#' + realSelectionId).each(remove$1);\n        selectedContentEditableNode = null;\n      };\n      var destroy = function () {\n        fakeCaret.destroy();\n        selectedContentEditableNode = null;\n      };\n      var hideFakeCaret = function () {\n        fakeCaret.hide();\n      };\n      if (Env.ceFalse) {\n        registerEvents();\n        addCss();\n      }\n      return {\n        showCaret: showCaret,\n        showBlockCaretContainer: showBlockCaretContainer,\n        hideFakeCaret: hideFakeCaret,\n        destroy: destroy\n      };\n    };\n\n    var isValidPrefixAttrName = function (name) {\n      return name.indexOf('data-') === 0 || name.indexOf('aria-') === 0;\n    };\n    var trimComments = function (text) {\n      var sanitizedText = text;\n      while (/<!--|--!?>/g.test(sanitizedText)) {\n        sanitizedText = sanitizedText.replace(/<!--|--!?>/g, '');\n      }\n      return sanitizedText;\n    };\n    var isInvalidUri = function (settings, uri) {\n      if (settings.allow_html_data_urls) {\n        return false;\n      } else if (/^data:image\\//i.test(uri)) {\n        return settings.allow_svg_data_urls === false && /^data:image\\/svg\\+xml/i.test(uri);\n      } else {\n        return /^data:/i.test(uri);\n      }\n    };\n    var findEndTagIndex = function (schema, html, startIndex) {\n      var count = 1, index, matches, tokenRegExp, shortEndedElements;\n      shortEndedElements = schema.getShortEndedElements();\n      tokenRegExp = /<([!?\\/])?([A-Za-z0-9\\-_\\:\\.]+)((?:\\s+[^\"\\'>]+(?:(?:\"[^\"]*\")|(?:\\'[^\\']*\\')|[^>]*))*|\\/|\\s+)>/g;\n      tokenRegExp.lastIndex = index = startIndex;\n      while (matches = tokenRegExp.exec(html)) {\n        index = tokenRegExp.lastIndex;\n        if (matches[1] === '/') {\n          count--;\n        } else if (!matches[1]) {\n          if (matches[2] in shortEndedElements) {\n            continue;\n          }\n          count++;\n        }\n        if (count === 0) {\n          break;\n        }\n      }\n      return index;\n    };\n    var checkBogusAttribute = function (regExp, attrString) {\n      var matches = regExp.exec(attrString);\n      if (matches) {\n        var name = matches[1];\n        var value = matches[2];\n        return typeof name === 'string' && name.toLowerCase() === 'data-mce-bogus' ? value : null;\n      } else {\n        return null;\n      }\n    };\n    function SaxParser(settings, schema) {\n      if (schema === void 0) {\n        schema = Schema();\n      }\n      var noop = function () {\n      };\n      settings = settings || {};\n      if (settings.fix_self_closing !== false) {\n        settings.fix_self_closing = true;\n      }\n      var comment = settings.comment ? settings.comment : noop;\n      var cdata = settings.cdata ? settings.cdata : noop;\n      var text = settings.text ? settings.text : noop;\n      var start = settings.start ? settings.start : noop;\n      var end = settings.end ? settings.end : noop;\n      var pi = settings.pi ? settings.pi : noop;\n      var doctype = settings.doctype ? settings.doctype : noop;\n      var parse = function (html) {\n        var matches, index = 0, value, endRegExp;\n        var stack = [];\n        var attrList, i, textData, name;\n        var isInternalElement, removeInternalElements, shortEndedElements, fillAttrsMap, isShortEnded;\n        var validate, elementRule, isValidElement, attr, attribsValue, validAttributesMap, validAttributePatterns;\n        var attributesRequired, attributesDefault, attributesForced, processHtml;\n        var anyAttributesRequired, selfClosing, tokenRegExp, attrRegExp, specialElements, attrValue, idCount = 0;\n        var decode = Entities.decode;\n        var fixSelfClosing;\n        var filteredUrlAttrs = Tools.makeMap('src,href,data,background,formaction,poster,xlink:href');\n        var scriptUriRegExp = /((java|vb)script|mhtml):/i;\n        var processEndTag = function (name) {\n          var pos, i;\n          pos = stack.length;\n          while (pos--) {\n            if (stack[pos].name === name) {\n              break;\n            }\n          }\n          if (pos >= 0) {\n            for (i = stack.length - 1; i >= pos; i--) {\n              name = stack[i];\n              if (name.valid) {\n                end(name.name);\n              }\n            }\n            stack.length = pos;\n          }\n        };\n        var parseAttribute = function (match, name, value, val2, val3) {\n          var attrRule, i;\n          var trimRegExp = /[\\s\\u0000-\\u001F]+/g;\n          name = name.toLowerCase();\n          value = name in fillAttrsMap ? name : decode(value || val2 || val3 || '');\n          if (validate && !isInternalElement && isValidPrefixAttrName(name) === false) {\n            attrRule = validAttributesMap[name];\n            if (!attrRule && validAttributePatterns) {\n              i = validAttributePatterns.length;\n              while (i--) {\n                attrRule = validAttributePatterns[i];\n                if (attrRule.pattern.test(name)) {\n                  break;\n                }\n              }\n              if (i === -1) {\n                attrRule = null;\n              }\n            }\n            if (!attrRule) {\n              return;\n            }\n            if (attrRule.validValues && !(value in attrRule.validValues)) {\n              return;\n            }\n          }\n          if (filteredUrlAttrs[name] && !settings.allow_script_urls) {\n            var uri = value.replace(trimRegExp, '');\n            try {\n              uri = decodeURIComponent(uri);\n            } catch (ex) {\n              uri = unescape(uri);\n            }\n            if (scriptUriRegExp.test(uri)) {\n              return;\n            }\n            if (isInvalidUri(settings, uri)) {\n              return;\n            }\n          }\n          if (isInternalElement && (name in filteredUrlAttrs || name.indexOf('on') === 0)) {\n            return;\n          }\n          attrList.map[name] = value;\n          attrList.push({\n            name: name,\n            value: value\n          });\n        };\n        tokenRegExp = new RegExp('<(?:' + '(?:!--([\\\\w\\\\W]*?)--!?>)|' + '(?:!\\\\[CDATA\\\\[([\\\\w\\\\W]*?)\\\\]\\\\]>)|' + '(?:!DOCTYPE([\\\\w\\\\W]*?)>)|' + '(?:\\\\?([^\\\\s\\\\/<>]+) ?([\\\\w\\\\W]*?)[?/]>)|' + '(?:\\\\/([A-Za-z][A-Za-z0-9\\\\-_\\\\:\\\\.]*)>)|' + '(?:([A-Za-z][A-Za-z0-9\\\\-_\\\\:\\\\.]*)((?:\\\\s+[^\"\\'>]+(?:(?:\"[^\"]*\")|(?:\\'[^\\']*\\')|[^>]*))*|\\\\/|\\\\s+)>)' + ')', 'g');\n        attrRegExp = /([\\w:\\-]+)(?:\\s*=\\s*(?:(?:\\\"((?:[^\\\"])*)\\\")|(?:\\'((?:[^\\'])*)\\')|([^>\\s]+)))?/g;\n        shortEndedElements = schema.getShortEndedElements();\n        selfClosing = settings.self_closing_elements || schema.getSelfClosingElements();\n        fillAttrsMap = schema.getBoolAttrs();\n        validate = settings.validate;\n        removeInternalElements = settings.remove_internals;\n        fixSelfClosing = settings.fix_self_closing;\n        specialElements = schema.getSpecialElements();\n        processHtml = html + '>';\n        while (matches = tokenRegExp.exec(processHtml)) {\n          if (index < matches.index) {\n            text(decode(html.substr(index, matches.index - index)));\n          }\n          if (value = matches[6]) {\n            value = value.toLowerCase();\n            if (value.charAt(0) === ':') {\n              value = value.substr(1);\n            }\n            processEndTag(value);\n          } else if (value = matches[7]) {\n            if (matches.index + matches[0].length > html.length) {\n              text(decode(html.substr(matches.index)));\n              index = matches.index + matches[0].length;\n              continue;\n            }\n            value = value.toLowerCase();\n            if (value.charAt(0) === ':') {\n              value = value.substr(1);\n            }\n            isShortEnded = value in shortEndedElements;\n            if (fixSelfClosing && selfClosing[value] && stack.length > 0 && stack[stack.length - 1].name === value) {\n              processEndTag(value);\n            }\n            var bogusValue = checkBogusAttribute(attrRegExp, matches[8]);\n            if (bogusValue !== null) {\n              if (bogusValue === 'all') {\n                index = findEndTagIndex(schema, html, tokenRegExp.lastIndex);\n                tokenRegExp.lastIndex = index;\n                continue;\n              }\n              isValidElement = false;\n            }\n            if (!validate || (elementRule = schema.getElementRule(value))) {\n              isValidElement = true;\n              if (validate) {\n                validAttributesMap = elementRule.attributes;\n                validAttributePatterns = elementRule.attributePatterns;\n              }\n              if (attribsValue = matches[8]) {\n                isInternalElement = attribsValue.indexOf('data-mce-type') !== -1;\n                if (isInternalElement && removeInternalElements) {\n                  isValidElement = false;\n                }\n                attrList = [];\n                attrList.map = {};\n                attribsValue.replace(attrRegExp, parseAttribute);\n              } else {\n                attrList = [];\n                attrList.map = {};\n              }\n              if (validate && !isInternalElement) {\n                attributesRequired = elementRule.attributesRequired;\n                attributesDefault = elementRule.attributesDefault;\n                attributesForced = elementRule.attributesForced;\n                anyAttributesRequired = elementRule.removeEmptyAttrs;\n                if (anyAttributesRequired && !attrList.length) {\n                  isValidElement = false;\n                }\n                if (attributesForced) {\n                  i = attributesForced.length;\n                  while (i--) {\n                    attr = attributesForced[i];\n                    name = attr.name;\n                    attrValue = attr.value;\n                    if (attrValue === '{$uid}') {\n                      attrValue = 'mce_' + idCount++;\n                    }\n                    attrList.map[name] = attrValue;\n                    attrList.push({\n                      name: name,\n                      value: attrValue\n                    });\n                  }\n                }\n                if (attributesDefault) {\n                  i = attributesDefault.length;\n                  while (i--) {\n                    attr = attributesDefault[i];\n                    name = attr.name;\n                    if (!(name in attrList.map)) {\n                      attrValue = attr.value;\n                      if (attrValue === '{$uid}') {\n                        attrValue = 'mce_' + idCount++;\n                      }\n                      attrList.map[name] = attrValue;\n                      attrList.push({\n                        name: name,\n                        value: attrValue\n                      });\n                    }\n                  }\n                }\n                if (attributesRequired) {\n                  i = attributesRequired.length;\n                  while (i--) {\n                    if (attributesRequired[i] in attrList.map) {\n                      break;\n                    }\n                  }\n                  if (i === -1) {\n                    isValidElement = false;\n                  }\n                }\n                if (attr = attrList.map['data-mce-bogus']) {\n                  if (attr === 'all') {\n                    index = findEndTagIndex(schema, html, tokenRegExp.lastIndex);\n                    tokenRegExp.lastIndex = index;\n                    continue;\n                  }\n                  isValidElement = false;\n                }\n              }\n              if (isValidElement) {\n                start(value, attrList, isShortEnded);\n              }\n            } else {\n              isValidElement = false;\n            }\n            if (endRegExp = specialElements[value]) {\n              endRegExp.lastIndex = index = matches.index + matches[0].length;\n              if (matches = endRegExp.exec(html)) {\n                if (isValidElement) {\n                  textData = html.substr(index, matches.index - index);\n                }\n                index = matches.index + matches[0].length;\n              } else {\n                textData = html.substr(index);\n                index = html.length;\n              }\n              if (isValidElement) {\n                if (textData.length > 0) {\n                  text(textData, true);\n                }\n                end(value);\n              }\n              tokenRegExp.lastIndex = index;\n              continue;\n            }\n            if (!isShortEnded) {\n              if (!attribsValue || attribsValue.indexOf('/') !== attribsValue.length - 1) {\n                stack.push({\n                  name: value,\n                  valid: isValidElement\n                });\n              } else if (isValidElement) {\n                end(value);\n              }\n            }\n          } else if (value = matches[1]) {\n            if (value.charAt(0) === '>') {\n              value = ' ' + value;\n            }\n            if (!settings.allow_conditional_comments && value.substr(0, 3).toLowerCase() === '[if') {\n              value = ' ' + value;\n            }\n            comment(value);\n          } else if (value = matches[2]) {\n            cdata(trimComments(value));\n          } else if (value = matches[3]) {\n            doctype(value);\n          } else if (value = matches[4]) {\n            pi(value, matches[5]);\n          }\n          index = matches.index + matches[0].length;\n        }\n        if (index < html.length) {\n          text(decode(html.substr(index)));\n        }\n        for (i = stack.length - 1; i >= 0; i--) {\n          value = stack[i];\n          if (value.valid) {\n            end(value.name);\n          }\n        }\n      };\n      return { parse: parse };\n    }\n    (function (SaxParser) {\n      SaxParser.findEndTag = findEndTagIndex;\n    }(SaxParser || (SaxParser = {})));\n    var SaxParser$1 = SaxParser;\n\n    var trimHtml = function (tempAttrs, html) {\n      var trimContentRegExp = new RegExp(['\\\\s?(' + tempAttrs.join('|') + ')=\"[^\"]+\"'].join('|'), 'gi');\n      return html.replace(trimContentRegExp, '');\n    };\n    var trimInternal = function (serializer, html) {\n      var content = html;\n      var bogusAllRegExp = /<(\\w+) [^>]*data-mce-bogus=\"all\"[^>]*>/g;\n      var endTagIndex, index, matchLength, matches, shortEndedElements;\n      var schema = serializer.schema;\n      content = trimHtml(serializer.getTempAttrs(), content);\n      shortEndedElements = schema.getShortEndedElements();\n      while (matches = bogusAllRegExp.exec(content)) {\n        index = bogusAllRegExp.lastIndex;\n        matchLength = matches[0].length;\n        if (shortEndedElements[matches[1]]) {\n          endTagIndex = index;\n        } else {\n          endTagIndex = SaxParser$1.findEndTag(schema, content, index);\n        }\n        content = content.substring(0, index - matchLength) + content.substring(endTagIndex);\n        bogusAllRegExp.lastIndex = index - matchLength;\n      }\n      return Zwsp.trim(content);\n    };\n    var trimExternal = trimInternal;\n    var TrimHtml = {\n      trimExternal: trimExternal,\n      trimInternal: trimInternal\n    };\n\n    var KEEP = 0, INSERT = 1, DELETE = 2;\n    var diff = function (left, right) {\n      var size = left.length + right.length + 2;\n      var vDown = new Array(size);\n      var vUp = new Array(size);\n      var snake = function (start, end, diag) {\n        return {\n          start: start,\n          end: end,\n          diag: diag\n        };\n      };\n      var buildScript = function (start1, end1, start2, end2, script) {\n        var middle = getMiddleSnake(start1, end1, start2, end2);\n        if (middle === null || middle.start === end1 && middle.diag === end1 - end2 || middle.end === start1 && middle.diag === start1 - start2) {\n          var i = start1;\n          var j = start2;\n          while (i < end1 || j < end2) {\n            if (i < end1 && j < end2 && left[i] === right[j]) {\n              script.push([\n                KEEP,\n                left[i]\n              ]);\n              ++i;\n              ++j;\n            } else {\n              if (end1 - start1 > end2 - start2) {\n                script.push([\n                  DELETE,\n                  left[i]\n                ]);\n                ++i;\n              } else {\n                script.push([\n                  INSERT,\n                  right[j]\n                ]);\n                ++j;\n              }\n            }\n          }\n        } else {\n          buildScript(start1, middle.start, start2, middle.start - middle.diag, script);\n          for (var i2 = middle.start; i2 < middle.end; ++i2) {\n            script.push([\n              KEEP,\n              left[i2]\n            ]);\n          }\n          buildScript(middle.end, end1, middle.end - middle.diag, end2, script);\n        }\n      };\n      var buildSnake = function (start, diag, end1, end2) {\n        var end = start;\n        while (end - diag < end2 && end < end1 && left[end] === right[end - diag]) {\n          ++end;\n        }\n        return snake(start, end, diag);\n      };\n      var getMiddleSnake = function (start1, end1, start2, end2) {\n        var m = end1 - start1;\n        var n = end2 - start2;\n        if (m === 0 || n === 0) {\n          return null;\n        }\n        var delta = m - n;\n        var sum = n + m;\n        var offset = (sum % 2 === 0 ? sum : sum + 1) / 2;\n        vDown[1 + offset] = start1;\n        vUp[1 + offset] = end1 + 1;\n        var d, k, i, x, y;\n        for (d = 0; d <= offset; ++d) {\n          for (k = -d; k <= d; k += 2) {\n            i = k + offset;\n            if (k === -d || k !== d && vDown[i - 1] < vDown[i + 1]) {\n              vDown[i] = vDown[i + 1];\n            } else {\n              vDown[i] = vDown[i - 1] + 1;\n            }\n            x = vDown[i];\n            y = x - start1 + start2 - k;\n            while (x < end1 && y < end2 && left[x] === right[y]) {\n              vDown[i] = ++x;\n              ++y;\n            }\n            if (delta % 2 !== 0 && delta - d <= k && k <= delta + d) {\n              if (vUp[i - delta] <= vDown[i]) {\n                return buildSnake(vUp[i - delta], k + start1 - start2, end1, end2);\n              }\n            }\n          }\n          for (k = delta - d; k <= delta + d; k += 2) {\n            i = k + offset - delta;\n            if (k === delta - d || k !== delta + d && vUp[i + 1] <= vUp[i - 1]) {\n              vUp[i] = vUp[i + 1] - 1;\n            } else {\n              vUp[i] = vUp[i - 1];\n            }\n            x = vUp[i] - 1;\n            y = x - start1 + start2 - k;\n            while (x >= start1 && y >= start2 && left[x] === right[y]) {\n              vUp[i] = x--;\n              y--;\n            }\n            if (delta % 2 === 0 && -d <= k && k <= d) {\n              if (vUp[i] <= vDown[i + delta]) {\n                return buildSnake(vUp[i], k + start1 - start2, end1, end2);\n              }\n            }\n          }\n        }\n      };\n      var script = [];\n      buildScript(0, left.length, 0, right.length, script);\n      return script;\n    };\n    var Diff = {\n      KEEP: KEEP,\n      DELETE: DELETE,\n      INSERT: INSERT,\n      diff: diff\n    };\n\n    var getOuterHtml = function (elm) {\n      if (NodeType.isElement(elm)) {\n        return elm.outerHTML;\n      } else if (NodeType.isText(elm)) {\n        return Entities.encodeRaw(elm.data, false);\n      } else if (NodeType.isComment(elm)) {\n        return '<!--' + elm.data + '-->';\n      }\n      return '';\n    };\n    var createFragment$1 = function (html) {\n      var frag, node, container;\n      container = domGlobals.document.createElement('div');\n      frag = domGlobals.document.createDocumentFragment();\n      if (html) {\n        container.innerHTML = html;\n      }\n      while (node = container.firstChild) {\n        frag.appendChild(node);\n      }\n      return frag;\n    };\n    var insertAt = function (elm, html, index) {\n      var fragment = createFragment$1(html);\n      if (elm.hasChildNodes() && index < elm.childNodes.length) {\n        var target = elm.childNodes[index];\n        target.parentNode.insertBefore(fragment, target);\n      } else {\n        elm.appendChild(fragment);\n      }\n    };\n    var removeAt = function (elm, index) {\n      if (elm.hasChildNodes() && index < elm.childNodes.length) {\n        var target = elm.childNodes[index];\n        target.parentNode.removeChild(target);\n      }\n    };\n    var applyDiff = function (diff, elm) {\n      var index = 0;\n      each(diff, function (action) {\n        if (action[0] === Diff.KEEP) {\n          index++;\n        } else if (action[0] === Diff.INSERT) {\n          insertAt(elm, action[1], index);\n          index++;\n        } else if (action[0] === Diff.DELETE) {\n          removeAt(elm, index);\n        }\n      });\n    };\n    var read$3 = function (elm) {\n      return filter(map(from$1(elm.childNodes), getOuterHtml), function (item) {\n        return item.length > 0;\n      });\n    };\n    var write = function (fragments, elm) {\n      var currentFragments = map(from$1(elm.childNodes), getOuterHtml);\n      applyDiff(Diff.diff(currentFragments, fragments), elm);\n      return elm;\n    };\n    var Fragments = {\n      read: read$3,\n      write: write\n    };\n\n    var undoLevelDocument = Cell(Option.none());\n    var lazyTempDocument = function () {\n      return undoLevelDocument.get().getOrThunk(function () {\n        var doc = domGlobals.document.implementation.createHTMLDocument('undo');\n        undoLevelDocument.set(Option.some(doc));\n        return doc;\n      });\n    };\n    var hasIframes = function (html) {\n      return html.indexOf('</iframe>') !== -1;\n    };\n    var createFragmentedLevel = function (fragments) {\n      return {\n        type: 'fragmented',\n        fragments: fragments,\n        content: '',\n        bookmark: null,\n        beforeBookmark: null\n      };\n    };\n    var createCompleteLevel = function (content) {\n      return {\n        type: 'complete',\n        fragments: null,\n        content: content,\n        bookmark: null,\n        beforeBookmark: null\n      };\n    };\n    var createFromEditor = function (editor) {\n      var fragments, content, trimmedFragments;\n      fragments = Fragments.read(editor.getBody());\n      trimmedFragments = bind(fragments, function (html) {\n        var trimmed = TrimHtml.trimInternal(editor.serializer, html);\n        return trimmed.length > 0 ? [trimmed] : [];\n      });\n      content = trimmedFragments.join('');\n      return hasIframes(content) ? createFragmentedLevel(trimmedFragments) : createCompleteLevel(content);\n    };\n    var applyToEditor = function (editor, level, before) {\n      if (level.type === 'fragmented') {\n        Fragments.write(level.fragments, editor.getBody());\n      } else {\n        editor.setContent(level.content, { format: 'raw' });\n      }\n      editor.selection.moveToBookmark(before ? level.beforeBookmark : level.bookmark);\n    };\n    var getLevelContent = function (level) {\n      return level.type === 'fragmented' ? level.fragments.join('') : level.content;\n    };\n    var getCleanLevelContent = function (level) {\n      var elm = Element.fromTag('body', lazyTempDocument());\n      set$1(elm, getLevelContent(level));\n      each(descendants$1(elm, '*[data-mce-bogus]'), unwrap);\n      return get$3(elm);\n    };\n    var hasEqualContent = function (level1, level2) {\n      return getLevelContent(level1) === getLevelContent(level2);\n    };\n    var hasEqualCleanedContent = function (level1, level2) {\n      return getCleanLevelContent(level1) === getCleanLevelContent(level2);\n    };\n    var isEq$4 = function (level1, level2) {\n      if (!level1 || !level2) {\n        return false;\n      } else if (hasEqualContent(level1, level2)) {\n        return true;\n      } else {\n        return hasEqualCleanedContent(level1, level2);\n      }\n    };\n    var Levels = {\n      createFragmentedLevel: createFragmentedLevel,\n      createCompleteLevel: createCompleteLevel,\n      createFromEditor: createFromEditor,\n      applyToEditor: applyToEditor,\n      isEq: isEq$4\n    };\n\n    function UndoManager (editor) {\n      var self = this, index = 0, data = [], beforeBookmark, isFirstTypedCharacter, locks = 0;\n      var isUnlocked = function () {\n        return locks === 0;\n      };\n      var setTyping = function (typing) {\n        if (isUnlocked()) {\n          self.typing = typing;\n        }\n      };\n      var setDirty = function (state) {\n        editor.setDirty(state);\n      };\n      var addNonTypingUndoLevel = function (e) {\n        setTyping(false);\n        self.add({}, e);\n      };\n      var endTyping = function () {\n        if (self.typing) {\n          setTyping(false);\n          self.add();\n        }\n      };\n      editor.on('init', function () {\n        self.add();\n      });\n      editor.on('BeforeExecCommand', function (e) {\n        var cmd = e.command;\n        if (cmd !== 'Undo' && cmd !== 'Redo' && cmd !== 'mceRepaint') {\n          endTyping();\n          self.beforeChange();\n        }\n      });\n      editor.on('ExecCommand', function (e) {\n        var cmd = e.command;\n        if (cmd !== 'Undo' && cmd !== 'Redo' && cmd !== 'mceRepaint') {\n          addNonTypingUndoLevel(e);\n        }\n      });\n      editor.on('ObjectResizeStart Cut', function () {\n        self.beforeChange();\n      });\n      editor.on('SaveContent ObjectResized blur', addNonTypingUndoLevel);\n      editor.on('DragEnd', addNonTypingUndoLevel);\n      editor.on('KeyUp', function (e) {\n        var keyCode = e.keyCode;\n        if (e.isDefaultPrevented()) {\n          return;\n        }\n        if (keyCode >= 33 && keyCode <= 36 || keyCode >= 37 && keyCode <= 40 || keyCode === 45 || e.ctrlKey) {\n          addNonTypingUndoLevel();\n          editor.nodeChanged();\n        }\n        if (keyCode === 46 || keyCode === 8) {\n          editor.nodeChanged();\n        }\n        if (isFirstTypedCharacter && self.typing && Levels.isEq(Levels.createFromEditor(editor), data[0]) === false) {\n          if (editor.isDirty() === false) {\n            setDirty(true);\n            editor.fire('change', {\n              level: data[0],\n              lastLevel: null\n            });\n          }\n          editor.fire('TypingUndo');\n          isFirstTypedCharacter = false;\n          editor.nodeChanged();\n        }\n      });\n      editor.on('KeyDown', function (e) {\n        var keyCode = e.keyCode;\n        if (e.isDefaultPrevented()) {\n          return;\n        }\n        if (keyCode >= 33 && keyCode <= 36 || keyCode >= 37 && keyCode <= 40 || keyCode === 45) {\n          if (self.typing) {\n            addNonTypingUndoLevel(e);\n          }\n          return;\n        }\n        var modKey = e.ctrlKey && !e.altKey || e.metaKey;\n        if ((keyCode < 16 || keyCode > 20) && keyCode !== 224 && keyCode !== 91 && !self.typing && !modKey) {\n          self.beforeChange();\n          setTyping(true);\n          self.add({}, e);\n          isFirstTypedCharacter = true;\n        }\n      });\n      editor.on('MouseDown', function (e) {\n        if (self.typing) {\n          addNonTypingUndoLevel(e);\n        }\n      });\n      var isInsertReplacementText = function (event) {\n        return event.inputType === 'insertReplacementText';\n      };\n      var isInsertTextDataNull = function (event) {\n        return event.inputType === 'insertText' && event.data === null;\n      };\n      editor.on('input', function (e) {\n        if (e.inputType && (isInsertReplacementText(e) || isInsertTextDataNull(e))) {\n          addNonTypingUndoLevel(e);\n        }\n      });\n      editor.addShortcut('meta+z', '', 'Undo');\n      editor.addShortcut('meta+y,meta+shift+z', '', 'Redo');\n      editor.on('AddUndo Undo Redo ClearUndos', function (e) {\n        if (!e.isDefaultPrevented()) {\n          editor.nodeChanged();\n        }\n      });\n      self = {\n        data: data,\n        typing: false,\n        beforeChange: function () {\n          if (isUnlocked()) {\n            beforeBookmark = GetBookmark.getUndoBookmark(editor.selection);\n          }\n        },\n        add: function (level, event) {\n          var i;\n          var settings = editor.settings;\n          var lastLevel, currentLevel;\n          currentLevel = Levels.createFromEditor(editor);\n          level = level || {};\n          level = Tools.extend(level, currentLevel);\n          if (isUnlocked() === false || editor.removed) {\n            return null;\n          }\n          lastLevel = data[index];\n          if (editor.fire('BeforeAddUndo', {\n              level: level,\n              lastLevel: lastLevel,\n              originalEvent: event\n            }).isDefaultPrevented()) {\n            return null;\n          }\n          if (lastLevel && Levels.isEq(lastLevel, level)) {\n            return null;\n          }\n          if (data[index]) {\n            data[index].beforeBookmark = beforeBookmark;\n          }\n          if (settings.custom_undo_redo_levels) {\n            if (data.length > settings.custom_undo_redo_levels) {\n              for (i = 0; i < data.length - 1; i++) {\n                data[i] = data[i + 1];\n              }\n              data.length--;\n              index = data.length;\n            }\n          }\n          level.bookmark = GetBookmark.getUndoBookmark(editor.selection);\n          if (index < data.length - 1) {\n            data.length = index + 1;\n          }\n          data.push(level);\n          index = data.length - 1;\n          var args = {\n            level: level,\n            lastLevel: lastLevel,\n            originalEvent: event\n          };\n          editor.fire('AddUndo', args);\n          if (index > 0) {\n            setDirty(true);\n            editor.fire('change', args);\n          }\n          return level;\n        },\n        undo: function () {\n          var level;\n          if (self.typing) {\n            self.add();\n            self.typing = false;\n            setTyping(false);\n          }\n          if (index > 0) {\n            level = data[--index];\n            Levels.applyToEditor(editor, level, true);\n            setDirty(true);\n            editor.fire('undo', { level: level });\n          }\n          return level;\n        },\n        redo: function () {\n          var level;\n          if (index < data.length - 1) {\n            level = data[++index];\n            Levels.applyToEditor(editor, level, false);\n            setDirty(true);\n            editor.fire('redo', { level: level });\n          }\n          return level;\n        },\n        clear: function () {\n          data = [];\n          index = 0;\n          self.typing = false;\n          self.data = data;\n          editor.fire('ClearUndos');\n        },\n        hasUndo: function () {\n          return index > 0 || self.typing && data[0] && !Levels.isEq(Levels.createFromEditor(editor), data[0]);\n        },\n        hasRedo: function () {\n          return index < data.length - 1 && !self.typing;\n        },\n        transact: function (callback) {\n          endTyping();\n          self.beforeChange();\n          self.ignore(callback);\n          return self.add();\n        },\n        ignore: function (callback) {\n          try {\n            locks++;\n            callback();\n          } finally {\n            locks--;\n          }\n        },\n        extra: function (callback1, callback2) {\n          var lastLevel, bookmark;\n          if (self.transact(callback1)) {\n            bookmark = data[index].bookmark;\n            lastLevel = data[index - 1];\n            Levels.applyToEditor(editor, lastLevel, true);\n            if (self.transact(callback2)) {\n              data[index - 1].beforeBookmark = bookmark;\n            }\n          }\n        }\n      };\n      return self;\n    }\n\n    var postProcessHooks = {}, filter$2 = ArrUtils.filter, each$c = ArrUtils.each;\n    var addPostProcessHook = function (name, hook) {\n      var hooks = postProcessHooks[name];\n      if (!hooks) {\n        postProcessHooks[name] = hooks = [];\n      }\n      postProcessHooks[name].push(hook);\n    };\n    var postProcess = function (name, editor) {\n      each$c(postProcessHooks[name], function (hook) {\n        hook(editor);\n      });\n    };\n    addPostProcessHook('pre', function (editor) {\n      var rng = editor.selection.getRng();\n      var isPre, blocks;\n      var hasPreSibling = function (pre) {\n        return isPre(pre.previousSibling) && ArrUtils.indexOf(blocks, pre.previousSibling) !== -1;\n      };\n      var joinPre = function (pre1, pre2) {\n        DomQuery(pre2).remove();\n        DomQuery(pre1).append('<br><br>').append(pre2.childNodes);\n      };\n      isPre = NodeType.matchNodeNames('pre');\n      if (!rng.collapsed) {\n        blocks = editor.selection.getSelectedBlocks();\n        each$c(filter$2(filter$2(blocks, isPre), hasPreSibling), function (pre) {\n          joinPre(pre.previousSibling, pre);\n        });\n      }\n    });\n    var Hooks = { postProcess: postProcess };\n\n    var MCE_ATTR_RE = /^(src|href|style)$/;\n    var each$d = Tools.each;\n    var isEq$5 = FormatUtils.isEq;\n    var isTableCell$4 = function (node) {\n      return /^(TH|TD)$/.test(node.nodeName);\n    };\n    var isChildOfInlineParent = function (dom, node, parent) {\n      return dom.isChildOf(node, parent) && node !== parent && !dom.isBlock(parent);\n    };\n    var getContainer = function (ed, rng, start) {\n      var container, offset, lastIdx;\n      container = rng[start ? 'startContainer' : 'endContainer'];\n      offset = rng[start ? 'startOffset' : 'endOffset'];\n      if (NodeType.isElement(container)) {\n        lastIdx = container.childNodes.length - 1;\n        if (!start && offset) {\n          offset--;\n        }\n        container = container.childNodes[offset > lastIdx ? lastIdx : offset];\n      }\n      if (NodeType.isText(container) && start && offset >= container.nodeValue.length) {\n        container = new TreeWalker(container, ed.getBody()).next() || container;\n      }\n      if (NodeType.isText(container) && !start && offset === 0) {\n        container = new TreeWalker(container, ed.getBody()).prev() || container;\n      }\n      return container;\n    };\n    var wrap$2 = function (dom, node, name, attrs) {\n      var wrapper = dom.create(name, attrs);\n      node.parentNode.insertBefore(wrapper, node);\n      wrapper.appendChild(node);\n      return wrapper;\n    };\n    var wrapWithSiblings = function (dom, node, next, name, attrs) {\n      var start = Element.fromDom(node);\n      var wrapper = Element.fromDom(dom.create(name, attrs));\n      var siblings = next ? nextSiblings(start) : prevSiblings(start);\n      append$1(wrapper, siblings);\n      if (next) {\n        before(start, wrapper);\n        prepend(wrapper, start);\n      } else {\n        after(start, wrapper);\n        append(wrapper, start);\n      }\n      return wrapper.dom();\n    };\n    var matchName$1 = function (dom, node, format) {\n      if (isEq$5(node, format.inline)) {\n        return true;\n      }\n      if (isEq$5(node, format.block)) {\n        return true;\n      }\n      if (format.selector) {\n        return NodeType.isElement(node) && dom.is(node, format.selector);\n      }\n    };\n    var isColorFormatAndAnchor = function (node, format) {\n      return format.links && node.tagName === 'A';\n    };\n    var find$3 = function (dom, node, next, inc) {\n      node = FormatUtils.getNonWhiteSpaceSibling(node, next, inc);\n      return !node || (node.nodeName === 'BR' || dom.isBlock(node));\n    };\n    var removeNode$1 = function (ed, node, format) {\n      var parentNode = node.parentNode;\n      var rootBlockElm;\n      var dom = ed.dom, forcedRootBlock = ed.settings.forced_root_block;\n      if (format.block) {\n        if (!forcedRootBlock) {\n          if (dom.isBlock(node) && !dom.isBlock(parentNode)) {\n            if (!find$3(dom, node, false) && !find$3(dom, node.firstChild, true, 1)) {\n              node.insertBefore(dom.create('br'), node.firstChild);\n            }\n            if (!find$3(dom, node, true) && !find$3(dom, node.lastChild, false, 1)) {\n              node.appendChild(dom.create('br'));\n            }\n          }\n        } else {\n          if (parentNode === dom.getRoot()) {\n            if (!format.list_block || !isEq$5(node, format.list_block)) {\n              each$d(Tools.grep(node.childNodes), function (node) {\n                if (FormatUtils.isValid(ed, forcedRootBlock, node.nodeName.toLowerCase())) {\n                  if (!rootBlockElm) {\n                    rootBlockElm = wrap$2(dom, node, forcedRootBlock);\n                    dom.setAttribs(rootBlockElm, ed.settings.forced_root_block_attrs);\n                  } else {\n                    rootBlockElm.appendChild(node);\n                  }\n                } else {\n                  rootBlockElm = 0;\n                }\n              });\n            }\n          }\n        }\n      }\n      if (format.selector && format.inline && !isEq$5(format.inline, node)) {\n        return;\n      }\n      dom.remove(node, 1);\n    };\n    var removeFormat = function (ed, format, vars, node, compareNode) {\n      var i, attrs, stylesModified;\n      var dom = ed.dom;\n      if (!matchName$1(dom, node, format) && !isColorFormatAndAnchor(node, format)) {\n        return false;\n      }\n      if (format.remove !== 'all') {\n        each$d(format.styles, function (value, name) {\n          value = FormatUtils.normalizeStyleValue(dom, FormatUtils.replaceVars(value, vars), name);\n          if (typeof name === 'number') {\n            name = value;\n            compareNode = 0;\n          }\n          if (format.remove_similar || (!compareNode || isEq$5(FormatUtils.getStyle(dom, compareNode, name), value))) {\n            dom.setStyle(node, name, '');\n          }\n          stylesModified = 1;\n        });\n        if (stylesModified && dom.getAttrib(node, 'style') === '') {\n          node.removeAttribute('style');\n          node.removeAttribute('data-mce-style');\n        }\n        each$d(format.attributes, function (value, name) {\n          var valueOut;\n          value = FormatUtils.replaceVars(value, vars);\n          if (typeof name === 'number') {\n            name = value;\n            compareNode = 0;\n          }\n          if (!compareNode || isEq$5(dom.getAttrib(compareNode, name), value)) {\n            if (name === 'class') {\n              value = dom.getAttrib(node, name);\n              if (value) {\n                valueOut = '';\n                each$d(value.split(/\\s+/), function (cls) {\n                  if (/mce\\-\\w+/.test(cls)) {\n                    valueOut += (valueOut ? ' ' : '') + cls;\n                  }\n                });\n                if (valueOut) {\n                  dom.setAttrib(node, name, valueOut);\n                  return;\n                }\n              }\n            }\n            if (name === 'class') {\n              node.removeAttribute('className');\n            }\n            if (MCE_ATTR_RE.test(name)) {\n              node.removeAttribute('data-mce-' + name);\n            }\n            node.removeAttribute(name);\n          }\n        });\n        each$d(format.classes, function (value) {\n          value = FormatUtils.replaceVars(value, vars);\n          if (!compareNode || dom.hasClass(compareNode, value)) {\n            dom.removeClass(node, value);\n          }\n        });\n        attrs = dom.getAttribs(node);\n        for (i = 0; i < attrs.length; i++) {\n          var attrName = attrs[i].nodeName;\n          if (attrName.indexOf('_') !== 0 && attrName.indexOf('data-') !== 0) {\n            return false;\n          }\n        }\n      }\n      if (format.remove !== 'none') {\n        removeNode$1(ed, node, format);\n        return true;\n      }\n    };\n    var findFormatRoot = function (editor, container, name, vars, similar) {\n      var formatRoot;\n      each$d(FormatUtils.getParents(editor.dom, container.parentNode).reverse(), function (parent) {\n        var format;\n        if (!formatRoot && parent.id !== '_start' && parent.id !== '_end') {\n          format = MatchFormat.matchNode(editor, parent, name, vars, similar);\n          if (format && format.split !== false) {\n            formatRoot = parent;\n          }\n        }\n      });\n      return formatRoot;\n    };\n    var wrapAndSplit = function (editor, formatList, formatRoot, container, target, split, format, vars) {\n      var parent, clone, lastClone, firstClone, i, formatRootParent;\n      var dom = editor.dom;\n      if (formatRoot) {\n        formatRootParent = formatRoot.parentNode;\n        for (parent = container.parentNode; parent && parent !== formatRootParent; parent = parent.parentNode) {\n          clone = dom.clone(parent, false);\n          for (i = 0; i < formatList.length; i++) {\n            if (removeFormat(editor, formatList[i], vars, clone, clone)) {\n              clone = 0;\n              break;\n            }\n          }\n          if (clone) {\n            if (lastClone) {\n              clone.appendChild(lastClone);\n            }\n            if (!firstClone) {\n              firstClone = clone;\n            }\n            lastClone = clone;\n          }\n        }\n        if (split && (!format.mixed || !dom.isBlock(formatRoot))) {\n          container = dom.split(formatRoot, container);\n        }\n        if (lastClone) {\n          target.parentNode.insertBefore(lastClone, target);\n          firstClone.appendChild(target);\n        }\n      }\n      return container;\n    };\n    var remove$6 = function (ed, name, vars, node, similar) {\n      var formatList = ed.formatter.get(name), format = formatList[0];\n      var bookmark, rng, contentEditable = true;\n      var dom = ed.dom;\n      var selection = ed.selection;\n      var splitToFormatRoot = function (container) {\n        var formatRoot = findFormatRoot(ed, container, name, vars, similar);\n        return wrapAndSplit(ed, formatList, formatRoot, container, container, true, format, vars);\n      };\n      var isRemoveBookmarkNode = function (node) {\n        return Bookmarks.isBookmarkNode(node) && NodeType.isElement(node) && (node.id === '_start' || node.id === '_end');\n      };\n      var process = function (node) {\n        var children, i, l, lastContentEditable, hasContentEditableState;\n        if (NodeType.isElement(node) && dom.getContentEditable(node)) {\n          lastContentEditable = contentEditable;\n          contentEditable = dom.getContentEditable(node) === 'true';\n          hasContentEditableState = true;\n        }\n        children = Tools.grep(node.childNodes);\n        if (contentEditable && !hasContentEditableState) {\n          for (i = 0, l = formatList.length; i < l; i++) {\n            if (removeFormat(ed, formatList[i], vars, node, node)) {\n              break;\n            }\n          }\n        }\n        if (format.deep) {\n          if (children.length) {\n            for (i = 0, l = children.length; i < l; i++) {\n              process(children[i]);\n            }\n            if (hasContentEditableState) {\n              contentEditable = lastContentEditable;\n            }\n          }\n        }\n      };\n      var unwrap = function (start) {\n        var node = dom.get(start ? '_start' : '_end');\n        var out = node[start ? 'firstChild' : 'lastChild'];\n        if (isRemoveBookmarkNode(out)) {\n          out = out[start ? 'firstChild' : 'lastChild'];\n        }\n        if (NodeType.isText(out) && out.data.length === 0) {\n          out = start ? node.previousSibling || node.nextSibling : node.nextSibling || node.previousSibling;\n        }\n        dom.remove(node, true);\n        return out;\n      };\n      var removeRngStyle = function (rng) {\n        var startContainer, endContainer;\n        var commonAncestorContainer = rng.commonAncestorContainer;\n        rng = ExpandRange.expandRng(ed, rng, formatList, true);\n        if (format.split) {\n          rng = SplitRange.split(rng);\n          startContainer = getContainer(ed, rng, true);\n          endContainer = getContainer(ed, rng);\n          if (startContainer !== endContainer) {\n            if (/^(TR|TH|TD)$/.test(startContainer.nodeName) && startContainer.firstChild) {\n              if (startContainer.nodeName === 'TR') {\n                startContainer = startContainer.firstChild.firstChild || startContainer;\n              } else {\n                startContainer = startContainer.firstChild || startContainer;\n              }\n            }\n            if (commonAncestorContainer && /^T(HEAD|BODY|FOOT|R)$/.test(commonAncestorContainer.nodeName) && isTableCell$4(endContainer) && endContainer.firstChild) {\n              endContainer = endContainer.firstChild || endContainer;\n            }\n            if (isChildOfInlineParent(dom, startContainer, endContainer)) {\n              var marker = Option.from(startContainer.firstChild).getOr(startContainer);\n              splitToFormatRoot(wrapWithSiblings(dom, marker, true, 'span', {\n                'id': '_start',\n                'data-mce-type': 'bookmark'\n              }));\n              unwrap(true);\n              return;\n            }\n            if (isChildOfInlineParent(dom, endContainer, startContainer)) {\n              var marker = Option.from(endContainer.lastChild).getOr(endContainer);\n              splitToFormatRoot(wrapWithSiblings(dom, marker, false, 'span', {\n                'id': '_end',\n                'data-mce-type': 'bookmark'\n              }));\n              unwrap(false);\n              return;\n            }\n            startContainer = wrap$2(dom, startContainer, 'span', {\n              'id': '_start',\n              'data-mce-type': 'bookmark'\n            });\n            endContainer = wrap$2(dom, endContainer, 'span', {\n              'id': '_end',\n              'data-mce-type': 'bookmark'\n            });\n            splitToFormatRoot(startContainer);\n            splitToFormatRoot(endContainer);\n            startContainer = unwrap(true);\n            endContainer = unwrap();\n          } else {\n            startContainer = endContainer = splitToFormatRoot(startContainer);\n          }\n          rng.startContainer = startContainer.parentNode ? startContainer.parentNode : startContainer;\n          rng.startOffset = dom.nodeIndex(startContainer);\n          rng.endContainer = endContainer.parentNode ? endContainer.parentNode : endContainer;\n          rng.endOffset = dom.nodeIndex(endContainer) + 1;\n        }\n        RangeWalk.walk(dom, rng, function (nodes) {\n          each$d(nodes, function (node) {\n            process(node);\n            if (NodeType.isElement(node) && ed.dom.getStyle(node, 'text-decoration') === 'underline' && node.parentNode && FormatUtils.getTextDecoration(dom, node.parentNode) === 'underline') {\n              removeFormat(ed, {\n                deep: false,\n                exact: true,\n                inline: 'span',\n                styles: { textDecoration: 'underline' }\n              }, null, node);\n            }\n          });\n        });\n      };\n      if (node) {\n        if (node.nodeType) {\n          rng = dom.createRng();\n          rng.setStartBefore(node);\n          rng.setEndAfter(node);\n          removeRngStyle(rng);\n        } else {\n          removeRngStyle(node);\n        }\n        return;\n      }\n      if (dom.getContentEditable(selection.getNode()) === 'false') {\n        node = selection.getNode();\n        for (var i = 0, l = formatList.length; i < l; i++) {\n          if (formatList[i].ceFalseOverride) {\n            if (removeFormat(ed, formatList[i], vars, node, node)) {\n              break;\n            }\n          }\n        }\n        return;\n      }\n      if (!selection.isCollapsed() || !format.inline || dom.select('td[data-mce-selected],th[data-mce-selected]').length) {\n        bookmark = GetBookmark.getPersistentBookmark(ed.selection, true);\n        removeRngStyle(selection.getRng());\n        selection.moveToBookmark(bookmark);\n        if (format.inline && MatchFormat.match(ed, name, vars, selection.getStart())) {\n          FormatUtils.moveStart(dom, selection, selection.getRng());\n        }\n        ed.nodeChanged();\n      } else {\n        removeCaretFormat(ed, name, vars, similar);\n      }\n    };\n    var RemoveFormat = {\n      removeFormat: removeFormat,\n      remove: remove$6\n    };\n\n    var each$e = Tools.each;\n    var isElementNode = function (node) {\n      return node && node.nodeType === 1 && !Bookmarks.isBookmarkNode(node) && !isCaretNode(node) && !NodeType.isBogus(node);\n    };\n    var findElementSibling = function (node, siblingName) {\n      var sibling;\n      for (sibling = node; sibling; sibling = sibling[siblingName]) {\n        if (sibling.nodeType === 3 && sibling.nodeValue.length !== 0) {\n          return node;\n        }\n        if (sibling.nodeType === 1 && !Bookmarks.isBookmarkNode(sibling)) {\n          return sibling;\n        }\n      }\n      return node;\n    };\n    var mergeSiblingsNodes = function (dom, prev, next) {\n      var sibling, tmpSibling;\n      var elementUtils = new ElementUtils(dom);\n      if (prev && next) {\n        prev = findElementSibling(prev, 'previousSibling');\n        next = findElementSibling(next, 'nextSibling');\n        if (elementUtils.compare(prev, next)) {\n          for (sibling = prev.nextSibling; sibling && sibling !== next;) {\n            tmpSibling = sibling;\n            sibling = sibling.nextSibling;\n            prev.appendChild(tmpSibling);\n          }\n          dom.remove(next);\n          Tools.each(Tools.grep(next.childNodes), function (node) {\n            prev.appendChild(node);\n          });\n          return prev;\n        }\n      }\n      return next;\n    };\n    var processChildElements = function (node, filter, process) {\n      each$e(node.childNodes, function (node) {\n        if (isElementNode(node)) {\n          if (filter(node)) {\n            process(node);\n          }\n          if (node.hasChildNodes()) {\n            processChildElements(node, filter, process);\n          }\n        }\n      });\n    };\n    var hasStyle = function (dom, name) {\n      return curry(function (name, node) {\n        return !!(node && FormatUtils.getStyle(dom, node, name));\n      }, name);\n    };\n    var applyStyle = function (dom, name, value) {\n      return curry(function (name, value, node) {\n        dom.setStyle(node, name, value);\n        if (node.getAttribute('style') === '') {\n          node.removeAttribute('style');\n        }\n        unwrapEmptySpan(dom, node);\n      }, name, value);\n    };\n    var unwrapEmptySpan = function (dom, node) {\n      if (node.nodeName === 'SPAN' && dom.getAttribs(node).length === 0) {\n        dom.remove(node, true);\n      }\n    };\n    var processUnderlineAndColor = function (dom, node) {\n      var textDecoration;\n      if (node.nodeType === 1 && node.parentNode && node.parentNode.nodeType === 1) {\n        textDecoration = FormatUtils.getTextDecoration(dom, node.parentNode);\n        if (dom.getStyle(node, 'color') && textDecoration) {\n          dom.setStyle(node, 'text-decoration', textDecoration);\n        } else if (dom.getStyle(node, 'text-decoration') === textDecoration) {\n          dom.setStyle(node, 'text-decoration', null);\n        }\n      }\n    };\n    var mergeUnderlineAndColor = function (dom, format, vars, node) {\n      if (format.styles.color || format.styles.textDecoration) {\n        Tools.walk(node, curry(processUnderlineAndColor, dom), 'childNodes');\n        processUnderlineAndColor(dom, node);\n      }\n    };\n    var mergeBackgroundColorAndFontSize = function (dom, format, vars, node) {\n      if (format.styles && format.styles.backgroundColor) {\n        processChildElements(node, hasStyle(dom, 'fontSize'), applyStyle(dom, 'backgroundColor', FormatUtils.replaceVars(format.styles.backgroundColor, vars)));\n      }\n    };\n    var mergeSubSup = function (dom, format, vars, node) {\n      if (format.inline === 'sub' || format.inline === 'sup') {\n        processChildElements(node, hasStyle(dom, 'fontSize'), applyStyle(dom, 'fontSize', ''));\n        dom.remove(dom.select(format.inline === 'sup' ? 'sub' : 'sup', node), true);\n      }\n    };\n    var mergeSiblings = function (dom, format, vars, node) {\n      if (node && format.merge_siblings !== false) {\n        node = mergeSiblingsNodes(dom, FormatUtils.getNonWhiteSpaceSibling(node), node);\n        node = mergeSiblingsNodes(dom, node, FormatUtils.getNonWhiteSpaceSibling(node, true));\n      }\n    };\n    var clearChildStyles = function (dom, format, node) {\n      if (format.clear_child_styles) {\n        var selector = format.links ? '*:not(a)' : '*';\n        each$e(dom.select(selector, node), function (node) {\n          if (isElementNode(node)) {\n            each$e(format.styles, function (value, name) {\n              dom.setStyle(node, name, '');\n            });\n          }\n        });\n      }\n    };\n    var mergeWithChildren = function (editor, formatList, vars, node) {\n      each$e(formatList, function (format) {\n        each$e(editor.dom.select(format.inline, node), function (child) {\n          if (!isElementNode(child)) {\n            return;\n          }\n          RemoveFormat.removeFormat(editor, format, vars, child, format.exact ? child : null);\n        });\n        clearChildStyles(editor.dom, format, node);\n      });\n    };\n    var mergeWithParents = function (editor, format, name, vars, node) {\n      if (MatchFormat.matchNode(editor, node.parentNode, name, vars)) {\n        if (RemoveFormat.removeFormat(editor, format, vars, node)) {\n          return;\n        }\n      }\n      if (format.merge_with_parents) {\n        editor.dom.getParent(node.parentNode, function (parent) {\n          if (MatchFormat.matchNode(editor, parent, name, vars)) {\n            RemoveFormat.removeFormat(editor, format, vars, node);\n            return true;\n          }\n        });\n      }\n    };\n    var MergeFormats = {\n      mergeWithChildren: mergeWithChildren,\n      mergeUnderlineAndColor: mergeUnderlineAndColor,\n      mergeBackgroundColorAndFontSize: mergeBackgroundColorAndFontSize,\n      mergeSubSup: mergeSubSup,\n      mergeSiblings: mergeSiblings,\n      mergeWithParents: mergeWithParents\n    };\n\n    var each$f = Tools.each;\n    var isElementNode$1 = function (node) {\n      return node && node.nodeType === 1 && !Bookmarks.isBookmarkNode(node) && !isCaretNode(node) && !NodeType.isBogus(node);\n    };\n    var applyFormat = function (ed, name, vars, node) {\n      var formatList = ed.formatter.get(name);\n      var format = formatList[0];\n      var bookmark, rng;\n      var isCollapsed = !node && ed.selection.isCollapsed();\n      var dom = ed.dom, selection = ed.selection;\n      var setElementFormat = function (elm, fmt) {\n        fmt = fmt || format;\n        if (elm) {\n          if (fmt.onformat) {\n            fmt.onformat(elm, fmt, vars, node);\n          }\n          each$f(fmt.styles, function (value, name) {\n            dom.setStyle(elm, name, FormatUtils.replaceVars(value, vars));\n          });\n          if (fmt.styles) {\n            var styleVal = dom.getAttrib(elm, 'style');\n            if (styleVal) {\n              elm.setAttribute('data-mce-style', styleVal);\n            }\n          }\n          each$f(fmt.attributes, function (value, name) {\n            dom.setAttrib(elm, name, FormatUtils.replaceVars(value, vars));\n          });\n          each$f(fmt.classes, function (value) {\n            value = FormatUtils.replaceVars(value, vars);\n            if (!dom.hasClass(elm, value)) {\n              dom.addClass(elm, value);\n            }\n          });\n        }\n      };\n      var applyNodeStyle = function (formatList, node) {\n        var found = false;\n        if (!format.selector) {\n          return false;\n        }\n        each$f(formatList, function (format) {\n          if ('collapsed' in format && format.collapsed !== isCollapsed) {\n            return;\n          }\n          if (dom.is(node, format.selector) && !isCaretNode(node)) {\n            setElementFormat(node, format);\n            found = true;\n            return false;\n          }\n        });\n        return found;\n      };\n      var applyRngStyle = function (dom, rng, bookmark, nodeSpecific) {\n        var newWrappers = [];\n        var wrapName, wrapElm, contentEditable = true;\n        wrapName = format.inline || format.block;\n        wrapElm = dom.create(wrapName);\n        setElementFormat(wrapElm);\n        RangeWalk.walk(dom, rng, function (nodes) {\n          var currentWrapElm;\n          var process = function (node) {\n            var nodeName, parentName, hasContentEditableState, lastContentEditable;\n            lastContentEditable = contentEditable;\n            nodeName = node.nodeName.toLowerCase();\n            parentName = node.parentNode.nodeName.toLowerCase();\n            if (node.nodeType === 1 && dom.getContentEditable(node)) {\n              lastContentEditable = contentEditable;\n              contentEditable = dom.getContentEditable(node) === 'true';\n              hasContentEditableState = true;\n            }\n            if (FormatUtils.isEq(nodeName, 'br')) {\n              currentWrapElm = 0;\n              if (format.block) {\n                dom.remove(node);\n              }\n              return;\n            }\n            if (format.wrapper && MatchFormat.matchNode(ed, node, name, vars)) {\n              currentWrapElm = 0;\n              return;\n            }\n            if (contentEditable && !hasContentEditableState && format.block && !format.wrapper && FormatUtils.isTextBlock(ed, nodeName) && FormatUtils.isValid(ed, parentName, wrapName)) {\n              node = dom.rename(node, wrapName);\n              setElementFormat(node);\n              newWrappers.push(node);\n              currentWrapElm = 0;\n              return;\n            }\n            if (format.selector) {\n              var found = applyNodeStyle(formatList, node);\n              if (!format.inline || found) {\n                currentWrapElm = 0;\n                return;\n              }\n            }\n            if (contentEditable && !hasContentEditableState && FormatUtils.isValid(ed, wrapName, nodeName) && FormatUtils.isValid(ed, parentName, wrapName) && !(!nodeSpecific && node.nodeType === 3 && node.nodeValue.length === 1 && node.nodeValue.charCodeAt(0) === 65279) && !isCaretNode(node) && (!format.inline || !dom.isBlock(node))) {\n              if (!currentWrapElm) {\n                currentWrapElm = dom.clone(wrapElm, false);\n                node.parentNode.insertBefore(currentWrapElm, node);\n                newWrappers.push(currentWrapElm);\n              }\n              currentWrapElm.appendChild(node);\n            } else {\n              currentWrapElm = 0;\n              each$f(Tools.grep(node.childNodes), process);\n              if (hasContentEditableState) {\n                contentEditable = lastContentEditable;\n              }\n              currentWrapElm = 0;\n            }\n          };\n          each$f(nodes, process);\n        });\n        if (format.links === true) {\n          each$f(newWrappers, function (node) {\n            var process = function (node) {\n              if (node.nodeName === 'A') {\n                setElementFormat(node, format);\n              }\n              each$f(Tools.grep(node.childNodes), process);\n            };\n            process(node);\n          });\n        }\n        each$f(newWrappers, function (node) {\n          var childCount;\n          var getChildCount = function (node) {\n            var count = 0;\n            each$f(node.childNodes, function (node) {\n              if (!FormatUtils.isWhiteSpaceNode(node) && !Bookmarks.isBookmarkNode(node)) {\n                count++;\n              }\n            });\n            return count;\n          };\n          var getChildElementNode = function (root) {\n            var child = false;\n            each$f(root.childNodes, function (node) {\n              if (isElementNode$1(node)) {\n                child = node;\n                return false;\n              }\n            });\n            return child;\n          };\n          var mergeStyles = function (node) {\n            var child, clone;\n            child = getChildElementNode(node);\n            if (child && !Bookmarks.isBookmarkNode(child) && MatchFormat.matchName(dom, child, format)) {\n              clone = dom.clone(child, false);\n              setElementFormat(clone);\n              dom.replace(clone, node, true);\n              dom.remove(child, 1);\n            }\n            return clone || node;\n          };\n          childCount = getChildCount(node);\n          if ((newWrappers.length > 1 || !dom.isBlock(node)) && childCount === 0) {\n            dom.remove(node, 1);\n            return;\n          }\n          if (format.inline || format.wrapper) {\n            if (!format.exact && childCount === 1) {\n              node = mergeStyles(node);\n            }\n            MergeFormats.mergeWithChildren(ed, formatList, vars, node);\n            MergeFormats.mergeWithParents(ed, format, name, vars, node);\n            MergeFormats.mergeBackgroundColorAndFontSize(dom, format, vars, node);\n            MergeFormats.mergeSubSup(dom, format, vars, node);\n            MergeFormats.mergeSiblings(dom, format, vars, node);\n          }\n        });\n      };\n      if (dom.getContentEditable(selection.getNode()) === 'false') {\n        node = selection.getNode();\n        for (var i = 0, l = formatList.length; i < l; i++) {\n          if (formatList[i].ceFalseOverride && dom.is(node, formatList[i].selector)) {\n            setElementFormat(node, formatList[i]);\n            return;\n          }\n        }\n        return;\n      }\n      if (format) {\n        if (node) {\n          if (node.nodeType) {\n            if (!applyNodeStyle(formatList, node)) {\n              rng = dom.createRng();\n              rng.setStartBefore(node);\n              rng.setEndAfter(node);\n              applyRngStyle(dom, ExpandRange.expandRng(ed, rng, formatList), null, true);\n            }\n          } else {\n            applyRngStyle(dom, node, null, true);\n          }\n        } else {\n          if (!isCollapsed || !format.inline || dom.select('td[data-mce-selected],th[data-mce-selected]').length) {\n            var curSelNode = ed.selection.getNode();\n            if (!ed.settings.forced_root_block && formatList[0].defaultBlock && !dom.getParent(curSelNode, dom.isBlock)) {\n              applyFormat(ed, formatList[0].defaultBlock);\n            }\n            ed.selection.setRng(RangeNormalizer.normalize(ed.selection.getRng()));\n            bookmark = GetBookmark.getPersistentBookmark(ed.selection, true);\n            applyRngStyle(dom, ExpandRange.expandRng(ed, selection.getRng(), formatList));\n            if (format.styles) {\n              MergeFormats.mergeUnderlineAndColor(dom, format, vars, curSelNode);\n            }\n            selection.moveToBookmark(bookmark);\n            FormatUtils.moveStart(dom, selection, selection.getRng());\n            ed.nodeChanged();\n          } else {\n            applyCaretFormat(ed, name, vars);\n          }\n        }\n        Hooks.postProcess(name, ed);\n      }\n    };\n    var ApplyFormat = { applyFormat: applyFormat };\n\n    var each$g = Tools.each;\n    var setup$5 = function (formatChangeData, editor) {\n      var currentFormats = {};\n      formatChangeData.set({});\n      editor.on('NodeChange', function (e) {\n        var parents = FormatUtils.getParents(editor.dom, e.element);\n        var matchedFormats = {};\n        parents = Tools.grep(parents, function (node) {\n          return node.nodeType === 1 && !node.getAttribute('data-mce-bogus');\n        });\n        each$g(formatChangeData.get(), function (callbacks, format) {\n          each$g(parents, function (node) {\n            if (editor.formatter.matchNode(node, format, {}, callbacks.similar)) {\n              if (!currentFormats[format]) {\n                each$g(callbacks, function (callback) {\n                  callback(true, {\n                    node: node,\n                    format: format,\n                    parents: parents\n                  });\n                });\n                currentFormats[format] = callbacks;\n              }\n              matchedFormats[format] = callbacks;\n              return false;\n            }\n            if (MatchFormat.matchesUnInheritedFormatSelector(editor, node, format)) {\n              return false;\n            }\n          });\n        });\n        each$g(currentFormats, function (callbacks, format) {\n          if (!matchedFormats[format]) {\n            delete currentFormats[format];\n            each$g(callbacks, function (callback) {\n              callback(false, {\n                node: e.element,\n                format: format,\n                parents: parents\n              });\n            });\n          }\n        });\n      });\n    };\n    var addListeners = function (formatChangeData, formats, callback, similar) {\n      var formatChangeItems = formatChangeData.get();\n      each$g(formats.split(','), function (format) {\n        if (!formatChangeItems[format]) {\n          formatChangeItems[format] = [];\n          formatChangeItems[format].similar = similar;\n        }\n        formatChangeItems[format].push(callback);\n      });\n      formatChangeData.set(formatChangeItems);\n    };\n    var formatChanged = function (editor, formatChangeState, formats, callback, similar) {\n      if (formatChangeState.get() === null) {\n        setup$5(formatChangeState, editor);\n      }\n      addListeners(formatChangeState, formats, callback, similar);\n    };\n    var FormatChanged = { formatChanged: formatChanged };\n\n    var get$5 = function (dom) {\n      var formats = {\n        valigntop: [{\n            selector: 'td,th',\n            styles: { verticalAlign: 'top' }\n          }],\n        valignmiddle: [{\n            selector: 'td,th',\n            styles: { verticalAlign: 'middle' }\n          }],\n        valignbottom: [{\n            selector: 'td,th',\n            styles: { verticalAlign: 'bottom' }\n          }],\n        alignleft: [\n          {\n            selector: 'figure.image',\n            collapsed: false,\n            classes: 'align-left',\n            ceFalseOverride: true,\n            preview: 'font-family font-size'\n          },\n          {\n            selector: 'figure,p,h1,h2,h3,h4,h5,h6,td,th,tr,div,ul,ol,li',\n            styles: { textAlign: 'left' },\n            inherit: false,\n            preview: false,\n            defaultBlock: 'div'\n          },\n          {\n            selector: 'img,table',\n            collapsed: false,\n            styles: { float: 'left' },\n            preview: 'font-family font-size'\n          }\n        ],\n        aligncenter: [\n          {\n            selector: 'figure,p,h1,h2,h3,h4,h5,h6,td,th,tr,div,ul,ol,li',\n            styles: { textAlign: 'center' },\n            inherit: false,\n            preview: 'font-family font-size',\n            defaultBlock: 'div'\n          },\n          {\n            selector: 'figure.image',\n            collapsed: false,\n            classes: 'align-center',\n            ceFalseOverride: true,\n            preview: 'font-family font-size'\n          },\n          {\n            selector: 'img',\n            collapsed: false,\n            styles: {\n              display: 'block',\n              marginLeft: 'auto',\n              marginRight: 'auto'\n            },\n            preview: false\n          },\n          {\n            selector: 'table',\n            collapsed: false,\n            styles: {\n              marginLeft: 'auto',\n              marginRight: 'auto'\n            },\n            preview: 'font-family font-size'\n          }\n        ],\n        alignright: [\n          {\n            selector: 'figure.image',\n            collapsed: false,\n            classes: 'align-right',\n            ceFalseOverride: true,\n            preview: 'font-family font-size'\n          },\n          {\n            selector: 'figure,p,h1,h2,h3,h4,h5,h6,td,th,tr,div,ul,ol,li',\n            styles: { textAlign: 'right' },\n            inherit: false,\n            preview: 'font-family font-size',\n            defaultBlock: 'div'\n          },\n          {\n            selector: 'img,table',\n            collapsed: false,\n            styles: { float: 'right' },\n            preview: 'font-family font-size'\n          }\n        ],\n        alignjustify: [{\n            selector: 'figure,p,h1,h2,h3,h4,h5,h6,td,th,tr,div,ul,ol,li',\n            styles: { textAlign: 'justify' },\n            inherit: false,\n            defaultBlock: 'div',\n            preview: 'font-family font-size'\n          }],\n        bold: [\n          {\n            inline: 'strong',\n            remove: 'all'\n          },\n          {\n            inline: 'span',\n            styles: { fontWeight: 'bold' }\n          },\n          {\n            inline: 'b',\n            remove: 'all'\n          }\n        ],\n        italic: [\n          {\n            inline: 'em',\n            remove: 'all'\n          },\n          {\n            inline: 'span',\n            styles: { fontStyle: 'italic' }\n          },\n          {\n            inline: 'i',\n            remove: 'all'\n          }\n        ],\n        underline: [\n          {\n            inline: 'span',\n            styles: { textDecoration: 'underline' },\n            exact: true\n          },\n          {\n            inline: 'u',\n            remove: 'all'\n          }\n        ],\n        strikethrough: [\n          {\n            inline: 'span',\n            styles: { textDecoration: 'line-through' },\n            exact: true\n          },\n          {\n            inline: 'strike',\n            remove: 'all'\n          }\n        ],\n        forecolor: {\n          inline: 'span',\n          styles: { color: '%value' },\n          links: true,\n          remove_similar: true,\n          clear_child_styles: true\n        },\n        hilitecolor: {\n          inline: 'span',\n          styles: { backgroundColor: '%value' },\n          links: true,\n          remove_similar: true,\n          clear_child_styles: true\n        },\n        fontname: {\n          inline: 'span',\n          toggle: false,\n          styles: { fontFamily: '%value' },\n          clear_child_styles: true\n        },\n        fontsize: {\n          inline: 'span',\n          toggle: false,\n          styles: { fontSize: '%value' },\n          clear_child_styles: true\n        },\n        fontsize_class: {\n          inline: 'span',\n          attributes: { class: '%value' }\n        },\n        blockquote: {\n          block: 'blockquote',\n          wrapper: 1,\n          remove: 'all'\n        },\n        subscript: { inline: 'sub' },\n        superscript: { inline: 'sup' },\n        code: { inline: 'code' },\n        link: {\n          inline: 'a',\n          selector: 'a',\n          remove: 'all',\n          split: true,\n          deep: true,\n          onmatch: function () {\n            return true;\n          },\n          onformat: function (elm, fmt, vars) {\n            Tools.each(vars, function (value, key) {\n              dom.setAttrib(elm, key, value);\n            });\n          }\n        },\n        removeformat: [\n          {\n            selector: 'b,strong,em,i,font,u,strike,sub,sup,dfn,code,samp,kbd,var,cite,mark,q,del,ins',\n            remove: 'all',\n            split: true,\n            expand: false,\n            block_expand: true,\n            deep: true\n          },\n          {\n            selector: 'span',\n            attributes: [\n              'style',\n              'class'\n            ],\n            remove: 'empty',\n            split: true,\n            expand: false,\n            deep: true\n          },\n          {\n            selector: '*',\n            attributes: [\n              'style',\n              'class'\n            ],\n            split: false,\n            expand: false,\n            deep: true\n          }\n        ]\n      };\n      Tools.each('p h1 h2 h3 h4 h5 h6 div address pre div dt dd samp'.split(/\\s/), function (name) {\n        formats[name] = {\n          block: name,\n          remove: 'all'\n        };\n      });\n      return formats;\n    };\n    var DefaultFormats = { get: get$5 };\n\n    function FormatRegistry (editor) {\n      var formats = {};\n      var get = function (name) {\n        return name ? formats[name] : formats;\n      };\n      var register = function (name, format) {\n        if (name) {\n          if (typeof name !== 'string') {\n            Tools.each(name, function (format, name) {\n              register(name, format);\n            });\n          } else {\n            format = format.length ? format : [format];\n            Tools.each(format, function (format) {\n              if (typeof format.deep === 'undefined') {\n                format.deep = !format.selector;\n              }\n              if (typeof format.split === 'undefined') {\n                format.split = !format.selector || format.inline;\n              }\n              if (typeof format.remove === 'undefined' && format.selector && !format.inline) {\n                format.remove = 'none';\n              }\n              if (format.selector && format.inline) {\n                format.mixed = true;\n                format.block_expand = true;\n              }\n              if (typeof format.classes === 'string') {\n                format.classes = format.classes.split(/\\s+/);\n              }\n            });\n            formats[name] = format;\n          }\n        }\n      };\n      var unregister = function (name) {\n        if (name && formats[name]) {\n          delete formats[name];\n        }\n        return formats;\n      };\n      register(DefaultFormats.get(editor.dom));\n      register(editor.settings.formats);\n      return {\n        get: get,\n        register: register,\n        unregister: unregister\n      };\n    }\n\n    var each$h = Tools.each;\n    var dom = DOMUtils$1.DOM;\n    var parsedSelectorToHtml = function (ancestry, editor) {\n      var elm, item, fragment;\n      var schema = editor && editor.schema || Schema({});\n      var decorate = function (elm, item) {\n        if (item.classes.length) {\n          dom.addClass(elm, item.classes.join(' '));\n        }\n        dom.setAttribs(elm, item.attrs);\n      };\n      var createElement = function (sItem) {\n        var elm;\n        item = typeof sItem === 'string' ? {\n          name: sItem,\n          classes: [],\n          attrs: {}\n        } : sItem;\n        elm = dom.create(item.name);\n        decorate(elm, item);\n        return elm;\n      };\n      var getRequiredParent = function (elm, candidate) {\n        var name = typeof elm !== 'string' ? elm.nodeName.toLowerCase() : elm;\n        var elmRule = schema.getElementRule(name);\n        var parentsRequired = elmRule && elmRule.parentsRequired;\n        if (parentsRequired && parentsRequired.length) {\n          return candidate && Tools.inArray(parentsRequired, candidate) !== -1 ? candidate : parentsRequired[0];\n        } else {\n          return false;\n        }\n      };\n      var wrapInHtml = function (elm, ancestry, siblings) {\n        var parent, parentCandidate, parentRequired;\n        var ancestor = ancestry.length > 0 && ancestry[0];\n        var ancestorName = ancestor && ancestor.name;\n        parentRequired = getRequiredParent(elm, ancestorName);\n        if (parentRequired) {\n          if (ancestorName === parentRequired) {\n            parentCandidate = ancestry[0];\n            ancestry = ancestry.slice(1);\n          } else {\n            parentCandidate = parentRequired;\n          }\n        } else if (ancestor) {\n          parentCandidate = ancestry[0];\n          ancestry = ancestry.slice(1);\n        } else if (!siblings) {\n          return elm;\n        }\n        if (parentCandidate) {\n          parent = createElement(parentCandidate);\n          parent.appendChild(elm);\n        }\n        if (siblings) {\n          if (!parent) {\n            parent = dom.create('div');\n            parent.appendChild(elm);\n          }\n          Tools.each(siblings, function (sibling) {\n            var siblingElm = createElement(sibling);\n            parent.insertBefore(siblingElm, elm);\n          });\n        }\n        return wrapInHtml(parent, ancestry, parentCandidate && parentCandidate.siblings);\n      };\n      if (ancestry && ancestry.length) {\n        item = ancestry[0];\n        elm = createElement(item);\n        fragment = dom.create('div');\n        fragment.appendChild(wrapInHtml(elm, ancestry.slice(1), item.siblings));\n        return fragment;\n      } else {\n        return '';\n      }\n    };\n    var selectorToHtml = function (selector, editor) {\n      return parsedSelectorToHtml(parseSelector(selector), editor);\n    };\n    var parseSelectorItem = function (item) {\n      var tagName;\n      var obj = {\n        classes: [],\n        attrs: {}\n      };\n      item = obj.selector = Tools.trim(item);\n      if (item !== '*') {\n        tagName = item.replace(/(?:([#\\.]|::?)([\\w\\-]+)|(\\[)([^\\]]+)\\]?)/g, function ($0, $1, $2, $3, $4) {\n          switch ($1) {\n          case '#':\n            obj.attrs.id = $2;\n            break;\n          case '.':\n            obj.classes.push($2);\n            break;\n          case ':':\n            if (Tools.inArray('checked disabled enabled read-only required'.split(' '), $2) !== -1) {\n              obj.attrs[$2] = $2;\n            }\n            break;\n          }\n          if ($3 === '[') {\n            var m = $4.match(/([\\w\\-]+)(?:\\=\\\"([^\\\"]+))?/);\n            if (m) {\n              obj.attrs[m[1]] = m[2];\n            }\n          }\n          return '';\n        });\n      }\n      obj.name = tagName || 'div';\n      return obj;\n    };\n    var parseSelector = function (selector) {\n      if (!selector || typeof selector !== 'string') {\n        return [];\n      }\n      selector = selector.split(/\\s*,\\s*/)[0];\n      selector = selector.replace(/\\s*(~\\+|~|\\+|>)\\s*/g, '$1');\n      return Tools.map(selector.split(/(?:>|\\s+(?![^\\[\\]]+\\]))/), function (item) {\n        var siblings = Tools.map(item.split(/(?:~\\+|~|\\+)/), parseSelectorItem);\n        var obj = siblings.pop();\n        if (siblings.length) {\n          obj.siblings = siblings;\n        }\n        return obj;\n      }).reverse();\n    };\n    var getCssText = function (editor, format) {\n      var name, previewFrag, previewElm, items;\n      var previewCss = '', parentFontSize, previewStyles;\n      previewStyles = editor.settings.preview_styles;\n      if (previewStyles === false) {\n        return '';\n      }\n      if (typeof previewStyles !== 'string') {\n        previewStyles = 'font-family font-size font-weight font-style text-decoration ' + 'text-transform color background-color border border-radius outline text-shadow';\n      }\n      var removeVars = function (val) {\n        return val.replace(/%(\\w+)/g, '');\n      };\n      if (typeof format === 'string') {\n        format = editor.formatter.get(format);\n        if (!format) {\n          return;\n        }\n        format = format[0];\n      }\n      if ('preview' in format) {\n        previewStyles = format.preview;\n        if (previewStyles === false) {\n          return '';\n        }\n      }\n      name = format.block || format.inline || 'span';\n      items = parseSelector(format.selector);\n      if (items.length) {\n        if (!items[0].name) {\n          items[0].name = name;\n        }\n        name = format.selector;\n        previewFrag = parsedSelectorToHtml(items, editor);\n      } else {\n        previewFrag = parsedSelectorToHtml([name], editor);\n      }\n      previewElm = dom.select(name, previewFrag)[0] || previewFrag.firstChild;\n      each$h(format.styles, function (value, name) {\n        value = removeVars(value);\n        if (value) {\n          dom.setStyle(previewElm, name, value);\n        }\n      });\n      each$h(format.attributes, function (value, name) {\n        value = removeVars(value);\n        if (value) {\n          dom.setAttrib(previewElm, name, value);\n        }\n      });\n      each$h(format.classes, function (value) {\n        value = removeVars(value);\n        if (!dom.hasClass(previewElm, value)) {\n          dom.addClass(previewElm, value);\n        }\n      });\n      editor.fire('PreviewFormats');\n      dom.setStyles(previewFrag, {\n        position: 'absolute',\n        left: -65535\n      });\n      editor.getBody().appendChild(previewFrag);\n      parentFontSize = dom.getStyle(editor.getBody(), 'fontSize', true);\n      parentFontSize = /px$/.test(parentFontSize) ? parseInt(parentFontSize, 10) : 0;\n      each$h(previewStyles.split(' '), function (name) {\n        var value = dom.getStyle(previewElm, name, true);\n        if (name === 'background-color' && /transparent|rgba\\s*\\([^)]+,\\s*0\\)/.test(value)) {\n          value = dom.getStyle(editor.getBody(), name, true);\n          if (dom.toHex(value).toLowerCase() === '#ffffff') {\n            return;\n          }\n        }\n        if (name === 'color') {\n          if (dom.toHex(value).toLowerCase() === '#000000') {\n            return;\n          }\n        }\n        if (name === 'font-size') {\n          if (/em|%$/.test(value)) {\n            if (parentFontSize === 0) {\n              return;\n            }\n            var numValue = parseFloat(value) / (/%$/.test(value) ? 100 : 1);\n            value = numValue * parentFontSize + 'px';\n          }\n        }\n        if (name === 'border' && value) {\n          previewCss += 'padding:0 2px;';\n        }\n        previewCss += name + ':' + value + ';';\n      });\n      editor.fire('AfterPreviewFormats');\n      dom.remove(previewFrag);\n      return previewCss;\n    };\n    var Preview = {\n      getCssText: getCssText,\n      parseSelector: parseSelector,\n      selectorToHtml: selectorToHtml\n    };\n\n    var toggle = function (editor, formats, name, vars, node) {\n      var fmt = formats.get(name);\n      if (MatchFormat.match(editor, name, vars, node) && (!('toggle' in fmt[0]) || fmt[0].toggle)) {\n        RemoveFormat.remove(editor, name, vars, node);\n      } else {\n        ApplyFormat.applyFormat(editor, name, vars, node);\n      }\n    };\n    var ToggleFormat = { toggle: toggle };\n\n    var setup$6 = function (editor) {\n      editor.addShortcut('meta+b', '', 'Bold');\n      editor.addShortcut('meta+i', '', 'Italic');\n      editor.addShortcut('meta+u', '', 'Underline');\n      for (var i = 1; i <= 6; i++) {\n        editor.addShortcut('access+' + i, '', [\n          'FormatBlock',\n          false,\n          'h' + i\n        ]);\n      }\n      editor.addShortcut('access+7', '', [\n        'FormatBlock',\n        false,\n        'p'\n      ]);\n      editor.addShortcut('access+8', '', [\n        'FormatBlock',\n        false,\n        'div'\n      ]);\n      editor.addShortcut('access+9', '', [\n        'FormatBlock',\n        false,\n        'address'\n      ]);\n    };\n    var FormatShortcuts = { setup: setup$6 };\n\n    function Formatter (editor) {\n      var formats = FormatRegistry(editor);\n      var formatChangeState = Cell(null);\n      FormatShortcuts.setup(editor);\n      setup$2(editor);\n      return {\n        get: formats.get,\n        register: formats.register,\n        unregister: formats.unregister,\n        apply: curry(ApplyFormat.applyFormat, editor),\n        remove: curry(RemoveFormat.remove, editor),\n        toggle: curry(ToggleFormat.toggle, editor, formats),\n        match: curry(MatchFormat.match, editor),\n        matchAll: curry(MatchFormat.matchAll, editor),\n        matchNode: curry(MatchFormat.matchNode, editor),\n        canApply: curry(MatchFormat.canApply, editor),\n        formatChanged: curry(FormatChanged.formatChanged, editor, formatChangeState),\n        getCssText: curry(Preview.getCssText, editor)\n      };\n    }\n\n    var hasOwnProperty$2 = Object.prototype.hasOwnProperty;\n    var shallow$1 = function (old, nu) {\n      return nu;\n    };\n    var baseMerge = function (merger) {\n      return function () {\n        var objects = new Array(arguments.length);\n        for (var i = 0; i < objects.length; i++) {\n          objects[i] = arguments[i];\n        }\n        if (objects.length === 0) {\n          throw new Error('Can\\'t merge zero objects');\n        }\n        var ret = {};\n        for (var j = 0; j < objects.length; j++) {\n          var curObject = objects[j];\n          for (var key in curObject) {\n            if (hasOwnProperty$2.call(curObject, key)) {\n              ret[key] = merger(ret[key], curObject[key]);\n            }\n          }\n        }\n        return ret;\n      };\n    };\n    var merge = baseMerge(shallow$1);\n\n    var register = function (htmlParser, settings, dom) {\n      htmlParser.addAttributeFilter('data-mce-tabindex', function (nodes, name) {\n        var i = nodes.length, node;\n        while (i--) {\n          node = nodes[i];\n          node.attr('tabindex', node.attributes.map['data-mce-tabindex']);\n          node.attr(name, null);\n        }\n      });\n      htmlParser.addAttributeFilter('src,href,style', function (nodes, name) {\n        var i = nodes.length, node, value;\n        var internalName = 'data-mce-' + name;\n        var urlConverter = settings.url_converter;\n        var urlConverterScope = settings.url_converter_scope;\n        while (i--) {\n          node = nodes[i];\n          value = node.attributes.map[internalName];\n          if (value !== undefined) {\n            node.attr(name, value.length > 0 ? value : null);\n            node.attr(internalName, null);\n          } else {\n            value = node.attributes.map[name];\n            if (name === 'style') {\n              value = dom.serializeStyle(dom.parseStyle(value), node.name);\n            } else if (urlConverter) {\n              value = urlConverter.call(urlConverterScope, value, name, node.name);\n            }\n            node.attr(name, value.length > 0 ? value : null);\n          }\n        }\n      });\n      htmlParser.addAttributeFilter('class', function (nodes) {\n        var i = nodes.length, node, value;\n        while (i--) {\n          node = nodes[i];\n          value = node.attr('class');\n          if (value) {\n            value = node.attr('class').replace(/(?:^|\\s)mce-item-\\w+(?!\\S)/g, '');\n            node.attr('class', value.length > 0 ? value : null);\n          }\n        }\n      });\n      htmlParser.addAttributeFilter('data-mce-type', function (nodes, name, args) {\n        var i = nodes.length, node;\n        while (i--) {\n          node = nodes[i];\n          if (node.attributes.map['data-mce-type'] === 'bookmark' && !args.cleanup) {\n            var hasChildren = Option.from(node.firstChild).exists(function (firstChild) {\n              return !Zwsp.isZwsp(firstChild.value);\n            });\n            if (hasChildren) {\n              node.unwrap();\n            } else {\n              node.remove();\n            }\n          }\n        }\n      });\n      htmlParser.addNodeFilter('noscript', function (nodes) {\n        var i = nodes.length, node;\n        while (i--) {\n          node = nodes[i].firstChild;\n          if (node) {\n            node.value = Entities.decode(node.value);\n          }\n        }\n      });\n      htmlParser.addNodeFilter('script,style', function (nodes, name) {\n        var i = nodes.length, node, value, type;\n        var trim = function (value) {\n          return value.replace(/(<!--\\[CDATA\\[|\\]\\]-->)/g, '\\n').replace(/^[\\r\\n]*|[\\r\\n]*$/g, '').replace(/^\\s*((<!--)?(\\s*\\/\\/)?\\s*<!\\[CDATA\\[|(<!--\\s*)?\\/\\*\\s*<!\\[CDATA\\[\\s*\\*\\/|(\\/\\/)?\\s*<!--|\\/\\*\\s*<!--\\s*\\*\\/)\\s*[\\r\\n]*/gi, '').replace(/\\s*(\\/\\*\\s*\\]\\]>\\s*\\*\\/(-->)?|\\s*\\/\\/\\s*\\]\\]>(-->)?|\\/\\/\\s*(-->)?|\\]\\]>|\\/\\*\\s*-->\\s*\\*\\/|\\s*-->\\s*)\\s*$/g, '');\n        };\n        while (i--) {\n          node = nodes[i];\n          value = node.firstChild ? node.firstChild.value : '';\n          if (name === 'script') {\n            type = node.attr('type');\n            if (type) {\n              node.attr('type', type === 'mce-no/type' ? null : type.replace(/^mce\\-/, ''));\n            }\n            if (settings.element_format === 'xhtml' && value.length > 0) {\n              node.firstChild.value = '// <![CDATA[\\n' + trim(value) + '\\n// ]]>';\n            }\n          } else {\n            if (settings.element_format === 'xhtml' && value.length > 0) {\n              node.firstChild.value = '<!--\\n' + trim(value) + '\\n-->';\n            }\n          }\n        }\n      });\n      htmlParser.addNodeFilter('#comment', function (nodes) {\n        var i = nodes.length, node;\n        while (i--) {\n          node = nodes[i];\n          if (node.value.indexOf('[CDATA[') === 0) {\n            node.name = '#cdata';\n            node.type = 4;\n            node.value = node.value.replace(/^\\[CDATA\\[|\\]\\]$/g, '');\n          } else if (node.value.indexOf('mce:protected ') === 0) {\n            node.name = '#text';\n            node.type = 3;\n            node.raw = true;\n            node.value = unescape(node.value).substr(14);\n          }\n        }\n      });\n      htmlParser.addNodeFilter('xml:namespace,input', function (nodes, name) {\n        var i = nodes.length, node;\n        while (i--) {\n          node = nodes[i];\n          if (node.type === 7) {\n            node.remove();\n          } else if (node.type === 1) {\n            if (name === 'input' && !('type' in node.attributes.map)) {\n              node.attr('type', 'text');\n            }\n          }\n        }\n      });\n      htmlParser.addAttributeFilter('data-mce-type', function (nodes) {\n        each(nodes, function (node) {\n          if (node.attr('data-mce-type') === 'format-caret') {\n            if (node.isEmpty(htmlParser.schema.getNonEmptyElements())) {\n              node.remove();\n            } else {\n              node.unwrap();\n            }\n          }\n        });\n      });\n      htmlParser.addAttributeFilter('data-mce-src,data-mce-href,data-mce-style,' + 'data-mce-selected,data-mce-expando,' + 'data-mce-type,data-mce-resize', function (nodes, name) {\n        var i = nodes.length;\n        while (i--) {\n          nodes[i].attr(name, null);\n        }\n      });\n    };\n    var trimTrailingBr = function (rootNode) {\n      var brNode1, brNode2;\n      var isBr = function (node) {\n        return node && node.name === 'br';\n      };\n      brNode1 = rootNode.lastChild;\n      if (isBr(brNode1)) {\n        brNode2 = brNode1.prev;\n        if (isBr(brNode2)) {\n          brNode1.remove();\n          brNode2.remove();\n        }\n      }\n    };\n    var DomSerializerFilters = {\n      register: register,\n      trimTrailingBr: trimTrailingBr\n    };\n\n    var preProcess = function (editor, node, args) {\n      var impl, doc, oldDoc;\n      var dom = editor.dom;\n      node = node.cloneNode(true);\n      impl = domGlobals.document.implementation;\n      if (impl.createHTMLDocument) {\n        doc = impl.createHTMLDocument('');\n        Tools.each(node.nodeName === 'BODY' ? node.childNodes : [node], function (node) {\n          doc.body.appendChild(doc.importNode(node, true));\n        });\n        if (node.nodeName !== 'BODY') {\n          node = doc.body.firstChild;\n        } else {\n          node = doc.body;\n        }\n        oldDoc = dom.doc;\n        dom.doc = doc;\n      }\n      Events.firePreProcess(editor, merge(args, { node: node }));\n      if (oldDoc) {\n        dom.doc = oldDoc;\n      }\n      return node;\n    };\n    var shouldFireEvent = function (editor, args) {\n      return editor && editor.hasEventListeners('PreProcess') && !args.no_events;\n    };\n    var process = function (editor, node, args) {\n      return shouldFireEvent(editor, args) ? preProcess(editor, node, args) : node;\n    };\n    var DomSerializerPreProcess = { process: process };\n\n    var removeAttrs = function (node, names) {\n      each(names, function (name) {\n        node.attr(name, null);\n      });\n    };\n    var addFontToSpansFilter = function (domParser, styles, fontSizes) {\n      domParser.addNodeFilter('font', function (nodes) {\n        each(nodes, function (node) {\n          var props = styles.parse(node.attr('style'));\n          var color = node.attr('color');\n          var face = node.attr('face');\n          var size = node.attr('size');\n          if (color) {\n            props.color = color;\n          }\n          if (face) {\n            props['font-family'] = face;\n          }\n          if (size) {\n            props['font-size'] = fontSizes[parseInt(node.attr('size'), 10) - 1];\n          }\n          node.name = 'span';\n          node.attr('style', styles.serialize(props));\n          removeAttrs(node, [\n            'color',\n            'face',\n            'size'\n          ]);\n        });\n      });\n    };\n    var addStrikeToSpanFilter = function (domParser, styles) {\n      domParser.addNodeFilter('strike', function (nodes) {\n        each(nodes, function (node) {\n          var props = styles.parse(node.attr('style'));\n          props['text-decoration'] = 'line-through';\n          node.name = 'span';\n          node.attr('style', styles.serialize(props));\n        });\n      });\n    };\n    var addFilters = function (domParser, settings) {\n      var styles = Styles();\n      if (settings.convert_fonts_to_spans) {\n        addFontToSpansFilter(domParser, styles, Tools.explode(settings.font_size_legacy_values));\n      }\n      addStrikeToSpanFilter(domParser, styles);\n    };\n    var register$1 = function (domParser, settings) {\n      if (settings.inline_styles) {\n        addFilters(domParser, settings);\n      }\n    };\n    var LegacyFilter = { register: register$1 };\n\n    var whiteSpaceRegExp$3 = /^[ \\t\\r\\n]*$/;\n    var typeLookup = {\n      '#text': 3,\n      '#comment': 8,\n      '#cdata': 4,\n      '#pi': 7,\n      '#doctype': 10,\n      '#document-fragment': 11\n    };\n    var walk$2 = function (node, root, prev) {\n      var sibling;\n      var parent;\n      var startName = prev ? 'lastChild' : 'firstChild';\n      var siblingName = prev ? 'prev' : 'next';\n      if (node[startName]) {\n        return node[startName];\n      }\n      if (node !== root) {\n        sibling = node[siblingName];\n        if (sibling) {\n          return sibling;\n        }\n        for (parent = node.parent; parent && parent !== root; parent = parent.parent) {\n          sibling = parent[siblingName];\n          if (sibling) {\n            return sibling;\n          }\n        }\n      }\n    };\n    var Node$1 = function () {\n      function Node(name, type) {\n        this.name = name;\n        this.type = type;\n        if (type === 1) {\n          this.attributes = [];\n          this.attributes.map = {};\n        }\n      }\n      Node.create = function (name, attrs) {\n        var node, attrName;\n        node = new Node(name, typeLookup[name] || 1);\n        if (attrs) {\n          for (attrName in attrs) {\n            node.attr(attrName, attrs[attrName]);\n          }\n        }\n        return node;\n      };\n      Node.prototype.replace = function (node) {\n        var self = this;\n        if (node.parent) {\n          node.remove();\n        }\n        self.insert(node, self);\n        self.remove();\n        return self;\n      };\n      Node.prototype.attr = function (name, value) {\n        var self = this;\n        var attrs, i;\n        if (typeof name !== 'string') {\n          for (i in name) {\n            self.attr(i, name[i]);\n          }\n          return self;\n        }\n        if (attrs = self.attributes) {\n          if (value !== undefined) {\n            if (value === null) {\n              if (name in attrs.map) {\n                delete attrs.map[name];\n                i = attrs.length;\n                while (i--) {\n                  if (attrs[i].name === name) {\n                    attrs = attrs.splice(i, 1);\n                    return self;\n                  }\n                }\n              }\n              return self;\n            }\n            if (name in attrs.map) {\n              i = attrs.length;\n              while (i--) {\n                if (attrs[i].name === name) {\n                  attrs[i].value = value;\n                  break;\n                }\n              }\n            } else {\n              attrs.push({\n                name: name,\n                value: value\n              });\n            }\n            attrs.map[name] = value;\n            return self;\n          }\n          return attrs.map[name];\n        }\n      };\n      Node.prototype.clone = function () {\n        var self = this;\n        var clone = new Node(self.name, self.type);\n        var i, l, selfAttrs, selfAttr, cloneAttrs;\n        if (selfAttrs = self.attributes) {\n          cloneAttrs = [];\n          cloneAttrs.map = {};\n          for (i = 0, l = selfAttrs.length; i < l; i++) {\n            selfAttr = selfAttrs[i];\n            if (selfAttr.name !== 'id') {\n              cloneAttrs[cloneAttrs.length] = {\n                name: selfAttr.name,\n                value: selfAttr.value\n              };\n              cloneAttrs.map[selfAttr.name] = selfAttr.value;\n            }\n          }\n          clone.attributes = cloneAttrs;\n        }\n        clone.value = self.value;\n        clone.shortEnded = self.shortEnded;\n        return clone;\n      };\n      Node.prototype.wrap = function (wrapper) {\n        var self = this;\n        self.parent.insert(wrapper, self);\n        wrapper.append(self);\n        return self;\n      };\n      Node.prototype.unwrap = function () {\n        var self = this;\n        var node, next;\n        for (node = self.firstChild; node;) {\n          next = node.next;\n          self.insert(node, self, true);\n          node = next;\n        }\n        self.remove();\n      };\n      Node.prototype.remove = function () {\n        var self = this, parent = self.parent, next = self.next, prev = self.prev;\n        if (parent) {\n          if (parent.firstChild === self) {\n            parent.firstChild = next;\n            if (next) {\n              next.prev = null;\n            }\n          } else {\n            prev.next = next;\n          }\n          if (parent.lastChild === self) {\n            parent.lastChild = prev;\n            if (prev) {\n              prev.next = null;\n            }\n          } else {\n            next.prev = prev;\n          }\n          self.parent = self.next = self.prev = null;\n        }\n        return self;\n      };\n      Node.prototype.append = function (node) {\n        var self = this;\n        var last;\n        if (node.parent) {\n          node.remove();\n        }\n        last = self.lastChild;\n        if (last) {\n          last.next = node;\n          node.prev = last;\n          self.lastChild = node;\n        } else {\n          self.lastChild = self.firstChild = node;\n        }\n        node.parent = self;\n        return node;\n      };\n      Node.prototype.insert = function (node, refNode, before) {\n        var parent;\n        if (node.parent) {\n          node.remove();\n        }\n        parent = refNode.parent || this;\n        if (before) {\n          if (refNode === parent.firstChild) {\n            parent.firstChild = node;\n          } else {\n            refNode.prev.next = node;\n          }\n          node.prev = refNode.prev;\n          node.next = refNode;\n          refNode.prev = node;\n        } else {\n          if (refNode === parent.lastChild) {\n            parent.lastChild = node;\n          } else {\n            refNode.next.prev = node;\n          }\n          node.next = refNode.next;\n          node.prev = refNode;\n          refNode.next = node;\n        }\n        node.parent = parent;\n        return node;\n      };\n      Node.prototype.getAll = function (name) {\n        var self = this;\n        var node;\n        var collection = [];\n        for (node = self.firstChild; node; node = walk$2(node, self)) {\n          if (node.name === name) {\n            collection.push(node);\n          }\n        }\n        return collection;\n      };\n      Node.prototype.empty = function () {\n        var self = this;\n        var nodes, i, node;\n        if (self.firstChild) {\n          nodes = [];\n          for (node = self.firstChild; node; node = walk$2(node, self)) {\n            nodes.push(node);\n          }\n          i = nodes.length;\n          while (i--) {\n            node = nodes[i];\n            node.parent = node.firstChild = node.lastChild = node.next = node.prev = null;\n          }\n        }\n        self.firstChild = self.lastChild = null;\n        return self;\n      };\n      Node.prototype.isEmpty = function (elements, whitespace, predicate) {\n        var self = this;\n        var node = self.firstChild, i, name;\n        whitespace = whitespace || {};\n        if (node) {\n          do {\n            if (node.type === 1) {\n              if (node.attributes.map['data-mce-bogus']) {\n                continue;\n              }\n              if (elements[node.name]) {\n                return false;\n              }\n              i = node.attributes.length;\n              while (i--) {\n                name = node.attributes[i].name;\n                if (name === 'name' || name.indexOf('data-mce-bookmark') === 0) {\n                  return false;\n                }\n              }\n            }\n            if (node.type === 8) {\n              return false;\n            }\n            if (node.type === 3 && !whiteSpaceRegExp$3.test(node.value)) {\n              return false;\n            }\n            if (node.type === 3 && node.parent && whitespace[node.parent.name] && whiteSpaceRegExp$3.test(node.value)) {\n              return false;\n            }\n            if (predicate && predicate(node)) {\n              return false;\n            }\n          } while (node = walk$2(node, self));\n        }\n        return true;\n      };\n      Node.prototype.walk = function (prev) {\n        return walk$2(this, null, prev);\n      };\n      return Node;\n    }();\n\n    var paddEmptyNode = function (settings, args, blockElements, node) {\n      var brPreferred = settings.padd_empty_with_br || args.insert;\n      if (brPreferred && blockElements[node.name]) {\n        node.empty().append(new Node$1('br', 1)).shortEnded = true;\n      } else {\n        node.empty().append(new Node$1('#text', 3)).value = '\\xA0';\n      }\n    };\n    var isPaddedWithNbsp = function (node) {\n      return hasOnlyChild(node, '#text') && node.firstChild.value === '\\xA0';\n    };\n    var hasOnlyChild = function (node, name) {\n      return node && node.firstChild && node.firstChild === node.lastChild && node.firstChild.name === name;\n    };\n    var isPadded = function (schema, node) {\n      var rule = schema.getElementRule(node.name);\n      return rule && rule.paddEmpty;\n    };\n    var isEmpty$2 = function (schema, nonEmptyElements, whitespaceElements, node) {\n      return node.isEmpty(nonEmptyElements, whitespaceElements, function (node) {\n        return isPadded(schema, node);\n      });\n    };\n    var isLineBreakNode = function (node, blockElements) {\n      return node && (blockElements[node.name] || node.name === 'br');\n    };\n\n    var register$2 = function (parser, settings) {\n      var schema = parser.schema;\n      if (settings.remove_trailing_brs) {\n        parser.addNodeFilter('br', function (nodes, _, args) {\n          var i;\n          var l = nodes.length;\n          var node;\n          var blockElements = Tools.extend({}, schema.getBlockElements());\n          var nonEmptyElements = schema.getNonEmptyElements();\n          var parent, lastParent, prev, prevName;\n          var whiteSpaceElements = schema.getWhiteSpaceElements();\n          var elementRule, textNode;\n          blockElements.body = 1;\n          for (i = 0; i < l; i++) {\n            node = nodes[i];\n            parent = node.parent;\n            if (blockElements[node.parent.name] && node === parent.lastChild) {\n              prev = node.prev;\n              while (prev) {\n                prevName = prev.name;\n                if (prevName !== 'span' || prev.attr('data-mce-type') !== 'bookmark') {\n                  if (prevName !== 'br') {\n                    break;\n                  }\n                  if (prevName === 'br') {\n                    node = null;\n                    break;\n                  }\n                }\n                prev = prev.prev;\n              }\n              if (node) {\n                node.remove();\n                if (isEmpty$2(schema, nonEmptyElements, whiteSpaceElements, parent)) {\n                  elementRule = schema.getElementRule(parent.name);\n                  if (elementRule) {\n                    if (elementRule.removeEmpty) {\n                      parent.remove();\n                    } else if (elementRule.paddEmpty) {\n                      paddEmptyNode(settings, args, blockElements, parent);\n                    }\n                  }\n                }\n              }\n            } else {\n              lastParent = node;\n              while (parent && parent.firstChild === lastParent && parent.lastChild === lastParent) {\n                lastParent = parent;\n                if (blockElements[parent.name]) {\n                  break;\n                }\n                parent = parent.parent;\n              }\n              if (lastParent === parent && settings.padd_empty_with_br !== true) {\n                textNode = new Node$1('#text', 3);\n                textNode.value = '\\xA0';\n                node.replace(textNode);\n              }\n            }\n          }\n        });\n      }\n      parser.addAttributeFilter('href', function (nodes) {\n        var i = nodes.length, node;\n        var appendRel = function (rel) {\n          var parts = rel.split(' ').filter(function (p) {\n            return p.length > 0;\n          });\n          return parts.concat(['noopener']).sort().join(' ');\n        };\n        var addNoOpener = function (rel) {\n          var newRel = rel ? Tools.trim(rel) : '';\n          if (!/\\b(noopener)\\b/g.test(newRel)) {\n            return appendRel(newRel);\n          } else {\n            return newRel;\n          }\n        };\n        if (!settings.allow_unsafe_link_target) {\n          while (i--) {\n            node = nodes[i];\n            if (node.name === 'a' && node.attr('target') === '_blank') {\n              node.attr('rel', addNoOpener(node.attr('rel')));\n            }\n          }\n        }\n      });\n      if (!settings.allow_html_in_named_anchor) {\n        parser.addAttributeFilter('id,name', function (nodes) {\n          var i = nodes.length, sibling, prevSibling, parent, node;\n          while (i--) {\n            node = nodes[i];\n            if (node.name === 'a' && node.firstChild && !node.attr('href')) {\n              parent = node.parent;\n              sibling = node.lastChild;\n              do {\n                prevSibling = sibling.prev;\n                parent.insert(sibling, node);\n                sibling = prevSibling;\n              } while (sibling);\n            }\n          }\n        });\n      }\n      if (settings.fix_list_elements) {\n        parser.addNodeFilter('ul,ol', function (nodes) {\n          var i = nodes.length, node, parentNode;\n          while (i--) {\n            node = nodes[i];\n            parentNode = node.parent;\n            if (parentNode.name === 'ul' || parentNode.name === 'ol') {\n              if (node.prev && node.prev.name === 'li') {\n                node.prev.append(node);\n              } else {\n                var li = new Node$1('li', 1);\n                li.attr('style', 'list-style-type: none');\n                node.wrap(li);\n              }\n            }\n          }\n        });\n      }\n      if (settings.validate && schema.getValidClasses()) {\n        parser.addAttributeFilter('class', function (nodes) {\n          var i = nodes.length, node, classList, ci, className, classValue;\n          var validClasses = schema.getValidClasses();\n          var validClassesMap, valid;\n          while (i--) {\n            node = nodes[i];\n            classList = node.attr('class').split(' ');\n            classValue = '';\n            for (ci = 0; ci < classList.length; ci++) {\n              className = classList[ci];\n              valid = false;\n              validClassesMap = validClasses['*'];\n              if (validClassesMap && validClassesMap[className]) {\n                valid = true;\n              }\n              validClassesMap = validClasses[node.name];\n              if (!valid && validClassesMap && validClassesMap[className]) {\n                valid = true;\n              }\n              if (valid) {\n                if (classValue) {\n                  classValue += ' ';\n                }\n                classValue += className;\n              }\n            }\n            if (!classValue.length) {\n              classValue = null;\n            }\n            node.attr('class', classValue);\n          }\n        });\n      }\n    };\n\n    var makeMap$4 = Tools.makeMap, each$i = Tools.each, explode$3 = Tools.explode, extend$3 = Tools.extend;\n    function DomParser (settings, schema) {\n      if (schema === void 0) {\n        schema = Schema();\n      }\n      var nodeFilters = {};\n      var attributeFilters = [];\n      var matchedNodes = {};\n      var matchedAttributes = {};\n      settings = settings || {};\n      settings.validate = 'validate' in settings ? settings.validate : true;\n      settings.root_name = settings.root_name || 'body';\n      var fixInvalidChildren = function (nodes) {\n        var ni, node, parent, parents, newParent, currentNode, tempNode, childNode, i;\n        var nonEmptyElements, whitespaceElements, nonSplitableElements, textBlockElements, specialElements, sibling, nextNode;\n        nonSplitableElements = makeMap$4('tr,td,th,tbody,thead,tfoot,table');\n        nonEmptyElements = schema.getNonEmptyElements();\n        whitespaceElements = schema.getWhiteSpaceElements();\n        textBlockElements = schema.getTextBlockElements();\n        specialElements = schema.getSpecialElements();\n        for (ni = 0; ni < nodes.length; ni++) {\n          node = nodes[ni];\n          if (!node.parent || node.fixed) {\n            continue;\n          }\n          if (textBlockElements[node.name] && node.parent.name === 'li') {\n            sibling = node.next;\n            while (sibling) {\n              if (textBlockElements[sibling.name]) {\n                sibling.name = 'li';\n                sibling.fixed = true;\n                node.parent.insert(sibling, node.parent);\n              } else {\n                break;\n              }\n              sibling = sibling.next;\n            }\n            node.unwrap(node);\n            continue;\n          }\n          parents = [node];\n          for (parent = node.parent; parent && !schema.isValidChild(parent.name, node.name) && !nonSplitableElements[parent.name]; parent = parent.parent) {\n            parents.push(parent);\n          }\n          if (parent && parents.length > 1) {\n            parents.reverse();\n            newParent = currentNode = filterNode(parents[0].clone());\n            for (i = 0; i < parents.length - 1; i++) {\n              if (schema.isValidChild(currentNode.name, parents[i].name)) {\n                tempNode = filterNode(parents[i].clone());\n                currentNode.append(tempNode);\n              } else {\n                tempNode = currentNode;\n              }\n              for (childNode = parents[i].firstChild; childNode && childNode !== parents[i + 1];) {\n                nextNode = childNode.next;\n                tempNode.append(childNode);\n                childNode = nextNode;\n              }\n              currentNode = tempNode;\n            }\n            if (!isEmpty$2(schema, nonEmptyElements, whitespaceElements, newParent)) {\n              parent.insert(newParent, parents[0], true);\n              parent.insert(node, newParent);\n            } else {\n              parent.insert(node, parents[0], true);\n            }\n            parent = parents[0];\n            if (isEmpty$2(schema, nonEmptyElements, whitespaceElements, parent) || hasOnlyChild(parent, 'br')) {\n              parent.empty().remove();\n            }\n          } else if (node.parent) {\n            if (node.name === 'li') {\n              sibling = node.prev;\n              if (sibling && (sibling.name === 'ul' || sibling.name === 'ul')) {\n                sibling.append(node);\n                continue;\n              }\n              sibling = node.next;\n              if (sibling && (sibling.name === 'ul' || sibling.name === 'ul')) {\n                sibling.insert(node, sibling.firstChild, true);\n                continue;\n              }\n              node.wrap(filterNode(new Node$1('ul', 1)));\n              continue;\n            }\n            if (schema.isValidChild(node.parent.name, 'div') && schema.isValidChild('div', node.name)) {\n              node.wrap(filterNode(new Node$1('div', 1)));\n            } else {\n              if (specialElements[node.name]) {\n                node.empty().remove();\n              } else {\n                node.unwrap();\n              }\n            }\n          }\n        }\n      };\n      var filterNode = function (node) {\n        var i, name, list;\n        name = node.name;\n        if (name in nodeFilters) {\n          list = matchedNodes[name];\n          if (list) {\n            list.push(node);\n          } else {\n            matchedNodes[name] = [node];\n          }\n        }\n        i = attributeFilters.length;\n        while (i--) {\n          name = attributeFilters[i].name;\n          if (name in node.attributes.map) {\n            list = matchedAttributes[name];\n            if (list) {\n              list.push(node);\n            } else {\n              matchedAttributes[name] = [node];\n            }\n          }\n        }\n        return node;\n      };\n      var addNodeFilter = function (name, callback) {\n        each$i(explode$3(name), function (name) {\n          var list = nodeFilters[name];\n          if (!list) {\n            nodeFilters[name] = list = [];\n          }\n          list.push(callback);\n        });\n      };\n      var getNodeFilters = function () {\n        var out = [];\n        for (var name in nodeFilters) {\n          if (nodeFilters.hasOwnProperty(name)) {\n            out.push({\n              name: name,\n              callbacks: nodeFilters[name]\n            });\n          }\n        }\n        return out;\n      };\n      var addAttributeFilter = function (name, callback) {\n        each$i(explode$3(name), function (name) {\n          var i;\n          for (i = 0; i < attributeFilters.length; i++) {\n            if (attributeFilters[i].name === name) {\n              attributeFilters[i].callbacks.push(callback);\n              return;\n            }\n          }\n          attributeFilters.push({\n            name: name,\n            callbacks: [callback]\n          });\n        });\n      };\n      var getAttributeFilters = function () {\n        return [].concat(attributeFilters);\n      };\n      var parse = function (html, args) {\n        var parser, nodes, i, l, fi, fl, list, name;\n        var blockElements;\n        var invalidChildren = [];\n        var isInWhiteSpacePreservedElement;\n        var node;\n        args = args || {};\n        matchedNodes = {};\n        matchedAttributes = {};\n        blockElements = extend$3(makeMap$4('script,style,head,html,body,title,meta,param'), schema.getBlockElements());\n        var nonEmptyElements = schema.getNonEmptyElements();\n        var children = schema.children;\n        var validate = settings.validate;\n        var rootBlockName = 'forced_root_block' in args ? args.forced_root_block : settings.forced_root_block;\n        var whiteSpaceElements = schema.getWhiteSpaceElements();\n        var startWhiteSpaceRegExp = /^[ \\t\\r\\n]+/;\n        var endWhiteSpaceRegExp = /[ \\t\\r\\n]+$/;\n        var allWhiteSpaceRegExp = /[ \\t\\r\\n]+/g;\n        var isAllWhiteSpaceRegExp = /^[ \\t\\r\\n]+$/;\n        isInWhiteSpacePreservedElement = whiteSpaceElements.hasOwnProperty(args.context) || whiteSpaceElements.hasOwnProperty(settings.root_name);\n        var addRootBlocks = function () {\n          var node = rootNode.firstChild, next, rootBlockNode;\n          var trim = function (rootBlockNode) {\n            if (rootBlockNode) {\n              node = rootBlockNode.firstChild;\n              if (node && node.type === 3) {\n                node.value = node.value.replace(startWhiteSpaceRegExp, '');\n              }\n              node = rootBlockNode.lastChild;\n              if (node && node.type === 3) {\n                node.value = node.value.replace(endWhiteSpaceRegExp, '');\n              }\n            }\n          };\n          if (!schema.isValidChild(rootNode.name, rootBlockName.toLowerCase())) {\n            return;\n          }\n          while (node) {\n            next = node.next;\n            if (node.type === 3 || node.type === 1 && node.name !== 'p' && !blockElements[node.name] && !node.attr('data-mce-type')) {\n              if (!rootBlockNode) {\n                rootBlockNode = createNode(rootBlockName, 1);\n                rootBlockNode.attr(settings.forced_root_block_attrs);\n                rootNode.insert(rootBlockNode, node);\n                rootBlockNode.append(node);\n              } else {\n                rootBlockNode.append(node);\n              }\n            } else {\n              trim(rootBlockNode);\n              rootBlockNode = null;\n            }\n            node = next;\n          }\n          trim(rootBlockNode);\n        };\n        var createNode = function (name, type) {\n          var node = new Node$1(name, type);\n          var list;\n          if (name in nodeFilters) {\n            list = matchedNodes[name];\n            if (list) {\n              list.push(node);\n            } else {\n              matchedNodes[name] = [node];\n            }\n          }\n          return node;\n        };\n        var removeWhitespaceBefore = function (node) {\n          var textNode, textNodeNext, textVal, sibling;\n          var blockElements = schema.getBlockElements();\n          for (textNode = node.prev; textNode && textNode.type === 3;) {\n            textVal = textNode.value.replace(endWhiteSpaceRegExp, '');\n            if (textVal.length > 0) {\n              textNode.value = textVal;\n              return;\n            }\n            textNodeNext = textNode.next;\n            if (textNodeNext) {\n              if (textNodeNext.type === 3 && textNodeNext.value.length) {\n                textNode = textNode.prev;\n                continue;\n              }\n              if (!blockElements[textNodeNext.name] && textNodeNext.name !== 'script' && textNodeNext.name !== 'style') {\n                textNode = textNode.prev;\n                continue;\n              }\n            }\n            sibling = textNode.prev;\n            textNode.remove();\n            textNode = sibling;\n          }\n        };\n        var cloneAndExcludeBlocks = function (input) {\n          var name;\n          var output = {};\n          for (name in input) {\n            if (name !== 'li' && name !== 'p') {\n              output[name] = input[name];\n            }\n          }\n          return output;\n        };\n        parser = SaxParser$1({\n          validate: validate,\n          allow_script_urls: settings.allow_script_urls,\n          allow_conditional_comments: settings.allow_conditional_comments,\n          self_closing_elements: cloneAndExcludeBlocks(schema.getSelfClosingElements()),\n          cdata: function (text) {\n            node.append(createNode('#cdata', 4)).value = text;\n          },\n          text: function (text, raw) {\n            var textNode;\n            if (!isInWhiteSpacePreservedElement) {\n              text = text.replace(allWhiteSpaceRegExp, ' ');\n              if (isLineBreakNode(node.lastChild, blockElements)) {\n                text = text.replace(startWhiteSpaceRegExp, '');\n              }\n            }\n            if (text.length !== 0) {\n              textNode = createNode('#text', 3);\n              textNode.raw = !!raw;\n              node.append(textNode).value = text;\n            }\n          },\n          comment: function (text) {\n            node.append(createNode('#comment', 8)).value = text;\n          },\n          pi: function (name, text) {\n            node.append(createNode(name, 7)).value = text;\n            removeWhitespaceBefore(node);\n          },\n          doctype: function (text) {\n            var newNode;\n            newNode = node.append(createNode('#doctype', 10));\n            newNode.value = text;\n            removeWhitespaceBefore(node);\n          },\n          start: function (name, attrs, empty) {\n            var newNode, attrFiltersLen, elementRule, attrName, parent;\n            elementRule = validate ? schema.getElementRule(name) : {};\n            if (elementRule) {\n              newNode = createNode(elementRule.outputName || name, 1);\n              newNode.attributes = attrs;\n              newNode.shortEnded = empty;\n              node.append(newNode);\n              parent = children[node.name];\n              if (parent && children[newNode.name] && !parent[newNode.name]) {\n                invalidChildren.push(newNode);\n              }\n              attrFiltersLen = attributeFilters.length;\n              while (attrFiltersLen--) {\n                attrName = attributeFilters[attrFiltersLen].name;\n                if (attrName in attrs.map) {\n                  list = matchedAttributes[attrName];\n                  if (list) {\n                    list.push(newNode);\n                  } else {\n                    matchedAttributes[attrName] = [newNode];\n                  }\n                }\n              }\n              if (blockElements[name]) {\n                removeWhitespaceBefore(newNode);\n              }\n              if (!empty) {\n                node = newNode;\n              }\n              if (!isInWhiteSpacePreservedElement && whiteSpaceElements[name]) {\n                isInWhiteSpacePreservedElement = true;\n              }\n            }\n          },\n          end: function (name) {\n            var textNode, elementRule, text, sibling, tempNode;\n            elementRule = validate ? schema.getElementRule(name) : {};\n            if (elementRule) {\n              if (blockElements[name]) {\n                if (!isInWhiteSpacePreservedElement) {\n                  textNode = node.firstChild;\n                  if (textNode && textNode.type === 3) {\n                    text = textNode.value.replace(startWhiteSpaceRegExp, '');\n                    if (text.length > 0) {\n                      textNode.value = text;\n                      textNode = textNode.next;\n                    } else {\n                      sibling = textNode.next;\n                      textNode.remove();\n                      textNode = sibling;\n                      while (textNode && textNode.type === 3) {\n                        text = textNode.value;\n                        sibling = textNode.next;\n                        if (text.length === 0 || isAllWhiteSpaceRegExp.test(text)) {\n                          textNode.remove();\n                          textNode = sibling;\n                        }\n                        textNode = sibling;\n                      }\n                    }\n                  }\n                  textNode = node.lastChild;\n                  if (textNode && textNode.type === 3) {\n                    text = textNode.value.replace(endWhiteSpaceRegExp, '');\n                    if (text.length > 0) {\n                      textNode.value = text;\n                      textNode = textNode.prev;\n                    } else {\n                      sibling = textNode.prev;\n                      textNode.remove();\n                      textNode = sibling;\n                      while (textNode && textNode.type === 3) {\n                        text = textNode.value;\n                        sibling = textNode.prev;\n                        if (text.length === 0 || isAllWhiteSpaceRegExp.test(text)) {\n                          textNode.remove();\n                          textNode = sibling;\n                        }\n                        textNode = sibling;\n                      }\n                    }\n                  }\n                }\n              }\n              if (isInWhiteSpacePreservedElement && whiteSpaceElements[name]) {\n                isInWhiteSpacePreservedElement = false;\n              }\n              if (elementRule.removeEmpty && isEmpty$2(schema, nonEmptyElements, whiteSpaceElements, node)) {\n                if (!node.attributes.map.name && !node.attr('id')) {\n                  tempNode = node.parent;\n                  if (blockElements[node.name]) {\n                    node.empty().remove();\n                  } else {\n                    node.unwrap();\n                  }\n                  node = tempNode;\n                  return;\n                }\n              }\n              if (elementRule.paddEmpty && (isPaddedWithNbsp(node) || isEmpty$2(schema, nonEmptyElements, whiteSpaceElements, node))) {\n                paddEmptyNode(settings, args, blockElements, node);\n              }\n              node = node.parent;\n            }\n          }\n        }, schema);\n        var rootNode = node = new Node$1(args.context || settings.root_name, 11);\n        parser.parse(html);\n        if (validate && invalidChildren.length) {\n          if (!args.context) {\n            fixInvalidChildren(invalidChildren);\n          } else {\n            args.invalid = true;\n          }\n        }\n        if (rootBlockName && (rootNode.name === 'body' || args.isRootContent)) {\n          addRootBlocks();\n        }\n        if (!args.invalid) {\n          for (name in matchedNodes) {\n            list = nodeFilters[name];\n            nodes = matchedNodes[name];\n            fi = nodes.length;\n            while (fi--) {\n              if (!nodes[fi].parent) {\n                nodes.splice(fi, 1);\n              }\n            }\n            for (i = 0, l = list.length; i < l; i++) {\n              list[i](nodes, name, args);\n            }\n          }\n          for (i = 0, l = attributeFilters.length; i < l; i++) {\n            list = attributeFilters[i];\n            if (list.name in matchedAttributes) {\n              nodes = matchedAttributes[list.name];\n              fi = nodes.length;\n              while (fi--) {\n                if (!nodes[fi].parent) {\n                  nodes.splice(fi, 1);\n                }\n              }\n              for (fi = 0, fl = list.callbacks.length; fi < fl; fi++) {\n                list.callbacks[fi](nodes, list.name, args);\n              }\n            }\n          }\n        }\n        return rootNode;\n      };\n      var exports = {\n        schema: schema,\n        addAttributeFilter: addAttributeFilter,\n        getAttributeFilters: getAttributeFilters,\n        addNodeFilter: addNodeFilter,\n        getNodeFilters: getNodeFilters,\n        filterNode: filterNode,\n        parse: parse\n      };\n      register$2(exports, settings);\n      LegacyFilter.register(exports, settings);\n      return exports;\n    }\n\n    var addTempAttr = function (htmlParser, tempAttrs, name) {\n      if (Tools.inArray(tempAttrs, name) === -1) {\n        htmlParser.addAttributeFilter(name, function (nodes, name) {\n          var i = nodes.length;\n          while (i--) {\n            nodes[i].attr(name, null);\n          }\n        });\n        tempAttrs.push(name);\n      }\n    };\n    var postProcess$1 = function (editor, args, content) {\n      if (!args.no_events && editor) {\n        var outArgs = Events.firePostProcess(editor, merge(args, { content: content }));\n        return outArgs.content;\n      } else {\n        return content;\n      }\n    };\n    var getHtmlFromNode = function (dom, node, args) {\n      var html = Zwsp.trim(args.getInner ? node.innerHTML : dom.getOuterHTML(node));\n      return args.selection || isWsPreserveElement(Element.fromDom(node)) ? html : Tools.trim(html);\n    };\n    var parseHtml = function (htmlParser, html, args) {\n      var parserArgs = args.selection ? merge({ forced_root_block: false }, args) : args;\n      var rootNode = htmlParser.parse(html, parserArgs);\n      DomSerializerFilters.trimTrailingBr(rootNode);\n      return rootNode;\n    };\n    var serializeNode = function (settings, schema, node) {\n      var htmlSerializer = HtmlSerializer(settings, schema);\n      return htmlSerializer.serialize(node);\n    };\n    var toHtml = function (editor, settings, schema, rootNode, args) {\n      var content = serializeNode(settings, schema, rootNode);\n      return postProcess$1(editor, args, content);\n    };\n    function DomSerializer (settings, editor) {\n      var dom, schema, htmlParser;\n      var tempAttrs = ['data-mce-selected'];\n      dom = editor && editor.dom ? editor.dom : DOMUtils$1.DOM;\n      schema = editor && editor.schema ? editor.schema : Schema(settings);\n      settings.entity_encoding = settings.entity_encoding || 'named';\n      settings.remove_trailing_brs = 'remove_trailing_brs' in settings ? settings.remove_trailing_brs : true;\n      htmlParser = DomParser(settings, schema);\n      DomSerializerFilters.register(htmlParser, settings, dom);\n      var serialize = function (node, parserArgs) {\n        var args = merge({ format: 'html' }, parserArgs ? parserArgs : {});\n        var targetNode = DomSerializerPreProcess.process(editor, node, args);\n        var html = getHtmlFromNode(dom, targetNode, args);\n        var rootNode = parseHtml(htmlParser, html, args);\n        return args.format === 'tree' ? rootNode : toHtml(editor, settings, schema, rootNode, args);\n      };\n      return {\n        schema: schema,\n        addNodeFilter: htmlParser.addNodeFilter,\n        addAttributeFilter: htmlParser.addAttributeFilter,\n        serialize: serialize,\n        addRules: function (rules) {\n          schema.addValidElements(rules);\n        },\n        setRules: function (rules) {\n          schema.setValidElements(rules);\n        },\n        addTempAttr: curry(addTempAttr, htmlParser, tempAttrs),\n        getTempAttrs: function () {\n          return tempAttrs;\n        }\n      };\n    }\n\n    function DomSerializer$1 (settings, editor) {\n      var domSerializer = DomSerializer(settings, editor);\n      return {\n        schema: domSerializer.schema,\n        addNodeFilter: domSerializer.addNodeFilter,\n        addAttributeFilter: domSerializer.addAttributeFilter,\n        serialize: domSerializer.serialize,\n        addRules: domSerializer.addRules,\n        setRules: domSerializer.setRules,\n        addTempAttr: domSerializer.addTempAttr,\n        getTempAttrs: domSerializer.getTempAttrs\n      };\n    }\n\n    function BookmarkManager(selection) {\n      return {\n        getBookmark: curry(Bookmarks.getBookmark, selection),\n        moveToBookmark: curry(Bookmarks.moveToBookmark, selection)\n      };\n    }\n    (function (BookmarkManager) {\n      BookmarkManager.isBookmarkNode = Bookmarks.isBookmarkNode;\n    }(BookmarkManager || (BookmarkManager = {})));\n    var BookmarkManager$1 = BookmarkManager;\n\n    var isContentEditableFalse$a = NodeType.isContentEditableFalse;\n    var isContentEditableTrue$5 = NodeType.isContentEditableTrue;\n    var getContentEditableRoot$2 = function (root, node) {\n      while (node && node !== root) {\n        if (isContentEditableTrue$5(node) || isContentEditableFalse$a(node)) {\n          return node;\n        }\n        node = node.parentNode;\n      }\n      return null;\n    };\n    var ControlSelection = function (selection, editor) {\n      var dom = editor.dom, each = Tools.each;\n      var selectedElm, selectedElmGhost, resizeHelper, resizeHandles, selectedHandle;\n      var startX, startY, selectedElmX, selectedElmY, startW, startH, ratio, resizeStarted;\n      var width, height;\n      var editableDoc = editor.getDoc(), rootDocument = domGlobals.document;\n      var abs = Math.abs, round = Math.round, rootElement = editor.getBody();\n      var startScrollWidth, startScrollHeight;\n      resizeHandles = {\n        nw: [\n          0,\n          0,\n          -1,\n          -1\n        ],\n        ne: [\n          1,\n          0,\n          1,\n          -1\n        ],\n        se: [\n          1,\n          1,\n          1,\n          1\n        ],\n        sw: [\n          0,\n          1,\n          -1,\n          1\n        ]\n      };\n      var rootClass = '.mce-content-body';\n      editor.contentStyles.push(rootClass + ' div.mce-resizehandle {' + 'position: absolute;' + 'border: 1px solid black;' + 'box-sizing: content-box;' + 'background: #FFF;' + 'width: 7px;' + 'height: 7px;' + 'z-index: 10000' + '}' + rootClass + ' .mce-resizehandle:hover {' + 'background: #000' + '}' + rootClass + ' img[data-mce-selected],' + rootClass + ' hr[data-mce-selected] {' + 'outline: 1px solid black;' + 'resize: none' + '}' + rootClass + ' .mce-clonedresizable {' + 'position: absolute;' + (Env.gecko ? '' : 'outline: 1px dashed black;') + 'opacity: .5;' + 'filter: alpha(opacity=50);' + 'z-index: 10000' + '}' + rootClass + ' .mce-resize-helper {' + 'background: #555;' + 'background: rgba(0,0,0,0.75);' + 'border-radius: 3px;' + 'border: 1px;' + 'color: white;' + 'display: none;' + 'font-family: sans-serif;' + 'font-size: 12px;' + 'white-space: nowrap;' + 'line-height: 14px;' + 'margin: 5px 10px;' + 'padding: 5px;' + 'position: absolute;' + 'z-index: 10001' + '}');\n      var isImage = function (elm) {\n        return elm && (elm.nodeName === 'IMG' || editor.dom.is(elm, 'figure.image'));\n      };\n      var isEventOnImageOutsideRange = function (evt, range) {\n        return isImage(evt.target) && !RangePoint.isXYWithinRange(evt.clientX, evt.clientY, range);\n      };\n      var contextMenuSelectImage = function (evt) {\n        var target = evt.target;\n        if (isEventOnImageOutsideRange(evt, editor.selection.getRng()) && !evt.isDefaultPrevented()) {\n          editor.selection.select(target);\n        }\n      };\n      var getResizeTarget = function (elm) {\n        return editor.dom.is(elm, 'figure.image') ? elm.querySelector('img') : elm;\n      };\n      var isResizable = function (elm) {\n        var selector = editor.settings.object_resizing;\n        if (selector === false || Env.iOS) {\n          return false;\n        }\n        if (typeof selector !== 'string') {\n          selector = 'table,img,figure.image,div';\n        }\n        if (elm.getAttribute('data-mce-resize') === 'false') {\n          return false;\n        }\n        if (elm === editor.getBody()) {\n          return false;\n        }\n        return is$1(Element.fromDom(elm), selector);\n      };\n      var resizeGhostElement = function (e) {\n        var deltaX, deltaY, proportional;\n        var resizeHelperX, resizeHelperY;\n        deltaX = e.screenX - startX;\n        deltaY = e.screenY - startY;\n        width = deltaX * selectedHandle[2] + startW;\n        height = deltaY * selectedHandle[3] + startH;\n        width = width < 5 ? 5 : width;\n        height = height < 5 ? 5 : height;\n        if (isImage(selectedElm) && editor.settings.resize_img_proportional !== false) {\n          proportional = !VK.modifierPressed(e);\n        } else {\n          proportional = VK.modifierPressed(e) || isImage(selectedElm) && selectedHandle[2] * selectedHandle[3] !== 0;\n        }\n        if (proportional) {\n          if (abs(deltaX) > abs(deltaY)) {\n            height = round(width * ratio);\n            width = round(height / ratio);\n          } else {\n            width = round(height / ratio);\n            height = round(width * ratio);\n          }\n        }\n        dom.setStyles(getResizeTarget(selectedElmGhost), {\n          width: width,\n          height: height\n        });\n        resizeHelperX = selectedHandle.startPos.x + deltaX;\n        resizeHelperY = selectedHandle.startPos.y + deltaY;\n        resizeHelperX = resizeHelperX > 0 ? resizeHelperX : 0;\n        resizeHelperY = resizeHelperY > 0 ? resizeHelperY : 0;\n        dom.setStyles(resizeHelper, {\n          left: resizeHelperX,\n          top: resizeHelperY,\n          display: 'block'\n        });\n        resizeHelper.innerHTML = width + ' &times; ' + height;\n        if (selectedHandle[2] < 0 && selectedElmGhost.clientWidth <= width) {\n          dom.setStyle(selectedElmGhost, 'left', selectedElmX + (startW - width));\n        }\n        if (selectedHandle[3] < 0 && selectedElmGhost.clientHeight <= height) {\n          dom.setStyle(selectedElmGhost, 'top', selectedElmY + (startH - height));\n        }\n        deltaX = rootElement.scrollWidth - startScrollWidth;\n        deltaY = rootElement.scrollHeight - startScrollHeight;\n        if (deltaX + deltaY !== 0) {\n          dom.setStyles(resizeHelper, {\n            left: resizeHelperX - deltaX,\n            top: resizeHelperY - deltaY\n          });\n        }\n        if (!resizeStarted) {\n          Events.fireObjectResizeStart(editor, selectedElm, startW, startH);\n          resizeStarted = true;\n        }\n      };\n      var endGhostResize = function () {\n        resizeStarted = false;\n        var setSizeProp = function (name, value) {\n          if (value) {\n            if (selectedElm.style[name] || !editor.schema.isValid(selectedElm.nodeName.toLowerCase(), name)) {\n              dom.setStyle(getResizeTarget(selectedElm), name, value);\n            } else {\n              dom.setAttrib(getResizeTarget(selectedElm), name, value);\n            }\n          }\n        };\n        setSizeProp('width', width);\n        setSizeProp('height', height);\n        dom.unbind(editableDoc, 'mousemove', resizeGhostElement);\n        dom.unbind(editableDoc, 'mouseup', endGhostResize);\n        if (rootDocument !== editableDoc) {\n          dom.unbind(rootDocument, 'mousemove', resizeGhostElement);\n          dom.unbind(rootDocument, 'mouseup', endGhostResize);\n        }\n        dom.remove(selectedElmGhost);\n        dom.remove(resizeHelper);\n        showResizeRect(selectedElm);\n        Events.fireObjectResized(editor, selectedElm, width, height);\n        dom.setAttrib(selectedElm, 'style', dom.getAttrib(selectedElm, 'style'));\n        editor.nodeChanged();\n      };\n      var showResizeRect = function (targetElm) {\n        var position, targetWidth, targetHeight, e, rect;\n        hideResizeRect();\n        unbindResizeHandleEvents();\n        position = dom.getPos(targetElm, rootElement);\n        selectedElmX = position.x;\n        selectedElmY = position.y;\n        rect = targetElm.getBoundingClientRect();\n        targetWidth = rect.width || rect.right - rect.left;\n        targetHeight = rect.height || rect.bottom - rect.top;\n        if (selectedElm !== targetElm) {\n          selectedElm = targetElm;\n          width = height = 0;\n        }\n        e = editor.fire('ObjectSelected', { target: targetElm });\n        if (isResizable(targetElm) && !e.isDefaultPrevented()) {\n          each(resizeHandles, function (handle, name) {\n            var handleElm;\n            var startDrag = function (e) {\n              startX = e.screenX;\n              startY = e.screenY;\n              startW = getResizeTarget(selectedElm).clientWidth;\n              startH = getResizeTarget(selectedElm).clientHeight;\n              ratio = startH / startW;\n              selectedHandle = handle;\n              handle.startPos = {\n                x: targetWidth * handle[0] + selectedElmX,\n                y: targetHeight * handle[1] + selectedElmY\n              };\n              startScrollWidth = rootElement.scrollWidth;\n              startScrollHeight = rootElement.scrollHeight;\n              selectedElmGhost = selectedElm.cloneNode(true);\n              dom.addClass(selectedElmGhost, 'mce-clonedresizable');\n              dom.setAttrib(selectedElmGhost, 'data-mce-bogus', 'all');\n              selectedElmGhost.contentEditable = false;\n              selectedElmGhost.unSelectabe = true;\n              dom.setStyles(selectedElmGhost, {\n                left: selectedElmX,\n                top: selectedElmY,\n                margin: 0\n              });\n              selectedElmGhost.removeAttribute('data-mce-selected');\n              rootElement.appendChild(selectedElmGhost);\n              dom.bind(editableDoc, 'mousemove', resizeGhostElement);\n              dom.bind(editableDoc, 'mouseup', endGhostResize);\n              if (rootDocument !== editableDoc) {\n                dom.bind(rootDocument, 'mousemove', resizeGhostElement);\n                dom.bind(rootDocument, 'mouseup', endGhostResize);\n              }\n              resizeHelper = dom.add(rootElement, 'div', {\n                'class': 'mce-resize-helper',\n                'data-mce-bogus': 'all'\n              }, startW + ' &times; ' + startH);\n            };\n            handleElm = dom.get('mceResizeHandle' + name);\n            if (handleElm) {\n              dom.remove(handleElm);\n            }\n            handleElm = dom.add(rootElement, 'div', {\n              'id': 'mceResizeHandle' + name,\n              'data-mce-bogus': 'all',\n              'class': 'mce-resizehandle',\n              'unselectable': true,\n              'style': 'cursor:' + name + '-resize; margin:0; padding:0'\n            });\n            if (Env.ie === 11) {\n              handleElm.contentEditable = false;\n            }\n            dom.bind(handleElm, 'mousedown', function (e) {\n              e.stopImmediatePropagation();\n              e.preventDefault();\n              startDrag(e);\n            });\n            handle.elm = handleElm;\n            dom.setStyles(handleElm, {\n              left: targetWidth * handle[0] + selectedElmX - handleElm.offsetWidth / 2,\n              top: targetHeight * handle[1] + selectedElmY - handleElm.offsetHeight / 2\n            });\n          });\n        } else {\n          hideResizeRect();\n        }\n        selectedElm.setAttribute('data-mce-selected', '1');\n      };\n      var hideResizeRect = function () {\n        var name, handleElm;\n        unbindResizeHandleEvents();\n        if (selectedElm) {\n          selectedElm.removeAttribute('data-mce-selected');\n        }\n        for (name in resizeHandles) {\n          handleElm = dom.get('mceResizeHandle' + name);\n          if (handleElm) {\n            dom.unbind(handleElm);\n            dom.remove(handleElm);\n          }\n        }\n      };\n      var updateResizeRect = function (e) {\n        var startElm, controlElm;\n        var isChildOrEqual = function (node, parent) {\n          if (node) {\n            do {\n              if (node === parent) {\n                return true;\n              }\n            } while (node = node.parentNode);\n          }\n        };\n        if (resizeStarted || editor.removed) {\n          return;\n        }\n        each(dom.select('img[data-mce-selected],hr[data-mce-selected]'), function (img) {\n          img.removeAttribute('data-mce-selected');\n        });\n        controlElm = e.type === 'mousedown' ? e.target : selection.getNode();\n        controlElm = dom.$(controlElm).closest('table,img,figure.image,hr')[0];\n        if (isChildOrEqual(controlElm, rootElement)) {\n          disableGeckoResize();\n          startElm = selection.getStart(true);\n          if (isChildOrEqual(startElm, controlElm) && isChildOrEqual(selection.getEnd(true), controlElm)) {\n            showResizeRect(controlElm);\n            return;\n          }\n        }\n        hideResizeRect();\n      };\n      var isWithinContentEditableFalse = function (elm) {\n        return isContentEditableFalse$a(getContentEditableRoot$2(editor.getBody(), elm));\n      };\n      var unbindResizeHandleEvents = function () {\n        for (var name in resizeHandles) {\n          var handle = resizeHandles[name];\n          if (handle.elm) {\n            dom.unbind(handle.elm);\n            delete handle.elm;\n          }\n        }\n      };\n      var disableGeckoResize = function () {\n        try {\n          editor.getDoc().execCommand('enableObjectResizing', false, false);\n        } catch (ex) {\n        }\n      };\n      editor.on('init', function () {\n        disableGeckoResize();\n        if (Env.ie && Env.ie >= 11) {\n          editor.on('mousedown click', function (e) {\n            var target = e.target, nodeName = target.nodeName;\n            if (!resizeStarted && /^(TABLE|IMG|HR)$/.test(nodeName) && !isWithinContentEditableFalse(target)) {\n              if (e.button !== 2) {\n                editor.selection.select(target, nodeName === 'TABLE');\n              }\n              if (e.type === 'mousedown') {\n                editor.nodeChanged();\n              }\n            }\n          });\n          editor.dom.bind(rootElement, 'mscontrolselect', function (e) {\n            var delayedSelect = function (node) {\n              Delay.setEditorTimeout(editor, function () {\n                editor.selection.select(node);\n              });\n            };\n            if (isWithinContentEditableFalse(e.target)) {\n              e.preventDefault();\n              delayedSelect(e.target);\n              return;\n            }\n            if (/^(TABLE|IMG|HR)$/.test(e.target.nodeName)) {\n              e.preventDefault();\n              if (e.target.tagName === 'IMG') {\n                delayedSelect(e.target);\n              }\n            }\n          });\n        }\n        var throttledUpdateResizeRect = Delay.throttle(function (e) {\n          if (!editor.composing) {\n            updateResizeRect(e);\n          }\n        });\n        editor.on('nodechange ResizeEditor ResizeWindow drop FullscreenStateChanged', throttledUpdateResizeRect);\n        editor.on('keyup compositionend', function (e) {\n          if (selectedElm && selectedElm.nodeName === 'TABLE') {\n            throttledUpdateResizeRect(e);\n          }\n        });\n        editor.on('hide blur', hideResizeRect);\n        editor.on('contextmenu', contextMenuSelectImage);\n      });\n      editor.on('remove', unbindResizeHandleEvents);\n      var destroy = function () {\n        selectedElm = selectedElmGhost = null;\n      };\n      return {\n        isResizable: isResizable,\n        showResizeRect: showResizeRect,\n        hideResizeRect: hideResizeRect,\n        updateResizeRect: updateResizeRect,\n        destroy: destroy\n      };\n    };\n\n    var hasCeProperty = function (node) {\n      return NodeType.isContentEditableTrue(node) || NodeType.isContentEditableFalse(node);\n    };\n    var findParent$1 = function (node, rootNode, predicate) {\n      while (node && node !== rootNode) {\n        if (predicate(node)) {\n          return node;\n        }\n        node = node.parentNode;\n      }\n      return null;\n    };\n    var findClosestIeRange = function (clientX, clientY, doc) {\n      var element, rng, rects;\n      element = doc.elementFromPoint(clientX, clientY);\n      rng = doc.body.createTextRange();\n      if (!element || element.tagName === 'HTML') {\n        element = doc.body;\n      }\n      rng.moveToElementText(element);\n      rects = Tools.toArray(rng.getClientRects());\n      rects = rects.sort(function (a, b) {\n        a = Math.abs(Math.max(a.top - clientY, a.bottom - clientY));\n        b = Math.abs(Math.max(b.top - clientY, b.bottom - clientY));\n        return a - b;\n      });\n      if (rects.length > 0) {\n        clientY = (rects[0].bottom + rects[0].top) / 2;\n        try {\n          rng.moveToPoint(clientX, clientY);\n          rng.collapse(true);\n          return rng;\n        } catch (ex) {\n        }\n      }\n      return null;\n    };\n    var moveOutOfContentEditableFalse = function (rng, rootNode) {\n      var parentElement = rng && rng.parentElement ? rng.parentElement() : null;\n      return NodeType.isContentEditableFalse(findParent$1(parentElement, rootNode, hasCeProperty)) ? null : rng;\n    };\n    var fromPoint$1 = function (clientX, clientY, doc) {\n      var rng, point;\n      var pointDoc = doc;\n      if (pointDoc.caretPositionFromPoint) {\n        point = pointDoc.caretPositionFromPoint(clientX, clientY);\n        if (point) {\n          rng = doc.createRange();\n          rng.setStart(point.offsetNode, point.offset);\n          rng.collapse(true);\n        }\n      } else if (doc.caretRangeFromPoint) {\n        rng = doc.caretRangeFromPoint(clientX, clientY);\n      } else if (pointDoc.body.createTextRange) {\n        rng = pointDoc.body.createTextRange();\n        try {\n          rng.moveToPoint(clientX, clientY);\n          rng.collapse(true);\n        } catch (ex) {\n          rng = findClosestIeRange(clientX, clientY, doc);\n        }\n        return moveOutOfContentEditableFalse(rng, doc.body);\n      }\n      return rng;\n    };\n    var CaretRangeFromPoint = { fromPoint: fromPoint$1 };\n\n    var processRanges = function (editor, ranges) {\n      return map(ranges, function (range) {\n        var evt = editor.fire('GetSelectionRange', { range: range });\n        return evt.range !== range ? evt.range : range;\n      });\n    };\n    var EventProcessRanges = { processRanges: processRanges };\n\n    var fromElements = function (elements, scope) {\n      var doc = scope || domGlobals.document;\n      var fragment = doc.createDocumentFragment();\n      each(elements, function (element) {\n        fragment.appendChild(element.dom());\n      });\n      return Element.fromDom(fragment);\n    };\n\n    var tableModel = Immutable('element', 'width', 'rows');\n    var tableRow = Immutable('element', 'cells');\n    var cellPosition = Immutable('x', 'y');\n    var getSpan = function (td, key) {\n      var value = parseInt(get(td, key), 10);\n      return isNaN(value) ? 1 : value;\n    };\n    var fillout = function (table, x, y, tr, td) {\n      var rowspan = getSpan(td, 'rowspan');\n      var colspan = getSpan(td, 'colspan');\n      var rows = table.rows();\n      for (var y2 = y; y2 < y + rowspan; y2++) {\n        if (!rows[y2]) {\n          rows[y2] = tableRow(deep(tr), []);\n        }\n        for (var x2 = x; x2 < x + colspan; x2++) {\n          var cells = rows[y2].cells();\n          cells[x2] = y2 === y && x2 === x ? td : shallow(td);\n        }\n      }\n    };\n    var cellExists = function (table, x, y) {\n      var rows = table.rows();\n      var cells = rows[y] ? rows[y].cells() : [];\n      return !!cells[x];\n    };\n    var skipCellsX = function (table, x, y) {\n      while (cellExists(table, x, y)) {\n        x++;\n      }\n      return x;\n    };\n    var getWidth = function (rows) {\n      return foldl(rows, function (acc, row) {\n        return row.cells().length > acc ? row.cells().length : acc;\n      }, 0);\n    };\n    var findElementPos = function (table, element) {\n      var rows = table.rows();\n      for (var y = 0; y < rows.length; y++) {\n        var cells = rows[y].cells();\n        for (var x = 0; x < cells.length; x++) {\n          if (eq(cells[x], element)) {\n            return Option.some(cellPosition(x, y));\n          }\n        }\n      }\n      return Option.none();\n    };\n    var extractRows = function (table, sx, sy, ex, ey) {\n      var newRows = [];\n      var rows = table.rows();\n      for (var y = sy; y <= ey; y++) {\n        var cells = rows[y].cells();\n        var slice = sx < ex ? cells.slice(sx, ex + 1) : cells.slice(ex, sx + 1);\n        newRows.push(tableRow(rows[y].element(), slice));\n      }\n      return newRows;\n    };\n    var subTable = function (table, startPos, endPos) {\n      var sx = startPos.x(), sy = startPos.y();\n      var ex = endPos.x(), ey = endPos.y();\n      var newRows = sy < ey ? extractRows(table, sx, sy, ex, ey) : extractRows(table, sx, ey, ex, sy);\n      return tableModel(table.element(), getWidth(newRows), newRows);\n    };\n    var createDomTable = function (table, rows) {\n      var tableElement = shallow(table.element());\n      var tableBody = Element.fromTag('tbody');\n      append$1(tableBody, rows);\n      append(tableElement, tableBody);\n      return tableElement;\n    };\n    var modelRowsToDomRows = function (table) {\n      return map(table.rows(), function (row) {\n        var cells = map(row.cells(), function (cell) {\n          var td = deep(cell);\n          remove(td, 'colspan');\n          remove(td, 'rowspan');\n          return td;\n        });\n        var tr = shallow(row.element());\n        append$1(tr, cells);\n        return tr;\n      });\n    };\n    var fromDom$1 = function (tableElm) {\n      var table = tableModel(shallow(tableElm), 0, []);\n      each(descendants$1(tableElm, 'tr'), function (tr, y) {\n        each(descendants$1(tr, 'td,th'), function (td, x) {\n          fillout(table, skipCellsX(table, x, y), y, tr, td);\n        });\n      });\n      return tableModel(table.element(), getWidth(table.rows()), table.rows());\n    };\n    var toDom = function (table) {\n      return createDomTable(table, modelRowsToDomRows(table));\n    };\n    var subsection = function (table, startElement, endElement) {\n      return findElementPos(table, startElement).bind(function (startPos) {\n        return findElementPos(table, endElement).map(function (endPos) {\n          return subTable(table, startPos, endPos);\n        });\n      });\n    };\n    var SimpleTableModel = {\n      fromDom: fromDom$1,\n      toDom: toDom,\n      subsection: subsection\n    };\n\n    var findParentListContainer = function (parents) {\n      return find(parents, function (elm) {\n        return name(elm) === 'ul' || name(elm) === 'ol';\n      });\n    };\n    var getFullySelectedListWrappers = function (parents, rng) {\n      return find(parents, function (elm) {\n        return name(elm) === 'li' && hasAllContentsSelected(elm, rng);\n      }).fold(constant([]), function (li) {\n        return findParentListContainer(parents).map(function (listCont) {\n          return [\n            Element.fromTag('li'),\n            Element.fromTag(name(listCont))\n          ];\n        }).getOr([]);\n      });\n    };\n    var wrap$3 = function (innerElm, elms) {\n      var wrapped = foldl(elms, function (acc, elm) {\n        append(elm, acc);\n        return elm;\n      }, innerElm);\n      return elms.length > 0 ? fromElements([wrapped]) : wrapped;\n    };\n    var directListWrappers = function (commonAnchorContainer) {\n      if (isListItem(commonAnchorContainer)) {\n        return parent(commonAnchorContainer).filter(isList).fold(constant([]), function (listElm) {\n          return [\n            commonAnchorContainer,\n            listElm\n          ];\n        });\n      } else {\n        return isList(commonAnchorContainer) ? [commonAnchorContainer] : [];\n      }\n    };\n    var getWrapElements = function (rootNode, rng) {\n      var commonAnchorContainer = Element.fromDom(rng.commonAncestorContainer);\n      var parents = Parents.parentsAndSelf(commonAnchorContainer, rootNode);\n      var wrapElements = filter(parents, function (elm) {\n        return isInline(elm) || isHeading(elm);\n      });\n      var listWrappers = getFullySelectedListWrappers(parents, rng);\n      var allWrappers = wrapElements.concat(listWrappers.length ? listWrappers : directListWrappers(commonAnchorContainer));\n      return map(allWrappers, shallow);\n    };\n    var emptyFragment = function () {\n      return fromElements([]);\n    };\n    var getFragmentFromRange = function (rootNode, rng) {\n      return wrap$3(Element.fromDom(rng.cloneContents()), getWrapElements(rootNode, rng));\n    };\n    var getParentTable = function (rootElm, cell) {\n      return ancestor$1(cell, 'table', curry(eq, rootElm));\n    };\n    var getTableFragment = function (rootNode, selectedTableCells) {\n      return getParentTable(rootNode, selectedTableCells[0]).bind(function (tableElm) {\n        var firstCell = selectedTableCells[0];\n        var lastCell = selectedTableCells[selectedTableCells.length - 1];\n        var fullTableModel = SimpleTableModel.fromDom(tableElm);\n        return SimpleTableModel.subsection(fullTableModel, firstCell, lastCell).map(function (sectionedTableModel) {\n          return fromElements([SimpleTableModel.toDom(sectionedTableModel)]);\n        });\n      }).getOrThunk(emptyFragment);\n    };\n    var getSelectionFragment = function (rootNode, ranges) {\n      return ranges.length > 0 && ranges[0].collapsed ? emptyFragment() : getFragmentFromRange(rootNode, ranges[0]);\n    };\n    var read$4 = function (rootNode, ranges) {\n      var selectedCells = TableCellSelection.getCellsFromElementOrRanges(ranges, rootNode);\n      return selectedCells.length > 0 ? getTableFragment(rootNode, selectedCells) : getSelectionFragment(rootNode, ranges);\n    };\n    var FragmentReader = { read: read$4 };\n\n    var getTextContent = function (editor) {\n      return Option.from(editor.selection.getRng()).map(function (rng) {\n        var bin = editor.dom.add(editor.getBody(), 'div', {\n          'data-mce-bogus': 'all',\n          'style': 'overflow: hidden; opacity: 0;'\n        }, rng.cloneContents());\n        var text = Zwsp.trim(bin.innerText);\n        editor.dom.remove(bin);\n        return text;\n      }).getOr('');\n    };\n    var getHtmlContent = function (editor, args) {\n      var rng = editor.selection.getRng(), tmpElm = editor.dom.create('body');\n      var sel = editor.selection.getSel();\n      var fragment;\n      var ranges = EventProcessRanges.processRanges(editor, MultiRange.getRanges(sel));\n      fragment = args.contextual ? FragmentReader.read(Element.fromDom(editor.getBody()), ranges).dom() : rng.cloneContents();\n      if (fragment) {\n        tmpElm.appendChild(fragment);\n      }\n      return editor.selection.serializer.serialize(tmpElm, args);\n    };\n    var getContent = function (editor, args) {\n      if (args === void 0) {\n        args = {};\n      }\n      args.get = true;\n      args.format = args.format || 'html';\n      args.selection = true;\n      args = editor.fire('BeforeGetContent', args);\n      if (args.isDefaultPrevented()) {\n        editor.fire('GetContent', args);\n        return args.content;\n      }\n      if (args.format === 'text') {\n        return getTextContent(editor);\n      } else {\n        args.getInner = true;\n        var content = getHtmlContent(editor, args);\n        if (args.format === 'tree') {\n          return content;\n        } else {\n          args.content = editor.selection.isCollapsed() ? '' : content;\n          editor.fire('GetContent', args);\n          return args.content;\n        }\n      }\n    };\n    var GetSelectionContent = { getContent: getContent };\n\n    var setupArgs = function (args, content) {\n      return __assign(__assign({ format: 'html' }, args), {\n        set: true,\n        selection: true,\n        content: content\n      });\n    };\n    var cleanContent = function (editor, args) {\n      if (args.format !== 'raw') {\n        var node = editor.parser.parse(args.content, __assign({\n          isRootContent: true,\n          forced_root_block: false\n        }, args));\n        return HtmlSerializer({ validate: editor.validate }, editor.schema).serialize(node);\n      } else {\n        return args.content;\n      }\n    };\n    var setContent = function (editor, content, args) {\n      var contentArgs = setupArgs(args, content);\n      var rng = editor.selection.getRng(), caretNode;\n      var doc = editor.getDoc();\n      var frag, temp;\n      if (!contentArgs.no_events) {\n        contentArgs = editor.fire('BeforeSetContent', contentArgs);\n        if (contentArgs.isDefaultPrevented()) {\n          editor.fire('SetContent', contentArgs);\n          return;\n        }\n      }\n      content = cleanContent(editor, contentArgs);\n      if (rng.insertNode) {\n        content += '<span id=\"__caret\">_</span>';\n        if (rng.startContainer === doc && rng.endContainer === doc) {\n          doc.body.innerHTML = content;\n        } else {\n          rng.deleteContents();\n          if (doc.body.childNodes.length === 0) {\n            doc.body.innerHTML = content;\n          } else {\n            if (rng.createContextualFragment) {\n              rng.insertNode(rng.createContextualFragment(content));\n            } else {\n              frag = doc.createDocumentFragment();\n              temp = doc.createElement('div');\n              frag.appendChild(temp);\n              temp.outerHTML = content;\n              rng.insertNode(frag);\n            }\n          }\n        }\n        caretNode = editor.dom.get('__caret');\n        rng = doc.createRange();\n        rng.setStartBefore(caretNode);\n        rng.setEndBefore(caretNode);\n        editor.selection.setRng(rng);\n        editor.dom.remove('__caret');\n        try {\n          editor.selection.setRng(rng);\n        } catch (ex) {\n        }\n      } else {\n        var anyRng = rng;\n        if (anyRng.item) {\n          doc.execCommand('Delete', false, null);\n          anyRng = editor.selection.getRng();\n        }\n        if (/^\\s+/.test(content)) {\n          anyRng.pasteHTML('<span id=\"__mce_tmp\">_</span>' + content);\n          editor.dom.remove('__mce_tmp');\n        } else {\n          anyRng.pasteHTML(content);\n        }\n      }\n      if (!contentArgs.no_events) {\n        editor.fire('SetContent', contentArgs);\n      }\n    };\n    var SetSelectionContent = { setContent: setContent };\n\n    var getEndpointElement = function (root, rng, start, real, resolve) {\n      var container = start ? rng.startContainer : rng.endContainer;\n      var offset = start ? rng.startOffset : rng.endOffset;\n      return Option.from(container).map(Element.fromDom).map(function (elm) {\n        return !real || !rng.collapsed ? child(elm, resolve(elm, offset)).getOr(elm) : elm;\n      }).bind(function (elm) {\n        return isElement(elm) ? Option.some(elm) : parent(elm);\n      }).map(function (elm) {\n        return elm.dom();\n      }).getOr(root);\n    };\n    var getStart$2 = function (root, rng, real) {\n      return getEndpointElement(root, rng, true, real, function (elm, offset) {\n        return Math.min(childNodesCount(elm), offset);\n      });\n    };\n    var getEnd = function (root, rng, real) {\n      return getEndpointElement(root, rng, false, real, function (elm, offset) {\n        return offset > 0 ? offset - 1 : offset;\n      });\n    };\n    var skipEmptyTextNodes = function (node, forwards) {\n      var orig = node;\n      while (node && NodeType.isText(node) && node.length === 0) {\n        node = forwards ? node.nextSibling : node.previousSibling;\n      }\n      return node || orig;\n    };\n    var getNode$1 = function (root, rng) {\n      var elm, startContainer, endContainer, startOffset, endOffset;\n      if (!rng) {\n        return root;\n      }\n      startContainer = rng.startContainer;\n      endContainer = rng.endContainer;\n      startOffset = rng.startOffset;\n      endOffset = rng.endOffset;\n      elm = rng.commonAncestorContainer;\n      if (!rng.collapsed) {\n        if (startContainer === endContainer) {\n          if (endOffset - startOffset < 2) {\n            if (startContainer.hasChildNodes()) {\n              elm = startContainer.childNodes[startOffset];\n            }\n          }\n        }\n        if (startContainer.nodeType === 3 && endContainer.nodeType === 3) {\n          if (startContainer.length === startOffset) {\n            startContainer = skipEmptyTextNodes(startContainer.nextSibling, true);\n          } else {\n            startContainer = startContainer.parentNode;\n          }\n          if (endOffset === 0) {\n            endContainer = skipEmptyTextNodes(endContainer.previousSibling, false);\n          } else {\n            endContainer = endContainer.parentNode;\n          }\n          if (startContainer && startContainer === endContainer) {\n            return startContainer;\n          }\n        }\n      }\n      if (elm && elm.nodeType === 3) {\n        return elm.parentNode;\n      }\n      return elm;\n    };\n    var getSelectedBlocks = function (dom, rng, startElm, endElm) {\n      var node, root;\n      var selectedBlocks = [];\n      root = dom.getRoot();\n      startElm = dom.getParent(startElm || getStart$2(root, rng, rng.collapsed), dom.isBlock);\n      endElm = dom.getParent(endElm || getEnd(root, rng, rng.collapsed), dom.isBlock);\n      if (startElm && startElm !== root) {\n        selectedBlocks.push(startElm);\n      }\n      if (startElm && endElm && startElm !== endElm) {\n        node = startElm;\n        var walker = new TreeWalker(startElm, root);\n        while ((node = walker.next()) && node !== endElm) {\n          if (dom.isBlock(node)) {\n            selectedBlocks.push(node);\n          }\n        }\n      }\n      if (endElm && startElm !== endElm && endElm !== root) {\n        selectedBlocks.push(endElm);\n      }\n      return selectedBlocks;\n    };\n    var select$1 = function (dom, node, content) {\n      return Option.from(node).map(function (node) {\n        var idx = dom.nodeIndex(node);\n        var rng = dom.createRng();\n        rng.setStart(node.parentNode, idx);\n        rng.setEnd(node.parentNode, idx + 1);\n        if (content) {\n          moveEndPoint$1(dom, rng, node, true);\n          moveEndPoint$1(dom, rng, node, false);\n        }\n        return rng;\n      });\n    };\n\n    var each$j = Tools.each;\n    var isNativeIeSelection = function (rng) {\n      return !!rng.select;\n    };\n    var isAttachedToDom = function (node) {\n      return !!(node && node.ownerDocument) && contains$3(Element.fromDom(node.ownerDocument), Element.fromDom(node));\n    };\n    var isValidRange = function (rng) {\n      if (!rng) {\n        return false;\n      } else if (isNativeIeSelection(rng)) {\n        return true;\n      } else {\n        return isAttachedToDom(rng.startContainer) && isAttachedToDom(rng.endContainer);\n      }\n    };\n    var Selection$1 = function (dom, win, serializer, editor) {\n      var bookmarkManager, controlSelection;\n      var selectedRange, explicitRange, selectorChangedData;\n      var setCursorLocation = function (node, offset) {\n        var rng = dom.createRng();\n        if (!node) {\n          moveEndPoint$1(dom, rng, editor.getBody(), true);\n          setRng(rng);\n        } else {\n          rng.setStart(node, offset);\n          rng.setEnd(node, offset);\n          setRng(rng);\n          collapse(false);\n        }\n      };\n      var getContent = function (args) {\n        return GetSelectionContent.getContent(editor, args);\n      };\n      var setContent = function (content, args) {\n        return SetSelectionContent.setContent(editor, content, args);\n      };\n      var getStart = function (real) {\n        return getStart$2(editor.getBody(), getRng(), real);\n      };\n      var getEnd$1 = function (real) {\n        return getEnd(editor.getBody(), getRng(), real);\n      };\n      var getBookmark = function (type, normalized) {\n        return bookmarkManager.getBookmark(type, normalized);\n      };\n      var moveToBookmark = function (bookmark) {\n        return bookmarkManager.moveToBookmark(bookmark);\n      };\n      var select = function (node, content) {\n        select$1(dom, node, content).each(setRng);\n        return node;\n      };\n      var isCollapsed = function () {\n        var rng = getRng(), sel = getSel();\n        if (!rng || rng.item) {\n          return false;\n        }\n        if (rng.compareEndPoints) {\n          return rng.compareEndPoints('StartToEnd', rng) === 0;\n        }\n        return !sel || rng.collapsed;\n      };\n      var collapse = function (toStart) {\n        var rng = getRng();\n        rng.collapse(!!toStart);\n        setRng(rng);\n      };\n      var getSel = function () {\n        return win.getSelection ? win.getSelection() : win.document.selection;\n      };\n      var getRng = function () {\n        var selection, rng, elm, doc;\n        var tryCompareBoundaryPoints = function (how, sourceRange, destinationRange) {\n          try {\n            return sourceRange.compareBoundaryPoints(how, destinationRange);\n          } catch (ex) {\n            return -1;\n          }\n        };\n        if (!win) {\n          return null;\n        }\n        doc = win.document;\n        if (typeof doc === 'undefined' || doc === null) {\n          return null;\n        }\n        if (editor.bookmark !== undefined && EditorFocus.hasFocus(editor) === false) {\n          var bookmark = SelectionBookmark.getRng(editor);\n          if (bookmark.isSome()) {\n            return bookmark.map(function (r) {\n              return EventProcessRanges.processRanges(editor, [r])[0];\n            }).getOr(doc.createRange());\n          }\n        }\n        try {\n          if ((selection = getSel()) && !NodeType.isRestrictedNode(selection.anchorNode)) {\n            if (selection.rangeCount > 0) {\n              rng = selection.getRangeAt(0);\n            } else {\n              rng = selection.createRange ? selection.createRange() : doc.createRange();\n            }\n          }\n        } catch (ex) {\n        }\n        rng = EventProcessRanges.processRanges(editor, [rng])[0];\n        if (!rng) {\n          rng = doc.createRange ? doc.createRange() : doc.body.createTextRange();\n        }\n        if (rng.setStart && rng.startContainer.nodeType === 9 && rng.collapsed) {\n          elm = dom.getRoot();\n          rng.setStart(elm, 0);\n          rng.setEnd(elm, 0);\n        }\n        if (selectedRange && explicitRange) {\n          if (tryCompareBoundaryPoints(rng.START_TO_START, rng, selectedRange) === 0 && tryCompareBoundaryPoints(rng.END_TO_END, rng, selectedRange) === 0) {\n            rng = explicitRange;\n          } else {\n            selectedRange = null;\n            explicitRange = null;\n          }\n        }\n        return rng;\n      };\n      var setRng = function (rng, forward) {\n        var sel, node, evt;\n        if (!isValidRange(rng)) {\n          return;\n        }\n        var ieRange = isNativeIeSelection(rng) ? rng : null;\n        if (ieRange) {\n          explicitRange = null;\n          try {\n            ieRange.select();\n          } catch (ex) {\n          }\n          return;\n        }\n        sel = getSel();\n        evt = editor.fire('SetSelectionRange', {\n          range: rng,\n          forward: forward\n        });\n        rng = evt.range;\n        if (sel) {\n          explicitRange = rng;\n          try {\n            sel.removeAllRanges();\n            sel.addRange(rng);\n          } catch (ex) {\n          }\n          if (forward === false && sel.extend) {\n            sel.collapse(rng.endContainer, rng.endOffset);\n            sel.extend(rng.startContainer, rng.startOffset);\n          }\n          selectedRange = sel.rangeCount > 0 ? sel.getRangeAt(0) : null;\n        }\n        if (!rng.collapsed && rng.startContainer === rng.endContainer && sel.setBaseAndExtent && !Env.ie) {\n          if (rng.endOffset - rng.startOffset < 2) {\n            if (rng.startContainer.hasChildNodes()) {\n              node = rng.startContainer.childNodes[rng.startOffset];\n              if (node && node.tagName === 'IMG') {\n                sel.setBaseAndExtent(rng.startContainer, rng.startOffset, rng.endContainer, rng.endOffset);\n                if (sel.anchorNode !== rng.startContainer || sel.focusNode !== rng.endContainer) {\n                  sel.setBaseAndExtent(node, 0, node, 1);\n                }\n              }\n            }\n          }\n        }\n        editor.fire('AfterSetSelectionRange', {\n          range: rng,\n          forward: forward\n        });\n      };\n      var setNode = function (elm) {\n        setContent(dom.getOuterHTML(elm));\n        return elm;\n      };\n      var getNode = function () {\n        return getNode$1(editor.getBody(), getRng());\n      };\n      var getSelectedBlocks$1 = function (startElm, endElm) {\n        return getSelectedBlocks(dom, getRng(), startElm, endElm);\n      };\n      var isForward = function () {\n        var sel = getSel();\n        var anchorRange, focusRange;\n        if (!sel || !sel.anchorNode || !sel.focusNode) {\n          return true;\n        }\n        anchorRange = dom.createRng();\n        anchorRange.setStart(sel.anchorNode, sel.anchorOffset);\n        anchorRange.collapse(true);\n        focusRange = dom.createRng();\n        focusRange.setStart(sel.focusNode, sel.focusOffset);\n        focusRange.collapse(true);\n        return anchorRange.compareBoundaryPoints(anchorRange.START_TO_START, focusRange) <= 0;\n      };\n      var normalize = function () {\n        var rng = getRng();\n        var sel = getSel();\n        if (!MultiRange.hasMultipleRanges(sel) && hasAnyRanges(editor)) {\n          var normRng = NormalizeRange.normalize(dom, rng);\n          normRng.each(function (normRng) {\n            setRng(normRng, isForward());\n          });\n          return normRng.getOr(rng);\n        }\n        return rng;\n      };\n      var selectorChanged = function (selector, callback) {\n        var currentSelectors;\n        if (!selectorChangedData) {\n          selectorChangedData = {};\n          currentSelectors = {};\n          editor.on('NodeChange', function (e) {\n            var node = e.element, parents = dom.getParents(node, null, dom.getRoot()), matchedSelectors = {};\n            each$j(selectorChangedData, function (callbacks, selector) {\n              each$j(parents, function (node) {\n                if (dom.is(node, selector)) {\n                  if (!currentSelectors[selector]) {\n                    each$j(callbacks, function (callback) {\n                      callback(true, {\n                        node: node,\n                        selector: selector,\n                        parents: parents\n                      });\n                    });\n                    currentSelectors[selector] = callbacks;\n                  }\n                  matchedSelectors[selector] = callbacks;\n                  return false;\n                }\n              });\n            });\n            each$j(currentSelectors, function (callbacks, selector) {\n              if (!matchedSelectors[selector]) {\n                delete currentSelectors[selector];\n                each$j(callbacks, function (callback) {\n                  callback(false, {\n                    node: node,\n                    selector: selector,\n                    parents: parents\n                  });\n                });\n              }\n            });\n          });\n        }\n        if (!selectorChangedData[selector]) {\n          selectorChangedData[selector] = [];\n        }\n        selectorChangedData[selector].push(callback);\n        return exports;\n      };\n      var getScrollContainer = function () {\n        var scrollContainer;\n        var node = dom.getRoot();\n        while (node && node.nodeName !== 'BODY') {\n          if (node.scrollHeight > node.clientHeight) {\n            scrollContainer = node;\n            break;\n          }\n          node = node.parentNode;\n        }\n        return scrollContainer;\n      };\n      var scrollIntoView = function (elm, alignToTop) {\n        return ScrollIntoView.scrollElementIntoView(editor, elm, alignToTop);\n      };\n      var placeCaretAt = function (clientX, clientY) {\n        return setRng(CaretRangeFromPoint.fromPoint(clientX, clientY, editor.getDoc()));\n      };\n      var getBoundingClientRect = function () {\n        var rng = getRng();\n        return rng.collapsed ? CaretPosition$1.fromRangeStart(rng).getClientRects()[0] : rng.getBoundingClientRect();\n      };\n      var destroy = function () {\n        win = selectedRange = explicitRange = null;\n        controlSelection.destroy();\n      };\n      var exports = {\n        bookmarkManager: null,\n        controlSelection: null,\n        dom: dom,\n        win: win,\n        serializer: serializer,\n        editor: editor,\n        collapse: collapse,\n        setCursorLocation: setCursorLocation,\n        getContent: getContent,\n        setContent: setContent,\n        getBookmark: getBookmark,\n        moveToBookmark: moveToBookmark,\n        select: select,\n        isCollapsed: isCollapsed,\n        isForward: isForward,\n        setNode: setNode,\n        getNode: getNode,\n        getSel: getSel,\n        setRng: setRng,\n        getRng: getRng,\n        getStart: getStart,\n        getEnd: getEnd$1,\n        getSelectedBlocks: getSelectedBlocks$1,\n        normalize: normalize,\n        selectorChanged: selectorChanged,\n        getScrollContainer: getScrollContainer,\n        scrollIntoView: scrollIntoView,\n        placeCaretAt: placeCaretAt,\n        getBoundingClientRect: getBoundingClientRect,\n        destroy: destroy\n      };\n      bookmarkManager = BookmarkManager$1(exports);\n      controlSelection = ControlSelection(exports, editor);\n      exports.bookmarkManager = bookmarkManager;\n      exports.controlSelection = controlSelection;\n      return exports;\n    };\n\n    var BreakType;\n    (function (BreakType) {\n      BreakType[BreakType['Br'] = 0] = 'Br';\n      BreakType[BreakType['Block'] = 1] = 'Block';\n      BreakType[BreakType['Wrap'] = 2] = 'Wrap';\n      BreakType[BreakType['Eol'] = 3] = 'Eol';\n    }(BreakType || (BreakType = {})));\n    var flip = function (direction, positions) {\n      return direction === HDirection.Backwards ? positions.reverse() : positions;\n    };\n    var walk$3 = function (direction, caretWalker, pos) {\n      return direction === HDirection.Forwards ? caretWalker.next(pos) : caretWalker.prev(pos);\n    };\n    var getBreakType = function (scope, direction, currentPos, nextPos) {\n      if (NodeType.isBr(nextPos.getNode(direction === HDirection.Forwards))) {\n        return BreakType.Br;\n      } else if (isInSameBlock(currentPos, nextPos) === false) {\n        return BreakType.Block;\n      } else {\n        return BreakType.Wrap;\n      }\n    };\n    var getPositionsUntil = function (predicate, direction, scope, start) {\n      var caretWalker = CaretWalker(scope);\n      var currentPos = start, nextPos;\n      var positions = [];\n      while (currentPos) {\n        nextPos = walk$3(direction, caretWalker, currentPos);\n        if (!nextPos) {\n          break;\n        }\n        if (NodeType.isBr(nextPos.getNode(false))) {\n          if (direction === HDirection.Forwards) {\n            return {\n              positions: flip(direction, positions).concat([nextPos]),\n              breakType: BreakType.Br,\n              breakAt: Option.some(nextPos)\n            };\n          } else {\n            return {\n              positions: flip(direction, positions),\n              breakType: BreakType.Br,\n              breakAt: Option.some(nextPos)\n            };\n          }\n        }\n        if (!nextPos.isVisible()) {\n          currentPos = nextPos;\n          continue;\n        }\n        if (predicate(currentPos, nextPos)) {\n          var breakType = getBreakType(scope, direction, currentPos, nextPos);\n          return {\n            positions: flip(direction, positions),\n            breakType: breakType,\n            breakAt: Option.some(nextPos)\n          };\n        }\n        positions.push(nextPos);\n        currentPos = nextPos;\n      }\n      return {\n        positions: flip(direction, positions),\n        breakType: BreakType.Eol,\n        breakAt: Option.none()\n      };\n    };\n    var getAdjacentLinePositions = function (direction, getPositionsUntilBreak, scope, start) {\n      return getPositionsUntilBreak(scope, start).breakAt.map(function (pos) {\n        var positions = getPositionsUntilBreak(scope, pos).positions;\n        return direction === HDirection.Backwards ? positions.concat(pos) : [pos].concat(positions);\n      }).getOr([]);\n    };\n    var findClosestHorizontalPositionFromPoint = function (positions, x) {\n      return foldl(positions, function (acc, newPos) {\n        return acc.fold(function () {\n          return Option.some(newPos);\n        }, function (lastPos) {\n          return lift2(head(lastPos.getClientRects()), head(newPos.getClientRects()), function (lastRect, newRect) {\n            var lastDist = Math.abs(x - lastRect.left);\n            var newDist = Math.abs(x - newRect.left);\n            return newDist <= lastDist ? newPos : lastPos;\n          }).or(acc);\n        });\n      }, Option.none());\n    };\n    var findClosestHorizontalPosition = function (positions, pos) {\n      return head(pos.getClientRects()).bind(function (targetRect) {\n        return findClosestHorizontalPositionFromPoint(positions, targetRect.left);\n      });\n    };\n    var getPositionsUntilPreviousLine = curry(getPositionsUntil, CaretPosition.isAbove, -1);\n    var getPositionsUntilNextLine = curry(getPositionsUntil, CaretPosition.isBelow, 1);\n    var isAtFirstLine = function (scope, pos) {\n      return getPositionsUntilPreviousLine(scope, pos).breakAt.isNone();\n    };\n    var isAtLastLine = function (scope, pos) {\n      return getPositionsUntilNextLine(scope, pos).breakAt.isNone();\n    };\n    var getPositionsAbove = curry(getAdjacentLinePositions, -1, getPositionsUntilPreviousLine);\n    var getPositionsBelow = curry(getAdjacentLinePositions, 1, getPositionsUntilNextLine);\n    var getFirstLinePositions = function (scope) {\n      return CaretFinder.firstPositionIn(scope).map(function (pos) {\n        return [pos].concat(getPositionsUntilNextLine(scope, pos).positions);\n      }).getOr([]);\n    };\n    var getLastLinePositions = function (scope) {\n      return CaretFinder.lastPositionIn(scope).map(function (pos) {\n        return getPositionsUntilPreviousLine(scope, pos).positions.concat(pos);\n      }).getOr([]);\n    };\n\n    var isContentEditableFalse$b = NodeType.isContentEditableFalse;\n    var getSelectedNode$1 = getSelectedNode;\n    var moveToCeFalseHorizontally = function (direction, editor, getNextPosFn, range) {\n      var forwards = direction === HDirection.Forwards;\n      var isBeforeContentEditableFalseFn = forwards ? isBeforeContentEditableFalse : isAfterContentEditableFalse;\n      if (!range.collapsed) {\n        var node = getSelectedNode$1(range);\n        if (isContentEditableFalse$b(node)) {\n          return showCaret(direction, editor, node, direction === HDirection.Backwards, true);\n        }\n      }\n      var rangeIsInContainerBlock = isRangeInCaretContainerBlock(range);\n      var caretPosition = getNormalizedRangeEndPoint(direction, editor.getBody(), range);\n      if (isBeforeContentEditableFalseFn(caretPosition)) {\n        return selectNode(editor, caretPosition.getNode(!forwards));\n      }\n      var nextCaretPosition = InlineUtils.normalizePosition(forwards, getNextPosFn(caretPosition));\n      if (!nextCaretPosition) {\n        if (rangeIsInContainerBlock) {\n          return range;\n        }\n        return null;\n      }\n      if (isBeforeContentEditableFalseFn(nextCaretPosition)) {\n        return showCaret(direction, editor, nextCaretPosition.getNode(!forwards), forwards, true);\n      }\n      var peekCaretPosition = getNextPosFn(nextCaretPosition);\n      if (peekCaretPosition && isBeforeContentEditableFalseFn(peekCaretPosition)) {\n        if (isMoveInsideSameBlock(nextCaretPosition, peekCaretPosition)) {\n          return showCaret(direction, editor, peekCaretPosition.getNode(!forwards), forwards, true);\n        }\n      }\n      if (rangeIsInContainerBlock) {\n        return renderRangeCaret(editor, nextCaretPosition.toRange(), true);\n      }\n      return null;\n    };\n    var moveToCeFalseVertically = function (direction, editor, walkerFn, range) {\n      var caretPosition, linePositions, nextLinePositions;\n      var closestNextLineRect, caretClientRect, clientX;\n      var dist1, dist2, contentEditableFalseNode;\n      contentEditableFalseNode = getSelectedNode$1(range);\n      caretPosition = getNormalizedRangeEndPoint(direction, editor.getBody(), range);\n      linePositions = walkerFn(editor.getBody(), isAboveLine(1), caretPosition);\n      nextLinePositions = filter(linePositions, isLine(1));\n      caretClientRect = ArrUtils.last(caretPosition.getClientRects());\n      if (isBeforeContentEditableFalse(caretPosition) || isBeforeTable(caretPosition)) {\n        contentEditableFalseNode = caretPosition.getNode();\n      }\n      if (isAfterContentEditableFalse(caretPosition) || isAfterTable(caretPosition)) {\n        contentEditableFalseNode = caretPosition.getNode(true);\n      }\n      if (!caretClientRect) {\n        return null;\n      }\n      clientX = caretClientRect.left;\n      closestNextLineRect = findClosestClientRect(nextLinePositions, clientX);\n      if (closestNextLineRect) {\n        if (isContentEditableFalse$b(closestNextLineRect.node)) {\n          dist1 = Math.abs(clientX - closestNextLineRect.left);\n          dist2 = Math.abs(clientX - closestNextLineRect.right);\n          return showCaret(direction, editor, closestNextLineRect.node, dist1 < dist2, true);\n        }\n      }\n      if (contentEditableFalseNode) {\n        var caretPositions = positionsUntil(direction, editor.getBody(), isAboveLine(1), contentEditableFalseNode);\n        closestNextLineRect = findClosestClientRect(filter(caretPositions, isLine(1)), clientX);\n        if (closestNextLineRect) {\n          return renderRangeCaret(editor, closestNextLineRect.position.toRange(), true);\n        }\n        closestNextLineRect = ArrUtils.last(filter(caretPositions, isLine(0)));\n        if (closestNextLineRect) {\n          return renderRangeCaret(editor, closestNextLineRect.position.toRange(), true);\n        }\n      }\n    };\n    var createTextBlock = function (editor) {\n      var textBlock = editor.dom.create(Settings.getForcedRootBlock(editor));\n      if (!Env.ie || Env.ie >= 11) {\n        textBlock.innerHTML = '<br data-mce-bogus=\"1\">';\n      }\n      return textBlock;\n    };\n    var exitPreBlock = function (editor, direction, range) {\n      var pre, caretPos, newBlock;\n      var caretWalker = CaretWalker(editor.getBody());\n      var getNextVisualCaretPosition = curry(getVisualCaretPosition, caretWalker.next);\n      var getPrevVisualCaretPosition = curry(getVisualCaretPosition, caretWalker.prev);\n      if (range.collapsed && editor.settings.forced_root_block) {\n        pre = editor.dom.getParent(range.startContainer, 'PRE');\n        if (!pre) {\n          return;\n        }\n        if (direction === 1) {\n          caretPos = getNextVisualCaretPosition(CaretPosition$1.fromRangeStart(range));\n        } else {\n          caretPos = getPrevVisualCaretPosition(CaretPosition$1.fromRangeStart(range));\n        }\n        if (!caretPos) {\n          newBlock = createTextBlock(editor);\n          if (direction === 1) {\n            editor.$(pre).after(newBlock);\n          } else {\n            editor.$(pre).before(newBlock);\n          }\n          editor.selection.select(newBlock, true);\n          editor.selection.collapse();\n        }\n      }\n    };\n    var getHorizontalRange = function (editor, forward) {\n      var caretWalker = CaretWalker(editor.getBody());\n      var getNextVisualCaretPosition = curry(getVisualCaretPosition, caretWalker.next);\n      var getPrevVisualCaretPosition = curry(getVisualCaretPosition, caretWalker.prev);\n      var newRange;\n      var direction = forward ? HDirection.Forwards : HDirection.Backwards;\n      var getNextPosFn = forward ? getNextVisualCaretPosition : getPrevVisualCaretPosition;\n      var range = editor.selection.getRng();\n      newRange = moveToCeFalseHorizontally(direction, editor, getNextPosFn, range);\n      if (newRange) {\n        return newRange;\n      }\n      newRange = exitPreBlock(editor, direction, range);\n      if (newRange) {\n        return newRange;\n      }\n      return null;\n    };\n    var getVerticalRange = function (editor, down) {\n      var newRange;\n      var direction = down ? 1 : -1;\n      var walkerFn = down ? downUntil : upUntil;\n      var range = editor.selection.getRng();\n      newRange = moveToCeFalseVertically(direction, editor, walkerFn, range);\n      if (newRange) {\n        return newRange;\n      }\n      newRange = exitPreBlock(editor, direction, range);\n      if (newRange) {\n        return newRange;\n      }\n      return null;\n    };\n    var moveH = function (editor, forward) {\n      return function () {\n        var newRng = getHorizontalRange(editor, forward);\n        if (newRng) {\n          moveToRange(editor, newRng);\n          return true;\n        } else {\n          return false;\n        }\n      };\n    };\n    var moveV = function (editor, down) {\n      return function () {\n        var newRng = getVerticalRange(editor, down);\n        if (newRng) {\n          moveToRange(editor, newRng);\n          return true;\n        } else {\n          return false;\n        }\n      };\n    };\n    var isCefPosition = function (forward) {\n      return function (pos) {\n        return forward ? isAfterContentEditableFalse(pos) : isBeforeContentEditableFalse(pos);\n      };\n    };\n    var moveToLineEndPoint = function (editor, forward) {\n      return function () {\n        var from = forward ? CaretPosition$1.fromRangeEnd(editor.selection.getRng()) : CaretPosition$1.fromRangeStart(editor.selection.getRng());\n        var result = forward ? getPositionsUntilNextLine(editor.getBody(), from) : getPositionsUntilPreviousLine(editor.getBody(), from);\n        var to = forward ? last(result.positions) : head(result.positions);\n        return to.filter(isCefPosition(forward)).fold(constant(false), function (pos) {\n          editor.selection.setRng(pos.toRange());\n          return true;\n        });\n      };\n    };\n\n    var deflate = function (rect, delta) {\n      return {\n        left: rect.left - delta,\n        top: rect.top - delta,\n        right: rect.right + delta * 2,\n        bottom: rect.bottom + delta * 2,\n        width: rect.width + delta,\n        height: rect.height + delta\n      };\n    };\n    var getCorners = function (getYAxisValue, tds) {\n      return bind(tds, function (td) {\n        var rect = deflate(clone$1(td.getBoundingClientRect()), -1);\n        return [\n          {\n            x: rect.left,\n            y: getYAxisValue(rect),\n            cell: td\n          },\n          {\n            x: rect.right,\n            y: getYAxisValue(rect),\n            cell: td\n          }\n        ];\n      });\n    };\n    var findClosestCorner = function (corners, x, y) {\n      return foldl(corners, function (acc, newCorner) {\n        return acc.fold(function () {\n          return Option.some(newCorner);\n        }, function (oldCorner) {\n          var oldDist = Math.sqrt(Math.abs(oldCorner.x - x) + Math.abs(oldCorner.y - y));\n          var newDist = Math.sqrt(Math.abs(newCorner.x - x) + Math.abs(newCorner.y - y));\n          return Option.some(newDist < oldDist ? newCorner : oldCorner);\n        });\n      }, Option.none());\n    };\n    var getClosestCell$1 = function (getYAxisValue, isTargetCorner, table, x, y) {\n      var cells = descendants$1(Element.fromDom(table), 'td,th,caption').map(function (e) {\n        return e.dom();\n      });\n      var corners = filter(getCorners(getYAxisValue, cells), function (corner) {\n        return isTargetCorner(corner, y);\n      });\n      return findClosestCorner(corners, x, y).map(function (corner) {\n        return corner.cell;\n      });\n    };\n    var getBottomValue = function (rect) {\n      return rect.bottom;\n    };\n    var getTopValue = function (rect) {\n      return rect.top;\n    };\n    var isAbove$1 = function (corner, y) {\n      return corner.y < y;\n    };\n    var isBelow$1 = function (corner, y) {\n      return corner.y > y;\n    };\n    var getClosestCellAbove = curry(getClosestCell$1, getBottomValue, isAbove$1);\n    var getClosestCellBelow = curry(getClosestCell$1, getTopValue, isBelow$1);\n    var findClosestPositionInAboveCell = function (table, pos) {\n      return head(pos.getClientRects()).bind(function (rect) {\n        return getClosestCellAbove(table, rect.left, rect.top);\n      }).bind(function (cell) {\n        return findClosestHorizontalPosition(getLastLinePositions(cell), pos);\n      });\n    };\n    var findClosestPositionInBelowCell = function (table, pos) {\n      return last(pos.getClientRects()).bind(function (rect) {\n        return getClosestCellBelow(table, rect.left, rect.top);\n      }).bind(function (cell) {\n        return findClosestHorizontalPosition(getFirstLinePositions(cell), pos);\n      });\n    };\n\n    var hasNextBreak = function (getPositionsUntil, scope, lineInfo) {\n      return lineInfo.breakAt.map(function (breakPos) {\n        return getPositionsUntil(scope, breakPos).breakAt.isSome();\n      }).getOr(false);\n    };\n    var startsWithWrapBreak = function (lineInfo) {\n      return lineInfo.breakType === BreakType.Wrap && lineInfo.positions.length === 0;\n    };\n    var startsWithBrBreak = function (lineInfo) {\n      return lineInfo.breakType === BreakType.Br && lineInfo.positions.length === 1;\n    };\n    var isAtTableCellLine = function (getPositionsUntil, scope, pos) {\n      var lineInfo = getPositionsUntil(scope, pos);\n      if (startsWithWrapBreak(lineInfo) || !NodeType.isBr(pos.getNode()) && startsWithBrBreak(lineInfo)) {\n        return !hasNextBreak(getPositionsUntil, scope, lineInfo);\n      } else {\n        return lineInfo.breakAt.isNone();\n      }\n    };\n    var isAtFirstTableCellLine = curry(isAtTableCellLine, getPositionsUntilPreviousLine);\n    var isAtLastTableCellLine = curry(isAtTableCellLine, getPositionsUntilNextLine);\n    var isCaretAtStartOrEndOfTable = function (forward, rng, table) {\n      var caretPos = CaretPosition$1.fromRangeStart(rng);\n      return CaretFinder.positionIn(!forward, table).map(function (pos) {\n        return pos.isEqual(caretPos);\n      }).getOr(false);\n    };\n    var navigateHorizontally = function (editor, forward, table, td) {\n      var rng = editor.selection.getRng();\n      var direction = forward ? 1 : -1;\n      if (isFakeCaretTableBrowser() && isCaretAtStartOrEndOfTable(forward, rng, table)) {\n        var newRng = showCaret(direction, editor, table, !forward, true);\n        moveToRange(editor, newRng);\n        return true;\n      }\n      return false;\n    };\n    var getClosestAbovePosition = function (root, table, start) {\n      return findClosestPositionInAboveCell(table, start).orThunk(function () {\n        return head(start.getClientRects()).bind(function (rect) {\n          return findClosestHorizontalPositionFromPoint(getPositionsAbove(root, CaretPosition$1.before(table)), rect.left);\n        });\n      }).getOr(CaretPosition$1.before(table));\n    };\n    var getClosestBelowPosition = function (root, table, start) {\n      return findClosestPositionInBelowCell(table, start).orThunk(function () {\n        return head(start.getClientRects()).bind(function (rect) {\n          return findClosestHorizontalPositionFromPoint(getPositionsBelow(root, CaretPosition$1.after(table)), rect.left);\n        });\n      }).getOr(CaretPosition$1.after(table));\n    };\n    var getTable = function (previous, pos) {\n      var node = pos.getNode(previous);\n      return NodeType.isElement(node) && node.nodeName === 'TABLE' ? Option.some(node) : Option.none();\n    };\n    var renderBlock = function (down, editor, table, pos) {\n      var forcedRootBlock = Settings.getForcedRootBlock(editor);\n      if (forcedRootBlock) {\n        editor.undoManager.transact(function () {\n          var element = Element.fromTag(forcedRootBlock);\n          setAll(element, Settings.getForcedRootBlockAttrs(editor));\n          append(element, Element.fromTag('br'));\n          if (down) {\n            after(Element.fromDom(table), element);\n          } else {\n            before(Element.fromDom(table), element);\n          }\n          var rng = editor.dom.createRng();\n          rng.setStart(element.dom(), 0);\n          rng.setEnd(element.dom(), 0);\n          moveToRange(editor, rng);\n        });\n      } else {\n        moveToRange(editor, pos.toRange());\n      }\n    };\n    var moveCaret = function (editor, down, pos) {\n      var table = down ? getTable(true, pos) : getTable(false, pos);\n      var last = down === false;\n      table.fold(function () {\n        return moveToRange(editor, pos.toRange());\n      }, function (table) {\n        return CaretFinder.positionIn(last, editor.getBody()).filter(function (lastPos) {\n          return lastPos.isEqual(pos);\n        }).fold(function () {\n          return moveToRange(editor, pos.toRange());\n        }, function (_) {\n          return renderBlock(down, editor, table, pos);\n        });\n      });\n    };\n    var navigateVertically = function (editor, down, table, td) {\n      var rng = editor.selection.getRng();\n      var pos = CaretPosition$1.fromRangeStart(rng);\n      var root = editor.getBody();\n      if (!down && isAtFirstTableCellLine(td, pos)) {\n        var newPos = getClosestAbovePosition(root, table, pos);\n        moveCaret(editor, down, newPos);\n        return true;\n      } else if (down && isAtLastTableCellLine(td, pos)) {\n        var newPos = getClosestBelowPosition(root, table, pos);\n        moveCaret(editor, down, newPos);\n        return true;\n      } else {\n        return false;\n      }\n    };\n    var moveH$1 = function (editor, forward) {\n      return function () {\n        return Option.from(editor.dom.getParent(editor.selection.getNode(), 'td,th')).bind(function (td) {\n          return Option.from(editor.dom.getParent(td, 'table')).map(function (table) {\n            return navigateHorizontally(editor, forward, table);\n          });\n        }).getOr(false);\n      };\n    };\n    var moveV$1 = function (editor, forward) {\n      return function () {\n        return Option.from(editor.dom.getParent(editor.selection.getNode(), 'td,th')).bind(function (td) {\n          return Option.from(editor.dom.getParent(td, 'table')).map(function (table) {\n            return navigateVertically(editor, forward, table, td);\n          });\n        }).getOr(false);\n      };\n    };\n\n    var isTarget = function (node) {\n      return contains(['figcaption'], name(node));\n    };\n    var rangeBefore = function (target) {\n      var rng = domGlobals.document.createRange();\n      rng.setStartBefore(target.dom());\n      rng.setEndBefore(target.dom());\n      return rng;\n    };\n    var insertElement = function (root, elm, forward) {\n      if (forward) {\n        append(root, elm);\n      } else {\n        prepend(root, elm);\n      }\n    };\n    var insertBr = function (root, forward) {\n      var br = Element.fromTag('br');\n      insertElement(root, br, forward);\n      return rangeBefore(br);\n    };\n    var insertBlock$1 = function (root, forward, blockName, attrs) {\n      var block = Element.fromTag(blockName);\n      var br = Element.fromTag('br');\n      setAll(block, attrs);\n      append(block, br);\n      insertElement(root, block, forward);\n      return rangeBefore(br);\n    };\n    var insertEmptyLine = function (root, rootBlockName, attrs, forward) {\n      if (rootBlockName === '') {\n        return insertBr(root, forward);\n      } else {\n        return insertBlock$1(root, forward, rootBlockName, attrs);\n      }\n    };\n    var getClosestTargetBlock = function (pos, root) {\n      var isRoot = curry(eq, root);\n      return closest(Element.fromDom(pos.container()), isBlock, isRoot).filter(isTarget);\n    };\n    var isAtFirstOrLastLine = function (root, forward, pos) {\n      return forward ? isAtLastLine(root.dom(), pos) : isAtFirstLine(root.dom(), pos);\n    };\n    var moveCaretToNewEmptyLine = function (editor, forward) {\n      var root = Element.fromDom(editor.getBody());\n      var pos = CaretPosition$1.fromRangeStart(editor.selection.getRng());\n      var rootBlock = Settings.getForcedRootBlock(editor);\n      var rootBlockAttrs = Settings.getForcedRootBlockAttrs(editor);\n      return getClosestTargetBlock(pos, root).exists(function () {\n        if (isAtFirstOrLastLine(root, forward, pos)) {\n          var rng = insertEmptyLine(root, rootBlock, rootBlockAttrs, forward);\n          editor.selection.setRng(rng);\n          return true;\n        } else {\n          return false;\n        }\n      });\n    };\n    var moveV$2 = function (editor, forward) {\n      return function () {\n        if (editor.selection.isCollapsed()) {\n          return moveCaretToNewEmptyLine(editor, forward);\n        } else {\n          return false;\n        }\n      };\n    };\n\n    var defaultPatterns = function (patterns) {\n      return map(patterns, function (pattern) {\n        return merge({\n          shiftKey: false,\n          altKey: false,\n          ctrlKey: false,\n          metaKey: false,\n          keyCode: 0,\n          action: noop\n        }, pattern);\n      });\n    };\n    var matchesEvent = function (pattern, evt) {\n      return evt.keyCode === pattern.keyCode && evt.shiftKey === pattern.shiftKey && evt.altKey === pattern.altKey && evt.ctrlKey === pattern.ctrlKey && evt.metaKey === pattern.metaKey;\n    };\n    var match$1 = function (patterns, evt) {\n      return bind(defaultPatterns(patterns), function (pattern) {\n        return matchesEvent(pattern, evt) ? [pattern] : [];\n      });\n    };\n    var action = function (f) {\n      var x = [];\n      for (var _i = 1; _i < arguments.length; _i++) {\n        x[_i - 1] = arguments[_i];\n      }\n      var args = Array.prototype.slice.call(arguments, 1);\n      return function () {\n        return f.apply(null, args);\n      };\n    };\n    var execute = function (patterns, evt) {\n      return find(match$1(patterns, evt), function (pattern) {\n        return pattern.action();\n      });\n    };\n    var MatchKeys = {\n      match: match$1,\n      action: action,\n      execute: execute\n    };\n\n    var executeKeydownOverride = function (editor, caret, evt) {\n      var os = PlatformDetection$1.detect().os;\n      MatchKeys.execute([\n        {\n          keyCode: VK.RIGHT,\n          action: moveH(editor, true)\n        },\n        {\n          keyCode: VK.LEFT,\n          action: moveH(editor, false)\n        },\n        {\n          keyCode: VK.UP,\n          action: moveV(editor, false)\n        },\n        {\n          keyCode: VK.DOWN,\n          action: moveV(editor, true)\n        },\n        {\n          keyCode: VK.RIGHT,\n          action: moveH$1(editor, true)\n        },\n        {\n          keyCode: VK.LEFT,\n          action: moveH$1(editor, false)\n        },\n        {\n          keyCode: VK.UP,\n          action: moveV$1(editor, false)\n        },\n        {\n          keyCode: VK.DOWN,\n          action: moveV$1(editor, true)\n        },\n        {\n          keyCode: VK.RIGHT,\n          action: BoundarySelection.move(editor, caret, true)\n        },\n        {\n          keyCode: VK.LEFT,\n          action: BoundarySelection.move(editor, caret, false)\n        },\n        {\n          keyCode: VK.RIGHT,\n          ctrlKey: !os.isOSX(),\n          altKey: os.isOSX(),\n          action: BoundarySelection.moveNextWord(editor, caret)\n        },\n        {\n          keyCode: VK.LEFT,\n          ctrlKey: !os.isOSX(),\n          altKey: os.isOSX(),\n          action: BoundarySelection.movePrevWord(editor, caret)\n        },\n        {\n          keyCode: VK.UP,\n          action: moveV$2(editor, false)\n        },\n        {\n          keyCode: VK.DOWN,\n          action: moveV$2(editor, true)\n        }\n      ], evt).each(function (_) {\n        evt.preventDefault();\n      });\n    };\n    var setup$7 = function (editor, caret) {\n      editor.on('keydown', function (evt) {\n        if (evt.isDefaultPrevented() === false) {\n          executeKeydownOverride(editor, caret, evt);\n        }\n      });\n    };\n    var ArrowKeys = { setup: setup$7 };\n\n    var executeKeydownOverride$1 = function (editor, caret, evt) {\n      MatchKeys.execute([\n        {\n          keyCode: VK.BACKSPACE,\n          action: MatchKeys.action(CefDelete.backspaceDelete, editor, false)\n        },\n        {\n          keyCode: VK.DELETE,\n          action: MatchKeys.action(CefDelete.backspaceDelete, editor, true)\n        },\n        {\n          keyCode: VK.BACKSPACE,\n          action: MatchKeys.action(CefBoundaryDelete.backspaceDelete, editor, false)\n        },\n        {\n          keyCode: VK.DELETE,\n          action: MatchKeys.action(CefBoundaryDelete.backspaceDelete, editor, true)\n        },\n        {\n          keyCode: VK.BACKSPACE,\n          action: MatchKeys.action(InlineBoundaryDelete.backspaceDelete, editor, caret, false)\n        },\n        {\n          keyCode: VK.DELETE,\n          action: MatchKeys.action(InlineBoundaryDelete.backspaceDelete, editor, caret, true)\n        },\n        {\n          keyCode: VK.BACKSPACE,\n          action: MatchKeys.action(TableDelete.backspaceDelete, editor, false)\n        },\n        {\n          keyCode: VK.DELETE,\n          action: MatchKeys.action(TableDelete.backspaceDelete, editor, true)\n        },\n        {\n          keyCode: VK.BACKSPACE,\n          action: MatchKeys.action(BlockRangeDelete.backspaceDelete, editor, false)\n        },\n        {\n          keyCode: VK.DELETE,\n          action: MatchKeys.action(BlockRangeDelete.backspaceDelete, editor, true)\n        },\n        {\n          keyCode: VK.BACKSPACE,\n          action: MatchKeys.action(BlockBoundaryDelete.backspaceDelete, editor, false)\n        },\n        {\n          keyCode: VK.DELETE,\n          action: MatchKeys.action(BlockBoundaryDelete.backspaceDelete, editor, true)\n        },\n        {\n          keyCode: VK.BACKSPACE,\n          action: MatchKeys.action(InlineFormatDelete.backspaceDelete, editor, false)\n        },\n        {\n          keyCode: VK.DELETE,\n          action: MatchKeys.action(InlineFormatDelete.backspaceDelete, editor, true)\n        }\n      ], evt).each(function (_) {\n        evt.preventDefault();\n      });\n    };\n    var executeKeyupOverride = function (editor, evt) {\n      MatchKeys.execute([\n        {\n          keyCode: VK.BACKSPACE,\n          action: MatchKeys.action(CefDelete.paddEmptyElement, editor)\n        },\n        {\n          keyCode: VK.DELETE,\n          action: MatchKeys.action(CefDelete.paddEmptyElement, editor)\n        }\n      ], evt);\n    };\n    var setup$8 = function (editor, caret) {\n      editor.on('keydown', function (evt) {\n        if (evt.isDefaultPrevented() === false) {\n          executeKeydownOverride$1(editor, caret, evt);\n        }\n      });\n      editor.on('keyup', function (evt) {\n        if (evt.isDefaultPrevented() === false) {\n          executeKeyupOverride(editor, evt);\n        }\n      });\n    };\n    var DeleteBackspaceKeys = { setup: setup$8 };\n\n    var firstNonWhiteSpaceNodeSibling = function (node) {\n      while (node) {\n        if (node.nodeType === 1 || node.nodeType === 3 && node.data && /[\\r\\n\\s]/.test(node.data)) {\n          return node;\n        }\n        node = node.nextSibling;\n      }\n    };\n    var moveToCaretPosition = function (editor, root) {\n      var walker, node, rng, lastNode = root, tempElm;\n      var dom = editor.dom;\n      var moveCaretBeforeOnEnterElementsMap = editor.schema.getMoveCaretBeforeOnEnterElements();\n      if (!root) {\n        return;\n      }\n      if (/^(LI|DT|DD)$/.test(root.nodeName)) {\n        var firstChild = firstNonWhiteSpaceNodeSibling(root.firstChild);\n        if (firstChild && /^(UL|OL|DL)$/.test(firstChild.nodeName)) {\n          root.insertBefore(dom.doc.createTextNode('\\xA0'), root.firstChild);\n        }\n      }\n      rng = dom.createRng();\n      root.normalize();\n      if (root.hasChildNodes()) {\n        walker = new TreeWalker(root, root);\n        while (node = walker.current()) {\n          if (NodeType.isText(node)) {\n            rng.setStart(node, 0);\n            rng.setEnd(node, 0);\n            break;\n          }\n          if (moveCaretBeforeOnEnterElementsMap[node.nodeName.toLowerCase()]) {\n            rng.setStartBefore(node);\n            rng.setEndBefore(node);\n            break;\n          }\n          lastNode = node;\n          node = walker.next();\n        }\n        if (!node) {\n          rng.setStart(lastNode, 0);\n          rng.setEnd(lastNode, 0);\n        }\n      } else {\n        if (NodeType.isBr(root)) {\n          if (root.nextSibling && dom.isBlock(root.nextSibling)) {\n            rng.setStartBefore(root);\n            rng.setEndBefore(root);\n          } else {\n            rng.setStartAfter(root);\n            rng.setEndAfter(root);\n          }\n        } else {\n          rng.setStart(root, 0);\n          rng.setEnd(root, 0);\n        }\n      }\n      editor.selection.setRng(rng);\n      dom.remove(tempElm);\n      editor.selection.scrollIntoView(root);\n    };\n    var getEditableRoot = function (dom, node) {\n      var root = dom.getRoot();\n      var parent, editableRoot;\n      parent = node;\n      while (parent !== root && dom.getContentEditable(parent) !== 'false') {\n        if (dom.getContentEditable(parent) === 'true') {\n          editableRoot = parent;\n        }\n        parent = parent.parentNode;\n      }\n      return parent !== root ? editableRoot : root;\n    };\n    var getParentBlock$2 = function (editor) {\n      return Option.from(editor.dom.getParent(editor.selection.getStart(true), editor.dom.isBlock));\n    };\n    var getParentBlockName = function (editor) {\n      return getParentBlock$2(editor).fold(constant(''), function (parentBlock) {\n        return parentBlock.nodeName.toUpperCase();\n      });\n    };\n    var isListItemParentBlock = function (editor) {\n      return getParentBlock$2(editor).filter(function (elm) {\n        return isListItem(Element.fromDom(elm));\n      }).isSome();\n    };\n    var NewLineUtils = {\n      moveToCaretPosition: moveToCaretPosition,\n      getEditableRoot: getEditableRoot,\n      getParentBlock: getParentBlock$2,\n      getParentBlockName: getParentBlockName,\n      isListItemParentBlock: isListItemParentBlock\n    };\n\n    var hasFirstChild = function (elm, name) {\n      return elm.firstChild && elm.firstChild.nodeName === name;\n    };\n    var hasParent$1 = function (elm, parentName) {\n      return elm && elm.parentNode && elm.parentNode.nodeName === parentName;\n    };\n    var isListBlock = function (elm) {\n      return elm && /^(OL|UL|LI)$/.test(elm.nodeName);\n    };\n    var isNestedList = function (elm) {\n      return isListBlock(elm) && isListBlock(elm.parentNode);\n    };\n    var getContainerBlock = function (containerBlock) {\n      var containerBlockParent = containerBlock.parentNode;\n      if (/^(LI|DT|DD)$/.test(containerBlockParent.nodeName)) {\n        return containerBlockParent;\n      }\n      return containerBlock;\n    };\n    var isFirstOrLastLi = function (containerBlock, parentBlock, first) {\n      var node = containerBlock[first ? 'firstChild' : 'lastChild'];\n      while (node) {\n        if (NodeType.isElement(node)) {\n          break;\n        }\n        node = node[first ? 'nextSibling' : 'previousSibling'];\n      }\n      return node === parentBlock;\n    };\n    var insert$1 = function (editor, createNewBlock, containerBlock, parentBlock, newBlockName) {\n      var dom = editor.dom;\n      var rng = editor.selection.getRng();\n      if (containerBlock === editor.getBody()) {\n        return;\n      }\n      if (isNestedList(containerBlock)) {\n        newBlockName = 'LI';\n      }\n      var newBlock = newBlockName ? createNewBlock(newBlockName) : dom.create('BR');\n      if (isFirstOrLastLi(containerBlock, parentBlock, true) && isFirstOrLastLi(containerBlock, parentBlock, false)) {\n        if (hasParent$1(containerBlock, 'LI')) {\n          dom.insertAfter(newBlock, getContainerBlock(containerBlock));\n        } else {\n          dom.replace(newBlock, containerBlock);\n        }\n      } else if (isFirstOrLastLi(containerBlock, parentBlock, true)) {\n        if (hasParent$1(containerBlock, 'LI')) {\n          dom.insertAfter(newBlock, getContainerBlock(containerBlock));\n          newBlock.appendChild(dom.doc.createTextNode(' '));\n          newBlock.appendChild(containerBlock);\n        } else {\n          containerBlock.parentNode.insertBefore(newBlock, containerBlock);\n        }\n      } else if (isFirstOrLastLi(containerBlock, parentBlock, false)) {\n        dom.insertAfter(newBlock, getContainerBlock(containerBlock));\n      } else {\n        containerBlock = getContainerBlock(containerBlock);\n        var tmpRng = rng.cloneRange();\n        tmpRng.setStartAfter(parentBlock);\n        tmpRng.setEndAfter(containerBlock);\n        var fragment = tmpRng.extractContents();\n        if (newBlockName === 'LI' && hasFirstChild(fragment, 'LI')) {\n          newBlock = fragment.firstChild;\n          dom.insertAfter(fragment, containerBlock);\n        } else {\n          dom.insertAfter(fragment, containerBlock);\n          dom.insertAfter(newBlock, containerBlock);\n        }\n      }\n      dom.remove(parentBlock);\n      NewLineUtils.moveToCaretPosition(editor, newBlock);\n    };\n    var InsertLi = { insert: insert$1 };\n\n    var trimZwsp = function (fragment) {\n      each(descendants(Element.fromDom(fragment), isText), function (text) {\n        var rawNode = text.dom();\n        rawNode.nodeValue = Zwsp.trim(rawNode.nodeValue);\n      });\n    };\n    var isEmptyAnchor = function (dom, elm) {\n      return elm && elm.nodeName === 'A' && dom.isEmpty(elm);\n    };\n    var isTableCell$5 = function (node) {\n      return node && /^(TD|TH|CAPTION)$/.test(node.nodeName);\n    };\n    var emptyBlock = function (elm) {\n      elm.innerHTML = '<br data-mce-bogus=\"1\">';\n    };\n    var containerAndSiblingName = function (container, nodeName) {\n      return container.nodeName === nodeName || container.previousSibling && container.previousSibling.nodeName === nodeName;\n    };\n    var canSplitBlock = function (dom, node) {\n      return node && dom.isBlock(node) && !/^(TD|TH|CAPTION|FORM)$/.test(node.nodeName) && !/^(fixed|absolute)/i.test(node.style.position) && dom.getContentEditable(node) !== 'true';\n    };\n    var trimInlineElementsOnLeftSideOfBlock = function (dom, nonEmptyElementsMap, block) {\n      var node = block;\n      var firstChilds = [];\n      var i;\n      if (!node) {\n        return;\n      }\n      while (node = node.firstChild) {\n        if (dom.isBlock(node)) {\n          return;\n        }\n        if (NodeType.isElement(node) && !nonEmptyElementsMap[node.nodeName.toLowerCase()]) {\n          firstChilds.push(node);\n        }\n      }\n      i = firstChilds.length;\n      while (i--) {\n        node = firstChilds[i];\n        if (!node.hasChildNodes() || node.firstChild === node.lastChild && node.firstChild.nodeValue === '') {\n          dom.remove(node);\n        } else {\n          if (isEmptyAnchor(dom, node)) {\n            dom.remove(node);\n          }\n        }\n      }\n    };\n    var normalizeZwspOffset = function (start, container, offset) {\n      if (NodeType.isText(container) === false) {\n        return offset;\n      } else if (start) {\n        return offset === 1 && container.data.charAt(offset - 1) === Zwsp.ZWSP ? 0 : offset;\n      } else {\n        return offset === container.data.length - 1 && container.data.charAt(offset) === Zwsp.ZWSP ? container.data.length : offset;\n      }\n    };\n    var includeZwspInRange = function (rng) {\n      var newRng = rng.cloneRange();\n      newRng.setStart(rng.startContainer, normalizeZwspOffset(true, rng.startContainer, rng.startOffset));\n      newRng.setEnd(rng.endContainer, normalizeZwspOffset(false, rng.endContainer, rng.endOffset));\n      return newRng;\n    };\n    var trimLeadingLineBreaks = function (node) {\n      do {\n        if (NodeType.isText(node)) {\n          node.nodeValue = node.nodeValue.replace(/^[\\r\\n]+/, '');\n        }\n        node = node.firstChild;\n      } while (node);\n    };\n    var getEditableRoot$1 = function (dom, node) {\n      var root = dom.getRoot();\n      var parent, editableRoot;\n      parent = node;\n      while (parent !== root && dom.getContentEditable(parent) !== 'false') {\n        if (dom.getContentEditable(parent) === 'true') {\n          editableRoot = parent;\n        }\n        parent = parent.parentNode;\n      }\n      return parent !== root ? editableRoot : root;\n    };\n    var applyAttributes = function (editor, node, forcedRootBlockAttrs) {\n      Option.from(forcedRootBlockAttrs.style).map(editor.dom.parseStyle).each(function (attrStyles) {\n        var currentStyles = getAllRaw(Element.fromDom(node));\n        var newStyles = __assign(__assign({}, currentStyles), attrStyles);\n        editor.dom.setStyles(node, newStyles);\n      });\n      var attrClassesOpt = Option.from(forcedRootBlockAttrs.class).map(function (attrClasses) {\n        return attrClasses.split(/\\s+/);\n      });\n      var currentClassesOpt = Option.from(node.className).map(function (currentClasses) {\n        return filter(currentClasses.split(/\\s+/), function (clazz) {\n          return clazz !== '';\n        });\n      });\n      lift2(attrClassesOpt, currentClassesOpt, function (attrClasses, currentClasses) {\n        var filteredClasses = filter(currentClasses, function (clazz) {\n          return !contains(attrClasses, clazz);\n        });\n        var newClasses = __spreadArrays(attrClasses, filteredClasses);\n        editor.dom.setAttrib(node, 'class', newClasses.join(' '));\n      });\n      var appliedAttrs = [\n        'style',\n        'class'\n      ];\n      var remainingAttrs = bifilter(forcedRootBlockAttrs, function (_, attrs) {\n        return !contains(appliedAttrs, attrs);\n      }).t;\n      editor.dom.setAttribs(node, remainingAttrs);\n    };\n    var setForcedBlockAttrs = function (editor, node) {\n      var forcedRootBlockName = Settings.getForcedRootBlock(editor);\n      if (forcedRootBlockName && forcedRootBlockName.toLowerCase() === node.tagName.toLowerCase()) {\n        var forcedRootBlockAttrs = Settings.getForcedRootBlockAttrs(editor);\n        applyAttributes(editor, node, forcedRootBlockAttrs);\n      }\n    };\n    var wrapSelfAndSiblingsInDefaultBlock = function (editor, newBlockName, rng, container, offset) {\n      var newBlock, parentBlock, startNode, node, next, rootBlockName;\n      var blockName = newBlockName || 'P';\n      var dom = editor.dom, editableRoot = getEditableRoot$1(dom, container);\n      parentBlock = dom.getParent(container, dom.isBlock);\n      if (!parentBlock || !canSplitBlock(dom, parentBlock)) {\n        parentBlock = parentBlock || editableRoot;\n        if (parentBlock === editor.getBody() || isTableCell$5(parentBlock)) {\n          rootBlockName = parentBlock.nodeName.toLowerCase();\n        } else {\n          rootBlockName = parentBlock.parentNode.nodeName.toLowerCase();\n        }\n        if (!parentBlock.hasChildNodes()) {\n          newBlock = dom.create(blockName);\n          setForcedBlockAttrs(editor, newBlock);\n          parentBlock.appendChild(newBlock);\n          rng.setStart(newBlock, 0);\n          rng.setEnd(newBlock, 0);\n          return newBlock;\n        }\n        node = container;\n        while (node.parentNode !== parentBlock) {\n          node = node.parentNode;\n        }\n        while (node && !dom.isBlock(node)) {\n          startNode = node;\n          node = node.previousSibling;\n        }\n        if (startNode && editor.schema.isValidChild(rootBlockName, blockName.toLowerCase())) {\n          newBlock = dom.create(blockName);\n          setForcedBlockAttrs(editor, newBlock);\n          startNode.parentNode.insertBefore(newBlock, startNode);\n          node = startNode;\n          while (node && !dom.isBlock(node)) {\n            next = node.nextSibling;\n            newBlock.appendChild(node);\n            node = next;\n          }\n          rng.setStart(container, offset);\n          rng.setEnd(container, offset);\n        }\n      }\n      return container;\n    };\n    var addBrToBlockIfNeeded = function (dom, block) {\n      var lastChild;\n      block.normalize();\n      lastChild = block.lastChild;\n      if (!lastChild || /^(left|right)$/gi.test(dom.getStyle(lastChild, 'float', true))) {\n        dom.add(block, 'br');\n      }\n    };\n    var insert$2 = function (editor, evt) {\n      var tmpRng, editableRoot, container, offset, parentBlock, shiftKey;\n      var newBlock, fragment, containerBlock, parentBlockName, containerBlockName, newBlockName, isAfterLastNodeInContainer;\n      var dom = editor.dom;\n      var schema = editor.schema, nonEmptyElementsMap = schema.getNonEmptyElements();\n      var rng = editor.selection.getRng();\n      var createNewBlock = function (name) {\n        var node = container, block, clonedNode, caretNode;\n        var textInlineElements = schema.getTextInlineElements();\n        if (name || parentBlockName === 'TABLE' || parentBlockName === 'HR') {\n          block = dom.create(name || newBlockName);\n        } else {\n          block = parentBlock.cloneNode(false);\n        }\n        caretNode = block;\n        if (Settings.shouldKeepStyles(editor) === false) {\n          dom.setAttrib(block, 'style', null);\n          dom.setAttrib(block, 'class', null);\n        } else {\n          do {\n            if (textInlineElements[node.nodeName]) {\n              if (isCaretNode(node) || Bookmarks.isBookmarkNode(node)) {\n                continue;\n              }\n              clonedNode = node.cloneNode(false);\n              dom.setAttrib(clonedNode, 'id', '');\n              if (block.hasChildNodes()) {\n                clonedNode.appendChild(block.firstChild);\n                block.appendChild(clonedNode);\n              } else {\n                caretNode = clonedNode;\n                block.appendChild(clonedNode);\n              }\n            }\n          } while ((node = node.parentNode) && node !== editableRoot);\n        }\n        setForcedBlockAttrs(editor, block);\n        emptyBlock(caretNode);\n        return block;\n      };\n      var isCaretAtStartOrEndOfBlock = function (start) {\n        var walker, node, name, normalizedOffset;\n        normalizedOffset = normalizeZwspOffset(start, container, offset);\n        if (NodeType.isText(container) && (start ? normalizedOffset > 0 : normalizedOffset < container.nodeValue.length)) {\n          return false;\n        }\n        if (container.parentNode === parentBlock && isAfterLastNodeInContainer && !start) {\n          return true;\n        }\n        if (start && NodeType.isElement(container) && container === parentBlock.firstChild) {\n          return true;\n        }\n        if (containerAndSiblingName(container, 'TABLE') || containerAndSiblingName(container, 'HR')) {\n          return isAfterLastNodeInContainer && !start || !isAfterLastNodeInContainer && start;\n        }\n        walker = new TreeWalker(container, parentBlock);\n        if (NodeType.isText(container)) {\n          if (start && normalizedOffset === 0) {\n            walker.prev();\n          } else if (!start && normalizedOffset === container.nodeValue.length) {\n            walker.next();\n          }\n        }\n        while (node = walker.current()) {\n          if (NodeType.isElement(node)) {\n            if (!node.getAttribute('data-mce-bogus')) {\n              name = node.nodeName.toLowerCase();\n              if (nonEmptyElementsMap[name] && name !== 'br') {\n                return false;\n              }\n            }\n          } else if (NodeType.isText(node) && !/^[ \\t\\r\\n]*$/.test(node.nodeValue)) {\n            return false;\n          }\n          if (start) {\n            walker.prev();\n          } else {\n            walker.next();\n          }\n        }\n        return true;\n      };\n      var insertNewBlockAfter = function () {\n        if (/^(H[1-6]|PRE|FIGURE)$/.test(parentBlockName) && containerBlockName !== 'HGROUP') {\n          newBlock = createNewBlock(newBlockName);\n        } else {\n          newBlock = createNewBlock();\n        }\n        if (Settings.shouldEndContainerOnEmptyBlock(editor) && canSplitBlock(dom, containerBlock) && dom.isEmpty(parentBlock)) {\n          newBlock = dom.split(containerBlock, parentBlock);\n        } else {\n          dom.insertAfter(newBlock, parentBlock);\n        }\n        NewLineUtils.moveToCaretPosition(editor, newBlock);\n      };\n      NormalizeRange.normalize(dom, rng).each(function (normRng) {\n        rng.setStart(normRng.startContainer, normRng.startOffset);\n        rng.setEnd(normRng.endContainer, normRng.endOffset);\n      });\n      container = rng.startContainer;\n      offset = rng.startOffset;\n      newBlockName = Settings.getForcedRootBlock(editor);\n      shiftKey = evt.shiftKey;\n      if (NodeType.isElement(container) && container.hasChildNodes()) {\n        isAfterLastNodeInContainer = offset > container.childNodes.length - 1;\n        container = container.childNodes[Math.min(offset, container.childNodes.length - 1)] || container;\n        if (isAfterLastNodeInContainer && NodeType.isText(container)) {\n          offset = container.nodeValue.length;\n        } else {\n          offset = 0;\n        }\n      }\n      editableRoot = getEditableRoot$1(dom, container);\n      if (!editableRoot) {\n        return;\n      }\n      if (newBlockName && !shiftKey || !newBlockName && shiftKey) {\n        container = wrapSelfAndSiblingsInDefaultBlock(editor, newBlockName, rng, container, offset);\n      }\n      parentBlock = dom.getParent(container, dom.isBlock);\n      containerBlock = parentBlock ? dom.getParent(parentBlock.parentNode, dom.isBlock) : null;\n      parentBlockName = parentBlock ? parentBlock.nodeName.toUpperCase() : '';\n      containerBlockName = containerBlock ? containerBlock.nodeName.toUpperCase() : '';\n      if (containerBlockName === 'LI' && !evt.ctrlKey) {\n        parentBlock = containerBlock;\n        containerBlock = containerBlock.parentNode;\n        parentBlockName = containerBlockName;\n      }\n      if (/^(LI|DT|DD)$/.test(parentBlockName)) {\n        if (dom.isEmpty(parentBlock)) {\n          InsertLi.insert(editor, createNewBlock, containerBlock, parentBlock, newBlockName);\n          return;\n        }\n      }\n      if (newBlockName && parentBlock === editor.getBody()) {\n        return;\n      }\n      newBlockName = newBlockName || 'P';\n      if (isCaretContainerBlock(parentBlock)) {\n        newBlock = showCaretContainerBlock(parentBlock);\n        if (dom.isEmpty(parentBlock)) {\n          emptyBlock(parentBlock);\n        }\n        setForcedBlockAttrs(editor, newBlock);\n        NewLineUtils.moveToCaretPosition(editor, newBlock);\n      } else if (isCaretAtStartOrEndOfBlock()) {\n        insertNewBlockAfter();\n      } else if (isCaretAtStartOrEndOfBlock(true)) {\n        newBlock = parentBlock.parentNode.insertBefore(createNewBlock(), parentBlock);\n        NewLineUtils.moveToCaretPosition(editor, containerAndSiblingName(parentBlock, 'HR') ? newBlock : parentBlock);\n      } else {\n        tmpRng = includeZwspInRange(rng).cloneRange();\n        tmpRng.setEndAfter(parentBlock);\n        fragment = tmpRng.extractContents();\n        trimZwsp(fragment);\n        trimLeadingLineBreaks(fragment);\n        newBlock = fragment.firstChild;\n        dom.insertAfter(fragment, parentBlock);\n        trimInlineElementsOnLeftSideOfBlock(dom, nonEmptyElementsMap, newBlock);\n        addBrToBlockIfNeeded(dom, parentBlock);\n        if (dom.isEmpty(parentBlock)) {\n          emptyBlock(parentBlock);\n        }\n        newBlock.normalize();\n        if (dom.isEmpty(newBlock)) {\n          dom.remove(newBlock);\n          insertNewBlockAfter();\n        } else {\n          setForcedBlockAttrs(editor, newBlock);\n          NewLineUtils.moveToCaretPosition(editor, newBlock);\n        }\n      }\n      dom.setAttrib(newBlock, 'id', '');\n      editor.fire('NewBlock', { newBlock: newBlock });\n    };\n    var InsertBlock = { insert: insert$2 };\n\n    var matchesSelector = function (editor, selector) {\n      return NewLineUtils.getParentBlock(editor).filter(function (parentBlock) {\n        return selector.length > 0 && is$1(Element.fromDom(parentBlock), selector);\n      }).isSome();\n    };\n    var shouldInsertBr = function (editor) {\n      return matchesSelector(editor, Settings.getBrNewLineSelector(editor));\n    };\n    var shouldBlockNewLine = function (editor) {\n      return matchesSelector(editor, Settings.getNoNewLineSelector(editor));\n    };\n    var ContextSelectors = {\n      shouldInsertBr: shouldInsertBr,\n      shouldBlockNewLine: shouldBlockNewLine\n    };\n\n    var newLineAction = Adt.generate([\n      { br: [] },\n      { block: [] },\n      { none: [] }\n    ]);\n    var shouldBlockNewLine$1 = function (editor, shiftKey) {\n      return ContextSelectors.shouldBlockNewLine(editor);\n    };\n    var isBrMode = function (requiredState) {\n      return function (editor, shiftKey) {\n        var brMode = Settings.getForcedRootBlock(editor) === '';\n        return brMode === requiredState;\n      };\n    };\n    var inListBlock = function (requiredState) {\n      return function (editor, shiftKey) {\n        return NewLineUtils.isListItemParentBlock(editor) === requiredState;\n      };\n    };\n    var inBlock = function (blockName, requiredState) {\n      return function (editor, shiftKey) {\n        var state = NewLineUtils.getParentBlockName(editor) === blockName.toUpperCase();\n        return state === requiredState;\n      };\n    };\n    var inPreBlock = function (requiredState) {\n      return inBlock('pre', requiredState);\n    };\n    var inSummaryBlock = function () {\n      return inBlock('summary', true);\n    };\n    var shouldPutBrInPre$1 = function (requiredState) {\n      return function (editor, shiftKey) {\n        return Settings.shouldPutBrInPre(editor) === requiredState;\n      };\n    };\n    var inBrContext = function (editor, shiftKey) {\n      return ContextSelectors.shouldInsertBr(editor);\n    };\n    var hasShiftKey = function (editor, shiftKey) {\n      return shiftKey;\n    };\n    var canInsertIntoEditableRoot = function (editor) {\n      var forcedRootBlock = Settings.getForcedRootBlock(editor);\n      var rootEditable = NewLineUtils.getEditableRoot(editor.dom, editor.selection.getStart());\n      return rootEditable && editor.schema.isValidChild(rootEditable.nodeName, forcedRootBlock ? forcedRootBlock : 'P');\n    };\n    var match$2 = function (predicates, action) {\n      return function (editor, shiftKey) {\n        var isMatch = foldl(predicates, function (res, p) {\n          return res && p(editor, shiftKey);\n        }, true);\n        return isMatch ? Option.some(action) : Option.none();\n      };\n    };\n    var getAction$1 = function (editor, evt) {\n      return LazyEvaluator.evaluateUntil([\n        match$2([shouldBlockNewLine$1], newLineAction.none()),\n        match$2([inSummaryBlock()], newLineAction.br()),\n        match$2([\n          inPreBlock(true),\n          shouldPutBrInPre$1(false),\n          hasShiftKey\n        ], newLineAction.br()),\n        match$2([\n          inPreBlock(true),\n          shouldPutBrInPre$1(false)\n        ], newLineAction.block()),\n        match$2([\n          inPreBlock(true),\n          shouldPutBrInPre$1(true),\n          hasShiftKey\n        ], newLineAction.block()),\n        match$2([\n          inPreBlock(true),\n          shouldPutBrInPre$1(true)\n        ], newLineAction.br()),\n        match$2([\n          inListBlock(true),\n          hasShiftKey\n        ], newLineAction.br()),\n        match$2([inListBlock(true)], newLineAction.block()),\n        match$2([\n          isBrMode(true),\n          hasShiftKey,\n          canInsertIntoEditableRoot\n        ], newLineAction.block()),\n        match$2([isBrMode(true)], newLineAction.br()),\n        match$2([inBrContext], newLineAction.br()),\n        match$2([\n          isBrMode(false),\n          hasShiftKey\n        ], newLineAction.br()),\n        match$2([canInsertIntoEditableRoot], newLineAction.block())\n      ], [\n        editor,\n        evt.shiftKey\n      ]).getOr(newLineAction.none());\n    };\n    var NewLineAction = { getAction: getAction$1 };\n\n    var insert$3 = function (editor, evt) {\n      NewLineAction.getAction(editor, evt).fold(function () {\n        InsertBr.insert(editor, evt);\n      }, function () {\n        InsertBlock.insert(editor, evt);\n      }, noop);\n    };\n    var InsertNewLine = { insert: insert$3 };\n\n    var endTypingLevel = function (undoManager) {\n      if (undoManager.typing) {\n        undoManager.typing = false;\n        undoManager.add();\n      }\n    };\n    var handleEnterKeyEvent = function (editor, event) {\n      if (event.isDefaultPrevented()) {\n        return;\n      }\n      event.preventDefault();\n      endTypingLevel(editor.undoManager);\n      editor.undoManager.transact(function () {\n        if (editor.selection.isCollapsed() === false) {\n          editor.execCommand('Delete');\n        }\n        InsertNewLine.insert(editor, event);\n      });\n    };\n    var setup$9 = function (editor) {\n      editor.on('keydown', function (event) {\n        if (event.keyCode === VK.ENTER) {\n          handleEnterKeyEvent(editor, event);\n        }\n      });\n    };\n    var EnterKey = { setup: setup$9 };\n\n    var insertTextAtPosition = function (text, pos) {\n      var container = pos.container();\n      var offset = pos.offset();\n      if (NodeType.isText(container)) {\n        container.insertData(offset, text);\n        return Option.some(CaretPosition(container, offset + text.length));\n      } else {\n        return getElementFromPosition(pos).map(function (elm) {\n          var textNode = Element.fromText(text);\n          if (pos.isAtEnd()) {\n            after(elm, textNode);\n          } else {\n            before(elm, textNode);\n          }\n          return CaretPosition(textNode.dom(), text.length);\n        });\n      }\n    };\n    var insertNbspAtPosition = curry(insertTextAtPosition, '\\xA0');\n    var insertSpaceAtPosition = curry(insertTextAtPosition, ' ');\n\n    var navigateIgnoreEmptyTextNodes = function (forward, root, from) {\n      return CaretFinder.navigateIgnore(forward, root, from, isEmptyText);\n    };\n    var getClosestBlock = function (root, pos) {\n      return find(Parents.parentsAndSelf(Element.fromDom(pos.container()), root), isBlock);\n    };\n    var isAtBeforeAfterBlockBoundary = function (forward, root, pos) {\n      return navigateIgnoreEmptyTextNodes(forward, root.dom(), pos).forall(function (newPos) {\n        return getClosestBlock(root, pos).fold(function () {\n          return isInSameBlock(newPos, pos, root.dom()) === false;\n        }, function (fromBlock) {\n          return isInSameBlock(newPos, pos, root.dom()) === false && contains$3(fromBlock, Element.fromDom(newPos.container()));\n        });\n      });\n    };\n    var isAtBlockBoundary = function (forward, root, pos) {\n      return getClosestBlock(root, pos).fold(function () {\n        return navigateIgnoreEmptyTextNodes(forward, root.dom(), pos).forall(function (newPos) {\n          return isInSameBlock(newPos, pos, root.dom()) === false;\n        });\n      }, function (parent) {\n        return navigateIgnoreEmptyTextNodes(forward, parent.dom(), pos).isNone();\n      });\n    };\n    var isAtStartOfBlock = curry(isAtBlockBoundary, false);\n    var isAtEndOfBlock = curry(isAtBlockBoundary, true);\n    var isBeforeBlock = curry(isAtBeforeAfterBlockBoundary, false);\n    var isAfterBlock = curry(isAtBeforeAfterBlockBoundary, true);\n\n    var nbsp = '\\xA0';\n    var isInMiddleOfText = function (pos) {\n      return CaretPosition.isTextPosition(pos) && !pos.isAtStart() && !pos.isAtEnd();\n    };\n    var getClosestBlock$1 = function (root, pos) {\n      var parentBlocks = filter(Parents.parentsAndSelf(Element.fromDom(pos.container()), root), isBlock);\n      return head(parentBlocks).getOr(root);\n    };\n    var hasSpaceBefore = function (root, pos) {\n      if (isInMiddleOfText(pos)) {\n        return isAfterSpace(pos);\n      } else {\n        return isAfterSpace(pos) || CaretFinder.prevPosition(getClosestBlock$1(root, pos).dom(), pos).exists(isAfterSpace);\n      }\n    };\n    var hasSpaceAfter = function (root, pos) {\n      if (isInMiddleOfText(pos)) {\n        return isBeforeSpace(pos);\n      } else {\n        return isBeforeSpace(pos) || CaretFinder.nextPosition(getClosestBlock$1(root, pos).dom(), pos).exists(isBeforeSpace);\n      }\n    };\n    var isPreValue = function (value) {\n      return contains([\n        'pre',\n        'pre-wrap'\n      ], value);\n    };\n    var isInPre = function (pos) {\n      return getElementFromPosition(pos).bind(function (elm) {\n        return closest(elm, isElement);\n      }).exists(function (elm) {\n        return isPreValue(get$1(elm, 'white-space'));\n      });\n    };\n    var isAtBeginningOfBody = function (root, pos) {\n      return CaretFinder.prevPosition(root.dom(), pos).isNone();\n    };\n    var isAtEndOfBody = function (root, pos) {\n      return CaretFinder.nextPosition(root.dom(), pos).isNone();\n    };\n    var isAtLineBoundary = function (root, pos) {\n      return isAtBeginningOfBody(root, pos) || isAtEndOfBody(root, pos) || isAtStartOfBlock(root, pos) || isAtEndOfBlock(root, pos) || isAfterBr(root, pos) || isBeforeBr(root, pos);\n    };\n    var needsToHaveNbsp = function (root, pos) {\n      if (isInPre(pos)) {\n        return false;\n      } else {\n        return isAtLineBoundary(root, pos) || hasSpaceBefore(root, pos) || hasSpaceAfter(root, pos);\n      }\n    };\n    var needsToBeNbspLeft = function (root, pos) {\n      if (isInPre(pos)) {\n        return false;\n      } else {\n        return isAtStartOfBlock(root, pos) || isBeforeBlock(root, pos) || isAfterBr(root, pos) || hasSpaceBefore(root, pos);\n      }\n    };\n    var leanRight = function (pos) {\n      var container = pos.container();\n      var offset = pos.offset();\n      if (NodeType.isText(container) && offset < container.data.length) {\n        return CaretPosition(container, offset + 1);\n      } else {\n        return pos;\n      }\n    };\n    var needsToBeNbspRight = function (root, pos) {\n      var afterPos = leanRight(pos);\n      if (isInPre(afterPos)) {\n        return false;\n      } else {\n        return isAtEndOfBlock(root, afterPos) || isAfterBlock(root, afterPos) || isBeforeBr(root, afterPos) || hasSpaceAfter(root, afterPos);\n      }\n    };\n    var needsToBeNbsp = function (root, pos) {\n      return needsToBeNbspLeft(root, pos) || needsToBeNbspRight(root, pos);\n    };\n    var isNbspAt = function (text, offset) {\n      return isNbsp(text.charAt(offset));\n    };\n    var hasNbsp = function (pos) {\n      var container = pos.container();\n      return NodeType.isText(container) && contains$2(container.data, nbsp);\n    };\n    var normalizeNbspMiddle = function (text) {\n      var chars = text.split('');\n      return map(chars, function (chr, i) {\n        if (isNbsp(chr) && i > 0 && i < chars.length - 1 && isContent$1(chars[i - 1]) && isContent$1(chars[i + 1])) {\n          return ' ';\n        } else {\n          return chr;\n        }\n      }).join('');\n    };\n    var normalizeNbspAtStart = function (root, node) {\n      var text = node.data;\n      var firstPos = CaretPosition(node, 0);\n      if (isNbspAt(text, 0) && !needsToBeNbsp(root, firstPos)) {\n        node.data = ' ' + text.slice(1);\n        return true;\n      } else {\n        return false;\n      }\n    };\n    var normalizeNbspInMiddleOfTextNode = function (node) {\n      var text = node.data;\n      var newText = normalizeNbspMiddle(text);\n      if (newText !== text) {\n        node.data = newText;\n        return true;\n      } else {\n        return false;\n      }\n    };\n    var normalizeNbspAtEnd = function (root, node) {\n      var text = node.data;\n      var lastPos = CaretPosition(node, text.length - 1);\n      if (isNbspAt(text, text.length - 1) && !needsToBeNbsp(root, lastPos)) {\n        node.data = text.slice(0, -1) + ' ';\n        return true;\n      } else {\n        return false;\n      }\n    };\n    var normalizeNbsps = function (root, pos) {\n      return Option.some(pos).filter(hasNbsp).bind(function (pos) {\n        var container = pos.container();\n        var normalized = normalizeNbspAtStart(root, container) || normalizeNbspInMiddleOfTextNode(container) || normalizeNbspAtEnd(root, container);\n        return normalized ? Option.some(pos) : Option.none();\n      });\n    };\n    var normalizeNbspsInEditor = function (editor) {\n      var root = Element.fromDom(editor.getBody());\n      if (editor.selection.isCollapsed()) {\n        normalizeNbsps(root, CaretPosition.fromRangeStart(editor.selection.getRng())).each(function (pos) {\n          editor.selection.setRng(pos.toRange());\n        });\n      }\n    };\n\n    var locationToCaretPosition = function (root) {\n      return function (location) {\n        return location.fold(function (element) {\n          return CaretFinder.prevPosition(root.dom(), CaretPosition$1.before(element));\n        }, function (element) {\n          return CaretFinder.firstPositionIn(element);\n        }, function (element) {\n          return CaretFinder.lastPositionIn(element);\n        }, function (element) {\n          return CaretFinder.nextPosition(root.dom(), CaretPosition$1.after(element));\n        });\n      };\n    };\n    var insertInlineBoundarySpaceOrNbsp = function (root, pos) {\n      return function (checkPos) {\n        return needsToHaveNbsp(root, checkPos) ? insertNbspAtPosition(pos) : insertSpaceAtPosition(pos);\n      };\n    };\n    var setSelection$1 = function (editor) {\n      return function (pos) {\n        editor.selection.setRng(pos.toRange());\n        editor.nodeChanged();\n        return true;\n      };\n    };\n    var insertSpaceOrNbspAtSelection = function (editor) {\n      var pos = CaretPosition$1.fromRangeStart(editor.selection.getRng());\n      var root = Element.fromDom(editor.getBody());\n      if (editor.selection.isCollapsed()) {\n        var isInlineTarget = curry(InlineUtils.isInlineTarget, editor);\n        var caretPosition = CaretPosition$1.fromRangeStart(editor.selection.getRng());\n        return BoundaryLocation.readLocation(isInlineTarget, editor.getBody(), caretPosition).bind(locationToCaretPosition(root)).bind(insertInlineBoundarySpaceOrNbsp(root, pos)).exists(setSelection$1(editor));\n      } else {\n        return false;\n      }\n    };\n\n    var executeKeydownOverride$2 = function (editor, evt) {\n      MatchKeys.execute([{\n          keyCode: VK.SPACEBAR,\n          action: MatchKeys.action(insertSpaceOrNbspAtSelection, editor)\n        }], evt).each(function (_) {\n        evt.preventDefault();\n      });\n    };\n    var setup$a = function (editor) {\n      editor.on('keydown', function (evt) {\n        if (evt.isDefaultPrevented() === false) {\n          executeKeydownOverride$2(editor, evt);\n        }\n      });\n    };\n    var SpaceKey = { setup: setup$a };\n\n    var findBlockCaretContainer = function (editor) {\n      return descendant(Element.fromDom(editor.getBody()), '*[data-mce-caret]').fold(constant(null), function (elm) {\n        return elm.dom();\n      });\n    };\n    var removeIeControlRect = function (editor) {\n      editor.selection.setRng(editor.selection.getRng());\n    };\n    var showBlockCaretContainer = function (editor, blockCaretContainer) {\n      if (blockCaretContainer.hasAttribute('data-mce-caret')) {\n        showCaretContainerBlock(blockCaretContainer);\n        removeIeControlRect(editor);\n        editor.selection.scrollIntoView(blockCaretContainer);\n      }\n    };\n    var handleBlockContainer = function (editor, e) {\n      var blockCaretContainer = findBlockCaretContainer(editor);\n      if (!blockCaretContainer) {\n        return;\n      }\n      if (e.type === 'compositionstart') {\n        e.preventDefault();\n        e.stopPropagation();\n        showBlockCaretContainer(editor, blockCaretContainer);\n        return;\n      }\n      if (hasContent(blockCaretContainer)) {\n        showBlockCaretContainer(editor, blockCaretContainer);\n        editor.undoManager.add();\n      }\n    };\n    var setup$b = function (editor) {\n      editor.on('keyup compositionstart', curry(handleBlockContainer, editor));\n    };\n    var CaretContainerInput = { setup: setup$b };\n\n    var browser$4 = PlatformDetection$1.detect().browser;\n    var setupIeInput = function (editor) {\n      var keypressThrotter = first(function () {\n        if (!editor.composing) {\n          normalizeNbspsInEditor(editor);\n        }\n      }, 0);\n      if (browser$4.isIE()) {\n        editor.on('keypress', function (e) {\n          keypressThrotter.throttle();\n        });\n        editor.on('remove', function (e) {\n          keypressThrotter.cancel();\n        });\n      }\n    };\n    var setup$c = function (editor) {\n      setupIeInput(editor);\n      editor.on('input', function (e) {\n        if (e.isComposing === false) {\n          normalizeNbspsInEditor(editor);\n        }\n      });\n    };\n\n    var executeKeydownOverride$3 = function (editor, evt) {\n      MatchKeys.execute([\n        {\n          keyCode: VK.END,\n          action: moveToLineEndPoint(editor, true)\n        },\n        {\n          keyCode: VK.HOME,\n          action: moveToLineEndPoint(editor, false)\n        }\n      ], evt).each(function (_) {\n        evt.preventDefault();\n      });\n    };\n    var setup$d = function (editor) {\n      editor.on('keydown', function (evt) {\n        if (evt.isDefaultPrevented() === false) {\n          executeKeydownOverride$3(editor, evt);\n        }\n      });\n    };\n    var HomeEndKeys = { setup: setup$d };\n\n    var setup$e = function (editor) {\n      var caret = BoundarySelection.setupSelectedState(editor);\n      CaretContainerInput.setup(editor);\n      ArrowKeys.setup(editor, caret);\n      DeleteBackspaceKeys.setup(editor, caret);\n      EnterKey.setup(editor);\n      SpaceKey.setup(editor);\n      setup$c(editor);\n      HomeEndKeys.setup(editor);\n    };\n    var KeyboardOverrides = { setup: setup$e };\n\n    function Quirks (editor) {\n      var each = Tools.each;\n      var BACKSPACE = VK.BACKSPACE, DELETE = VK.DELETE, dom = editor.dom, selection = editor.selection, settings = editor.settings, parser = editor.parser;\n      var isGecko = Env.gecko, isIE = Env.ie, isWebKit = Env.webkit;\n      var mceInternalUrlPrefix = 'data:text/mce-internal,';\n      var mceInternalDataType = isIE ? 'Text' : 'URL';\n      var setEditorCommandState = function (cmd, state) {\n        try {\n          editor.getDoc().execCommand(cmd, false, state);\n        } catch (ex) {\n        }\n      };\n      var isDefaultPrevented = function (e) {\n        return e.isDefaultPrevented();\n      };\n      var setMceInternalContent = function (e) {\n        var selectionHtml, internalContent;\n        if (e.dataTransfer) {\n          if (editor.selection.isCollapsed() && e.target.tagName === 'IMG') {\n            selection.select(e.target);\n          }\n          selectionHtml = editor.selection.getContent();\n          if (selectionHtml.length > 0) {\n            internalContent = mceInternalUrlPrefix + escape(editor.id) + ',' + escape(selectionHtml);\n            e.dataTransfer.setData(mceInternalDataType, internalContent);\n          }\n        }\n      };\n      var getMceInternalContent = function (e) {\n        var internalContent;\n        if (e.dataTransfer) {\n          internalContent = e.dataTransfer.getData(mceInternalDataType);\n          if (internalContent && internalContent.indexOf(mceInternalUrlPrefix) >= 0) {\n            internalContent = internalContent.substr(mceInternalUrlPrefix.length).split(',');\n            return {\n              id: unescape(internalContent[0]),\n              html: unescape(internalContent[1])\n            };\n          }\n        }\n        return null;\n      };\n      var insertClipboardContents = function (content, internal) {\n        if (editor.queryCommandSupported('mceInsertClipboardContent')) {\n          editor.execCommand('mceInsertClipboardContent', false, {\n            content: content,\n            internal: internal\n          });\n        } else {\n          editor.execCommand('mceInsertContent', false, content);\n        }\n      };\n      var emptyEditorWhenDeleting = function () {\n        var serializeRng = function (rng) {\n          var body = dom.create('body');\n          var contents = rng.cloneContents();\n          body.appendChild(contents);\n          return selection.serializer.serialize(body, { format: 'html' });\n        };\n        var allContentsSelected = function (rng) {\n          var selection = serializeRng(rng);\n          var allRng = dom.createRng();\n          allRng.selectNode(editor.getBody());\n          var allSelection = serializeRng(allRng);\n          return selection === allSelection;\n        };\n        editor.on('keydown', function (e) {\n          var keyCode = e.keyCode;\n          var isCollapsed, body;\n          if (!isDefaultPrevented(e) && (keyCode === DELETE || keyCode === BACKSPACE)) {\n            isCollapsed = editor.selection.isCollapsed();\n            body = editor.getBody();\n            if (isCollapsed && !dom.isEmpty(body)) {\n              return;\n            }\n            if (!isCollapsed && !allContentsSelected(editor.selection.getRng())) {\n              return;\n            }\n            e.preventDefault();\n            editor.setContent('');\n            if (body.firstChild && dom.isBlock(body.firstChild)) {\n              editor.selection.setCursorLocation(body.firstChild, 0);\n            } else {\n              editor.selection.setCursorLocation(body, 0);\n            }\n            editor.nodeChanged();\n          }\n        });\n      };\n      var selectAll = function () {\n        editor.shortcuts.add('meta+a', null, 'SelectAll');\n      };\n      var inputMethodFocus = function () {\n        if (!editor.settings.content_editable) {\n          dom.bind(editor.getDoc(), 'mousedown mouseup', function (e) {\n            var rng;\n            if (e.target === editor.getDoc().documentElement) {\n              rng = selection.getRng();\n              editor.getBody().focus();\n              if (e.type === 'mousedown') {\n                if (isCaretContainer(rng.startContainer)) {\n                  return;\n                }\n                selection.placeCaretAt(e.clientX, e.clientY);\n              } else {\n                selection.setRng(rng);\n              }\n            }\n          });\n        }\n      };\n      var removeHrOnBackspace = function () {\n        editor.on('keydown', function (e) {\n          if (!isDefaultPrevented(e) && e.keyCode === BACKSPACE) {\n            if (!editor.getBody().getElementsByTagName('hr').length) {\n              return;\n            }\n            if (selection.isCollapsed() && selection.getRng().startOffset === 0) {\n              var node = selection.getNode();\n              var previousSibling = node.previousSibling;\n              if (node.nodeName === 'HR') {\n                dom.remove(node);\n                e.preventDefault();\n                return;\n              }\n              if (previousSibling && previousSibling.nodeName && previousSibling.nodeName.toLowerCase() === 'hr') {\n                dom.remove(previousSibling);\n                e.preventDefault();\n              }\n            }\n          }\n        });\n      };\n      var focusBody = function () {\n        if (!domGlobals.Range.prototype.getClientRects) {\n          editor.on('mousedown', function (e) {\n            if (!isDefaultPrevented(e) && e.target.nodeName === 'HTML') {\n              var body_1 = editor.getBody();\n              body_1.blur();\n              Delay.setEditorTimeout(editor, function () {\n                body_1.focus();\n              });\n            }\n          });\n        }\n      };\n      var selectControlElements = function () {\n        editor.on('click', function (e) {\n          var target = e.target;\n          if (/^(IMG|HR)$/.test(target.nodeName) && dom.getContentEditableParent(target) !== 'false') {\n            e.preventDefault();\n            editor.selection.select(target);\n            editor.nodeChanged();\n          }\n          if (target.nodeName === 'A' && dom.hasClass(target, 'mce-item-anchor')) {\n            e.preventDefault();\n            selection.select(target);\n          }\n        });\n      };\n      var removeStylesWhenDeletingAcrossBlockElements = function () {\n        var getAttributeApplyFunction = function () {\n          var template = dom.getAttribs(selection.getStart().cloneNode(false));\n          return function () {\n            var target = selection.getStart();\n            if (target !== editor.getBody()) {\n              dom.setAttrib(target, 'style', null);\n              each(template, function (attr) {\n                target.setAttributeNode(attr.cloneNode(true));\n              });\n            }\n          };\n        };\n        var isSelectionAcrossElements = function () {\n          return !selection.isCollapsed() && dom.getParent(selection.getStart(), dom.isBlock) !== dom.getParent(selection.getEnd(), dom.isBlock);\n        };\n        editor.on('keypress', function (e) {\n          var applyAttributes;\n          if (!isDefaultPrevented(e) && (e.keyCode === 8 || e.keyCode === 46) && isSelectionAcrossElements()) {\n            applyAttributes = getAttributeApplyFunction();\n            editor.getDoc().execCommand('delete', false, null);\n            applyAttributes();\n            e.preventDefault();\n            return false;\n          }\n        });\n        dom.bind(editor.getDoc(), 'cut', function (e) {\n          var applyAttributes;\n          if (!isDefaultPrevented(e) && isSelectionAcrossElements()) {\n            applyAttributes = getAttributeApplyFunction();\n            Delay.setEditorTimeout(editor, function () {\n              applyAttributes();\n            });\n          }\n        });\n      };\n      var disableBackspaceIntoATable = function () {\n        editor.on('keydown', function (e) {\n          if (!isDefaultPrevented(e) && e.keyCode === BACKSPACE) {\n            if (selection.isCollapsed() && selection.getRng().startOffset === 0) {\n              var previousSibling = selection.getNode().previousSibling;\n              if (previousSibling && previousSibling.nodeName && previousSibling.nodeName.toLowerCase() === 'table') {\n                e.preventDefault();\n                return false;\n              }\n            }\n          }\n        });\n      };\n      var removeBlockQuoteOnBackSpace = function () {\n        editor.on('keydown', function (e) {\n          var rng, container, offset, root, parent;\n          if (isDefaultPrevented(e) || e.keyCode !== VK.BACKSPACE) {\n            return;\n          }\n          rng = selection.getRng();\n          container = rng.startContainer;\n          offset = rng.startOffset;\n          root = dom.getRoot();\n          parent = container;\n          if (!rng.collapsed || offset !== 0) {\n            return;\n          }\n          while (parent && parent.parentNode && parent.parentNode.firstChild === parent && parent.parentNode !== root) {\n            parent = parent.parentNode;\n          }\n          if (parent.tagName === 'BLOCKQUOTE') {\n            editor.formatter.toggle('blockquote', null, parent);\n            rng = dom.createRng();\n            rng.setStart(container, 0);\n            rng.setEnd(container, 0);\n            selection.setRng(rng);\n          }\n        });\n      };\n      var setGeckoEditingOptions = function () {\n        var setOpts = function () {\n          setEditorCommandState('StyleWithCSS', false);\n          setEditorCommandState('enableInlineTableEditing', false);\n          if (!settings.object_resizing) {\n            setEditorCommandState('enableObjectResizing', false);\n          }\n        };\n        if (!settings.readonly) {\n          editor.on('BeforeExecCommand MouseDown', setOpts);\n        }\n      };\n      var addBrAfterLastLinks = function () {\n        var fixLinks = function () {\n          each(dom.select('a'), function (node) {\n            var parentNode = node.parentNode;\n            var root = dom.getRoot();\n            if (parentNode.lastChild === node) {\n              while (parentNode && !dom.isBlock(parentNode)) {\n                if (parentNode.parentNode.lastChild !== parentNode || parentNode === root) {\n                  return;\n                }\n                parentNode = parentNode.parentNode;\n              }\n              dom.add(parentNode, 'br', { 'data-mce-bogus': 1 });\n            }\n          });\n        };\n        editor.on('SetContent ExecCommand', function (e) {\n          if (e.type === 'setcontent' || e.command === 'mceInsertLink') {\n            fixLinks();\n          }\n        });\n      };\n      var setDefaultBlockType = function () {\n        if (settings.forced_root_block) {\n          editor.on('init', function () {\n            setEditorCommandState('DefaultParagraphSeparator', settings.forced_root_block);\n          });\n        }\n      };\n      var normalizeSelection = function () {\n        editor.on('keyup focusin mouseup', function (e) {\n          if (!VK.modifierPressed(e)) {\n            selection.normalize();\n          }\n        }, true);\n      };\n      var showBrokenImageIcon = function () {\n        editor.contentStyles.push('img:-moz-broken {' + '-moz-force-broken-image-icon:1;' + 'min-width:24px;' + 'min-height:24px' + '}');\n      };\n      var restoreFocusOnKeyDown = function () {\n        if (!editor.inline) {\n          editor.on('keydown', function () {\n            if (domGlobals.document.activeElement === domGlobals.document.body) {\n              editor.getWin().focus();\n            }\n          });\n        }\n      };\n      var bodyHeight = function () {\n        if (!editor.inline) {\n          editor.contentStyles.push('body {min-height: 150px}');\n          editor.on('click', function (e) {\n            var rng;\n            if (e.target.nodeName === 'HTML') {\n              if (Env.ie > 11) {\n                editor.getBody().focus();\n                return;\n              }\n              rng = editor.selection.getRng();\n              editor.getBody().focus();\n              editor.selection.setRng(rng);\n              editor.selection.normalize();\n              editor.nodeChanged();\n            }\n          });\n        }\n      };\n      var blockCmdArrowNavigation = function () {\n        if (Env.mac) {\n          editor.on('keydown', function (e) {\n            if (VK.metaKeyPressed(e) && !e.shiftKey && (e.keyCode === 37 || e.keyCode === 39)) {\n              e.preventDefault();\n              editor.selection.getSel().modify('move', e.keyCode === 37 ? 'backward' : 'forward', 'lineboundary');\n            }\n          });\n        }\n      };\n      var disableAutoUrlDetect = function () {\n        setEditorCommandState('AutoUrlDetect', false);\n      };\n      var tapLinksAndImages = function () {\n        editor.on('click', function (e) {\n          var elm = e.target;\n          do {\n            if (elm.tagName === 'A') {\n              e.preventDefault();\n              return;\n            }\n          } while (elm = elm.parentNode);\n        });\n        editor.contentStyles.push('.mce-content-body {-webkit-touch-callout: none}');\n      };\n      var blockFormSubmitInsideEditor = function () {\n        editor.on('init', function () {\n          editor.dom.bind(editor.getBody(), 'submit', function (e) {\n            e.preventDefault();\n          });\n        });\n      };\n      var removeAppleInterchangeBrs = function () {\n        parser.addNodeFilter('br', function (nodes) {\n          var i = nodes.length;\n          while (i--) {\n            if (nodes[i].attr('class') === 'Apple-interchange-newline') {\n              nodes[i].remove();\n            }\n          }\n        });\n      };\n      var ieInternalDragAndDrop = function () {\n        editor.on('dragstart', function (e) {\n          setMceInternalContent(e);\n        });\n        editor.on('drop', function (e) {\n          if (!isDefaultPrevented(e)) {\n            var internalContent = getMceInternalContent(e);\n            if (internalContent && internalContent.id !== editor.id) {\n              e.preventDefault();\n              var rng = CaretRangeFromPoint.fromPoint(e.x, e.y, editor.getDoc());\n              selection.setRng(rng);\n              insertClipboardContents(internalContent.html, true);\n            }\n          }\n        });\n      };\n      var refreshContentEditable = function () {\n      };\n      var isHidden = function () {\n        var sel;\n        if (!isGecko || editor.removed) {\n          return 0;\n        }\n        sel = editor.selection.getSel();\n        return !sel || !sel.rangeCount || sel.rangeCount === 0;\n      };\n      removeBlockQuoteOnBackSpace();\n      emptyEditorWhenDeleting();\n      if (!Env.windowsPhone) {\n        normalizeSelection();\n      }\n      if (isWebKit) {\n        inputMethodFocus();\n        selectControlElements();\n        setDefaultBlockType();\n        blockFormSubmitInsideEditor();\n        disableBackspaceIntoATable();\n        removeAppleInterchangeBrs();\n        if (Env.iOS) {\n          restoreFocusOnKeyDown();\n          bodyHeight();\n          tapLinksAndImages();\n        } else {\n          selectAll();\n        }\n      }\n      if (Env.ie >= 11) {\n        bodyHeight();\n        disableBackspaceIntoATable();\n      }\n      if (Env.ie) {\n        selectAll();\n        disableAutoUrlDetect();\n        ieInternalDragAndDrop();\n      }\n      if (isGecko) {\n        removeHrOnBackspace();\n        focusBody();\n        removeStylesWhenDeletingAcrossBlockElements();\n        setGeckoEditingOptions();\n        addBrAfterLastLinks();\n        showBrokenImageIcon();\n        blockCmdArrowNavigation();\n        disableBackspaceIntoATable();\n      }\n      return {\n        refreshContentEditable: refreshContentEditable,\n        isHidden: isHidden\n      };\n    }\n\n    var isTextBlockNode = function (node) {\n      return NodeType.isElement(node) && isTextBlock(Element.fromDom(node));\n    };\n    var normalizeSelection$1 = function (editor) {\n      var rng = editor.selection.getRng();\n      var startPos = CaretPosition.fromRangeStart(rng);\n      var endPos = CaretPosition.fromRangeEnd(rng);\n      if (CaretPosition.isElementPosition(startPos)) {\n        var container = startPos.container();\n        if (isTextBlockNode(container)) {\n          CaretFinder.firstPositionIn(container).each(function (pos) {\n            return rng.setStart(pos.container(), pos.offset());\n          });\n        }\n      }\n      if (CaretPosition.isElementPosition(endPos)) {\n        var container = startPos.container();\n        if (isTextBlockNode(container)) {\n          CaretFinder.lastPositionIn(container).each(function (pos) {\n            return rng.setEnd(pos.container(), pos.offset());\n          });\n        }\n      }\n      editor.selection.setRng(RangeNormalizer.normalize(rng));\n    };\n    var setup$f = function (editor) {\n      editor.on('click', function (e) {\n        if (e.detail >= 3) {\n          normalizeSelection$1(editor);\n        }\n      });\n    };\n\n    var preventSummaryToggle = function (editor) {\n      editor.on('click', function (e) {\n        if (editor.dom.getParent(e.target, 'details')) {\n          e.preventDefault();\n        }\n      });\n    };\n    var filterDetails = function (editor) {\n      editor.parser.addNodeFilter('details', function (elms) {\n        each(elms, function (details) {\n          details.attr('data-mce-open', details.attr('open'));\n          details.attr('open', 'open');\n        });\n      });\n      editor.serializer.addNodeFilter('details', function (elms) {\n        each(elms, function (details) {\n          var open = details.attr('data-mce-open');\n          details.attr('open', isString(open) ? open : null);\n          details.attr('data-mce-open', null);\n        });\n      });\n    };\n    var setup$g = function (editor) {\n      preventSummaryToggle(editor);\n      filterDetails(editor);\n    };\n\n    var DOM$2 = DOMUtils$1.DOM;\n    var appendStyle = function (editor, text) {\n      var head = Element.fromDom(editor.getDoc().head);\n      var tag = Element.fromTag('style');\n      set(tag, 'type', 'text/css');\n      append(tag, Element.fromText(text));\n      append(head, tag);\n    };\n    var createParser = function (editor) {\n      var parser = DomParser(editor.settings, editor.schema);\n      parser.addAttributeFilter('src,href,style,tabindex', function (nodes, name) {\n        var i = nodes.length, node;\n        var dom = editor.dom;\n        var value, internalName;\n        while (i--) {\n          node = nodes[i];\n          value = node.attr(name);\n          internalName = 'data-mce-' + name;\n          if (!node.attributes.map[internalName]) {\n            if (value.indexOf('data:') === 0 || value.indexOf('blob:') === 0) {\n              continue;\n            }\n            if (name === 'style') {\n              value = dom.serializeStyle(dom.parseStyle(value), node.name);\n              if (!value.length) {\n                value = null;\n              }\n              node.attr(internalName, value);\n              node.attr(name, value);\n            } else if (name === 'tabindex') {\n              node.attr(internalName, value);\n              node.attr(name, null);\n            } else {\n              node.attr(internalName, editor.convertURL(value, name, node.name));\n            }\n          }\n        }\n      });\n      parser.addNodeFilter('script', function (nodes) {\n        var i = nodes.length, node, type;\n        while (i--) {\n          node = nodes[i];\n          type = node.attr('type') || 'no/type';\n          if (type.indexOf('mce-') !== 0) {\n            node.attr('type', 'mce-' + type);\n          }\n        }\n      });\n      parser.addNodeFilter('#cdata', function (nodes) {\n        var i = nodes.length, node;\n        while (i--) {\n          node = nodes[i];\n          node.type = 8;\n          node.name = '#comment';\n          node.value = '[CDATA[' + node.value + ']]';\n        }\n      });\n      parser.addNodeFilter('p,h1,h2,h3,h4,h5,h6,div', function (nodes) {\n        var i = nodes.length, node;\n        var nonEmptyElements = editor.schema.getNonEmptyElements();\n        while (i--) {\n          node = nodes[i];\n          if (node.isEmpty(nonEmptyElements) && node.getAll('br').length === 0) {\n            node.append(new Node$1('br', 1)).shortEnded = true;\n          }\n        }\n      });\n      return parser;\n    };\n    var autoFocus = function (editor) {\n      if (editor.settings.auto_focus) {\n        Delay.setEditorTimeout(editor, function () {\n          var focusEditor;\n          if (editor.settings.auto_focus === true) {\n            focusEditor = editor;\n          } else {\n            focusEditor = editor.editorManager.get(editor.settings.auto_focus);\n          }\n          if (!focusEditor.destroyed) {\n            focusEditor.focus();\n          }\n        }, 100);\n      }\n    };\n    var initEditor = function (editor) {\n      editor.bindPendingEventDelegates();\n      editor.initialized = true;\n      editor.fire('init');\n      editor.focus(true);\n      editor.nodeChanged({ initial: true });\n      editor.execCallback('init_instance_callback', editor);\n      autoFocus(editor);\n    };\n    var getStyleSheetLoader = function (editor) {\n      return editor.inline ? DOM$2.styleSheetLoader : editor.dom.styleSheetLoader;\n    };\n    var initContentBody = function (editor, skipWrite) {\n      var settings = editor.settings;\n      var targetElm = editor.getElement();\n      var doc = editor.getDoc(), body, contentCssText;\n      if (!settings.inline) {\n        editor.getElement().style.visibility = editor.orgVisibility;\n      }\n      if (!skipWrite && !settings.content_editable) {\n        doc.open();\n        doc.write(editor.iframeHTML);\n        doc.close();\n      }\n      if (settings.content_editable) {\n        editor.on('remove', function () {\n          var bodyEl = this.getBody();\n          DOM$2.removeClass(bodyEl, 'mce-content-body');\n          DOM$2.removeClass(bodyEl, 'mce-edit-focus');\n          DOM$2.setAttrib(bodyEl, 'contentEditable', null);\n        });\n        DOM$2.addClass(targetElm, 'mce-content-body');\n        editor.contentDocument = doc = settings.content_document || domGlobals.document;\n        editor.contentWindow = settings.content_window || domGlobals.window;\n        editor.bodyElement = targetElm;\n        settings.content_document = settings.content_window = null;\n        settings.root_name = targetElm.nodeName.toLowerCase();\n      }\n      body = editor.getBody();\n      body.disabled = true;\n      editor.readonly = settings.readonly;\n      if (!editor.readonly) {\n        if (editor.inline && DOM$2.getStyle(body, 'position', true) === 'static') {\n          body.style.position = 'relative';\n        }\n        body.contentEditable = editor.getParam('content_editable_state', true);\n      }\n      body.disabled = false;\n      editor.editorUpload = EditorUpload(editor);\n      editor.schema = Schema(settings);\n      editor.dom = DOMUtils$1(doc, {\n        keep_values: true,\n        url_converter: editor.convertURL,\n        url_converter_scope: editor,\n        hex_colors: settings.force_hex_style_colors,\n        class_filter: settings.class_filter,\n        update_styles: true,\n        root_element: editor.inline ? editor.getBody() : null,\n        collect: settings.content_editable,\n        schema: editor.schema,\n        contentCssCors: Settings.shouldUseContentCssCors(editor),\n        onSetAttrib: function (e) {\n          editor.fire('SetAttrib', e);\n        }\n      });\n      editor.parser = createParser(editor);\n      editor.serializer = DomSerializer$1(settings, editor);\n      editor.selection = Selection$1(editor.dom, editor.getWin(), editor.serializer, editor);\n      editor.annotator = Annotator(editor);\n      editor.formatter = Formatter(editor);\n      editor.undoManager = UndoManager(editor);\n      editor._nodeChangeDispatcher = new NodeChange(editor);\n      editor._selectionOverrides = SelectionOverrides(editor);\n      setup$g(editor);\n      setup$f(editor);\n      KeyboardOverrides.setup(editor);\n      ForceBlocks.setup(editor);\n      editor.fire('PreInit');\n      if (!settings.browser_spellcheck && !settings.gecko_spellcheck) {\n        doc.body.spellcheck = false;\n        DOM$2.setAttrib(body, 'spellcheck', 'false');\n      }\n      editor.quirks = Quirks(editor);\n      editor.fire('PostRender');\n      if (settings.directionality) {\n        body.dir = settings.directionality;\n      }\n      if (settings.nowrap) {\n        body.style.whiteSpace = 'nowrap';\n      }\n      if (settings.protect) {\n        editor.on('BeforeSetContent', function (e) {\n          Tools.each(settings.protect, function (pattern) {\n            e.content = e.content.replace(pattern, function (str) {\n              return '<!--mce:protected ' + escape(str) + '-->';\n            });\n          });\n        });\n      }\n      editor.on('SetContent', function () {\n        editor.addVisual(editor.getBody());\n      });\n      editor.load({\n        initial: true,\n        format: 'html'\n      });\n      editor.startContent = editor.getContent({ format: 'raw' });\n      editor.on('compositionstart compositionend', function (e) {\n        editor.composing = e.type === 'compositionstart';\n      });\n      if (editor.contentStyles.length > 0) {\n        contentCssText = '';\n        Tools.each(editor.contentStyles, function (style) {\n          contentCssText += style + '\\r\\n';\n        });\n        editor.dom.addStyle(contentCssText);\n      }\n      getStyleSheetLoader(editor).loadAll(editor.contentCSS, function (_) {\n        initEditor(editor);\n      }, function (urls) {\n        initEditor(editor);\n      });\n      if (settings.content_style) {\n        appendStyle(editor, settings.content_style);\n      }\n    };\n    var InitContentBody = { initContentBody: initContentBody };\n\n    var DOM$3 = DOMUtils$1.DOM;\n    var relaxDomain = function (editor, ifr) {\n      if (domGlobals.document.domain !== domGlobals.window.location.hostname && Env.ie && Env.ie < 12) {\n        var bodyUuid = Uuid.uuid('mce');\n        editor[bodyUuid] = function () {\n          InitContentBody.initContentBody(editor);\n        };\n        var domainRelaxUrl = 'javascript:(function(){' + 'document.open();document.domain=\"' + domGlobals.document.domain + '\";' + 'var ed = window.parent.tinymce.get(\"' + editor.id + '\");document.write(ed.iframeHTML);' + 'document.close();ed.' + bodyUuid + '(true);})()';\n        DOM$3.setAttrib(ifr, 'src', domainRelaxUrl);\n        return true;\n      }\n      return false;\n    };\n    var normalizeHeight = function (height) {\n      var normalizedHeight = typeof height === 'number' ? height + 'px' : height;\n      return normalizedHeight ? normalizedHeight : '';\n    };\n    var createIframeElement = function (id, title, height, customAttrs) {\n      var iframe = Element.fromTag('iframe');\n      setAll(iframe, customAttrs);\n      setAll(iframe, {\n        id: id + '_ifr',\n        frameBorder: '0',\n        allowTransparency: 'true',\n        title: title\n      });\n      setAll$1(iframe, {\n        width: '100%',\n        height: normalizeHeight(height),\n        display: 'block'\n      });\n      return iframe;\n    };\n    var getIframeHtml = function (editor) {\n      var bodyId, bodyClass, iframeHTML;\n      iframeHTML = Settings.getDocType(editor) + '<html><head>';\n      if (Settings.getDocumentBaseUrl(editor) !== editor.documentBaseUrl) {\n        iframeHTML += '<base href=\"' + editor.documentBaseURI.getURI() + '\" />';\n      }\n      iframeHTML += '<meta http-equiv=\"Content-Type\" content=\"text/html; charset=UTF-8\" />';\n      bodyId = Settings.getBodyId(editor);\n      bodyClass = Settings.getBodyClass(editor);\n      if (Settings.getContentSecurityPolicy(editor)) {\n        iframeHTML += '<meta http-equiv=\"Content-Security-Policy\" content=\"' + Settings.getContentSecurityPolicy(editor) + '\" />';\n      }\n      iframeHTML += '</head><body id=\"' + bodyId + '\" class=\"mce-content-body ' + bodyClass + '\" data-id=\"' + editor.id + '\"><br></body></html>';\n      return iframeHTML;\n    };\n    var createIframe = function (editor, o) {\n      var title = editor.editorManager.translate('Rich Text Area. Press ALT-F9 for menu. ' + 'Press ALT-F10 for toolbar. Press ALT-0 for help');\n      var ifr = createIframeElement(editor.id, title, o.height, Settings.getIframeAttrs(editor)).dom();\n      ifr.onload = function () {\n        ifr.onload = null;\n        editor.fire('load');\n      };\n      var isDomainRelaxed = relaxDomain(editor, ifr);\n      editor.contentAreaContainer = o.iframeContainer;\n      editor.iframeElement = ifr;\n      editor.iframeHTML = getIframeHtml(editor);\n      DOM$3.add(o.iframeContainer, ifr);\n      return isDomainRelaxed;\n    };\n    var init$1 = function (editor, boxInfo) {\n      var isDomainRelaxed = createIframe(editor, boxInfo);\n      if (boxInfo.editorContainer) {\n        DOM$3.get(boxInfo.editorContainer).style.display = editor.orgDisplay;\n        editor.hidden = DOM$3.isHidden(boxInfo.editorContainer);\n      }\n      editor.getElement().style.display = 'none';\n      DOM$3.setAttrib(editor.id, 'aria-hidden', 'true');\n      if (!isDomainRelaxed) {\n        InitContentBody.initContentBody(editor);\n      }\n    };\n    var InitIframe = { init: init$1 };\n\n    var DOM$4 = DOMUtils$1.DOM;\n    var initPlugin = function (editor, initializedPlugins, plugin) {\n      var Plugin = PluginManager$1.get(plugin);\n      var pluginUrl = PluginManager$1.urls[plugin] || editor.documentBaseUrl.replace(/\\/$/, '');\n      plugin = Tools.trim(plugin);\n      if (Plugin && Tools.inArray(initializedPlugins, plugin) === -1) {\n        Tools.each(PluginManager$1.dependencies(plugin), function (dep) {\n          initPlugin(editor, initializedPlugins, dep);\n        });\n        if (editor.plugins[plugin]) {\n          return;\n        }\n        try {\n          var pluginInstance = new Plugin(editor, pluginUrl, editor.$);\n          editor.plugins[plugin] = pluginInstance;\n          if (pluginInstance.init) {\n            pluginInstance.init(editor, pluginUrl);\n            initializedPlugins.push(plugin);\n          }\n        } catch (e) {\n          ErrorReporter.pluginInitError(editor, plugin, e);\n        }\n      }\n    };\n    var trimLegacyPrefix = function (name) {\n      return name.replace(/^\\-/, '');\n    };\n    var initPlugins = function (editor) {\n      var initializedPlugins = [];\n      Tools.each(editor.settings.plugins.split(/[ ,]/), function (name) {\n        initPlugin(editor, initializedPlugins, trimLegacyPrefix(name));\n      });\n    };\n    var initTheme = function (editor) {\n      var Theme;\n      var theme = editor.settings.theme;\n      if (isString(theme)) {\n        editor.settings.theme = trimLegacyPrefix(theme);\n        Theme = ThemeManager.get(theme);\n        editor.theme = new Theme(editor, ThemeManager.urls[theme]);\n        if (editor.theme.init) {\n          editor.theme.init(editor, ThemeManager.urls[theme] || editor.documentBaseUrl.replace(/\\/$/, ''), editor.$);\n        }\n      } else {\n        editor.theme = {};\n      }\n    };\n    var renderFromLoadedTheme = function (editor) {\n      var w, h, minHeight, re, info;\n      var settings = editor.settings;\n      var elm = editor.getElement();\n      w = settings.width || DOM$4.getStyle(elm, 'width') || '100%';\n      h = settings.height || DOM$4.getStyle(elm, 'height') || elm.offsetHeight;\n      minHeight = settings.min_height || 100;\n      re = /^[0-9\\.]+(|px)$/i;\n      if (re.test('' + w)) {\n        w = Math.max(parseInt(w, 10), 100);\n      }\n      if (re.test('' + h)) {\n        h = Math.max(parseInt(h, 10), minHeight);\n      }\n      info = editor.theme.renderUI({\n        targetNode: elm,\n        width: w,\n        height: h,\n        deltaWidth: settings.delta_width,\n        deltaHeight: settings.delta_height\n      });\n      if (!settings.content_editable) {\n        h = (info.iframeHeight || h) + (typeof h === 'number' ? info.deltaHeight || 0 : '');\n        if (h < minHeight) {\n          h = minHeight;\n        }\n      }\n      info.height = h;\n      return info;\n    };\n    var renderFromThemeFunc = function (editor) {\n      var info;\n      var elm = editor.getElement();\n      info = editor.settings.theme(editor, elm);\n      if (info.editorContainer.nodeType) {\n        info.editorContainer.id = info.editorContainer.id || editor.id + '_parent';\n      }\n      if (info.iframeContainer && info.iframeContainer.nodeType) {\n        info.iframeContainer.id = info.iframeContainer.id || editor.id + '_iframecontainer';\n      }\n      info.height = info.iframeHeight ? info.iframeHeight : elm.offsetHeight;\n      return info;\n    };\n    var createThemeFalseResult = function (element) {\n      return {\n        editorContainer: element,\n        iframeContainer: element\n      };\n    };\n    var renderThemeFalseIframe = function (targetElement) {\n      var iframeContainer = DOM$4.create('div');\n      DOM$4.insertAfter(iframeContainer, targetElement);\n      return createThemeFalseResult(iframeContainer);\n    };\n    var renderThemeFalse = function (editor) {\n      var targetElement = editor.getElement();\n      return editor.inline ? createThemeFalseResult(null) : renderThemeFalseIframe(targetElement);\n    };\n    var renderThemeUi = function (editor) {\n      var settings = editor.settings, elm = editor.getElement();\n      editor.orgDisplay = elm.style.display;\n      if (isString(settings.theme)) {\n        return renderFromLoadedTheme(editor);\n      } else if (isFunction(settings.theme)) {\n        return renderFromThemeFunc(editor);\n      } else {\n        return renderThemeFalse(editor);\n      }\n    };\n    var init$2 = function (editor) {\n      var settings = editor.settings;\n      var elm = editor.getElement();\n      var boxInfo;\n      editor.rtl = settings.rtl_ui || editor.editorManager.i18n.rtl;\n      editor.editorManager.i18n.setCode(settings.language);\n      settings.aria_label = settings.aria_label || DOM$4.getAttrib(elm, 'aria-label', editor.getLang('aria.rich_text_area'));\n      editor.fire('ScriptsLoaded');\n      initTheme(editor);\n      initPlugins(editor);\n      boxInfo = renderThemeUi(editor);\n      editor.editorContainer = boxInfo.editorContainer ? boxInfo.editorContainer : null;\n      if (settings.content_css) {\n        Tools.each(Tools.explode(settings.content_css), function (u) {\n          editor.contentCSS.push(editor.documentBaseURI.toAbsolute(u));\n        });\n      }\n      if (settings.content_editable) {\n        return InitContentBody.initContentBody(editor);\n      } else {\n        return InitIframe.init(editor, boxInfo);\n      }\n    };\n    var Init = { init: init$2 };\n\n    var DOM$5 = DOMUtils$1.DOM;\n    var hasSkipLoadPrefix = function (name) {\n      return name.charAt(0) === '-';\n    };\n    var loadLanguage = function (scriptLoader, editor) {\n      var settings = editor.settings;\n      if (settings.language && settings.language !== 'en' && !settings.language_url) {\n        settings.language_url = editor.editorManager.baseURL + '/langs/' + settings.language + '.js';\n      }\n      if (settings.language_url && !editor.editorManager.i18n.data[settings.language]) {\n        scriptLoader.add(settings.language_url);\n      }\n    };\n    var loadTheme = function (scriptLoader, editor, suffix, callback) {\n      var settings = editor.settings, theme = settings.theme;\n      if (isString(theme)) {\n        if (!hasSkipLoadPrefix(theme) && !ThemeManager.urls.hasOwnProperty(theme)) {\n          var themeUrl = settings.theme_url;\n          if (themeUrl) {\n            ThemeManager.load(theme, editor.documentBaseURI.toAbsolute(themeUrl));\n          } else {\n            ThemeManager.load(theme, 'themes/' + theme + '/theme' + suffix + '.js');\n          }\n        }\n        scriptLoader.loadQueue(function () {\n          ThemeManager.waitFor(theme, callback);\n        });\n      } else {\n        callback();\n      }\n    };\n    var loadPlugins = function (settings, suffix) {\n      if (Tools.isArray(settings.plugins)) {\n        settings.plugins = settings.plugins.join(' ');\n      }\n      Tools.each(settings.external_plugins, function (url, name) {\n        PluginManager$1.load(name, url);\n        settings.plugins += ' ' + name;\n      });\n      Tools.each(settings.plugins.split(/[ ,]/), function (plugin) {\n        plugin = Tools.trim(plugin);\n        if (plugin && !PluginManager$1.urls[plugin]) {\n          if (hasSkipLoadPrefix(plugin)) {\n            plugin = plugin.substr(1, plugin.length);\n            var dependencies = PluginManager$1.dependencies(plugin);\n            Tools.each(dependencies, function (dep) {\n              var defaultSettings = {\n                prefix: 'plugins/',\n                resource: dep,\n                suffix: '/plugin' + suffix + '.js'\n              };\n              dep = PluginManager$1.createUrl(defaultSettings, dep);\n              PluginManager$1.load(dep.resource, dep);\n            });\n          } else {\n            PluginManager$1.load(plugin, {\n              prefix: 'plugins/',\n              resource: plugin,\n              suffix: '/plugin' + suffix + '.js'\n            });\n          }\n        }\n      });\n    };\n    var loadScripts = function (editor, suffix) {\n      var scriptLoader = ScriptLoader.ScriptLoader;\n      loadTheme(scriptLoader, editor, suffix, function () {\n        loadLanguage(scriptLoader, editor);\n        loadPlugins(editor.settings, suffix);\n        scriptLoader.loadQueue(function () {\n          if (!editor.removed) {\n            Init.init(editor);\n          }\n        }, editor, function (urls) {\n          ErrorReporter.pluginLoadError(editor, urls[0]);\n          if (!editor.removed) {\n            Init.init(editor);\n          }\n        });\n      });\n    };\n    var render = function (editor) {\n      var settings = editor.settings, id = editor.id;\n      var readyHandler = function () {\n        DOM$5.unbind(domGlobals.window, 'ready', readyHandler);\n        editor.render();\n      };\n      if (!EventUtils.Event.domLoaded) {\n        DOM$5.bind(domGlobals.window, 'ready', readyHandler);\n        return;\n      }\n      if (!editor.getElement()) {\n        return;\n      }\n      if (!Env.contentEditable) {\n        return;\n      }\n      if (!settings.inline) {\n        editor.orgVisibility = editor.getElement().style.visibility;\n        editor.getElement().style.visibility = 'hidden';\n      } else {\n        editor.inline = true;\n      }\n      var form = editor.getElement().form || DOM$5.getParent(id, 'form');\n      if (form) {\n        editor.formElement = form;\n        if (settings.hidden_input && !/TEXTAREA|INPUT/i.test(editor.getElement().nodeName)) {\n          DOM$5.insertAfter(DOM$5.create('input', {\n            type: 'hidden',\n            name: id\n          }), id);\n          editor.hasHiddenInput = true;\n        }\n        editor.formEventDelegate = function (e) {\n          editor.fire(e.type, e);\n        };\n        DOM$5.bind(form, 'submit reset', editor.formEventDelegate);\n        editor.on('reset', function () {\n          editor.setContent(editor.startContent, { format: 'raw' });\n        });\n        if (settings.submit_patch && !form.submit.nodeType && !form.submit.length && !form._mceOldSubmit) {\n          form._mceOldSubmit = form.submit;\n          form.submit = function () {\n            editor.editorManager.triggerSave();\n            editor.setDirty(false);\n            return form._mceOldSubmit(form);\n          };\n        }\n      }\n      editor.windowManager = WindowManager(editor);\n      editor.notificationManager = NotificationManager(editor);\n      if (settings.encoding === 'xml') {\n        editor.on('GetContent', function (e) {\n          if (e.save) {\n            e.content = DOM$5.encode(e.content);\n          }\n        });\n      }\n      if (settings.add_form_submit_trigger) {\n        editor.on('submit', function () {\n          if (editor.initialized) {\n            editor.save();\n          }\n        });\n      }\n      if (settings.add_unload_trigger) {\n        editor._beforeUnload = function () {\n          if (editor.initialized && !editor.destroyed && !editor.isHidden()) {\n            editor.save({\n              format: 'raw',\n              no_events: true,\n              set_dirty: false\n            });\n          }\n        };\n        editor.editorManager.on('BeforeUnload', editor._beforeUnload);\n      }\n      editor.editorManager.add(editor);\n      loadScripts(editor, editor.suffix);\n    };\n    var Render = { render: render };\n\n    var add$4 = function (editor, name, settings) {\n      var sidebars = editor.sidebars ? editor.sidebars : [];\n      sidebars.push({\n        name: name,\n        settings: settings\n      });\n      editor.sidebars = sidebars;\n    };\n    var Sidebar = { add: add$4 };\n\n    var each$k = Tools.each, trim$4 = Tools.trim;\n    var queryParts = 'source protocol authority userInfo user password host port relative path directory file query anchor'.split(' ');\n    var DEFAULT_PORTS = {\n      ftp: 21,\n      http: 80,\n      https: 443,\n      mailto: 25\n    };\n    var URI = function (url, settings) {\n      var self = this;\n      var baseUri, baseUrl;\n      url = trim$4(url);\n      settings = self.settings = settings || {};\n      baseUri = settings.base_uri;\n      if (/^([\\w\\-]+):([^\\/]{2})/i.test(url) || /^\\s*#/.test(url)) {\n        self.source = url;\n        return;\n      }\n      var isProtocolRelative = url.indexOf('//') === 0;\n      if (url.indexOf('/') === 0 && !isProtocolRelative) {\n        url = (baseUri ? baseUri.protocol || 'http' : 'http') + '://mce_host' + url;\n      }\n      if (!/^[\\w\\-]*:?\\/\\//.test(url)) {\n        baseUrl = settings.base_uri ? settings.base_uri.path : new URI(domGlobals.document.location.href).directory;\n        if (settings.base_uri.protocol == '') {\n          url = '//mce_host' + self.toAbsPath(baseUrl, url);\n        } else {\n          url = /([^#?]*)([#?]?.*)/.exec(url);\n          url = (baseUri && baseUri.protocol || 'http') + '://mce_host' + self.toAbsPath(baseUrl, url[1]) + url[2];\n        }\n      }\n      url = url.replace(/@@/g, '(mce_at)');\n      url = /^(?:(?![^:@]+:[^:@\\/]*@)([^:\\/?#.]+):)?(?:\\/\\/)?((?:(([^:@\\/]*):?([^:@\\/]*))?@)?([^:\\/?#]*)(?::(\\d*))?)(((\\/(?:[^?#](?![^?#\\/]*\\.[^?#\\/.]+(?:[?#]|$)))*\\/?)?([^?#\\/]*))(?:\\?([^#]*))?(?:#(.*))?)/.exec(url);\n      each$k(queryParts, function (v, i) {\n        var part = url[i];\n        if (part) {\n          part = part.replace(/\\(mce_at\\)/g, '@@');\n        }\n        self[v] = part;\n      });\n      if (baseUri) {\n        if (!self.protocol) {\n          self.protocol = baseUri.protocol;\n        }\n        if (!self.userInfo) {\n          self.userInfo = baseUri.userInfo;\n        }\n        if (!self.port && self.host === 'mce_host') {\n          self.port = baseUri.port;\n        }\n        if (!self.host || self.host === 'mce_host') {\n          self.host = baseUri.host;\n        }\n        self.source = '';\n      }\n      if (isProtocolRelative) {\n        self.protocol = '';\n      }\n    };\n    URI.prototype = {\n      setPath: function (path) {\n        var self = this;\n        path = /^(.*?)\\/?(\\w+)?$/.exec(path);\n        self.path = path[0];\n        self.directory = path[1];\n        self.file = path[2];\n        self.source = '';\n        self.getURI();\n      },\n      toRelative: function (uri) {\n        var self = this;\n        var output;\n        if (uri === './') {\n          return uri;\n        }\n        uri = new URI(uri, { base_uri: self });\n        if (uri.host !== 'mce_host' && self.host !== uri.host && uri.host || self.port !== uri.port || self.protocol !== uri.protocol && uri.protocol !== '') {\n          return uri.getURI();\n        }\n        var tu = self.getURI(), uu = uri.getURI();\n        if (tu === uu || tu.charAt(tu.length - 1) === '/' && tu.substr(0, tu.length - 1) === uu) {\n          return tu;\n        }\n        output = self.toRelPath(self.path, uri.path);\n        if (uri.query) {\n          output += '?' + uri.query;\n        }\n        if (uri.anchor) {\n          output += '#' + uri.anchor;\n        }\n        return output;\n      },\n      toAbsolute: function (uri, noHost) {\n        uri = new URI(uri, { base_uri: this });\n        return uri.getURI(noHost && this.isSameOrigin(uri));\n      },\n      isSameOrigin: function (uri) {\n        if (this.host == uri.host && this.protocol == uri.protocol) {\n          if (this.port == uri.port) {\n            return true;\n          }\n          var defaultPort = DEFAULT_PORTS[this.protocol];\n          if (defaultPort && (this.port || defaultPort) == (uri.port || defaultPort)) {\n            return true;\n          }\n        }\n        return false;\n      },\n      toRelPath: function (base, path) {\n        var items, breakPoint = 0, out = '', i, l;\n        base = base.substring(0, base.lastIndexOf('/'));\n        base = base.split('/');\n        items = path.split('/');\n        if (base.length >= items.length) {\n          for (i = 0, l = base.length; i < l; i++) {\n            if (i >= items.length || base[i] !== items[i]) {\n              breakPoint = i + 1;\n              break;\n            }\n          }\n        }\n        if (base.length < items.length) {\n          for (i = 0, l = items.length; i < l; i++) {\n            if (i >= base.length || base[i] !== items[i]) {\n              breakPoint = i + 1;\n              break;\n            }\n          }\n        }\n        if (breakPoint === 1) {\n          return path;\n        }\n        for (i = 0, l = base.length - (breakPoint - 1); i < l; i++) {\n          out += '../';\n        }\n        for (i = breakPoint - 1, l = items.length; i < l; i++) {\n          if (i !== breakPoint - 1) {\n            out += '/' + items[i];\n          } else {\n            out += items[i];\n          }\n        }\n        return out;\n      },\n      toAbsPath: function (base, path) {\n        var i, nb = 0, o = [], tr, outPath;\n        tr = /\\/$/.test(path) ? '/' : '';\n        base = base.split('/');\n        path = path.split('/');\n        each$k(base, function (k) {\n          if (k) {\n            o.push(k);\n          }\n        });\n        base = o;\n        for (i = path.length - 1, o = []; i >= 0; i--) {\n          if (path[i].length === 0 || path[i] === '.') {\n            continue;\n          }\n          if (path[i] === '..') {\n            nb++;\n            continue;\n          }\n          if (nb > 0) {\n            nb--;\n            continue;\n          }\n          o.push(path[i]);\n        }\n        i = base.length - nb;\n        if (i <= 0) {\n          outPath = o.reverse().join('/');\n        } else {\n          outPath = base.slice(0, i).join('/') + '/' + o.reverse().join('/');\n        }\n        if (outPath.indexOf('/') !== 0) {\n          outPath = '/' + outPath;\n        }\n        if (tr && outPath.lastIndexOf('/') !== outPath.length - 1) {\n          outPath += tr;\n        }\n        return outPath;\n      },\n      getURI: function (noProtoHost) {\n        var s;\n        var self = this;\n        if (!self.source || noProtoHost) {\n          s = '';\n          if (!noProtoHost) {\n            if (self.protocol) {\n              s += self.protocol + '://';\n            } else {\n              s += '//';\n            }\n            if (self.userInfo) {\n              s += self.userInfo + '@';\n            }\n            if (self.host) {\n              s += self.host;\n            }\n            if (self.port) {\n              s += ':' + self.port;\n            }\n          }\n          if (self.path) {\n            s += self.path;\n          }\n          if (self.query) {\n            s += '?' + self.query;\n          }\n          if (self.anchor) {\n            s += '#' + self.anchor;\n          }\n          self.source = s;\n        }\n        return self.source;\n      }\n    };\n    URI.parseDataUri = function (uri) {\n      var type, matches;\n      uri = decodeURIComponent(uri).split(',');\n      matches = /data:([^;]+)/.exec(uri[0]);\n      if (matches) {\n        type = matches[1];\n      }\n      return {\n        type: type,\n        data: uri[1]\n      };\n    };\n    URI.getDocumentBaseUrl = function (loc) {\n      var baseUrl;\n      if (loc.protocol.indexOf('http') !== 0 && loc.protocol !== 'file:') {\n        baseUrl = loc.href;\n      } else {\n        baseUrl = loc.protocol + '//' + loc.host + loc.pathname;\n      }\n      if (/^[^:]+:\\/\\/\\/?[^\\/]+\\//.test(baseUrl)) {\n        baseUrl = baseUrl.replace(/[\\?#].*$/, '').replace(/[\\/\\\\][^\\/]+$/, '');\n        if (!/[\\/\\\\]$/.test(baseUrl)) {\n          baseUrl += '/';\n        }\n      }\n      return baseUrl;\n    };\n\n    var defaultFormat = 'html';\n    var trimEmptyContents = function (editor, html) {\n      var blockName = Settings.getForcedRootBlock(editor);\n      var emptyRegExp = new RegExp('^(<' + blockName + '[^>]*>(&nbsp;|&#160;|\\\\s|\\xA0|<br \\\\/>|)<\\\\/' + blockName + '>[\\r\\n]*|<br \\\\/>[\\r\\n]*)$');\n      return html.replace(emptyRegExp, '');\n    };\n    var getContentFromBody = function (editor, args, body) {\n      var content;\n      args.format = args.format ? args.format : defaultFormat;\n      args.get = true;\n      args.getInner = true;\n      if (!args.no_events) {\n        editor.fire('BeforeGetContent', args);\n      }\n      if (args.format === 'raw') {\n        content = Tools.trim(TrimHtml.trimExternal(editor.serializer, body.innerHTML));\n      } else if (args.format === 'text') {\n        content = Zwsp.trim(body.innerText || body.textContent);\n      } else if (args.format === 'tree') {\n        return editor.serializer.serialize(body, args);\n      } else {\n        content = trimEmptyContents(editor, editor.serializer.serialize(body, args));\n      }\n      if (args.format !== 'text' && !isWsPreserveElement(Element.fromDom(body))) {\n        args.content = Tools.trim(content);\n      } else {\n        args.content = content;\n      }\n      if (!args.no_events) {\n        editor.fire('GetContent', args);\n      }\n      return args.content;\n    };\n    var getContent$1 = function (editor, args) {\n      if (args === void 0) {\n        args = {};\n      }\n      return Option.from(editor.getBody()).fold(constant(args.format === 'tree' ? new Node$1('body', 11) : ''), function (body) {\n        return getContentFromBody(editor, args, body);\n      });\n    };\n\n    var traverse = function (node, fn) {\n      fn(node);\n      if (node.firstChild) {\n        traverse(node.firstChild, fn);\n      }\n      if (node.next) {\n        traverse(node.next, fn);\n      }\n    };\n    var findMatchingNodes = function (nodeFilters, attributeFilters, node) {\n      var nodeMatches = {};\n      var attrMatches = {};\n      var matches = [];\n      if (node.firstChild) {\n        traverse(node.firstChild, function (node) {\n          each(nodeFilters, function (filter) {\n            if (filter.name === node.name) {\n              if (nodeMatches[filter.name]) {\n                nodeMatches[filter.name].nodes.push(node);\n              } else {\n                nodeMatches[filter.name] = {\n                  filter: filter,\n                  nodes: [node]\n                };\n              }\n            }\n          });\n          each(attributeFilters, function (filter) {\n            if (typeof node.attr(filter.name) === 'string') {\n              if (attrMatches[filter.name]) {\n                attrMatches[filter.name].nodes.push(node);\n              } else {\n                attrMatches[filter.name] = {\n                  filter: filter,\n                  nodes: [node]\n                };\n              }\n            }\n          });\n        });\n      }\n      for (var name in nodeMatches) {\n        if (nodeMatches.hasOwnProperty(name)) {\n          matches.push(nodeMatches[name]);\n        }\n      }\n      for (var name in attrMatches) {\n        if (attrMatches.hasOwnProperty(name)) {\n          matches.push(attrMatches[name]);\n        }\n      }\n      return matches;\n    };\n    var filter$3 = function (nodeFilters, attributeFilters, node) {\n      var matches = findMatchingNodes(nodeFilters, attributeFilters, node);\n      each(matches, function (match) {\n        each(match.filter.callbacks, function (callback) {\n          callback(match.nodes, match.filter.name, {});\n        });\n      });\n    };\n\n    var defaultFormat$1 = 'html';\n    var isTreeNode = function (content) {\n      return content instanceof Node$1;\n    };\n    var moveSelection = function (editor) {\n      if (EditorFocus.hasFocus(editor)) {\n        CaretFinder.firstPositionIn(editor.getBody()).each(function (pos) {\n          var node = pos.getNode();\n          var caretPos = NodeType.isTable(node) ? CaretFinder.firstPositionIn(node).getOr(pos) : pos;\n          editor.selection.setRng(caretPos.toRange());\n        });\n      }\n    };\n    var setEditorHtml = function (editor, html) {\n      editor.dom.setHTML(editor.getBody(), html);\n      moveSelection(editor);\n    };\n    var setContentString = function (editor, body, content, args) {\n      var forcedRootBlockName, padd;\n      if (content.length === 0 || /^\\s+$/.test(content)) {\n        padd = '<br data-mce-bogus=\"1\">';\n        if (body.nodeName === 'TABLE') {\n          content = '<tr><td>' + padd + '</td></tr>';\n        } else if (/^(UL|OL)$/.test(body.nodeName)) {\n          content = '<li>' + padd + '</li>';\n        }\n        forcedRootBlockName = Settings.getForcedRootBlock(editor);\n        if (forcedRootBlockName && editor.schema.isValidChild(body.nodeName.toLowerCase(), forcedRootBlockName.toLowerCase())) {\n          content = padd;\n          content = editor.dom.createHTML(forcedRootBlockName, editor.settings.forced_root_block_attrs, content);\n        } else if (!content) {\n          content = '<br data-mce-bogus=\"1\">';\n        }\n        setEditorHtml(editor, content);\n        editor.fire('SetContent', args);\n      } else {\n        if (args.format !== 'raw') {\n          content = HtmlSerializer({ validate: editor.validate }, editor.schema).serialize(editor.parser.parse(content, {\n            isRootContent: true,\n            insert: true\n          }));\n        }\n        args.content = isWsPreserveElement(Element.fromDom(body)) ? content : Tools.trim(content);\n        setEditorHtml(editor, args.content);\n        if (!args.no_events) {\n          editor.fire('SetContent', args);\n        }\n      }\n      return args.content;\n    };\n    var setContentTree = function (editor, body, content, args) {\n      filter$3(editor.parser.getNodeFilters(), editor.parser.getAttributeFilters(), content);\n      var html = HtmlSerializer({ validate: editor.validate }, editor.schema).serialize(content);\n      args.content = isWsPreserveElement(Element.fromDom(body)) ? html : Tools.trim(html);\n      setEditorHtml(editor, args.content);\n      if (!args.no_events) {\n        editor.fire('SetContent', args);\n      }\n      return content;\n    };\n    var setContent$1 = function (editor, content, args) {\n      if (args === void 0) {\n        args = {};\n      }\n      args.format = args.format ? args.format : defaultFormat$1;\n      args.set = true;\n      args.content = isTreeNode(content) ? '' : content;\n      if (!isTreeNode(content) && !args.no_events) {\n        editor.fire('BeforeSetContent', args);\n        content = args.content;\n      }\n      return Option.from(editor.getBody()).fold(constant(content), function (body) {\n        return isTreeNode(content) ? setContentTree(editor, body, content, args) : setContentString(editor, body, content, args);\n      });\n    };\n\n    var DOM$6 = DOMUtils$1.DOM;\n    var restoreOriginalStyles = function (editor) {\n      DOM$6.setStyle(editor.id, 'display', editor.orgDisplay);\n    };\n    var safeDestroy = function (x) {\n      return Option.from(x).each(function (x) {\n        return x.destroy();\n      });\n    };\n    var clearDomReferences = function (editor) {\n      editor.contentAreaContainer = editor.formElement = editor.container = editor.editorContainer = null;\n      editor.bodyElement = editor.contentDocument = editor.contentWindow = null;\n      editor.iframeElement = editor.targetElm = null;\n      if (editor.selection) {\n        editor.selection = editor.selection.win = editor.selection.dom = editor.selection.dom.doc = null;\n      }\n    };\n    var restoreForm = function (editor) {\n      var form = editor.formElement;\n      if (form) {\n        if (form._mceOldSubmit) {\n          form.submit = form._mceOldSubmit;\n          form._mceOldSubmit = null;\n        }\n        DOM$6.unbind(form, 'submit reset', editor.formEventDelegate);\n      }\n    };\n    var remove$7 = function (editor) {\n      if (!editor.removed) {\n        var _selectionOverrides = editor._selectionOverrides, editorUpload = editor.editorUpload;\n        var body = editor.getBody();\n        var element = editor.getElement();\n        if (body) {\n          editor.save({ is_removing: true });\n        }\n        editor.removed = true;\n        editor.unbindAllNativeEvents();\n        if (editor.hasHiddenInput && element) {\n          DOM$6.remove(element.nextSibling);\n        }\n        Events.fireRemove(editor);\n        editor.editorManager.remove(editor);\n        if (!editor.inline && body) {\n          restoreOriginalStyles(editor);\n        }\n        Events.fireDetach(editor);\n        DOM$6.remove(editor.getContainer());\n        safeDestroy(_selectionOverrides);\n        safeDestroy(editorUpload);\n        editor.destroy();\n      }\n    };\n    var destroy = function (editor, automatic) {\n      var selection = editor.selection, dom = editor.dom;\n      if (editor.destroyed) {\n        return;\n      }\n      if (!automatic && !editor.removed) {\n        editor.remove();\n        return;\n      }\n      if (!automatic) {\n        editor.editorManager.off('beforeunload', editor._beforeUnload);\n        if (editor.theme && editor.theme.destroy) {\n          editor.theme.destroy();\n        }\n        safeDestroy(selection);\n        safeDestroy(dom);\n      }\n      restoreForm(editor);\n      clearDomReferences(editor);\n      editor.destroyed = true;\n    };\n\n    var DOM$7 = DOMUtils$1.DOM;\n    var extend$4 = Tools.extend, each$l = Tools.each;\n    var resolve$4 = Tools.resolve;\n    var ie$2 = Env.ie;\n    var Editor = function (id, settings, editorManager) {\n      var self = this;\n      var documentBaseUrl = self.documentBaseUrl = editorManager.documentBaseURL;\n      var baseUri = editorManager.baseURI;\n      settings = getEditorSettings(self, id, documentBaseUrl, editorManager.defaultSettings, settings);\n      self.settings = settings;\n      AddOnManager.language = settings.language || 'en';\n      AddOnManager.languageLoad = settings.language_load;\n      AddOnManager.baseURL = editorManager.baseURL;\n      self.id = id;\n      self.setDirty(false);\n      self.plugins = {};\n      self.documentBaseURI = new URI(settings.document_base_url, { base_uri: baseUri });\n      self.baseURI = baseUri;\n      self.contentCSS = [];\n      self.contentStyles = [];\n      self.shortcuts = new Shortcuts(self);\n      self.loadedCSS = {};\n      self.editorCommands = new EditorCommands(self);\n      self.suffix = editorManager.suffix;\n      self.editorManager = editorManager;\n      self.inline = settings.inline;\n      self.buttons = {};\n      self.menuItems = {};\n      if (settings.cache_suffix) {\n        Env.cacheSuffix = settings.cache_suffix.replace(/^[\\?\\&]+/, '');\n      }\n      if (settings.override_viewport === false) {\n        Env.overrideViewPort = false;\n      }\n      editorManager.fire('SetupEditor', { editor: self });\n      self.execCallback('setup', self);\n      self.$ = DomQuery.overrideDefaults(function () {\n        return {\n          context: self.inline ? self.getBody() : self.getDoc(),\n          element: self.getBody()\n        };\n      });\n    };\n    Editor.prototype = {\n      render: function () {\n        Render.render(this);\n      },\n      focus: function (skipFocus) {\n        EditorFocus.focus(this, skipFocus);\n      },\n      hasFocus: function () {\n        return EditorFocus.hasFocus(this);\n      },\n      execCallback: function (name) {\n        var x = [];\n        for (var _i = 1; _i < arguments.length; _i++) {\n          x[_i - 1] = arguments[_i];\n        }\n        var self = this;\n        var callback = self.settings[name], scope;\n        if (!callback) {\n          return;\n        }\n        if (self.callbackLookup && (scope = self.callbackLookup[name])) {\n          callback = scope.func;\n          scope = scope.scope;\n        }\n        if (typeof callback === 'string') {\n          scope = callback.replace(/\\.\\w+$/, '');\n          scope = scope ? resolve$4(scope) : 0;\n          callback = resolve$4(callback);\n          self.callbackLookup = self.callbackLookup || {};\n          self.callbackLookup[name] = {\n            func: callback,\n            scope: scope\n          };\n        }\n        return callback.apply(scope || self, Array.prototype.slice.call(arguments, 1));\n      },\n      translate: function (text) {\n        if (text && Tools.is(text, 'string')) {\n          var lang_1 = this.settings.language || 'en', i18n_1 = this.editorManager.i18n;\n          text = i18n_1.data[lang_1 + '.' + text] || text.replace(/\\{\\#([^\\}]+)\\}/g, function (a, b) {\n            return i18n_1.data[lang_1 + '.' + b] || '{#' + b + '}';\n          });\n        }\n        return this.editorManager.translate(text);\n      },\n      getLang: function (name, defaultVal) {\n        return this.editorManager.i18n.data[(this.settings.language || 'en') + '.' + name] || (defaultVal !== undefined ? defaultVal : '{#' + name + '}');\n      },\n      getParam: function (name, defaultVal, type) {\n        return getParam(this, name, defaultVal, type);\n      },\n      nodeChanged: function (args) {\n        this._nodeChangeDispatcher.nodeChanged(args);\n      },\n      addButton: function (name, settings) {\n        var self = this;\n        if (settings.cmd) {\n          settings.onclick = function () {\n            self.execCommand(settings.cmd);\n          };\n        }\n        if (settings.stateSelector && typeof settings.active === 'undefined') {\n          settings.active = false;\n        }\n        if (!settings.text && !settings.icon) {\n          settings.icon = name;\n        }\n        settings.tooltip = settings.tooltip || settings.title;\n        self.buttons[name] = settings;\n      },\n      addSidebar: function (name, settings) {\n        return Sidebar.add(this, name, settings);\n      },\n      addMenuItem: function (name, settings) {\n        var self = this;\n        if (settings.cmd) {\n          settings.onclick = function () {\n            self.execCommand(settings.cmd);\n          };\n        }\n        self.menuItems[name] = settings;\n      },\n      addContextToolbar: function (predicate, items) {\n        var self = this;\n        var selector;\n        self.contextToolbars = self.contextToolbars || [];\n        if (typeof predicate === 'string') {\n          selector = predicate;\n          predicate = function (elm) {\n            return self.dom.is(elm, selector);\n          };\n        }\n        self.contextToolbars.push({\n          id: Uuid.uuid('mcet'),\n          predicate: predicate,\n          items: items\n        });\n      },\n      addCommand: function (name, callback, scope) {\n        this.editorCommands.addCommand(name, callback, scope);\n      },\n      addQueryStateHandler: function (name, callback, scope) {\n        this.editorCommands.addQueryStateHandler(name, callback, scope);\n      },\n      addQueryValueHandler: function (name, callback, scope) {\n        this.editorCommands.addQueryValueHandler(name, callback, scope);\n      },\n      addShortcut: function (pattern, desc, cmdFunc, scope) {\n        this.shortcuts.add(pattern, desc, cmdFunc, scope);\n      },\n      execCommand: function (cmd, ui, value, args) {\n        return this.editorCommands.execCommand(cmd, ui, value, args);\n      },\n      queryCommandState: function (cmd) {\n        return this.editorCommands.queryCommandState(cmd);\n      },\n      queryCommandValue: function (cmd) {\n        return this.editorCommands.queryCommandValue(cmd);\n      },\n      queryCommandSupported: function (cmd) {\n        return this.editorCommands.queryCommandSupported(cmd);\n      },\n      show: function () {\n        var self = this;\n        if (self.hidden) {\n          self.hidden = false;\n          if (self.inline) {\n            self.getBody().contentEditable = true;\n          } else {\n            DOM$7.show(self.getContainer());\n            DOM$7.hide(self.id);\n          }\n          self.load();\n          self.fire('show');\n        }\n      },\n      hide: function () {\n        var self = this, doc = self.getDoc();\n        if (!self.hidden) {\n          if (ie$2 && doc && !self.inline) {\n            doc.execCommand('SelectAll');\n          }\n          self.save();\n          if (self.inline) {\n            self.getBody().contentEditable = false;\n            if (self === self.editorManager.focusedEditor) {\n              self.editorManager.focusedEditor = null;\n            }\n          } else {\n            DOM$7.hide(self.getContainer());\n            DOM$7.setStyle(self.id, 'display', self.orgDisplay);\n          }\n          self.hidden = true;\n          self.fire('hide');\n        }\n      },\n      isHidden: function () {\n        return !!this.hidden;\n      },\n      setProgressState: function (state, time) {\n        this.fire('ProgressState', {\n          state: state,\n          time: time\n        });\n      },\n      load: function (args) {\n        var self = this;\n        var elm = self.getElement(), html;\n        if (self.removed) {\n          return '';\n        }\n        if (elm) {\n          args = args || {};\n          args.load = true;\n          html = self.setContent(elm.value !== undefined ? elm.value : elm.innerHTML, args);\n          args.element = elm;\n          if (!args.no_events) {\n            self.fire('LoadContent', args);\n          }\n          args.element = elm = null;\n          return html;\n        }\n      },\n      save: function (args) {\n        var self = this;\n        var elm = self.getElement(), html, form;\n        if (!elm || !self.initialized || self.removed) {\n          return;\n        }\n        args = args || {};\n        args.save = true;\n        args.element = elm;\n        html = args.content = self.getContent(args);\n        if (!args.no_events) {\n          self.fire('SaveContent', args);\n        }\n        if (args.format === 'raw') {\n          self.fire('RawSaveContent', args);\n        }\n        html = args.content;\n        if (!/TEXTAREA|INPUT/i.test(elm.nodeName)) {\n          if (args.is_removing || !self.inline) {\n            elm.innerHTML = html;\n          }\n          if (form = DOM$7.getParent(self.id, 'form')) {\n            each$l(form.elements, function (elm) {\n              if (elm.name === self.id) {\n                elm.value = html;\n                return false;\n              }\n            });\n          }\n        } else {\n          elm.value = html;\n        }\n        args.element = elm = null;\n        if (args.set_dirty !== false) {\n          self.setDirty(false);\n        }\n        return html;\n      },\n      setContent: function (content, args) {\n        return setContent$1(this, content, args);\n      },\n      getContent: function (args) {\n        return getContent$1(this, args);\n      },\n      insertContent: function (content, args) {\n        if (args) {\n          content = extend$4({ content: content }, args);\n        }\n        this.execCommand('mceInsertContent', false, content);\n      },\n      isDirty: function () {\n        return !this.isNotDirty;\n      },\n      setDirty: function (state) {\n        var oldState = !this.isNotDirty;\n        this.isNotDirty = !state;\n        if (state && state !== oldState) {\n          this.fire('dirty');\n        }\n      },\n      setMode: function (mode) {\n        setMode(this, mode);\n      },\n      getContainer: function () {\n        var self = this;\n        if (!self.container) {\n          self.container = DOM$7.get(self.editorContainer || self.id + '_parent');\n        }\n        return self.container;\n      },\n      getContentAreaContainer: function () {\n        return this.contentAreaContainer;\n      },\n      getElement: function () {\n        if (!this.targetElm) {\n          this.targetElm = DOM$7.get(this.id);\n        }\n        return this.targetElm;\n      },\n      getWin: function () {\n        var self = this;\n        var elm;\n        if (!self.contentWindow) {\n          elm = self.iframeElement;\n          if (elm) {\n            self.contentWindow = elm.contentWindow;\n          }\n        }\n        return self.contentWindow;\n      },\n      getDoc: function () {\n        var self = this;\n        var win;\n        if (!self.contentDocument) {\n          win = self.getWin();\n          if (win) {\n            self.contentDocument = win.document;\n          }\n        }\n        return self.contentDocument;\n      },\n      getBody: function () {\n        var doc = this.getDoc();\n        return this.bodyElement || (doc ? doc.body : null);\n      },\n      convertURL: function (url, name, elm) {\n        var self = this, settings = self.settings;\n        if (settings.urlconverter_callback) {\n          return self.execCallback('urlconverter_callback', url, elm, true, name);\n        }\n        if (!settings.convert_urls || elm && elm.nodeName === 'LINK' || url.indexOf('file:') === 0 || url.length === 0) {\n          return url;\n        }\n        if (settings.relative_urls) {\n          return self.documentBaseURI.toRelative(url);\n        }\n        url = self.documentBaseURI.toAbsolute(url, settings.remove_script_host);\n        return url;\n      },\n      addVisual: function (elm) {\n        var self = this;\n        var settings = self.settings;\n        var dom = self.dom;\n        var cls;\n        elm = elm || self.getBody();\n        if (self.hasVisual === undefined) {\n          self.hasVisual = settings.visual;\n        }\n        each$l(dom.select('table,a', elm), function (elm) {\n          var value;\n          switch (elm.nodeName) {\n          case 'TABLE':\n            cls = settings.visual_table_class || 'mce-item-table';\n            value = dom.getAttrib(elm, 'border');\n            if ((!value || value === '0') && self.hasVisual) {\n              dom.addClass(elm, cls);\n            } else {\n              dom.removeClass(elm, cls);\n            }\n            return;\n          case 'A':\n            if (!dom.getAttrib(elm, 'href')) {\n              value = dom.getAttrib(elm, 'name') || elm.id;\n              cls = settings.visual_anchor_class || 'mce-item-anchor';\n              if (value && self.hasVisual) {\n                dom.addClass(elm, cls);\n              } else {\n                dom.removeClass(elm, cls);\n              }\n            }\n            return;\n          }\n        });\n        self.fire('VisualAid', {\n          element: elm,\n          hasVisual: self.hasVisual\n        });\n      },\n      remove: function () {\n        remove$7(this);\n      },\n      destroy: function (automatic) {\n        destroy(this, automatic);\n      },\n      uploadImages: function (callback) {\n        return this.editorUpload.uploadImages(callback);\n      },\n      _scanForImages: function () {\n        return this.editorUpload.scanForImages();\n      }\n    };\n    extend$4(Editor.prototype, EditorObservable$1);\n\n    var isEditorUIElement = function (elm) {\n      return elm.className.toString().indexOf('mce-') !== -1;\n    };\n    var FocusManager = { isEditorUIElement: isEditorUIElement };\n\n    var isManualNodeChange = function (e) {\n      return e.type === 'nodechange' && e.selectionChange;\n    };\n    var registerPageMouseUp = function (editor, throttledStore) {\n      var mouseUpPage = function () {\n        throttledStore.throttle();\n      };\n      DOMUtils$1.DOM.bind(domGlobals.document, 'mouseup', mouseUpPage);\n      editor.on('remove', function () {\n        DOMUtils$1.DOM.unbind(domGlobals.document, 'mouseup', mouseUpPage);\n      });\n    };\n    var registerFocusOut = function (editor) {\n      editor.on('focusout', function () {\n        SelectionBookmark.store(editor);\n      });\n    };\n    var registerMouseUp = function (editor, throttledStore) {\n      editor.on('mouseup touchend', function (e) {\n        throttledStore.throttle();\n      });\n    };\n    var registerEditorEvents = function (editor, throttledStore) {\n      var browser = PlatformDetection$1.detect().browser;\n      if (browser.isIE()) {\n        registerFocusOut(editor);\n      } else {\n        registerMouseUp(editor, throttledStore);\n      }\n      editor.on('keyup nodechange', function (e) {\n        if (!isManualNodeChange(e)) {\n          SelectionBookmark.store(editor);\n        }\n      });\n    };\n    var register$3 = function (editor) {\n      var throttledStore = first(function () {\n        SelectionBookmark.store(editor);\n      }, 0);\n      if (editor.inline) {\n        registerPageMouseUp(editor, throttledStore);\n      }\n      editor.on('init', function () {\n        registerEditorEvents(editor, throttledStore);\n      });\n      editor.on('remove', function () {\n        throttledStore.cancel();\n      });\n    };\n    var SelectionRestore = { register: register$3 };\n\n    var documentFocusInHandler;\n    var DOM$8 = DOMUtils$1.DOM;\n    var isEditorUIElement$1 = function (elm) {\n      return FocusManager.isEditorUIElement(elm);\n    };\n    var isUIElement = function (editor, elm) {\n      var customSelector = editor ? editor.settings.custom_ui_selector : '';\n      var parent = DOM$8.getParent(elm, function (elm) {\n        return isEditorUIElement$1(elm) || (customSelector ? editor.dom.is(elm, customSelector) : false);\n      });\n      return parent !== null;\n    };\n    var getActiveElement = function () {\n      try {\n        return domGlobals.document.activeElement;\n      } catch (ex) {\n        return domGlobals.document.body;\n      }\n    };\n    var registerEvents = function (editorManager, e) {\n      var editor = e.editor;\n      SelectionRestore.register(editor);\n      editor.on('focusin', function () {\n        var self = this;\n        var focusedEditor = editorManager.focusedEditor;\n        if (focusedEditor !== self) {\n          if (focusedEditor) {\n            focusedEditor.fire('blur', { focusedEditor: self });\n          }\n          editorManager.setActive(self);\n          editorManager.focusedEditor = self;\n          self.fire('focus', { blurredEditor: focusedEditor });\n          self.focus(true);\n        }\n      });\n      editor.on('focusout', function () {\n        var self = this;\n        Delay.setEditorTimeout(self, function () {\n          var focusedEditor = editorManager.focusedEditor;\n          if (!isUIElement(self, getActiveElement()) && focusedEditor === self) {\n            self.fire('blur', { focusedEditor: null });\n            editorManager.focusedEditor = null;\n          }\n        });\n      });\n      if (!documentFocusInHandler) {\n        documentFocusInHandler = function (e) {\n          var activeEditor = editorManager.activeEditor;\n          var target;\n          target = e.target;\n          if (activeEditor && target.ownerDocument === domGlobals.document) {\n            if (target !== domGlobals.document.body && !isUIElement(activeEditor, target) && editorManager.focusedEditor === activeEditor) {\n              activeEditor.fire('blur', { focusedEditor: null });\n              editorManager.focusedEditor = null;\n            }\n          }\n        };\n        DOM$8.bind(domGlobals.document, 'focusin', documentFocusInHandler);\n      }\n    };\n    var unregisterDocumentEvents = function (editorManager, e) {\n      if (editorManager.focusedEditor === e.editor) {\n        editorManager.focusedEditor = null;\n      }\n      if (!editorManager.activeEditor) {\n        DOM$8.unbind(domGlobals.document, 'focusin', documentFocusInHandler);\n        documentFocusInHandler = null;\n      }\n    };\n    var setup$h = function (editorManager) {\n      editorManager.on('AddEditor', curry(registerEvents, editorManager));\n      editorManager.on('RemoveEditor', curry(unregisterDocumentEvents, editorManager));\n    };\n    var FocusController = {\n      setup: setup$h,\n      isEditorUIElement: isEditorUIElement$1,\n      isUIElement: isUIElement\n    };\n\n    var DOM$9 = DOMUtils$1.DOM;\n    var explode$4 = Tools.explode, each$m = Tools.each, extend$5 = Tools.extend;\n    var instanceCounter = 0, beforeUnloadDelegate, EditorManager, boundGlobalEvents = false;\n    var legacyEditors = [];\n    var editors = [];\n    var isValidLegacyKey = function (id) {\n      return id !== 'length';\n    };\n    var globalEventDelegate = function (e) {\n      var type = e.type;\n      each$m(EditorManager.get(), function (editor) {\n        switch (type) {\n        case 'scroll':\n          editor.fire('ScrollWindow', e);\n          break;\n        case 'resize':\n          editor.fire('ResizeWindow', e);\n          break;\n        }\n      });\n    };\n    var toggleGlobalEvents = function (state) {\n      if (state !== boundGlobalEvents) {\n        if (state) {\n          DomQuery(window).on('resize scroll', globalEventDelegate);\n        } else {\n          DomQuery(window).off('resize scroll', globalEventDelegate);\n        }\n        boundGlobalEvents = state;\n      }\n    };\n    var removeEditorFromList = function (targetEditor) {\n      var oldEditors = editors;\n      delete legacyEditors[targetEditor.id];\n      for (var i = 0; i < legacyEditors.length; i++) {\n        if (legacyEditors[i] === targetEditor) {\n          legacyEditors.splice(i, 1);\n          break;\n        }\n      }\n      editors = filter(editors, function (editor) {\n        return targetEditor !== editor;\n      });\n      if (EditorManager.activeEditor === targetEditor) {\n        EditorManager.activeEditor = editors.length > 0 ? editors[0] : null;\n      }\n      if (EditorManager.focusedEditor === targetEditor) {\n        EditorManager.focusedEditor = null;\n      }\n      return oldEditors.length !== editors.length;\n    };\n    var purgeDestroyedEditor = function (editor) {\n      if (editor && editor.initialized && !(editor.getContainer() || editor.getBody()).parentNode) {\n        removeEditorFromList(editor);\n        editor.unbindAllNativeEvents();\n        editor.destroy(true);\n        editor.removed = true;\n        editor = null;\n      }\n      return editor;\n    };\n    EditorManager = {\n      defaultSettings: {},\n      $: DomQuery,\n      majorVersion: '4',\n      minorVersion: '9.11',\n      releaseDate: '2020-07-13',\n      editors: legacyEditors,\n      i18n: I18n,\n      activeEditor: null,\n      settings: {},\n      setup: function () {\n        var self = this;\n        var baseURL, documentBaseURL, suffix = '';\n        documentBaseURL = URI.getDocumentBaseUrl(domGlobals.document.location);\n        if (/^[^:]+:\\/\\/\\/?[^\\/]+\\//.test(documentBaseURL)) {\n          documentBaseURL = documentBaseURL.replace(/[\\?#].*$/, '').replace(/[\\/\\\\][^\\/]+$/, '');\n          if (!/[\\/\\\\]$/.test(documentBaseURL)) {\n            documentBaseURL += '/';\n          }\n        }\n        var preInit = window.tinymce || window.tinyMCEPreInit;\n        if (preInit) {\n          baseURL = preInit.base || preInit.baseURL;\n          suffix = preInit.suffix;\n        } else {\n          var scripts = domGlobals.document.getElementsByTagName('script');\n          for (var i = 0; i < scripts.length; i++) {\n            var src = scripts[i].src || '';\n            if (src === '') {\n              continue;\n            }\n            var srcScript = src.substring(src.lastIndexOf('/'));\n            if (/tinymce(\\.full|\\.jquery|)(\\.min|\\.dev|)\\.js/.test(src)) {\n              if (srcScript.indexOf('.min') !== -1) {\n                suffix = '.min';\n              }\n              baseURL = src.substring(0, src.lastIndexOf('/'));\n              break;\n            }\n          }\n          if (!baseURL && domGlobals.document.currentScript) {\n            var src = domGlobals.document.currentScript.src;\n            if (src.indexOf('.min') !== -1) {\n              suffix = '.min';\n            }\n            baseURL = src.substring(0, src.lastIndexOf('/'));\n          }\n        }\n        self.baseURL = new URI(documentBaseURL).toAbsolute(baseURL);\n        self.documentBaseURL = documentBaseURL;\n        self.baseURI = new URI(self.baseURL);\n        self.suffix = suffix;\n        FocusController.setup(self);\n      },\n      overrideDefaults: function (defaultSettings) {\n        var baseUrl, suffix;\n        baseUrl = defaultSettings.base_url;\n        if (baseUrl) {\n          this.baseURL = new URI(this.documentBaseURL).toAbsolute(baseUrl.replace(/\\/+$/, ''));\n          this.baseURI = new URI(this.baseURL);\n        }\n        suffix = defaultSettings.suffix;\n        if (defaultSettings.suffix) {\n          this.suffix = suffix;\n        }\n        this.defaultSettings = defaultSettings;\n        var pluginBaseUrls = defaultSettings.plugin_base_urls;\n        for (var name in pluginBaseUrls) {\n          AddOnManager.PluginManager.urls[name] = pluginBaseUrls[name];\n        }\n      },\n      init: function (settings) {\n        var self = this;\n        var result, invalidInlineTargets;\n        invalidInlineTargets = Tools.makeMap('area base basefont br col frame hr img input isindex link meta param embed source wbr track ' + 'colgroup option tbody tfoot thead tr script noscript style textarea video audio iframe object menu', ' ');\n        var isInvalidInlineTarget = function (settings, elm) {\n          return settings.inline && elm.tagName.toLowerCase() in invalidInlineTargets;\n        };\n        var createId = function (elm) {\n          var id = elm.id;\n          if (!id) {\n            id = elm.name;\n            if (id && !DOM$9.get(id)) {\n              id = elm.name;\n            } else {\n              id = DOM$9.uniqueId();\n            }\n            elm.setAttribute('id', id);\n          }\n          return id;\n        };\n        var execCallback = function (name) {\n          var callback = settings[name];\n          if (!callback) {\n            return;\n          }\n          return callback.apply(self, Array.prototype.slice.call(arguments, 2));\n        };\n        var hasClass = function (elm, className) {\n          return className.constructor === RegExp ? className.test(elm.className) : DOM$9.hasClass(elm, className);\n        };\n        var findTargets = function (settings) {\n          var l, targets = [];\n          if (Env.ie && Env.ie < 11) {\n            ErrorReporter.initError('TinyMCE does not support the browser you are using. For a list of supported' + ' browsers please see: https://www.tinymce.com/docs/get-started/system-requirements/');\n            return [];\n          }\n          if (settings.types) {\n            each$m(settings.types, function (type) {\n              targets = targets.concat(DOM$9.select(type.selector));\n            });\n            return targets;\n          } else if (settings.selector) {\n            return DOM$9.select(settings.selector);\n          } else if (settings.target) {\n            return [settings.target];\n          }\n          switch (settings.mode) {\n          case 'exact':\n            l = settings.elements || '';\n            if (l.length > 0) {\n              each$m(explode$4(l), function (id) {\n                var elm;\n                if (elm = DOM$9.get(id)) {\n                  targets.push(elm);\n                } else {\n                  each$m(domGlobals.document.forms, function (f) {\n                    each$m(f.elements, function (e) {\n                      if (e.name === id) {\n                        id = 'mce_editor_' + instanceCounter++;\n                        DOM$9.setAttrib(e, 'id', id);\n                        targets.push(e);\n                      }\n                    });\n                  });\n                }\n              });\n            }\n            break;\n          case 'textareas':\n          case 'specific_textareas':\n            each$m(DOM$9.select('textarea'), function (elm) {\n              if (settings.editor_deselector && hasClass(elm, settings.editor_deselector)) {\n                return;\n              }\n              if (!settings.editor_selector || hasClass(elm, settings.editor_selector)) {\n                targets.push(elm);\n              }\n            });\n            break;\n          }\n          return targets;\n        };\n        var provideResults = function (editors) {\n          result = editors;\n        };\n        var initEditors = function () {\n          var initCount = 0;\n          var editors = [];\n          var targets;\n          var createEditor = function (id, settings, targetElm) {\n            var editor = new Editor(id, settings, self);\n            editors.push(editor);\n            editor.on('init', function () {\n              if (++initCount === targets.length) {\n                provideResults(editors);\n              }\n            });\n            editor.targetElm = editor.targetElm || targetElm;\n            editor.render();\n          };\n          DOM$9.unbind(window, 'ready', initEditors);\n          execCallback('onpageload');\n          targets = DomQuery.unique(findTargets(settings));\n          if (settings.types) {\n            each$m(settings.types, function (type) {\n              Tools.each(targets, function (elm) {\n                if (DOM$9.is(elm, type.selector)) {\n                  createEditor(createId(elm), extend$5({}, settings, type), elm);\n                  return false;\n                }\n                return true;\n              });\n            });\n            return;\n          }\n          Tools.each(targets, function (elm) {\n            purgeDestroyedEditor(self.get(elm.id));\n          });\n          targets = Tools.grep(targets, function (elm) {\n            return !self.get(elm.id);\n          });\n          if (targets.length === 0) {\n            provideResults([]);\n          } else {\n            each$m(targets, function (elm) {\n              if (isInvalidInlineTarget(settings, elm)) {\n                ErrorReporter.initError('Could not initialize inline editor on invalid inline target element', elm);\n              } else {\n                createEditor(createId(elm), settings, elm);\n              }\n            });\n          }\n        };\n        self.settings = settings;\n        DOM$9.bind(window, 'ready', initEditors);\n        return new promiseObj(function (resolve) {\n          if (result) {\n            resolve(result);\n          } else {\n            provideResults = function (editors) {\n              resolve(editors);\n            };\n          }\n        });\n      },\n      get: function (id) {\n        if (arguments.length === 0) {\n          return editors.slice(0);\n        } else if (isString(id)) {\n          return find(editors, function (editor) {\n            return editor.id === id;\n          }).getOr(null);\n        } else if (isNumber(id)) {\n          return editors[id] ? editors[id] : null;\n        } else {\n          return null;\n        }\n      },\n      add: function (editor) {\n        var self = this;\n        var existingEditor;\n        existingEditor = legacyEditors[editor.id];\n        if (existingEditor === editor) {\n          return editor;\n        }\n        if (self.get(editor.id) === null) {\n          if (isValidLegacyKey(editor.id)) {\n            legacyEditors[editor.id] = editor;\n          }\n          legacyEditors.push(editor);\n          editors.push(editor);\n        }\n        toggleGlobalEvents(true);\n        self.activeEditor = editor;\n        self.fire('AddEditor', { editor: editor });\n        if (!beforeUnloadDelegate) {\n          beforeUnloadDelegate = function () {\n            self.fire('BeforeUnload');\n          };\n          DOM$9.bind(window, 'beforeunload', beforeUnloadDelegate);\n        }\n        return editor;\n      },\n      createEditor: function (id, settings) {\n        return this.add(new Editor(id, settings, this));\n      },\n      remove: function (selector) {\n        var self = this;\n        var i, editor;\n        if (!selector) {\n          for (i = editors.length - 1; i >= 0; i--) {\n            self.remove(editors[i]);\n          }\n          return;\n        }\n        if (isString(selector)) {\n          each$m(DOM$9.select(selector), function (elm) {\n            editor = self.get(elm.id);\n            if (editor) {\n              self.remove(editor);\n            }\n          });\n          return;\n        }\n        editor = selector;\n        if (isNull(self.get(editor.id))) {\n          return null;\n        }\n        if (removeEditorFromList(editor)) {\n          self.fire('RemoveEditor', { editor: editor });\n        }\n        if (editors.length === 0) {\n          DOM$9.unbind(window, 'beforeunload', beforeUnloadDelegate);\n        }\n        editor.remove();\n        toggleGlobalEvents(editors.length > 0);\n        return editor;\n      },\n      execCommand: function (cmd, ui, value) {\n        var self = this, editor = self.get(value);\n        switch (cmd) {\n        case 'mceAddEditor':\n          if (!self.get(value)) {\n            new Editor(value, self.settings, self).render();\n          }\n          return true;\n        case 'mceRemoveEditor':\n          if (editor) {\n            editor.remove();\n          }\n          return true;\n        case 'mceToggleEditor':\n          if (!editor) {\n            self.execCommand('mceAddEditor', 0, value);\n            return true;\n          }\n          if (editor.isHidden()) {\n            editor.show();\n          } else {\n            editor.hide();\n          }\n          return true;\n        }\n        if (self.activeEditor) {\n          return self.activeEditor.execCommand(cmd, ui, value);\n        }\n        return false;\n      },\n      triggerSave: function () {\n        each$m(editors, function (editor) {\n          editor.save();\n        });\n      },\n      addI18n: function (code, items) {\n        I18n.add(code, items);\n      },\n      translate: function (text) {\n        return I18n.translate(text);\n      },\n      setActive: function (editor) {\n        var activeEditor = this.activeEditor;\n        if (this.activeEditor !== editor) {\n          if (activeEditor) {\n            activeEditor.fire('deactivate', { relatedTarget: editor });\n          }\n          editor.fire('activate', { relatedTarget: activeEditor });\n        }\n        this.activeEditor = editor;\n      }\n    };\n    extend$5(EditorManager, Observable);\n    EditorManager.setup();\n    var EditorManager$1 = EditorManager;\n\n    function RangeUtils(dom) {\n      var walk = function (rng, callback) {\n        return RangeWalk.walk(dom, rng, callback);\n      };\n      var split = SplitRange.split;\n      var normalize = function (rng) {\n        return NormalizeRange.normalize(dom, rng).fold(constant(false), function (normalizedRng) {\n          rng.setStart(normalizedRng.startContainer, normalizedRng.startOffset);\n          rng.setEnd(normalizedRng.endContainer, normalizedRng.endOffset);\n          return true;\n        });\n      };\n      return {\n        walk: walk,\n        split: split,\n        normalize: normalize\n      };\n    }\n    (function (RangeUtils) {\n      RangeUtils.compareRanges = RangeCompare.isEq;\n      RangeUtils.getCaretRangeFromPoint = CaretRangeFromPoint.fromPoint;\n      RangeUtils.getSelectedNode = getSelectedNode;\n      RangeUtils.getNode = getNode;\n    }(RangeUtils || (RangeUtils = {})));\n    var RangeUtils$1 = RangeUtils;\n\n    var min = Math.min, max = Math.max, round$2 = Math.round;\n    var relativePosition = function (rect, targetRect, rel) {\n      var x, y, w, h, targetW, targetH;\n      x = targetRect.x;\n      y = targetRect.y;\n      w = rect.w;\n      h = rect.h;\n      targetW = targetRect.w;\n      targetH = targetRect.h;\n      rel = (rel || '').split('');\n      if (rel[0] === 'b') {\n        y += targetH;\n      }\n      if (rel[1] === 'r') {\n        x += targetW;\n      }\n      if (rel[0] === 'c') {\n        y += round$2(targetH / 2);\n      }\n      if (rel[1] === 'c') {\n        x += round$2(targetW / 2);\n      }\n      if (rel[3] === 'b') {\n        y -= h;\n      }\n      if (rel[4] === 'r') {\n        x -= w;\n      }\n      if (rel[3] === 'c') {\n        y -= round$2(h / 2);\n      }\n      if (rel[4] === 'c') {\n        x -= round$2(w / 2);\n      }\n      return create$4(x, y, w, h);\n    };\n    var findBestRelativePosition = function (rect, targetRect, constrainRect, rels) {\n      var pos, i;\n      for (i = 0; i < rels.length; i++) {\n        pos = relativePosition(rect, targetRect, rels[i]);\n        if (pos.x >= constrainRect.x && pos.x + pos.w <= constrainRect.w + constrainRect.x && pos.y >= constrainRect.y && pos.y + pos.h <= constrainRect.h + constrainRect.y) {\n          return rels[i];\n        }\n      }\n      return null;\n    };\n    var inflate = function (rect, w, h) {\n      return create$4(rect.x - w, rect.y - h, rect.w + w * 2, rect.h + h * 2);\n    };\n    var intersect = function (rect, cropRect) {\n      var x1, y1, x2, y2;\n      x1 = max(rect.x, cropRect.x);\n      y1 = max(rect.y, cropRect.y);\n      x2 = min(rect.x + rect.w, cropRect.x + cropRect.w);\n      y2 = min(rect.y + rect.h, cropRect.y + cropRect.h);\n      if (x2 - x1 < 0 || y2 - y1 < 0) {\n        return null;\n      }\n      return create$4(x1, y1, x2 - x1, y2 - y1);\n    };\n    var clamp$1 = function (rect, clampRect, fixedSize) {\n      var underflowX1, underflowY1, overflowX2, overflowY2, x1, y1, x2, y2, cx2, cy2;\n      x1 = rect.x;\n      y1 = rect.y;\n      x2 = rect.x + rect.w;\n      y2 = rect.y + rect.h;\n      cx2 = clampRect.x + clampRect.w;\n      cy2 = clampRect.y + clampRect.h;\n      underflowX1 = max(0, clampRect.x - x1);\n      underflowY1 = max(0, clampRect.y - y1);\n      overflowX2 = max(0, x2 - cx2);\n      overflowY2 = max(0, y2 - cy2);\n      x1 += underflowX1;\n      y1 += underflowY1;\n      if (fixedSize) {\n        x2 += underflowX1;\n        y2 += underflowY1;\n        x1 -= overflowX2;\n        y1 -= overflowY2;\n      }\n      x2 -= overflowX2;\n      y2 -= overflowY2;\n      return create$4(x1, y1, x2 - x1, y2 - y1);\n    };\n    var create$4 = function (x, y, w, h) {\n      return {\n        x: x,\n        y: y,\n        w: w,\n        h: h\n      };\n    };\n    var fromClientRect = function (clientRect) {\n      return create$4(clientRect.left, clientRect.top, clientRect.width, clientRect.height);\n    };\n    var Rect = {\n      inflate: inflate,\n      relativePosition: relativePosition,\n      findBestRelativePosition: findBestRelativePosition,\n      intersect: intersect,\n      clamp: clamp$1,\n      create: create$4,\n      fromClientRect: fromClientRect\n    };\n\n    var types = {};\n    var Factory = {\n      add: function (type, typeClass) {\n        types[type.toLowerCase()] = typeClass;\n      },\n      has: function (type) {\n        return !!types[type.toLowerCase()];\n      },\n      get: function (type) {\n        var lctype = type.toLowerCase();\n        var controlType = types.hasOwnProperty(lctype) ? types[lctype] : null;\n        if (controlType === null) {\n          throw new Error('Could not find module for type: ' + type);\n        }\n        return controlType;\n      },\n      create: function (type, settings) {\n        var ControlType;\n        if (typeof type === 'string') {\n          settings = settings || {};\n          settings.type = type;\n        } else {\n          settings = type;\n          type = settings.type;\n        }\n        type = type.toLowerCase();\n        ControlType = types[type];\n        if (!ControlType) {\n          throw new Error('Could not find control by type: ' + type);\n        }\n        ControlType = new ControlType(settings);\n        ControlType.type = type;\n        return ControlType;\n      }\n    };\n\n    var each$n = Tools.each, extend$6 = Tools.extend;\n    var extendClass, initializing;\n    var Class = function () {\n    };\n    Class.extend = extendClass = function (prop) {\n      var self = this;\n      var _super = self.prototype;\n      var prototype, name, member;\n      var Class = function () {\n        var i, mixins, mixin;\n        var self = this;\n        if (!initializing) {\n          if (self.init) {\n            self.init.apply(self, arguments);\n          }\n          mixins = self.Mixins;\n          if (mixins) {\n            i = mixins.length;\n            while (i--) {\n              mixin = mixins[i];\n              if (mixin.init) {\n                mixin.init.apply(self, arguments);\n              }\n            }\n          }\n        }\n      };\n      var dummy = function () {\n        return this;\n      };\n      var createMethod = function (name, fn) {\n        return function () {\n          var self = this;\n          var tmp = self._super;\n          var ret;\n          self._super = _super[name];\n          ret = fn.apply(self, arguments);\n          self._super = tmp;\n          return ret;\n        };\n      };\n      initializing = true;\n      prototype = new self();\n      initializing = false;\n      if (prop.Mixins) {\n        each$n(prop.Mixins, function (mixin) {\n          for (var name_1 in mixin) {\n            if (name_1 !== 'init') {\n              prop[name_1] = mixin[name_1];\n            }\n          }\n        });\n        if (_super.Mixins) {\n          prop.Mixins = _super.Mixins.concat(prop.Mixins);\n        }\n      }\n      if (prop.Methods) {\n        each$n(prop.Methods.split(','), function (name) {\n          prop[name] = dummy;\n        });\n      }\n      if (prop.Properties) {\n        each$n(prop.Properties.split(','), function (name) {\n          var fieldName = '_' + name;\n          prop[name] = function (value) {\n            var self = this;\n            if (value !== undefined) {\n              self[fieldName] = value;\n              return self;\n            }\n            return self[fieldName];\n          };\n        });\n      }\n      if (prop.Statics) {\n        each$n(prop.Statics, function (func, name) {\n          Class[name] = func;\n        });\n      }\n      if (prop.Defaults && _super.Defaults) {\n        prop.Defaults = extend$6({}, _super.Defaults, prop.Defaults);\n      }\n      for (name in prop) {\n        member = prop[name];\n        if (typeof member === 'function' && _super[name]) {\n          prototype[name] = createMethod(name, member);\n        } else {\n          prototype[name] = member;\n        }\n      }\n      Class.prototype = prototype;\n      Class.constructor = Class;\n      Class.extend = extendClass;\n      return Class;\n    };\n\n    var min$1 = Math.min, max$1 = Math.max, round$3 = Math.round;\n    var Color = function (value) {\n      var self = {};\n      var r = 0, g = 0, b = 0;\n      var rgb2hsv = function (r, g, b) {\n        var h, s, v, d, minRGB, maxRGB;\n        h = 0;\n        s = 0;\n        v = 0;\n        r = r / 255;\n        g = g / 255;\n        b = b / 255;\n        minRGB = min$1(r, min$1(g, b));\n        maxRGB = max$1(r, max$1(g, b));\n        if (minRGB === maxRGB) {\n          v = minRGB;\n          return {\n            h: 0,\n            s: 0,\n            v: v * 100\n          };\n        }\n        d = r === minRGB ? g - b : b === minRGB ? r - g : b - r;\n        h = r === minRGB ? 3 : b === minRGB ? 1 : 5;\n        h = 60 * (h - d / (maxRGB - minRGB));\n        s = (maxRGB - minRGB) / maxRGB;\n        v = maxRGB;\n        return {\n          h: round$3(h),\n          s: round$3(s * 100),\n          v: round$3(v * 100)\n        };\n      };\n      var hsvToRgb = function (hue, saturation, brightness) {\n        var side, chroma, x, match;\n        hue = (parseInt(hue, 10) || 0) % 360;\n        saturation = parseInt(saturation, 10) / 100;\n        brightness = parseInt(brightness, 10) / 100;\n        saturation = max$1(0, min$1(saturation, 1));\n        brightness = max$1(0, min$1(brightness, 1));\n        if (saturation === 0) {\n          r = g = b = round$3(255 * brightness);\n          return;\n        }\n        side = hue / 60;\n        chroma = brightness * saturation;\n        x = chroma * (1 - Math.abs(side % 2 - 1));\n        match = brightness - chroma;\n        switch (Math.floor(side)) {\n        case 0:\n          r = chroma;\n          g = x;\n          b = 0;\n          break;\n        case 1:\n          r = x;\n          g = chroma;\n          b = 0;\n          break;\n        case 2:\n          r = 0;\n          g = chroma;\n          b = x;\n          break;\n        case 3:\n          r = 0;\n          g = x;\n          b = chroma;\n          break;\n        case 4:\n          r = x;\n          g = 0;\n          b = chroma;\n          break;\n        case 5:\n          r = chroma;\n          g = 0;\n          b = x;\n          break;\n        default:\n          r = g = b = 0;\n        }\n        r = round$3(255 * (r + match));\n        g = round$3(255 * (g + match));\n        b = round$3(255 * (b + match));\n      };\n      var toHex = function () {\n        var hex = function (val) {\n          val = parseInt(val, 10).toString(16);\n          return val.length > 1 ? val : '0' + val;\n        };\n        return '#' + hex(r) + hex(g) + hex(b);\n      };\n      var toRgb = function () {\n        return {\n          r: r,\n          g: g,\n          b: b\n        };\n      };\n      var toHsv = function () {\n        return rgb2hsv(r, g, b);\n      };\n      var parse = function (value) {\n        var matches;\n        if (typeof value === 'object') {\n          if ('r' in value) {\n            r = value.r;\n            g = value.g;\n            b = value.b;\n          } else if ('v' in value) {\n            hsvToRgb(value.h, value.s, value.v);\n          }\n        } else {\n          if (matches = /rgb\\s*\\(\\s*([0-9]+)\\s*,\\s*([0-9]+)\\s*,\\s*([0-9]+)[^\\)]*\\)/gi.exec(value)) {\n            r = parseInt(matches[1], 10);\n            g = parseInt(matches[2], 10);\n            b = parseInt(matches[3], 10);\n          } else if (matches = /#([0-F]{2})([0-F]{2})([0-F]{2})/gi.exec(value)) {\n            r = parseInt(matches[1], 16);\n            g = parseInt(matches[2], 16);\n            b = parseInt(matches[3], 16);\n          } else if (matches = /#([0-F])([0-F])([0-F])/gi.exec(value)) {\n            r = parseInt(matches[1] + matches[1], 16);\n            g = parseInt(matches[2] + matches[2], 16);\n            b = parseInt(matches[3] + matches[3], 16);\n          }\n        }\n        r = r < 0 ? 0 : r > 255 ? 255 : r;\n        g = g < 0 ? 0 : g > 255 ? 255 : g;\n        b = b < 0 ? 0 : b > 255 ? 255 : b;\n        return self;\n      };\n      if (value) {\n        parse(value);\n      }\n      self.toRgb = toRgb;\n      self.toHsv = toHsv;\n      self.toHex = toHex;\n      self.parse = parse;\n      return self;\n    };\n\n    var serialize = function (o, quote) {\n      var i, v, t, name;\n      quote = quote || '\"';\n      if (o === null) {\n        return 'null';\n      }\n      t = typeof o;\n      if (t === 'string') {\n        v = '\\bb\\tt\\nn\\ff\\rr\"\"\\'\\'\\\\\\\\';\n        return quote + o.replace(/([\\u0080-\\uFFFF\\x00-\\x1f\\\"\\'\\\\])/g, function (a, b) {\n          if (quote === '\"' && a === '\\'') {\n            return a;\n          }\n          i = v.indexOf(b);\n          if (i + 1) {\n            return '\\\\' + v.charAt(i + 1);\n          }\n          a = b.charCodeAt().toString(16);\n          return '\\\\u' + '0000'.substring(a.length) + a;\n        }) + quote;\n      }\n      if (t === 'object') {\n        if (o.hasOwnProperty && Object.prototype.toString.call(o) === '[object Array]') {\n          for (i = 0, v = '['; i < o.length; i++) {\n            v += (i > 0 ? ',' : '') + serialize(o[i], quote);\n          }\n          return v + ']';\n        }\n        v = '{';\n        for (name in o) {\n          if (o.hasOwnProperty(name)) {\n            v += typeof o[name] !== 'function' ? (v.length > 1 ? ',' + quote : quote) + name + quote + ':' + serialize(o[name], quote) : '';\n          }\n        }\n        return v + '}';\n      }\n      return '' + o;\n    };\n    var JSON$1 = {\n      serialize: serialize,\n      parse: function (text) {\n        try {\n          return JSON.parse(text);\n        } catch (ex) {\n        }\n      }\n    };\n\n    var JSONP = {\n      callbacks: {},\n      count: 0,\n      send: function (settings) {\n        var self = this, dom = DOMUtils$1.DOM, count = settings.count !== undefined ? settings.count : self.count;\n        var id = 'tinymce_jsonp_' + count;\n        self.callbacks[count] = function (json) {\n          dom.remove(id);\n          delete self.callbacks[count];\n          settings.callback(json);\n        };\n        dom.add(dom.doc.body, 'script', {\n          id: id,\n          src: settings.url,\n          type: 'text/javascript'\n        });\n        self.count++;\n      }\n    };\n\n    var XHR = {\n      send: function (settings) {\n        var xhr, count = 0;\n        var ready = function () {\n          if (!settings.async || xhr.readyState === 4 || count++ > 10000) {\n            if (settings.success && count < 10000 && xhr.status === 200) {\n              settings.success.call(settings.success_scope, '' + xhr.responseText, xhr, settings);\n            } else if (settings.error) {\n              settings.error.call(settings.error_scope, count > 10000 ? 'TIMED_OUT' : 'GENERAL', xhr, settings);\n            }\n            xhr = null;\n          } else {\n            setTimeout(ready, 10);\n          }\n        };\n        settings.scope = settings.scope || this;\n        settings.success_scope = settings.success_scope || settings.scope;\n        settings.error_scope = settings.error_scope || settings.scope;\n        settings.async = settings.async === false ? false : true;\n        settings.data = settings.data || '';\n        XHR.fire('beforeInitialize', { settings: settings });\n        xhr = XMLHttpRequest();\n        if (xhr) {\n          if (xhr.overrideMimeType) {\n            xhr.overrideMimeType(settings.content_type);\n          }\n          xhr.open(settings.type || (settings.data ? 'POST' : 'GET'), settings.url, settings.async);\n          if (settings.crossDomain) {\n            xhr.withCredentials = true;\n          }\n          if (settings.content_type) {\n            xhr.setRequestHeader('Content-Type', settings.content_type);\n          }\n          if (settings.requestheaders) {\n            Tools.each(settings.requestheaders, function (header) {\n              xhr.setRequestHeader(header.key, header.value);\n            });\n          }\n          xhr.setRequestHeader('X-Requested-With', 'XMLHttpRequest');\n          xhr = XHR.fire('beforeSend', {\n            xhr: xhr,\n            settings: settings\n          }).xhr;\n          xhr.send(settings.data);\n          if (!settings.async) {\n            return ready();\n          }\n          setTimeout(ready, 10);\n        }\n      }\n    };\n    Tools.extend(XHR, Observable);\n\n    var extend$7 = Tools.extend;\n    var JSONRequest = function (settings) {\n      this.settings = extend$7({}, settings);\n      this.count = 0;\n    };\n    JSONRequest.sendRPC = function (o) {\n      return new JSONRequest().send(o);\n    };\n    JSONRequest.prototype = {\n      send: function (args) {\n        var ecb = args.error, scb = args.success;\n        args = extend$7(this.settings, args);\n        args.success = function (c, x) {\n          c = JSON$1.parse(c);\n          if (typeof c === 'undefined') {\n            c = { error: 'JSON Parse error.' };\n          }\n          if (c.error) {\n            ecb.call(args.error_scope || args.scope, c.error, x);\n          } else {\n            scb.call(args.success_scope || args.scope, c.result);\n          }\n        };\n        args.error = function (ty, x) {\n          if (ecb) {\n            ecb.call(args.error_scope || args.scope, ty, x);\n          }\n        };\n        args.data = JSON$1.serialize({\n          id: args.id || 'c' + this.count++,\n          method: args.method,\n          params: args.params\n        });\n        args.content_type = 'application/json';\n        XHR.send(args);\n      }\n    };\n\n    var create$5 = function () {\n      return function () {\n        var data = {};\n        var keys = [];\n        var storage = {\n          getItem: function (key) {\n            var item = data[key];\n            return item ? item : null;\n          },\n          setItem: function (key, value) {\n            keys.push(key);\n            data[key] = String(value);\n          },\n          key: function (index) {\n            return keys[index];\n          },\n          removeItem: function (key) {\n            keys = keys.filter(function (k) {\n              return k === key;\n            });\n            delete data[key];\n          },\n          clear: function () {\n            keys = [];\n            data = {};\n          },\n          length: 0\n        };\n        Object.defineProperty(storage, 'length', {\n          get: function () {\n            return keys.length;\n          },\n          configurable: false,\n          enumerable: false\n        });\n        return storage;\n      }();\n    };\n\n    var localStorage;\n    try {\n      localStorage = domGlobals.window.localStorage;\n    } catch (e) {\n      localStorage = create$5();\n    }\n    var LocalStorage = localStorage;\n\n    var tinymce = EditorManager$1;\n    var publicApi = {\n      geom: { Rect: Rect },\n      util: {\n        Promise: promiseObj,\n        Delay: Delay,\n        Tools: Tools,\n        VK: VK,\n        URI: URI,\n        Class: Class,\n        EventDispatcher: Dispatcher,\n        Observable: Observable,\n        I18n: I18n,\n        XHR: XHR,\n        JSON: JSON$1,\n        JSONRequest: JSONRequest,\n        JSONP: JSONP,\n        LocalStorage: LocalStorage,\n        Color: Color\n      },\n      dom: {\n        EventUtils: EventUtils,\n        Sizzle: Sizzle,\n        DomQuery: DomQuery,\n        TreeWalker: TreeWalker,\n        DOMUtils: DOMUtils$1,\n        ScriptLoader: ScriptLoader,\n        RangeUtils: RangeUtils$1,\n        Serializer: DomSerializer$1,\n        ControlSelection: ControlSelection,\n        BookmarkManager: BookmarkManager$1,\n        Selection: Selection$1,\n        Event: EventUtils.Event\n      },\n      html: {\n        Styles: Styles,\n        Entities: Entities,\n        Node: Node$1,\n        Schema: Schema,\n        SaxParser: SaxParser$1,\n        DomParser: DomParser,\n        Writer: Writer,\n        Serializer: HtmlSerializer\n      },\n      ui: { Factory: Factory },\n      Env: Env,\n      AddOnManager: AddOnManager,\n      Annotator: Annotator,\n      Formatter: Formatter,\n      UndoManager: UndoManager,\n      EditorCommands: EditorCommands,\n      WindowManager: WindowManager,\n      NotificationManager: NotificationManager,\n      EditorObservable: EditorObservable$1,\n      Shortcuts: Shortcuts,\n      Editor: Editor,\n      FocusManager: FocusManager,\n      EditorManager: EditorManager$1,\n      DOM: DOMUtils$1.DOM,\n      ScriptLoader: ScriptLoader.ScriptLoader,\n      PluginManager: AddOnManager.PluginManager,\n      ThemeManager: AddOnManager.ThemeManager,\n      trim: Tools.trim,\n      isArray: Tools.isArray,\n      is: Tools.is,\n      toArray: Tools.toArray,\n      makeMap: Tools.makeMap,\n      each: Tools.each,\n      map: Tools.map,\n      grep: Tools.grep,\n      inArray: Tools.inArray,\n      extend: Tools.extend,\n      create: Tools.create,\n      walk: Tools.walk,\n      createNS: Tools.createNS,\n      resolve: Tools.resolve,\n      explode: Tools.explode,\n      _addCacheSuffix: Tools._addCacheSuffix,\n      isOpera: Env.opera,\n      isWebKit: Env.webkit,\n      isIE: Env.ie,\n      isGecko: Env.gecko,\n      isMac: Env.mac\n    };\n    tinymce = Tools.extend(tinymce, publicApi);\n    var Tinymce = tinymce;\n\n    var exportToModuleLoaders = function (tinymce) {\n      if (typeof module === 'object') {\n        try {\n          module.exports = tinymce;\n        } catch (_) {\n        }\n      }\n    };\n    var exportToWindowGlobal = function (tinymce) {\n      window.tinymce = tinymce;\n      window.tinyMCE = tinymce;\n    };\n    exportToWindowGlobal(Tinymce);\n    exportToModuleLoaders(Tinymce);\n\n}(window));\n})();\n\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./~/tinymce/tinymce.js\n// module id = 5eDb\n// module chunks = 44"],"sourceRoot":""}