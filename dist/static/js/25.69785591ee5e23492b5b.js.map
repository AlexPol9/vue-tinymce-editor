{"version":3,"sources":["webpack:///static/js/25.69785591ee5e23492b5b.js","webpack:///./~/tinymce/plugins/imagetools/index.js","webpack:///./~/tinymce/plugins/imagetools/plugin.js"],"names":["webpackJsonp","XjFM","module","exports","__webpack_require__","vvTU","domGlobals","curry","fn","initialArgs","_i","arguments","length","restArgs","all","concat","apply","create","width","height","resize","document","createElement","clone","canvas","tCanvas","get2dContext","drawImage","getContext","getWidth","image","naturalWidth","getHeight","naturalHeight","imageToBlob","src","indexOf","dataUriToBlob","anyUriToBlob","blobToImage","blob","Promise","resolve","reject","loaded","removeListeners","error","type","blobUrl","URL","createObjectURL","Image","removeEventListener","addEventListener","complete","url","xhr","XMLHttpRequest","open","responseType","onload","this","status","response","onerror","_this","obj","Error","code","name","send","dataUriToBlobSync","uri","data","split","matches","exec","Option","none","mimetype","base64","byteCharacters","atob","bytesLength","slicesCount","Math","ceil","byteArrays","Array","sliceIndex","begin","end","min","bytes","offset","i","charCodeAt","Uint8Array","some","Blob","fold","canvasToBlob","quality","HTMLCanvasElement","prototype","toBlob","toDataURL","canvasToDataURL","blobToCanvas","then","revokeImageUrl","blobToDataUri","reader","FileReader","onloadend","result","readAsDataURL","revokeObjectURL","create$1","getCanvas","toBase64","toAdjustedBlob","toAdjustedDataURL","toAdjustedBase64","dataurl","toCanvas","initialType","getType","constant","fromBlob","fromCanvas","clamp","value","max","parsedValue","parseFloat","identity","multiply","matrix1","matrix2","val","col","out","j","k","adjust","matrix","adjustValue","map","index","adjustContrast","x","DELTA_INDEX","floor","adjustSaturation","adjustHue","angle","PI","cosVal","cos","sinVal","sin","adjustBrightness","adjustColors","adjustR","adjustG","adjustB","adjustSepia","adjustGrayscale","colorFilter","ir","applyColorFilter","context","pixels","pixelsData","m","r","g","b","a","m0","m1","m2","m3","m4","m5","m6","m7","m8","m9","m10","m11","m12","m13","m14","m15","m16","m17","m18","m19","getImageData","putImageData","convoluteFilter","applyConvoluteFilter","pixelsIn","pixelsOut","pIn","pOut","aMatrix","side","round","sqrt","halfSide","rgba","drgba","w","h","y","cy","cx","scx","scy","innerOffset","wt","functionColorFilter","colorFn","filterImpl","lookup","lookupData","complexAdjustableColorFilter","matrixAdjustFn","basicConvolutionFilter","kernel","scale","dW","dH","sW","sH","wRatio","hRatio","scaleCapped","scaled","_scale","rotate","applyRotate","translateX","translateY","translate","flip","axis","applyFlip","crop","applyCrop","resize$1","newCanvas","UndoStack","add","state","removed","splice","push","undo","canUndo","redo","canRedo","CropRect","currentRect","viewPortRect","clampRect","containerElm","action","getAbsoluteRect","outerRect","relativeRect","getRelativeRect","innerRect","getInnerRect","moveRect","handle","startRect","deltaX","deltaY","rect","deltaW","deltaH","global$7","instance","fire","setInnerRect","toggleVisibility","selectors","global$1","handles","id","blockers","blocker","join","global$8","show","hide","repaint","updateElementRect","css","left","top","each","xMul","yMul","setRect","setViewPortRect","setClampRect","destroy","dragHelpers","helper","prefix","count","label","createDragHelper","global$6","get","ownerDocument","start","drag","e","appendTo","append","on","target","attr","moveAndBlock","evt","stopPropagation","preventDefault","activeHandle","keyCode","global$a","LEFT","RIGHT","UP","DOWN","ENTER","SPACEBAR","extend","global$9","createState","destroyState","destroyStates","states","editor","currentState","recalcSize","widthCtrl","heightCtrl","newWidth","newHeight","win","find","parseInt","checked","control","settings","ratioW","ratioH","floatToPercent","updateButtonUndoStates","disabled","undoStack","statusbar","disableUndoRedo","displayState","imagePanel","imageSrc","switchPanel","targetPanel","hidePanels","grep","panels","panel","focus","addTempState","tempState","addBlobState","selection","blobToImageResult","crop$1","imageResultToBlob","cancel","arg","args","slice","call","mainPanel","waitForTempState","times","applyCall","setTimeout","windowManager","alert","applyTempState","zoomIn","zoom","zoomOut","save","close","createPanel","items","layout","direction","labelGap","border","align","pack","padding","spacing","flex","minHeight","defaults","classes","createFilterPanel","title","filter","reverseIfRtl","text","onclick","subtype","newTempState","createVariableFilterPanel","update","ondragend","minValue","rtl","maxValue","previewFilter","toggleConstrain","filtersPanel","cropPanel","resizePanel","flipRotatePanel","sidePanel","mainViewContainer","invertPanel","brightnessPanel","huePanel","saturatePanel","contrastPanel","grayscalePanel","sepiaPanel","colorizePanel","sharpenPanel","embossPanel","gammaPanel","exposurePanel","reverse","tempAction","toggleCropRect","size","onkeyup","onchange","resize$2","icon","tooltip","flip$1","rotate$1","invert$1","sharpen$1","emboss$1","brightness$1","hue$1","saturate$1","contrast$1","grayscale$1","sepia$1","colorize$1","gamma$1","exposure$1","ImagePanel","minWidth","global$5","DOM","getViewPort","buttons","imageSize","edit","imageResult","global$3","getImageSize","img","isPxValue","test","style","setImageSize","removeAttribute","setAttribute","getNaturalImageSize","Global$1","getOrDie","requestBlob","withCredentials","Utils","requestUrlAsBlob","Errors","handleHttpError","Plugin","Cell","initial","set","v","global","tinymce","util","Tools","noop","never","always","NONE","eq","o","isNone","thunk","n","me","s","is","isSome","getOr","getOrThunk","msg","getOrNull","getOrUndefined","undefined","or","orThunk","bind","exists","forall","equals","equals_","toArray","toString","Object","freeze","constant_a","self","f","elementEq","from","window","thisArg","deferred","_state","_deferreds","asap","cb","onFulfilled","onRejected","_value","ret","newValue","TypeError","doResolve","finale","_a","Handler","done","reason","ex","immediateFn","setImmediate","isArray","catch","values","res","remaining","constructor","race","values_1","blobToImage$1","imageToBlob$1","invert","brightness","hue","saturate","contrast","grayscale","sepia","colorize","sharpen","emboss","gamma","color","pow","exposure","exp","Global","Function","path","parts","scope","p","unsafe","actual","u","global$2","global$4","getToolbarItems","getParam","getProxyUrl","getCorsHosts","getCredentialsHosts","getApiKey","getUploadTimeout","shouldReuseFilename","loadImage","LoadImage","create$2","Defaults","viewRect","$img","lastRect","$el","replaceWith","bg","className","getEl","appendChild","inflate","zoomFit","repaintImage","postRender","_super","pw","ph","clientWidth","clientHeight","$bg","elm","offsetWidth","offsetHeight","cropRect","bindStates","setupCropRect","Dialog","ImageSize","typeOf","t","isPrototypeOf","String","isFunction","nativeSlice","xs","pred","len","isValue","traverse","json","reduce","key","headers","onreadystatechange","readyState","setRequestHeader","readBlob","fr","readAsText","parseJson","JSON","parse","friendlyHttpErrors","message","friendlyServiceErrors","isServiceErrorCode","getHttpErrorMsg","getServiceErrorMsg","getServiceError","serviceError","errorType","handleServiceError","handleServiceErrorResponse","appendApiKey","apiKey","separator","encodeURIComponent","requestServiceBlob","getUrl","Proxy","count$1","isEditableImage","dom","isLocalImage","isCorsImage","imagetools_proxy","displayError","notificationManager","getSelectedImage","getNode","extractFilename","match","encode","createId","host","documentBaseURI","inArray","isCorsWithCredentialsImage","imageToBlob$2","findSelectedBlob","blobInfo","editorUpload","blobCache","getByUri","startTimedUpload","imageUploadTimerState","imageUploadTimer","setEditorTimeout","uploadImagesAuto","cancelTimedUpload","clearTimeout","updateSelectedImage","uploadImmediately","selectedImage","undoManager","transact","imageLoadedHandler","$","off","nodeChanged","blobUri","removeAttr","selectedImageOperation","_scanForImages","rotate$2","flippedSize","flip$2","editImageDialog","originalSize","handleDialogBlob","newImage","newSize","openDialog","Actions","register","mceImageRotateLeft","mceImageRotateRight","mceImageFlipVertical","mceImageFlipHorizontal","mceEditImage","cmd","addCommand","Commands","setup","lastSelectedImageState","lastSelectedImage","element","UploadSelectedImage","register$1","addButton","Buttons","register$2","addContextToolbar","ContextToolbar"],"mappings":"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CA,GACA,IACA,IACA,IACA,IACA,GACA,IACA,IACA,IACA,IACA,IACA,IACA,IACA,IACA,IACA,GACA,IACA,IACA,IACA,IACA,IACA,IACA,EACA,KACA,KACA,KACA,KACA,IACA,KACA,KACA,KACA,KACA,IACA,KACA,KACA,KACA,KACA,IACA,KACA,EACA,KACA,KACA,KACA,IACA,KACA,KACA,KACA,EACA,IACA,IACA,IACA,IACA,EACA,IACA,IACA,IACA,EACA,IACA,EACA,IACA,IACA,EACA,IACA,IACA,IACA,EACA,IACA,IACA,EACA,IACA,IACA,IACA,IAiYE0a,GAVJ,SAA0Bhb,GACxB,MAAO,UAAUwB,GACf,MAAOD,GAAYC,EAAIxB,OASxB,EACD,EACA,EACA,EACA,IACA,GACC,EACD,EACA,EACA,IACA,EACA,GACC,EACD,EACA,IACA,EACA,EACA,EACA,EACA,EACA,EACA,EACA,EACA,EACA,IAEEib,GAAa9V,EAA6BnE,GAC1Cka,GAAM/V,EAA6B1E,GACnC0a,GAAWhW,EAA6B3E,GACxC4a,GAAWjW,EAA6B/E,GACxCib,GAAYlW,EAA6B7D,GACzCga,GAAQnW,EAA6B9D,GACrCka,GAAW,SAAU/Z,EAAIN,EAASC,EAASC,GAC7C,MAAOG,GAAYC,EAAIP,EAAa3B,IAAY4B,EAASC,EAASC,KAEhEoa,GAAUnW,GACZ,GACC,EACD,GACC,EACD,GACC,EACD,GACC,EACD,IAEEoW,GAASpW,IACV,GACA,EACD,GACC,EACD,EACA,EACA,EACA,EACA,IAEEqW,GAAQ5W,EAAoB,SAAU6W,EAAOzc,GAC/C,MAA0C,KAAnC/C,KAAKyf,IAAID,EAAQ,IAAK,EAAIzc,KAE/B2c,GAAW/W,EAAoB,SAAU6W,EAAOzc,GAClD,MAAO,MAAO,EAAI/C,KAAK2f,KAAMH,EAAQ,IAAOzc,MAgG1C2U,GAAW,SAAUrS,GACvB,MAAOwZ,IAAOxZ,IAEZsS,GAAY,SAAUtS,GACxB,MAAOga,IAAQha,IAEbuS,GAAW,SAAUvS,GACvB,MAAOia,IAAOja,IAEZ+S,GAAU,SAAU/S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","file":"static/js/25.69785591ee5e23492b5b.js","sourcesContent":["webpackJsonp([25],{\n\n/***/ \"XjFM\":\n/***/ (function(module, exports, __webpack_require__) {\n\n// Exports the \"imagetools\" plugin for usage with module loaders\n// Usage:\n//   CommonJS:\n//     require('tinymce/plugins/imagetools')\n//   ES2015:\n//     import 'tinymce/plugins/imagetools'\n__webpack_require__(\"vvTU\");\n\n/***/ }),\n\n/***/ \"vvTU\":\n/***/ (function(module, exports) {\n\n(function () {\nvar imagetools = (function (domGlobals) {\n    'use strict';\n\n    var Cell = function (initial) {\n      var value = initial;\n      var get = function () {\n        return value;\n      };\n      var set = function (v) {\n        value = v;\n      };\n      var clone = function () {\n        return Cell(get());\n      };\n      return {\n        get: get,\n        set: set,\n        clone: clone\n      };\n    };\n\n    var global = tinymce.util.Tools.resolve('tinymce.PluginManager');\n\n    var global$1 = tinymce.util.Tools.resolve('tinymce.util.Tools');\n\n    var noop = function () {\n    };\n    var constant = function (value) {\n      return function () {\n        return value;\n      };\n    };\n    function curry(fn) {\n      var initialArgs = [];\n      for (var _i = 1; _i < arguments.length; _i++) {\n        initialArgs[_i - 1] = arguments[_i];\n      }\n      return function () {\n        var restArgs = [];\n        for (var _i = 0; _i < arguments.length; _i++) {\n          restArgs[_i] = arguments[_i];\n        }\n        var all = initialArgs.concat(restArgs);\n        return fn.apply(null, all);\n      };\n    }\n    var never = constant(false);\n    var always = constant(true);\n\n    var none = function () {\n      return NONE;\n    };\n    var NONE = function () {\n      var eq = function (o) {\n        return o.isNone();\n      };\n      var call = function (thunk) {\n        return thunk();\n      };\n      var id = function (n) {\n        return n;\n      };\n      var me = {\n        fold: function (n, s) {\n          return n();\n        },\n        is: never,\n        isSome: never,\n        isNone: always,\n        getOr: id,\n        getOrThunk: call,\n        getOrDie: function (msg) {\n          throw new Error(msg || 'error: getOrDie called on none.');\n        },\n        getOrNull: constant(null),\n        getOrUndefined: constant(undefined),\n        or: id,\n        orThunk: call,\n        map: none,\n        each: noop,\n        bind: none,\n        exists: never,\n        forall: always,\n        filter: none,\n        equals: eq,\n        equals_: eq,\n        toArray: function () {\n          return [];\n        },\n        toString: constant('none()')\n      };\n      if (Object.freeze) {\n        Object.freeze(me);\n      }\n      return me;\n    }();\n    var some = function (a) {\n      var constant_a = constant(a);\n      var self = function () {\n        return me;\n      };\n      var bind = function (f) {\n        return f(a);\n      };\n      var me = {\n        fold: function (n, s) {\n          return s(a);\n        },\n        is: function (v) {\n          return a === v;\n        },\n        isSome: always,\n        isNone: never,\n        getOr: constant_a,\n        getOrThunk: constant_a,\n        getOrDie: constant_a,\n        getOrNull: constant_a,\n        getOrUndefined: constant_a,\n        or: self,\n        orThunk: self,\n        map: function (f) {\n          return some(f(a));\n        },\n        each: function (f) {\n          f(a);\n        },\n        bind: bind,\n        exists: bind,\n        forall: bind,\n        filter: function (f) {\n          return f(a) ? me : NONE;\n        },\n        toArray: function () {\n          return [a];\n        },\n        toString: function () {\n          return 'some(' + a + ')';\n        },\n        equals: function (o) {\n          return o.is(a);\n        },\n        equals_: function (o, elementEq) {\n          return o.fold(never, function (b) {\n            return elementEq(a, b);\n          });\n        }\n      };\n      return me;\n    };\n    var from = function (value) {\n      return value === null || value === undefined ? NONE : some(value);\n    };\n    var Option = {\n      some: some,\n      none: none,\n      from: from\n    };\n\n    function create(width, height) {\n      return resize(domGlobals.document.createElement('canvas'), width, height);\n    }\n    function clone(canvas) {\n      var tCanvas = create(canvas.width, canvas.height);\n      var ctx = get2dContext(tCanvas);\n      ctx.drawImage(canvas, 0, 0);\n      return tCanvas;\n    }\n    function get2dContext(canvas) {\n      return canvas.getContext('2d');\n    }\n    function resize(canvas, width, height) {\n      canvas.width = width;\n      canvas.height = height;\n      return canvas;\n    }\n\n    function getWidth(image) {\n      return image.naturalWidth || image.width;\n    }\n    function getHeight(image) {\n      return image.naturalHeight || image.height;\n    }\n\n    var promise = function () {\n      var Promise = function (fn) {\n        if (typeof this !== 'object') {\n          throw new TypeError('Promises must be constructed via new');\n        }\n        if (typeof fn !== 'function') {\n          throw new TypeError('not a function');\n        }\n        this._state = null;\n        this._value = null;\n        this._deferreds = [];\n        doResolve(fn, bind(resolve, this), bind(reject, this));\n      };\n      var asap = Promise.immediateFn || typeof window.setImmediate === 'function' && window.setImmediate || function (fn) {\n        domGlobals.setTimeout(fn, 1);\n      };\n      function bind(fn, thisArg) {\n        return function () {\n          return fn.apply(thisArg, arguments);\n        };\n      }\n      var isArray = Array.isArray || function (value) {\n        return Object.prototype.toString.call(value) === '[object Array]';\n      };\n      function handle(deferred) {\n        var me = this;\n        if (this._state === null) {\n          this._deferreds.push(deferred);\n          return;\n        }\n        asap(function () {\n          var cb = me._state ? deferred.onFulfilled : deferred.onRejected;\n          if (cb === null) {\n            (me._state ? deferred.resolve : deferred.reject)(me._value);\n            return;\n          }\n          var ret;\n          try {\n            ret = cb(me._value);\n          } catch (e) {\n            deferred.reject(e);\n            return;\n          }\n          deferred.resolve(ret);\n        });\n      }\n      function resolve(newValue) {\n        try {\n          if (newValue === this) {\n            throw new TypeError('A promise cannot be resolved with itself.');\n          }\n          if (newValue && (typeof newValue === 'object' || typeof newValue === 'function')) {\n            var then = newValue.then;\n            if (typeof then === 'function') {\n              doResolve(bind(then, newValue), bind(resolve, this), bind(reject, this));\n              return;\n            }\n          }\n          this._state = true;\n          this._value = newValue;\n          finale.call(this);\n        } catch (e) {\n          reject.call(this, e);\n        }\n      }\n      function reject(newValue) {\n        this._state = false;\n        this._value = newValue;\n        finale.call(this);\n      }\n      function finale() {\n        for (var _i = 0, _a = this._deferreds; _i < _a.length; _i++) {\n          var deferred = _a[_i];\n          handle.call(this, deferred);\n        }\n        this._deferreds = [];\n      }\n      function Handler(onFulfilled, onRejected, resolve, reject) {\n        this.onFulfilled = typeof onFulfilled === 'function' ? onFulfilled : null;\n        this.onRejected = typeof onRejected === 'function' ? onRejected : null;\n        this.resolve = resolve;\n        this.reject = reject;\n      }\n      function doResolve(fn, onFulfilled, onRejected) {\n        var done = false;\n        try {\n          fn(function (value) {\n            if (done) {\n              return;\n            }\n            done = true;\n            onFulfilled(value);\n          }, function (reason) {\n            if (done) {\n              return;\n            }\n            done = true;\n            onRejected(reason);\n          });\n        } catch (ex) {\n          if (done) {\n            return;\n          }\n          done = true;\n          onRejected(ex);\n        }\n      }\n      Promise.prototype.catch = function (onRejected) {\n        return this.then(null, onRejected);\n      };\n      Promise.prototype.then = function (onFulfilled, onRejected) {\n        var me = this;\n        return new Promise(function (resolve, reject) {\n          handle.call(me, new Handler(onFulfilled, onRejected, resolve, reject));\n        });\n      };\n      Promise.all = function () {\n        var values = [];\n        for (var _i = 0; _i < arguments.length; _i++) {\n          values[_i] = arguments[_i];\n        }\n        var args = Array.prototype.slice.call(values.length === 1 && isArray(values[0]) ? values[0] : values);\n        return new Promise(function (resolve, reject) {\n          if (args.length === 0) {\n            return resolve([]);\n          }\n          var remaining = args.length;\n          function res(i, val) {\n            try {\n              if (val && (typeof val === 'object' || typeof val === 'function')) {\n                var then = val.then;\n                if (typeof then === 'function') {\n                  then.call(val, function (val) {\n                    res(i, val);\n                  }, reject);\n                  return;\n                }\n              }\n              args[i] = val;\n              if (--remaining === 0) {\n                resolve(args);\n              }\n            } catch (ex) {\n              reject(ex);\n            }\n          }\n          for (var i = 0; i < args.length; i++) {\n            res(i, args[i]);\n          }\n        });\n      };\n      Promise.resolve = function (value) {\n        if (value && typeof value === 'object' && value.constructor === Promise) {\n          return value;\n        }\n        return new Promise(function (resolve) {\n          resolve(value);\n        });\n      };\n      Promise.reject = function (reason) {\n        return new Promise(function (resolve, reject) {\n          reject(reason);\n        });\n      };\n      Promise.race = function (values) {\n        return new Promise(function (resolve, reject) {\n          for (var _i = 0, values_1 = values; _i < values_1.length; _i++) {\n            var value = values_1[_i];\n            value.then(resolve, reject);\n          }\n        });\n      };\n      return Promise;\n    };\n    var Promise = window.Promise ? window.Promise : promise();\n\n    function imageToBlob(image) {\n      var src = image.src;\n      if (src.indexOf('data:') === 0) {\n        return dataUriToBlob(src);\n      }\n      return anyUriToBlob(src);\n    }\n    function blobToImage(blob) {\n      return new Promise(function (resolve, reject) {\n        var blobUrl = domGlobals.URL.createObjectURL(blob);\n        var image = new domGlobals.Image();\n        var removeListeners = function () {\n          image.removeEventListener('load', loaded);\n          image.removeEventListener('error', error);\n        };\n        function loaded() {\n          removeListeners();\n          resolve(image);\n        }\n        function error() {\n          removeListeners();\n          reject('Unable to load data of type ' + blob.type + ': ' + blobUrl);\n        }\n        image.addEventListener('load', loaded);\n        image.addEventListener('error', error);\n        image.src = blobUrl;\n        if (image.complete) {\n          loaded();\n        }\n      });\n    }\n    function anyUriToBlob(url) {\n      return new Promise(function (resolve, reject) {\n        var xhr = new domGlobals.XMLHttpRequest();\n        xhr.open('GET', url, true);\n        xhr.responseType = 'blob';\n        xhr.onload = function () {\n          if (this.status === 200) {\n            resolve(this.response);\n          }\n        };\n        xhr.onerror = function () {\n          var _this = this;\n          var corsError = function () {\n            var obj = new Error('No access to download image');\n            obj.code = 18;\n            obj.name = 'SecurityError';\n            return obj;\n          };\n          var genericError = function () {\n            return new Error('Error ' + _this.status + ' downloading image');\n          };\n          reject(this.status === 0 ? corsError() : genericError());\n        };\n        xhr.send();\n      });\n    }\n    function dataUriToBlobSync(uri) {\n      var data = uri.split(',');\n      var matches = /data:([^;]+)/.exec(data[0]);\n      if (!matches) {\n        return Option.none();\n      }\n      var mimetype = matches[1];\n      var base64 = data[1];\n      var sliceSize = 1024;\n      var byteCharacters = domGlobals.atob(base64);\n      var bytesLength = byteCharacters.length;\n      var slicesCount = Math.ceil(bytesLength / sliceSize);\n      var byteArrays = new Array(slicesCount);\n      for (var sliceIndex = 0; sliceIndex < slicesCount; ++sliceIndex) {\n        var begin = sliceIndex * sliceSize;\n        var end = Math.min(begin + sliceSize, bytesLength);\n        var bytes = new Array(end - begin);\n        for (var offset = begin, i = 0; offset < end; ++i, ++offset) {\n          bytes[i] = byteCharacters[offset].charCodeAt(0);\n        }\n        byteArrays[sliceIndex] = new Uint8Array(bytes);\n      }\n      return Option.some(new domGlobals.Blob(byteArrays, { type: mimetype }));\n    }\n    function dataUriToBlob(uri) {\n      return new Promise(function (resolve, reject) {\n        dataUriToBlobSync(uri).fold(function () {\n          reject('uri is not base64: ' + uri);\n        }, resolve);\n      });\n    }\n    function canvasToBlob(canvas, type, quality) {\n      type = type || 'image/png';\n      if (domGlobals.HTMLCanvasElement.prototype.toBlob) {\n        return new Promise(function (resolve, reject) {\n          canvas.toBlob(function (blob) {\n            if (blob) {\n              resolve(blob);\n            } else {\n              reject();\n            }\n          }, type, quality);\n        });\n      } else {\n        return dataUriToBlob(canvas.toDataURL(type, quality));\n      }\n    }\n    function canvasToDataURL(canvas, type, quality) {\n      type = type || 'image/png';\n      return canvas.toDataURL(type, quality);\n    }\n    function blobToCanvas(blob) {\n      return blobToImage(blob).then(function (image) {\n        revokeImageUrl(image);\n        var canvas = create(getWidth(image), getHeight(image));\n        var context = get2dContext(canvas);\n        context.drawImage(image, 0, 0);\n        return canvas;\n      });\n    }\n    function blobToDataUri(blob) {\n      return new Promise(function (resolve) {\n        var reader = new domGlobals.FileReader();\n        reader.onloadend = function () {\n          resolve(reader.result);\n        };\n        reader.readAsDataURL(blob);\n      });\n    }\n    function revokeImageUrl(image) {\n      domGlobals.URL.revokeObjectURL(image.src);\n    }\n\n    var blobToImage$1 = function (blob) {\n      return blobToImage(blob);\n    };\n    var imageToBlob$1 = function (image) {\n      return imageToBlob(image);\n    };\n\n    function create$1(getCanvas, blob, uri) {\n      var initialType = blob.type;\n      var getType = constant(initialType);\n      function toBlob() {\n        return Promise.resolve(blob);\n      }\n      function toDataURL() {\n        return uri;\n      }\n      function toBase64() {\n        return uri.split(',')[1];\n      }\n      function toAdjustedBlob(type, quality) {\n        return getCanvas.then(function (canvas) {\n          return canvasToBlob(canvas, type, quality);\n        });\n      }\n      function toAdjustedDataURL(type, quality) {\n        return getCanvas.then(function (canvas) {\n          return canvasToDataURL(canvas, type, quality);\n        });\n      }\n      function toAdjustedBase64(type, quality) {\n        return toAdjustedDataURL(type, quality).then(function (dataurl) {\n          return dataurl.split(',')[1];\n        });\n      }\n      function toCanvas() {\n        return getCanvas.then(clone);\n      }\n      return {\n        getType: getType,\n        toBlob: toBlob,\n        toDataURL: toDataURL,\n        toBase64: toBase64,\n        toAdjustedBlob: toAdjustedBlob,\n        toAdjustedDataURL: toAdjustedDataURL,\n        toAdjustedBase64: toAdjustedBase64,\n        toCanvas: toCanvas\n      };\n    }\n    function fromBlob(blob) {\n      return blobToDataUri(blob).then(function (uri) {\n        return create$1(blobToCanvas(blob), blob, uri);\n      });\n    }\n    function fromCanvas(canvas, type) {\n      return canvasToBlob(canvas, type).then(function (blob) {\n        return create$1(Promise.resolve(canvas), blob, canvas.toDataURL());\n      });\n    }\n\n    function clamp(value, min, max) {\n      var parsedValue = typeof value === 'string' ? parseFloat(value) : value;\n      if (parsedValue > max) {\n        parsedValue = max;\n      } else if (parsedValue < min) {\n        parsedValue = min;\n      }\n      return parsedValue;\n    }\n    function identity() {\n      return [\n        1,\n        0,\n        0,\n        0,\n        0,\n        0,\n        1,\n        0,\n        0,\n        0,\n        0,\n        0,\n        1,\n        0,\n        0,\n        0,\n        0,\n        0,\n        1,\n        0,\n        0,\n        0,\n        0,\n        0,\n        1\n      ];\n    }\n    var DELTA_INDEX = [\n      0,\n      0.01,\n      0.02,\n      0.04,\n      0.05,\n      0.06,\n      0.07,\n      0.08,\n      0.1,\n      0.11,\n      0.12,\n      0.14,\n      0.15,\n      0.16,\n      0.17,\n      0.18,\n      0.2,\n      0.21,\n      0.22,\n      0.24,\n      0.25,\n      0.27,\n      0.28,\n      0.3,\n      0.32,\n      0.34,\n      0.36,\n      0.38,\n      0.4,\n      0.42,\n      0.44,\n      0.46,\n      0.48,\n      0.5,\n      0.53,\n      0.56,\n      0.59,\n      0.62,\n      0.65,\n      0.68,\n      0.71,\n      0.74,\n      0.77,\n      0.8,\n      0.83,\n      0.86,\n      0.89,\n      0.92,\n      0.95,\n      0.98,\n      1,\n      1.06,\n      1.12,\n      1.18,\n      1.24,\n      1.3,\n      1.36,\n      1.42,\n      1.48,\n      1.54,\n      1.6,\n      1.66,\n      1.72,\n      1.78,\n      1.84,\n      1.9,\n      1.96,\n      2,\n      2.12,\n      2.25,\n      2.37,\n      2.5,\n      2.62,\n      2.75,\n      2.87,\n      3,\n      3.2,\n      3.4,\n      3.6,\n      3.8,\n      4,\n      4.3,\n      4.7,\n      4.9,\n      5,\n      5.5,\n      6,\n      6.5,\n      6.8,\n      7,\n      7.3,\n      7.5,\n      7.8,\n      8,\n      8.4,\n      8.7,\n      9,\n      9.4,\n      9.6,\n      9.8,\n      10\n    ];\n    function multiply(matrix1, matrix2) {\n      var col = [];\n      var out = new Array(25);\n      var val;\n      for (var i = 0; i < 5; i++) {\n        for (var j = 0; j < 5; j++) {\n          col[j] = matrix2[j + i * 5];\n        }\n        for (var j = 0; j < 5; j++) {\n          val = 0;\n          for (var k = 0; k < 5; k++) {\n            val += matrix1[j + k * 5] * col[k];\n          }\n          out[j + i * 5] = val;\n        }\n      }\n      return out;\n    }\n    function adjust(matrix, adjustValue) {\n      adjustValue = clamp(adjustValue, 0, 1);\n      return matrix.map(function (value, index) {\n        if (index % 6 === 0) {\n          value = 1 - (1 - value) * adjustValue;\n        } else {\n          value *= adjustValue;\n        }\n        return clamp(value, 0, 1);\n      });\n    }\n    function adjustContrast(matrix, value) {\n      var x;\n      value = clamp(value, -1, 1);\n      value *= 100;\n      if (value < 0) {\n        x = 127 + value / 100 * 127;\n      } else {\n        x = value % 1;\n        if (x === 0) {\n          x = DELTA_INDEX[value];\n        } else {\n          x = DELTA_INDEX[Math.floor(value)] * (1 - x) + DELTA_INDEX[Math.floor(value) + 1] * x;\n        }\n        x = x * 127 + 127;\n      }\n      return multiply(matrix, [\n        x / 127,\n        0,\n        0,\n        0,\n        0.5 * (127 - x),\n        0,\n        x / 127,\n        0,\n        0,\n        0.5 * (127 - x),\n        0,\n        0,\n        x / 127,\n        0,\n        0.5 * (127 - x),\n        0,\n        0,\n        0,\n        1,\n        0,\n        0,\n        0,\n        0,\n        0,\n        1\n      ]);\n    }\n    function adjustSaturation(matrix, value) {\n      value = clamp(value, -1, 1);\n      var x = 1 + (value > 0 ? 3 * value : value);\n      var lumR = 0.3086;\n      var lumG = 0.6094;\n      var lumB = 0.082;\n      return multiply(matrix, [\n        lumR * (1 - x) + x,\n        lumG * (1 - x),\n        lumB * (1 - x),\n        0,\n        0,\n        lumR * (1 - x),\n        lumG * (1 - x) + x,\n        lumB * (1 - x),\n        0,\n        0,\n        lumR * (1 - x),\n        lumG * (1 - x),\n        lumB * (1 - x) + x,\n        0,\n        0,\n        0,\n        0,\n        0,\n        1,\n        0,\n        0,\n        0,\n        0,\n        0,\n        1\n      ]);\n    }\n    function adjustHue(matrix, angle) {\n      angle = clamp(angle, -180, 180) / 180 * Math.PI;\n      var cosVal = Math.cos(angle);\n      var sinVal = Math.sin(angle);\n      var lumR = 0.213;\n      var lumG = 0.715;\n      var lumB = 0.072;\n      return multiply(matrix, [\n        lumR + cosVal * (1 - lumR) + sinVal * -lumR,\n        lumG + cosVal * -lumG + sinVal * -lumG,\n        lumB + cosVal * -lumB + sinVal * (1 - lumB),\n        0,\n        0,\n        lumR + cosVal * -lumR + sinVal * 0.143,\n        lumG + cosVal * (1 - lumG) + sinVal * 0.14,\n        lumB + cosVal * -lumB + sinVal * -0.283,\n        0,\n        0,\n        lumR + cosVal * -lumR + sinVal * -(1 - lumR),\n        lumG + cosVal * -lumG + sinVal * lumG,\n        lumB + cosVal * (1 - lumB) + sinVal * lumB,\n        0,\n        0,\n        0,\n        0,\n        0,\n        1,\n        0,\n        0,\n        0,\n        0,\n        0,\n        1\n      ]);\n    }\n    function adjustBrightness(matrix, value) {\n      value = clamp(255 * value, -255, 255);\n      return multiply(matrix, [\n        1,\n        0,\n        0,\n        0,\n        value,\n        0,\n        1,\n        0,\n        0,\n        value,\n        0,\n        0,\n        1,\n        0,\n        value,\n        0,\n        0,\n        0,\n        1,\n        0,\n        0,\n        0,\n        0,\n        0,\n        1\n      ]);\n    }\n    function adjustColors(matrix, adjustR, adjustG, adjustB) {\n      adjustR = clamp(adjustR, 0, 2);\n      adjustG = clamp(adjustG, 0, 2);\n      adjustB = clamp(adjustB, 0, 2);\n      return multiply(matrix, [\n        adjustR,\n        0,\n        0,\n        0,\n        0,\n        0,\n        adjustG,\n        0,\n        0,\n        0,\n        0,\n        0,\n        adjustB,\n        0,\n        0,\n        0,\n        0,\n        0,\n        1,\n        0,\n        0,\n        0,\n        0,\n        0,\n        1\n      ]);\n    }\n    function adjustSepia(matrix, value) {\n      value = clamp(value, 0, 1);\n      return multiply(matrix, adjust([\n        0.393,\n        0.769,\n        0.189,\n        0,\n        0,\n        0.349,\n        0.686,\n        0.168,\n        0,\n        0,\n        0.272,\n        0.534,\n        0.131,\n        0,\n        0,\n        0,\n        0,\n        0,\n        1,\n        0,\n        0,\n        0,\n        0,\n        0,\n        1\n      ], value));\n    }\n    function adjustGrayscale(matrix, value) {\n      value = clamp(value, 0, 1);\n      return multiply(matrix, adjust([\n        0.33,\n        0.34,\n        0.33,\n        0,\n        0,\n        0.33,\n        0.34,\n        0.33,\n        0,\n        0,\n        0.33,\n        0.34,\n        0.33,\n        0,\n        0,\n        0,\n        0,\n        0,\n        1,\n        0,\n        0,\n        0,\n        0,\n        0,\n        1\n      ], value));\n    }\n\n    function colorFilter(ir, matrix) {\n      return ir.toCanvas().then(function (canvas) {\n        return applyColorFilter(canvas, ir.getType(), matrix);\n      });\n    }\n    function applyColorFilter(canvas, type, matrix) {\n      var context = get2dContext(canvas);\n      function applyMatrix(pixelsData, m) {\n        var r, g, b, a;\n        var data = pixelsData.data, m0 = m[0], m1 = m[1], m2 = m[2], m3 = m[3], m4 = m[4], m5 = m[5], m6 = m[6], m7 = m[7], m8 = m[8], m9 = m[9], m10 = m[10], m11 = m[11], m12 = m[12], m13 = m[13], m14 = m[14], m15 = m[15], m16 = m[16], m17 = m[17], m18 = m[18], m19 = m[19];\n        for (var i = 0; i < data.length; i += 4) {\n          r = data[i];\n          g = data[i + 1];\n          b = data[i + 2];\n          a = data[i + 3];\n          data[i] = r * m0 + g * m1 + b * m2 + a * m3 + m4;\n          data[i + 1] = r * m5 + g * m6 + b * m7 + a * m8 + m9;\n          data[i + 2] = r * m10 + g * m11 + b * m12 + a * m13 + m14;\n          data[i + 3] = r * m15 + g * m16 + b * m17 + a * m18 + m19;\n        }\n        return pixelsData;\n      }\n      var pixels = applyMatrix(context.getImageData(0, 0, canvas.width, canvas.height), matrix);\n      context.putImageData(pixels, 0, 0);\n      return fromCanvas(canvas, type);\n    }\n    function convoluteFilter(ir, matrix) {\n      return ir.toCanvas().then(function (canvas) {\n        return applyConvoluteFilter(canvas, ir.getType(), matrix);\n      });\n    }\n    function applyConvoluteFilter(canvas, type, matrix) {\n      var context = get2dContext(canvas);\n      function applyMatrix(pIn, pOut, aMatrix) {\n        function clamp(value, min, max) {\n          if (value > max) {\n            value = max;\n          } else if (value < min) {\n            value = min;\n          }\n          return value;\n        }\n        var side = Math.round(Math.sqrt(aMatrix.length));\n        var halfSide = Math.floor(side / 2);\n        var rgba = pIn.data;\n        var drgba = pOut.data;\n        var w = pIn.width;\n        var h = pIn.height;\n        for (var y = 0; y < h; y++) {\n          for (var x = 0; x < w; x++) {\n            var r = 0;\n            var g = 0;\n            var b = 0;\n            for (var cy = 0; cy < side; cy++) {\n              for (var cx = 0; cx < side; cx++) {\n                var scx = clamp(x + cx - halfSide, 0, w - 1);\n                var scy = clamp(y + cy - halfSide, 0, h - 1);\n                var innerOffset = (scy * w + scx) * 4;\n                var wt = aMatrix[cy * side + cx];\n                r += rgba[innerOffset] * wt;\n                g += rgba[innerOffset + 1] * wt;\n                b += rgba[innerOffset + 2] * wt;\n              }\n            }\n            var offset = (y * w + x) * 4;\n            drgba[offset] = clamp(r, 0, 255);\n            drgba[offset + 1] = clamp(g, 0, 255);\n            drgba[offset + 2] = clamp(b, 0, 255);\n          }\n        }\n        return pOut;\n      }\n      var pixelsIn = context.getImageData(0, 0, canvas.width, canvas.height);\n      var pixelsOut = context.getImageData(0, 0, canvas.width, canvas.height);\n      pixelsOut = applyMatrix(pixelsIn, pixelsOut, matrix);\n      context.putImageData(pixelsOut, 0, 0);\n      return fromCanvas(canvas, type);\n    }\n    function functionColorFilter(colorFn) {\n      var filterImpl = function (canvas, type, value) {\n        var context = get2dContext(canvas);\n        var lookup = new Array(256);\n        function applyLookup(pixelsData, lookupData) {\n          var data = pixelsData.data;\n          for (var i = 0; i < data.length; i += 4) {\n            data[i] = lookupData[data[i]];\n            data[i + 1] = lookupData[data[i + 1]];\n            data[i + 2] = lookupData[data[i + 2]];\n          }\n          return pixelsData;\n        }\n        for (var i = 0; i < lookup.length; i++) {\n          lookup[i] = colorFn(i, value);\n        }\n        var pixels = applyLookup(context.getImageData(0, 0, canvas.width, canvas.height), lookup);\n        context.putImageData(pixels, 0, 0);\n        return fromCanvas(canvas, type);\n      };\n      return function (ir, value) {\n        return ir.toCanvas().then(function (canvas) {\n          return filterImpl(canvas, ir.getType(), value);\n        });\n      };\n    }\n    function complexAdjustableColorFilter(matrixAdjustFn) {\n      return function (ir, adjust) {\n        return colorFilter(ir, matrixAdjustFn(identity(), adjust));\n      };\n    }\n    function basicColorFilter(matrix) {\n      return function (ir) {\n        return colorFilter(ir, matrix);\n      };\n    }\n    function basicConvolutionFilter(kernel) {\n      return function (ir) {\n        return convoluteFilter(ir, kernel);\n      };\n    }\n    var invert = basicColorFilter([\n      -1,\n      0,\n      0,\n      0,\n      255,\n      0,\n      -1,\n      0,\n      0,\n      255,\n      0,\n      0,\n      -1,\n      0,\n      255,\n      0,\n      0,\n      0,\n      1,\n      0,\n      0,\n      0,\n      0,\n      0,\n      1\n    ]);\n    var brightness = complexAdjustableColorFilter(adjustBrightness);\n    var hue = complexAdjustableColorFilter(adjustHue);\n    var saturate = complexAdjustableColorFilter(adjustSaturation);\n    var contrast = complexAdjustableColorFilter(adjustContrast);\n    var grayscale = complexAdjustableColorFilter(adjustGrayscale);\n    var sepia = complexAdjustableColorFilter(adjustSepia);\n    var colorize = function (ir, adjustR, adjustG, adjustB) {\n      return colorFilter(ir, adjustColors(identity(), adjustR, adjustG, adjustB));\n    };\n    var sharpen = basicConvolutionFilter([\n      0,\n      -1,\n      0,\n      -1,\n      5,\n      -1,\n      0,\n      -1,\n      0\n    ]);\n    var emboss = basicConvolutionFilter([\n      -2,\n      -1,\n      0,\n      -1,\n      1,\n      1,\n      0,\n      1,\n      2\n    ]);\n    var gamma = functionColorFilter(function (color, value) {\n      return Math.pow(color / 255, 1 - value) * 255;\n    });\n    var exposure = functionColorFilter(function (color, value) {\n      return 255 * (1 - Math.exp(-(color / 255) * value));\n    });\n\n    function scale(image, dW, dH) {\n      var sW = getWidth(image);\n      var sH = getHeight(image);\n      var wRatio = dW / sW;\n      var hRatio = dH / sH;\n      var scaleCapped = false;\n      if (wRatio < 0.5 || wRatio > 2) {\n        wRatio = wRatio < 0.5 ? 0.5 : 2;\n        scaleCapped = true;\n      }\n      if (hRatio < 0.5 || hRatio > 2) {\n        hRatio = hRatio < 0.5 ? 0.5 : 2;\n        scaleCapped = true;\n      }\n      var scaled = _scale(image, wRatio, hRatio);\n      return !scaleCapped ? scaled : scaled.then(function (tCanvas) {\n        return scale(tCanvas, dW, dH);\n      });\n    }\n    function _scale(image, wRatio, hRatio) {\n      return new Promise(function (resolve) {\n        var sW = getWidth(image);\n        var sH = getHeight(image);\n        var dW = Math.floor(sW * wRatio);\n        var dH = Math.floor(sH * hRatio);\n        var canvas = create(dW, dH);\n        var context = get2dContext(canvas);\n        context.drawImage(image, 0, 0, sW, sH, 0, 0, dW, dH);\n        resolve(canvas);\n      });\n    }\n\n    function rotate(ir, angle) {\n      return ir.toCanvas().then(function (canvas) {\n        return applyRotate(canvas, ir.getType(), angle);\n      });\n    }\n    function applyRotate(image, type, angle) {\n      var canvas = create(image.width, image.height);\n      var context = get2dContext(canvas);\n      var translateX = 0;\n      var translateY = 0;\n      angle = angle < 0 ? 360 + angle : angle;\n      if (angle === 90 || angle === 270) {\n        resize(canvas, canvas.height, canvas.width);\n      }\n      if (angle === 90 || angle === 180) {\n        translateX = canvas.width;\n      }\n      if (angle === 270 || angle === 180) {\n        translateY = canvas.height;\n      }\n      context.translate(translateX, translateY);\n      context.rotate(angle * Math.PI / 180);\n      context.drawImage(image, 0, 0);\n      return fromCanvas(canvas, type);\n    }\n    function flip(ir, axis) {\n      return ir.toCanvas().then(function (canvas) {\n        return applyFlip(canvas, ir.getType(), axis);\n      });\n    }\n    function applyFlip(image, type, axis) {\n      var canvas = create(image.width, image.height);\n      var context = get2dContext(canvas);\n      if (axis === 'v') {\n        context.scale(1, -1);\n        context.drawImage(image, 0, -canvas.height);\n      } else {\n        context.scale(-1, 1);\n        context.drawImage(image, -canvas.width, 0);\n      }\n      return fromCanvas(canvas, type);\n    }\n    function crop(ir, x, y, w, h) {\n      return ir.toCanvas().then(function (canvas) {\n        return applyCrop(canvas, ir.getType(), x, y, w, h);\n      });\n    }\n    function applyCrop(image, type, x, y, w, h) {\n      var canvas = create(w, h);\n      var context = get2dContext(canvas);\n      context.drawImage(image, -x, -y);\n      return fromCanvas(canvas, type);\n    }\n    function resize$1(ir, w, h) {\n      return ir.toCanvas().then(function (canvas) {\n        return scale(canvas, w, h).then(function (newCanvas) {\n          return fromCanvas(newCanvas, ir.getType());\n        });\n      });\n    }\n\n    var invert$1 = function (ir) {\n      return invert(ir);\n    };\n    var sharpen$1 = function (ir) {\n      return sharpen(ir);\n    };\n    var emboss$1 = function (ir) {\n      return emboss(ir);\n    };\n    var gamma$1 = function (ir, value) {\n      return gamma(ir, value);\n    };\n    var exposure$1 = function (ir, value) {\n      return exposure(ir, value);\n    };\n    var colorize$1 = function (ir, adjustR, adjustG, adjustB) {\n      return colorize(ir, adjustR, adjustG, adjustB);\n    };\n    var brightness$1 = function (ir, adjust) {\n      return brightness(ir, adjust);\n    };\n    var hue$1 = function (ir, adjust) {\n      return hue(ir, adjust);\n    };\n    var saturate$1 = function (ir, adjust) {\n      return saturate(ir, adjust);\n    };\n    var contrast$1 = function (ir, adjust) {\n      return contrast(ir, adjust);\n    };\n    var grayscale$1 = function (ir, adjust) {\n      return grayscale(ir, adjust);\n    };\n    var sepia$1 = function (ir, adjust) {\n      return sepia(ir, adjust);\n    };\n    var flip$1 = function (ir, axis) {\n      return flip(ir, axis);\n    };\n    var crop$1 = function (ir, x, y, w, h) {\n      return crop(ir, x, y, w, h);\n    };\n    var resize$2 = function (ir, w, h) {\n      return resize$1(ir, w, h);\n    };\n    var rotate$1 = function (ir, angle) {\n      return rotate(ir, angle);\n    };\n\n    var blobToImageResult = function (blob) {\n      return fromBlob(blob);\n    };\n\n    var Global = typeof domGlobals.window !== 'undefined' ? domGlobals.window : Function('return this;')();\n\n    var path = function (parts, scope) {\n      var o = scope !== undefined && scope !== null ? scope : Global;\n      for (var i = 0; i < parts.length && o !== undefined && o !== null; ++i) {\n        o = o[parts[i]];\n      }\n      return o;\n    };\n    var resolve = function (p, scope) {\n      var parts = p.split('.');\n      return path(parts, scope);\n    };\n\n    var unsafe = function (name, scope) {\n      return resolve(name, scope);\n    };\n    var getOrDie = function (name, scope) {\n      var actual = unsafe(name, scope);\n      if (actual === undefined || actual === null) {\n        throw new Error(name + ' not available on this browser');\n      }\n      return actual;\n    };\n    var Global$1 = { getOrDie: getOrDie };\n\n    var url = function () {\n      return Global$1.getOrDie('URL');\n    };\n    var createObjectURL = function (blob) {\n      return url().createObjectURL(blob);\n    };\n    var revokeObjectURL = function (u) {\n      url().revokeObjectURL(u);\n    };\n    var URL = {\n      createObjectURL: createObjectURL,\n      revokeObjectURL: revokeObjectURL\n    };\n\n    var global$2 = tinymce.util.Tools.resolve('tinymce.util.Delay');\n\n    var global$3 = tinymce.util.Tools.resolve('tinymce.util.Promise');\n\n    var global$4 = tinymce.util.Tools.resolve('tinymce.util.URI');\n\n    var getToolbarItems = function (editor) {\n      return editor.getParam('imagetools_toolbar', 'rotateleft rotateright | flipv fliph | crop editimage imageoptions');\n    };\n    var getProxyUrl = function (editor) {\n      return editor.getParam('imagetools_proxy');\n    };\n    var getCorsHosts = function (editor) {\n      return editor.getParam('imagetools_cors_hosts', [], 'string[]');\n    };\n    var getCredentialsHosts = function (editor) {\n      return editor.getParam('imagetools_credentials_hosts', [], 'string[]');\n    };\n    var getApiKey = function (editor) {\n      return editor.getParam('api_key', editor.getParam('imagetools_api_key', '', 'string'), 'string');\n    };\n    var getUploadTimeout = function (editor) {\n      return editor.getParam('images_upload_timeout', 30000, 'number');\n    };\n    var shouldReuseFilename = function (editor) {\n      return editor.getParam('images_reuse_filename', false, 'boolean');\n    };\n\n    var global$5 = tinymce.util.Tools.resolve('tinymce.dom.DOMUtils');\n\n    var global$6 = tinymce.util.Tools.resolve('tinymce.ui.Factory');\n\n    function UndoStack () {\n      var data = [];\n      var index = -1;\n      function add(state) {\n        var removed;\n        removed = data.splice(++index);\n        data.push(state);\n        return {\n          state: state,\n          removed: removed\n        };\n      }\n      function undo() {\n        if (canUndo()) {\n          return data[--index];\n        }\n      }\n      function redo() {\n        if (canRedo()) {\n          return data[++index];\n        }\n      }\n      function canUndo() {\n        return index > 0;\n      }\n      function canRedo() {\n        return index !== -1 && index < data.length - 1;\n      }\n      return {\n        data: data,\n        add: add,\n        undo: undo,\n        redo: redo,\n        canUndo: canUndo,\n        canRedo: canRedo\n      };\n    }\n\n    var global$7 = tinymce.util.Tools.resolve('tinymce.geom.Rect');\n\n    var loadImage = function (image) {\n      return new global$3(function (resolve) {\n        var loaded = function () {\n          image.removeEventListener('load', loaded);\n          resolve(image);\n        };\n        if (image.complete) {\n          resolve(image);\n        } else {\n          image.addEventListener('load', loaded);\n        }\n      });\n    };\n    var LoadImage = { loadImage: loadImage };\n\n    var global$8 = tinymce.util.Tools.resolve('tinymce.dom.DomQuery');\n\n    var global$9 = tinymce.util.Tools.resolve('tinymce.util.Observable');\n\n    var global$a = tinymce.util.Tools.resolve('tinymce.util.VK');\n\n    var count = 0;\n    function CropRect (currentRect, viewPortRect, clampRect, containerElm, action) {\n      var instance;\n      var handles;\n      var dragHelpers;\n      var blockers;\n      var prefix = 'mce-';\n      var id = prefix + 'crid-' + count++;\n      handles = [\n        {\n          name: 'move',\n          xMul: 0,\n          yMul: 0,\n          deltaX: 1,\n          deltaY: 1,\n          deltaW: 0,\n          deltaH: 0,\n          label: 'Crop Mask'\n        },\n        {\n          name: 'nw',\n          xMul: 0,\n          yMul: 0,\n          deltaX: 1,\n          deltaY: 1,\n          deltaW: -1,\n          deltaH: -1,\n          label: 'Top Left Crop Handle'\n        },\n        {\n          name: 'ne',\n          xMul: 1,\n          yMul: 0,\n          deltaX: 0,\n          deltaY: 1,\n          deltaW: 1,\n          deltaH: -1,\n          label: 'Top Right Crop Handle'\n        },\n        {\n          name: 'sw',\n          xMul: 0,\n          yMul: 1,\n          deltaX: 1,\n          deltaY: 0,\n          deltaW: -1,\n          deltaH: 1,\n          label: 'Bottom Left Crop Handle'\n        },\n        {\n          name: 'se',\n          xMul: 1,\n          yMul: 1,\n          deltaX: 0,\n          deltaY: 0,\n          deltaW: 1,\n          deltaH: 1,\n          label: 'Bottom Right Crop Handle'\n        }\n      ];\n      blockers = [\n        'top',\n        'right',\n        'bottom',\n        'left'\n      ];\n      function getAbsoluteRect(outerRect, relativeRect) {\n        return {\n          x: relativeRect.x + outerRect.x,\n          y: relativeRect.y + outerRect.y,\n          w: relativeRect.w,\n          h: relativeRect.h\n        };\n      }\n      function getRelativeRect(outerRect, innerRect) {\n        return {\n          x: innerRect.x - outerRect.x,\n          y: innerRect.y - outerRect.y,\n          w: innerRect.w,\n          h: innerRect.h\n        };\n      }\n      function getInnerRect() {\n        return getRelativeRect(clampRect, currentRect);\n      }\n      function moveRect(handle, startRect, deltaX, deltaY) {\n        var x, y, w, h, rect;\n        x = startRect.x;\n        y = startRect.y;\n        w = startRect.w;\n        h = startRect.h;\n        x += deltaX * handle.deltaX;\n        y += deltaY * handle.deltaY;\n        w += deltaX * handle.deltaW;\n        h += deltaY * handle.deltaH;\n        if (w < 20) {\n          w = 20;\n        }\n        if (h < 20) {\n          h = 20;\n        }\n        rect = currentRect = global$7.clamp({\n          x: x,\n          y: y,\n          w: w,\n          h: h\n        }, clampRect, handle.name === 'move');\n        rect = getRelativeRect(clampRect, rect);\n        instance.fire('updateRect', { rect: rect });\n        setInnerRect(rect);\n      }\n      function render() {\n        function createDragHelper(handle) {\n          var startRect;\n          var DragHelper = global$6.get('DragHelper');\n          return new DragHelper(id, {\n            document: containerElm.ownerDocument,\n            handle: id + '-' + handle.name,\n            start: function () {\n              startRect = currentRect;\n            },\n            drag: function (e) {\n              moveRect(handle, startRect, e.deltaX, e.deltaY);\n            }\n          });\n        }\n        global$8('<div id=\"' + id + '\" class=\"' + prefix + 'croprect-container\"' + ' role=\"grid\" aria-dropeffect=\"execute\">').appendTo(containerElm);\n        global$1.each(blockers, function (blocker) {\n          global$8('#' + id, containerElm).append('<div id=\"' + id + '-' + blocker + '\"class=\"' + prefix + 'croprect-block\" style=\"display: none\" data-mce-bogus=\"all\">');\n        });\n        global$1.each(handles, function (handle) {\n          global$8('#' + id, containerElm).append('<div id=\"' + id + '-' + handle.name + '\" class=\"' + prefix + 'croprect-handle ' + prefix + 'croprect-handle-' + handle.name + '\"' + 'style=\"display: none\" data-mce-bogus=\"all\" role=\"gridcell\" tabindex=\"-1\"' + ' aria-label=\"' + handle.label + '\" aria-grabbed=\"false\">');\n        });\n        dragHelpers = global$1.map(handles, createDragHelper);\n        repaint(currentRect);\n        global$8(containerElm).on('focusin focusout', function (e) {\n          global$8(e.target).attr('aria-grabbed', e.type === 'focus');\n        });\n        global$8(containerElm).on('keydown', function (e) {\n          var activeHandle;\n          global$1.each(handles, function (handle) {\n            if (e.target.id === id + '-' + handle.name) {\n              activeHandle = handle;\n              return false;\n            }\n          });\n          function moveAndBlock(evt, handle, startRect, deltaX, deltaY) {\n            evt.stopPropagation();\n            evt.preventDefault();\n            moveRect(activeHandle, startRect, deltaX, deltaY);\n          }\n          switch (e.keyCode) {\n          case global$a.LEFT:\n            moveAndBlock(e, activeHandle, currentRect, -10, 0);\n            break;\n          case global$a.RIGHT:\n            moveAndBlock(e, activeHandle, currentRect, 10, 0);\n            break;\n          case global$a.UP:\n            moveAndBlock(e, activeHandle, currentRect, 0, -10);\n            break;\n          case global$a.DOWN:\n            moveAndBlock(e, activeHandle, currentRect, 0, 10);\n            break;\n          case global$a.ENTER:\n          case global$a.SPACEBAR:\n            e.preventDefault();\n            action();\n            break;\n          }\n        });\n      }\n      function toggleVisibility(state) {\n        var selectors;\n        selectors = global$1.map(handles, function (handle) {\n          return '#' + id + '-' + handle.name;\n        }).concat(global$1.map(blockers, function (blocker) {\n          return '#' + id + '-' + blocker;\n        })).join(',');\n        if (state) {\n          global$8(selectors, containerElm).show();\n        } else {\n          global$8(selectors, containerElm).hide();\n        }\n      }\n      function repaint(rect) {\n        function updateElementRect(name, rect) {\n          if (rect.h < 0) {\n            rect.h = 0;\n          }\n          if (rect.w < 0) {\n            rect.w = 0;\n          }\n          global$8('#' + id + '-' + name, containerElm).css({\n            left: rect.x,\n            top: rect.y,\n            width: rect.w,\n            height: rect.h\n          });\n        }\n        global$1.each(handles, function (handle) {\n          global$8('#' + id + '-' + handle.name, containerElm).css({\n            left: rect.w * handle.xMul + rect.x,\n            top: rect.h * handle.yMul + rect.y\n          });\n        });\n        updateElementRect('top', {\n          x: viewPortRect.x,\n          y: viewPortRect.y,\n          w: viewPortRect.w,\n          h: rect.y - viewPortRect.y\n        });\n        updateElementRect('right', {\n          x: rect.x + rect.w,\n          y: rect.y,\n          w: viewPortRect.w - rect.x - rect.w + viewPortRect.x,\n          h: rect.h\n        });\n        updateElementRect('bottom', {\n          x: viewPortRect.x,\n          y: rect.y + rect.h,\n          w: viewPortRect.w,\n          h: viewPortRect.h - rect.y - rect.h + viewPortRect.y\n        });\n        updateElementRect('left', {\n          x: viewPortRect.x,\n          y: rect.y,\n          w: rect.x - viewPortRect.x,\n          h: rect.h\n        });\n        updateElementRect('move', rect);\n      }\n      function setRect(rect) {\n        currentRect = rect;\n        repaint(currentRect);\n      }\n      function setViewPortRect(rect) {\n        viewPortRect = rect;\n        repaint(currentRect);\n      }\n      function setInnerRect(rect) {\n        setRect(getAbsoluteRect(clampRect, rect));\n      }\n      function setClampRect(rect) {\n        clampRect = rect;\n        repaint(currentRect);\n      }\n      function destroy() {\n        global$1.each(dragHelpers, function (helper) {\n          helper.destroy();\n        });\n        dragHelpers = [];\n      }\n      render();\n      instance = global$1.extend({\n        toggleVisibility: toggleVisibility,\n        setClampRect: setClampRect,\n        setRect: setRect,\n        getInnerRect: getInnerRect,\n        setInnerRect: setInnerRect,\n        setViewPortRect: setViewPortRect,\n        destroy: destroy\n      }, global$9);\n      return instance;\n    }\n\n    var create$2 = function (settings) {\n      var Control = global$6.get('Control');\n      var ImagePanel = Control.extend({\n        Defaults: { classes: 'imagepanel' },\n        selection: function (rect) {\n          if (arguments.length) {\n            this.state.set('rect', rect);\n            return this;\n          }\n          return this.state.get('rect');\n        },\n        imageSize: function () {\n          var viewRect = this.state.get('viewRect');\n          return {\n            w: viewRect.w,\n            h: viewRect.h\n          };\n        },\n        toggleCropRect: function (state) {\n          this.state.set('cropEnabled', state);\n        },\n        imageSrc: function (url) {\n          var self = this, img = new domGlobals.Image();\n          img.src = url;\n          LoadImage.loadImage(img).then(function () {\n            var rect, $img;\n            var lastRect = self.state.get('viewRect');\n            $img = self.$el.find('img');\n            if ($img[0]) {\n              $img.replaceWith(img);\n            } else {\n              var bg = domGlobals.document.createElement('div');\n              bg.className = 'mce-imagepanel-bg';\n              self.getEl().appendChild(bg);\n              self.getEl().appendChild(img);\n            }\n            rect = {\n              x: 0,\n              y: 0,\n              w: img.naturalWidth,\n              h: img.naturalHeight\n            };\n            self.state.set('viewRect', rect);\n            self.state.set('rect', global$7.inflate(rect, -20, -20));\n            if (!lastRect || lastRect.w !== rect.w || lastRect.h !== rect.h) {\n              self.zoomFit();\n            }\n            self.repaintImage();\n            self.fire('load');\n          });\n        },\n        zoom: function (value) {\n          if (arguments.length) {\n            this.state.set('zoom', value);\n            return this;\n          }\n          return this.state.get('zoom');\n        },\n        postRender: function () {\n          this.imageSrc(this.settings.imageSrc);\n          return this._super();\n        },\n        zoomFit: function () {\n          var self = this;\n          var $img, pw, ph, w, h, zoom, padding;\n          padding = 10;\n          $img = self.$el.find('img');\n          pw = self.getEl().clientWidth;\n          ph = self.getEl().clientHeight;\n          w = $img[0].naturalWidth;\n          h = $img[0].naturalHeight;\n          zoom = Math.min((pw - padding) / w, (ph - padding) / h);\n          if (zoom >= 1) {\n            zoom = 1;\n          }\n          self.zoom(zoom);\n        },\n        repaintImage: function () {\n          var x, y, w, h, pw, ph, $img, $bg, zoom, rect, elm;\n          elm = this.getEl();\n          zoom = this.zoom();\n          rect = this.state.get('rect');\n          $img = this.$el.find('img');\n          $bg = this.$el.find('.mce-imagepanel-bg');\n          pw = elm.offsetWidth;\n          ph = elm.offsetHeight;\n          w = $img[0].naturalWidth * zoom;\n          h = $img[0].naturalHeight * zoom;\n          x = Math.max(0, pw / 2 - w / 2);\n          y = Math.max(0, ph / 2 - h / 2);\n          $img.css({\n            left: x,\n            top: y,\n            width: w,\n            height: h\n          });\n          $bg.css({\n            left: x,\n            top: y,\n            width: w,\n            height: h\n          });\n          if (this.cropRect) {\n            this.cropRect.setRect({\n              x: rect.x * zoom + x,\n              y: rect.y * zoom + y,\n              w: rect.w * zoom,\n              h: rect.h * zoom\n            });\n            this.cropRect.setClampRect({\n              x: x,\n              y: y,\n              w: w,\n              h: h\n            });\n            this.cropRect.setViewPortRect({\n              x: 0,\n              y: 0,\n              w: pw,\n              h: ph\n            });\n          }\n        },\n        bindStates: function () {\n          var self = this;\n          function setupCropRect(rect) {\n            self.cropRect = CropRect(rect, self.state.get('viewRect'), self.state.get('viewRect'), self.getEl(), function () {\n              self.fire('crop');\n            });\n            self.cropRect.on('updateRect', function (e) {\n              var rect = e.rect;\n              var zoom = self.zoom();\n              rect = {\n                x: Math.round(rect.x / zoom),\n                y: Math.round(rect.y / zoom),\n                w: Math.round(rect.w / zoom),\n                h: Math.round(rect.h / zoom)\n              };\n              self.state.set('rect', rect);\n            });\n            self.on('remove', self.cropRect.destroy);\n          }\n          self.state.on('change:cropEnabled', function (e) {\n            self.cropRect.toggleVisibility(e.value);\n            self.repaintImage();\n          });\n          self.state.on('change:zoom', function () {\n            self.repaintImage();\n          });\n          self.state.on('change:rect', function (e) {\n            var rect = e.value;\n            if (!self.cropRect) {\n              setupCropRect(rect);\n            }\n            self.cropRect.setRect(rect);\n          });\n        }\n      });\n      return new ImagePanel(settings);\n    };\n    var ImagePanel = { create: create$2 };\n\n    function createState(blob) {\n      return {\n        blob: blob,\n        url: URL.createObjectURL(blob)\n      };\n    }\n    function destroyState(state) {\n      if (state) {\n        URL.revokeObjectURL(state.url);\n      }\n    }\n    function destroyStates(states) {\n      global$1.each(states, destroyState);\n    }\n    function open(editor, currentState, resolve, reject) {\n      var win, undoStack = UndoStack(), mainPanel, filtersPanel, tempState, cropPanel, resizePanel, flipRotatePanel, imagePanel, sidePanel, mainViewContainer, invertPanel, brightnessPanel, huePanel, saturatePanel, contrastPanel, grayscalePanel, sepiaPanel, colorizePanel, sharpenPanel, embossPanel, gammaPanel, exposurePanel, panels, width, height, ratioW, ratioH;\n      var reverseIfRtl = function (items) {\n        return editor.rtl ? items.reverse() : items;\n      };\n      function recalcSize(e) {\n        var widthCtrl, heightCtrl, newWidth, newHeight;\n        widthCtrl = win.find('#w')[0];\n        heightCtrl = win.find('#h')[0];\n        newWidth = parseInt(widthCtrl.value(), 10);\n        newHeight = parseInt(heightCtrl.value(), 10);\n        if (win.find('#constrain')[0].checked() && width && height && newWidth && newHeight) {\n          if (e.control.settings.name === 'w') {\n            newHeight = Math.round(newWidth * ratioW);\n            heightCtrl.value(newHeight);\n          } else {\n            newWidth = Math.round(newHeight * ratioH);\n            widthCtrl.value(newWidth);\n          }\n        }\n        width = newWidth;\n        height = newHeight;\n      }\n      function floatToPercent(value) {\n        return Math.round(value * 100) + '%';\n      }\n      function updateButtonUndoStates() {\n        win.find('#undo').disabled(!undoStack.canUndo());\n        win.find('#redo').disabled(!undoStack.canRedo());\n        win.statusbar.find('#save').disabled(!undoStack.canUndo());\n      }\n      function disableUndoRedo() {\n        win.find('#undo').disabled(true);\n        win.find('#redo').disabled(true);\n      }\n      function displayState(state) {\n        if (state) {\n          imagePanel.imageSrc(state.url);\n        }\n      }\n      function switchPanel(targetPanel) {\n        return function () {\n          var hidePanels = global$1.grep(panels, function (panel) {\n            return panel.settings.name !== targetPanel;\n          });\n          global$1.each(hidePanels, function (panel) {\n            panel.hide();\n          });\n          targetPanel.show();\n          targetPanel.focus();\n        };\n      }\n      function addTempState(blob) {\n        tempState = createState(blob);\n        displayState(tempState);\n      }\n      function addBlobState(blob) {\n        currentState = createState(blob);\n        displayState(currentState);\n        destroyStates(undoStack.add(currentState).removed);\n        updateButtonUndoStates();\n      }\n      function crop() {\n        var rect = imagePanel.selection();\n        blobToImageResult(currentState.blob).then(function (ir) {\n          crop$1(ir, rect.x, rect.y, rect.w, rect.h).then(imageResultToBlob).then(function (blob) {\n            addBlobState(blob);\n            cancel();\n          });\n        });\n      }\n      var tempAction = function (fn) {\n        var args = [].slice.call(arguments, 1);\n        return function () {\n          var state = tempState || currentState;\n          blobToImageResult(state.blob).then(function (ir) {\n            fn.apply(this, [ir].concat(args)).then(imageResultToBlob).then(addTempState);\n          });\n        };\n      };\n      function action(fn) {\n        var arg = [];\n        for (var _i = 1; _i < arguments.length; _i++) {\n          arg[_i - 1] = arguments[_i];\n        }\n        var args = [].slice.call(arguments, 1);\n        return function () {\n          blobToImageResult(currentState.blob).then(function (ir) {\n            fn.apply(this, [ir].concat(args)).then(imageResultToBlob).then(addBlobState);\n          });\n        };\n      }\n      function cancel() {\n        displayState(currentState);\n        destroyState(tempState);\n        switchPanel(mainPanel)();\n        updateButtonUndoStates();\n      }\n      function waitForTempState(times, applyCall) {\n        if (tempState) {\n          applyCall();\n        } else {\n          setTimeout(function () {\n            if (times-- > 0) {\n              waitForTempState(times, applyCall);\n            } else {\n              editor.windowManager.alert('Error: failed to apply image operation.');\n            }\n          }, 10);\n        }\n      }\n      function applyTempState() {\n        if (tempState) {\n          addBlobState(tempState.blob);\n          cancel();\n        } else {\n          waitForTempState(100, applyTempState);\n        }\n      }\n      function zoomIn() {\n        var zoom = imagePanel.zoom();\n        if (zoom < 2) {\n          zoom += 0.1;\n        }\n        imagePanel.zoom(zoom);\n      }\n      function zoomOut() {\n        var zoom = imagePanel.zoom();\n        if (zoom > 0.1) {\n          zoom -= 0.1;\n        }\n        imagePanel.zoom(zoom);\n      }\n      function undo() {\n        currentState = undoStack.undo();\n        displayState(currentState);\n        updateButtonUndoStates();\n      }\n      function redo() {\n        currentState = undoStack.redo();\n        displayState(currentState);\n        updateButtonUndoStates();\n      }\n      function save() {\n        resolve(currentState.blob);\n        win.close();\n      }\n      function createPanel(items) {\n        return global$6.create('Form', {\n          layout: 'flex',\n          direction: 'row',\n          labelGap: 5,\n          border: '0 0 1 0',\n          align: 'center',\n          pack: 'center',\n          padding: '0 10 0 10',\n          spacing: 5,\n          flex: 0,\n          minHeight: 60,\n          defaults: {\n            classes: 'imagetool',\n            type: 'button'\n          },\n          items: items\n        });\n      }\n      var imageResultToBlob = function (ir) {\n        return ir.toBlob();\n      };\n      function createFilterPanel(title, filter) {\n        return createPanel(reverseIfRtl([\n          {\n            text: 'Back',\n            onclick: cancel\n          },\n          {\n            type: 'spacer',\n            flex: 1\n          },\n          {\n            text: 'Apply',\n            subtype: 'primary',\n            onclick: applyTempState\n          }\n        ])).hide().on('show', function () {\n          disableUndoRedo();\n          blobToImageResult(currentState.blob).then(function (ir) {\n            return filter(ir);\n          }).then(imageResultToBlob).then(function (blob) {\n            var newTempState = createState(blob);\n            displayState(newTempState);\n            destroyState(tempState);\n            tempState = newTempState;\n          });\n        });\n      }\n      function createVariableFilterPanel(title, filter, value, min, max) {\n        function update(value) {\n          blobToImageResult(currentState.blob).then(function (ir) {\n            return filter(ir, value);\n          }).then(imageResultToBlob).then(function (blob) {\n            var newTempState = createState(blob);\n            displayState(newTempState);\n            destroyState(tempState);\n            tempState = newTempState;\n          });\n        }\n        return createPanel(reverseIfRtl([\n          {\n            text: 'Back',\n            onclick: cancel\n          },\n          {\n            type: 'spacer',\n            flex: 1\n          },\n          {\n            type: 'slider',\n            flex: 1,\n            ondragend: function (e) {\n              update(e.value);\n            },\n            minValue: editor.rtl ? max : min,\n            maxValue: editor.rtl ? min : max,\n            value: value,\n            previewFilter: floatToPercent\n          },\n          {\n            type: 'spacer',\n            flex: 1\n          },\n          {\n            text: 'Apply',\n            subtype: 'primary',\n            onclick: applyTempState\n          }\n        ])).hide().on('show', function () {\n          this.find('slider').value(value);\n          disableUndoRedo();\n        });\n      }\n      function createRgbFilterPanel(title, filter) {\n        function update() {\n          var r, g, b;\n          r = win.find('#r')[0].value();\n          g = win.find('#g')[0].value();\n          b = win.find('#b')[0].value();\n          blobToImageResult(currentState.blob).then(function (ir) {\n            return filter(ir, r, g, b);\n          }).then(imageResultToBlob).then(function (blob) {\n            var newTempState = createState(blob);\n            displayState(newTempState);\n            destroyState(tempState);\n            tempState = newTempState;\n          });\n        }\n        var min = editor.rtl ? 2 : 0;\n        var max = editor.rtl ? 0 : 2;\n        return createPanel(reverseIfRtl([\n          {\n            text: 'Back',\n            onclick: cancel\n          },\n          {\n            type: 'spacer',\n            flex: 1\n          },\n          {\n            type: 'slider',\n            label: 'R',\n            name: 'r',\n            minValue: min,\n            value: 1,\n            maxValue: max,\n            ondragend: update,\n            previewFilter: floatToPercent\n          },\n          {\n            type: 'slider',\n            label: 'G',\n            name: 'g',\n            minValue: min,\n            value: 1,\n            maxValue: max,\n            ondragend: update,\n            previewFilter: floatToPercent\n          },\n          {\n            type: 'slider',\n            label: 'B',\n            name: 'b',\n            minValue: min,\n            value: 1,\n            maxValue: max,\n            ondragend: update,\n            previewFilter: floatToPercent\n          },\n          {\n            type: 'spacer',\n            flex: 1\n          },\n          {\n            text: 'Apply',\n            subtype: 'primary',\n            onclick: applyTempState\n          }\n        ])).hide().on('show', function () {\n          win.find('#r,#g,#b').value(1);\n          disableUndoRedo();\n        });\n      }\n      cropPanel = createPanel(reverseIfRtl([\n        {\n          text: 'Back',\n          onclick: cancel\n        },\n        {\n          type: 'spacer',\n          flex: 1\n        },\n        {\n          text: 'Apply',\n          subtype: 'primary',\n          onclick: crop\n        }\n      ])).hide().on('show hide', function (e) {\n        imagePanel.toggleCropRect(e.type === 'show');\n      }).on('show', disableUndoRedo);\n      function toggleConstrain(e) {\n        if (e.control.value() === true) {\n          ratioW = height / width;\n          ratioH = width / height;\n        }\n      }\n      resizePanel = createPanel(reverseIfRtl([\n        {\n          text: 'Back',\n          onclick: cancel\n        },\n        {\n          type: 'spacer',\n          flex: 1\n        },\n        {\n          type: 'textbox',\n          name: 'w',\n          label: 'Width',\n          size: 4,\n          onkeyup: recalcSize\n        },\n        {\n          type: 'textbox',\n          name: 'h',\n          label: 'Height',\n          size: 4,\n          onkeyup: recalcSize\n        },\n        {\n          type: 'checkbox',\n          name: 'constrain',\n          text: 'Constrain proportions',\n          checked: true,\n          onchange: toggleConstrain\n        },\n        {\n          type: 'spacer',\n          flex: 1\n        },\n        {\n          text: 'Apply',\n          subtype: 'primary',\n          onclick: 'submit'\n        }\n      ])).hide().on('submit', function (e) {\n        var width = parseInt(win.find('#w').value(), 10), height = parseInt(win.find('#h').value(), 10);\n        e.preventDefault();\n        action(resize$2, width, height)();\n        cancel();\n      }).on('show', disableUndoRedo);\n      flipRotatePanel = createPanel(reverseIfRtl([\n        {\n          text: 'Back',\n          onclick: cancel\n        },\n        {\n          type: 'spacer',\n          flex: 1\n        },\n        {\n          icon: 'fliph',\n          tooltip: 'Flip horizontally',\n          onclick: tempAction(flip$1, 'h')\n        },\n        {\n          icon: 'flipv',\n          tooltip: 'Flip vertically',\n          onclick: tempAction(flip$1, 'v')\n        },\n        {\n          icon: 'rotateleft',\n          tooltip: 'Rotate counterclockwise',\n          onclick: tempAction(rotate$1, -90)\n        },\n        {\n          icon: 'rotateright',\n          tooltip: 'Rotate clockwise',\n          onclick: tempAction(rotate$1, 90)\n        },\n        {\n          type: 'spacer',\n          flex: 1\n        },\n        {\n          text: 'Apply',\n          subtype: 'primary',\n          onclick: applyTempState\n        }\n      ])).hide().on('show', disableUndoRedo);\n      invertPanel = createFilterPanel('Invert', invert$1);\n      sharpenPanel = createFilterPanel('Sharpen', sharpen$1);\n      embossPanel = createFilterPanel('Emboss', emboss$1);\n      brightnessPanel = createVariableFilterPanel('Brightness', brightness$1, 0, -1, 1);\n      huePanel = createVariableFilterPanel('Hue', hue$1, 180, 0, 360);\n      saturatePanel = createVariableFilterPanel('Saturate', saturate$1, 0, -1, 1);\n      contrastPanel = createVariableFilterPanel('Contrast', contrast$1, 0, -1, 1);\n      grayscalePanel = createVariableFilterPanel('Grayscale', grayscale$1, 0, 0, 1);\n      sepiaPanel = createVariableFilterPanel('Sepia', sepia$1, 0, 0, 1);\n      colorizePanel = createRgbFilterPanel('Colorize', colorize$1);\n      gammaPanel = createVariableFilterPanel('Gamma', gamma$1, 0, -1, 1);\n      exposurePanel = createVariableFilterPanel('Exposure', exposure$1, 1, 0, 2);\n      filtersPanel = createPanel(reverseIfRtl([\n        {\n          text: 'Back',\n          onclick: cancel\n        },\n        {\n          type: 'spacer',\n          flex: 1\n        },\n        {\n          text: 'hue',\n          icon: 'hue',\n          onclick: switchPanel(huePanel)\n        },\n        {\n          text: 'saturate',\n          icon: 'saturate',\n          onclick: switchPanel(saturatePanel)\n        },\n        {\n          text: 'sepia',\n          icon: 'sepia',\n          onclick: switchPanel(sepiaPanel)\n        },\n        {\n          text: 'emboss',\n          icon: 'emboss',\n          onclick: switchPanel(embossPanel)\n        },\n        {\n          text: 'exposure',\n          icon: 'exposure',\n          onclick: switchPanel(exposurePanel)\n        },\n        {\n          type: 'spacer',\n          flex: 1\n        }\n      ])).hide();\n      mainPanel = createPanel(reverseIfRtl([\n        {\n          tooltip: 'Crop',\n          icon: 'crop',\n          onclick: switchPanel(cropPanel)\n        },\n        {\n          tooltip: 'Resize',\n          icon: 'resize2',\n          onclick: switchPanel(resizePanel)\n        },\n        {\n          tooltip: 'Orientation',\n          icon: 'orientation',\n          onclick: switchPanel(flipRotatePanel)\n        },\n        {\n          tooltip: 'Brightness',\n          icon: 'sun',\n          onclick: switchPanel(brightnessPanel)\n        },\n        {\n          tooltip: 'Sharpen',\n          icon: 'sharpen',\n          onclick: switchPanel(sharpenPanel)\n        },\n        {\n          tooltip: 'Contrast',\n          icon: 'contrast',\n          onclick: switchPanel(contrastPanel)\n        },\n        {\n          tooltip: 'Color levels',\n          icon: 'drop',\n          onclick: switchPanel(colorizePanel)\n        },\n        {\n          tooltip: 'Gamma',\n          icon: 'gamma',\n          onclick: switchPanel(gammaPanel)\n        },\n        {\n          tooltip: 'Invert',\n          icon: 'invert',\n          onclick: switchPanel(invertPanel)\n        }\n      ]));\n      imagePanel = ImagePanel.create({\n        flex: 1,\n        imageSrc: currentState.url\n      });\n      sidePanel = global$6.create('Container', {\n        layout: 'flex',\n        direction: 'column',\n        pack: 'start',\n        border: '0 1 0 0',\n        padding: 5,\n        spacing: 5,\n        items: [\n          {\n            type: 'button',\n            icon: 'undo',\n            tooltip: 'Undo',\n            name: 'undo',\n            onclick: undo\n          },\n          {\n            type: 'button',\n            icon: 'redo',\n            tooltip: 'Redo',\n            name: 'redo',\n            onclick: redo\n          },\n          {\n            type: 'button',\n            icon: 'zoomin',\n            tooltip: 'Zoom in',\n            onclick: zoomIn\n          },\n          {\n            type: 'button',\n            icon: 'zoomout',\n            tooltip: 'Zoom out',\n            onclick: zoomOut\n          }\n        ]\n      });\n      mainViewContainer = global$6.create('Container', {\n        type: 'container',\n        layout: 'flex',\n        direction: 'row',\n        align: 'stretch',\n        flex: 1,\n        items: reverseIfRtl([\n          sidePanel,\n          imagePanel\n        ])\n      });\n      panels = [\n        mainPanel,\n        cropPanel,\n        resizePanel,\n        flipRotatePanel,\n        filtersPanel,\n        invertPanel,\n        brightnessPanel,\n        huePanel,\n        saturatePanel,\n        contrastPanel,\n        grayscalePanel,\n        sepiaPanel,\n        colorizePanel,\n        sharpenPanel,\n        embossPanel,\n        gammaPanel,\n        exposurePanel\n      ];\n      win = editor.windowManager.open({\n        layout: 'flex',\n        direction: 'column',\n        align: 'stretch',\n        minWidth: Math.min(global$5.DOM.getViewPort().w, 800),\n        minHeight: Math.min(global$5.DOM.getViewPort().h, 650),\n        title: 'Edit image',\n        items: panels.concat([mainViewContainer]),\n        buttons: reverseIfRtl([\n          {\n            text: 'Save',\n            name: 'save',\n            subtype: 'primary',\n            onclick: save\n          },\n          {\n            text: 'Cancel',\n            onclick: 'close'\n          }\n        ])\n      });\n      win.on('close', function () {\n        reject();\n        destroyStates(undoStack.data);\n        undoStack = null;\n        tempState = null;\n      });\n      undoStack.add(currentState);\n      updateButtonUndoStates();\n      imagePanel.on('load', function () {\n        width = imagePanel.imageSize().w;\n        height = imagePanel.imageSize().h;\n        ratioW = height / width;\n        ratioH = width / height;\n        win.find('#w').value(width);\n        win.find('#h').value(height);\n      });\n      imagePanel.on('crop', crop);\n    }\n    function edit(editor, imageResult) {\n      return new global$3(function (resolve, reject) {\n        return imageResult.toBlob().then(function (blob) {\n          open(editor, createState(blob), resolve, reject);\n        });\n      });\n    }\n    var Dialog = { edit: edit };\n\n    function getImageSize(img) {\n      var width, height;\n      function isPxValue(value) {\n        return /^[0-9\\.]+px$/.test(value);\n      }\n      width = img.style.width;\n      height = img.style.height;\n      if (width || height) {\n        if (isPxValue(width) && isPxValue(height)) {\n          return {\n            w: parseInt(width, 10),\n            h: parseInt(height, 10)\n          };\n        }\n        return null;\n      }\n      width = img.width;\n      height = img.height;\n      if (width && height) {\n        return {\n          w: parseInt(width, 10),\n          h: parseInt(height, 10)\n        };\n      }\n      return null;\n    }\n    function setImageSize(img, size) {\n      var width, height;\n      if (size) {\n        width = img.style.width;\n        height = img.style.height;\n        if (width || height) {\n          img.style.width = size.w + 'px';\n          img.style.height = size.h + 'px';\n          img.removeAttribute('data-mce-style');\n        }\n        width = img.width;\n        height = img.height;\n        if (width || height) {\n          img.setAttribute('width', size.w);\n          img.setAttribute('height', size.h);\n        }\n      }\n    }\n    function getNaturalImageSize(img) {\n      return {\n        w: img.naturalWidth,\n        h: img.naturalHeight\n      };\n    }\n    var ImageSize = {\n      getImageSize: getImageSize,\n      setImageSize: setImageSize,\n      getNaturalImageSize: getNaturalImageSize\n    };\n\n    var typeOf = function (x) {\n      if (x === null) {\n        return 'null';\n      }\n      var t = typeof x;\n      if (t === 'object' && (Array.prototype.isPrototypeOf(x) || x.constructor && x.constructor.name === 'Array')) {\n        return 'array';\n      }\n      if (t === 'object' && (String.prototype.isPrototypeOf(x) || x.constructor && x.constructor.name === 'String')) {\n        return 'string';\n      }\n      return t;\n    };\n    var isType = function (type) {\n      return function (value) {\n        return typeOf(value) === type;\n      };\n    };\n    var isFunction = isType('function');\n\n    var nativeSlice = Array.prototype.slice;\n    var find = function (xs, pred) {\n      for (var i = 0, len = xs.length; i < len; i++) {\n        var x = xs[i];\n        if (pred(x, i)) {\n          return Option.some(x);\n        }\n      }\n      return Option.none();\n    };\n    var from$1 = isFunction(Array.from) ? Array.from : function (x) {\n      return nativeSlice.call(x);\n    };\n\n    function FileReader () {\n      var f = Global$1.getOrDie('FileReader');\n      return new f();\n    }\n\n    function XMLHttpRequest () {\n      var f = Global$1.getOrDie('XMLHttpRequest');\n      return new f();\n    }\n\n    var isValue = function (obj) {\n      return obj !== null && obj !== undefined;\n    };\n    var traverse = function (json, path) {\n      var value;\n      value = path.reduce(function (result, key) {\n        return isValue(result) ? result[key] : undefined;\n      }, json);\n      return isValue(value) ? value : null;\n    };\n    var requestUrlAsBlob = function (url, headers, withCredentials) {\n      return new global$3(function (resolve) {\n        var xhr;\n        xhr = XMLHttpRequest();\n        xhr.onreadystatechange = function () {\n          if (xhr.readyState === 4) {\n            resolve({\n              status: xhr.status,\n              blob: this.response\n            });\n          }\n        };\n        xhr.open('GET', url, true);\n        xhr.withCredentials = withCredentials;\n        global$1.each(headers, function (value, key) {\n          xhr.setRequestHeader(key, value);\n        });\n        xhr.responseType = 'blob';\n        xhr.send();\n      });\n    };\n    var readBlob = function (blob) {\n      return new global$3(function (resolve) {\n        var fr = FileReader();\n        fr.onload = function (e) {\n          var data = e.target;\n          resolve(data.result);\n        };\n        fr.readAsText(blob);\n      });\n    };\n    var parseJson = function (text) {\n      var json;\n      try {\n        json = JSON.parse(text);\n      } catch (ex) {\n      }\n      return json;\n    };\n    var Utils = {\n      traverse: traverse,\n      readBlob: readBlob,\n      requestUrlAsBlob: requestUrlAsBlob,\n      parseJson: parseJson\n    };\n\n    var friendlyHttpErrors = [\n      {\n        code: 404,\n        message: 'Could not find Image Proxy'\n      },\n      {\n        code: 403,\n        message: 'Rejected request'\n      },\n      {\n        code: 0,\n        message: 'Incorrect Image Proxy URL'\n      }\n    ];\n    var friendlyServiceErrors = [\n      {\n        type: 'key_missing',\n        message: 'The request did not include an api key.'\n      },\n      {\n        type: 'key_not_found',\n        message: 'The provided api key could not be found.'\n      },\n      {\n        type: 'domain_not_trusted',\n        message: 'The api key is not valid for the request origins.'\n      }\n    ];\n    var isServiceErrorCode = function (code) {\n      return code === 400 || code === 403 || code === 500;\n    };\n    var getHttpErrorMsg = function (status) {\n      var message = find(friendlyHttpErrors, function (error) {\n        return status === error.code;\n      }).fold(constant('Unknown ImageProxy error'), function (error) {\n        return error.message;\n      });\n      return 'ImageProxy HTTP error: ' + message;\n    };\n    var handleHttpError = function (status) {\n      var message = getHttpErrorMsg(status);\n      return global$3.reject(message);\n    };\n    var getServiceErrorMsg = function (type) {\n      return find(friendlyServiceErrors, function (error) {\n        return error.type === type;\n      }).fold(constant('Unknown service error'), function (error) {\n        return error.message;\n      });\n    };\n    var getServiceError = function (text) {\n      var serviceError = Utils.parseJson(text);\n      var errorType = Utils.traverse(serviceError, [\n        'error',\n        'type'\n      ]);\n      var errorMsg = errorType ? getServiceErrorMsg(errorType) : 'Invalid JSON in service error message';\n      return 'ImageProxy Service error: ' + errorMsg;\n    };\n    var handleServiceError = function (status, blob) {\n      return Utils.readBlob(blob).then(function (text) {\n        var serviceError = getServiceError(text);\n        return global$3.reject(serviceError);\n      });\n    };\n    var handleServiceErrorResponse = function (status, blob) {\n      return isServiceErrorCode(status) ? handleServiceError(status, blob) : handleHttpError(status);\n    };\n    var Errors = {\n      handleServiceErrorResponse: handleServiceErrorResponse,\n      handleHttpError: handleHttpError,\n      getHttpErrorMsg: getHttpErrorMsg,\n      getServiceErrorMsg: getServiceErrorMsg\n    };\n\n    var appendApiKey = function (url, apiKey) {\n      var separator = url.indexOf('?') === -1 ? '?' : '&';\n      if (/[?&]apiKey=/.test(url) || !apiKey) {\n        return url;\n      } else {\n        return url + separator + 'apiKey=' + encodeURIComponent(apiKey);\n      }\n    };\n    var requestServiceBlob = function (url, apiKey) {\n      var headers = {\n        'Content-Type': 'application/json;charset=UTF-8',\n        'tiny-api-key': apiKey\n      };\n      return Utils.requestUrlAsBlob(appendApiKey(url, apiKey), headers, false).then(function (result) {\n        return result.status < 200 || result.status >= 300 ? Errors.handleServiceErrorResponse(result.status, result.blob) : global$3.resolve(result.blob);\n      });\n    };\n    function requestBlob(url, withCredentials) {\n      return Utils.requestUrlAsBlob(url, {}, withCredentials).then(function (result) {\n        return result.status < 200 || result.status >= 300 ? Errors.handleHttpError(result.status) : global$3.resolve(result.blob);\n      });\n    }\n    var getUrl = function (url, apiKey, withCredentials) {\n      return apiKey ? requestServiceBlob(url, apiKey) : requestBlob(url, withCredentials);\n    };\n    var Proxy = { getUrl: getUrl };\n\n    var count$1 = 0;\n    var isEditableImage = function (editor, img) {\n      var selectorMatched = editor.dom.is(img, 'img:not([data-mce-object],[data-mce-placeholder])');\n      return selectorMatched && (isLocalImage(editor, img) || isCorsImage(editor, img) || editor.settings.imagetools_proxy);\n    };\n    var displayError = function (editor, error) {\n      editor.notificationManager.open({\n        text: error,\n        type: 'error'\n      });\n    };\n    var getSelectedImage = function (editor) {\n      return editor.selection.getNode();\n    };\n    var extractFilename = function (editor, url) {\n      var m = url.match(/\\/([^\\/\\?]+)?\\.(?:jpeg|jpg|png|gif)(?:\\?|$)/i);\n      if (m) {\n        return editor.dom.encode(m[1]);\n      }\n      return null;\n    };\n    var createId = function () {\n      return 'imagetools' + count$1++;\n    };\n    var isLocalImage = function (editor, img) {\n      var url = img.src;\n      return url.indexOf('data:') === 0 || url.indexOf('blob:') === 0 || new global$4(url).host === editor.documentBaseURI.host;\n    };\n    var isCorsImage = function (editor, img) {\n      return global$1.inArray(getCorsHosts(editor), new global$4(img.src).host) !== -1;\n    };\n    var isCorsWithCredentialsImage = function (editor, img) {\n      return global$1.inArray(getCredentialsHosts(editor), new global$4(img.src).host) !== -1;\n    };\n    var imageToBlob$2 = function (editor, img) {\n      var src = img.src, apiKey;\n      if (isCorsImage(editor, img)) {\n        return Proxy.getUrl(img.src, null, isCorsWithCredentialsImage(editor, img));\n      }\n      if (!isLocalImage(editor, img)) {\n        src = getProxyUrl(editor);\n        src += (src.indexOf('?') === -1 ? '?' : '&') + 'url=' + encodeURIComponent(img.src);\n        apiKey = getApiKey(editor);\n        return Proxy.getUrl(src, apiKey, false);\n      }\n      return imageToBlob$1(img);\n    };\n    var findSelectedBlob = function (editor) {\n      var blobInfo;\n      blobInfo = editor.editorUpload.blobCache.getByUri(getSelectedImage(editor).src);\n      if (blobInfo) {\n        return global$3.resolve(blobInfo.blob());\n      }\n      return imageToBlob$2(editor, getSelectedImage(editor));\n    };\n    var startTimedUpload = function (editor, imageUploadTimerState) {\n      var imageUploadTimer = global$2.setEditorTimeout(editor, function () {\n        editor.editorUpload.uploadImagesAuto();\n      }, getUploadTimeout(editor));\n      imageUploadTimerState.set(imageUploadTimer);\n    };\n    var cancelTimedUpload = function (imageUploadTimerState) {\n      clearTimeout(imageUploadTimerState.get());\n    };\n    var updateSelectedImage = function (editor, ir, uploadImmediately, imageUploadTimerState, size) {\n      return ir.toBlob().then(function (blob) {\n        var uri, name, blobCache, blobInfo, selectedImage;\n        blobCache = editor.editorUpload.blobCache;\n        selectedImage = getSelectedImage(editor);\n        uri = selectedImage.src;\n        if (shouldReuseFilename(editor)) {\n          blobInfo = blobCache.getByUri(uri);\n          if (blobInfo) {\n            uri = blobInfo.uri();\n            name = blobInfo.name();\n          } else {\n            name = extractFilename(editor, uri);\n          }\n        }\n        blobInfo = blobCache.create({\n          id: createId(),\n          blob: blob,\n          base64: ir.toBase64(),\n          uri: uri,\n          name: name\n        });\n        blobCache.add(blobInfo);\n        editor.undoManager.transact(function () {\n          function imageLoadedHandler() {\n            editor.$(selectedImage).off('load', imageLoadedHandler);\n            editor.nodeChanged();\n            if (uploadImmediately) {\n              editor.editorUpload.uploadImagesAuto();\n            } else {\n              cancelTimedUpload(imageUploadTimerState);\n              startTimedUpload(editor, imageUploadTimerState);\n            }\n          }\n          editor.$(selectedImage).on('load', imageLoadedHandler);\n          if (size) {\n            editor.$(selectedImage).attr({\n              width: size.w,\n              height: size.h\n            });\n          }\n          editor.$(selectedImage).attr({ src: blobInfo.blobUri() }).removeAttr('data-mce-src');\n        });\n        return blobInfo;\n      });\n    };\n    var selectedImageOperation = function (editor, imageUploadTimerState, fn, size) {\n      return function () {\n        return editor._scanForImages().then(curry(findSelectedBlob, editor)).then(blobToImageResult).then(fn).then(function (imageResult) {\n          return updateSelectedImage(editor, imageResult, false, imageUploadTimerState, size);\n        }, function (error) {\n          displayError(editor, error);\n        });\n      };\n    };\n    var rotate$2 = function (editor, imageUploadTimerState, angle) {\n      return function () {\n        var size = ImageSize.getImageSize(getSelectedImage(editor));\n        var flippedSize = size ? {\n          w: size.h,\n          h: size.w\n        } : null;\n        return selectedImageOperation(editor, imageUploadTimerState, function (imageResult) {\n          return rotate$1(imageResult, angle);\n        }, flippedSize)();\n      };\n    };\n    var flip$2 = function (editor, imageUploadTimerState, axis) {\n      return function () {\n        return selectedImageOperation(editor, imageUploadTimerState, function (imageResult) {\n          return flip$1(imageResult, axis);\n        })();\n      };\n    };\n    var editImageDialog = function (editor, imageUploadTimerState) {\n      return function () {\n        var img = getSelectedImage(editor), originalSize = ImageSize.getNaturalImageSize(img);\n        var handleDialogBlob = function (blob) {\n          return new global$3(function (resolve) {\n            blobToImage$1(blob).then(function (newImage) {\n              var newSize = ImageSize.getNaturalImageSize(newImage);\n              if (originalSize.w !== newSize.w || originalSize.h !== newSize.h) {\n                if (ImageSize.getImageSize(img)) {\n                  ImageSize.setImageSize(img, newSize);\n                }\n              }\n              URL.revokeObjectURL(newImage.src);\n              resolve(blob);\n            });\n          });\n        };\n        var openDialog = function (editor, imageResult) {\n          return Dialog.edit(editor, imageResult).then(handleDialogBlob).then(blobToImageResult).then(function (imageResult) {\n            return updateSelectedImage(editor, imageResult, true, imageUploadTimerState);\n          }, function () {\n          });\n        };\n        findSelectedBlob(editor).then(blobToImageResult).then(curry(openDialog, editor), function (error) {\n          displayError(editor, error);\n        });\n      };\n    };\n    var Actions = {\n      rotate: rotate$2,\n      flip: flip$2,\n      editImageDialog: editImageDialog,\n      isEditableImage: isEditableImage,\n      cancelTimedUpload: cancelTimedUpload\n    };\n\n    var register = function (editor, imageUploadTimerState) {\n      global$1.each({\n        mceImageRotateLeft: Actions.rotate(editor, imageUploadTimerState, -90),\n        mceImageRotateRight: Actions.rotate(editor, imageUploadTimerState, 90),\n        mceImageFlipVertical: Actions.flip(editor, imageUploadTimerState, 'v'),\n        mceImageFlipHorizontal: Actions.flip(editor, imageUploadTimerState, 'h'),\n        mceEditImage: Actions.editImageDialog(editor, imageUploadTimerState)\n      }, function (fn, cmd) {\n        editor.addCommand(cmd, fn);\n      });\n    };\n    var Commands = { register: register };\n\n    var setup = function (editor, imageUploadTimerState, lastSelectedImageState) {\n      editor.on('NodeChange', function (e) {\n        var lastSelectedImage = lastSelectedImageState.get();\n        if (lastSelectedImage && lastSelectedImage.src !== e.element.src) {\n          Actions.cancelTimedUpload(imageUploadTimerState);\n          editor.editorUpload.uploadImagesAuto();\n          lastSelectedImageState.set(null);\n        }\n        if (Actions.isEditableImage(editor, e.element)) {\n          lastSelectedImageState.set(e.element);\n        }\n      });\n    };\n    var UploadSelectedImage = { setup: setup };\n\n    var register$1 = function (editor) {\n      editor.addButton('rotateleft', {\n        title: 'Rotate counterclockwise',\n        cmd: 'mceImageRotateLeft'\n      });\n      editor.addButton('rotateright', {\n        title: 'Rotate clockwise',\n        cmd: 'mceImageRotateRight'\n      });\n      editor.addButton('flipv', {\n        title: 'Flip vertically',\n        cmd: 'mceImageFlipVertical'\n      });\n      editor.addButton('fliph', {\n        title: 'Flip horizontally',\n        cmd: 'mceImageFlipHorizontal'\n      });\n      editor.addButton('editimage', {\n        title: 'Edit image',\n        cmd: 'mceEditImage'\n      });\n      editor.addButton('imageoptions', {\n        title: 'Image options',\n        icon: 'options',\n        cmd: 'mceImage'\n      });\n    };\n    var Buttons = { register: register$1 };\n\n    var register$2 = function (editor) {\n      editor.addContextToolbar(curry(Actions.isEditableImage, editor), getToolbarItems(editor));\n    };\n    var ContextToolbar = { register: register$2 };\n\n    global.add('imagetools', function (editor) {\n      var imageUploadTimerState = Cell(0);\n      var lastSelectedImageState = Cell(null);\n      Commands.register(editor, imageUploadTimerState);\n      Buttons.register(editor);\n      ContextToolbar.register(editor);\n      UploadSelectedImage.setup(editor, imageUploadTimerState, lastSelectedImageState);\n    });\n    function Plugin () {\n    }\n\n    return Plugin;\n\n}(window));\n})();\n\n\n/***/ })\n\n});\n\n\n// WEBPACK FOOTER //\n// static/js/25.69785591ee5e23492b5b.js","// Exports the \"imagetools\" plugin for usage with module loaders\n// Usage:\n//   CommonJS:\n//     require('tinymce/plugins/imagetools')\n//   ES2015:\n//     import 'tinymce/plugins/imagetools'\nrequire('./plugin.js');\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./~/tinymce/plugins/imagetools/index.js\n// module id = XjFM\n// module chunks = 25","(function () {\nvar imagetools = (function (domGlobals) {\n    'use strict';\n\n    var Cell = function (initial) {\n      var value = initial;\n      var get = function () {\n        return value;\n      };\n      var set = function (v) {\n        value = v;\n      };\n      var clone = function () {\n        return Cell(get());\n      };\n      return {\n        get: get,\n        set: set,\n        clone: clone\n      };\n    };\n\n    var global = tinymce.util.Tools.resolve('tinymce.PluginManager');\n\n    var global$1 = tinymce.util.Tools.resolve('tinymce.util.Tools');\n\n    var noop = function () {\n    };\n    var constant = function (value) {\n      return function () {\n        return value;\n      };\n    };\n    function curry(fn) {\n      var initialArgs = [];\n      for (var _i = 1; _i < arguments.length; _i++) {\n        initialArgs[_i - 1] = arguments[_i];\n      }\n      return function () {\n        var restArgs = [];\n        for (var _i = 0; _i < arguments.length; _i++) {\n          restArgs[_i] = arguments[_i];\n        }\n        var all = initialArgs.concat(restArgs);\n        return fn.apply(null, all);\n      };\n    }\n    var never = constant(false);\n    var always = constant(true);\n\n    var none = function () {\n      return NONE;\n    };\n    var NONE = function () {\n      var eq = function (o) {\n        return o.isNone();\n      };\n      var call = function (thunk) {\n        return thunk();\n      };\n      var id = function (n) {\n        return n;\n      };\n      var me = {\n        fold: function (n, s) {\n          return n();\n        },\n        is: never,\n        isSome: never,\n        isNone: always,\n        getOr: id,\n        getOrThunk: call,\n        getOrDie: function (msg) {\n          throw new Error(msg || 'error: getOrDie called on none.');\n        },\n        getOrNull: constant(null),\n        getOrUndefined: constant(undefined),\n        or: id,\n        orThunk: call,\n        map: none,\n        each: noop,\n        bind: none,\n        exists: never,\n        forall: always,\n        filter: none,\n        equals: eq,\n        equals_: eq,\n        toArray: function () {\n          return [];\n        },\n        toString: constant('none()')\n      };\n      if (Object.freeze) {\n        Object.freeze(me);\n      }\n      return me;\n    }();\n    var some = function (a) {\n      var constant_a = constant(a);\n      var self = function () {\n        return me;\n      };\n      var bind = function (f) {\n        return f(a);\n      };\n      var me = {\n        fold: function (n, s) {\n          return s(a);\n        },\n        is: function (v) {\n          return a === v;\n        },\n        isSome: always,\n        isNone: never,\n        getOr: constant_a,\n        getOrThunk: constant_a,\n        getOrDie: constant_a,\n        getOrNull: constant_a,\n        getOrUndefined: constant_a,\n        or: self,\n        orThunk: self,\n        map: function (f) {\n          return some(f(a));\n        },\n        each: function (f) {\n          f(a);\n        },\n        bind: bind,\n        exists: bind,\n        forall: bind,\n        filter: function (f) {\n          return f(a) ? me : NONE;\n        },\n        toArray: function () {\n          return [a];\n        },\n        toString: function () {\n          return 'some(' + a + ')';\n        },\n        equals: function (o) {\n          return o.is(a);\n        },\n        equals_: function (o, elementEq) {\n          return o.fold(never, function (b) {\n            return elementEq(a, b);\n          });\n        }\n      };\n      return me;\n    };\n    var from = function (value) {\n      return value === null || value === undefined ? NONE : some(value);\n    };\n    var Option = {\n      some: some,\n      none: none,\n      from: from\n    };\n\n    function create(width, height) {\n      return resize(domGlobals.document.createElement('canvas'), width, height);\n    }\n    function clone(canvas) {\n      var tCanvas = create(canvas.width, canvas.height);\n      var ctx = get2dContext(tCanvas);\n      ctx.drawImage(canvas, 0, 0);\n      return tCanvas;\n    }\n    function get2dContext(canvas) {\n      return canvas.getContext('2d');\n    }\n    function resize(canvas, width, height) {\n      canvas.width = width;\n      canvas.height = height;\n      return canvas;\n    }\n\n    function getWidth(image) {\n      return image.naturalWidth || image.width;\n    }\n    function getHeight(image) {\n      return image.naturalHeight || image.height;\n    }\n\n    var promise = function () {\n      var Promise = function (fn) {\n        if (typeof this !== 'object') {\n          throw new TypeError('Promises must be constructed via new');\n        }\n        if (typeof fn !== 'function') {\n          throw new TypeError('not a function');\n        }\n        this._state = null;\n        this._value = null;\n        this._deferreds = [];\n        doResolve(fn, bind(resolve, this), bind(reject, this));\n      };\n      var asap = Promise.immediateFn || typeof window.setImmediate === 'function' && window.setImmediate || function (fn) {\n        domGlobals.setTimeout(fn, 1);\n      };\n      function bind(fn, thisArg) {\n        return function () {\n          return fn.apply(thisArg, arguments);\n        };\n      }\n      var isArray = Array.isArray || function (value) {\n        return Object.prototype.toString.call(value) === '[object Array]';\n      };\n      function handle(deferred) {\n        var me = this;\n        if (this._state === null) {\n          this._deferreds.push(deferred);\n          return;\n        }\n        asap(function () {\n          var cb = me._state ? deferred.onFulfilled : deferred.onRejected;\n          if (cb === null) {\n            (me._state ? deferred.resolve : deferred.reject)(me._value);\n            return;\n          }\n          var ret;\n          try {\n            ret = cb(me._value);\n          } catch (e) {\n            deferred.reject(e);\n            return;\n          }\n          deferred.resolve(ret);\n        });\n      }\n      function resolve(newValue) {\n        try {\n          if (newValue === this) {\n            throw new TypeError('A promise cannot be resolved with itself.');\n          }\n          if (newValue && (typeof newValue === 'object' || typeof newValue === 'function')) {\n            var then = newValue.then;\n            if (typeof then === 'function') {\n              doResolve(bind(then, newValue), bind(resolve, this), bind(reject, this));\n              return;\n            }\n          }\n          this._state = true;\n          this._value = newValue;\n          finale.call(this);\n        } catch (e) {\n          reject.call(this, e);\n        }\n      }\n      function reject(newValue) {\n        this._state = false;\n        this._value = newValue;\n        finale.call(this);\n      }\n      function finale() {\n        for (var _i = 0, _a = this._deferreds; _i < _a.length; _i++) {\n          var deferred = _a[_i];\n          handle.call(this, deferred);\n        }\n        this._deferreds = [];\n      }\n      function Handler(onFulfilled, onRejected, resolve, reject) {\n        this.onFulfilled = typeof onFulfilled === 'function' ? onFulfilled : null;\n        this.onRejected = typeof onRejected === 'function' ? onRejected : null;\n        this.resolve = resolve;\n        this.reject = reject;\n      }\n      function doResolve(fn, onFulfilled, onRejected) {\n        var done = false;\n        try {\n          fn(function (value) {\n            if (done) {\n              return;\n            }\n            done = true;\n            onFulfilled(value);\n          }, function (reason) {\n            if (done) {\n              return;\n            }\n            done = true;\n            onRejected(reason);\n          });\n        } catch (ex) {\n          if (done) {\n            return;\n          }\n          done = true;\n          onRejected(ex);\n        }\n      }\n      Promise.prototype.catch = function (onRejected) {\n        return this.then(null, onRejected);\n      };\n      Promise.prototype.then = function (onFulfilled, onRejected) {\n        var me = this;\n        return new Promise(function (resolve, reject) {\n          handle.call(me, new Handler(onFulfilled, onRejected, resolve, reject));\n        });\n      };\n      Promise.all = function () {\n        var values = [];\n        for (var _i = 0; _i < arguments.length; _i++) {\n          values[_i] = arguments[_i];\n        }\n        var args = Array.prototype.slice.call(values.length === 1 && isArray(values[0]) ? values[0] : values);\n        return new Promise(function (resolve, reject) {\n          if (args.length === 0) {\n            return resolve([]);\n          }\n          var remaining = args.length;\n          function res(i, val) {\n            try {\n              if (val && (typeof val === 'object' || typeof val === 'function')) {\n                var then = val.then;\n                if (typeof then === 'function') {\n                  then.call(val, function (val) {\n                    res(i, val);\n                  }, reject);\n                  return;\n                }\n              }\n              args[i] = val;\n              if (--remaining === 0) {\n                resolve(args);\n              }\n            } catch (ex) {\n              reject(ex);\n            }\n          }\n          for (var i = 0; i < args.length; i++) {\n            res(i, args[i]);\n          }\n        });\n      };\n      Promise.resolve = function (value) {\n        if (value && typeof value === 'object' && value.constructor === Promise) {\n          return value;\n        }\n        return new Promise(function (resolve) {\n          resolve(value);\n        });\n      };\n      Promise.reject = function (reason) {\n        return new Promise(function (resolve, reject) {\n          reject(reason);\n        });\n      };\n      Promise.race = function (values) {\n        return new Promise(function (resolve, reject) {\n          for (var _i = 0, values_1 = values; _i < values_1.length; _i++) {\n            var value = values_1[_i];\n            value.then(resolve, reject);\n          }\n        });\n      };\n      return Promise;\n    };\n    var Promise = window.Promise ? window.Promise : promise();\n\n    function imageToBlob(image) {\n      var src = image.src;\n      if (src.indexOf('data:') === 0) {\n        return dataUriToBlob(src);\n      }\n      return anyUriToBlob(src);\n    }\n    function blobToImage(blob) {\n      return new Promise(function (resolve, reject) {\n        var blobUrl = domGlobals.URL.createObjectURL(blob);\n        var image = new domGlobals.Image();\n        var removeListeners = function () {\n          image.removeEventListener('load', loaded);\n          image.removeEventListener('error', error);\n        };\n        function loaded() {\n          removeListeners();\n          resolve(image);\n        }\n        function error() {\n          removeListeners();\n          reject('Unable to load data of type ' + blob.type + ': ' + blobUrl);\n        }\n        image.addEventListener('load', loaded);\n        image.addEventListener('error', error);\n        image.src = blobUrl;\n        if (image.complete) {\n          loaded();\n        }\n      });\n    }\n    function anyUriToBlob(url) {\n      return new Promise(function (resolve, reject) {\n        var xhr = new domGlobals.XMLHttpRequest();\n        xhr.open('GET', url, true);\n        xhr.responseType = 'blob';\n        xhr.onload = function () {\n          if (this.status === 200) {\n            resolve(this.response);\n          }\n        };\n        xhr.onerror = function () {\n          var _this = this;\n          var corsError = function () {\n            var obj = new Error('No access to download image');\n            obj.code = 18;\n            obj.name = 'SecurityError';\n            return obj;\n          };\n          var genericError = function () {\n            return new Error('Error ' + _this.status + ' downloading image');\n          };\n          reject(this.status === 0 ? corsError() : genericError());\n        };\n        xhr.send();\n      });\n    }\n    function dataUriToBlobSync(uri) {\n      var data = uri.split(',');\n      var matches = /data:([^;]+)/.exec(data[0]);\n      if (!matches) {\n        return Option.none();\n      }\n      var mimetype = matches[1];\n      var base64 = data[1];\n      var sliceSize = 1024;\n      var byteCharacters = domGlobals.atob(base64);\n      var bytesLength = byteCharacters.length;\n      var slicesCount = Math.ceil(bytesLength / sliceSize);\n      var byteArrays = new Array(slicesCount);\n      for (var sliceIndex = 0; sliceIndex < slicesCount; ++sliceIndex) {\n        var begin = sliceIndex * sliceSize;\n        var end = Math.min(begin + sliceSize, bytesLength);\n        var bytes = new Array(end - begin);\n        for (var offset = begin, i = 0; offset < end; ++i, ++offset) {\n          bytes[i] = byteCharacters[offset].charCodeAt(0);\n        }\n        byteArrays[sliceIndex] = new Uint8Array(bytes);\n      }\n      return Option.some(new domGlobals.Blob(byteArrays, { type: mimetype }));\n    }\n    function dataUriToBlob(uri) {\n      return new Promise(function (resolve, reject) {\n        dataUriToBlobSync(uri).fold(function () {\n          reject('uri is not base64: ' + uri);\n        }, resolve);\n      });\n    }\n    function canvasToBlob(canvas, type, quality) {\n      type = type || 'image/png';\n      if (domGlobals.HTMLCanvasElement.prototype.toBlob) {\n        return new Promise(function (resolve, reject) {\n          canvas.toBlob(function (blob) {\n            if (blob) {\n              resolve(blob);\n            } else {\n              reject();\n            }\n          }, type, quality);\n        });\n      } else {\n        return dataUriToBlob(canvas.toDataURL(type, quality));\n      }\n    }\n    function canvasToDataURL(canvas, type, quality) {\n      type = type || 'image/png';\n      return canvas.toDataURL(type, quality);\n    }\n    function blobToCanvas(blob) {\n      return blobToImage(blob).then(function (image) {\n        revokeImageUrl(image);\n        var canvas = create(getWidth(image), getHeight(image));\n        var context = get2dContext(canvas);\n        context.drawImage(image, 0, 0);\n        return canvas;\n      });\n    }\n    function blobToDataUri(blob) {\n      return new Promise(function (resolve) {\n        var reader = new domGlobals.FileReader();\n        reader.onloadend = function () {\n          resolve(reader.result);\n        };\n        reader.readAsDataURL(blob);\n      });\n    }\n    function revokeImageUrl(image) {\n      domGlobals.URL.revokeObjectURL(image.src);\n    }\n\n    var blobToImage$1 = function (blob) {\n      return blobToImage(blob);\n    };\n    var imageToBlob$1 = function (image) {\n      return imageToBlob(image);\n    };\n\n    function create$1(getCanvas, blob, uri) {\n      var initialType = blob.type;\n      var getType = constant(initialType);\n      function toBlob() {\n        return Promise.resolve(blob);\n      }\n      function toDataURL() {\n        return uri;\n      }\n      function toBase64() {\n        return uri.split(',')[1];\n      }\n      function toAdjustedBlob(type, quality) {\n        return getCanvas.then(function (canvas) {\n          return canvasToBlob(canvas, type, quality);\n        });\n      }\n      function toAdjustedDataURL(type, quality) {\n        return getCanvas.then(function (canvas) {\n          return canvasToDataURL(canvas, type, quality);\n        });\n      }\n      function toAdjustedBase64(type, quality) {\n        return toAdjustedDataURL(type, quality).then(function (dataurl) {\n          return dataurl.split(',')[1];\n        });\n      }\n      function toCanvas() {\n        return getCanvas.then(clone);\n      }\n      return {\n        getType: getType,\n        toBlob: toBlob,\n        toDataURL: toDataURL,\n        toBase64: toBase64,\n        toAdjustedBlob: toAdjustedBlob,\n        toAdjustedDataURL: toAdjustedDataURL,\n        toAdjustedBase64: toAdjustedBase64,\n        toCanvas: toCanvas\n      };\n    }\n    function fromBlob(blob) {\n      return blobToDataUri(blob).then(function (uri) {\n        return create$1(blobToCanvas(blob), blob, uri);\n      });\n    }\n    function fromCanvas(canvas, type) {\n      return canvasToBlob(canvas, type).then(function (blob) {\n        return create$1(Promise.resolve(canvas), blob, canvas.toDataURL());\n      });\n    }\n\n    function clamp(value, min, max) {\n      var parsedValue = typeof value === 'string' ? parseFloat(value) : value;\n      if (parsedValue > max) {\n        parsedValue = max;\n      } else if (parsedValue < min) {\n        parsedValue = min;\n      }\n      return parsedValue;\n    }\n    function identity() {\n      return [\n        1,\n        0,\n        0,\n        0,\n        0,\n        0,\n        1,\n        0,\n        0,\n        0,\n        0,\n        0,\n        1,\n        0,\n        0,\n        0,\n        0,\n        0,\n        1,\n        0,\n        0,\n        0,\n        0,\n        0,\n        1\n      ];\n    }\n    var DELTA_INDEX = [\n      0,\n      0.01,\n      0.02,\n      0.04,\n      0.05,\n      0.06,\n      0.07,\n      0.08,\n      0.1,\n      0.11,\n      0.12,\n      0.14,\n      0.15,\n      0.16,\n      0.17,\n      0.18,\n      0.2,\n      0.21,\n      0.22,\n      0.24,\n      0.25,\n      0.27,\n      0.28,\n      0.3,\n      0.32,\n      0.34,\n      0.36,\n      0.38,\n      0.4,\n      0.42,\n      0.44,\n      0.46,\n      0.48,\n      0.5,\n      0.53,\n      0.56,\n      0.59,\n      0.62,\n      0.65,\n      0.68,\n      0.71,\n      0.74,\n      0.77,\n      0.8,\n      0.83,\n      0.86,\n      0.89,\n      0.92,\n      0.95,\n      0.98,\n      1,\n      1.06,\n      1.12,\n      1.18,\n      1.24,\n      1.3,\n      1.36,\n      1.42,\n      1.48,\n      1.54,\n      1.6,\n      1.66,\n      1.72,\n      1.78,\n      1.84,\n      1.9,\n      1.96,\n      2,\n      2.12,\n      2.25,\n      2.37,\n      2.5,\n      2.62,\n      2.75,\n      2.87,\n      3,\n      3.2,\n      3.4,\n      3.6,\n      3.8,\n      4,\n      4.3,\n      4.7,\n      4.9,\n      5,\n      5.5,\n      6,\n      6.5,\n      6.8,\n      7,\n      7.3,\n      7.5,\n      7.8,\n      8,\n      8.4,\n      8.7,\n      9,\n      9.4,\n      9.6,\n      9.8,\n      10\n    ];\n    function multiply(matrix1, matrix2) {\n      var col = [];\n      var out = new Array(25);\n      var val;\n      for (var i = 0; i < 5; i++) {\n        for (var j = 0; j < 5; j++) {\n          col[j] = matrix2[j + i * 5];\n        }\n        for (var j = 0; j < 5; j++) {\n          val = 0;\n          for (var k = 0; k < 5; k++) {\n            val += matrix1[j + k * 5] * col[k];\n          }\n          out[j + i * 5] = val;\n        }\n      }\n      return out;\n    }\n    function adjust(matrix, adjustValue) {\n      adjustValue = clamp(adjustValue, 0, 1);\n      return matrix.map(function (value, index) {\n        if (index % 6 === 0) {\n          value = 1 - (1 - value) * adjustValue;\n        } else {\n          value *= adjustValue;\n        }\n        return clamp(value, 0, 1);\n      });\n    }\n    function adjustContrast(matrix, value) {\n      var x;\n      value = clamp(value, -1, 1);\n      value *= 100;\n      if (value < 0) {\n        x = 127 + value / 100 * 127;\n      } else {\n        x = value % 1;\n        if (x === 0) {\n          x = DELTA_INDEX[value];\n        } else {\n          x = DELTA_INDEX[Math.floor(value)] * (1 - x) + DELTA_INDEX[Math.floor(value) + 1] * x;\n        }\n        x = x * 127 + 127;\n      }\n      return multiply(matrix, [\n        x / 127,\n        0,\n        0,\n        0,\n        0.5 * (127 - x),\n        0,\n        x / 127,\n        0,\n        0,\n        0.5 * (127 - x),\n        0,\n        0,\n        x / 127,\n        0,\n        0.5 * (127 - x),\n        0,\n        0,\n        0,\n        1,\n        0,\n        0,\n        0,\n        0,\n        0,\n        1\n      ]);\n    }\n    function adjustSaturation(matrix, value) {\n      value = clamp(value, -1, 1);\n      var x = 1 + (value > 0 ? 3 * value : value);\n      var lumR = 0.3086;\n      var lumG = 0.6094;\n      var lumB = 0.082;\n      return multiply(matrix, [\n        lumR * (1 - x) + x,\n        lumG * (1 - x),\n        lumB * (1 - x),\n        0,\n        0,\n        lumR * (1 - x),\n        lumG * (1 - x) + x,\n        lumB * (1 - x),\n        0,\n        0,\n        lumR * (1 - x),\n        lumG * (1 - x),\n        lumB * (1 - x) + x,\n        0,\n        0,\n        0,\n        0,\n        0,\n        1,\n        0,\n        0,\n        0,\n        0,\n        0,\n        1\n      ]);\n    }\n    function adjustHue(matrix, angle) {\n      angle = clamp(angle, -180, 180) / 180 * Math.PI;\n      var cosVal = Math.cos(angle);\n      var sinVal = Math.sin(angle);\n      var lumR = 0.213;\n      var lumG = 0.715;\n      var lumB = 0.072;\n      return multiply(matrix, [\n        lumR + cosVal * (1 - lumR) + sinVal * -lumR,\n        lumG + cosVal * -lumG + sinVal * -lumG,\n        lumB + cosVal * -lumB + sinVal * (1 - lumB),\n        0,\n        0,\n        lumR + cosVal * -lumR + sinVal * 0.143,\n        lumG + cosVal * (1 - lumG) + sinVal * 0.14,\n        lumB + cosVal * -lumB + sinVal * -0.283,\n        0,\n        0,\n        lumR + cosVal * -lumR + sinVal * -(1 - lumR),\n        lumG + cosVal * -lumG + sinVal * lumG,\n        lumB + cosVal * (1 - lumB) + sinVal * lumB,\n        0,\n        0,\n        0,\n        0,\n        0,\n        1,\n        0,\n        0,\n        0,\n        0,\n        0,\n        1\n      ]);\n    }\n    function adjustBrightness(matrix, value) {\n      value = clamp(255 * value, -255, 255);\n      return multiply(matrix, [\n        1,\n        0,\n        0,\n        0,\n        value,\n        0,\n        1,\n        0,\n        0,\n        value,\n        0,\n        0,\n        1,\n        0,\n        value,\n        0,\n        0,\n        0,\n        1,\n        0,\n        0,\n        0,\n        0,\n        0,\n        1\n      ]);\n    }\n    function adjustColors(matrix, adjustR, adjustG, adjustB) {\n      adjustR = clamp(adjustR, 0, 2);\n      adjustG = clamp(adjustG, 0, 2);\n      adjustB = clamp(adjustB, 0, 2);\n      return multiply(matrix, [\n        adjustR,\n        0,\n        0,\n        0,\n        0,\n        0,\n        adjustG,\n        0,\n        0,\n        0,\n        0,\n        0,\n        adjustB,\n        0,\n        0,\n        0,\n        0,\n        0,\n        1,\n        0,\n        0,\n        0,\n        0,\n        0,\n        1\n      ]);\n    }\n    function adjustSepia(matrix, value) {\n      value = clamp(value, 0, 1);\n      return multiply(matrix, adjust([\n        0.393,\n        0.769,\n        0.189,\n        0,\n        0,\n        0.349,\n        0.686,\n        0.168,\n        0,\n        0,\n        0.272,\n        0.534,\n        0.131,\n        0,\n        0,\n        0,\n        0,\n        0,\n        1,\n        0,\n        0,\n        0,\n        0,\n        0,\n        1\n      ], value));\n    }\n    function adjustGrayscale(matrix, value) {\n      value = clamp(value, 0, 1);\n      return multiply(matrix, adjust([\n        0.33,\n        0.34,\n        0.33,\n        0,\n        0,\n        0.33,\n        0.34,\n        0.33,\n        0,\n        0,\n        0.33,\n        0.34,\n        0.33,\n        0,\n        0,\n        0,\n        0,\n        0,\n        1,\n        0,\n        0,\n        0,\n        0,\n        0,\n        1\n      ], value));\n    }\n\n    function colorFilter(ir, matrix) {\n      return ir.toCanvas().then(function (canvas) {\n        return applyColorFilter(canvas, ir.getType(), matrix);\n      });\n    }\n    function applyColorFilter(canvas, type, matrix) {\n      var context = get2dContext(canvas);\n      function applyMatrix(pixelsData, m) {\n        var r, g, b, a;\n        var data = pixelsData.data, m0 = m[0], m1 = m[1], m2 = m[2], m3 = m[3], m4 = m[4], m5 = m[5], m6 = m[6], m7 = m[7], m8 = m[8], m9 = m[9], m10 = m[10], m11 = m[11], m12 = m[12], m13 = m[13], m14 = m[14], m15 = m[15], m16 = m[16], m17 = m[17], m18 = m[18], m19 = m[19];\n        for (var i = 0; i < data.length; i += 4) {\n          r = data[i];\n          g = data[i + 1];\n          b = data[i + 2];\n          a = data[i + 3];\n          data[i] = r * m0 + g * m1 + b * m2 + a * m3 + m4;\n          data[i + 1] = r * m5 + g * m6 + b * m7 + a * m8 + m9;\n          data[i + 2] = r * m10 + g * m11 + b * m12 + a * m13 + m14;\n          data[i + 3] = r * m15 + g * m16 + b * m17 + a * m18 + m19;\n        }\n        return pixelsData;\n      }\n      var pixels = applyMatrix(context.getImageData(0, 0, canvas.width, canvas.height), matrix);\n      context.putImageData(pixels, 0, 0);\n      return fromCanvas(canvas, type);\n    }\n    function convoluteFilter(ir, matrix) {\n      return ir.toCanvas().then(function (canvas) {\n        return applyConvoluteFilter(canvas, ir.getType(), matrix);\n      });\n    }\n    function applyConvoluteFilter(canvas, type, matrix) {\n      var context = get2dContext(canvas);\n      function applyMatrix(pIn, pOut, aMatrix) {\n        function clamp(value, min, max) {\n          if (value > max) {\n            value = max;\n          } else if (value < min) {\n            value = min;\n          }\n          return value;\n        }\n        var side = Math.round(Math.sqrt(aMatrix.length));\n        var halfSide = Math.floor(side / 2);\n        var rgba = pIn.data;\n        var drgba = pOut.data;\n        var w = pIn.width;\n        var h = pIn.height;\n        for (var y = 0; y < h; y++) {\n          for (var x = 0; x < w; x++) {\n            var r = 0;\n            var g = 0;\n            var b = 0;\n            for (var cy = 0; cy < side; cy++) {\n              for (var cx = 0; cx < side; cx++) {\n                var scx = clamp(x + cx - halfSide, 0, w - 1);\n                var scy = clamp(y + cy - halfSide, 0, h - 1);\n                var innerOffset = (scy * w + scx) * 4;\n                var wt = aMatrix[cy * side + cx];\n                r += rgba[innerOffset] * wt;\n                g += rgba[innerOffset + 1] * wt;\n                b += rgba[innerOffset + 2] * wt;\n              }\n            }\n            var offset = (y * w + x) * 4;\n            drgba[offset] = clamp(r, 0, 255);\n            drgba[offset + 1] = clamp(g, 0, 255);\n            drgba[offset + 2] = clamp(b, 0, 255);\n          }\n        }\n        return pOut;\n      }\n      var pixelsIn = context.getImageData(0, 0, canvas.width, canvas.height);\n      var pixelsOut = context.getImageData(0, 0, canvas.width, canvas.height);\n      pixelsOut = applyMatrix(pixelsIn, pixelsOut, matrix);\n      context.putImageData(pixelsOut, 0, 0);\n      return fromCanvas(canvas, type);\n    }\n    function functionColorFilter(colorFn) {\n      var filterImpl = function (canvas, type, value) {\n        var context = get2dContext(canvas);\n        var lookup = new Array(256);\n        function applyLookup(pixelsData, lookupData) {\n          var data = pixelsData.data;\n          for (var i = 0; i < data.length; i += 4) {\n            data[i] = lookupData[data[i]];\n            data[i + 1] = lookupData[data[i + 1]];\n            data[i + 2] = lookupData[data[i + 2]];\n          }\n          return pixelsData;\n        }\n        for (var i = 0; i < lookup.length; i++) {\n          lookup[i] = colorFn(i, value);\n        }\n        var pixels = applyLookup(context.getImageData(0, 0, canvas.width, canvas.height), lookup);\n        context.putImageData(pixels, 0, 0);\n        return fromCanvas(canvas, type);\n      };\n      return function (ir, value) {\n        return ir.toCanvas().then(function (canvas) {\n          return filterImpl(canvas, ir.getType(), value);\n        });\n      };\n    }\n    function complexAdjustableColorFilter(matrixAdjustFn) {\n      return function (ir, adjust) {\n        return colorFilter(ir, matrixAdjustFn(identity(), adjust));\n      };\n    }\n    function basicColorFilter(matrix) {\n      return function (ir) {\n        return colorFilter(ir, matrix);\n      };\n    }\n    function basicConvolutionFilter(kernel) {\n      return function (ir) {\n        return convoluteFilter(ir, kernel);\n      };\n    }\n    var invert = basicColorFilter([\n      -1,\n      0,\n      0,\n      0,\n      255,\n      0,\n      -1,\n      0,\n      0,\n      255,\n      0,\n      0,\n      -1,\n      0,\n      255,\n      0,\n      0,\n      0,\n      1,\n      0,\n      0,\n      0,\n      0,\n      0,\n      1\n    ]);\n    var brightness = complexAdjustableColorFilter(adjustBrightness);\n    var hue = complexAdjustableColorFilter(adjustHue);\n    var saturate = complexAdjustableColorFilter(adjustSaturation);\n    var contrast = complexAdjustableColorFilter(adjustContrast);\n    var grayscale = complexAdjustableColorFilter(adjustGrayscale);\n    var sepia = complexAdjustableColorFilter(adjustSepia);\n    var colorize = function (ir, adjustR, adjustG, adjustB) {\n      return colorFilter(ir, adjustColors(identity(), adjustR, adjustG, adjustB));\n    };\n    var sharpen = basicConvolutionFilter([\n      0,\n      -1,\n      0,\n      -1,\n      5,\n      -1,\n      0,\n      -1,\n      0\n    ]);\n    var emboss = basicConvolutionFilter([\n      -2,\n      -1,\n      0,\n      -1,\n      1,\n      1,\n      0,\n      1,\n      2\n    ]);\n    var gamma = functionColorFilter(function (color, value) {\n      return Math.pow(color / 255, 1 - value) * 255;\n    });\n    var exposure = functionColorFilter(function (color, value) {\n      return 255 * (1 - Math.exp(-(color / 255) * value));\n    });\n\n    function scale(image, dW, dH) {\n      var sW = getWidth(image);\n      var sH = getHeight(image);\n      var wRatio = dW / sW;\n      var hRatio = dH / sH;\n      var scaleCapped = false;\n      if (wRatio < 0.5 || wRatio > 2) {\n        wRatio = wRatio < 0.5 ? 0.5 : 2;\n        scaleCapped = true;\n      }\n      if (hRatio < 0.5 || hRatio > 2) {\n        hRatio = hRatio < 0.5 ? 0.5 : 2;\n        scaleCapped = true;\n      }\n      var scaled = _scale(image, wRatio, hRatio);\n      return !scaleCapped ? scaled : scaled.then(function (tCanvas) {\n        return scale(tCanvas, dW, dH);\n      });\n    }\n    function _scale(image, wRatio, hRatio) {\n      return new Promise(function (resolve) {\n        var sW = getWidth(image);\n        var sH = getHeight(image);\n        var dW = Math.floor(sW * wRatio);\n        var dH = Math.floor(sH * hRatio);\n        var canvas = create(dW, dH);\n        var context = get2dContext(canvas);\n        context.drawImage(image, 0, 0, sW, sH, 0, 0, dW, dH);\n        resolve(canvas);\n      });\n    }\n\n    function rotate(ir, angle) {\n      return ir.toCanvas().then(function (canvas) {\n        return applyRotate(canvas, ir.getType(), angle);\n      });\n    }\n    function applyRotate(image, type, angle) {\n      var canvas = create(image.width, image.height);\n      var context = get2dContext(canvas);\n      var translateX = 0;\n      var translateY = 0;\n      angle = angle < 0 ? 360 + angle : angle;\n      if (angle === 90 || angle === 270) {\n        resize(canvas, canvas.height, canvas.width);\n      }\n      if (angle === 90 || angle === 180) {\n        translateX = canvas.width;\n      }\n      if (angle === 270 || angle === 180) {\n        translateY = canvas.height;\n      }\n      context.translate(translateX, translateY);\n      context.rotate(angle * Math.PI / 180);\n      context.drawImage(image, 0, 0);\n      return fromCanvas(canvas, type);\n    }\n    function flip(ir, axis) {\n      return ir.toCanvas().then(function (canvas) {\n        return applyFlip(canvas, ir.getType(), axis);\n      });\n    }\n    function applyFlip(image, type, axis) {\n      var canvas = create(image.width, image.height);\n      var context = get2dContext(canvas);\n      if (axis === 'v') {\n        context.scale(1, -1);\n        context.drawImage(image, 0, -canvas.height);\n      } else {\n        context.scale(-1, 1);\n        context.drawImage(image, -canvas.width, 0);\n      }\n      return fromCanvas(canvas, type);\n    }\n    function crop(ir, x, y, w, h) {\n      return ir.toCanvas().then(function (canvas) {\n        return applyCrop(canvas, ir.getType(), x, y, w, h);\n      });\n    }\n    function applyCrop(image, type, x, y, w, h) {\n      var canvas = create(w, h);\n      var context = get2dContext(canvas);\n      context.drawImage(image, -x, -y);\n      return fromCanvas(canvas, type);\n    }\n    function resize$1(ir, w, h) {\n      return ir.toCanvas().then(function (canvas) {\n        return scale(canvas, w, h).then(function (newCanvas) {\n          return fromCanvas(newCanvas, ir.getType());\n        });\n      });\n    }\n\n    var invert$1 = function (ir) {\n      return invert(ir);\n    };\n    var sharpen$1 = function (ir) {\n      return sharpen(ir);\n    };\n    var emboss$1 = function (ir) {\n      return emboss(ir);\n    };\n    var gamma$1 = function (ir, value) {\n      return gamma(ir, value);\n    };\n    var exposure$1 = function (ir, value) {\n      return exposure(ir, value);\n    };\n    var colorize$1 = function (ir, adjustR, adjustG, adjustB) {\n      return colorize(ir, adjustR, adjustG, adjustB);\n    };\n    var brightness$1 = function (ir, adjust) {\n      return brightness(ir, adjust);\n    };\n    var hue$1 = function (ir, adjust) {\n      return hue(ir, adjust);\n    };\n    var saturate$1 = function (ir, adjust) {\n      return saturate(ir, adjust);\n    };\n    var contrast$1 = function (ir, adjust) {\n      return contrast(ir, adjust);\n    };\n    var grayscale$1 = function (ir, adjust) {\n      return grayscale(ir, adjust);\n    };\n    var sepia$1 = function (ir, adjust) {\n      return sepia(ir, adjust);\n    };\n    var flip$1 = function (ir, axis) {\n      return flip(ir, axis);\n    };\n    var crop$1 = function (ir, x, y, w, h) {\n      return crop(ir, x, y, w, h);\n    };\n    var resize$2 = function (ir, w, h) {\n      return resize$1(ir, w, h);\n    };\n    var rotate$1 = function (ir, angle) {\n      return rotate(ir, angle);\n    };\n\n    var blobToImageResult = function (blob) {\n      return fromBlob(blob);\n    };\n\n    var Global = typeof domGlobals.window !== 'undefined' ? domGlobals.window : Function('return this;')();\n\n    var path = function (parts, scope) {\n      var o = scope !== undefined && scope !== null ? scope : Global;\n      for (var i = 0; i < parts.length && o !== undefined && o !== null; ++i) {\n        o = o[parts[i]];\n      }\n      return o;\n    };\n    var resolve = function (p, scope) {\n      var parts = p.split('.');\n      return path(parts, scope);\n    };\n\n    var unsafe = function (name, scope) {\n      return resolve(name, scope);\n    };\n    var getOrDie = function (name, scope) {\n      var actual = unsafe(name, scope);\n      if (actual === undefined || actual === null) {\n        throw new Error(name + ' not available on this browser');\n      }\n      return actual;\n    };\n    var Global$1 = { getOrDie: getOrDie };\n\n    var url = function () {\n      return Global$1.getOrDie('URL');\n    };\n    var createObjectURL = function (blob) {\n      return url().createObjectURL(blob);\n    };\n    var revokeObjectURL = function (u) {\n      url().revokeObjectURL(u);\n    };\n    var URL = {\n      createObjectURL: createObjectURL,\n      revokeObjectURL: revokeObjectURL\n    };\n\n    var global$2 = tinymce.util.Tools.resolve('tinymce.util.Delay');\n\n    var global$3 = tinymce.util.Tools.resolve('tinymce.util.Promise');\n\n    var global$4 = tinymce.util.Tools.resolve('tinymce.util.URI');\n\n    var getToolbarItems = function (editor) {\n      return editor.getParam('imagetools_toolbar', 'rotateleft rotateright | flipv fliph | crop editimage imageoptions');\n    };\n    var getProxyUrl = function (editor) {\n      return editor.getParam('imagetools_proxy');\n    };\n    var getCorsHosts = function (editor) {\n      return editor.getParam('imagetools_cors_hosts', [], 'string[]');\n    };\n    var getCredentialsHosts = function (editor) {\n      return editor.getParam('imagetools_credentials_hosts', [], 'string[]');\n    };\n    var getApiKey = function (editor) {\n      return editor.getParam('api_key', editor.getParam('imagetools_api_key', '', 'string'), 'string');\n    };\n    var getUploadTimeout = function (editor) {\n      return editor.getParam('images_upload_timeout', 30000, 'number');\n    };\n    var shouldReuseFilename = function (editor) {\n      return editor.getParam('images_reuse_filename', false, 'boolean');\n    };\n\n    var global$5 = tinymce.util.Tools.resolve('tinymce.dom.DOMUtils');\n\n    var global$6 = tinymce.util.Tools.resolve('tinymce.ui.Factory');\n\n    function UndoStack () {\n      var data = [];\n      var index = -1;\n      function add(state) {\n        var removed;\n        removed = data.splice(++index);\n        data.push(state);\n        return {\n          state: state,\n          removed: removed\n        };\n      }\n      function undo() {\n        if (canUndo()) {\n          return data[--index];\n        }\n      }\n      function redo() {\n        if (canRedo()) {\n          return data[++index];\n        }\n      }\n      function canUndo() {\n        return index > 0;\n      }\n      function canRedo() {\n        return index !== -1 && index < data.length - 1;\n      }\n      return {\n        data: data,\n        add: add,\n        undo: undo,\n        redo: redo,\n        canUndo: canUndo,\n        canRedo: canRedo\n      };\n    }\n\n    var global$7 = tinymce.util.Tools.resolve('tinymce.geom.Rect');\n\n    var loadImage = function (image) {\n      return new global$3(function (resolve) {\n        var loaded = function () {\n          image.removeEventListener('load', loaded);\n          resolve(image);\n        };\n        if (image.complete) {\n          resolve(image);\n        } else {\n          image.addEventListener('load', loaded);\n        }\n      });\n    };\n    var LoadImage = { loadImage: loadImage };\n\n    var global$8 = tinymce.util.Tools.resolve('tinymce.dom.DomQuery');\n\n    var global$9 = tinymce.util.Tools.resolve('tinymce.util.Observable');\n\n    var global$a = tinymce.util.Tools.resolve('tinymce.util.VK');\n\n    var count = 0;\n    function CropRect (currentRect, viewPortRect, clampRect, containerElm, action) {\n      var instance;\n      var handles;\n      var dragHelpers;\n      var blockers;\n      var prefix = 'mce-';\n      var id = prefix + 'crid-' + count++;\n      handles = [\n        {\n          name: 'move',\n          xMul: 0,\n          yMul: 0,\n          deltaX: 1,\n          deltaY: 1,\n          deltaW: 0,\n          deltaH: 0,\n          label: 'Crop Mask'\n        },\n        {\n          name: 'nw',\n          xMul: 0,\n          yMul: 0,\n          deltaX: 1,\n          deltaY: 1,\n          deltaW: -1,\n          deltaH: -1,\n          label: 'Top Left Crop Handle'\n        },\n        {\n          name: 'ne',\n          xMul: 1,\n          yMul: 0,\n          deltaX: 0,\n          deltaY: 1,\n          deltaW: 1,\n          deltaH: -1,\n          label: 'Top Right Crop Handle'\n        },\n        {\n          name: 'sw',\n          xMul: 0,\n          yMul: 1,\n          deltaX: 1,\n          deltaY: 0,\n          deltaW: -1,\n          deltaH: 1,\n          label: 'Bottom Left Crop Handle'\n        },\n        {\n          name: 'se',\n          xMul: 1,\n          yMul: 1,\n          deltaX: 0,\n          deltaY: 0,\n          deltaW: 1,\n          deltaH: 1,\n          label: 'Bottom Right Crop Handle'\n        }\n      ];\n      blockers = [\n        'top',\n        'right',\n        'bottom',\n        'left'\n      ];\n      function getAbsoluteRect(outerRect, relativeRect) {\n        return {\n          x: relativeRect.x + outerRect.x,\n          y: relativeRect.y + outerRect.y,\n          w: relativeRect.w,\n          h: relativeRect.h\n        };\n      }\n      function getRelativeRect(outerRect, innerRect) {\n        return {\n          x: innerRect.x - outerRect.x,\n          y: innerRect.y - outerRect.y,\n          w: innerRect.w,\n          h: innerRect.h\n        };\n      }\n      function getInnerRect() {\n        return getRelativeRect(clampRect, currentRect);\n      }\n      function moveRect(handle, startRect, deltaX, deltaY) {\n        var x, y, w, h, rect;\n        x = startRect.x;\n        y = startRect.y;\n        w = startRect.w;\n        h = startRect.h;\n        x += deltaX * handle.deltaX;\n        y += deltaY * handle.deltaY;\n        w += deltaX * handle.deltaW;\n        h += deltaY * handle.deltaH;\n        if (w < 20) {\n          w = 20;\n        }\n        if (h < 20) {\n          h = 20;\n        }\n        rect = currentRect = global$7.clamp({\n          x: x,\n          y: y,\n          w: w,\n          h: h\n        }, clampRect, handle.name === 'move');\n        rect = getRelativeRect(clampRect, rect);\n        instance.fire('updateRect', { rect: rect });\n        setInnerRect(rect);\n      }\n      function render() {\n        function createDragHelper(handle) {\n          var startRect;\n          var DragHelper = global$6.get('DragHelper');\n          return new DragHelper(id, {\n            document: containerElm.ownerDocument,\n            handle: id + '-' + handle.name,\n            start: function () {\n              startRect = currentRect;\n            },\n            drag: function (e) {\n              moveRect(handle, startRect, e.deltaX, e.deltaY);\n            }\n          });\n        }\n        global$8('<div id=\"' + id + '\" class=\"' + prefix + 'croprect-container\"' + ' role=\"grid\" aria-dropeffect=\"execute\">').appendTo(containerElm);\n        global$1.each(blockers, function (blocker) {\n          global$8('#' + id, containerElm).append('<div id=\"' + id + '-' + blocker + '\"class=\"' + prefix + 'croprect-block\" style=\"display: none\" data-mce-bogus=\"all\">');\n        });\n        global$1.each(handles, function (handle) {\n          global$8('#' + id, containerElm).append('<div id=\"' + id + '-' + handle.name + '\" class=\"' + prefix + 'croprect-handle ' + prefix + 'croprect-handle-' + handle.name + '\"' + 'style=\"display: none\" data-mce-bogus=\"all\" role=\"gridcell\" tabindex=\"-1\"' + ' aria-label=\"' + handle.label + '\" aria-grabbed=\"false\">');\n        });\n        dragHelpers = global$1.map(handles, createDragHelper);\n        repaint(currentRect);\n        global$8(containerElm).on('focusin focusout', function (e) {\n          global$8(e.target).attr('aria-grabbed', e.type === 'focus');\n        });\n        global$8(containerElm).on('keydown', function (e) {\n          var activeHandle;\n          global$1.each(handles, function (handle) {\n            if (e.target.id === id + '-' + handle.name) {\n              activeHandle = handle;\n              return false;\n            }\n          });\n          function moveAndBlock(evt, handle, startRect, deltaX, deltaY) {\n            evt.stopPropagation();\n            evt.preventDefault();\n            moveRect(activeHandle, startRect, deltaX, deltaY);\n          }\n          switch (e.keyCode) {\n          case global$a.LEFT:\n            moveAndBlock(e, activeHandle, currentRect, -10, 0);\n            break;\n          case global$a.RIGHT:\n            moveAndBlock(e, activeHandle, currentRect, 10, 0);\n            break;\n          case global$a.UP:\n            moveAndBlock(e, activeHandle, currentRect, 0, -10);\n            break;\n          case global$a.DOWN:\n            moveAndBlock(e, activeHandle, currentRect, 0, 10);\n            break;\n          case global$a.ENTER:\n          case global$a.SPACEBAR:\n            e.preventDefault();\n            action();\n            break;\n          }\n        });\n      }\n      function toggleVisibility(state) {\n        var selectors;\n        selectors = global$1.map(handles, function (handle) {\n          return '#' + id + '-' + handle.name;\n        }).concat(global$1.map(blockers, function (blocker) {\n          return '#' + id + '-' + blocker;\n        })).join(',');\n        if (state) {\n          global$8(selectors, containerElm).show();\n        } else {\n          global$8(selectors, containerElm).hide();\n        }\n      }\n      function repaint(rect) {\n        function updateElementRect(name, rect) {\n          if (rect.h < 0) {\n            rect.h = 0;\n          }\n          if (rect.w < 0) {\n            rect.w = 0;\n          }\n          global$8('#' + id + '-' + name, containerElm).css({\n            left: rect.x,\n            top: rect.y,\n            width: rect.w,\n            height: rect.h\n          });\n        }\n        global$1.each(handles, function (handle) {\n          global$8('#' + id + '-' + handle.name, containerElm).css({\n            left: rect.w * handle.xMul + rect.x,\n            top: rect.h * handle.yMul + rect.y\n          });\n        });\n        updateElementRect('top', {\n          x: viewPortRect.x,\n          y: viewPortRect.y,\n          w: viewPortRect.w,\n          h: rect.y - viewPortRect.y\n        });\n        updateElementRect('right', {\n          x: rect.x + rect.w,\n          y: rect.y,\n          w: viewPortRect.w - rect.x - rect.w + viewPortRect.x,\n          h: rect.h\n        });\n        updateElementRect('bottom', {\n          x: viewPortRect.x,\n          y: rect.y + rect.h,\n          w: viewPortRect.w,\n          h: viewPortRect.h - rect.y - rect.h + viewPortRect.y\n        });\n        updateElementRect('left', {\n          x: viewPortRect.x,\n          y: rect.y,\n          w: rect.x - viewPortRect.x,\n          h: rect.h\n        });\n        updateElementRect('move', rect);\n      }\n      function setRect(rect) {\n        currentRect = rect;\n        repaint(currentRect);\n      }\n      function setViewPortRect(rect) {\n        viewPortRect = rect;\n        repaint(currentRect);\n      }\n      function setInnerRect(rect) {\n        setRect(getAbsoluteRect(clampRect, rect));\n      }\n      function setClampRect(rect) {\n        clampRect = rect;\n        repaint(currentRect);\n      }\n      function destroy() {\n        global$1.each(dragHelpers, function (helper) {\n          helper.destroy();\n        });\n        dragHelpers = [];\n      }\n      render();\n      instance = global$1.extend({\n        toggleVisibility: toggleVisibility,\n        setClampRect: setClampRect,\n        setRect: setRect,\n        getInnerRect: getInnerRect,\n        setInnerRect: setInnerRect,\n        setViewPortRect: setViewPortRect,\n        destroy: destroy\n      }, global$9);\n      return instance;\n    }\n\n    var create$2 = function (settings) {\n      var Control = global$6.get('Control');\n      var ImagePanel = Control.extend({\n        Defaults: { classes: 'imagepanel' },\n        selection: function (rect) {\n          if (arguments.length) {\n            this.state.set('rect', rect);\n            return this;\n          }\n          return this.state.get('rect');\n        },\n        imageSize: function () {\n          var viewRect = this.state.get('viewRect');\n          return {\n            w: viewRect.w,\n            h: viewRect.h\n          };\n        },\n        toggleCropRect: function (state) {\n          this.state.set('cropEnabled', state);\n        },\n        imageSrc: function (url) {\n          var self = this, img = new domGlobals.Image();\n          img.src = url;\n          LoadImage.loadImage(img).then(function () {\n            var rect, $img;\n            var lastRect = self.state.get('viewRect');\n            $img = self.$el.find('img');\n            if ($img[0]) {\n              $img.replaceWith(img);\n            } else {\n              var bg = domGlobals.document.createElement('div');\n              bg.className = 'mce-imagepanel-bg';\n              self.getEl().appendChild(bg);\n              self.getEl().appendChild(img);\n            }\n            rect = {\n              x: 0,\n              y: 0,\n              w: img.naturalWidth,\n              h: img.naturalHeight\n            };\n            self.state.set('viewRect', rect);\n            self.state.set('rect', global$7.inflate(rect, -20, -20));\n            if (!lastRect || lastRect.w !== rect.w || lastRect.h !== rect.h) {\n              self.zoomFit();\n            }\n            self.repaintImage();\n            self.fire('load');\n          });\n        },\n        zoom: function (value) {\n          if (arguments.length) {\n            this.state.set('zoom', value);\n            return this;\n          }\n          return this.state.get('zoom');\n        },\n        postRender: function () {\n          this.imageSrc(this.settings.imageSrc);\n          return this._super();\n        },\n        zoomFit: function () {\n          var self = this;\n          var $img, pw, ph, w, h, zoom, padding;\n          padding = 10;\n          $img = self.$el.find('img');\n          pw = self.getEl().clientWidth;\n          ph = self.getEl().clientHeight;\n          w = $img[0].naturalWidth;\n          h = $img[0].naturalHeight;\n          zoom = Math.min((pw - padding) / w, (ph - padding) / h);\n          if (zoom >= 1) {\n            zoom = 1;\n          }\n          self.zoom(zoom);\n        },\n        repaintImage: function () {\n          var x, y, w, h, pw, ph, $img, $bg, zoom, rect, elm;\n          elm = this.getEl();\n          zoom = this.zoom();\n          rect = this.state.get('rect');\n          $img = this.$el.find('img');\n          $bg = this.$el.find('.mce-imagepanel-bg');\n          pw = elm.offsetWidth;\n          ph = elm.offsetHeight;\n          w = $img[0].naturalWidth * zoom;\n          h = $img[0].naturalHeight * zoom;\n          x = Math.max(0, pw / 2 - w / 2);\n          y = Math.max(0, ph / 2 - h / 2);\n          $img.css({\n            left: x,\n            top: y,\n            width: w,\n            height: h\n          });\n          $bg.css({\n            left: x,\n            top: y,\n            width: w,\n            height: h\n          });\n          if (this.cropRect) {\n            this.cropRect.setRect({\n              x: rect.x * zoom + x,\n              y: rect.y * zoom + y,\n              w: rect.w * zoom,\n              h: rect.h * zoom\n            });\n            this.cropRect.setClampRect({\n              x: x,\n              y: y,\n              w: w,\n              h: h\n            });\n            this.cropRect.setViewPortRect({\n              x: 0,\n              y: 0,\n              w: pw,\n              h: ph\n            });\n          }\n        },\n        bindStates: function () {\n          var self = this;\n          function setupCropRect(rect) {\n            self.cropRect = CropRect(rect, self.state.get('viewRect'), self.state.get('viewRect'), self.getEl(), function () {\n              self.fire('crop');\n            });\n            self.cropRect.on('updateRect', function (e) {\n              var rect = e.rect;\n              var zoom = self.zoom();\n              rect = {\n                x: Math.round(rect.x / zoom),\n                y: Math.round(rect.y / zoom),\n                w: Math.round(rect.w / zoom),\n                h: Math.round(rect.h / zoom)\n              };\n              self.state.set('rect', rect);\n            });\n            self.on('remove', self.cropRect.destroy);\n          }\n          self.state.on('change:cropEnabled', function (e) {\n            self.cropRect.toggleVisibility(e.value);\n            self.repaintImage();\n          });\n          self.state.on('change:zoom', function () {\n            self.repaintImage();\n          });\n          self.state.on('change:rect', function (e) {\n            var rect = e.value;\n            if (!self.cropRect) {\n              setupCropRect(rect);\n            }\n            self.cropRect.setRect(rect);\n          });\n        }\n      });\n      return new ImagePanel(settings);\n    };\n    var ImagePanel = { create: create$2 };\n\n    function createState(blob) {\n      return {\n        blob: blob,\n        url: URL.createObjectURL(blob)\n      };\n    }\n    function destroyState(state) {\n      if (state) {\n        URL.revokeObjectURL(state.url);\n      }\n    }\n    function destroyStates(states) {\n      global$1.each(states, destroyState);\n    }\n    function open(editor, currentState, resolve, reject) {\n      var win, undoStack = UndoStack(), mainPanel, filtersPanel, tempState, cropPanel, resizePanel, flipRotatePanel, imagePanel, sidePanel, mainViewContainer, invertPanel, brightnessPanel, huePanel, saturatePanel, contrastPanel, grayscalePanel, sepiaPanel, colorizePanel, sharpenPanel, embossPanel, gammaPanel, exposurePanel, panels, width, height, ratioW, ratioH;\n      var reverseIfRtl = function (items) {\n        return editor.rtl ? items.reverse() : items;\n      };\n      function recalcSize(e) {\n        var widthCtrl, heightCtrl, newWidth, newHeight;\n        widthCtrl = win.find('#w')[0];\n        heightCtrl = win.find('#h')[0];\n        newWidth = parseInt(widthCtrl.value(), 10);\n        newHeight = parseInt(heightCtrl.value(), 10);\n        if (win.find('#constrain')[0].checked() && width && height && newWidth && newHeight) {\n          if (e.control.settings.name === 'w') {\n            newHeight = Math.round(newWidth * ratioW);\n            heightCtrl.value(newHeight);\n          } else {\n            newWidth = Math.round(newHeight * ratioH);\n            widthCtrl.value(newWidth);\n          }\n        }\n        width = newWidth;\n        height = newHeight;\n      }\n      function floatToPercent(value) {\n        return Math.round(value * 100) + '%';\n      }\n      function updateButtonUndoStates() {\n        win.find('#undo').disabled(!undoStack.canUndo());\n        win.find('#redo').disabled(!undoStack.canRedo());\n        win.statusbar.find('#save').disabled(!undoStack.canUndo());\n      }\n      function disableUndoRedo() {\n        win.find('#undo').disabled(true);\n        win.find('#redo').disabled(true);\n      }\n      function displayState(state) {\n        if (state) {\n          imagePanel.imageSrc(state.url);\n        }\n      }\n      function switchPanel(targetPanel) {\n        return function () {\n          var hidePanels = global$1.grep(panels, function (panel) {\n            return panel.settings.name !== targetPanel;\n          });\n          global$1.each(hidePanels, function (panel) {\n            panel.hide();\n          });\n          targetPanel.show();\n          targetPanel.focus();\n        };\n      }\n      function addTempState(blob) {\n        tempState = createState(blob);\n        displayState(tempState);\n      }\n      function addBlobState(blob) {\n        currentState = createState(blob);\n        displayState(currentState);\n        destroyStates(undoStack.add(currentState).removed);\n        updateButtonUndoStates();\n      }\n      function crop() {\n        var rect = imagePanel.selection();\n        blobToImageResult(currentState.blob).then(function (ir) {\n          crop$1(ir, rect.x, rect.y, rect.w, rect.h).then(imageResultToBlob).then(function (blob) {\n            addBlobState(blob);\n            cancel();\n          });\n        });\n      }\n      var tempAction = function (fn) {\n        var args = [].slice.call(arguments, 1);\n        return function () {\n          var state = tempState || currentState;\n          blobToImageResult(state.blob).then(function (ir) {\n            fn.apply(this, [ir].concat(args)).then(imageResultToBlob).then(addTempState);\n          });\n        };\n      };\n      function action(fn) {\n        var arg = [];\n        for (var _i = 1; _i < arguments.length; _i++) {\n          arg[_i - 1] = arguments[_i];\n        }\n        var args = [].slice.call(arguments, 1);\n        return function () {\n          blobToImageResult(currentState.blob).then(function (ir) {\n            fn.apply(this, [ir].concat(args)).then(imageResultToBlob).then(addBlobState);\n          });\n        };\n      }\n      function cancel() {\n        displayState(currentState);\n        destroyState(tempState);\n        switchPanel(mainPanel)();\n        updateButtonUndoStates();\n      }\n      function waitForTempState(times, applyCall) {\n        if (tempState) {\n          applyCall();\n        } else {\n          setTimeout(function () {\n            if (times-- > 0) {\n              waitForTempState(times, applyCall);\n            } else {\n              editor.windowManager.alert('Error: failed to apply image operation.');\n            }\n          }, 10);\n        }\n      }\n      function applyTempState() {\n        if (tempState) {\n          addBlobState(tempState.blob);\n          cancel();\n        } else {\n          waitForTempState(100, applyTempState);\n        }\n      }\n      function zoomIn() {\n        var zoom = imagePanel.zoom();\n        if (zoom < 2) {\n          zoom += 0.1;\n        }\n        imagePanel.zoom(zoom);\n      }\n      function zoomOut() {\n        var zoom = imagePanel.zoom();\n        if (zoom > 0.1) {\n          zoom -= 0.1;\n        }\n        imagePanel.zoom(zoom);\n      }\n      function undo() {\n        currentState = undoStack.undo();\n        displayState(currentState);\n        updateButtonUndoStates();\n      }\n      function redo() {\n        currentState = undoStack.redo();\n        displayState(currentState);\n        updateButtonUndoStates();\n      }\n      function save() {\n        resolve(currentState.blob);\n        win.close();\n      }\n      function createPanel(items) {\n        return global$6.create('Form', {\n          layout: 'flex',\n          direction: 'row',\n          labelGap: 5,\n          border: '0 0 1 0',\n          align: 'center',\n          pack: 'center',\n          padding: '0 10 0 10',\n          spacing: 5,\n          flex: 0,\n          minHeight: 60,\n          defaults: {\n            classes: 'imagetool',\n            type: 'button'\n          },\n          items: items\n        });\n      }\n      var imageResultToBlob = function (ir) {\n        return ir.toBlob();\n      };\n      function createFilterPanel(title, filter) {\n        return createPanel(reverseIfRtl([\n          {\n            text: 'Back',\n            onclick: cancel\n          },\n          {\n            type: 'spacer',\n            flex: 1\n          },\n          {\n            text: 'Apply',\n            subtype: 'primary',\n            onclick: applyTempState\n          }\n        ])).hide().on('show', function () {\n          disableUndoRedo();\n          blobToImageResult(currentState.blob).then(function (ir) {\n            return filter(ir);\n          }).then(imageResultToBlob).then(function (blob) {\n            var newTempState = createState(blob);\n            displayState(newTempState);\n            destroyState(tempState);\n            tempState = newTempState;\n          });\n        });\n      }\n      function createVariableFilterPanel(title, filter, value, min, max) {\n        function update(value) {\n          blobToImageResult(currentState.blob).then(function (ir) {\n            return filter(ir, value);\n          }).then(imageResultToBlob).then(function (blob) {\n            var newTempState = createState(blob);\n            displayState(newTempState);\n            destroyState(tempState);\n            tempState = newTempState;\n          });\n        }\n        return createPanel(reverseIfRtl([\n          {\n            text: 'Back',\n            onclick: cancel\n          },\n          {\n            type: 'spacer',\n            flex: 1\n          },\n          {\n            type: 'slider',\n            flex: 1,\n            ondragend: function (e) {\n              update(e.value);\n            },\n            minValue: editor.rtl ? max : min,\n            maxValue: editor.rtl ? min : max,\n            value: value,\n            previewFilter: floatToPercent\n          },\n          {\n            type: 'spacer',\n            flex: 1\n          },\n          {\n            text: 'Apply',\n            subtype: 'primary',\n            onclick: applyTempState\n          }\n        ])).hide().on('show', function () {\n          this.find('slider').value(value);\n          disableUndoRedo();\n        });\n      }\n      function createRgbFilterPanel(title, filter) {\n        function update() {\n          var r, g, b;\n          r = win.find('#r')[0].value();\n          g = win.find('#g')[0].value();\n          b = win.find('#b')[0].value();\n          blobToImageResult(currentState.blob).then(function (ir) {\n            return filter(ir, r, g, b);\n          }).then(imageResultToBlob).then(function (blob) {\n            var newTempState = createState(blob);\n            displayState(newTempState);\n            destroyState(tempState);\n            tempState = newTempState;\n          });\n        }\n        var min = editor.rtl ? 2 : 0;\n        var max = editor.rtl ? 0 : 2;\n        return createPanel(reverseIfRtl([\n          {\n            text: 'Back',\n            onclick: cancel\n          },\n          {\n            type: 'spacer',\n            flex: 1\n          },\n          {\n            type: 'slider',\n            label: 'R',\n            name: 'r',\n            minValue: min,\n            value: 1,\n            maxValue: max,\n            ondragend: update,\n            previewFilter: floatToPercent\n          },\n          {\n            type: 'slider',\n            label: 'G',\n            name: 'g',\n            minValue: min,\n            value: 1,\n            maxValue: max,\n            ondragend: update,\n            previewFilter: floatToPercent\n          },\n          {\n            type: 'slider',\n            label: 'B',\n            name: 'b',\n            minValue: min,\n            value: 1,\n            maxValue: max,\n            ondragend: update,\n            previewFilter: floatToPercent\n          },\n          {\n            type: 'spacer',\n            flex: 1\n          },\n          {\n            text: 'Apply',\n            subtype: 'primary',\n            onclick: applyTempState\n          }\n        ])).hide().on('show', function () {\n          win.find('#r,#g,#b').value(1);\n          disableUndoRedo();\n        });\n      }\n      cropPanel = createPanel(reverseIfRtl([\n        {\n          text: 'Back',\n          onclick: cancel\n        },\n        {\n          type: 'spacer',\n          flex: 1\n        },\n        {\n          text: 'Apply',\n          subtype: 'primary',\n          onclick: crop\n        }\n      ])).hide().on('show hide', function (e) {\n        imagePanel.toggleCropRect(e.type === 'show');\n      }).on('show', disableUndoRedo);\n      function toggleConstrain(e) {\n        if (e.control.value() === true) {\n          ratioW = height / width;\n          ratioH = width / height;\n        }\n      }\n      resizePanel = createPanel(reverseIfRtl([\n        {\n          text: 'Back',\n          onclick: cancel\n        },\n        {\n          type: 'spacer',\n          flex: 1\n        },\n        {\n          type: 'textbox',\n          name: 'w',\n          label: 'Width',\n          size: 4,\n          onkeyup: recalcSize\n        },\n        {\n          type: 'textbox',\n          name: 'h',\n          label: 'Height',\n          size: 4,\n          onkeyup: recalcSize\n        },\n        {\n          type: 'checkbox',\n          name: 'constrain',\n          text: 'Constrain proportions',\n          checked: true,\n          onchange: toggleConstrain\n        },\n        {\n          type: 'spacer',\n          flex: 1\n        },\n        {\n          text: 'Apply',\n          subtype: 'primary',\n          onclick: 'submit'\n        }\n      ])).hide().on('submit', function (e) {\n        var width = parseInt(win.find('#w').value(), 10), height = parseInt(win.find('#h').value(), 10);\n        e.preventDefault();\n        action(resize$2, width, height)();\n        cancel();\n      }).on('show', disableUndoRedo);\n      flipRotatePanel = createPanel(reverseIfRtl([\n        {\n          text: 'Back',\n          onclick: cancel\n        },\n        {\n          type: 'spacer',\n          flex: 1\n        },\n        {\n          icon: 'fliph',\n          tooltip: 'Flip horizontally',\n          onclick: tempAction(flip$1, 'h')\n        },\n        {\n          icon: 'flipv',\n          tooltip: 'Flip vertically',\n          onclick: tempAction(flip$1, 'v')\n        },\n        {\n          icon: 'rotateleft',\n          tooltip: 'Rotate counterclockwise',\n          onclick: tempAction(rotate$1, -90)\n        },\n        {\n          icon: 'rotateright',\n          tooltip: 'Rotate clockwise',\n          onclick: tempAction(rotate$1, 90)\n        },\n        {\n          type: 'spacer',\n          flex: 1\n        },\n        {\n          text: 'Apply',\n          subtype: 'primary',\n          onclick: applyTempState\n        }\n      ])).hide().on('show', disableUndoRedo);\n      invertPanel = createFilterPanel('Invert', invert$1);\n      sharpenPanel = createFilterPanel('Sharpen', sharpen$1);\n      embossPanel = createFilterPanel('Emboss', emboss$1);\n      brightnessPanel = createVariableFilterPanel('Brightness', brightness$1, 0, -1, 1);\n      huePanel = createVariableFilterPanel('Hue', hue$1, 180, 0, 360);\n      saturatePanel = createVariableFilterPanel('Saturate', saturate$1, 0, -1, 1);\n      contrastPanel = createVariableFilterPanel('Contrast', contrast$1, 0, -1, 1);\n      grayscalePanel = createVariableFilterPanel('Grayscale', grayscale$1, 0, 0, 1);\n      sepiaPanel = createVariableFilterPanel('Sepia', sepia$1, 0, 0, 1);\n      colorizePanel = createRgbFilterPanel('Colorize', colorize$1);\n      gammaPanel = createVariableFilterPanel('Gamma', gamma$1, 0, -1, 1);\n      exposurePanel = createVariableFilterPanel('Exposure', exposure$1, 1, 0, 2);\n      filtersPanel = createPanel(reverseIfRtl([\n        {\n          text: 'Back',\n          onclick: cancel\n        },\n        {\n          type: 'spacer',\n          flex: 1\n        },\n        {\n          text: 'hue',\n          icon: 'hue',\n          onclick: switchPanel(huePanel)\n        },\n        {\n          text: 'saturate',\n          icon: 'saturate',\n          onclick: switchPanel(saturatePanel)\n        },\n        {\n          text: 'sepia',\n          icon: 'sepia',\n          onclick: switchPanel(sepiaPanel)\n        },\n        {\n          text: 'emboss',\n          icon: 'emboss',\n          onclick: switchPanel(embossPanel)\n        },\n        {\n          text: 'exposure',\n          icon: 'exposure',\n          onclick: switchPanel(exposurePanel)\n        },\n        {\n          type: 'spacer',\n          flex: 1\n        }\n      ])).hide();\n      mainPanel = createPanel(reverseIfRtl([\n        {\n          tooltip: 'Crop',\n          icon: 'crop',\n          onclick: switchPanel(cropPanel)\n        },\n        {\n          tooltip: 'Resize',\n          icon: 'resize2',\n          onclick: switchPanel(resizePanel)\n        },\n        {\n          tooltip: 'Orientation',\n          icon: 'orientation',\n          onclick: switchPanel(flipRotatePanel)\n        },\n        {\n          tooltip: 'Brightness',\n          icon: 'sun',\n          onclick: switchPanel(brightnessPanel)\n        },\n        {\n          tooltip: 'Sharpen',\n          icon: 'sharpen',\n          onclick: switchPanel(sharpenPanel)\n        },\n        {\n          tooltip: 'Contrast',\n          icon: 'contrast',\n          onclick: switchPanel(contrastPanel)\n        },\n        {\n          tooltip: 'Color levels',\n          icon: 'drop',\n          onclick: switchPanel(colorizePanel)\n        },\n        {\n          tooltip: 'Gamma',\n          icon: 'gamma',\n          onclick: switchPanel(gammaPanel)\n        },\n        {\n          tooltip: 'Invert',\n          icon: 'invert',\n          onclick: switchPanel(invertPanel)\n        }\n      ]));\n      imagePanel = ImagePanel.create({\n        flex: 1,\n        imageSrc: currentState.url\n      });\n      sidePanel = global$6.create('Container', {\n        layout: 'flex',\n        direction: 'column',\n        pack: 'start',\n        border: '0 1 0 0',\n        padding: 5,\n        spacing: 5,\n        items: [\n          {\n            type: 'button',\n            icon: 'undo',\n            tooltip: 'Undo',\n            name: 'undo',\n            onclick: undo\n          },\n          {\n            type: 'button',\n            icon: 'redo',\n            tooltip: 'Redo',\n            name: 'redo',\n            onclick: redo\n          },\n          {\n            type: 'button',\n            icon: 'zoomin',\n            tooltip: 'Zoom in',\n            onclick: zoomIn\n          },\n          {\n            type: 'button',\n            icon: 'zoomout',\n            tooltip: 'Zoom out',\n            onclick: zoomOut\n          }\n        ]\n      });\n      mainViewContainer = global$6.create('Container', {\n        type: 'container',\n        layout: 'flex',\n        direction: 'row',\n        align: 'stretch',\n        flex: 1,\n        items: reverseIfRtl([\n          sidePanel,\n          imagePanel\n        ])\n      });\n      panels = [\n        mainPanel,\n        cropPanel,\n        resizePanel,\n        flipRotatePanel,\n        filtersPanel,\n        invertPanel,\n        brightnessPanel,\n        huePanel,\n        saturatePanel,\n        contrastPanel,\n        grayscalePanel,\n        sepiaPanel,\n        colorizePanel,\n        sharpenPanel,\n        embossPanel,\n        gammaPanel,\n        exposurePanel\n      ];\n      win = editor.windowManager.open({\n        layout: 'flex',\n        direction: 'column',\n        align: 'stretch',\n        minWidth: Math.min(global$5.DOM.getViewPort().w, 800),\n        minHeight: Math.min(global$5.DOM.getViewPort().h, 650),\n        title: 'Edit image',\n        items: panels.concat([mainViewContainer]),\n        buttons: reverseIfRtl([\n          {\n            text: 'Save',\n            name: 'save',\n            subtype: 'primary',\n            onclick: save\n          },\n          {\n            text: 'Cancel',\n            onclick: 'close'\n          }\n        ])\n      });\n      win.on('close', function () {\n        reject();\n        destroyStates(undoStack.data);\n        undoStack = null;\n        tempState = null;\n      });\n      undoStack.add(currentState);\n      updateButtonUndoStates();\n      imagePanel.on('load', function () {\n        width = imagePanel.imageSize().w;\n        height = imagePanel.imageSize().h;\n        ratioW = height / width;\n        ratioH = width / height;\n        win.find('#w').value(width);\n        win.find('#h').value(height);\n      });\n      imagePanel.on('crop', crop);\n    }\n    function edit(editor, imageResult) {\n      return new global$3(function (resolve, reject) {\n        return imageResult.toBlob().then(function (blob) {\n          open(editor, createState(blob), resolve, reject);\n        });\n      });\n    }\n    var Dialog = { edit: edit };\n\n    function getImageSize(img) {\n      var width, height;\n      function isPxValue(value) {\n        return /^[0-9\\.]+px$/.test(value);\n      }\n      width = img.style.width;\n      height = img.style.height;\n      if (width || height) {\n        if (isPxValue(width) && isPxValue(height)) {\n          return {\n            w: parseInt(width, 10),\n            h: parseInt(height, 10)\n          };\n        }\n        return null;\n      }\n      width = img.width;\n      height = img.height;\n      if (width && height) {\n        return {\n          w: parseInt(width, 10),\n          h: parseInt(height, 10)\n        };\n      }\n      return null;\n    }\n    function setImageSize(img, size) {\n      var width, height;\n      if (size) {\n        width = img.style.width;\n        height = img.style.height;\n        if (width || height) {\n          img.style.width = size.w + 'px';\n          img.style.height = size.h + 'px';\n          img.removeAttribute('data-mce-style');\n        }\n        width = img.width;\n        height = img.height;\n        if (width || height) {\n          img.setAttribute('width', size.w);\n          img.setAttribute('height', size.h);\n        }\n      }\n    }\n    function getNaturalImageSize(img) {\n      return {\n        w: img.naturalWidth,\n        h: img.naturalHeight\n      };\n    }\n    var ImageSize = {\n      getImageSize: getImageSize,\n      setImageSize: setImageSize,\n      getNaturalImageSize: getNaturalImageSize\n    };\n\n    var typeOf = function (x) {\n      if (x === null) {\n        return 'null';\n      }\n      var t = typeof x;\n      if (t === 'object' && (Array.prototype.isPrototypeOf(x) || x.constructor && x.constructor.name === 'Array')) {\n        return 'array';\n      }\n      if (t === 'object' && (String.prototype.isPrototypeOf(x) || x.constructor && x.constructor.name === 'String')) {\n        return 'string';\n      }\n      return t;\n    };\n    var isType = function (type) {\n      return function (value) {\n        return typeOf(value) === type;\n      };\n    };\n    var isFunction = isType('function');\n\n    var nativeSlice = Array.prototype.slice;\n    var find = function (xs, pred) {\n      for (var i = 0, len = xs.length; i < len; i++) {\n        var x = xs[i];\n        if (pred(x, i)) {\n          return Option.some(x);\n        }\n      }\n      return Option.none();\n    };\n    var from$1 = isFunction(Array.from) ? Array.from : function (x) {\n      return nativeSlice.call(x);\n    };\n\n    function FileReader () {\n      var f = Global$1.getOrDie('FileReader');\n      return new f();\n    }\n\n    function XMLHttpRequest () {\n      var f = Global$1.getOrDie('XMLHttpRequest');\n      return new f();\n    }\n\n    var isValue = function (obj) {\n      return obj !== null && obj !== undefined;\n    };\n    var traverse = function (json, path) {\n      var value;\n      value = path.reduce(function (result, key) {\n        return isValue(result) ? result[key] : undefined;\n      }, json);\n      return isValue(value) ? value : null;\n    };\n    var requestUrlAsBlob = function (url, headers, withCredentials) {\n      return new global$3(function (resolve) {\n        var xhr;\n        xhr = XMLHttpRequest();\n        xhr.onreadystatechange = function () {\n          if (xhr.readyState === 4) {\n            resolve({\n              status: xhr.status,\n              blob: this.response\n            });\n          }\n        };\n        xhr.open('GET', url, true);\n        xhr.withCredentials = withCredentials;\n        global$1.each(headers, function (value, key) {\n          xhr.setRequestHeader(key, value);\n        });\n        xhr.responseType = 'blob';\n        xhr.send();\n      });\n    };\n    var readBlob = function (blob) {\n      return new global$3(function (resolve) {\n        var fr = FileReader();\n        fr.onload = function (e) {\n          var data = e.target;\n          resolve(data.result);\n        };\n        fr.readAsText(blob);\n      });\n    };\n    var parseJson = function (text) {\n      var json;\n      try {\n        json = JSON.parse(text);\n      } catch (ex) {\n      }\n      return json;\n    };\n    var Utils = {\n      traverse: traverse,\n      readBlob: readBlob,\n      requestUrlAsBlob: requestUrlAsBlob,\n      parseJson: parseJson\n    };\n\n    var friendlyHttpErrors = [\n      {\n        code: 404,\n        message: 'Could not find Image Proxy'\n      },\n      {\n        code: 403,\n        message: 'Rejected request'\n      },\n      {\n        code: 0,\n        message: 'Incorrect Image Proxy URL'\n      }\n    ];\n    var friendlyServiceErrors = [\n      {\n        type: 'key_missing',\n        message: 'The request did not include an api key.'\n      },\n      {\n        type: 'key_not_found',\n        message: 'The provided api key could not be found.'\n      },\n      {\n        type: 'domain_not_trusted',\n        message: 'The api key is not valid for the request origins.'\n      }\n    ];\n    var isServiceErrorCode = function (code) {\n      return code === 400 || code === 403 || code === 500;\n    };\n    var getHttpErrorMsg = function (status) {\n      var message = find(friendlyHttpErrors, function (error) {\n        return status === error.code;\n      }).fold(constant('Unknown ImageProxy error'), function (error) {\n        return error.message;\n      });\n      return 'ImageProxy HTTP error: ' + message;\n    };\n    var handleHttpError = function (status) {\n      var message = getHttpErrorMsg(status);\n      return global$3.reject(message);\n    };\n    var getServiceErrorMsg = function (type) {\n      return find(friendlyServiceErrors, function (error) {\n        return error.type === type;\n      }).fold(constant('Unknown service error'), function (error) {\n        return error.message;\n      });\n    };\n    var getServiceError = function (text) {\n      var serviceError = Utils.parseJson(text);\n      var errorType = Utils.traverse(serviceError, [\n        'error',\n        'type'\n      ]);\n      var errorMsg = errorType ? getServiceErrorMsg(errorType) : 'Invalid JSON in service error message';\n      return 'ImageProxy Service error: ' + errorMsg;\n    };\n    var handleServiceError = function (status, blob) {\n      return Utils.readBlob(blob).then(function (text) {\n        var serviceError = getServiceError(text);\n        return global$3.reject(serviceError);\n      });\n    };\n    var handleServiceErrorResponse = function (status, blob) {\n      return isServiceErrorCode(status) ? handleServiceError(status, blob) : handleHttpError(status);\n    };\n    var Errors = {\n      handleServiceErrorResponse: handleServiceErrorResponse,\n      handleHttpError: handleHttpError,\n      getHttpErrorMsg: getHttpErrorMsg,\n      getServiceErrorMsg: getServiceErrorMsg\n    };\n\n    var appendApiKey = function (url, apiKey) {\n      var separator = url.indexOf('?') === -1 ? '?' : '&';\n      if (/[?&]apiKey=/.test(url) || !apiKey) {\n        return url;\n      } else {\n        return url + separator + 'apiKey=' + encodeURIComponent(apiKey);\n      }\n    };\n    var requestServiceBlob = function (url, apiKey) {\n      var headers = {\n        'Content-Type': 'application/json;charset=UTF-8',\n        'tiny-api-key': apiKey\n      };\n      return Utils.requestUrlAsBlob(appendApiKey(url, apiKey), headers, false).then(function (result) {\n        return result.status < 200 || result.status >= 300 ? Errors.handleServiceErrorResponse(result.status, result.blob) : global$3.resolve(result.blob);\n      });\n    };\n    function requestBlob(url, withCredentials) {\n      return Utils.requestUrlAsBlob(url, {}, withCredentials).then(function (result) {\n        return result.status < 200 || result.status >= 300 ? Errors.handleHttpError(result.status) : global$3.resolve(result.blob);\n      });\n    }\n    var getUrl = function (url, apiKey, withCredentials) {\n      return apiKey ? requestServiceBlob(url, apiKey) : requestBlob(url, withCredentials);\n    };\n    var Proxy = { getUrl: getUrl };\n\n    var count$1 = 0;\n    var isEditableImage = function (editor, img) {\n      var selectorMatched = editor.dom.is(img, 'img:not([data-mce-object],[data-mce-placeholder])');\n      return selectorMatched && (isLocalImage(editor, img) || isCorsImage(editor, img) || editor.settings.imagetools_proxy);\n    };\n    var displayError = function (editor, error) {\n      editor.notificationManager.open({\n        text: error,\n        type: 'error'\n      });\n    };\n    var getSelectedImage = function (editor) {\n      return editor.selection.getNode();\n    };\n    var extractFilename = function (editor, url) {\n      var m = url.match(/\\/([^\\/\\?]+)?\\.(?:jpeg|jpg|png|gif)(?:\\?|$)/i);\n      if (m) {\n        return editor.dom.encode(m[1]);\n      }\n      return null;\n    };\n    var createId = function () {\n      return 'imagetools' + count$1++;\n    };\n    var isLocalImage = function (editor, img) {\n      var url = img.src;\n      return url.indexOf('data:') === 0 || url.indexOf('blob:') === 0 || new global$4(url).host === editor.documentBaseURI.host;\n    };\n    var isCorsImage = function (editor, img) {\n      return global$1.inArray(getCorsHosts(editor), new global$4(img.src).host) !== -1;\n    };\n    var isCorsWithCredentialsImage = function (editor, img) {\n      return global$1.inArray(getCredentialsHosts(editor), new global$4(img.src).host) !== -1;\n    };\n    var imageToBlob$2 = function (editor, img) {\n      var src = img.src, apiKey;\n      if (isCorsImage(editor, img)) {\n        return Proxy.getUrl(img.src, null, isCorsWithCredentialsImage(editor, img));\n      }\n      if (!isLocalImage(editor, img)) {\n        src = getProxyUrl(editor);\n        src += (src.indexOf('?') === -1 ? '?' : '&') + 'url=' + encodeURIComponent(img.src);\n        apiKey = getApiKey(editor);\n        return Proxy.getUrl(src, apiKey, false);\n      }\n      return imageToBlob$1(img);\n    };\n    var findSelectedBlob = function (editor) {\n      var blobInfo;\n      blobInfo = editor.editorUpload.blobCache.getByUri(getSelectedImage(editor).src);\n      if (blobInfo) {\n        return global$3.resolve(blobInfo.blob());\n      }\n      return imageToBlob$2(editor, getSelectedImage(editor));\n    };\n    var startTimedUpload = function (editor, imageUploadTimerState) {\n      var imageUploadTimer = global$2.setEditorTimeout(editor, function () {\n        editor.editorUpload.uploadImagesAuto();\n      }, getUploadTimeout(editor));\n      imageUploadTimerState.set(imageUploadTimer);\n    };\n    var cancelTimedUpload = function (imageUploadTimerState) {\n      clearTimeout(imageUploadTimerState.get());\n    };\n    var updateSelectedImage = function (editor, ir, uploadImmediately, imageUploadTimerState, size) {\n      return ir.toBlob().then(function (blob) {\n        var uri, name, blobCache, blobInfo, selectedImage;\n        blobCache = editor.editorUpload.blobCache;\n        selectedImage = getSelectedImage(editor);\n        uri = selectedImage.src;\n        if (shouldReuseFilename(editor)) {\n          blobInfo = blobCache.getByUri(uri);\n          if (blobInfo) {\n            uri = blobInfo.uri();\n            name = blobInfo.name();\n          } else {\n            name = extractFilename(editor, uri);\n          }\n        }\n        blobInfo = blobCache.create({\n          id: createId(),\n          blob: blob,\n          base64: ir.toBase64(),\n          uri: uri,\n          name: name\n        });\n        blobCache.add(blobInfo);\n        editor.undoManager.transact(function () {\n          function imageLoadedHandler() {\n            editor.$(selectedImage).off('load', imageLoadedHandler);\n            editor.nodeChanged();\n            if (uploadImmediately) {\n              editor.editorUpload.uploadImagesAuto();\n            } else {\n              cancelTimedUpload(imageUploadTimerState);\n              startTimedUpload(editor, imageUploadTimerState);\n            }\n          }\n          editor.$(selectedImage).on('load', imageLoadedHandler);\n          if (size) {\n            editor.$(selectedImage).attr({\n              width: size.w,\n              height: size.h\n            });\n          }\n          editor.$(selectedImage).attr({ src: blobInfo.blobUri() }).removeAttr('data-mce-src');\n        });\n        return blobInfo;\n      });\n    };\n    var selectedImageOperation = function (editor, imageUploadTimerState, fn, size) {\n      return function () {\n        return editor._scanForImages().then(curry(findSelectedBlob, editor)).then(blobToImageResult).then(fn).then(function (imageResult) {\n          return updateSelectedImage(editor, imageResult, false, imageUploadTimerState, size);\n        }, function (error) {\n          displayError(editor, error);\n        });\n      };\n    };\n    var rotate$2 = function (editor, imageUploadTimerState, angle) {\n      return function () {\n        var size = ImageSize.getImageSize(getSelectedImage(editor));\n        var flippedSize = size ? {\n          w: size.h,\n          h: size.w\n        } : null;\n        return selectedImageOperation(editor, imageUploadTimerState, function (imageResult) {\n          return rotate$1(imageResult, angle);\n        }, flippedSize)();\n      };\n    };\n    var flip$2 = function (editor, imageUploadTimerState, axis) {\n      return function () {\n        return selectedImageOperation(editor, imageUploadTimerState, function (imageResult) {\n          return flip$1(imageResult, axis);\n        })();\n      };\n    };\n    var editImageDialog = function (editor, imageUploadTimerState) {\n      return function () {\n        var img = getSelectedImage(editor), originalSize = ImageSize.getNaturalImageSize(img);\n        var handleDialogBlob = function (blob) {\n          return new global$3(function (resolve) {\n            blobToImage$1(blob).then(function (newImage) {\n              var newSize = ImageSize.getNaturalImageSize(newImage);\n              if (originalSize.w !== newSize.w || originalSize.h !== newSize.h) {\n                if (ImageSize.getImageSize(img)) {\n                  ImageSize.setImageSize(img, newSize);\n                }\n              }\n              URL.revokeObjectURL(newImage.src);\n              resolve(blob);\n            });\n          });\n        };\n        var openDialog = function (editor, imageResult) {\n          return Dialog.edit(editor, imageResult).then(handleDialogBlob).then(blobToImageResult).then(function (imageResult) {\n            return updateSelectedImage(editor, imageResult, true, imageUploadTimerState);\n          }, function () {\n          });\n        };\n        findSelectedBlob(editor).then(blobToImageResult).then(curry(openDialog, editor), function (error) {\n          displayError(editor, error);\n        });\n      };\n    };\n    var Actions = {\n      rotate: rotate$2,\n      flip: flip$2,\n      editImageDialog: editImageDialog,\n      isEditableImage: isEditableImage,\n      cancelTimedUpload: cancelTimedUpload\n    };\n\n    var register = function (editor, imageUploadTimerState) {\n      global$1.each({\n        mceImageRotateLeft: Actions.rotate(editor, imageUploadTimerState, -90),\n        mceImageRotateRight: Actions.rotate(editor, imageUploadTimerState, 90),\n        mceImageFlipVertical: Actions.flip(editor, imageUploadTimerState, 'v'),\n        mceImageFlipHorizontal: Actions.flip(editor, imageUploadTimerState, 'h'),\n        mceEditImage: Actions.editImageDialog(editor, imageUploadTimerState)\n      }, function (fn, cmd) {\n        editor.addCommand(cmd, fn);\n      });\n    };\n    var Commands = { register: register };\n\n    var setup = function (editor, imageUploadTimerState, lastSelectedImageState) {\n      editor.on('NodeChange', function (e) {\n        var lastSelectedImage = lastSelectedImageState.get();\n        if (lastSelectedImage && lastSelectedImage.src !== e.element.src) {\n          Actions.cancelTimedUpload(imageUploadTimerState);\n          editor.editorUpload.uploadImagesAuto();\n          lastSelectedImageState.set(null);\n        }\n        if (Actions.isEditableImage(editor, e.element)) {\n          lastSelectedImageState.set(e.element);\n        }\n      });\n    };\n    var UploadSelectedImage = { setup: setup };\n\n    var register$1 = function (editor) {\n      editor.addButton('rotateleft', {\n        title: 'Rotate counterclockwise',\n        cmd: 'mceImageRotateLeft'\n      });\n      editor.addButton('rotateright', {\n        title: 'Rotate clockwise',\n        cmd: 'mceImageRotateRight'\n      });\n      editor.addButton('flipv', {\n        title: 'Flip vertically',\n        cmd: 'mceImageFlipVertical'\n      });\n      editor.addButton('fliph', {\n        title: 'Flip horizontally',\n        cmd: 'mceImageFlipHorizontal'\n      });\n      editor.addButton('editimage', {\n        title: 'Edit image',\n        cmd: 'mceEditImage'\n      });\n      editor.addButton('imageoptions', {\n        title: 'Image options',\n        icon: 'options',\n        cmd: 'mceImage'\n      });\n    };\n    var Buttons = { register: register$1 };\n\n    var register$2 = function (editor) {\n      editor.addContextToolbar(curry(Actions.isEditableImage, editor), getToolbarItems(editor));\n    };\n    var ContextToolbar = { register: register$2 };\n\n    global.add('imagetools', function (editor) {\n      var imageUploadTimerState = Cell(0);\n      var lastSelectedImageState = Cell(null);\n      Commands.register(editor, imageUploadTimerState);\n      Buttons.register(editor);\n      ContextToolbar.register(editor);\n      UploadSelectedImage.setup(editor, imageUploadTimerState, lastSelectedImageState);\n    });\n    function Plugin () {\n    }\n\n    return Plugin;\n\n}(window));\n})();\n\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./~/tinymce/plugins/imagetools/plugin.js\n// module id = vvTU\n// module chunks = 25"],"sourceRoot":""}